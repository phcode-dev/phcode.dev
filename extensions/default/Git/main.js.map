{"version":3,"sources":["extensions/default/Git/extension-min.js"],"names":["define","require","exports","module","_","brackets","getModule","AppInit","ExtensionUtils","EventEmitter","Events","Main","Preferences","Git","BracketsEvents","modules","Phoenix","config","environment","loadStyleSheet","appReady","init","then","enabled","disableAll","window","phoenixGitEvents","DocumentManager","FileSystem","ProjectManager","MainViewManager","HistoryViewer","Utils","watchedInsideGit","GIT_EVENTS","off","on","evt","file","currentGitRoot","get","fullPath","indexOf","whitelisted","any","entry","consoleDebug","emit","BRACKETS_FILE_CHANGED","doc","BRACKETS_DOCUMENT_SAVED","currentDocument","previousDocument","getCurrentDocument","isVisible","hide","BRACKETS_CURRENT_DOCUMENT_CHANGE","BRACKETS_PROJECT_CHANGE","BRACKETS_PROJECT_REFRESH","GIT_DISABLED","CommandManager","Dialogs","EditorManager","FileSyncManager","Menus","Mustache","PopUpManager","StringUtils","Strings","Metrics","ErrorHandler","Panel","Setup","ProgressDialog","branchesMenuTemplate","newBranchTemplate","mergeBranchTemplate","$gitBranchName","$","currentEditor","$dropdown","renderList","branches","map","name","currentBranch","canDelete","templateVars","branchList","filter","o","render","closeDropdown","removePopUp","detachCloseEvents","doMerge","fromBranch","getBranches","compiledTemplate","dialog","showModalDialogUsingTemplate","$dialog","getElement","find","focus","$toBranch","$useRebase","$useNoff","prop","val","$mergeMessage","attr","prMsg","setSelectionRange","useRebase","trigger","done","buttonId","useNoff","mergeMsg","rebaseInit","catch","err","countEvent","EVENT_TYPE","GIT","showError","ERROR_REBASE_FAILED","stdout","showOutput","GIT_REBASE_SUCCESS","REBASE_RESULT","finally","REFRESH_ALL","console","error","mergeBranch","ERROR_MERGE_FAILED","GIT_MERGE_SUCCESS","MERGE_RESULT","Error","_reloadBranchSelect","$el","template","html","closeNotExistingFiles","oldBranchName","newBranchName","getDeletedFiles","deletedFiles","gitRoot","openedFiles","getWorkingSet","ALL_PANES","forEach","dFile","oFile","closeFullEditor","ERROR_GETTING_DELETED_FILES","handleEvents","e","stopPropagation","getAllBranches","$input","$select","$opt","remote","newVal","substring","length","$this","this","tracker","newProgressTracker","show","fetchAllRemotes","ERROR_FETCH_REMOTE_INFO","branchName","trim","$option","children","originName","isRemote","track","createBranch","ERROR_CREATE_BRANCH","addClass","removeClass","parent","data","askQuestion","DELETE_LOCAL_BRANCH","format","DELETE_LOCAL_BRANCH_NAME","booleanResponse","response","branchDelete","question","forceBranchDelete","output","GIT_BRANCH_DELETE_SUCCESS","ERROR_BRANCH_DELETE_FORCED","getCurrentBranchName","checkout","ERROR_SWITCHING_BRANCHES","ERROR_GETTING_CURRENT_BRANCH","attachCloseEvents","getCurrentFullEditor","_codeMirror","toggleDropdown","closeAll","ERROR_GETTING_BRANCH_LIST","reduce","arr","branch","push","$toggle","marginLeft","parseInt","css","toggleOffset","offset","left","top","outerHeight","appendTo","maxHeight","height","topOffset","position","addPopUp","closeCurrentPopups","handleSelectionEvents","enableSearchFilter","_getHeadFilePath","addHeadToTheFileIndex","resolve","logError","checkBranch","getFileForPath","read","contents","ERROR_READING_GIT_HEAD","m","match","branchInHead","branchInUi","text","refresh","ERROR_PARSING_BRANCH_NAME","getGitRoot","projectRoot","getProjectRoot","isRepositoryRootOrChild","toggle","set","getMergeInfo","mergeInfo","mergeMode","rebaseMode","rebaseHead","rebaseNext","rebaseLast","REBASE_MERGE_MODE","MAX_LEN","tooltip","ON_BRANCH","enable","ERROR_READING_GIT_STATE","ex","contains","disable","$html","click","isExtensionActivated","syncOpenDocuments","execute","GIT_ENABLED","NodeConnector","gitTimeout","nextCliId","deferredMap","getExtensionPref","MAX_COUNTER_VALUE","gitNodeConnector","createNodeConnector","getNextCliId","normalizePathForOs","path","platform","replace","sanitizeOutput","str","toString","logDebug","opts","debugInfo","method","type","out","logger","loggingOptions","logGit","processInfo","duration","Date","getTime","startTime","cliId","msg","join","cliHandler","cmd","args","retry","cliPromise","Promise","reject","progressTracker","savedDefer","watchProgress","cwd","fs","getTauriPlatformPath","resolved","timeoutLength","timeout","domainOpts","timeoutPromise","timeoutExpected","execPeer","toError","GIT_PROGRESS_EVENT","directory","command","invalidCwdErr","stack","message","isResolved","lastProgressTime","timeoutCall","setTimeout","currentTime","diff","which","spawnCommand","_event","evtData","deferred","Commands","Constants","closeUnmodifiedCmd","handleCloseNotModified","status","modifiedFiles","openFiles","openFile","removeOpenFile","modifiedFile","getOpenDocumentForPath","isDirty","FILE_CLOSE_LIST","PaneId","fileList","focusActivePane","register","CMD_CLOSE_UNMODIFIED","CMD_GIT_CLOSE_UNMODIFIED","enableCommand","GIT_STRING_UNIVERSAL","GIT_SUB_MENU","SubMenuIds","GIT_PANEL_CHANGES_CMENU","GIT_PANEL_HISTORY_CMENU","GIT_PANEL_OPTIONS_CMENU","CMD_GIT_INIT","CMD_GIT_CLONE","CMD_GIT_CLONE_WITH_URL","CMD_GIT_SETTINGS_COMMAND_ID","CMD_GIT_CHECKOUT","CMD_GIT_RESET_HARD","CMD_GIT_RESET_SOFT","CMD_GIT_RESET_MIXED","CMD_GIT_TOGGLE_PANEL","CMD_GIT_GOTO_NEXT_CHANGE","CMD_GIT_GOTO_PREVIOUS_CHANGE","CMD_GIT_COMMIT_CURRENT","CMD_GIT_COMMIT_ALL","CMD_GIT_FETCH","CMD_GIT_PULL","CMD_GIT_PUSH","CMD_GIT_REFRESH","CMD_GIT_TAG","CMD_GIT_DISCARD_ALL_CHANGES","CMD_GIT_UNDO_LAST_COMMIT","CMD_GIT_CHANGE_USERNAME","CMD_GIT_CHANGE_EMAIL","CMD_GIT_GERRIT_PUSH_REF","CMD_GIT_AUTHORS_OF_SELECTION","CMD_GIT_AUTHORS_OF_FILE","CMD_GIT_TOGGLE_UNTRACKED","errorDialogTemplate","errorToString","encodeSensitiveInformation","isTimeout","equals","what","toLowerCase","matches","regExp","consoleError","title","options","dontStripError","errorMetric","__shown","errorBody","errorStack","JSON","stringify","body","debugMode","arg","apply","arguments","EventDispatcher","emInstance","getEmitter","eventName","optionalMetricToLog","callback","rest","one","makeEventDispatcher","GIT_USERNAME_CHANGED","GIT_EMAIL_CHANGED","GIT_COMMITED","GIT_NO_BRANCH_EXISTS","GIT_CHANGE_USERNAME","GIT_CHANGE_EMAIL","GERRIT_TOGGLE_PUSH_REF","GERRIT_PUSH_REF_TOGGLED","HANDLE_GIT_INIT","HANDLE_GIT_CLONE","HANDLE_GIT_COMMIT","HANDLE_FETCH","HANDLE_PUSH","HANDLE_PULL","HANDLE_REMOTE_PICK","HANDLE_REMOTE_DELETE","HANDLE_REMOTE_CREATE","HANDLE_FTP_PUSH","HISTORY_SHOW_FILE","HISTORY_SHOW_GLOBAL","REFRESH_COUNTERS","REFRESH_HISTORY","GIT_STATUS_RESULTS","GIT_REMOTE_AVAILABLE","GIT_REMOTE_NOT_AVAILABLE","REMOTES_REFRESH_PICKER","FETCH_STARTED","FETCH_COMPLETE","ExpectedError","prototype","gitAvailable","gutterName","editorsWithGutters","openWidgets","_addDummyGutterMarkerIfNotExist","cm","line","lineInfo","gutters","gutterEnabled","getOption","slice","gutterMarkers","existingMarker","dummy","document","createElement","className","setGutterMarker","_cursorActivity","_evt","editor","getCursorPos","clearWidgets","lines","mark","w","lineWidget","visible","widget","clear","clearOld","io","splice","clearGutter","setOption","gutterClick","gitGutters","prepareGutter","unshift","prepareGutters","editors","idx","showGutters","_results","sortBy","openBefore","obj","$marker","lineIndex","gutterId","parentMark","element","$btn","replaceRange","content","ch","append","addLineWidget","coverGutter","noHScroll","above","showIfHidden","getEditorFromPane","paneId","currentPath","getCurrentlyViewedPath","_masterEditor","processDiffResults","added","removed","modified","changesets","split","shift","s1","s2","lineRemovedFrom","lineFrom","lineCount","isNaN","l","isModifiedMark","firstAddedMark","i","lineTo","lineNo","pop","concat","compact","getPaneIdList","currentFilePath","filename","diffFile","ERROR_REFRESH_GUTTER","goToPrev","activeEditor","getActiveEditor","results","searched","currentPos","goToMark","setCursorPos","goToNext","event","newEditor","oldEditor","alreadyOpened","FileUtils","LocalizationUtils","gitPanelHistoryTemplate","gitPanelHistoryCommitsTemplate","$gitPanel","$tableContainer","$historyList","commitCache","lastDocumentSeen","initVariables","attachHandlers","loadMoreHistory","$tr","hash","commit","historyShown","isInitial","generateCssAvatar","memoize","author","email","seededRandom","max","min","seed","rnd","seedBase","charCodeAt","colors","texts","picked","Math","floor","renderHistory","p","getFileHistory","relative","getHistory","commits","addAdditionalCommitInfo","templateData","absolute","ERROR_GET_HISTORY","is","scrollTop","skipCount","commitsHtml","ERROR_GET_MORE_HISTORY","ERROR_GET_CURRENT_BRANCH","cssAvatar","avatarLetter","dateTime","date","shown","getFormattedDateTime","dateTimeFromNowFriendly","hasTag","tags","handleFileChange","handleToggleHistory","newHistoryMode","newDocument","historyEnabled","currentFile","currentHistoryMode","savedScrollTop","savedScrollLeft","selectedCommitHash","isRefresh","scrollLeft","getRelativeFilename","isEmpty","fileChanged","remove","$spinner","$newHistoryList","globalButtonActive","fileButtonActive","toggleClass","TOOLTIP_HIDE_HISTORY","TOOLTIP_SHOW_HISTORY","TOOLTIP_HIDE_FILE_HISTORY","TOOLTIP_SHOW_FILE_HISTORY","LanguageManager","WorkspaceManager","marked","historyViewerTemplate","historyViewerFilesTemplate","useDifftool","isShown","currentlyViewedCommit","$viewer","$editorHolder","setExpandState","debounce","allFiles","activeFiles","allExpanded","PAGE_SIZE","currentPage","hasNextPage","toggleDiff","$a","hasClass","$li","closest","relativeFilePath","$diffContainer","getDiffOfFileFromCommit","formatDiff","ERROR_GET_DIFF_FILE_COMMIT","showDiff","difftoolFromHash","expandAll","not","collapseAll","attachEvents","openEditorForFile","$parent","sha","renderViewerContent","files","selectedFile","bodyMarkdown","gfm","breaks","renderFiles","$fileEntry","first","animate","loadMoreFiles","getFilesFromCommit","list","fileExtension","getCompoundFileExtension","lastIndexOf","fileName","extension","ERROR_GET_DIFF_FILES","initialize","once","getConfig","commitInfo","commitHash","firstPaneStyle","cssText","secondPaneStyle","onRemove","recomputeLayout","Branch","SettingsDialog","CloseNotModified","gitTagDialogTemplate","CMD_ADD_TO_IGNORE","CMD_REMOVE_FROM_IGNORE","$icon","STATUSBAR_SHOW_GIT","prependTo","gitEnabled","initUi","_addRemoveItemInGitignore","selectedEntry","entryPath","gitignoreEntry","consoleWarn","without","write","ERROR_MODIFY_GITIGNORE","addItemToGitingore","getSelectedItem","removeItemFromGitingore","addItemToGitingoreFromPanel","filePath","getPanel","fileEntry","removeItemFromGitingoreFromPanel","_refreshCallback","checkoutCommit","commitDetail","getSelectedHistoryCommit","commitDetailStr","subject","displayStr","CHECKOUT_COMMIT_DETAIL","TITLE_CHECKOUT","DIALOG_CHECKOUT","noescape","customOkBtn","CHECKOUT_COMMIT","tagCommit","tagname","setTagName","ERROR_CREATE_TAG","_resetOperation","operation","gitCmdUsed","RESET_DETAIL","RESET","customOkBtnClass","reset","resetHard","RESET_HARD_TITLE","RESET_HARD_MESSAGE","resetMixed","RESET_MIXED_TITLE","RESET_MIXED_MESSAGE","resetSoft","RESET_SOFT_TITLE","RESET_SOFT_MESSAGE","disableAllMenus","commandsToDisable","cmdId","initGitMenu","fileMenu","getMenu","AppMenuBar","FILE_MENU","gitSubMenu","addSubMenu","AFTER","FILE_EXTENSION_MANAGER","addMenuDivider","addMenuItem","undefined","hideWhenCommandDisabled","ADD_TO_GITIGNORE","REMOVE_FROM_GITIGNORE","panelCmenu","registerContextMenu","historyCmenu","MENU_RESET_HARD","MENU_RESET_MIXED","MENU_RESET_SOFT","MENU_TAG_COMMIT","optionsCmenu","ContextMenu","assignContextMenuToSelector","GIT_SETTINGS","sortedResults","_toggleMenuEntriesState","_divider1","_divider2","toggleMenuEntries","bool","projectCmenu","getContextMenu","ContextMenuIds","PROJECT_MENU","workingCmenu","WORKING_SET_CONTEXT_MENU","removeMenuDivider","id","removeMenuItem","_enableAllCommands","lastExecutionTime","isCommandExecuting","FOCUS_SWITCH_DEDUPE_TIME","refreshOnFocusChange","now","hasStatusChanged","hasChanged","fail","projectSwitched","CloneDialog","gitignoreTemplate","createGitIgnore","gitIgnorePath","pathExists","exists","jsPromise","writeText","stageGitIgnore","stage","handleGitInit","isProjectRootWritable","writable","initPath","app","getDisplayPath","errorStr","FOLDER_NOT_WRITABLE","result","INIT_NEW_REPO_FAILED","isProjectRootEmpty","getContents","entries","handleGitClone","gitCloneURL","destPath","$cloneButton","_clone","remoteUrlNew","GIT_CLONE_REMOTE_FAILED","clonePath","GIT_CLONE_ERROR_EXPLAIN","cloneConfig","q","remoteUrl","clone","remoteUrlRestore","setRemoteUrl","GIT_CLONE","StateManager","CodeInspection","FileViewController","FindInFiles","NotificationUI","GutterManager","gitPanelTemplate","gitPanelResultsTemplate","gitAuthorsDialogTemplate","gitCommitDialogTemplate","gitCommitLintResultTemplate","gitDiffDialogTemplate","questionDialogTemplate","showFileWhiteList","GIT_PANEL_SHOWN_ON_FIRST_BOOT","COMMIT_MODE","CURRENT","ALL","DEFAULT","gitPanel","$mainToolbar","gitPanelDisabled","gitPanelMode","showingUntracked","lastCommitMessage","lintFile","codeInspectionPromise","inspectFile","_makeDialogBig","$wrapper","parents","width","end","_showCommitDialog","stagedDiff","prefilledMessage","commitMode","totalLintErrors","inspectFiles","lintResults","lintResult","errors","lintingFilePath","Array","isArray","resultSet","providerName","provider","errorLineMessage","pos","hasErrors","getRangeName","compiledResultHTML","CODE_INSPECTION_PROBLEMS","CODE_INSPECTION_PROBLEMS_NONE","preventDefault","target","fileToOpen","FILE_OPEN","close","FORMAT_DIFF_TOO_LARGE","toggleAmendCheckbox","AMEND_COMMIT_FORBIDDEN","getCommitMessageElement","r","getCommitCounts","hasRemote","hasCommitsAhead","ahead","$commitMessageCount","recalculateMessageLength","usingTextArea","switchCommitMessageElement","findStr","currentValue","prefillMessage","$commitMessage","getLastCommitMessage","commitMessageElement","filePaths","next","_getStagedDiff","_doGitCommit","ERROR_CANT_GET_STAGED_DIFF","commitMessage","amendCommit","noVerify","s","GIT_COMMIT_IN_PROGRESS","preDelay","postDelay","ERROR_MODIFIED_DIALOG_FILES","ERROR_GIT_COMMIT_FAILED","_showAuthors","blame","fromLine","toLine","linesTotal","blameStats","stats","key","authorName","percentage","round","reverse","LINES","_getCurrentFilePath","handleAuthorsSelection","currentSelection","getSelection","start","isSomethingSelected","ERROR_SAVE_FIRST","getBlame","ERROR_GIT_BLAME_FAILED","ERROR_NOTHING_SELECTED","handleAuthorsFile","handleGitDiff","difftool","diffFileNice","diffVal","ERROR_GIT_DIFF_FAILED","handleGitUndo","UNDO_CHANGES","Q_UNDO_CHANGES","escape","discardFileChanges","getAllOpenDocuments","reloadDoc","ERROR_DISCARD_CHANGES_FAILED","handleGitDelete","ERROR_COULD_NOT_RESOLVE_FILE","FILE_DELETE","fileNamesString","_getStagedDiffForCommitMode","GETTING_STAGED_DIFF_PROGRESS","initialMessage","PLEASE_WAIT","getListOfStagedFiles","filesList","DIFF_FAILED_SEE_FILES","_getStaggedDiffForAllFiles","FILE_STATUS","UNTRACKED","_getDiffForUntrackedFiles","getDiffOfAllIndexFiles","getDiffOfStagedFiles","isUntracked","statusFiles","untrackedFiles","fileArray","fileObject","_diff","resetIndex","handleRebase","whatToDo","rebase","abortMerge","discardAllChanges","ERROR_MERGE_ABORT_FAILED","findConflicts","doSearch","commitMerge","loadPathContent","handleGitCommit","gitStatusResults","totalFiles","totalFilesLinted","filesDone","showProgress","$progressBar","style","progressString","CODE_INSPECTION_DONE_FILES","codeInspectionPromises","fileObj","isDeleted","DELETED","all","isMerge","isLoading","stripWhitespace","setLoading","STAGED","handleGitCommitInternal","currentDoc","relativePath","ERROR_PREPARING_COMMIT_DIALOG","unsetLoading","queue","stripWhitespaceFromFiles","CLEANING_WHITESPACE_PROGRESS","refreshCurrentFile","each","currentFullPath","thisFile","shouldShow","test","_refreshTableContainer","allStaged","$editedList","visibleBefore","NOTHING_TO_COMMIT","staged","statusText","allowDiff","RENAMED","allowDelete","ADDED","allowUndo","_setName","commandID","newName","setName","refreshCommitCounts","$pullBtn","$pushBtn","clearCounts","PULL_SHORTCUT","PUSH_SHORTCUT","remotes","defaultRemote","behind","PULL_SHORTCUT_BEHIND","PUSH_SHORTCUT_AHEAD","empty","p1","p2","setVisible","setChecked","handleToggleUntracked","commitCurrentFile","commitAllFiles","_toggleCommitButton","anyStaged","undoLastLocalCommit","UNDO_COMMIT","UNDO_LOCAL_COMMIT_CONFIRM","ERROR_UNDO_LAST_COMMIT_FAILED","lastCheckOneClicked","attachDefaultTableHandlers","isChecked","shiftKey","lc","localeCompare","lcClickedSelector","sequence","prevUntil","andSelf","nextUntil","promises","add","toArray","ERROR_MODIFY_FILE_STATUS_FAILED","unstage","currentTarget","openFileAndAddToWorkingSet","setGerritCheckState","RESET_LOCAL_REPO","RESET_LOCAL_REPO_CONFIRM","DISCARD_CHANGES","ERROR_RESET_LOCAL_REPO_FAILED","$historyRow","_panelResized","_entries","mainToolbarWidth","overFlowWidth","breakpoints","bp","panelHtml","S","$panelHtml","createBottomPanel","$panel","resizeObserver","ResizeObserver","observe","stageAll","typeOfRemote","open","PANEL_COMMAND","COMMIT_CURRENT_SHORTCUT","COMMIT_ALL_SHORTCUT","FETCH_SHORTCUT","GOTO_PREVIOUS_GIT_CHANGE","GOTO_NEXT_GIT_CHANGE","REFRESH_GIT","UNDO_LAST_LOCAL_COMMIT","CHANGE_USER_NAME","CHANGE_USER_EMAIL","ENABLE_GERRIT_PUSH_REF","VIEW_AUTHORS_SELECTION","VIEW_AUTHORS_FILE","HIDE_UNTRACKED","GIT_INIT","cause","currentUserName","CHANGE_USER_NAME_TITLE","ENTER_NEW_USER_NAME","defaultValue","userName","setConfig","ERROR_CHANGE_USERNAME_FAILED","currentUserEmail","CHANGE_USER_EMAIL_TITLE","ENTER_NEW_USER_EMAIL","userEmail","ERROR_CHANGE_EMAIL_FAILED","strEnabled","toggledValue","ERROR_TOGGLE_GERRIT_PUSH_REF_FAILED","CHANGE_USER_NAME_MENU","CHANGE_USER_EMAIL_MENU","createFromTemplate","GIT_TOAST_TITLE","GIT_TOAST_MESSAGE","allowedPlacements","dismissOnClick","toastStyle","currentEmail","fileSystemEntry","isDirectory","rebaseEnabled","mergeEnabled","PreferencesManager","stateManager","prefix","defaultPreferences","stripWhitespaceFromCommits","value","addEndlineToTheEndOfFile","removeByteOrderMark","normalizeLineEndings","useGitGutter","markModifiedInTree","useVerboseDiff","clearWhitespaceOnSave","gerritPushref","enableGit","gitPath","prefs","getExtensionPrefs","location","getAll","definition","getDefaults","os","getType","getGlobal","save","definePreference","ignoreEntries","newPaths","modifiedPaths","addClassesProvider","isIgnored","isNew","isModified","refreshOpenFiles","_refreshOpenFiles","refreshIgnoreEntries","rerenderTree","detachEvents","loadIgnoreContents","excludeContents","gitignoreContents","finish","after","regexEscape","leadingSlash","trailingSlash","regex","regexp","RegExp","ignored","triggerHandler","DefaultDialogs","PullDialog","PushDialog","gitRemotesPickerTemplate","$selectedRemote","$remotesDropdown","$gitPush","getDefaultRemote","allRemotes","defaultRemotes","candidate","setDefaultRemote","remoteName","clearRemotePicker","selectRemote","refreshRemotesPicker","getRemotes","defaultRemoteName","deletable","ERROR_GETTING_REMOTES","handleRemoteCreation","CREATE_NEW_REMOTE","ENTER_REMOTE_NAME","ENTER_REMOTE_URL","url","createRemote","USER_ABORTED","ERROR_REMOTE_CREATION","deleteRemote","DELETE_REMOTE","DELETE_REMOTE_NAME","showPushResult","showModalDialog","DIALOG_ID_INFO","GIT_PUSH_RESPONSE","pushToRemote","ERROR_NO_REMOTE_SELECTED","pushConfig","additionalArgs","setBranchAsTracking","setUpstreamBranch","op","pushToNew","pushToNewUpstream","strategy","pushForced","deleteRemoteBranch","waitForClose","ERROR_PUSHING_REMOTE","ERROR_PUSHING_OPERATION","pullFromRemote","pullConfig","fetchRemote","mergeRemote","rebaseRemote","resetRemote","GIT_PULL_SUCCESS","GIT_PULL_RESPONSE","ERROR_PULLING_REMOTE","ERROR_PULLING_OPERATION","handleFetch","$remote","settingsDialogTemplate","setValues","values","tag","property","collectDialogValues","prefType","newValue","assignActions","$useDifftoolCheckbox","diffToolConfiguration","disabled","checked","enableGitPreference","gitDisabled","gitNotFound","anyChecked","DIFF_TOO_LONG","formatDiffTemplate","outputDialogTemplate","writeTestResults","EXT_NAME","getExtensionDirectory","DIFF_MAX_LENGTH","tabReplace","verbose","numLineOld","numLineNew","lastStatus","diffData","LINE_STATUS","diffSplit","lineClass","pushLine","substr","log","_numLineOld","_numLineNew","x","toUpperCase","trailingWhitespace","last","stringInput","password","passwordInput","defer","folder","unlink","_clearCachedData","isFile","a","protocol","user","users","slash1","username","slash2","warn","readAsText","refreshText","stripWhitespaceFromFile","clearWholeFile","removeBom","_cleanLines","lineNumbers","lineNumber","ln","lastLineNumber","from","to","stageChanges","langId","getLanguageForPath","getId","t","CLEAN_FILE_START","notifyProgress","CLEAN_FILE_END","clearWhitespace","setEnabled","RemoteCommon","$cloneInput","_attachEvents","$authInputs","auth","exec","templateArgs","modeLabel","CLONE_REPOSITORY","collectValues","$textarea","maxLines","addLine","updateTimeout","updateTextarea","scrollHeight","onProgress","promise","showOpts","finished","showDialog","OPERATION_IN_PROGRESS_TITLE","finalValue","finalError","check","remotesTemplate","attachCommonEvents","_show","mode","PULL_FROM","pull","collectInfo","PUSH_TO","fillBranches","ERROR_BRANCH_LIST","getCurrentUpstreamBranch","upstreamBranch","currentTrackingBranch","getRemoteUrl","URL","remoteUsername","remotePassword","_usernamePasswordDisabled","currentBranchName","ERROR_FETCH_REMOTE","handleRadioChange","trackingBranchRemote","action","saveToUrl","GitCli","remoteBranch","sortBranches","sort","b","ar","br","sortPrefix","sortName","skip","clean","baseCheck","mergeCheck","rebaseCheck","gitFolder","head","mergeHead","msgSplit","mergeMessage","mergeConflicts","Object","keys","Cli","_gitPath","_gitQueue","_gitQueueBusy","lastGitStatusResults","UNMODIFIED","IGNORED","MODIFIED","COPIED","UNMERGED","EMPTY_TREE","getGitPath","setGitPath","strEndsWith","subjectString","searchString","lastIndex","_processQueue","item","nonblocking","call","git","TypeError","moreArgs","repositoryNotFoundHandler","uniq","ffOnly","noCommit","readMergeMessage","strGerritEnabled","doPushWithArgs","retObj","lineTwo","flag","summary","flagDescription","GIT_PUSH_SUCCESS_MSG","GIT_PUSH_FORCE_UPDATED_MSG","GIT_PUSH_DELETED_MSG","GIT_PUSH_NEW_REF_MSG","GIT_PUSH_REJECTED_MSG","GIT_PUSH_UP_TO_DATE_MSG","info","oldBranch","newBranch","row","allowGlobal","skipCommits","separator","newline","hashShort","remoteGitUrl","destinationFolder","fileOrFiles","updateIndex","amend","res","originBranch","trackOrigin","_isquoted","_unquote","_isescaped","currentSubFolder","isEscaped","needReset","statusStaged","statusUnstaged","statusChar","display","prevStatus","currentStatus","_isFileStaged","getVersion","getCommitCountsFallback","sep","sep2","trimLeft","firstLine","num","stderr","root","checkPathRecursive","stat","_git","standardGitPathsWin","standardGitPathsNonWin","extensionActivated","getGitVersion","pathsToLook","unique","searchedPaths","gits","latestGit","version","major","minor","index","_version"],"mappings":"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","sourcesContent":["/*!\n * Brackets Git Extension\n *\n * @author Martin Zagora\n * @license http://opensource.org/licenses/MIT\n */\n\ndefine(function (require, exports, module) {\n\n    // Brackets modules\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        AppInit         = brackets.getModule(\"utils/AppInit\"),\n        ExtensionUtils  = brackets.getModule(\"utils/ExtensionUtils\");\n\n    // Local modules\n    require(\"src/SettingsDialog\");\n    const EventEmitter    = require(\"src/EventEmitter\"),\n        Events          = require(\"src/Events\"),\n        Main            = require(\"src/Main\"),\n        Preferences     = require(\"src/Preferences\"),\n        Git             = require(\"src/git/Git\"),\n        BracketsEvents     = require(\"src/BracketsEvents\");\n\n    // Load extension modules that are not included by core\n    var modules = [\n        \"src/GutterManager\",\n        \"src/History\",\n        \"src/NoRepo\",\n        \"src/ProjectTreeMarks\",\n        \"src/Remotes\"\n    ];\n    require(modules);\n\n    // Load CSS\n    if(Phoenix.config.environment === \"dev\"){\n        ExtensionUtils.loadStyleSheet(module, \"styles/git-styles.less\");\n    } else {\n        ExtensionUtils.loadStyleSheet(module, \"styles/git-styles-min.css\");\n    }\n\n    AppInit.appReady(function () {\n        Main.init().then((enabled)=>{\n            if(!enabled) {\n                BracketsEvents.disableAll();\n            }\n        });\n    });\n\n    // export API's for other extensions\n    if (typeof window === \"object\") {\n        window.phoenixGitEvents = {\n            EventEmitter: EventEmitter,\n            Events: Events,\n            Git\n        };\n    }\n});\n\ndefine(\"src/BracketsEvents\", function (require, exports, module) {\n\n    // Brackets modules\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileSystem      = brackets.getModule(\"filesystem/FileSystem\"),\n        ProjectManager  = brackets.getModule(\"project/ProjectManager\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\");\n\n    // Local modules\n    const Events        = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        HistoryViewer = require(\"src/HistoryViewer\"),\n        Preferences   = require(\"src/Preferences\"),\n        Utils         = require(\"src/Utils\");\n\n    // White-list for .git file watching\n    const watchedInsideGit = [\"HEAD\"];\n    const GIT_EVENTS = \"gitEvents\";\n\n    FileSystem.on(`change.${GIT_EVENTS}`, function (evt, file) {\n        // we care only for files in current project\n        var currentGitRoot = Preferences.get(\"currentGitRoot\");\n        if (file && file.fullPath.indexOf(currentGitRoot) === 0) {\n\n            if (file.fullPath.indexOf(currentGitRoot + \".git/\") === 0) {\n\n                var whitelisted = _.any(watchedInsideGit, function (entry) {\n                    return file.fullPath === currentGitRoot + \".git/\" + entry;\n                });\n                if (!whitelisted) {\n                    Utils.consoleDebug(\"Ignored FileSystem.change event: \" + file.fullPath);\n                    return;\n                }\n\n            }\n\n            EventEmitter.emit(Events.BRACKETS_FILE_CHANGED, file);\n        }\n    });\n\n    DocumentManager.on(`documentSaved.${GIT_EVENTS}`, function (evt, doc) {\n        // we care only for files in current project\n        if (doc.file.fullPath.indexOf(Preferences.get(\"currentGitRoot\")) === 0) {\n            EventEmitter.emit(Events.BRACKETS_DOCUMENT_SAVED, doc);\n        }\n    });\n\n    MainViewManager.on(`currentFileChange.${GIT_EVENTS}`, function (evt, currentDocument, previousDocument) {\n        currentDocument = currentDocument || DocumentManager.getCurrentDocument();\n        if (!HistoryViewer.isVisible()) {\n            EventEmitter.emit(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, currentDocument, previousDocument);\n        } else {\n            HistoryViewer.hide();\n        }\n    });\n\n    ProjectManager.on(`projectOpen.${GIT_EVENTS}`, function () {\n        EventEmitter.emit(Events.BRACKETS_PROJECT_CHANGE);\n    });\n\n    ProjectManager.on(`projectRefresh.${GIT_EVENTS}`, function () {\n        EventEmitter.emit(Events.BRACKETS_PROJECT_REFRESH);\n    });\n\n    ProjectManager.on(`beforeProjectClose.${GIT_EVENTS}`, function () {\n        // Disable Git when closing a project so listeners won't fire before new is opened\n        EventEmitter.emit(Events.GIT_DISABLED);\n    });\n\n    function disableAll() {\n        FileSystem.off(`change.${GIT_EVENTS}`);\n        DocumentManager.off(`documentSaved.${GIT_EVENTS}`);\n        MainViewManager.off(`currentFileChange.${GIT_EVENTS}`);\n        ProjectManager.off(`projectOpen.${GIT_EVENTS}`);\n        ProjectManager.off(`projectRefresh.${GIT_EVENTS}`);\n        ProjectManager.off(`beforeProjectClose.${GIT_EVENTS}`);\n    }\n\n    exports.disableAll = disableAll;\n});\n\ndefine(\"src/Branch\", function (require, exports) {\n\n    var _                       = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager          = brackets.getModule(\"command/CommandManager\"),\n        Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        EditorManager           = brackets.getModule(\"editor/EditorManager\"),\n        FileSyncManager         = brackets.getModule(\"project/FileSyncManager\"),\n        FileSystem              = brackets.getModule(\"filesystem/FileSystem\"),\n        Menus                   = brackets.getModule(\"command/Menus\"),\n        Mustache                = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        PopUpManager            = brackets.getModule(\"widgets/PopUpManager\"),\n        StringUtils             = brackets.getModule(\"utils/StringUtils\"),\n        DocumentManager         = brackets.getModule(\"document/DocumentManager\"),\n        Strings                 = brackets.getModule(\"strings\"),\n        Metrics                 = brackets.getModule(\"utils/Metrics\"),\n        MainViewManager         = brackets.getModule(\"view/MainViewManager\");\n\n    var Git                     = require(\"src/git/Git\"),\n        Events                  = require(\"src/Events\"),\n        EventEmitter            = require(\"src/EventEmitter\"),\n        ErrorHandler            = require(\"src/ErrorHandler\"),\n        Panel                   = require(\"src/Panel\"),\n        Setup                   = require(\"src/utils/Setup\"),\n        Preferences             = require(\"src/Preferences\"),\n        ProgressDialog          = require(\"src/dialogs/Progress\"),\n        Utils                   = require(\"src/Utils\"),\n        branchesMenuTemplate    = `<ul id=\"git-branch-dropdown\" class=\"dropdown-menu\" tabindex=\"-1\">\n    <li>\n        <a class=\"git-branch-new\">\n            <span>{{Strings.CREATE_NEW_BRANCH}}</span>\n        </a>\n    </li>\n\n    {{#branchList.length}}\n    <li class=\"divider\"></li>\n    {{/branchList.length}}\n\n    {{#branchList}}\n    <li>\n        <a class=\"git-branch-link\" data-branch=\"{{name}}\">\n            {{#canDelete}}\n            <span class=\"trash-icon\">&times;</span>\n            {{/canDelete}}\n            <span class=\"merge-branch\"><i title=\"{{Strings.MERGE_BRANCH}}\" class=\"octicon octicon-git-merge\"></i></span>\n            <span class=\"switch-branch\">{{name}}</span>\n        </a>\n    </li>\n    {{/branchList}}\n</ul>\n`,\n        newBranchTemplate       = `<div class=\"modal git\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.CREATE_NEW_BRANCH_TITLE}}</h1>\n    </div>\n    <div class=\"modal-body tab-content\">\n\n        <form>\n            <div>\n                <label>{{Strings.ORIGIN_BRANCH}}:</label>\n                <div>\n                    <div class=\"input-append\">\n                        <select class=\"branchSelect\" name=\"branch-origin\"></select>\n                        <button class=\"btn fetchBranches\" type=\"button\">\n                            <i class=\"octicon octicon-sync\"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div>\n                <label>{{Strings.BRANCH_NAME}}:</label>\n                <div>\n                    <input name=\"branch-name\" type=\"text\" autocomplete=\"off\" spellcheck=\"false\" />\n                </div>\n            </div>\n        </form>\n\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`,\n        mergeBranchTemplate     = `<div class=\"modal git\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.MERGE_BRANCH}} \"{{fromBranch}}\"</h1>\n    </div>\n    <div class=\"modal-body tab-content\">\n        <form>\n            <div>\n                <label>{{Strings.TARGET_BRANCH}}:</label>\n                <div>\n                    <select disabled name=\"branch-target\">\n                        {{#branches}}\n                        <option value=\"{{name}}\" remote=\"{{remote}}\" {{#currentBranch}}selected{{/currentBranch}}>\n                        {{name}}\n                        </option>\n                        {{/branches}}\n                    </select>\n                </div>\n            </div>\n            <div>\n                <label>{{Strings.MERGE_MESSAGE}}:</label>\n                <div>\n                    <div class=\"input-append\">\n                        <input name=\"merge-message\" type=\"text\" placeholder=\"default\" autocomplete=\"off\">\n                        <button class=\"btn fill-pr\" type=\"button\">PR</button>\n                    </div>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"use-rebase\"> {{Strings.USE_REBASE}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"use-noff\"> {{Strings.USE_NOFF}}\n                    </label>\n                </div>\n            </div>\n        </form>\n    </div>\n\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`;\n\n    var $gitBranchName          = $(null),\n        currentEditor,\n        $dropdown;\n\n    function renderList(branches) {\n        branches = branches.map(function (name) {\n            return {\n                name: name,\n                currentBranch: name.indexOf(\"* \") === 0,\n                canDelete: name !== \"master\"\n            };\n        });\n        var templateVars  = {\n            branchList: _.filter(branches, function (o) { return !o.currentBranch; }),\n            Strings:    Strings\n        };\n        return Mustache.render(branchesMenuTemplate, templateVars);\n    }\n\n    function closeDropdown() {\n        if ($dropdown) {\n            PopUpManager.removePopUp($dropdown);\n        }\n        detachCloseEvents();\n    }\n\n    function doMerge(fromBranch) {\n        Git.getBranches().then(function (branches) {\n\n            var compiledTemplate = Mustache.render(mergeBranchTemplate, {\n                fromBranch: fromBranch,\n                branches: branches,\n                Strings: Strings\n            });\n\n            var dialog  = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n            var $dialog = dialog.getElement();\n            $dialog.find(\"input\").focus();\n\n            var $toBranch = $dialog.find(\"[name='branch-target']\");\n            var $useRebase = $dialog.find(\"[name='use-rebase']\");\n            var $useNoff = $dialog.find(\"[name='use-noff']\");\n\n            if (fromBranch === \"master\") {\n                $useRebase.prop(\"checked\", true);\n            }\n            if ($toBranch.val() === \"master\") {\n                $useRebase.prop(\"checked\", false).prop(\"disabled\", true);\n            }\n\n            // fill merge message if possible\n            var $mergeMessage = $dialog.find(\"[name='merge-message']\");\n            $mergeMessage.attr(\"placeholder\", \"Merge branch '\" + fromBranch + \"'\");\n            $dialog.find(\".fill-pr\").on(\"click\", function () {\n                var prMsg = \"Merge pull request #??? from \" + fromBranch;\n                $mergeMessage.val(prMsg);\n                $mergeMessage[0].setSelectionRange(prMsg.indexOf(\"???\"), prMsg.indexOf(\"???\") + 3);\n            });\n\n            // can't use rebase and no-ff together so have a change handler for this\n            $useRebase.on(\"change\", function () {\n                var useRebase = $useRebase.prop(\"checked\");\n                $useNoff.prop(\"disabled\", useRebase);\n                if (useRebase) { $useNoff.prop(\"checked\", false); }\n            }).trigger(\"change\");\n\n            dialog.done(function (buttonId) {\n                // right now only merge to current branch without any configuration\n                // later delete merge branch and so ...\n                var useRebase = $useRebase.prop(\"checked\");\n                var useNoff = $useNoff.prop(\"checked\");\n                var mergeMsg = $mergeMessage.val();\n\n                if (buttonId === \"ok\") {\n\n                    if (useRebase) {\n\n                        Git.rebaseInit(fromBranch).catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'rebase', \"fail\");\n                            throw ErrorHandler.showError(err, Strings.ERROR_REBASE_FAILED);\n                        }).then(function (stdout) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'rebase', \"success\");\n                            Utils.showOutput(stdout || Strings.GIT_REBASE_SUCCESS, Strings.REBASE_RESULT).finally(function () {\n                                EventEmitter.emit(Events.REFRESH_ALL);\n                            });\n                        }).catch(console.error);\n                    } else {\n\n                        Git.mergeBranch(fromBranch, mergeMsg, useNoff).catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'merge', \"fail\");\n                            throw ErrorHandler.showError(err, Strings.ERROR_MERGE_FAILED);\n                        }).then(function (stdout) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'merge', \"success\");\n                            Utils.showOutput(stdout || Strings.GIT_MERGE_SUCCESS, Strings.MERGE_RESULT).finally(function () {\n                                EventEmitter.emit(Events.REFRESH_ALL);\n                            });\n                        }).catch(console.error);\n                    }\n                }\n            });\n        }).catch(err => {\n            console.error(\"Error Getting branches\", err);\n            // we need to strip all user entered info from git thrown exception for get branches which shouldn't fail,\n            // so we throw a blank error for bugsnag\n            throw new Error(\"Failed to get getBranches while doMerge\");\n        });\n    }\n\n    function _reloadBranchSelect($el, branches) {\n        var template = \"{{#branches}}<option value='{{name}}' remote='{{remote}}' \" +\n            \"{{#currentBranch}}selected{{/currentBranch}}>{{name}}</option>{{/branches}}\";\n        var html = Mustache.render(template, { branches: branches });\n        $el.html(html);\n    }\n\n    function closeNotExistingFiles(oldBranchName, newBranchName) {\n        return Git.getDeletedFiles(oldBranchName, newBranchName).then(function (deletedFiles) {\n\n            var gitRoot     = Preferences.get(\"currentGitRoot\"),\n                openedFiles = MainViewManager.getWorkingSet(MainViewManager.ALL_PANES);\n\n            // Close files that does not exists anymore in the new selected branch\n            deletedFiles.forEach(function (dFile) {\n                var oFile = _.find(openedFiles, function (oFile) {\n                    return oFile.fullPath === gitRoot + dFile;\n                });\n                if (oFile) {\n                    DocumentManager.closeFullEditor(oFile);\n                }\n            });\n\n            EventEmitter.emit(Events.REFRESH_ALL);\n\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GETTING_DELETED_FILES);\n        });\n    }\n\n    function handleEvents() {\n        $dropdown.on(\"click\", \"a.git-branch-new\", function (e) {\n            e.stopPropagation();\n            closeDropdown();\n\n            Git.getAllBranches().catch(function (err) {\n                ErrorHandler.showError(err);\n            }).then(function (branches = []) {\n\n                var compiledTemplate = Mustache.render(newBranchTemplate, {\n                    branches: branches,\n                    Strings: Strings\n                });\n\n                var dialog  = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n\n                var $input  = dialog.getElement().find(\"[name='branch-name']\"),\n                    $select = dialog.getElement().find(\".branchSelect\");\n\n                $select.on(\"change\", function () {\n                    if (!$input.val()) {\n                        var $opt = $select.find(\":selected\"),\n                            remote = $opt.attr(\"remote\"),\n                            newVal = $opt.val();\n                        if (remote) {\n                            newVal = newVal.substring(remote.length + 1);\n                            if (remote !== \"origin\") {\n                                newVal = remote + \"#\" + newVal;\n                            }\n                        }\n                        $input.val(newVal);\n                    }\n                });\n\n                _reloadBranchSelect($select, branches);\n                dialog.getElement().find(\".fetchBranches\").on(\"click\", function () {\n                    var $this = $(this);\n                    const tracker = ProgressDialog.newProgressTracker();\n                    ProgressDialog.show(Git.fetchAllRemotes(tracker), tracker)\n                        .then(function () {\n                            return Git.getAllBranches().then(function (branches) {\n                                $this.prop(\"disabled\", true).attr(\"title\", \"Already fetched\");\n                                _reloadBranchSelect($select, branches);\n                            });\n                        }).catch(function (err) {\n                            throw ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE_INFO);\n                        });\n                });\n\n                dialog.getElement().find(\"input\").focus();\n                dialog.done(function (buttonId) {\n                    if (buttonId === \"ok\") {\n\n                        var $dialog     = dialog.getElement(),\n                            branchName  = $dialog.find(\"input[name='branch-name']\").val().trim(),\n                            $option     = $dialog.find(\"select[name='branch-origin']\").children(\"option:selected\"),\n                            originName  = $option.val(),\n                            isRemote    = $option.attr(\"remote\"),\n                            track       = !!isRemote;\n\n                        Git.createBranch(branchName, originName, track).catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"createFail\");\n                            throw ErrorHandler.showError(err, Strings.ERROR_CREATE_BRANCH);\n                        }).then(function () {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"create\");\n                            EventEmitter.emit(Events.REFRESH_ALL);\n                        });\n                    }\n                });\n            });\n\n        }).on(\"mouseenter\", \"a\", function () {\n            $(this).addClass(\"selected\");\n        }).on(\"mouseleave\", \"a\", function () {\n            $(this).removeClass(\"selected\");\n        }).on(\"click\", \"a.git-branch-link .trash-icon\", function (e) {\n            e.stopPropagation();\n            closeDropdown();\n            var branchName = $(this).parent().data(\"branch\");\n            Utils.askQuestion(Strings.DELETE_LOCAL_BRANCH,\n                              StringUtils.format(Strings.DELETE_LOCAL_BRANCH_NAME, branchName),\n                              { booleanResponse: true })\n                .then(function (response) {\n                    if (response === true) {\n                        return Git.branchDelete(branchName).catch(function (err) {\n\n                            return Utils.showOutput(err, \"Branch deletion failed\", {\n                                question: \"Do you wish to force branch deletion?\"\n                            }).then(function (response) {\n                                if (response === true) {\n                                    return Git.forceBranchDelete(branchName).then(function (output) {\n                                        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"delete\");\n                                        return Utils.showOutput(output || Strings.GIT_BRANCH_DELETE_SUCCESS);\n                                    }).catch(function (err) {\n                                        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"deleteFail\");\n                                        ErrorHandler.showError(err, Strings.ERROR_BRANCH_DELETE_FORCED);\n                                    });\n                                }\n                            });\n\n                        });\n                    }\n                })\n                .catch(function (err) {\n                    ErrorHandler.showError(err);\n                });\n\n        }).on(\"click\", \".merge-branch\", function (e) {\n            e.stopPropagation();\n            closeDropdown();\n            var fromBranch = $(this).parent().data(\"branch\");\n            doMerge(fromBranch);\n        }).on(\"click\", \"a.git-branch-link\", function (e) {\n\n            e.stopPropagation();\n            closeDropdown();\n            var newBranchName = $(this).data(\"branch\");\n\n            Git.getCurrentBranchName().then(function (oldBranchName) {\n                Git.checkout(newBranchName).then(function () {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"switch\");\n                    return closeNotExistingFiles(oldBranchName, newBranchName);\n                }).catch(function (err) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"switchFail\");\n                    ErrorHandler.showError(err, Strings.ERROR_SWITCHING_BRANCHES);\n                });\n            }).catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"switchFail\");\n                ErrorHandler.showError(err, Strings.ERROR_GETTING_CURRENT_BRANCH);\n            });\n\n        });\n    }\n\n    function attachCloseEvents() {\n        $(\"html\").on(\"click\", closeDropdown);\n        $(\"#project-files-container\").on(\"scroll\", closeDropdown);\n        $(\"#titlebar .nav\").on(\"click\", closeDropdown);\n\n        currentEditor = EditorManager.getCurrentFullEditor();\n        if (currentEditor) {\n            currentEditor._codeMirror.on(\"focus\", closeDropdown);\n        }\n\n        // $(window).on(\"keydown\", keydownHook);\n    }\n\n    function detachCloseEvents() {\n        $(\"html\").off(\"click\", closeDropdown);\n        $(\"#project-files-container\").off(\"scroll\", closeDropdown);\n        $(\"#titlebar .nav\").off(\"click\", closeDropdown);\n\n        if (currentEditor) {\n            currentEditor._codeMirror.off(\"focus\", closeDropdown);\n        }\n\n        // $(window).off(\"keydown\", keydownHook);\n\n        $dropdown = null;\n    }\n\n    function toggleDropdown(e) {\n        e.stopPropagation();\n\n        // If the dropdown is already visible, close it\n        if ($dropdown) {\n            closeDropdown();\n            return;\n        }\n\n        Menus.closeAll();\n\n        Git.getBranches().catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GETTING_BRANCH_LIST);\n        }).then(function (branches = []) {\n            branches = branches.reduce(function (arr, branch) {\n                if (!branch.currentBranch && !branch.remote) {\n                    arr.push(branch.name);\n                }\n                return arr;\n            }, []);\n\n            $dropdown = $(renderList(branches));\n            const $toggle = $(\"#git-branch-dropdown-toggle\");\n            // two margins to account for the preceding project dropdown as well\n            const marginLeft = (parseInt($toggle.css(\"margin-left\"), 10) * 2) || 0;\n\n            const toggleOffset = $toggle.offset();\n\n            $dropdown\n                .css({\n                    left: toggleOffset.left - marginLeft + 3,\n                    top: toggleOffset.top + $toggle.outerHeight() - 3\n                })\n                .appendTo($(\"body\"));\n\n            // fix so it doesn't overflow the screen\n            var maxHeight = $dropdown.parent().height(),\n                height = $dropdown.height(),\n                topOffset = $dropdown.position().top;\n            if (height + topOffset >= maxHeight - 10) {\n                $dropdown.css(\"bottom\", \"10px\");\n            }\n\n            PopUpManager.addPopUp($dropdown, detachCloseEvents, true, {closeCurrentPopups: true});\n            PopUpManager.handleSelectionEvents($dropdown, {enableSearchFilter: true});\n            attachCloseEvents();\n            handleEvents();\n        });\n    }\n\n    function _getHeadFilePath() {\n        return Preferences.get(\"currentGitRoot\") + \".git/HEAD\";\n    }\n\n    function addHeadToTheFileIndex() {\n        FileSystem.resolve(_getHeadFilePath(), function (err) {\n            if (err) {\n                ErrorHandler.logError(err, \"Resolving .git/HEAD file failed\");\n                return;\n            }\n        });\n    }\n\n    function checkBranch() {\n        FileSystem.getFileForPath(_getHeadFilePath()).read(function (err, contents) {\n            if (err) {\n                ErrorHandler.showError(err, Strings.ERROR_READING_GIT_HEAD);\n                return;\n            }\n\n            contents = contents.trim();\n\n            var m = contents.match(/^ref:\\s+refs\\/heads\\/(\\S+)/);\n\n            // alternately try to parse the hash\n            if (!m) { m = contents.match(/^([a-f0-9]{40})$/); }\n\n            if (!m) {\n                ErrorHandler.showError(new Error(StringUtils.format(Strings.ERROR_PARSING_BRANCH_NAME, contents)));\n                return;\n            }\n\n            var branchInHead  = m[1],\n                branchInUi    = $gitBranchName.text();\n\n            if (branchInHead !== branchInUi) {\n                refresh();\n            }\n        });\n    }\n\n    function refresh() {\n        if ($gitBranchName.length === 0) { return; }\n\n        // show info that branch is refreshing currently\n        $gitBranchName\n            .text(\"\\u2026\")\n            .parent()\n                .show();\n\n        return Git.getGitRoot().then(function (gitRoot) {\n            var projectRoot             = Utils.getProjectRoot(),\n                isRepositoryRootOrChild = gitRoot && projectRoot.indexOf(gitRoot) === 0;\n\n            $gitBranchName.parent().toggle(isRepositoryRootOrChild);\n\n            if (!isRepositoryRootOrChild) {\n                Preferences.set(\"currentGitRoot\", projectRoot);\n                Preferences.set(\"currentGitSubfolder\", \"\");\n\n                $gitBranchName\n                    .off(\"click\")\n                    .text(\"not a git repo\");\n                Panel.disable(\"not-repo\");\n\n                return;\n            }\n\n            Preferences.set(\"currentGitRoot\", gitRoot);\n            Preferences.set(\"currentGitSubfolder\", projectRoot.substring(gitRoot.length));\n\n            // we are in a .git repo so read the head\n            addHeadToTheFileIndex();\n\n            return Git.getCurrentBranchName().then(function (branchName) {\n\n                Git.getMergeInfo().then(function (mergeInfo) {\n\n                    if (mergeInfo.mergeMode) {\n                        branchName += \"|MERGING\";\n                    }\n\n                    if (mergeInfo.rebaseMode) {\n                        if (mergeInfo.rebaseHead) {\n                            branchName = mergeInfo.rebaseHead;\n                        }\n                        branchName += \"|REBASE\";\n                        if (mergeInfo.rebaseNext && mergeInfo.rebaseLast) {\n                            branchName += \"(\" + mergeInfo.rebaseNext + \"/\" + mergeInfo.rebaseLast + \")\";\n                        }\n                    }\n\n                    EventEmitter.emit(Events.REBASE_MERGE_MODE, mergeInfo.rebaseMode, mergeInfo.mergeMode);\n\n                    var MAX_LEN = 18;\n\n                    const tooltip = StringUtils.format(Strings.ON_BRANCH, branchName);\n                    const html = `<i class=\"fas fa-code-branch\"></i> ${\n                        branchName.length > MAX_LEN ? branchName.substring(0, MAX_LEN) + \"\\u2026\" : branchName\n                    }`;\n                    $gitBranchName\n                        .html(html)\n                        .attr(\"title\", tooltip)\n                        .off(\"click\")\n                        .on(\"click\", toggleDropdown);\n                    Panel.enable();\n\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_READING_GIT_STATE);\n                });\n\n            }).catch(function (ex) {\n                if (ErrorHandler.contains(ex, \"unknown revision\")) {\n                    $gitBranchName\n                        .off(\"click\")\n                        .text(\"no branch\");\n                    Panel.enable();\n                } else {\n                    throw ex;\n                }\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err);\n        });\n    }\n\n    function init() {\n        // Add branch name to project tree\n        const $html = $(`<div id='git-branch-dropdown-toggle' class='btn-alt-quiet'>\n            <span id='git-branch'>\n                <i class=\"fas fa-code-branch\"></i>\n            </span>\n            <span class=\"dropdown-arrow\"></span>\n            </div>`);\n        $html.appendTo($(\"#project-files-header\"));\n        $gitBranchName = $(\"#git-branch\");\n        $html.on(\"click\", function () {\n            $gitBranchName.click();\n            return false;\n        });\n        if(Setup.isExtensionActivated()){\n            refresh();\n            return;\n        }\n        $(\"#git-branch-dropdown-toggle\").addClass(\"forced-inVisible\");\n    }\n\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (file) {\n        if (file.fullPath === _getHeadFilePath()) {\n            checkBranch();\n        }\n    });\n\n    EventEmitter.on(Events.REFRESH_ALL, function () {\n        FileSyncManager.syncOpenDocuments();\n        CommandManager.execute(\"file.refresh\");\n        refresh();\n    });\n\n    EventEmitter.on(Events.BRACKETS_PROJECT_CHANGE, function () {\n        refresh();\n    });\n\n    EventEmitter.on(Events.BRACKETS_PROJECT_REFRESH, function () {\n        refresh();\n    });\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        $(\"#git-branch-dropdown-toggle\").removeClass(\"forced-inVisible\");\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        $(\"#git-branch-dropdown-toggle\").addClass(\"forced-inVisible\");\n    });\n\n    exports.init    = init;\n    exports.refresh = refresh;\n\n});\n\n/*globals logger, fs*/\ndefine(\"src/Cli\", function (require, exports, module) {\n\n    const NodeConnector = brackets.getModule('NodeConnector');\n\n    const ErrorHandler  = require(\"src/ErrorHandler\"),\n        Preferences   = require(\"src/Preferences\"),\n        Events        = require(\"src/Events\"),\n        Utils         = require(\"src/Utils\");\n\n    let gitTimeout        = Preferences.get(\"gitTimeout\") * 1000,\n        nextCliId         = 0,\n        deferredMap       = {};\n\n    Preferences.getExtensionPref().on(\"change\", \"gitTimeout\", ()=>{\n        gitTimeout = Preferences.get(\"gitTimeout\") * 1000;\n    });\n\n    // Constants\n    var MAX_COUNTER_VALUE = 4294967295; // 2^32 - 1\n\n    let gitNodeConnector = NodeConnector.createNodeConnector(\"phcode-git-core\", exports);\n    gitNodeConnector.on(Events.GIT_PROGRESS_EVENT, (_event, evtData) => {\n        const deferred = deferredMap[evtData.cliId];\n        if(!deferred){\n            ErrorHandler.logError(\"Progress sent for a non-existing process(\" + evtData.cliId + \"): \" + evtData);\n            return;\n        }\n        if (!deferred.isResolved && deferred.progressTracker) {\n            deferred.progressTracker.trigger(Events.GIT_PROGRESS_EVENT, evtData.data);\n        }\n    });\n\n    function getNextCliId() {\n        if (nextCliId >= MAX_COUNTER_VALUE) {\n            nextCliId = 0;\n        }\n        return ++nextCliId;\n    }\n\n    function normalizePathForOs(path) {\n        if (brackets.platform === \"win\") {\n            path = path.replace(/\\//g, \"\\\\\");\n        }\n        return path;\n    }\n\n    // this functions prevents sensitive info from going further (like http passwords)\n    function sanitizeOutput(str) {\n        if (typeof str !== \"string\") {\n            if (str != null) { // checks for both null & undefined\n                str = str.toString();\n            } else {\n                str = \"\";\n            }\n        }\n        return str;\n    }\n\n    function logDebug(opts, debugInfo, method, type, out) {\n        if (!logger.loggingOptions.logGit) {\n            return;\n        }\n        var processInfo = [];\n\n        var duration = (new Date()).getTime() - debugInfo.startTime;\n        processInfo.push(duration + \"ms\");\n\n        if (opts.cliId) {\n            processInfo.push(\"ID=\" + opts.cliId);\n        }\n\n        var msg = \"cmd-\" + method + \"-\" + type + \" (\" + processInfo.join(\";\") + \")\";\n        if (out) { msg += \": \\\"\" + out + \"\\\"\"; }\n        Utils.consoleDebug(msg);\n    }\n\n    function cliHandler(method, cmd, args, opts, retry) {\n        const cliPromise = new Promise((resolve, reject)=>{\n            const cliId     = getNextCliId();\n            args = args || [];\n            opts = opts || {};\n            const progressTracker = opts.progressTracker;\n\n            const savedDefer = {resolve, reject, progressTracker};\n            deferredMap[cliId] = savedDefer;\n\n            const watchProgress = !!progressTracker || (args.indexOf(\"--progress\") !== -1);\n            const startTime = (new Date()).getTime();\n\n            // it is possible to set a custom working directory in options\n            // otherwise the current project root is used to execute commands\n            if (!opts.cwd) {\n                opts.cwd = fs.getTauriPlatformPath(Preferences.get(\"currentGitRoot\") || Utils.getProjectRoot());\n            }\n\n            // convert paths like c:/foo/bar to c:\\foo\\bar on windows\n            opts.cwd = normalizePathForOs(opts.cwd);\n\n            // log all cli communication into console when debug mode is on\n            Utils.consoleDebug(\"cmd-\" + method + (watchProgress ? \"-watch\" : \"\") + \": \" +\n                opts.cwd + \" -> \" +\n                cmd + \" \" + args.join(\" \"));\n\n            let resolved      = false,\n                timeoutLength = opts.timeout ? (opts.timeout * 1000) : gitTimeout;\n\n            const domainOpts = {\n                cliId: cliId,\n                watchProgress: watchProgress\n            };\n\n            const debugInfo = {\n                startTime: startTime\n            };\n\n            if (watchProgress && progressTracker) {\n                progressTracker.trigger(Events.GIT_PROGRESS_EVENT,\n                    \"Running command: git \" + args.join(\" \"));\n            }\n\n            gitNodeConnector.execPeer(method, {directory: opts.cwd, command: cmd, args: args, opts: domainOpts})\n                .catch(function (err) {\n                    if (!resolved) {\n                        err = sanitizeOutput(err);\n                        logDebug(domainOpts, debugInfo, method, \"fail\", err);\n                        delete deferredMap[cliId];\n\n                        err = ErrorHandler.toError(err);\n\n                        // spawn ENOENT error\n                        var invalidCwdErr = \"spawn ENOENT\";\n                        if (err.stack && err.stack.indexOf(invalidCwdErr)) {\n                            err.message = err.message.replace(invalidCwdErr, invalidCwdErr + \" (\" + opts.cwd + \")\");\n                            err.stack = err.stack.replace(invalidCwdErr, invalidCwdErr + \" (\" + opts.cwd + \")\");\n                        }\n\n                        // socket was closed so we should try this once again (if not already retrying)\n                        if (err.stack && err.stack.indexOf(\"WebSocket.self._ws.onclose\") !== -1 && !retry) {\n                            cliHandler(method, cmd, args, opts, true)\n                                .then(function (response) {\n                                    savedDefer.isResolved = true;\n                                    resolve(response);\n                                })\n                                .catch(function (err) {\n                                    reject(err);\n                                });\n                            return;\n                        }\n\n                        reject(err);\n                    }\n                })\n                .then(function (out) {\n                    if (!resolved) {\n                        out = sanitizeOutput(out);\n                        logDebug(domainOpts, debugInfo, method, \"out\", out);\n                        delete deferredMap[cliId];\n                        resolve(out);\n                    }\n                })\n                .finally(function () {\n                    progressTracker && progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.${cliId}`);\n                    resolved = true;\n                });\n\n            function timeoutPromise() {\n                logDebug(domainOpts, debugInfo, method, \"timeout\");\n                var err = new Error(\"cmd-\" + method + \"-timeout: \" + cmd + \" \" + args.join(\" \"));\n                if (!opts.timeoutExpected) {\n                    ErrorHandler.logError(err);\n                }\n\n                // process still lives and we need to kill it\n                gitNodeConnector.execPeer(\"kill\", domainOpts.cliId)\n                    .catch(function (err) {\n                        ErrorHandler.logError(err);\n                    });\n\n                delete deferredMap[cliId];\n                reject(ErrorHandler.toError(err));\n                resolved = true;\n                progressTracker && progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.${cliId}`);\n            }\n\n            var lastProgressTime = 0;\n            function timeoutCall() {\n                setTimeout(function () {\n                    if (!resolved) {\n                        if (domainOpts.watchProgress) {\n                            // we are watching the promise progress\n                            // so we should check if the last message was sent in more than timeout time\n                            const currentTime = (new Date()).getTime();\n                            const diff = currentTime - lastProgressTime;\n                            if (diff > timeoutLength) {\n                                Utils.consoleDebug(\"cmd(\" + cliId + \") - last progress message was sent \" + diff + \"ms ago - timeout\");\n                                timeoutPromise();\n                            } else {\n                                Utils.consoleDebug(\"cmd(\" + cliId + \") - last progress message was sent \" + diff + \"ms ago - delay\");\n                                timeoutCall();\n                            }\n                        } else {\n                            // we don't have any custom handler, so just kill the promise here\n                            // note that command WILL keep running in the background\n                            // so even when timeout occurs, operation might finish after it\n                            timeoutPromise();\n                        }\n                    }\n                }, timeoutLength);\n            }\n\n            // when opts.timeout === false then never timeout the process\n            if (opts.timeout !== false) {\n                // if we are watching for progress events, mark the time when last progress was made\n                if (domainOpts.watchProgress && progressTracker) {\n                    progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.${cliId}`);\n                    progressTracker.on(`${Events.GIT_PROGRESS_EVENT}.${cliId}`, function () {\n                        lastProgressTime = (new Date()).getTime();\n                    });\n                }\n                // call the method which will timeout the promise after a certain period of time\n                timeoutCall();\n            }\n        });\n        return cliPromise;\n    }\n\n    function which(cmd) {\n        return cliHandler(\"which\", cmd);\n    }\n\n    function spawnCommand(cmd, args, opts) {\n        return cliHandler(\"spawn\", cmd, args, opts);\n    }\n\n    // Public API\n    exports.cliHandler      = cliHandler;\n    exports.which           = which;\n    exports.spawnCommand    = spawnCommand;\n});\n\n/*jslint plusplus: true, vars: true, nomen: true */\n/*global $, brackets, define */\n\ndefine(\"src/CloseNotModified\", function (require, exports) {\n\n    const DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        Commands        = brackets.getModule(\"command/Commands\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        Strings         = brackets.getModule(\"strings\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\");\n\n    const Events      = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        Git           = require(\"src/git/Git\"),\n        Preferences   = require(\"src/Preferences\"),\n        Constants     = require(\"src/Constants\"),\n        Utils         = require(\"src/Utils\");\n\n    let closeUnmodifiedCmd;\n\n    function handleCloseNotModified() {\n        Git.status().then(function (modifiedFiles) {\n            var openFiles      = MainViewManager.getWorkingSet(MainViewManager.ALL_PANES),\n                currentGitRoot = Preferences.get(\"currentGitRoot\");\n\n            openFiles.forEach(function (openFile) {\n                var removeOpenFile = true;\n                modifiedFiles.forEach(function (modifiedFile) {\n                    if (currentGitRoot + modifiedFile.file === openFile.fullPath) {\n                        removeOpenFile = false;\n                    }\n                });\n\n                if (removeOpenFile) {\n                    // check if file doesn't have any unsaved changes\n                    const doc = DocumentManager.getOpenDocumentForPath(openFile.fullPath);\n                    // document will not  be present for images, or if the file is in working set but\n                    // no editor is attached yet(eg. session restore on app start)\n                    if (!doc || !doc.isDirty) {\n                        CommandManager.execute(Commands.FILE_CLOSE_LIST, {PaneId: MainViewManager.ALL_PANES, fileList: [openFile]});\n                    }\n                }\n            });\n\n            MainViewManager.focusActivePane();\n        });\n    }\n\n    function init() {\n        closeUnmodifiedCmd       = CommandManager.register(Strings.CMD_CLOSE_UNMODIFIED,\n            Constants.CMD_GIT_CLOSE_UNMODIFIED, handleCloseNotModified);\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, false);\n    }\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, true);\n    });\n\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, false);\n    });\n\n    // Public API\n    exports.init = init;\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\ndefine(\"src/Constants\", function (require, exports) {\n    const Commands = brackets.getModule(\"command/Commands\"),\n        Menus = brackets.getModule(\"command/Menus\");\n\n    exports.GIT_STRING_UNIVERSAL = \"Git\";\n    exports.GIT_SUB_MENU = Menus.SubMenuIds.GIT_SUB_MENU;\n\n    // Menus\n    exports.GIT_PANEL_CHANGES_CMENU = \"git-panel-changes-cmenu\";\n    exports.GIT_PANEL_HISTORY_CMENU = \"git-panel-history-cmenu\";\n    exports.GIT_PANEL_OPTIONS_CMENU = \"git-panel-options-cmenu\";\n\n    // commands\n    exports.CMD_GIT_INIT = Commands.CMD_GIT_INIT;\n    exports.CMD_GIT_CLONE = Commands.CMD_GIT_CLONE;\n    exports.CMD_GIT_CLONE_WITH_URL = Commands.CMD_GIT_CLONE_WITH_URL;\n    exports.CMD_GIT_SETTINGS_COMMAND_ID = Commands.CMD_GIT_SETTINGS_COMMAND_ID;\n    exports.CMD_GIT_CLOSE_UNMODIFIED = Commands.CMD_GIT_CLOSE_UNMODIFIED;\n    exports.CMD_GIT_CHECKOUT = Commands.CMD_GIT_CHECKOUT;\n    exports.CMD_GIT_RESET_HARD = Commands.CMD_GIT_RESET_HARD;\n    exports.CMD_GIT_RESET_SOFT = Commands.CMD_GIT_RESET_SOFT;\n    exports.CMD_GIT_RESET_MIXED = Commands.CMD_GIT_RESET_MIXED;\n    exports.CMD_GIT_TOGGLE_PANEL = Commands.CMD_GIT_TOGGLE_PANEL;\n    exports.CMD_GIT_GOTO_NEXT_CHANGE = Commands.CMD_GIT_GOTO_NEXT_CHANGE;\n    exports.CMD_GIT_GOTO_PREVIOUS_CHANGE = Commands.CMD_GIT_GOTO_PREVIOUS_CHANGE;\n    exports.CMD_GIT_COMMIT_CURRENT = Commands.CMD_GIT_COMMIT_CURRENT;\n    exports.CMD_GIT_COMMIT_ALL = Commands.CMD_GIT_COMMIT_ALL;\n    exports.CMD_GIT_FETCH = Commands.CMD_GIT_FETCH;\n    exports.CMD_GIT_PULL = Commands.CMD_GIT_PULL;\n    exports.CMD_GIT_PUSH = Commands.CMD_GIT_PUSH;\n    exports.CMD_GIT_REFRESH = Commands.CMD_GIT_REFRESH;\n    exports.CMD_GIT_TAG = Commands.CMD_GIT_TAG;\n    exports.CMD_GIT_DISCARD_ALL_CHANGES = Commands.CMD_GIT_DISCARD_ALL_CHANGES;\n    exports.CMD_GIT_UNDO_LAST_COMMIT = Commands.CMD_GIT_UNDO_LAST_COMMIT;\n    exports.CMD_GIT_CHANGE_USERNAME = Commands.CMD_GIT_CHANGE_USERNAME;\n    exports.CMD_GIT_CHANGE_EMAIL = Commands.CMD_GIT_CHANGE_EMAIL;\n    exports.CMD_GIT_GERRIT_PUSH_REF = Commands.CMD_GIT_GERRIT_PUSH_REF;\n    exports.CMD_GIT_AUTHORS_OF_SELECTION = Commands.CMD_GIT_AUTHORS_OF_SELECTION;\n    exports.CMD_GIT_AUTHORS_OF_FILE = Commands.CMD_GIT_AUTHORS_OF_FILE;\n    exports.CMD_GIT_TOGGLE_UNTRACKED = Commands.CMD_GIT_TOGGLE_UNTRACKED;\n});\n\ndefine(\"src/ErrorHandler\", function (require, exports) {\n\n    const Dialogs                    = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache                   = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics                    = brackets.getModule(\"utils/Metrics\"),\n        Strings                    = brackets.getModule(\"strings\"),\n        Utils                      = require(\"src/Utils\"),\n        errorDialogTemplate        = `<div id=\"git-error-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.BRACKETS_GIT_ERROR}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <h3>{{title}}</h3>\n        <pre>{{body}}</pre>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\"  class=\"primary dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n    </div>\n</div>\n`;\n\n    function errorToString(err) {\n        return Utils.encodeSensitiveInformation(err.toString());\n    }\n\n    exports.isTimeout = function (err) {\n        return err instanceof Error && (\n            err.message.indexOf(\"cmd-execute-timeout\") === 0 ||\n            err.message.indexOf(\"cmd-spawn-timeout\") === 0\n        );\n    };\n\n    exports.equals = function (err, what) {\n        return err.toString().toLowerCase() === what.toLowerCase();\n    };\n\n    exports.contains = function (err, what) {\n        return err.toString().toLowerCase().indexOf(what.toLowerCase()) !== -1;\n    };\n\n    exports.matches = function (err, regExp) {\n        return err.toString().match(regExp);\n    };\n\n    exports.logError = function (err) {\n        const msg = err && err.stack ? err.stack : err;\n        Utils.consoleError(\"[brackets-git] \" + msg);\n        return err;\n    };\n\n    /**\n     *\n     * @param err\n     * @param title\n     * @param {dontStripError: boolean, errorMetric: string} options\n     */\n    exports.showError = function (err, title, options = {}) {\n        const dontStripError = options.dontStripError;\n        const errorMetric = options.errorMetric;\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'dialogErr', errorMetric || \"Show\");\n        if (err.__shown) { return err; }\n\n        exports.logError(err);\n\n        let errorBody,\n            errorStack;\n\n        if (typeof err === \"string\") {\n            errorBody = err;\n        } else if (err instanceof Error) {\n            errorBody = dontStripError ? err.toString() : errorToString(err);\n            errorStack = err.stack || \"\";\n        }\n\n        if (!errorBody || errorBody === \"[object Object]\") {\n            try {\n                errorBody = JSON.stringify(err, null, 4);\n            } catch (e) {\n                errorBody = \"Error can't be stringified by JSON.stringify\";\n            }\n        }\n\n        var compiledTemplate = Mustache.render(errorDialogTemplate, {\n            title: title,\n            body: window.debugMode ? `${errorBody}\\n${errorStack}` : errorBody,\n            Strings: Strings\n        });\n\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n        if (typeof err === \"string\") { err = new Error(err); }\n        err.__shown = true;\n        return err;\n    };\n\n    exports.toError = function (arg) {\n        // FUTURE: use this everywhere and have a custom error class for this extension\n        if (arg instanceof Error) { return arg; }\n        var err = new Error(arg);\n        // TODO: new class for this?\n        err.match = function () {\n            return arg.match.apply(arg, arguments);\n        };\n        return err;\n    };\n\n});\n\ndefine(\"src/EventEmitter\", function (require, exports, module) {\n    const EventDispatcher = brackets.getModule(\"utils/EventDispatcher\"),\n        Metrics = brackets.getModule(\"utils/Metrics\");\n\n    const emInstance = {};\n    EventDispatcher.makeEventDispatcher(emInstance);\n\n    function getEmitter(eventName, optionalMetricToLog) {\n        if (!eventName) {\n            throw new Error(\"no event has been passed to get the emittor!\");\n        }\n        return function () {\n            emit(eventName, ...arguments);\n            if(optionalMetricToLog) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, optionalMetricToLog[0], optionalMetricToLog[1]);\n            }\n        };\n    }\n\n    function emit() {\n        emInstance.trigger(...arguments);\n    }\n\n    function on(eventName, callback) {\n        emInstance.on(eventName, (...args)=>{\n            // Extract everything except the first argument (_event) which is event data we don't use\n            const [, ...rest] = args;\n            callback(...rest);\n        });\n    }\n\n    function one(eventName, callback) {\n        emInstance.one(eventName, (...args)=>{\n            // Extract everything except the first argument (_event) which is event data we don't use\n            const [, ...rest] = args;\n            callback(...rest);\n        });\n    }\n\n    exports.getEmitter = getEmitter;\n    exports.emit = emit;\n    exports.on = on;\n    exports.one = one;\n});\n\ndefine(\"src/Events\", function (require, exports) {\n\n    /**\n     * List of Events to be used in the extension.\n     * Events should be structured by file who emits them.\n     */\n\n    // Brackets events\n    exports.BRACKETS_CURRENT_DOCUMENT_CHANGE = \"brackets_current_document_change\";\n    exports.BRACKETS_PROJECT_CHANGE = \"brackets_project_change\";\n    exports.BRACKETS_PROJECT_REFRESH = \"brackets_project_refresh\";\n    exports.BRACKETS_DOCUMENT_SAVED = \"brackets_document_saved\";\n    exports.BRACKETS_FILE_CHANGED = \"brackets_file_changed\";\n\n    // Git events\n    exports.GIT_PROGRESS_EVENT = \"git_progress\";\n    exports.GIT_USERNAME_CHANGED = \"git_username_changed\";\n    exports.GIT_EMAIL_CHANGED = \"git_email_changed\";\n    exports.GIT_COMMITED = \"git_commited\";\n    exports.GIT_NO_BRANCH_EXISTS = \"git_no_branch_exists\";\n    exports.GIT_CHANGE_USERNAME = \"git_change_username\";\n    exports.GIT_CHANGE_EMAIL = \"git_change_email\";\n\n    // Gerrit events\n    exports.GERRIT_TOGGLE_PUSH_REF = \"gerrit_toggle_push_ref\";\n    exports.GERRIT_PUSH_REF_TOGGLED = \"gerrit_push_ref_toggled\";\n\n    // Startup events\n    exports.REFRESH_ALL = \"git_refresh_all\";\n    exports.GIT_ENABLED = \"git_enabled\";\n    exports.GIT_DISABLED = \"git_disabled\";\n    exports.REBASE_MERGE_MODE = \"rebase_merge_mode\";\n\n    // Panel.js\n    exports.HANDLE_GIT_INIT = \"handle_git_init\";\n    exports.HANDLE_GIT_CLONE = \"handle_git_clone\";\n    exports.HANDLE_GIT_COMMIT = \"handle_git_commit\";\n    exports.HANDLE_FETCH = \"handle_fetch\";\n    exports.HANDLE_PUSH = \"handle_push\";\n    exports.HANDLE_PULL = \"handle_pull\";\n    exports.HANDLE_REMOTE_PICK = \"handle_remote_pick\";\n    exports.HANDLE_REMOTE_DELETE = \"handle_remote_delete\";\n    exports.HANDLE_REMOTE_CREATE = \"handle_remote_create\";\n    exports.HANDLE_FTP_PUSH = \"handle_ftp_push\";\n    exports.HISTORY_SHOW_FILE = \"history_showFile\";\n    exports.HISTORY_SHOW_GLOBAL = \"history_showGlobal\";\n    exports.REFRESH_COUNTERS = \"refresh_counters\";\n    exports.REFRESH_HISTORY = \"refresh_history\";\n\n    // Git results\n    exports.GIT_STATUS_RESULTS = \"git_status_results\";\n\n    // Remotes.js\n    exports.GIT_REMOTE_AVAILABLE = \"git_remote_available\";\n    exports.GIT_REMOTE_NOT_AVAILABLE = \"git_remote_not_available\";\n    exports.REMOTES_REFRESH_PICKER = \"remotes_refresh_picker\";\n    exports.FETCH_STARTED = \"remotes_fetch_started\";\n    exports.FETCH_COMPLETE = \"remotes_fetch_complete\";\n});\n\n/*jslint plusplus: true, vars: true, nomen: true */\n/*global define */\n\ndefine(\"src/ExpectedError\", function (require, exports, module) {\n\n    function ExpectedError() {\n        Error.apply(this, arguments);\n        this.message = arguments[0];\n    }\n    ExpectedError.prototype = new Error();\n    ExpectedError.prototype.name = \"ExpectedError\";\n    ExpectedError.prototype.toString = function () {\n        return this.message;\n    };\n\n    module.exports = ExpectedError;\n});\n\n// this file was composed with a big help from @MiguelCastillo extension Brackets-InteractiveLinter\n// @see https://github.com/MiguelCastillo/Brackets-InteractiveLinter\n\ndefine(\"src/GutterManager\", function (require, exports) {\n\n    // Brackets modules\n    var _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        EditorManager   = brackets.getModule(\"editor/EditorManager\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\"),\n        ErrorHandler    = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"./Preferences\"),\n        Strings             = brackets.getModule(\"strings\");\n\n    var gitAvailable = false,\n        gutterName = \"brackets-git-gutter\",\n        editorsWithGutters = [],\n        openWidgets = [];\n\n    /**\n     * Checks if there's already a gutter marker on the given line;\n     * if not, inserts a blank <div> to prevent an empty gutter spot.\n     */\n    function _addDummyGutterMarkerIfNotExist(cm, line) {\n        var lineInfo = cm.lineInfo(line);\n        if (!lineInfo) {\n            return; // If line is out of range or doc is empty\n        }\n        var gutters = cm.getOption(\"gutters\").slice(0),\n            gutterEnabled = gutters.indexOf(gutterName);\n        if(gutterEnabled === -1){\n            return;\n        }\n        var gutterMarkers = lineInfo.gutterMarkers;\n        var existingMarker = gutterMarkers && gutterMarkers[gutterName];\n        if (!existingMarker) {\n            var dummy = document.createElement(\"div\");\n            dummy.className = \"CodeMirror-gitGutter-none\";\n            cm.setGutterMarker(line, gutterName, dummy);\n        }\n    }\n\n    function _cursorActivity(_evt, editor){\n        // this is to prevent a gutter gap in the active line if there is no color on this line.\n        _addDummyGutterMarkerIfNotExist(editor._codeMirror, editor.getCursorPos().line);\n    }\n\n    EditorManager.on(\"activeEditorChange\", function (event, newEditor, oldEditor) {\n        if(newEditor){\n            newEditor.off(\"cursorActivity.gitGutter\");\n            newEditor.on(\"cursorActivity.gitGutter\", _cursorActivity);\n            _cursorActivity(null, newEditor);\n        }\n        if(oldEditor){\n            oldEditor.off(\"cursorActivity.gitGutter\");\n        }\n    });\n\n    function clearWidgets() {\n        var lines = openWidgets.map(function (mark) {\n            var w = mark.lineWidget;\n            if (w.visible) {\n                w.visible = false;\n                w.widget.clear();\n            }\n            return {\n                cm: mark.cm,\n                line: mark.line\n            };\n        });\n        openWidgets = [];\n        return lines;\n    }\n\n    function clearOld(editor) {\n        var cm = editor._codeMirror;\n        if (!cm) { return; }\n\n        var gutters = cm.getOption(\"gutters\").slice(0),\n            io = gutters.indexOf(gutterName);\n\n        if (io !== -1) {\n            gutters.splice(io, 1);\n            cm.clearGutter(gutterName);\n            cm.setOption(\"gutters\", gutters);\n            cm.off(\"gutterClick\", gutterClick);\n        }\n\n        delete cm.gitGutters;\n\n        clearWidgets();\n    }\n\n    function prepareGutter(editor) {\n        // add our gutter if its not already available\n        var cm = editor._codeMirror;\n\n        var gutters = cm.getOption(\"gutters\").slice(0);\n        if (gutters.indexOf(gutterName) === -1) {\n            gutters.unshift(gutterName);\n            cm.setOption(\"gutters\", gutters);\n            cm.on(\"gutterClick\", gutterClick);\n        }\n\n        if (editorsWithGutters.indexOf(editor) === -1) {\n            editorsWithGutters.push(editor);\n        }\n    }\n\n    function prepareGutters(editors) {\n        editors.forEach(function (editor) {\n            prepareGutter(editor);\n        });\n        // clear the rest\n        var idx = editorsWithGutters.length;\n        while (idx--) {\n            if (editors.indexOf(editorsWithGutters[idx]) === -1) {\n                clearOld(editorsWithGutters[idx]);\n                editorsWithGutters.splice(idx, 1);\n            }\n        }\n    }\n\n    function showGutters(editor, _results) {\n        prepareGutter(editor);\n\n        var cm = editor._codeMirror;\n        cm.gitGutters = _.sortBy(_results, \"line\");\n\n        // get line numbers of currently opened widgets\n        var openBefore = clearWidgets();\n\n        cm.clearGutter(gutterName);\n        cm.gitGutters.forEach(function (obj) {\n            var $marker = $(\"<div>\")\n                            .addClass(gutterName + \"-\" + obj.type + \" gitline-\" + (obj.line + 1))\n                            .html(\"&nbsp;\");\n            cm.setGutterMarker(obj.line, gutterName, $marker[0]);\n        });\n        _cursorActivity(null, editor);\n        // reopen widgets that were opened before refresh\n        openBefore.forEach(function (obj) {\n            gutterClick(obj.cm, obj.line, gutterName);\n        });\n    }\n\n    function gutterClick(cm, lineIndex, gutterId) {\n        if (!cm) {\n            return;\n        }\n\n        if (gutterId !== gutterName && gutterId !== \"CodeMirror-linenumbers\") {\n            return;\n        }\n\n        var mark = _.find(cm.gitGutters, function (o) { return o.line === lineIndex; });\n        if (!mark || mark.type === \"added\") { return; }\n\n        // we need to be able to identify cm instance from any mark\n        mark.cm = cm;\n\n        if (mark.parentMark) { mark = mark.parentMark; }\n\n        if (!mark.lineWidget) {\n            mark.lineWidget = {\n                visible: false,\n                element: $(\"<div class='\" + gutterName + \"-deleted-lines'></div>\")\n            };\n            var $btn = $(\"<button/>\")\n                .addClass(\"brackets-git-gutter-copy-button\")\n                .text(\"R\")\n                .on(\"click\", function () {\n                    var doc = DocumentManager.getCurrentDocument();\n                    doc.replaceRange(mark.content + \"\\n\", {\n                        line: mark.line,\n                        ch: 0\n                    });\n                    CommandManager.execute(\"file.save\");\n                    refresh();\n                });\n            $(\"<pre/>\")\n                .attr(\"style\", \"tab-size:\" + cm.getOption(\"tabSize\"))\n                .text(mark.content || \" \")\n                .append($btn)\n                .appendTo(mark.lineWidget.element);\n        }\n\n        if (mark.lineWidget.visible !== true) {\n            mark.lineWidget.visible = true;\n            mark.lineWidget.widget = cm.addLineWidget(mark.line, mark.lineWidget.element[0], {\n                coverGutter: false,\n                noHScroll: false,\n                above: true,\n                showIfHidden: false\n            });\n            openWidgets.push(mark);\n        } else {\n            mark.lineWidget.visible = false;\n            mark.lineWidget.widget.clear();\n            var io = openWidgets.indexOf(mark);\n            if (io !== -1) {\n                openWidgets.splice(io, 1);\n            }\n        }\n    }\n\n    function getEditorFromPane(paneId) {\n        var currentPath = MainViewManager.getCurrentlyViewedPath(paneId),\n            doc = currentPath && DocumentManager.getOpenDocumentForPath(currentPath);\n        return doc && doc._masterEditor;\n    }\n\n    function processDiffResults(editor, diff) {\n        var added = [],\n            removed = [],\n            modified = [],\n            changesets = diff.split(/\\n@@/).map(function (str) { return \"@@\" + str; });\n\n        // remove part before first\n        changesets.shift();\n\n        changesets.forEach(function (str) {\n            var m = str.match(/^@@ -([,0-9]+) \\+([,0-9]+) @@/);\n            var s1 = m[1].split(\",\");\n            var s2 = m[2].split(\",\");\n\n            // removed stuff\n            var lineRemovedFrom;\n            var lineFrom = parseInt(s2[0], 10);\n            var lineCount = parseInt(s1[1], 10);\n            if (isNaN(lineCount)) { lineCount = 1; }\n            if (lineCount > 0) {\n                lineRemovedFrom = lineFrom - 1;\n                removed.push({\n                    type: \"removed\",\n                    line: lineRemovedFrom,\n                    content: str.split(\"\\n\")\n                                .filter(function (l) { return l.indexOf(\"-\") === 0; })\n                                .map(function (l) { return l.substring(1); })\n                                .join(\"\\n\")\n                });\n            }\n\n            // added stuff\n            lineFrom = parseInt(s2[0], 10);\n            lineCount = parseInt(s2[1], 10);\n            if (isNaN(lineCount)) { lineCount = 1; }\n            var isModifiedMark = false;\n            var firstAddedMark = false;\n            for (var i = lineFrom, lineTo = lineFrom + lineCount; i < lineTo; i++) {\n                var lineNo = i - 1;\n                if (lineNo === lineRemovedFrom) {\n                    // modified\n                    var o = removed.pop();\n                    o.type = \"modified\";\n                    modified.push(o);\n                    isModifiedMark = o;\n                } else {\n                    var mark = {\n                        type: isModifiedMark ? \"modified\" : \"added\",\n                        line: lineNo,\n                        parentMark: isModifiedMark || firstAddedMark || null\n                    };\n                    if (!isModifiedMark && !firstAddedMark) {\n                        firstAddedMark = mark;\n                    }\n                    // added new\n                    added.push(mark);\n                }\n            }\n        });\n\n        // fix displaying of removed lines\n        removed.forEach(function (o) {\n            o.line = o.line + 1;\n        });\n\n        showGutters(editor, [].concat(added, removed, modified));\n    }\n\n    function refresh() {\n        if (!gitAvailable) {\n            return;\n        }\n\n        if (!Preferences.get(\"useGitGutter\")) {\n            return;\n        }\n\n        var currentGitRoot = Preferences.get(\"currentGitRoot\");\n\n        // we get a list of editors, which need to be refreshed\n        var editors = _.compact(_.map(MainViewManager.getPaneIdList(), function (paneId) {\n            return getEditorFromPane(paneId);\n        }));\n\n        // we create empty gutters in all of these editors, all other editors lose their gutters\n        prepareGutters(editors);\n\n        // now we launch a diff to fill the gutters in our editors\n        editors.forEach(function (editor) {\n\n            var currentFilePath = null;\n\n            if (editor.document && editor.document.file) {\n                currentFilePath = editor.document.file.fullPath;\n            }\n\n            if (currentFilePath.indexOf(currentGitRoot) !== 0) {\n                // file is not in the current project\n                return;\n            }\n\n            var filename = currentFilePath.substring(currentGitRoot.length);\n\n            Git.diffFile(filename).then(function (diff) {\n                processDiffResults(editor, diff);\n            }).catch(function (err) {\n                // if this is launched in a non-git repository, just ignore\n                if (ErrorHandler.contains(err, \"Not a git repository\")) {\n                    return;\n                }\n                // if this file was moved or deleted before this command could be executed, ignore\n                if (ErrorHandler.contains(err, \"No such file or directory\")) {\n                    return;\n                }\n                ErrorHandler.showError(err, Strings.ERROR_REFRESH_GUTTER);\n            });\n\n        });\n    }\n\n    function goToPrev() {\n        var activeEditor = EditorManager.getActiveEditor();\n        if (!activeEditor) { return; }\n\n        var results = activeEditor._codeMirror.gitGutters || [];\n        var searched = _.filter(results, function (i) { return !i.parentMark; });\n\n        var currentPos = activeEditor.getCursorPos();\n        var i = searched.length;\n        while (i--) {\n            if (searched[i].line < currentPos.line) {\n                break;\n            }\n        }\n        if (i > -1) {\n            var goToMark = searched[i];\n            activeEditor.setCursorPos(goToMark.line, currentPos.ch);\n        }\n    }\n\n    function goToNext() {\n        var activeEditor = EditorManager.getActiveEditor();\n        if (!activeEditor) { return; }\n\n        var results = activeEditor._codeMirror.gitGutters || [];\n        var searched = _.filter(results, function (i) { return !i.parentMark; });\n\n        var currentPos = activeEditor.getCursorPos();\n        for (var i = 0, l = searched.length; i < l; i++) {\n            if (searched[i].line > currentPos.line) {\n                break;\n            }\n        }\n        if (i < searched.length) {\n            var goToMark = searched[i];\n            activeEditor.setCursorPos(goToMark.line, currentPos.ch);\n        }\n    }\n\n    // Event handlers\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        gitAvailable = true;\n        refresh();\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        gitAvailable = false;\n        // calling this with an empty array will remove gutters from all editor instances\n        prepareGutters([]);\n    });\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function (file) {\n        // file will be null when switching to an empty pane\n        if (!file) { return; }\n\n        // document change gets launched even when switching panes,\n        // so we check if the file hasn't already got the gutters\n        var alreadyOpened = _.filter(editorsWithGutters, function (editor) {\n            return editor.document.file.fullPath === file.fullPath;\n        }).length > 0;\n\n        if (!alreadyOpened) {\n            // TODO: here we could sent a particular file to be refreshed only\n            refresh();\n        }\n    });\n    EventEmitter.on(Events.GIT_COMMITED, function () {\n        refresh();\n    });\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (file) {\n        var alreadyOpened = _.filter(editorsWithGutters, function (editor) {\n            return editor.document.file.fullPath === file.fullPath;\n        }).length > 0;\n\n        if (alreadyOpened) {\n            // TODO: here we could sent a particular file to be refreshed only\n            refresh();\n        }\n    });\n\n    function init() {\n        const editor = EditorManager.getActiveEditor();\n        if(!editor){\n            return;\n        }\n        editor.off(\"cursorActivity.gitGutter\");\n        editor.on(\"cursorActivity.gitGutter\", _cursorActivity);\n        _cursorActivity(null, editor);\n    }\n\n    // API\n    exports.init = init;\n    exports.goToPrev = goToPrev;\n    exports.goToNext = goToNext;\n});\n\ndefine(\"src/History\", function (require) {\n\n    // Brackets modules\n    var _ = brackets.getModule(\"thirdparty/lodash\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileUtils = brackets.getModule(\"file/FileUtils\"),\n        LocalizationUtils = brackets.getModule(\"utils/LocalizationUtils\"),\n        Strings = brackets.getModule(\"strings\"),\n        Metrics = brackets.getModule(\"utils/Metrics\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const ErrorHandler = require(\"src/ErrorHandler\"),\n        Events = require(\"src/Events\"),\n        EventEmitter = require(\"src/EventEmitter\"),\n        Git = require(\"src/git/Git\"),\n        HistoryViewer = require(\"src/HistoryViewer\"),\n        Preferences = require(\"src/Preferences\");\n\n    // Templates\n    var gitPanelHistoryTemplate = `<table id=\"git-history-list\" class=\"bottom-panel-table table table-striped table-condensed row-highlight\">\n    <tbody>\n        {{> commits}}\n    </tbody>\n</table>\n`,\n        gitPanelHistoryCommitsTemplate = `{{#commits}}\n<tr class=\"history-commit\" x-hash=\"{{hash}}\">\n    <td>\n        <div class=\"commit-author-avatar\">\n            <span style=\"{{cssAvatar}}\">{{avatarLetter}}</span>\n        </div>\n    </td>\n    <td><span title=\"{{date.title}}\">{{date.shown}}</span> {{Strings.HISTORY_COMMIT_BY}} <span class=\"commit-author\">{{author}}</span></td>\n    <td class=\"commit-title\"><span class=\"commit-subject\">{{subject}} </span>{{#hasTag}}<span class=\"commit-tags\" title=\"{{tags}}\"><i class=\"octicon octicon-tag\"></i>{{tags}}</span>{{/hasTag}}</td>\n    <td>{{hashShort}}</td>\n</tr>\n{{/commits}}\n`;\n\n    // Module variables\n    let $gitPanel         = $(null),\n        $tableContainer   = $(null),\n        $historyList      = $(null),\n        commitCache       = [],\n        lastDocumentSeen  = null;\n\n    // Implementation\n\n    function initVariables() {\n        $gitPanel = $(\"#git-panel\");\n        $tableContainer = $gitPanel.find(\".table-container\");\n        attachHandlers();\n    }\n\n    function attachHandlers() {\n        $tableContainer\n            .off(\".history\")\n            .on(\"scroll.history\", function () {\n                loadMoreHistory();\n            })\n            .on(\"click.history\", \".history-commit\", function () {\n                const $tr = $(this);\n                var hash = $tr.attr(\"x-hash\");\n                var commit = _.find(commitCache, function (commit) { return commit.hash === hash; });\n                const historyShown = HistoryViewer.toggle(commit, getCurrentDocument(), {\n                    isInitial: $(this).attr(\"x-initial-commit\") === \"true\"\n                });\n                $tr.parent().find(\"tr.selected\").removeClass(\"selected\");\n                if(historyShown){\n                    $tr.addClass(\"selected\");\n                }\n            });\n    }\n\n    var generateCssAvatar = _.memoize(function (author, email) {\n\n        // Original source: http://indiegamr.com/generate-repeatable-random-numbers-in-js/\n        var seededRandom = function (max, min, seed) {\n            max = max || 1;\n            min = min || 0;\n\n            seed = (seed * 9301 + 49297) % 233280;\n            var rnd = seed / 233280.0;\n\n            return min + rnd * (max - min);\n        };\n\n        // Use `seededRandom()` to generate a pseudo-random number [0-16] to pick a color from the list\n        var seedBase = parseInt(author.charCodeAt(3).toString(), email.length),\n            seed = parseInt(email.charCodeAt(seedBase.toString().substring(1, 2)).toString(), 16),\n            colors = [\n                \"#ffb13b\", \"#dd5f7a\", \"#8dd43a\", \"#2f7e2f\", \"#4141b9\", \"#3dafea\", \"#7e3e3e\", \"#f2f26b\",\n                \"#864ba3\", \"#ac8aef\", \"#f2f2ce\", \"#379d9d\", \"#ff6750\", \"#8691a2\", \"#d2fd8d\", \"#88eadf\"\n            ],\n            texts = [\n                \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#333333\",\n                \"#FEFEFE\", \"#FEFEFE\", \"#333333\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#333333\", \"#333333\"\n            ],\n            picked = Math.floor(seededRandom(0, 16, seed));\n\n        return \"background-color: \" + colors[picked] + \"; color: \" + texts[picked];\n\n    }, function (author, email) {\n        // calculate hash for memoize - both are strings so we don't need to convert\n        return author + email;\n    });\n\n    // Render history list the first time\n    function renderHistory(file) {\n        // clear cache\n        commitCache = [];\n\n        return Git.getCurrentBranchName().then(function (branchName) {\n            // Get the history commits of the current branch\n            var p = file ? Git.getFileHistory(file.relative, branchName) : Git.getHistory(branchName);\n            return p.then(function (commits) {\n\n                // calculate some missing stuff like avatars\n                commits = addAdditionalCommitInfo(commits);\n                commitCache = commitCache.concat(commits);\n\n                var templateData = {\n                    commits: commits,\n                    Strings: Strings\n                };\n\n                $tableContainer.append(Mustache.render(gitPanelHistoryTemplate, templateData, {\n                    commits: gitPanelHistoryCommitsTemplate\n                }));\n\n                $historyList = $tableContainer.find(\"#git-history-list\")\n                    .data(\"file\", file ? file.absolute : null)\n                    .data(\"file-relative\", file ? file.relative : null);\n\n                $historyList\n                    .find(\"tr.history-commit:last-child\")\n                    .attr(\"x-initial-commit\", \"true\");\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GET_HISTORY);\n        });\n    }\n\n    // Load more rows in the history list on scroll\n    function loadMoreHistory() {\n        if ($historyList.is(\":visible\")) {\n            if (($tableContainer.prop(\"scrollHeight\") - $tableContainer.scrollTop()) === $tableContainer.height()) {\n                if ($historyList.attr(\"x-finished\") === \"true\") {\n                    return;\n                }\n                return Git.getCurrentBranchName().then(function (branchName) {\n                    var p,\n                        file = $historyList.data(\"file-relative\"),\n                        skipCount = $tableContainer.find(\"tr.history-commit\").length;\n                    if (file) {\n                        p = Git.getFileHistory(file, branchName, skipCount);\n                    } else {\n                        p = Git.getHistory(branchName, skipCount);\n                    }\n                    return p.then(function (commits) {\n                        if (commits.length === 0) {\n                            $historyList.attr(\"x-finished\", \"true\");\n                            // marks initial commit as first\n                            $historyList\n                                .find(\"tr.history-commit:last-child\")\n                                .attr(\"x-initial-commit\", \"true\");\n                            return;\n                        }\n\n                        commits = addAdditionalCommitInfo(commits);\n                        commitCache = commitCache.concat(commits);\n\n                        var templateData = {\n                            commits: commits,\n                            Strings: Strings\n                        };\n                        var commitsHtml = Mustache.render(gitPanelHistoryCommitsTemplate, templateData);\n                        $historyList.children(\"tbody\").append(commitsHtml);\n                    })\n                    .catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_GET_MORE_HISTORY);\n                    });\n                })\n                .catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_GET_CURRENT_BRANCH);\n                });\n            }\n        }\n    }\n\n    function addAdditionalCommitInfo(commits) {\n        _.forEach(commits, function (commit) {\n\n            commit.cssAvatar = generateCssAvatar(commit.author, commit.email);\n            commit.avatarLetter = commit.author.substring(0, 1);\n\n            const dateTime = new Date(commit.date);\n            if (isNaN(dateTime.getTime())) {\n                // we got invalid date, use the original date itself\n                commit.date = {\n                    title: commit.date,\n                    shown: commit.date\n                };\n            } else {\n                commit.date = {\n                    title: LocalizationUtils.getFormattedDateTime(dateTime),\n                    shown: LocalizationUtils.dateTimeFromNowFriendly(dateTime)\n                };\n            }\n            commit.hasTag = !!commit.tags;\n        });\n\n        return commits;\n    }\n\n    function getCurrentDocument() {\n        if (HistoryViewer.isVisible()) {\n            return lastDocumentSeen;\n        }\n        var doc = DocumentManager.getCurrentDocument();\n        if (doc) {\n            lastDocumentSeen = doc;\n        }\n        return doc || lastDocumentSeen;\n    }\n\n    function handleFileChange() {\n        var currentDocument = getCurrentDocument();\n\n        if ($historyList.is(\":visible\") && $historyList.data(\"file\")) {\n            handleToggleHistory(\"FILE\", currentDocument);\n        }\n        $gitPanel.find(\".git-file-history\").prop(\"disabled\", !currentDocument);\n    }\n\n    // Show or hide the history list on click of .history button\n    // newHistoryMode can be \"FILE\", \"GLOBAL\" or \"REFRESH\"\n    function handleToggleHistory(newHistoryMode, newDocument) {\n        // this is here to check that $historyList is still attached to the DOM\n        $historyList = $tableContainer.find(\"#git-history-list\");\n\n        let historyEnabled = $historyList.is(\":visible\"),\n            currentFile = $historyList.data(\"file\") || null,\n            currentHistoryMode = historyEnabled ? (currentFile ? \"FILE\" : \"GLOBAL\") : \"DISABLED\",\n            doc = newDocument ? newDocument : getCurrentDocument(),\n            file;\n\n        // Variables to store scroll positions (only used for REFRESH case)\n        let savedScrollTop, savedScrollLeft, selectedCommitHash;\n        let isRefresh = false;\n        if(newHistoryMode === \"REFRESH\"){\n            newHistoryMode = currentHistoryMode;\n            isRefresh = true;\n            historyEnabled = true;\n            // Save current scroll positions before removing the list\n            if ($historyList.length > 0) {\n                savedScrollTop = $historyList.parent().scrollTop();\n                savedScrollLeft = $historyList.parent().scrollLeft();\n                selectedCommitHash = $historyList.find(\".selected\").attr(\"x-hash\");\n            }\n        } else if (currentHistoryMode !== newHistoryMode) {\n            // we are switching the modes so enable\n            historyEnabled = true;\n        } else if (!newDocument) {\n            // we are not changing the mode and we are not switching to a new document\n            historyEnabled = !historyEnabled;\n        }\n\n        if (historyEnabled && newHistoryMode === \"FILE\") {\n            if (doc) {\n                file = {};\n                file.absolute = doc.file.fullPath;\n                file.relative = FileUtils.getRelativeFilename(Preferences.get(\"currentGitRoot\"), file.absolute);\n            } else {\n                // we want a file history but no file was found\n                historyEnabled = false;\n            }\n        }\n\n        // Render #git-history-list if is not already generated or if the viewed file for file history has changed\n        var isEmpty = $historyList.find(\"tr\").length === 0,\n            fileChanged = currentFile !== (file ? file.absolute : null);\n        if (historyEnabled && (isEmpty || fileChanged || isRefresh)) {\n            if ($historyList.length > 0) {\n                $historyList.remove();\n            }\n            var $spinner = $(\"<div class='spinner spin large'></div>\").appendTo($gitPanel);\n            renderHistory(file).finally(function () {\n                $spinner.remove();\n                if (isRefresh) {\n                    // After rendering, we need to fetch the newly created #git-history-list\n                    let $newHistoryList = $tableContainer.find(\"#git-history-list\");\n                    // Restore the scroll position\n                    $newHistoryList.parent().scrollTop(savedScrollTop || 0);\n                    $newHistoryList.parent().scrollLeft(savedScrollLeft || 0);\n                    $historyList.find(`[x-hash=\"${selectedCommitHash}\"]`).addClass(\"selected\");\n                }\n            });\n        }\n\n        // disable commit button when viewing history\n        // refresh status when history is closed and commit button will correct its disabled state if required\n        if (historyEnabled) {\n            $gitPanel.find(\".git-commit, .check-all\").prop(\"disabled\", true);\n        } else {\n            Git.status();\n        }\n\n        // Toggle visibility of .git-edited-list and #git-history-list\n        $tableContainer.find(\".git-edited-list\").toggle(!historyEnabled);\n        $historyList.toggle(historyEnabled);\n\n        if (!historyEnabled) { HistoryViewer.hide(); }\n\n        // Toggle history button\n        var globalButtonActive  = historyEnabled && newHistoryMode === \"GLOBAL\",\n            fileButtonActive    = historyEnabled && newHistoryMode === \"FILE\";\n        $gitPanel.find(\".git-history-toggle\").toggleClass(\"active\", globalButtonActive)\n            .attr(\"title\", globalButtonActive ? Strings.TOOLTIP_HIDE_HISTORY : Strings.TOOLTIP_SHOW_HISTORY);\n        $gitPanel.find(\".git-file-history\").toggleClass(\"active\", fileButtonActive)\n            .attr(\"title\", fileButtonActive ? Strings.TOOLTIP_HIDE_FILE_HISTORY : Strings.TOOLTIP_SHOW_FILE_HISTORY);\n    }\n\n    // Event listeners\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        initVariables();\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        lastDocumentSeen = null;\n        $historyList.remove();\n        $historyList = $();\n    });\n    EventEmitter.on(Events.HISTORY_SHOW_FILE, function () {\n        handleToggleHistory(\"FILE\");\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"fileHistory\");\n    });\n    EventEmitter.on(Events.HISTORY_SHOW_GLOBAL, function () {\n        handleToggleHistory(\"GLOBAL\");\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"history\");\n    });\n    EventEmitter.on(Events.REFRESH_HISTORY, function () {\n        handleToggleHistory(\"REFRESH\");\n    });\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function () {\n        handleFileChange();\n    });\n\n});\n\ndefine(\"src/HistoryViewer\", function (require, exports) {\n\n    const _             = brackets.getModule(\"thirdparty/lodash\"),\n        LanguageManager = brackets.getModule(\"language/LanguageManager\"),\n        Mustache        = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        WorkspaceManager  = brackets.getModule(\"view/WorkspaceManager\"),\n        Strings           = brackets.getModule(\"strings\"),\n        Metrics         = brackets.getModule(\"utils/Metrics\"),\n        marked          = brackets.getModule('thirdparty/marked.min').marked;\n\n    const ErrorHandler  = require(\"src/ErrorHandler\"),\n        Git           = require(\"src/git/Git\"),\n        Preferences   = require(\"src/Preferences\"),\n        Utils         = require(\"src/Utils\");\n\n    var historyViewerTemplate       = `<div id=\"history-viewer\">\n    <div class=\"header\">\n        <div>\n            <a href=\"#\" class=\"close\">&times;</a>\n        </div>\n        <div class=\"author-line\">\n            <span class=\"commit-author\">\n                <div class=\"commit-author-avatar\">\n                    <span class=\"text\" style=\"{{commit.cssAvatar}}\">{{commit.avatarLetter}}</span>\n                </div>\n                <span class=\"commit-author-name\">{{commit.author}}</span>\n                <span class=\"commit-author-email\">&lt;{{commit.email}}&gt;</span>\n            </span>\n            <span class=\"commit-time\" title=\"{{commit.date.title}}\">\n                <i class=\"octicon octicon-calendar\"></i>&nbsp;\n                <span class=\"selectable-text\">{{commit.date.shown}}</span>\n            </span>\n            <span class=\"commit-hash\" data-hash=\"{{commit.hash}}\">\n                <i class=\"octicon octicon-git-commit\"></i>&nbsp;<span class=\"selectable-text\">{{commit.hashShort}}</span>\n                <a href=\"#\" class=\"git-extend-sha\">&hellip;</a>\n            </span>\n            <div class=\"actions\">\n                <span class=\"toggle-diffs\">\n                    <i class=\"octicon octicon-expand collapse\"></i>\n                    <i class=\"octicon octicon-collapse expand\"></i>\n                    <span class=\"expand\">{{Strings.EXPAND_ALL}}</span>\n                    <span class=\"collapse\">{{Strings.COLLAPSE_ALL}}</span>\n                </span>\n            </div>\n        </div>\n        <div>\n            <h1 class=\"commit-title selectable-text\"><span>{{commit.subject}}</span></h1>\n        </div>\n    </div>\n    <div class=\"body\">\n        <div class=\"commitBody selectable-text\">{{{bodyMarkdown}}}</div>\n        <div class=\"table-striped tab-content\">\n            <div class=\"commit-files\">\n                <ul class=\"nav nav-tabs nav-stacked filesContainer\"></ul>\n                <button class=\"btn loadMore\">\n                    Load more files from this commit\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n`,\n        historyViewerFilesTemplate  = `{{#files}}\n    <li x-file=\"{{file}}\">\n        <a>\n            <i class=\"caret caret-right closed\"></i>\n            <i class=\"caret opened\"></i>\n            {{name}}<span class=\"extension\">{{extension}}</span>\n            <i class=\"octicon octicon-eye openFile\" title=\"{{Strings.VIEW_THIS_FILE}}\"></i>\n            {{#useDifftool}}<i class=\"octicon octicon-diff difftool\" title=\"{{Strings.DIFFTOOL}}\"></i>{{/useDifftool}}\n        </a>\n        <div class=\"commit-diff\"></div>\n    </li>\n{{/files}}\n`;\n\n    let useDifftool            = false,\n        isShown                = false,\n        commit                 = null,\n        currentlyViewedCommit  = null,\n        isInitial              = null,\n        $viewer                = null,\n        $editorHolder          = null;\n\n    var setExpandState = _.debounce(function () {\n        var allFiles = $viewer.find(\".commit-files a\"),\n            activeFiles = allFiles.filter(\".active\"),\n            allExpanded = allFiles.length === activeFiles.length;\n        $viewer.find(\".toggle-diffs\").toggleClass(\"opened\", allExpanded);\n    }, 100);\n\n    var PAGE_SIZE = 25;\n    var currentPage = 0;\n    var hasNextPage = false;\n\n    function toggleDiff($a) {\n        if ($a.hasClass(\"active\")) {\n            // Close the clicked diff\n            $a.removeClass(\"active\");\n            setExpandState();\n            return;\n        }\n\n        // Open the clicked diff\n        $(\".commit-files a.active\").attr(\"scrollPos\", $(\".commit-diff\").scrollTop());\n\n        // If this diff was not previously loaded then load it\n        if (!$a.is(\".loaded\")) {\n            var $li = $a.closest(\"[x-file]\"),\n                relativeFilePath = $li.attr(\"x-file\"),\n                $diffContainer = $li.find(\".commit-diff\");\n\n            Git.getDiffOfFileFromCommit(commit.hash, relativeFilePath, isInitial).then(function (diff) {\n                $diffContainer.html(Utils.formatDiff(diff));\n                $diffContainer.scrollTop($a.attr(\"scrollPos\") || 0);\n\n                $a.addClass(\"active loaded\");\n                setExpandState();\n            }).catch(function (err) {\n                ErrorHandler.showError(err, Strings.ERROR_GET_DIFF_FILE_COMMIT);\n            });\n        } else {\n            // If this diff was previously loaded just open it\n            $a.addClass(\"active\");\n            setExpandState();\n        }\n    }\n\n    function showDiff($el) {\n        var file = $el.closest(\"[x-file]\").attr(\"x-file\");\n        Git.difftoolFromHash(commit.hash, file, isInitial);\n    }\n\n    function expandAll() {\n        $viewer.find(\".commit-files a\").not(\".active\").trigger(\"click\");\n        Preferences.set(\"autoExpandDiffsInHistory\", true);\n    }\n\n    function collapseAll() {\n        $viewer.find(\".commit-files a\").filter(\".active\").trigger(\"click\");\n        Preferences.set(\"autoExpandDiffsInHistory\", false);\n    }\n\n    function attachEvents() {\n        $viewer\n            .on(\"click\", \".commit-files a\", function () {\n                toggleDiff($(this));\n            })\n            .on(\"click\", \".commit-files .difftool\", function (e) {\n                e.stopPropagation();\n                showDiff($(this));\n            })\n            .on(\"click\", \".openFile\", function (e) {\n                e.stopPropagation();\n                var file = $(this).closest(\"[x-file]\").attr(\"x-file\");\n                Utils.openEditorForFile(file, true);\n                hide();\n            })\n            .on(\"click\", \".close\", function () {\n                // Close history viewer\n                remove();\n            })\n            .on(\"click\", \".git-extend-sha\", function () {\n                // Show complete commit SHA\n                var $parent = $(this).parent(),\n                    sha = $parent.data(\"hash\");\n                $parent.find(\"span.selectable-text\").text(sha);\n                $(this).remove();\n            })\n            .on(\"click\", \".toggle-diffs\", expandAll)\n            .on(\"click\", \".toggle-diffs.opened\", collapseAll);\n\n        // Add/Remove shadow on bottom of header\n        $viewer.find(\".body\")\n            .on(\"scroll\", function () {\n                if ($viewer.find(\".body\").scrollTop() > 0) {\n                    $viewer.find(\".header\").addClass(\"shadow\");\n                } else {\n                    $viewer.find(\".header\").removeClass(\"shadow\");\n                }\n            });\n\n        // Expand the diffs when wanted\n        if (Preferences.get(\"autoExpandDiffsInHistory\")) {\n            expandAll();\n        }\n    }\n\n    function renderViewerContent(files, selectedFile) {\n        var bodyMarkdown = marked(commit.body, { gfm: true, breaks: true });\n\n        $viewer.html(Mustache.render(historyViewerTemplate, {\n            commit: commit,\n            bodyMarkdown: bodyMarkdown,\n            Strings: Strings\n        }));\n\n        renderFiles(files);\n\n        if (selectedFile) {\n            var $fileEntry = $viewer.find(\".commit-files li[x-file='\" + selectedFile + \"'] a\").first();\n            if ($fileEntry.length) {\n                toggleDiff($fileEntry);\n                window.setTimeout(function () {\n                    $viewer.find(\".body\").animate({ scrollTop: $fileEntry.position().top - 10 });\n                }, 80);\n            }\n        }\n\n        attachEvents();\n    }\n\n    function renderFiles(files) {\n        $viewer.find(\".filesContainer\").append(Mustache.render(historyViewerFilesTemplate, {\n            files: files,\n            Strings: Strings,\n            useDifftool: useDifftool\n        }));\n\n        // Activate/Deactivate load more button\n        $viewer.find(\".loadMore\")\n            .toggle(hasNextPage)\n            .off(\"click\")\n            .on(\"click\", function () {\n                currentPage++;\n                loadMoreFiles();\n            });\n    }\n\n    function loadMoreFiles() {\n        Git.getFilesFromCommit(commit.hash, isInitial).then(function (files) {\n\n            hasNextPage = files.slice((currentPage + 1) * PAGE_SIZE).length > 0;\n            files = files.slice(currentPage * PAGE_SIZE, (currentPage + 1) * PAGE_SIZE);\n\n            var list = files.map(function (file) {\n                var fileExtension = LanguageManager.getCompoundFileExtension(file),\n                    i = file.lastIndexOf(\".\" + fileExtension),\n                    fileName = file.substring(0, fileExtension && i >= 0 ? i : file.length);\n                return {\n                    name: fileName,\n                    extension: fileExtension ? \".\" + fileExtension : \"\",\n                    file: file\n                };\n            });\n\n            if (currentPage === 0) {\n                var file = $(\"#git-history-list\").data(\"file-relative\");\n                return renderViewerContent(list, file);\n            } else {\n                return renderFiles(list);\n            }\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GET_DIFF_FILES);\n        }).finally(function () {\n            $viewer.removeClass(\"spinner large spin\");\n        });\n    }\n\n    function render() {\n        if ($viewer) {\n            // Reset the viewer listeners\n            $viewer.off(\"click\");\n            $viewer.find(\".body\").off(\"scroll\");\n        } else {\n            // Create the viewer if it doesn't exist\n            $viewer = $(\"<div>\").addClass(\"git spinner large spin\");\n            $viewer.appendTo($editorHolder);\n        }\n\n        currentPage = 0;\n        loadMoreFiles();\n    }\n\n    var initialize = _.once(function () {\n        Git.getConfig(\"diff.tool\").then(function (config) {\n            useDifftool = !!config;\n        });\n    });\n\n    function toggle(commitInfo, doc, options) {\n        const commitHash = commitInfo.hash;\n        if(isShown && commitHash === currentlyViewedCommit) {\n            // the history view already showing the current commit, the user intent is to close\n            remove();\n            return false;\n        }\n        // a new history is to be shown\n        show(commitInfo, doc, options);\n        return true;\n    }\n\n    function show(commitInfo, doc, options) {\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'history', \"detailView\");\n        initialize();\n\n        commit    = commitInfo;\n        isInitial = options.isInitial;\n\n        $editorHolder = $(\"#editor-holder\");\n        render();\n        currentlyViewedCommit = commitInfo.hash;\n        isShown   = true;\n        if ($(\"#first-pane\").length) {\n            const firstPaneStyle =\n                $(\"#first-pane\").prop(\"style\") && $(\"#first-pane\").prop(\"style\").cssText ?\n                    $(\"#first-pane\").prop(\"style\").cssText : \"\";\n            $(\"#first-pane\").prop(\"style\", firstPaneStyle + \";display: none !important;\");\n        }\n\n        if ($(\"#second-pane\").length) {\n            const secondPaneStyle =\n                $(\"#second-pane\").prop(\"style\") && $(\"#second-pane\").prop(\"style\").cssText ?\n                    $(\"#second-pane\").prop(\"style\").cssText : \"\";\n            $(\"#second-pane\").prop(\"style\", secondPaneStyle + \";display: none !important;\");\n        }\n    }\n\n    function onRemove() {\n        isShown = false;\n        $viewer = null;\n        currentlyViewedCommit = null;\n        $(\"#first-pane\").show();\n        $(\"#second-pane\").show();\n        // we need to relayout as when the history overlay is visible over the editor, we\n        // hide the editor with css, and if we resize app while history view is open, the editor wont\n        // be resized. So we relayout on panel close.\n        WorkspaceManager.recomputeLayout();\n        // detach events that were added by this viewer to another element than one added to $editorHolder\n    }\n\n    function hide() {\n        if (isShown) {\n            remove();\n        }\n    }\n\n    function remove() {\n        $viewer.remove();\n        onRemove();\n    }\n\n    function isVisible() {\n        return isShown;\n    }\n\n    // Public API\n    exports.toggle = toggle;\n    exports.show = show;\n    exports.hide = hide;\n    exports.isVisible = isVisible;\n\n});\n\ndefine(\"src/Main\", function (require, exports) {\n\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager    = brackets.getModule(\"command/CommandManager\"),\n        Commands          = brackets.getModule(\"command/Commands\"),\n        Menus             = brackets.getModule(\"command/Menus\"),\n        FileSystem        = brackets.getModule(\"filesystem/FileSystem\"),\n        Mustache          = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics           = brackets.getModule(\"utils/Metrics\"),\n        ProjectManager    = brackets.getModule(\"project/ProjectManager\");\n\n    const Constants       = require(\"src/Constants\"),\n        Events            = require(\"src/Events\"),\n        EventEmitter      = require(\"src/EventEmitter\"),\n        Strings             = brackets.getModule(\"strings\"),\n        StringUtils             = brackets.getModule(\"utils/StringUtils\"),\n        ErrorHandler      = require(\"src/ErrorHandler\"),\n        Panel             = require(\"src/Panel\"),\n        Branch            = require(\"src/Branch\"),\n        SettingsDialog    = require(\"src/SettingsDialog\"),\n        Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        CloseNotModified  = require(\"src/CloseNotModified\"),\n        Setup             = require(\"src/utils/Setup\"),\n        Preferences       = require(\"src/Preferences\"),\n        Utils             = require(\"src/Utils\"),\n        Git               = require(\"src/git/Git\"),\n        gitTagDialogTemplate    = `<div id=\"git-commit-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.TAG_NAME}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <div class=\"commit-message-box\">\n            <input name=\"commit-message\" class=\"commit-message\" type=\"text\" placeholder=\"{{Strings.TAG_NAME_PLACEHOLDER}}\" autocomplete=\"off\"/>\n            <textarea name=\"commit-message\" type=\"text\" placeholder=\"{{Strings.TAG_NAME_PLACEHOLDER}}\" autocomplete=\"off\" style=\"display: none;\"></textarea>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`;\n\n    const CMD_ADD_TO_IGNORE      = \"git.addToIgnore\",\n        CMD_REMOVE_FROM_IGNORE = \"git.removeFromIgnore\",\n        $icon                  = $(`<a id='git-toolbar-icon' title=\"${Strings.STATUSBAR_SHOW_GIT}\" href='#'></a>`)\n                                    .addClass(\"forced-hidden\")\n                                    .prependTo($(\".bottom-buttons\"));\n\n    let gitEnabled = false;\n\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        $icon.removeClass(\"dirty\");\n    });\n\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (sortedResults) {\n        $icon.toggleClass(\"dirty\", sortedResults.length !== 0);\n    });\n\n    // This only launches when Git is available\n    function initUi() {\n        // FUTURE: do we really need to launch init from here?\n        Panel.init();\n        Branch.init();\n        CloseNotModified.init();\n        // Attach events\n        $icon.on(\"click\", Panel.toggle);\n    }\n\n    function _addRemoveItemInGitignore(selectedEntry, method) {\n        var gitRoot = Preferences.get(\"currentGitRoot\"),\n            entryPath = \"/\" + selectedEntry.fullPath.substring(gitRoot.length),\n            gitignoreEntry = FileSystem.getFileForPath(gitRoot + \".gitignore\");\n\n        gitignoreEntry.read(function (err, content) {\n            if (err) {\n                Utils.consoleWarn(err);\n                content = \"\";\n            }\n\n            // use trimmed lines only\n            var lines = content.split(\"\\n\").map(function (l) { return l.trim(); });\n            // clean start and end empty lines\n            while (lines.length > 0 && !lines[0]) { lines.shift(); }\n            while (lines.length > 0 && !lines[lines.length - 1]) { lines.pop(); }\n\n            if (method === \"add\") {\n                // add only when not already present\n                if (lines.indexOf(entryPath) === -1) { lines.push(entryPath); }\n            } else if (method === \"remove\") {\n                lines = _.without(lines, entryPath);\n            }\n\n            // always have an empty line at the end of the file\n            if (lines[lines.length - 1]) { lines.push(\"\"); }\n\n            gitignoreEntry.write(lines.join(\"\\n\"), function (err) {\n                if (err) {\n                    return ErrorHandler.showError(err, Strings.ERROR_MODIFY_GITIGNORE);\n                }\n                Panel.refresh();\n            });\n        });\n    }\n\n    function addItemToGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"add\");\n    }\n\n    function removeItemFromGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"remove\");\n    }\n\n    function addItemToGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"add\");\n    }\n\n    function removeItemFromGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"remove\");\n    }\n\n    function _refreshCallback() {\n        EventEmitter.emit(Events.REFRESH_ALL);\n    }\n\n    function checkoutCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git checkout as commit hash is ${commitHash}`);\n            return;\n        }\n        const displayStr = StringUtils.format(Strings.CHECKOUT_COMMIT_DETAIL, commitDetailStr, commitHash);\n        Utils.askQuestion(Strings.TITLE_CHECKOUT,\n            displayStr + \"<br><br>\" + Strings.DIALOG_CHECKOUT,\n            { booleanResponse: true, noescape: true, customOkBtn: Strings.CHECKOUT_COMMIT })\n            .then(function (response) {\n                if (response === true) {\n                    return Git.checkout(commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function tagCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash || \"\";\n        const compiledTemplate = Mustache.render(gitTagDialogTemplate, { Strings }),\n            dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog          = dialog.getElement();\n        $dialog.find(\"input\").focus();\n        $dialog.find(\"button.primary\").on(\"click\", function () {\n            const tagname = $dialog.find(\"input.commit-message\").val();\n            Git.setTagName(tagname, commitHash).then(function () {\n                EventEmitter.emit(Events.REFRESH_HISTORY);\n            }).catch(function (err) {\n                ErrorHandler.showError(err, Strings.ERROR_CREATE_TAG);\n            });\n        });\n    }\n\n    function _resetOperation(operation, commitHash, title, message) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git Reset ${operation} as commit hash is ${commitHash}`);\n            return;\n        }\n        const gitCmdUsed = `git reset ${operation} ${commitHash}`;\n        const displayStr = StringUtils.format(Strings.RESET_DETAIL, commitDetailStr, gitCmdUsed);\n        Utils.askQuestion(title,\n            message + \"<br><br>\" + displayStr,\n            { booleanResponse: true, noescape: true ,\n                customOkBtn: Strings.RESET, customOkBtnClass: \"danger\"})\n            .then(function (response) {\n                if (response === true) {\n                    return Git.reset(operation, commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function resetHard(commitHash) {\n        return _resetOperation(\"--hard\", commitHash,\n            Strings.RESET_HARD_TITLE, Strings.RESET_HARD_MESSAGE);\n    }\n\n    function resetMixed(commitHash) {\n        return _resetOperation(\"--mixed\", commitHash,\n            Strings.RESET_MIXED_TITLE, Strings.RESET_MIXED_MESSAGE);\n    }\n\n    function resetSoft(commitHash) {\n        return _resetOperation(\"--soft\", commitHash,\n            Strings.RESET_SOFT_TITLE, Strings.RESET_SOFT_MESSAGE);\n    }\n\n    /**\n     * Disables all Git-related commands that were registered in `initGitMenu`.\n     * After calling this function, none of these menu items will be clickable.\n     */\n    function disableAllMenus() {\n        // Collect all command IDs that were registered in initGitMenu\n        const commandsToDisable = [\n            // File menu items\n            Constants.CMD_GIT_INIT,\n            Constants.CMD_GIT_CLONE,\n            Constants.CMD_GIT_TOGGLE_PANEL,\n            Constants.CMD_GIT_REFRESH,\n            Constants.CMD_GIT_GOTO_NEXT_CHANGE,\n            Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE,\n            Constants.CMD_GIT_CLOSE_UNMODIFIED,\n            Constants.CMD_GIT_AUTHORS_OF_SELECTION,\n            Constants.CMD_GIT_AUTHORS_OF_FILE,\n            Constants.CMD_GIT_COMMIT_CURRENT,\n            Constants.CMD_GIT_COMMIT_ALL,\n            Constants.CMD_GIT_FETCH,\n            Constants.CMD_GIT_PULL,\n            Constants.CMD_GIT_PUSH,\n            Constants.CMD_GIT_GERRIT_PUSH_REF,\n            Constants.CMD_GIT_CHANGE_USERNAME,\n            Constants.CMD_GIT_CHANGE_EMAIL,\n            Constants.CMD_GIT_SETTINGS_COMMAND_ID,\n\n            // Project tree/working files commands\n            CMD_ADD_TO_IGNORE,\n            CMD_REMOVE_FROM_IGNORE,\n            // Panel context menu commands (with \"2\" suffix)\n            CMD_ADD_TO_IGNORE + \"2\",\n            CMD_REMOVE_FROM_IGNORE + \"2\",\n\n            // History context menu commands\n            Constants.CMD_GIT_CHECKOUT,\n            Constants.CMD_GIT_TAG,\n            Constants.CMD_GIT_RESET_HARD,\n            Constants.CMD_GIT_RESET_MIXED,\n            Constants.CMD_GIT_RESET_SOFT,\n\n            // \"More options\" context menu commands\n            Constants.CMD_GIT_DISCARD_ALL_CHANGES,\n            Constants.CMD_GIT_UNDO_LAST_COMMIT,\n            Constants.CMD_GIT_TOGGLE_UNTRACKED\n        ];\n\n        // Disable each command\n        commandsToDisable.forEach((cmdId) => {\n            Utils.enableCommand(cmdId, false);\n        });\n    }\n\n\n    function initGitMenu() {\n        // Register command and add it to the menu.\n        const fileMenu = Menus.getMenu(Menus.AppMenuBar.FILE_MENU);\n        let gitSubMenu = fileMenu.addSubMenu(Constants.GIT_STRING_UNIVERSAL,\n            Constants.GIT_SUB_MENU, Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        fileMenu.addMenuDivider(Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_INIT, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLONE, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_TOGGLE_PANEL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_REFRESH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_NEXT_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLOSE_UNMODIFIED);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_CURRENT);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_ALL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PULL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        // register commands for project tree / working files\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE, addItemToGitingore);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE, removeItemFromGitingore);\n\n        // create context menu for git panel\n        const panelCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_CHANGES_CMENU);\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE + \"2\", addItemToGitingoreFromPanel);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE + \"2\", removeItemFromGitingoreFromPanel);\n        panelCmenu.addMenuItem(CMD_ADD_TO_IGNORE + \"2\");\n        panelCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE + \"2\");\n\n        // create context menu for git history\n        const historyCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_HISTORY_CMENU);\n        CommandManager.register(Strings.CHECKOUT_COMMIT, Constants.CMD_GIT_CHECKOUT, checkoutCommit);\n        CommandManager.register(Strings.MENU_RESET_HARD, Constants.CMD_GIT_RESET_HARD, resetHard);\n        CommandManager.register(Strings.MENU_RESET_MIXED, Constants.CMD_GIT_RESET_MIXED, resetMixed);\n        CommandManager.register(Strings.MENU_RESET_SOFT, Constants.CMD_GIT_RESET_SOFT, resetSoft);\n        CommandManager.register(Strings.MENU_TAG_COMMIT, Constants.CMD_GIT_TAG, tagCommit);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_CHECKOUT);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_TAG);\n        historyCmenu.addMenuDivider();\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_HARD);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_MIXED);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_SOFT);\n\n        // create context menu for git more options\n        const optionsCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_OPTIONS_CMENU);\n        Menus.ContextMenu.assignContextMenuToSelector(\".git-more-options-btn\", optionsCmenu);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_DISCARD_ALL_CHANGES);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_UNDO_LAST_COMMIT);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PULL);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_TOGGLE_UNTRACKED);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        if(!Setup.isExtensionActivated()){\n            disableAllMenus();\n        }\n    }\n\n    function init() {\n        CommandManager.register(Strings.GIT_SETTINGS, Constants.CMD_GIT_SETTINGS_COMMAND_ID, SettingsDialog.show);\n        // Try to get Git version, if succeeds then Git works\n        return Setup.init().then(function (enabled) {\n            initUi();\n            initGitMenu();\n            return enabled;\n        });\n    }\n\n    var _toggleMenuEntriesState = false,\n        _divider1 = null,\n        _divider2 = null;\n    function toggleMenuEntries(bool) {\n        if (bool === _toggleMenuEntriesState) {\n            return;\n        }\n        var projectCmenu = Menus.getContextMenu(Menus.ContextMenuIds.PROJECT_MENU);\n        var workingCmenu = Menus.getContextMenu(Menus.ContextMenuIds.WORKING_SET_CONTEXT_MENU);\n        if (bool) {\n            _divider1 = projectCmenu.addMenuDivider();\n            _divider2 = workingCmenu.addMenuDivider();\n            projectCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n        } else {\n            projectCmenu.removeMenuDivider(_divider1.id);\n            workingCmenu.removeMenuDivider(_divider2.id);\n            projectCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n        }\n        _toggleMenuEntriesState = bool;\n    }\n\n    function _enableAllCommands(enabled) {\n        Utils.enableCommand(Constants.CMD_GIT_REFRESH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_NEXT_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_SELECTION, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_FILE, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_CURRENT, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_ALL, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_FETCH, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PULL, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PUSH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_DISCARD_ALL_CHANGES, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_UNDO_LAST_COMMIT, enabled);\n        toggleMenuEntries(enabled);\n        if(enabled){\n            $icon.removeClass(\"forced-hidden\");\n        } else if(!$(\"#git-panel\").is(\":visible\")){\n            $icon.addClass(\"forced-hidden\");\n        }\n    }\n\n    let lastExecutionTime = 0;\n    let isCommandExecuting = false;\n    const FOCUS_SWITCH_DEDUPE_TIME = 5000;\n    function refreshOnFocusChange() {\n        // to sync external git changes after switching to app.\n        if (gitEnabled) {\n            const now = Date.now();\n\n            if (isCommandExecuting) {\n                return;\n            }\n\n            if (now - lastExecutionTime > FOCUS_SWITCH_DEDUPE_TIME) {\n                isCommandExecuting = true;\n                lastExecutionTime = Date.now();\n                Git.hasStatusChanged().then((hasChanged) => {\n                    if(!hasChanged){\n                        return;\n                    }\n\n                    CommandManager.execute(Constants.CMD_GIT_REFRESH).fail((err) => {\n                        console.error(\"error refreshing on focus switch\", err);\n                    });\n                }).finally(()=>{\n                    isCommandExecuting = false;\n                });\n            }\n        }\n    }\n    $(window).focus(refreshOnFocusChange);\n\n    // Event handlers\n    let projectSwitched = true;\n    EventEmitter.on(Events.BRACKETS_PROJECT_CHANGE, function () {\n        // pressing refresh button will raise GIT_ENABLED event and we only want one enabled metric\n        // per project open.\n        projectSwitched = true;\n    });\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        _enableAllCommands(true);\n        gitEnabled = true;\n        projectSwitched && Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'enabled', \"project\");\n        projectSwitched = false;\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        _enableAllCommands(false);\n        gitEnabled = false;\n    });\n\n    // API\n    exports.$icon = $icon;\n    exports.init = init;\n\n});\n\n/*globals jsPromise, fs*/\ndefine(\"src/NoRepo\", function (require) {\n\n    // Brackets modules\n    const FileSystem    = brackets.getModule(\"filesystem/FileSystem\"),\n        FileUtils       = brackets.getModule(\"file/FileUtils\"),\n        ProjectManager  = brackets.getModule(\"project/ProjectManager\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        Metrics         = brackets.getModule(\"utils/Metrics\"),\n        Strings         = brackets.getModule(\"strings\"),\n        StringUtils     = brackets.getModule(\"utils/StringUtils\");\n\n    // Local modules\n    const ErrorHandler  = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        ExpectedError   = require(\"src/ExpectedError\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\"),\n        CloneDialog     = require(\"src/dialogs/Clone\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"src/Preferences\"),\n        Constants       = require(\"src/Constants\"),\n        Utils           = require(\"src/Utils\");\n\n    // Templates\n    var gitignoreTemplate = `# https://git-scm.com/docs/gitignore\n# https://help.github.com/articles/ignoring-files\n# Example .gitignore files: https://github.com/github/gitignore\n/bower_components/\n/node_modules/`;\n\n    // Module variables\n\n    // Implementation\n\n    function createGitIgnore() {\n        var gitIgnorePath = Preferences.get(\"currentGitRoot\") + \".gitignore\";\n        return Utils.pathExists(gitIgnorePath).then(function (exists) {\n            if (!exists) {\n                return jsPromise(\n                    FileUtils.writeText(FileSystem.getFileForPath(gitIgnorePath), gitignoreTemplate));\n            }\n        });\n    }\n\n    function stageGitIgnore() {\n        return createGitIgnore().then(function () {\n            return Git.stage(\".gitignore\");\n        });\n    }\n\n    function handleGitInit() {\n        Utils.isProjectRootWritable().then(function (writable) {\n            if (!writable) {\n                const initPath = Phoenix.app.getDisplayPath(Utils.getProjectRoot());\n                const errorStr = StringUtils.format(Strings.FOLDER_NOT_WRITABLE, initPath);\n                throw new ExpectedError(errorStr);\n            }\n            return Git.init().catch(function (err) {\n                return new Promise((resolve, reject)=>{\n                    if (ErrorHandler.contains(err, \"Please tell me who you are\")) {\n                        EventEmitter.emit(Events.GIT_CHANGE_USERNAME, function () {\n                            EventEmitter.emit(Events.GIT_CHANGE_EMAIL, function () {\n                                Git.init().then(function (result) {\n                                    resolve(result);\n                                }).catch(function (error) {\n                                    reject(error);\n                                });\n                            });\n                        });\n                        return;\n                    }\n\n                    reject(err);\n                });\n            });\n        }).then(function () {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'init', \"success\");\n            return stageGitIgnore(\"Initial staging\");\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.INIT_NEW_REPO_FAILED, {dontStripError: true});\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'init', \"fail\");\n        }).then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        });\n    }\n\n    // This checks if the project root is empty (to let Git clone repositories)\n    function isProjectRootEmpty() {\n        return new Promise(function (resolve, reject) {\n            ProjectManager.getProjectRoot().getContents(function (err, entries) {\n                if (err) {\n                    return reject(err);\n                }\n                resolve(entries.length === 0);\n            });\n        });\n    }\n\n    function handleGitClone(gitCloneURL, destPath) {\n        var $gitPanel = $(\"#git-panel\");\n        var $cloneButton = $gitPanel.find(\".git-clone\");\n        $cloneButton.prop(\"disabled\", true);\n        isProjectRootEmpty().then(function (isEmpty) {\n            if (!isEmpty) {\n                const clonePath = Phoenix.app.getDisplayPath(Utils.getProjectRoot());\n                const err = new ExpectedError(\n                    StringUtils.format(Strings.GIT_CLONE_ERROR_EXPLAIN, clonePath));\n                ErrorHandler.showError(err, Strings.GIT_CLONE_REMOTE_FAILED, {dontStripError: true});\n                return;\n            }\n            function _clone(cloneConfig) {\n                var q = Promise.resolve();\n                // put username and password into remote url\n                var remoteUrl = cloneConfig.remoteUrl;\n                if (cloneConfig.remoteUrlNew) {\n                    remoteUrl = cloneConfig.remoteUrlNew;\n                }\n\n                // do the clone\n                q = q.then(function () {\n                    const tracker = ProgressDialog.newProgressTracker();\n                    destPath = destPath ? fs.getTauriPlatformPath(destPath) : \".\";\n                    return ProgressDialog.show(Git.clone(remoteUrl, destPath, tracker), tracker);\n                }).then(()=>{\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'clone', \"success\");\n                }).catch(function (err) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'clone', \"fail\");\n                    ErrorHandler.showError(err, Strings.GIT_CLONE_REMOTE_FAILED, {errorMetric: \"clone\"});\n                });\n\n                // restore original url if desired\n                if (cloneConfig.remoteUrlRestore) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(cloneConfig.remote, cloneConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            }\n            if(gitCloneURL){\n                return _clone({\n                    remote: \"origin\",\n                    remoteUrlNew: gitCloneURL\n                });\n            }\n            CloneDialog.show().then(_clone).catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.GIT_CLONE_REMOTE_FAILED); }\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err);\n        }).finally(function () {\n            $cloneButton.prop(\"disabled\", false);\n        });\n    }\n\n    CommandManager.register(Strings.GIT_CLONE, Constants.CMD_GIT_CLONE_WITH_URL, handleGitClone);\n\n    // Event subscriptions\n    EventEmitter.on(Events.HANDLE_GIT_INIT, function () {\n        handleGitInit();\n    });\n    EventEmitter.on(Events.HANDLE_GIT_CLONE, function () {\n        handleGitClone();\n    });\n    EventEmitter.on(Events.GIT_NO_BRANCH_EXISTS, function () {\n        stageGitIgnore();\n    });\n\n});\n\n/*globals jsPromise, path*/\n\ndefine(\"src/Panel\", function (require, exports) {\n\n    const _                = brackets.getModule(\"thirdparty/lodash\"),\n        StateManager       = brackets.getModule(\"preferences/StateManager\"),\n        CodeInspection     = brackets.getModule(\"language/CodeInspection\"),\n        CommandManager     = brackets.getModule(\"command/CommandManager\"),\n        Commands           = brackets.getModule(\"command/Commands\"),\n        Dialogs            = brackets.getModule(\"widgets/Dialogs\"),\n        DocumentManager    = brackets.getModule(\"document/DocumentManager\"),\n        EditorManager      = brackets.getModule(\"editor/EditorManager\"),\n        FileViewController = brackets.getModule(\"project/FileViewController\"),\n        FileSystem         = brackets.getModule(\"filesystem/FileSystem\"),\n        Menus              = brackets.getModule(\"command/Menus\"),\n        Mustache           = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        FindInFiles        = brackets.getModule(\"search/FindInFiles\"),\n        WorkspaceManager   = brackets.getModule(\"view/WorkspaceManager\"),\n        ProjectManager     = brackets.getModule(\"project/ProjectManager\"),\n        StringUtils        = brackets.getModule(\"utils/StringUtils\"),\n        Strings            = brackets.getModule(\"strings\"),\n        Metrics            = brackets.getModule(\"utils/Metrics\"),\n        NotificationUI = brackets.getModule(\"widgets/NotificationUI\"),\n        Constants          = require(\"src/Constants\"),\n        Git                = require(\"src/git/Git\"),\n        Events             = require(\"./Events\"),\n        EventEmitter       = require(\"./EventEmitter\"),\n        Preferences        = require(\"./Preferences\"),\n        Setup                    = require(\"src/utils/Setup\"),\n        ErrorHandler       = require(\"./ErrorHandler\"),\n        ExpectedError      = require(\"./ExpectedError\"),\n        Main               = require(\"./Main\"),\n        GutterManager      = require(\"./GutterManager\"),\n        Utils              = require(\"src/Utils\"),\n        ProgressDialog     = require(\"src/dialogs/Progress\");\n\n    const gitPanelTemplate            = `<div id=\"git-panel\" class=\"git bottom-panel vert-resizable top-resizer no-focus\">\n    <div class=\"toolbar simple-toolbar-layout mainToolbar\">\n\n        <!-- on left -->\n        <input type=\"checkbox\" class=\"check-all git-available\" />\n        <div class=\"btn-group git-available\">\n            <button title=\"{{S.TOOLTIP_COMMIT}}\" class=\"btn small git-commit\" disabled><i class=\"octicon octicon-git-commit\"></i><span>{{S.BUTTON_COMMIT}}</span></button>\n        </div>\n        <div class=\"git-available padding-right-small\">\n            <div class=\"btn-group git-rebase\">\n                <button title=\"{{S.TOOLTIP_REBASE_CONTINUE}}\" class=\"btn small git-rebase-continue\">\n                    <i class=\"octicon octicon-git-commit\"></i><span>{{S.BUTTON_REBASE_CONTINUE}}</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_REBASE_SKIP}}\" class=\"btn small git-rebase-skip\">\n                    <span>{{S.BUTTON_REBASE_SKIP}}</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_REBASE_ABORT}}\" class=\"btn small git-rebase-abort\">\n                    <span>{{S.BUTTON_REBASE_ABORT}}</span>\n                </button>\n                <!--\n                <button title=\"{{S.TOOLTIP_FIND_CONFLICTS}}\" class=\"btn small git-find-conflicts\">\n                    <span>{{S.BUTTON_FIND_CONFLICTS}}</span>\n                </button>\n                -->\n            </div>\n        </div>\n        <div class=\"git-available padding-right-small\">\n            <div class=\"btn-group git-merge\">\n                <button title=\"{{S.TOOLTIP_COMMIT}}\" class=\"btn small git-commit-merge\">\n                    <i class=\"octicon octicon-git-commit\"></i><span>{{S.BUTTON_COMMIT}}</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_MERGE_ABORT}}\" class=\"btn small git-merge-abort\">\n                    <span>{{S.BUTTON_MERGE_ABORT}}</span>\n                </button>\n                <!--\n                <button title=\"{{S.TOOLTIP_FIND_CONFLICTS}}\" class=\"btn small git-find-conflicts\">\n                    <span>{{S.BUTTON_FIND_CONFLICTS}}</span>\n                </button>\n                -->\n            </div>\n        </div>\n        <div class=\"btn-group git-available hide-when-x-small\">\n            <button title=\"{{S.GOTO_PREVIOUS_GIT_CHANGE}}\" class=\"btn small git-prev-gutter\"><i class=\"octicon octicon-arrow-up\"></i></button>\n            <button title=\"{{S.GOTO_NEXT_GIT_CHANGE}}\" class=\"btn small git-next-gutter\"><i class=\"octicon octicon-arrow-down\"></i></button>\n        </div>\n        <div class=\"btn-group git-available hide-when-x-small\">\n            <button title=\"{{S.TOOLTIP_SHOW_HISTORY}}\" class=\"btn small git-history-toggle\"><i class=\"octicon octicon-history\"></i></button>\n            <button title=\"{{S.TOOLTIP_SHOW_FILE_HISTORY}}\" class=\"btn small git-file-history\"><i class=\"octicon octicon-file-text\"></i></button>\n        </div>\n        <div class=\"btn-group git-not-available\">\n          <button title=\"{{S.TOOLTIP_INIT}}\" class=\"btn small git-init\"><i class=\"octicon octicon-repo-create\"></i><span>{{S.GIT_INIT}}</span></button>\n          <button title=\"{{S.TOOLTIP_CLONE}}\" class=\"btn small git-clone\"><i class=\"octicon octicon-repo-clone\"></i><span>{{S.GIT_CLONE}}</span></button>\n        </div>\n        <!-- this should be last on left -->\n        <div class=\"btn-group git-available hide-when-x-small\">\n            <button title=\"{{S.TOOLTIP_REFRESH_PANEL}}\" class=\"btn small git-refresh git-icon\"><i class=\"octicon octicon-sync\"></i></button>\n        </div>\n        <!-- on right -->\n        <div class=\"git-right-icons hide-when-small\">\n            <div class=\"btn-group git-available dropup\">\n                <ul class=\"dropdown-menu git-remotes-dropdown\"></ul>\n                <button type=\"button\" class=\"git-remotes btn small dropdown-toggle\" data-toggle=\"dropdown\" title=\"{{S.TOOLTIP_PICK_REMOTE}}\">\n                    <span class=\"caret\"></span>\n                    <span class=\"git-selected-remote\">&mdash;</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_FETCH}}\" class=\"btn small git-fetch\"><i class=\"octicon octicon-cloud-download\"></i></button>\n                <button title=\"{{S.TOOLTIP_PULL}}\" class=\"btn small git-pull\"><i class=\"octicon octicon-repo-pull\"></i></button>\n                <button title=\"{{S.TOOLTIP_PUSH}}\" class=\"btn small git-push\"><i class=\"octicon octicon-repo-push\"></i></button>\n            </div>\n        </div>\n        <div class=\"git-more-options-btn btn-alt-quiet\"><i class=\"fa-solid fa-ellipsis-vertical\"></i></div>\n        <a href=\"#\" class=\"close\">&times;</a>\n\n    </div>\n    <div class=\"table-container\" style=\"height: calc(100% - 42px);\"></div>\n</div>\n`,\n        gitPanelResultsTemplate     = `<table class=\"git-edited-list bottom-panel-table table table-striped table-condensed row-highlight\">\n    <tbody>\n        {{#files}}\n        <tr class=\"modified-file\" x-file=\"{{file}}\" x-status=\"{{status}}\">\n            <td class=\"checkbox-column\"><input type=\"checkbox\" class=\"check-one\" {{#staged}}checked=\"true\"{{/staged}} /></td>\n            <td class=\"icons-column\">\n                {{#allowDiff}}<button class=\"btn btn-mini btn-git-diff\" title=\"{{Strings.DIFF}}\"><i class=\"octicon octicon-diff\"></i></button>{{/allowDiff}}\n            </td>\n            <td class=\"status-column\">{{statusText}}</td>\n            <td>{{display}}</td>\n            <td>\n                <div class=\"btn-group\">\n                    {{#allowUndo}}   <button class=\"btn btn-mini btn-git-undo\">{{Strings.UNDO_CHANGES_BTN}}</button>  {{/allowUndo}}\n                    {{#allowDelete}} <button class=\"btn btn-mini btn-git-delete\">{{Strings.DELETE_FILE_BTN}}</button> {{/allowDelete}}\n                </div>\n            </td>\n        </tr>\n        {{/files}}\n    </tbody>\n</table>\n`,\n        gitAuthorsDialogTemplate    = `<div id=\"git-authors-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.AUTHORS_OF}} {{file}}</h1>\n    </div>\n    <div class=\"modal-body tab-content\">\n        <table class=\"table table-condensed\">\n            <tr>\n                <th>\n                    {{String.AUTHOR}}\n                </th>\n                <th>\n                </th>\n            </tr>\n            {{#blameStats}}\n            <tr>\n                <td>\n                    {{authorName}}\n                </td>\n                <td>\n                    {{percentage}}% ({{lines}} {{Strings._LINES}})\n                </td>\n            </tr>\n            {{/blameStats}}\n        </table>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\" class=\"dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n    </div>\n</div>\n`,\n        gitCommitDialogTemplate     = `<div id=\"git-commit-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <button class=\"extendedCommit btn pull-right\">{{Strings.EXTENDED_COMMIT_MESSAGE}}</button>\n        <label class=\"checkbox pull-right\" style=\"line-height: 28px; margin-right: 50px;\">\n            <input class=\"amend-commit\" type=\"checkbox\" style=\"margin-top: 10px;\" /> {{Strings.AMEND_COMMIT}}\n        </label>\n        <h1 class=\"dialog-title\">{{Strings.GIT_COMMIT}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <div>\n            <div class=\"accordion\">\n                <!-- Hidden checkbox to toggle the accordion -->\n                <input type=\"checkbox\" id=\"codeInspectionToggle\" class=\"accordion-toggle\" />\n                <label for=\"codeInspectionToggle\" class=\"accordion-header\">\n                    <span class=\"accordion-title\">{{Strings.CODE_INSPECTION_IN_PROGRESS}}</span>\n                    <i class=\"fas fa-chevron-down\"></i>\n                    <div class=\"accordion-progress-bar\">\n                        <div class=\"accordion-progress-bar-inner\"></div>\n                    </div>\n                </label>\n                <div class=\"accordion-content lint-errors\">\n                    {{Strings.PLEASE_WAIT}}\n                </div>\n            </div>\n        </div>\n        <div class=\"commit-diff\"></div>\n        <div class=\"commit-message-box\">\n            <input name=\"commit-message\" type=\"text\" placeholder=\"{{Strings.COMMIT_MESSAGE_PLACEHOLDER}}\" autocomplete=\"off\" />\n            <textarea name=\"commit-message\" type=\"text\" placeholder=\"{{Strings.COMMIT_MESSAGE_PLACEHOLDER}}\" autocomplete=\"off\" style=\"display: none;\"></textarea>\n            <input name=\"commit-message-count\" readonly=\"readonly\" type=\"text\" tabindex=\"-1\" />\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <label class=\"checkbox pull-left\" style=\"line-height: 28px; margin-right: 50px;\">\n            <input class=\"commit-no-verify\" type=\"checkbox\" style=\"margin-top: 10px;\" /> {{Strings.SKIP_COMMIT_CHECKS}}\n        </label>\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`,\n        gitCommitLintResultTemplate = `<ul>\n    {{#lintResults}}\n    {{#hasErrors}}\n    <li>\n        {{filename}}\n        <ul>\n            {{#errors}}\n            <li>\n                <a class=\"lint-error-commit-link\" data-file=\"{{file}}\" data-line=\"{{line}}\" data-ch=\"{{ch}}\" style=\"cursor: pointer\">\n                    {{errorLineMessage}}\n                </a>\n            </li>\n            {{/errors}}\n        </ul>\n    </li>\n    {{/hasErrors}}\n    {{/lintResults}}\n</ul>\n`,\n        gitDiffDialogTemplate       = `<div id=\"git-diff-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{{Strings.GIT_DIFF}}} {{file}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <div class=\"commit-diff\"></div>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\" class=\"dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n    </div>\n</div>\n`,\n        questionDialogTemplate      = `<div id=\"git-question-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <p>{{{question}}}</p>\n        {{#stringInput}}\n        <input class=\"stringInput\" type=\"text\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/stringInput}}\n        {{#passwordInput}}\n        <input class=\"stringInput\" type=\"password\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/passwordInput}}\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn btn-80 {{#customOkBtnClass}}{{customOkBtnClass}}{{/customOkBtnClass}}{{^customOkBtnClass}}primary{{/customOkBtnClass}}\">\n            {{#customOkBtn}}{{customOkBtn}}{{/customOkBtn}}{{^customOkBtn}}{{Strings.BUTTON_OK}}{{/customOkBtn}}\n        </button>\n    </div>\n</div>\n`;\n\n    const showFileWhiteList = /^\\.gitignore$/,\n        GIT_PANEL_SHOWN_ON_FIRST_BOOT = \"GIT_PANEL_SHOWN_ON_FIRST_BOOT\";\n\n    const COMMIT_MODE = {\n        CURRENT: \"CURRENT\",\n        ALL: \"ALL\",\n        DEFAULT: \"DEFAULT\"\n    };\n\n    var gitPanel = null,\n        $gitPanel = $(null),\n        $mainToolbar,\n        gitPanelDisabled = null,\n        gitPanelMode = null,\n        showingUntracked = true,\n        $tableContainer = $(null),\n        lastCommitMessage = {};\n\n    function lintFile(filename) {\n        var fullPath = Preferences.get(\"currentGitRoot\") + filename,\n            codeInspectionPromise;\n\n        try {\n            codeInspectionPromise = CodeInspection.inspectFile(FileSystem.getFileForPath(fullPath));\n        } catch (e) {\n            ErrorHandler.logError(\"CodeInspection.inspectFile failed to execute for file \" + fullPath);\n            ErrorHandler.logError(e);\n            codeInspectionPromise = Promise.reject(e);\n        }\n\n        return jsPromise(codeInspectionPromise);\n    }\n\n    function _makeDialogBig($dialog) {\n        var $wrapper = $dialog.parents(\".modal-wrapper\").first();\n        if ($wrapper.length === 0) { return; }\n\n        $dialog\n            .width(\"80%\")\n            .children(\".modal-body\")\n                .css(\"max-height\", \"72vh\")\n            .end();\n    }\n\n    function _showCommitDialog(stagedDiff, prefilledMessage, commitMode, files) {\n        // Open the dialog\n        const compiledTemplate = Mustache.render(gitCommitDialogTemplate, {Strings: Strings}),\n            dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog          = dialog.getElement();\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"showDialog\");\n        let totalLintErrors = 0;\n        inspectFiles(files, $dialog).then(function (lintResults) {\n            // Flatten the error structure from various providers\n            lintResults = lintResults || [];\n            lintResults.forEach(function (lintResult) {\n                lintResult.errors = [];\n                const lintingFilePath = path.join(ProjectManager.getProjectRoot().fullPath, lintResult.filename);\n                if (Array.isArray(lintResult.result)) {\n                    lintResult.result.forEach(function (resultSet) {\n                        if (!resultSet.result || !resultSet.result.errors) { return; }\n\n                        var providerName = resultSet.provider.name;\n                        resultSet.result.errors.forEach(function (e) {\n                            lintResult.errors.push({\n                                errorLineMessage: (e.pos.line + 1) + \": \" + e.message + \" (\" + providerName + \")\",\n                                line: e.pos.line,\n                                ch: e.pos.ch,\n                                file: lintingFilePath\n                            });\n                        });\n                    });\n                } else {\n                    ErrorHandler.logError(\"[brackets-git] lintResults contain object in unexpected format: \" + JSON.stringify(lintResult));\n                }\n                lintResult.hasErrors = lintResult.errors.length > 0;\n                totalLintErrors += lintResult.errors.length;\n            });\n\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"lintErr\" + Metrics.getRangeName(totalLintErrors));\n\n            // Filter out only results with errors to show\n            lintResults = _.filter(lintResults, function (lintResult) {\n                return lintResult.hasErrors;\n            });\n            const compiledResultHTML = Mustache.render(gitCommitLintResultTemplate, {\n                    Strings: Strings,\n                    lintResults: lintResults\n                });\n            if(!$dialog || !$dialog.is(\":visible\")) {\n                return;\n            }\n            $dialog.find(\".accordion-title\").html(Strings.CODE_INSPECTION_PROBLEMS);\n            if(!lintResults.length){\n                $dialog.find(\".lint-errors\").html(Strings.CODE_INSPECTION_PROBLEMS_NONE);\n                $dialog.find(\".accordion\").addClass(\"forced-hidden\");\n                return;\n            }\n            $dialog.find(\".lint-errors\").html(compiledResultHTML);\n            if(!$dialog.find(\".lint-errors\").is(\":visible\")){\n                $dialog.find(\".accordion-toggle\").click();\n            }\n            $dialog.find(\".lint-error-commit-link\").click((e)=>{\n                e.preventDefault();\n                const $el = $(e.target);\n                const fileToOpen = $el.data(\"file\"),\n                    line = $el.data(\"line\"),\n                    ch = $el.data(\"ch\");\n                CommandManager.execute(Commands.FILE_OPEN, {fullPath: fileToOpen})\n                    .done(()=>{\n                        EditorManager.getCurrentFullEditor().setCursorPos(line, ch, true);\n                    });\n                dialog.close();\n            });\n        });\n\n        // We need bigger commit dialog\n        _makeDialogBig($dialog);\n\n        // Show nicely colored commit diff\n        const diff = Utils.formatDiff(stagedDiff);\n        if(diff === Utils.FORMAT_DIFF_TOO_LARGE) {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"diffTooLarge\");\n        }\n        $dialog.find(\".commit-diff\").append(diff);\n\n        // Enable / Disable amend checkbox\n        var toggleAmendCheckbox = function (bool) {\n            $dialog.find(\".amend-commit\")\n                .prop(\"disabled\", !bool)\n                .parent()\n                .attr(\"title\", !bool ? Strings.AMEND_COMMIT_FORBIDDEN : null);\n        };\n        toggleAmendCheckbox(false);\n\n        Git.getCommitCounts()\n            .then(function (commits) {\n                var hasRemote = $gitPanel.find(\".git-selected-remote\").data(\"remote\") != null;\n                var hasCommitsAhead = commits.ahead > 0;\n                toggleAmendCheckbox(!hasRemote || hasRemote && hasCommitsAhead);\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n            });\n\n        function getCommitMessageElement() {\n            var r = $dialog.find(\"[name='commit-message']:visible\");\n            if (r.length !== 1) {\n                r = $dialog.find(\"[name='commit-message']\");\n                for (var i = 0; i < r.length; i++) {\n                    if ($(r[i]).css(\"display\") !== \"none\") {\n                        return $(r[i]);\n                    }\n                }\n            }\n            return r;\n        }\n\n        var $commitMessageCount = $dialog.find(\"input[name='commit-message-count']\");\n\n        // Add event to count characters in commit message\n        var recalculateMessageLength = function () {\n            var val = getCommitMessageElement().val().trim(),\n                length = val.length;\n\n            if (val.indexOf(\"\\n\")) {\n                // longest line\n                length = Math.max.apply(null, val.split(\"\\n\").map(function (l) { return l.length; }));\n            }\n\n            $commitMessageCount\n                .val(length)\n                .toggleClass(\"over50\", length > 50 && length <= 100)\n                .toggleClass(\"over100\", length > 100);\n        };\n\n        var usingTextArea = false;\n\n        // commit message handling\n        function switchCommitMessageElement() {\n            usingTextArea = !usingTextArea;\n\n            var findStr = \"[name='commit-message']\",\n                currentValue = $dialog.find(findStr + \":visible\").val();\n            $dialog.find(findStr).toggle();\n            $dialog.find(findStr + \":visible\")\n                .val(currentValue)\n                .focus();\n            recalculateMessageLength();\n        }\n\n        $dialog.find(\"button.primary\").on(\"click\", function (e) {\n            var $commitMessage = getCommitMessageElement();\n            if ($commitMessage.val().trim().length === 0) {\n                e.stopPropagation();\n                $commitMessage.addClass(\"invalid\");\n            } else {\n                $commitMessage.removeClass(\"invalid\");\n            }\n        });\n\n        $dialog.find(\"button.extendedCommit\").on(\"click\", function () {\n            switchCommitMessageElement();\n            // this value will be set only when manually triggered\n            Preferences.set(\"useTextAreaForCommitByDefault\", usingTextArea);\n        });\n\n        function prefillMessage(msg) {\n            if (msg.indexOf(\"\\n\") !== -1 && !usingTextArea) {\n                switchCommitMessageElement();\n            }\n            $dialog.find(\"[name='commit-message']:visible\").val(msg);\n            recalculateMessageLength();\n        }\n\n        // Assign action to amend checkbox\n        $dialog.find(\".amend-commit\").on(\"click\", function () {\n            if ($(this).prop(\"checked\") === false) {\n                prefillMessage(\"\");\n            } else {\n                Git.getLastCommitMessage().then(function (msg) {\n                    prefillMessage(msg);\n                });\n            }\n        });\n\n        if (Preferences.get(\"useTextAreaForCommitByDefault\")) {\n            switchCommitMessageElement();\n        }\n\n        if (prefilledMessage) {\n            prefillMessage(prefilledMessage.trim());\n        }\n\n        // Add focus to commit message input\n        getCommitMessageElement().focus();\n\n        $dialog.find(\"[name='commit-message']\")\n            .on(\"keyup\", recalculateMessageLength)\n            .on(\"change\", recalculateMessageLength);\n        recalculateMessageLength();\n\n        dialog.done(function (buttonId) {\n            const commitMessageElement = getCommitMessageElement();\n            if(commitMessageElement){\n                lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = commitMessageElement.val();\n            }\n            if (buttonId === \"ok\") {\n                if (commitMode === COMMIT_MODE.ALL || commitMode === COMMIT_MODE.CURRENT) {\n                    var filePaths = _.map(files, function (next) {\n                        return next.file;\n                    });\n                    Git.stage(filePaths)\n                    .then(function () {\n                        return _getStagedDiff();\n                    })\n                    .then(function (diff) {\n                        _doGitCommit($dialog, getCommitMessageElement, diff);\n                    })\n                    .catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CANT_GET_STAGED_DIFF);\n                    });\n                } else {\n                    _doGitCommit($dialog, getCommitMessageElement, stagedDiff);\n                }\n            } else {\n                Git.status();\n            }\n        });\n    }\n\n    function _doGitCommit($dialog, getCommitMessageElement, stagedDiff) {\n        // this event won't launch when commit-message is empty so its safe to assume that it is not\n        var commitMessage = getCommitMessageElement().val(),\n            amendCommit = $dialog.find(\".amend-commit\").prop(\"checked\"),\n            noVerify = $dialog.find(\".commit-no-verify\").prop(\"checked\");\n\n        // if commit message is extended and has a newline, put an empty line after first line to separate subject and body\n        var s = commitMessage.split(\"\\n\");\n        if (s.length > 1 && s[1].trim() !== \"\") {\n            s.splice(1, 0, \"\");\n        }\n        commitMessage = s.join(\"\\n\");\n\n        // save lastCommitMessage in case the commit will fail\n        lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = commitMessage;\n\n        // now we are going to be paranoid and we will check if some mofo didn't change our diff\n        _getStagedDiff().then(function (diff) {\n            if (diff === stagedDiff) {\n                const tracker = ProgressDialog.newProgressTracker();\n                return ProgressDialog.show(Git.commit(commitMessage, amendCommit, noVerify, tracker),\n                    tracker, {\n                        title: Strings.GIT_COMMIT_IN_PROGRESS,\n                        options: { preDelay: 1, postDelay: 1 }\n                    })\n                    .then(function () {\n                        // clear lastCommitMessage because the commit was successful\n                        lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = null;\n                    });\n            } else {\n                throw new ExpectedError(Strings.ERROR_MODIFIED_DIALOG_FILES);\n            }\n        }).then(()=>{\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"success\");\n        }).catch(function (err) {\n            if (ErrorHandler.contains(err, \"Please tell me who you are\")) {\n                return new Promise((resolve)=>{\n                    EventEmitter.emit(Events.GIT_CHANGE_USERNAME, function () {\n                        EventEmitter.emit(Events.GIT_CHANGE_EMAIL, function () {\n                            resolve();\n                        });\n                    });\n                });\n            }\n\n            ErrorHandler.showError(err, Strings.ERROR_GIT_COMMIT_FAILED, {errorMetric: \"commit\"});\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"fail\");\n\n        }).finally(function () {\n            EventEmitter.emit(Events.GIT_COMMITED);\n            refresh();\n        });\n    }\n\n    function _showAuthors(file, blame, fromLine, toLine) {\n        var linesTotal = blame.length;\n        var blameStats = blame.reduce(function (stats, lineInfo) {\n            var name = lineInfo.author + \" \" + lineInfo[\"author-mail\"];\n            if (stats[name]) {\n                stats[name] += 1;\n            } else {\n                stats[name] = 1;\n            }\n            return stats;\n        }, {});\n        blameStats = _.reduce(blameStats, function (arr, val, key) {\n            arr.push({\n                authorName: key,\n                lines: val,\n                percentage: Math.round(val / (linesTotal / 100))\n            });\n            return arr;\n        }, []);\n        blameStats = _.sortBy(blameStats, \"lines\").reverse();\n\n        if (fromLine || toLine) {\n            file += \" (\" + Strings.LINES + \" \" + fromLine + \"-\" + toLine + \")\";\n        }\n\n        var compiledTemplate = Mustache.render(gitAuthorsDialogTemplate, {\n                file: file,\n                blameStats: blameStats,\n                Strings: Strings\n            });\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n    }\n\n    function _getCurrentFilePath(editor) {\n        var gitRoot = Preferences.get(\"currentGitRoot\"),\n            document = editor ? editor.document : DocumentManager.getCurrentDocument(),\n            filePath = document.file.fullPath;\n        if (filePath.indexOf(gitRoot) === 0) {\n            filePath = filePath.substring(gitRoot.length);\n        }\n        return filePath;\n    }\n\n    function handleAuthorsSelection() {\n        var editor = EditorManager.getActiveEditor(),\n            filePath = _getCurrentFilePath(editor),\n            currentSelection = editor.getSelection(),\n            fromLine = currentSelection.start.line + 1,\n            toLine = currentSelection.end.line + 1;\n\n        // fix when nothing is selected on that line\n        if (currentSelection.end.ch === 0) { toLine = toLine - 1; }\n\n        var isSomethingSelected = currentSelection.start.line !== currentSelection.end.line ||\n                                  currentSelection.start.ch !== currentSelection.end.ch;\n        if (!isSomethingSelected) {\n            ErrorHandler.showError(new ExpectedError(Strings.ERROR_NOTHING_SELECTED));\n            return;\n        }\n\n        if (editor.document.isDirty) {\n            ErrorHandler.showError(new ExpectedError(Strings.ERROR_SAVE_FIRST));\n            return;\n        }\n\n        Git.getBlame(filePath, fromLine, toLine).then(function (blame) {\n            return _showAuthors(filePath, blame, fromLine, toLine);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GIT_BLAME_FAILED);\n        });\n    }\n\n    function handleAuthorsFile() {\n        var filePath = _getCurrentFilePath();\n        Git.getBlame(filePath).then(function (blame) {\n            return _showAuthors(filePath, blame);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GIT_BLAME_FAILED);\n        });\n    }\n\n    function handleGitDiff(file) {\n        if (Preferences.get(\"useDifftool\")) {\n            Git.difftool(file);\n        } else {\n            Git.diffFileNice(file).then(function (diff) {\n                // show the dialog with the diff\n                var compiledTemplate = Mustache.render(gitDiffDialogTemplate, { file: file, Strings: Strings }),\n                    dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n                    $dialog          = dialog.getElement();\n                _makeDialogBig($dialog);\n                const diffVal = Utils.formatDiff(diff);\n                if(diffVal === Utils.FORMAT_DIFF_TOO_LARGE) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"diffTooLarge\");\n                } else {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"success\");\n                }\n                $dialog.find(\".commit-diff\").append(diffVal);\n            }).catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"error\");\n                ErrorHandler.showError(err, Strings.ERROR_GIT_DIFF_FAILED);\n            });\n        }\n    }\n\n    function handleGitUndo(file) {\n        var compiledTemplate = Mustache.render(questionDialogTemplate, {\n            title: Strings.UNDO_CHANGES,\n            question: StringUtils.format(Strings.Q_UNDO_CHANGES, _.escape(file)),\n            Strings: Strings\n        });\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate).done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                Git.discardFileChanges(file).then(function () {\n                    var gitRoot = Preferences.get(\"currentGitRoot\");\n                    DocumentManager.getAllOpenDocuments().forEach(function (doc) {\n                        if (doc.file.fullPath === gitRoot + file) {\n                            Utils.reloadDoc(doc);\n                        }\n                    });\n                    refresh();\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_DISCARD_CHANGES_FAILED);\n                });\n            }\n        });\n    }\n\n    function handleGitDelete(file) {\n        FileSystem.resolve(Preferences.get(\"currentGitRoot\") + file, function (err, fileEntry) {\n            if (err) {\n                ErrorHandler.showError(err, Strings.ERROR_COULD_NOT_RESOLVE_FILE);\n                return;\n            }\n            CommandManager.execute(Commands.FILE_DELETE, {file: fileEntry});\n        });\n    }\n\n    function _getStagedDiff(commitMode, files = []) {\n        const tracker = ProgressDialog.newProgressTracker();\n        const fileNamesString = files.map(file => file.file).join(\", \");\n        return ProgressDialog.show(_getStagedDiffForCommitMode(commitMode, files), tracker, {\n            title: Strings.GETTING_STAGED_DIFF_PROGRESS,\n            initialMessage: `${fileNamesString}\\n${Strings.PLEASE_WAIT}`,\n            options: { preDelay: 3, postDelay: 1 }\n        })\n        .catch(function (err) {\n            if (ErrorHandler.contains(err, \"cleanup\")) {\n                return false; // will display list of staged files instead\n            }\n            throw err;\n        })\n        .then(function (diff) {\n            if (!diff) {\n                return Git.getListOfStagedFiles().then(function (filesList) {\n                    return Strings.DIFF_FAILED_SEE_FILES + \"\\n\\n\" + filesList;\n                });\n            }\n            return diff;\n        });\n    }\n\n    function _getStagedDiffForCommitMode(commitMode, files) {\n\n        if (commitMode === COMMIT_MODE.ALL) {\n            return _getStaggedDiffForAllFiles();\n        }\n\n        if (commitMode === COMMIT_MODE.CURRENT && _.isArray(files)) {\n            if (files.length > 1) {\n                return Promise.reject(\"_getStagedDiffForCommitMode() got files.length > 1\");\n            }\n\n            var isUntracked = files[0].status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1;\n            if (isUntracked) {\n                return _getDiffForUntrackedFiles(files[0].file);\n            } else {\n                return Git.getDiffOfAllIndexFiles(files[0].file);\n            }\n        }\n\n        return Git.getDiffOfStagedFiles();\n    }\n\n    function _getStaggedDiffForAllFiles() {\n        return Git.status().then(function (statusFiles) {\n            var untrackedFiles = [];\n            var fileArray = [];\n\n            statusFiles.forEach(function (fileObject) {\n                var isUntracked = fileObject.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1;\n                if (isUntracked) {\n                    untrackedFiles.push(fileObject.file);\n                } else {\n                    fileArray.push(fileObject.file);\n                }\n            });\n\n            if (untrackedFiles.length > 0) {\n                return _getDiffForUntrackedFiles(fileArray.concat(untrackedFiles));\n            } else {\n                return Git.getDiffOfAllIndexFiles(fileArray);\n            }\n        });\n    }\n\n    function _getDiffForUntrackedFiles(files) {\n        var diff;\n        return Git.stage(files, false)\n            .then(function () {\n                return Git.getDiffOfStagedFiles();\n            })\n            .then(function (_diff) {\n                diff = _diff;\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return diff;\n            });\n    }\n\n    // whatToDo gets values \"continue\" \"skip\" \"abort\"\n    function handleRebase(whatToDo) {\n        Git.rebase(whatToDo).then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, \"Rebase \" + whatToDo + \" failed\");\n        });\n    }\n\n    function abortMerge() {\n        Git.discardAllChanges().then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_MERGE_ABORT_FAILED);\n        });\n    }\n\n    function findConflicts() {\n        FindInFiles.doSearch(/^<<<<<<<\\s|^=======\\s|^>>>>>>>\\s/gm);\n    }\n\n    function commitMerge() {\n        Utils.loadPathContent(Preferences.get(\"currentGitRoot\") + \"/.git/MERGE_MSG\").then(function (msg) {\n            handleGitCommit(msg, true, COMMIT_MODE.DEFAULT);\n            EventEmitter.once(Events.GIT_COMMITED, function () {\n                EventEmitter.emit(Events.REFRESH_ALL);\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, \"Merge commit failed\");\n        });\n    }\n\n    function inspectFiles(gitStatusResults, $dialog) {\n        const lintResults = [];\n        let totalFiles = gitStatusResults.length,\n            totalFilesLinted = 0,\n            filesDone = 0;\n        function showProgress() {\n            const $progressBar = $dialog.find('.accordion-progress-bar-inner');\n            if ($progressBar.length) {\n                $progressBar[0].style.width = `${filesDone/totalFiles*100}%`;\n            }\n            if(filesDone === totalFiles){\n                $dialog.find('.accordion-progress-bar').addClass(\"forced-inVisible\");\n            }\n            const progressString = StringUtils.format(Strings.CODE_INSPECTION_DONE_FILES, filesDone, totalFiles);\n            $dialog.find(\".lint-errors\").html(progressString);\n        }\n\n        const codeInspectionPromises = gitStatusResults.map(function (fileObj) {\n            const isDeleted = fileObj.status.indexOf(Git.FILE_STATUS.DELETED) !== -1;\n            if(isDeleted){\n                filesDone++;\n                showProgress();\n                return;\n            }\n\n            // Do a code inspection for the file, if it was not deleted\n            return new Promise((resolve) => {\n                // Delay lintFile execution to give the event loop some breathing room\n                setTimeout(() => {\n                    lintFile(fileObj.file)\n                        .catch(function () {\n                            return [\n                                {\n                                    provider: { name: \"See console [F12] for details\" },\n                                    result: {\n                                        errors: [\n                                            {\n                                                pos: { line: 0, ch: 0 },\n                                                message: \"CodeInspection failed to execute for this file.\"\n                                            }\n                                        ]\n                                    }\n                                }\n                            ];\n                        })\n                        .then(function (result) {\n                            if (result) {\n                                lintResults.push({\n                                    filename: fileObj.file,\n                                    result: result\n                                });\n                            }\n                            resolve();\n                        }).finally(()=>{\n                            filesDone++;\n                            totalFilesLinted++;\n                            showProgress();\n                        });\n                }, 0); // Delay of 0ms to defer to the next tick of the event loop\n            });\n        });\n\n        return Promise.all(_.compact(codeInspectionPromises)).then(function () {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"files\" + Metrics.getRangeName(totalFiles));\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"lint\" + Metrics.getRangeName(totalFilesLinted));\n            return lintResults;\n        });\n    }\n\n\n    function handleGitCommit(prefilledMessage, isMerge, commitMode) {\n        if(Utils.isLoading($gitPanel.find(\".git-commit\"))){\n            return;\n        }\n\n        var stripWhitespace = Preferences.get(\"stripWhitespaceFromCommits\");\n\n        // Disable button (it will be enabled when selecting files after reset)\n        Utils.setLoading($gitPanel.find(\".git-commit\"));\n\n        var p;\n\n        // First reset staged files, then add selected files to the index.\n        if (commitMode === COMMIT_MODE.DEFAULT) {\n            p = Git.status().then(function (files) {\n                files = _.filter(files, function (file) {\n                    return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1;\n                });\n\n                if (files.length === 0 && !isMerge) {\n                    return ErrorHandler.showError(\n                        new Error(\"Commit button should have been disabled\"),\n                        \"Nothing staged to commit\"\n                    );\n                }\n\n                return handleGitCommitInternal(stripWhitespace,\n                                               files,\n                                               commitMode,\n                                               prefilledMessage);\n            });\n        } else if (commitMode === COMMIT_MODE.ALL) {\n            p = Git.status().then(function (files) {\n                return handleGitCommitInternal(stripWhitespace,\n                                               files,\n                                               commitMode,\n                                               prefilledMessage);\n            });\n        } else if (commitMode === COMMIT_MODE.CURRENT) {\n            p = Git.status().then(function (files) {\n                var gitRoot = Preferences.get(\"currentGitRoot\");\n                var currentDoc = DocumentManager.getCurrentDocument();\n                if (currentDoc) {\n                    var relativePath = currentDoc.file.fullPath.substring(gitRoot.length);\n                    var currentFile = _.filter(files, function (next) {\n                        return relativePath === next.file;\n                    });\n                    return handleGitCommitInternal(stripWhitespace, currentFile, commitMode, prefilledMessage);\n                }\n            });\n        }\n\n        p.catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_PREPARING_COMMIT_DIALOG);\n        }).finally(function () {\n            Utils.unsetLoading($gitPanel.find(\".git-commit\"));\n        });\n\n    }\n\n    function handleGitCommitInternal(stripWhitespace, files, commitMode, prefilledMessage) {\n        let queue = Promise.resolve();\n\n        if (stripWhitespace) {\n            queue = queue.then(function () {\n                const tracker = ProgressDialog.newProgressTracker();\n                return ProgressDialog.show(\n                    Utils.stripWhitespaceFromFiles(files, commitMode === COMMIT_MODE.DEFAULT, tracker),\n                    tracker, {\n                        title: Strings.CLEANING_WHITESPACE_PROGRESS,\n                        options: { preDelay: 3, postDelay: 1 }\n                    }\n                );\n            });\n        }\n\n        return queue.then(function () {\n            // All files are in the index now, get the diff and show dialog.\n            return _getStagedDiff(commitMode, files).then(function (diff) {\n                return _showCommitDialog(diff, prefilledMessage, commitMode, files);\n            });\n        });\n    }\n\n    function refreshCurrentFile() {\n        var gitRoot = Preferences.get(\"currentGitRoot\");\n        var currentDoc = DocumentManager.getCurrentDocument();\n        if (currentDoc) {\n            $gitPanel.find(\"tr\").each(function () {\n                var currentFullPath = currentDoc.file.fullPath,\n                    thisFile = $(this).attr(\"x-file\");\n                $(this).toggleClass(\"selected\", gitRoot + thisFile === currentFullPath);\n            });\n        } else {\n            $gitPanel.find(\"tr\").removeClass(\"selected\");\n        }\n    }\n\n    function shouldShow(fileObj) {\n        if (showFileWhiteList.test(fileObj.name)) {\n            return true;\n        }\n        return ProjectManager.shouldShow(fileObj);\n    }\n\n    function _refreshTableContainer(files) {\n        if (!gitPanel.isVisible()) {\n            return;\n        }\n\n        // remove files that we should not show\n        files = _.filter(files, function (file) {\n            return shouldShow(file);\n        });\n\n        var allStaged = files.length > 0 && _.all(files, function (file) { return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1; });\n        $gitPanel.find(\".check-all\").prop(\"checked\", allStaged).prop(\"disabled\", files.length === 0);\n\n        var $editedList = $tableContainer.find(\".git-edited-list\");\n        var visibleBefore = $editedList.length ? $editedList.is(\":visible\") : true;\n        $editedList.remove();\n\n        if (files.length === 0) {\n            $tableContainer.append($(\"<p class='git-edited-list nothing-to-commit' />\").text(Strings.NOTHING_TO_COMMIT));\n        } else {\n            // if desired, remove untracked files from the results\n            if (showingUntracked === false) {\n                files = _.filter(files, function (file) {\n                    return file.status.indexOf(Git.FILE_STATUS.UNTRACKED) === -1;\n                });\n            }\n            // -\n            files.forEach(function (file) {\n                file.staged = file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1;\n                file.statusText = file.status.map(function (status) {\n                    return Strings[\"FILE_\" + status];\n                }).join(\", \");\n                file.allowDiff = file.status.indexOf(Git.FILE_STATUS.UNTRACKED) === -1 &&\n                                 file.status.indexOf(Git.FILE_STATUS.RENAMED) === -1 &&\n                                 file.status.indexOf(Git.FILE_STATUS.DELETED) === -1;\n                file.allowDelete = file.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1 ||\n                                   file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1 &&\n                                   file.status.indexOf(Git.FILE_STATUS.ADDED) !== -1;\n                file.allowUndo = !file.allowDelete;\n            });\n            $tableContainer.append(Mustache.render(gitPanelResultsTemplate, {\n                files: files,\n                Strings: Strings\n            }));\n\n            refreshCurrentFile();\n        }\n        $tableContainer.find(\".git-edited-list\").toggle(visibleBefore);\n    }\n\n    function _setName(commandID, newName) {\n        const command = CommandManager.get(commandID);\n        if (command) {\n            command.setName(newName);\n        }\n    }\n\n    function refreshCommitCounts() {\n        // Find Push and Pull buttons\n        var $pullBtn = $gitPanel.find(\".git-pull\");\n        var $pushBtn = $gitPanel.find(\".git-push\");\n        var clearCounts = function () {\n            $pullBtn.children(\"span\").remove();\n            $pushBtn.children(\"span\").remove();\n            _setName(Constants.CMD_GIT_PULL, Strings.PULL_SHORTCUT);\n            _setName(Constants.CMD_GIT_PUSH, Strings.PUSH_SHORTCUT);\n        };\n\n        // Check if there's a remote, resolve if there's not\n        var remotes = Preferences.get(\"defaultRemotes\") || {};\n        var defaultRemote = remotes[Preferences.get(\"currentGitRoot\")];\n        if (!defaultRemote) {\n            clearCounts();\n            return Promise.resolve();\n        }\n\n        // Get the commit counts and append them to the buttons\n        return Git.getCommitCounts().then(function (commits) {\n            clearCounts();\n            if (commits.behind > 0) {\n                $pullBtn.append($(\"<span/>\").text(\" (\" + commits.behind + \")\"));\n                _setName(Constants.CMD_GIT_PULL,\n                    StringUtils.format(Strings.PULL_SHORTCUT_BEHIND, commits.behind));\n            }\n            if (commits.ahead > 0) {\n                $pushBtn.append($(\"<span/>\").text(\" (\" + commits.ahead + \")\"));\n                _setName(Constants.CMD_GIT_PUSH,\n                    StringUtils.format(Strings.PUSH_SHORTCUT_AHEAD, commits.ahead));\n            }\n        }).catch(function (err) {\n            clearCounts();\n            ErrorHandler.logError(err);\n        });\n    }\n\n    function refresh() {\n        // set the history panel to false and remove the class that show the button history active when refresh\n        $gitPanel.find(\".git-history-toggle\").removeClass(\"active\").attr(\"title\", Strings.TOOLTIP_SHOW_HISTORY);\n        $gitPanel.find(\".git-file-history\").removeClass(\"active\").attr(\"title\", Strings.TOOLTIP_SHOW_FILE_HISTORY);\n\n        if (gitPanelMode === \"not-repo\") {\n            $tableContainer.empty();\n            return Promise.resolve();\n        }\n\n        $tableContainer.find(\"#git-history-list\").remove();\n        $tableContainer.find(\".git-edited-list\").show();\n\n        var p1 = Git.status().catch(function (err) {\n            // this is an expected \"error\"\n            if (ErrorHandler.contains(err, \"Not a git repository\")) {\n                return;\n            }\n        });\n\n        var p2 = refreshCommitCounts();\n\n        // Clone button\n        $gitPanel.find(\".git-clone\").prop(\"disabled\", false);\n\n        // FUTURE: who listens for this?\n        return Promise.all([p1, p2]);\n    }\n\n    function toggle(bool) {\n        if (gitPanelDisabled === true) {\n            return;\n        }\n        if (typeof bool !== \"boolean\") {\n            bool = !gitPanel.isVisible();\n        }\n        Preferences.set(\"panelEnabled\", bool);\n        Main.$icon.toggleClass(\"on\", bool);\n        Main.$icon.toggleClass(\"selected-button\", bool);\n        gitPanel.setVisible(bool);\n\n        // Mark menu item as enabled/disabled.\n        CommandManager.get(Constants.CMD_GIT_TOGGLE_PANEL).setChecked(bool);\n\n        if (bool) {\n            $(\"#git-toolbar-icon\").removeClass(\"forced-hidden\");\n            refresh();\n        }\n    }\n\n    function handleToggleUntracked() {\n        showingUntracked = !showingUntracked;\n        const command = CommandManager.get(Constants.CMD_GIT_TOGGLE_UNTRACKED);\n        if (command) {\n            command.setChecked(!showingUntracked);\n        }\n\n        refresh();\n    }\n\n    function commitCurrentFile() {\n        // do not return anything here, core expects jquery promise\n        jsPromise(CommandManager.execute(\"file.save\"))\n            .then(function () {\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath],\n                    false, COMMIT_MODE.CURRENT);\n            }).catch((err)=>{\n                console.error(err);\n                // rethrowing with stripped git error details as it may have sensitive info\n                throw new Error(\"Error commitCurrentFile in git panel.js. this should not have happened here.\");\n            });\n    }\n\n    function commitAllFiles() {\n        // do not return anything here, core expects jquery promise\n        jsPromise(CommandManager.execute(\"file.saveAll\"))\n            .then(function () {\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath],\n                    false, COMMIT_MODE.ALL);\n            }).catch((err)=>{\n                console.error(err);\n                // rethrowing with stripped git error details as it may have sensitive info\n                throw new Error(\"Error commitAllFiles in git panel.js. this should not have happened here.\");\n            });\n    }\n\n    // Disable \"commit\" button if there aren't staged files to commit\n    function _toggleCommitButton(files) {\n        var anyStaged = _.any(files, function (file) { return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1; });\n        $gitPanel.find(\".git-commit\").prop(\"disabled\", !anyStaged);\n    }\n\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (results) {\n        _refreshTableContainer(results);\n        _toggleCommitButton(results);\n    });\n\n    function undoLastLocalCommit() {\n        return Utils.askQuestion(Strings.UNDO_COMMIT, Strings.UNDO_LOCAL_COMMIT_CONFIRM, {booleanResponse: true})\n            .then(function (response) {\n                if (response) {\n                    Git.undoLastLocalCommit()\n                        .catch(function (err) {\n                            ErrorHandler.showError(err, Strings.ERROR_UNDO_LAST_COMMIT_FAILED);\n                        })\n                        .finally(function () {\n                            refresh();\n                        });\n                }\n            });\n    }\n\n    var lastCheckOneClicked = null;\n\n    function attachDefaultTableHandlers() {\n        $tableContainer = $gitPanel.find(\".table-container\")\n            .off()\n            .on(\"click\", \".check-one\", function (e) {\n                e.stopPropagation();\n                var $tr = $(this).closest(\"tr\"),\n                    file = $tr.attr(\"x-file\"),\n                    status = $tr.attr(\"x-status\"),\n                    isChecked = $(this).is(\":checked\");\n\n                if (e.shiftKey) {\n                    // stage/unstage all file between\n                    var lc = lastCheckOneClicked.localeCompare(file),\n                        lcClickedSelector = \"[x-file='\" + lastCheckOneClicked + \"']\",\n                        sequence;\n\n                    if (lc < 0) {\n                        sequence = $tr.prevUntil(lcClickedSelector).andSelf();\n                    } else if (lc > 0) {\n                        sequence = $tr.nextUntil(lcClickedSelector).andSelf();\n                    }\n\n                    if (sequence) {\n                        sequence = sequence.add($tr.parent().children(lcClickedSelector));\n                        var promises = sequence.map(function () {\n                            var $this = $(this),\n                                method = isChecked ? \"stage\" : \"unstage\",\n                                file = $this.attr(\"x-file\"),\n                                status = $this.attr(\"x-status\");\n                            return Git[method](file, status === Git.FILE_STATUS.DELETED);\n                        }).toArray();\n                        return Promise.all(promises).then(function () {\n                            return Git.status();\n                        }).catch(function (err) {\n                            ErrorHandler.showError(err, Strings.ERROR_MODIFY_FILE_STATUS_FAILED);\n                        });\n                    }\n                }\n\n                lastCheckOneClicked = file;\n\n                if (isChecked) {\n                    Git.stage(file, status === Git.FILE_STATUS.DELETED).then(function () {\n                        Git.status();\n                    });\n                } else {\n                    Git.unstage(file).then(function () {\n                        Git.status();\n                    });\n                }\n            })\n            .on(\"dblclick\", \".check-one\", function (e) {\n                e.stopPropagation();\n            })\n            .on(\"click\", \".btn-git-diff\", function (e) {\n                e.stopPropagation();\n                handleGitDiff($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"click\", \".btn-git-undo\", function (e) {\n                e.stopPropagation();\n                handleGitUndo($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"click\", \".btn-git-delete\", function (e) {\n                e.stopPropagation();\n                handleGitDelete($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"mousedown\", \".modified-file\", function (e) {\n                var $this = $(e.currentTarget);\n                // we listen on mousedown event for faster file switch perception. but this results in\n                // this handler getting triggered before the above click handlers for table buttons and\n                // Check boxes. So we do a check to see if the clicked element is NOT a button,\n                // input, or tag inside a button.\n                if ($(e.target).is(\"button, input\") || $(e.target).closest(\"button\").length) {\n                    return;\n                }\n                if ($this.attr(\"x-status\") === Git.FILE_STATUS.DELETED) {\n                    return;\n                }\n                CommandManager.execute(Commands.FILE_OPEN, {\n                    fullPath: Preferences.get(\"currentGitRoot\") + $this.attr(\"x-file\")\n                });\n            })\n            .on(\"dblclick\", \".modified-file\", function (e) {\n                var $this = $(e.currentTarget);\n                if ($this.attr(\"x-status\") === Git.FILE_STATUS.DELETED) {\n                    return;\n                }\n                FileViewController.openFileAndAddToWorkingSet(Preferences.get(\"currentGitRoot\") + $this.attr(\"x-file\"));\n            });\n\n    }\n\n    EventEmitter.on(Events.GIT_CHANGE_USERNAME, function (callback) {\n        return Git.getConfig(\"user.name\").then(function (currentUserName) {\n            return Utils.askQuestion(Strings.CHANGE_USER_NAME_TITLE, Strings.ENTER_NEW_USER_NAME, { defaultValue: currentUserName })\n                .then(function (userName) {\n                    if (!userName.length) { userName = currentUserName; }\n                    return Git.setConfig(\"user.name\", userName, true).catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CHANGE_USERNAME_FAILED);\n                    }).then(function () {\n                        EventEmitter.emit(Events.GIT_USERNAME_CHANGED, userName);\n                    }).finally(function () {\n                        if (callback) {\n                            callback(userName);\n                        }\n                    });\n                });\n        });\n    });\n\n    EventEmitter.on(Events.GIT_CHANGE_EMAIL, function (callback) {\n        return Git.getConfig(\"user.email\").then(function (currentUserEmail) {\n            return Utils.askQuestion(Strings.CHANGE_USER_EMAIL_TITLE, Strings.ENTER_NEW_USER_EMAIL, { defaultValue: currentUserEmail })\n                .then(function (userEmail) {\n                    if (!userEmail.length) { userEmail = currentUserEmail; }\n                    return Git.setConfig(\"user.email\", userEmail, true).catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CHANGE_EMAIL_FAILED);\n                    }).then(function () {\n                        EventEmitter.emit(Events.GIT_EMAIL_CHANGED, userEmail);\n                    }).finally(function () {\n                        if (callback) {\n                            callback(userEmail);\n                        }\n                    });\n                });\n        });\n    });\n\n    EventEmitter.on(Events.GERRIT_TOGGLE_PUSH_REF, function () {\n        // update preference and emit so the menu item updates\n        return Git.getConfig(\"gerrit.pushref\").then(function (strEnabled) {\n            var toggledValue = strEnabled !== \"true\";\n\n            // Set the global preference\n            // Saving a preference to tell the GitCli.push() method to check for gerrit push ref enablement\n            // so we don't slow down people who aren't using gerrit.\n            Preferences.set(\"gerritPushref\", toggledValue);\n\n            return Git.setConfig(\"gerrit.pushref\", toggledValue, true)\n                .then(function () {\n                    EventEmitter.emit(Events.GERRIT_PUSH_REF_TOGGLED, toggledValue);\n                });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_TOGGLE_GERRIT_PUSH_REF_FAILED);\n        });\n    });\n\n    EventEmitter.on(Events.GERRIT_PUSH_REF_TOGGLED, function (enabled) {\n        setGerritCheckState(enabled);\n    });\n\n    function setGerritCheckState(enabled) {\n        const command = CommandManager.get(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        if (command) {\n            command.setChecked(enabled);\n        }\n    }\n\n    function discardAllChanges() {\n        return Utils.askQuestion(Strings.RESET_LOCAL_REPO, Strings.RESET_LOCAL_REPO_CONFIRM, {\n            booleanResponse: true, customOkBtn: Strings.DISCARD_CHANGES, customOkBtnClass: \"danger\"})\n            .then(function (response) {\n                if (response) {\n                    return Git.discardAllChanges().catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_RESET_LOCAL_REPO_FAILED);\n                    }).then(function () {\n                        refresh();\n                    });\n                }\n            });\n    }\n\n    /**\n     * Retrieves the hash of the selected history commit in the panel. if panel not visible\n     * or if there is no selection, returns null.\n     *\n     * @returns {{hash: string, subject: string}|{}} The `hash` value and commit string\n     *              of the selected history commit if visible, otherwise {}.\n     */\n    function getSelectedHistoryCommit() {\n        const $historyRow = $(\".history-commit.selected\");\n        if($historyRow.is(\":visible\")){\n            return {\n                hash: $historyRow.attr(\"x-hash\"),\n                subject: $historyRow.find(\".commit-subject\").text()\n            };\n        }\n        return {};\n    }\n\n    function _panelResized(_entries) {\n        if(!$mainToolbar || !$mainToolbar.is(\":visible\")){\n            return;\n        }\n        const mainToolbarWidth = $mainToolbar.width();\n        let overFlowWidth = 565;\n        const breakpoints = [\n            { width: overFlowWidth, className: \"hide-when-small\" },\n            { width: 400, className: \"hide-when-x-small\" }\n        ];\n\n        if(mainToolbarWidth < overFlowWidth) {\n            $gitPanel.find(\".mainToolbar\").addClass(\"hide-overflow\");\n        } else {\n            $gitPanel.find(\".mainToolbar\").removeClass(\"hide-overflow\");\n        }\n        breakpoints.forEach(bp => {\n            if (mainToolbarWidth < bp.width) {\n                $gitPanel.find(`.${bp.className}`).addClass(\"forced-hidden\");\n            } else {\n                $gitPanel.find(`.${bp.className}`).removeClass(\"forced-hidden\");\n            }\n        });\n    }\n\n    function init() {\n        // Add panel\n        var panelHtml = Mustache.render(gitPanelTemplate, {\n            S: Strings\n        });\n        var $panelHtml = $(panelHtml);\n        $panelHtml.find(\".git-available, .git-not-available\").hide();\n\n        gitPanel = WorkspaceManager.createBottomPanel(\"main-git.panel\", $panelHtml, 100);\n        $gitPanel = gitPanel.$panel;\n        const resizeObserver = new ResizeObserver(_panelResized);\n        resizeObserver.observe($gitPanel[0]);\n        $mainToolbar = $gitPanel.find(\".mainToolbar\");\n        $gitPanel\n            .on(\"click\", \".close\", toggle)\n            .on(\"click\", \".check-all\", function () {\n                if ($(this).is(\":checked\")) {\n                    return Git.stageAll().then(function () {\n                        return Git.status();\n                    }).catch((err)=>{\n                        console.error(err);\n                        // rethrowing with stripped git error details as it may have sensitive info\n                        throw new Error(\"Error stage all by checkbox in git panel.js. this should not have happened\");\n                    });\n                }\n                return Git.resetIndex().then(function () {\n                    return Git.status();\n                }).catch((err)=>{\n                    console.error(err);\n                    // rethrowing with stripped git error details as it may have sensitive info\n                    throw new Error(\"Error unstage all by checkbox in git panel.js. this should not have happened\");\n                });\n            })\n            .on(\"click\", \".git-refresh\", EventEmitter.getEmitter(Events.REFRESH_ALL, [\"panel\", \"refreshBtn\"]))\n            .on(\"click\", \".git-commit\", EventEmitter.getEmitter(Events.HANDLE_GIT_COMMIT))\n            .on(\"click\", \".git-rebase-continue\", function (e) { handleRebase(\"continue\", e); })\n            .on(\"click\", \".git-rebase-skip\", function (e) { handleRebase(\"skip\", e); })\n            .on(\"click\", \".git-rebase-abort\", function (e) { handleRebase(\"abort\", e); })\n            .on(\"click\", \".git-commit-merge\", commitMerge)\n            .on(\"click\", \".git-merge-abort\", abortMerge)\n            .on(\"click\", \".git-find-conflicts\", findConflicts)\n            .on(\"click\", \".git-prev-gutter\", ()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"prevBtn\");\n                GutterManager.goToPrev();\n            })\n            .on(\"click\", \".git-next-gutter\", ()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"nextBtn\");\n                GutterManager.goToNext();\n            })\n            .on(\"click\", \".git-file-history\", EventEmitter.getEmitter(Events.HISTORY_SHOW_FILE))\n            .on(\"click\", \".git-history-toggle\", EventEmitter.getEmitter(Events.HISTORY_SHOW_GLOBAL))\n            .on(\"click\", \".git-fetch\", EventEmitter.getEmitter(Events.HANDLE_FETCH, [\"panel\", \"fetchBtn\"]))\n            .on(\"click\", \".git-push\", function () {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"pushBtn\");\n                var typeOfRemote = $(this).attr(\"x-selected-remote-type\");\n                if (typeOfRemote === \"git\") {\n                    EventEmitter.emit(Events.HANDLE_PUSH);\n                }\n            })\n            .on(\"click\", \".git-pull\", EventEmitter.getEmitter(Events.HANDLE_PULL, [\"panel\", \"pullBtn\"]))\n            .on(\"click\", \".git-init\", EventEmitter.getEmitter(Events.HANDLE_GIT_INIT))\n            .on(\"click\", \".git-clone\", EventEmitter.getEmitter(Events.HANDLE_GIT_CLONE))\n            .on(\"click\", \".change-remote\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_PICK, [\"panel\", \"changeRemote\"]))\n            .on(\"click\", \".remove-remote\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_DELETE, [\"panel\", \"removeRemote\"]))\n            .on(\"click\", \".git-remote-new\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_CREATE, [\"panel\", \"newRemote\"]))\n            .on(\"contextmenu\", \"tr\", function (e) {\n                const $this = $(this);\n                if ($this.hasClass(\"history-commit\")) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'cmenu', \"history\");\n                    if(!$this.hasClass(\"selected\")){\n                        $this.click();\n                    }\n                    Menus.getContextMenu(Constants.GIT_PANEL_HISTORY_CMENU).open(e);\n                    return;\n                }\n\n                $this.click();\n                setTimeout(function () {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'cmenu', \"filechanges\");\n                    Menus.getContextMenu(Constants.GIT_PANEL_CHANGES_CMENU).open(e);\n                }, 1);\n            });\n\n        // Attaching table handlers\n        attachDefaultTableHandlers();\n\n        // Add command to menu.\n        CommandManager.register(Strings.PANEL_COMMAND, Constants.CMD_GIT_TOGGLE_PANEL, toggle);\n        CommandManager.register(Strings.COMMIT_CURRENT_SHORTCUT, Constants.CMD_GIT_COMMIT_CURRENT, commitCurrentFile);\n        CommandManager.register(Strings.COMMIT_ALL_SHORTCUT, Constants.CMD_GIT_COMMIT_ALL, commitAllFiles);\n        CommandManager.register(Strings.PUSH_SHORTCUT, Constants.CMD_GIT_PUSH, EventEmitter.getEmitter(Events.HANDLE_PUSH));\n        CommandManager.register(Strings.PULL_SHORTCUT, Constants.CMD_GIT_PULL, EventEmitter.getEmitter(Events.HANDLE_PULL));\n        CommandManager.register(Strings.FETCH_SHORTCUT, Constants.CMD_GIT_FETCH, EventEmitter.getEmitter(Events.HANDLE_FETCH));\n        CommandManager.register(Strings.GOTO_PREVIOUS_GIT_CHANGE, Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE, GutterManager.goToPrev);\n        CommandManager.register(Strings.GOTO_NEXT_GIT_CHANGE, Constants.CMD_GIT_GOTO_NEXT_CHANGE, GutterManager.goToNext);\n        CommandManager.register(Strings.REFRESH_GIT, Constants.CMD_GIT_REFRESH, EventEmitter.getEmitter(Events.REFRESH_ALL));\n        CommandManager.register(Strings.RESET_LOCAL_REPO, Constants.CMD_GIT_DISCARD_ALL_CHANGES, discardAllChanges);\n        CommandManager.register(Strings.UNDO_LAST_LOCAL_COMMIT, Constants.CMD_GIT_UNDO_LAST_COMMIT, undoLastLocalCommit);\n        CommandManager.register(Strings.CHANGE_USER_NAME, Constants.CMD_GIT_CHANGE_USERNAME, EventEmitter.getEmitter(Events.GIT_CHANGE_USERNAME));\n        CommandManager.register(Strings.CHANGE_USER_EMAIL, Constants.CMD_GIT_CHANGE_EMAIL, EventEmitter.getEmitter(Events.GIT_CHANGE_EMAIL));\n        CommandManager.register(Strings.ENABLE_GERRIT_PUSH_REF, Constants.CMD_GIT_GERRIT_PUSH_REF, EventEmitter.getEmitter(Events.GERRIT_TOGGLE_PUSH_REF));\n        CommandManager.register(Strings.VIEW_AUTHORS_SELECTION, Constants.CMD_GIT_AUTHORS_OF_SELECTION, handleAuthorsSelection);\n        CommandManager.register(Strings.VIEW_AUTHORS_FILE, Constants.CMD_GIT_AUTHORS_OF_FILE, handleAuthorsFile);\n        CommandManager.register(Strings.HIDE_UNTRACKED, Constants.CMD_GIT_TOGGLE_UNTRACKED, handleToggleUntracked);\n        CommandManager.register(Strings.GIT_INIT, Constants.CMD_GIT_INIT, EventEmitter.getEmitter(Events.HANDLE_GIT_INIT));\n        CommandManager.register(Strings.GIT_CLONE, Constants.CMD_GIT_CLONE, EventEmitter.getEmitter(Events.HANDLE_GIT_CLONE));\n\n        // Show gitPanel when appropriate\n        if (Preferences.get(\"panelEnabled\") && Setup.isExtensionActivated()) {\n            toggle(true);\n        }\n        _panelResized();\n        GutterManager.init();\n    } // function init() {\n\n    function enable() {\n        EventEmitter.emit(Events.GIT_ENABLED);\n        // this function is called after every Branch.refresh\n        gitPanelMode = null;\n        //\n        $gitPanel.find(\".git-available\").show();\n        $gitPanel.find(\".git-not-available\").hide();\n        Utils.enableCommand(Constants.CMD_GIT_INIT, false);\n        Utils.enableCommand(Constants.CMD_GIT_CLONE, false);\n        //\n        Main.$icon.removeClass(\"warning\");\n        gitPanelDisabled = false;\n        // after all is enabled\n        refresh();\n    }\n\n    function disable(cause) {\n        EventEmitter.emit(Events.GIT_DISABLED, cause);\n        gitPanelMode = cause;\n        // causes: not-repo\n        if (gitPanelMode === \"not-repo\") {\n            $gitPanel.find(\".git-available\").hide();\n            $gitPanel.find(\".git-not-available\").show();\n            Utils.enableCommand(Constants.CMD_GIT_INIT, true);\n            Utils.enableCommand(Constants.CMD_GIT_CLONE, true);\n        } else {\n            Main.$icon.addClass(\"warning\");\n            toggle(false);\n            gitPanelDisabled = true;\n        }\n        refresh();\n    }\n\n    // Event listeners\n    EventEmitter.on(Events.GIT_USERNAME_CHANGED, function (userName) {\n        if(userName){\n            _setName(Constants.CMD_GIT_CHANGE_USERNAME,\n                StringUtils.format(Strings.CHANGE_USER_NAME_MENU, userName));\n        } else {\n            _setName(Constants.CMD_GIT_CHANGE_USERNAME, Strings.CHANGE_USER_NAME);\n        }\n    });\n\n    EventEmitter.on(Events.GIT_EMAIL_CHANGED, function (email) {\n        $gitPanel.find(\".git-user-email\").text(email);\n        if(email){\n            _setName(Constants.CMD_GIT_CHANGE_EMAIL,\n                StringUtils.format(Strings.CHANGE_USER_EMAIL_MENU, email));\n        } else {\n            _setName(Constants.CMD_GIT_CHANGE_EMAIL, Strings.CHANGE_USER_EMAIL);\n        }\n    });\n\n    EventEmitter.on(Events.GIT_REMOTE_AVAILABLE, function () {\n        $gitPanel.find(\".git-pull, .git-push, .git-fetch\").prop(\"disabled\", false);\n    });\n\n    EventEmitter.on(Events.GIT_REMOTE_NOT_AVAILABLE, function () {\n        $gitPanel.find(\".git-pull, .git-push, .git-fetch\").prop(\"disabled\", true);\n    });\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        if(!StateManager.get(GIT_PANEL_SHOWN_ON_FIRST_BOOT)){\n            StateManager.set(GIT_PANEL_SHOWN_ON_FIRST_BOOT, true);\n            toggle(true);\n            NotificationUI.createFromTemplate(\n                Strings.GIT_TOAST_TITLE,\n                Strings.GIT_TOAST_MESSAGE,\n                \"git-toolbar-icon\", {\n                    allowedPlacements: ['left'],\n                    dismissOnClick: true,\n                    toastStyle: \"width-250\"\n                }\n            );\n        }\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'project', \"enabled\");\n        // Add info from Git to panel\n        Git.getConfig(\"user.name\").then(function (currentUserName) {\n            EventEmitter.emit(Events.GIT_USERNAME_CHANGED, currentUserName);\n        });\n        Git.getConfig(\"user.email\").then(function (currentEmail) {\n            EventEmitter.emit(Events.GIT_EMAIL_CHANGED, currentEmail);\n        });\n        Git.getConfig(\"gerrit.pushref\").then(function (strEnabled) {\n            var enabled = strEnabled === \"true\";\n            // Handle the case where we switched to a repo that is using gerrit\n            if (enabled && !Preferences.get(\"gerritPushref\")) {\n                Preferences.set(\"gerritPushref\", true);\n            }\n            EventEmitter.emit(Events.GERRIT_PUSH_REF_TOGGLED, enabled);\n        });\n    });\n\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function () {\n        if (!gitPanel) { return; }\n        refreshCurrentFile();\n    });\n\n    EventEmitter.on(Events.BRACKETS_DOCUMENT_SAVED, function () {\n        if (!gitPanel) { return; }\n        refresh();\n    });\n\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (fileSystemEntry) {\n        // files are added or deleted from the directory\n        if (fileSystemEntry.isDirectory) {\n            refresh();\n        }\n    });\n\n    EventEmitter.on(Events.REBASE_MERGE_MODE, function (rebaseEnabled, mergeEnabled) {\n        $gitPanel.find(\".git-rebase\").toggle(rebaseEnabled);\n        $gitPanel.find(\".git-merge\").toggle(mergeEnabled);\n        $gitPanel.find(\"button.git-commit\").toggle(!rebaseEnabled && !mergeEnabled);\n    });\n\n    EventEmitter.on(Events.FETCH_STARTED, function () {\n        $gitPanel.find(\".git-fetch\")\n            .addClass(\"btn-loading\")\n            .prop(\"disabled\", true);\n    });\n\n    EventEmitter.on(Events.FETCH_COMPLETE, function () {\n        $gitPanel.find(\".git-fetch\")\n            .removeClass(\"btn-loading\")\n            .prop(\"disabled\", false);\n        refreshCommitCounts();\n    });\n\n    EventEmitter.on(Events.REFRESH_COUNTERS, function () {\n        refreshCommitCounts();\n    });\n\n    EventEmitter.on(Events.HANDLE_GIT_COMMIT, function () {\n        handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath], false, COMMIT_MODE.DEFAULT);\n    });\n\n    exports.init = init;\n    exports.refresh = refresh;\n    exports.toggle = toggle;\n    exports.enable = enable;\n    exports.disable = disable;\n    exports.getSelectedHistoryCommit = getSelectedHistoryCommit;\n    exports.getPanel = function () { return $gitPanel; };\n\n});\n\ndefine(\"src/Preferences\", function (require, exports, module) {\n\n    var _                   = brackets.getModule(\"thirdparty/lodash\"),\n        PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        StateManager        = PreferencesManager.stateManager,\n        prefix              = \"git\";\n\n    var defaultPreferences = {\n        // features\n        \"stripWhitespaceFromCommits\": {     \"type\": \"boolean\",           \"value\": true              },\n        \"addEndlineToTheEndOfFile\": {       \"type\": \"boolean\",           \"value\": true              },\n        \"removeByteOrderMark\": {            \"type\": \"boolean\",           \"value\": false             },\n        \"normalizeLineEndings\": {           \"type\": \"boolean\",           \"value\": false             },\n        \"useGitGutter\": {                   \"type\": \"boolean\",           \"value\": true              },\n        \"markModifiedInTree\": {             \"type\": \"boolean\",           \"value\": true              },\n        \"useVerboseDiff\": {                 \"type\": \"boolean\",           \"value\": false             },\n        \"useDifftool\": {                    \"type\": \"boolean\",           \"value\": false             },\n        \"clearWhitespaceOnSave\": {          \"type\": \"boolean\",           \"value\": false             },\n        \"gerritPushref\": {                  \"type\": \"boolean\",           \"value\": false             },\n        // system\n        \"enableGit\": {                      \"type\": \"boolean\",           \"value\": true              },\n        \"gitTimeout\": {                     \"type\": \"number\",            \"value\": 30                },\n        \"gitPath\": {                        \"type\": \"string\",            \"value\": \"\"                }\n    };\n\n    var prefs = PreferencesManager.getExtensionPrefs(prefix);\n    _.each(defaultPreferences, function (definition, key) {\n        if (definition.os && definition.os[brackets.platform]) {\n            prefs.definePreference(key, definition.type, definition.os[brackets.platform].value);\n        } else {\n            prefs.definePreference(key, definition.type, definition.value);\n        }\n    });\n    prefs.save();\n\n    function get(key) {\n        var location = defaultPreferences[key] ? PreferencesManager : StateManager;\n        arguments[0] = prefix + \".\" + key;\n        return location.get.apply(location, arguments);\n    }\n\n    function set(key) {\n        var location = defaultPreferences[key] ? PreferencesManager : StateManager;\n        arguments[0] = prefix + \".\" + key;\n        return location.set.apply(location, arguments);\n    }\n\n    function getAll() {\n        var obj = {};\n        _.each(defaultPreferences, function (definition, key) {\n            obj[key] = get(key);\n        });\n        return obj;\n    }\n\n    function getDefaults() {\n        var obj = {};\n        _.each(defaultPreferences, function (definition, key) {\n            var defaultValue;\n            if (definition.os && definition.os[brackets.platform]) {\n                defaultValue = definition.os[brackets.platform].value;\n            } else {\n                defaultValue = definition.value;\n            }\n            obj[key] = defaultValue;\n        });\n        return obj;\n    }\n\n    function getType(key) {\n        return defaultPreferences[key].type;\n    }\n\n    function getGlobal(key) {\n        return PreferencesManager.get(key);\n    }\n\n    function getExtensionPref() {\n        return prefs;\n    }\n\n    function save() {\n        PreferencesManager.save();\n    }\n\n    module.exports = {\n        get: get,\n        set: set,\n        getAll: getAll,\n        getDefaults: getDefaults,\n        getType: getType,\n        getGlobal: getGlobal,\n        getExtensionPref: getExtensionPref,\n        save: save\n    };\n\n});\n\ndefine(\"src/ProjectTreeMarks\", function (require) {\n\n    var _                 = brackets.getModule(\"thirdparty/lodash\"),\n        FileSystem        = brackets.getModule(\"filesystem/FileSystem\"),\n        ProjectManager    = brackets.getModule(\"project/ProjectManager\");\n\n    var EventEmitter      = require(\"src/EventEmitter\"),\n        Events            = require(\"src/Events\"),\n        Git               = require(\"src/git/Git\"),\n        Preferences       = require(\"src/Preferences\");\n\n    var ignoreEntries = [],\n        newPaths      = [],\n        modifiedPaths = [];\n\n    if (!Preferences.get(\"markModifiedInTree\")) {\n        // end here, no point in processing the code below\n        return;\n    }\n\n    function loadIgnoreContents() {\n        return new Promise((resolve)=>{\n            let gitRoot = Preferences.get(\"currentGitRoot\"),\n                excludeContents,\n                gitignoreContents;\n\n            const finish = _.after(2, function () {\n                resolve(excludeContents + \"\\n\" + gitignoreContents);\n            });\n\n            FileSystem.getFileForPath(gitRoot + \".git/info/exclude\").read(function (err, content) {\n                excludeContents = err ? \"\" : content;\n                finish();\n            });\n\n            FileSystem.getFileForPath(gitRoot + \".gitignore\").read(function (err, content) {\n                gitignoreContents = err ? \"\" : content;\n                finish();\n            });\n\n        });\n    }\n\n    function refreshIgnoreEntries() {\n        function regexEscape(str) {\n            // NOTE: We cannot use StringUtils.regexEscape() here because we don't wanna replace *\n            return str.replace(/([.?+\\^$\\\\(){}|])/g, \"\\\\$1\");\n        }\n\n        return loadIgnoreContents().then(function (content) {\n            var gitRoot = Preferences.get(\"currentGitRoot\");\n\n            ignoreEntries = _.compact(_.map(content.split(\"\\n\"), function (line) {\n                // Rules: http://git-scm.com/docs/gitignore\n                var type = \"deny\",\n                    leadingSlash,\n                    trailingSlash,\n                    regex;\n\n                line = line.trim();\n                if (!line || line.indexOf(\"#\") === 0) {\n                    return;\n                }\n\n                // handle explicitly allowed files/folders with a leading !\n                if (line.indexOf(\"!\") === 0) {\n                    line = line.slice(1);\n                    type = \"accept\";\n                }\n                // handle lines beginning with a backslash, which is used for escaping ! or #\n                if (line.indexOf(\"\\\\\") === 0) {\n                    line = line.slice(1);\n                }\n                // handle lines beginning with a slash, which only matches files/folders in the root dir\n                if (line.indexOf(\"/\") === 0) {\n                    line = line.slice(1);\n                    leadingSlash = true;\n                }\n                // handle lines ending with a slash, which only exludes dirs\n                if (line.lastIndexOf(\"/\") === line.length) {\n                    // a line ending with a slash ends with **\n                    line += \"**\";\n                    trailingSlash = true;\n                }\n\n                // NOTE: /(.{0,})/ is basically the same as /(.*)/, but we can't use it because the asterisk\n                // would be replaced later on\n\n                // create the intial regexp here. We need the absolute path 'cause it could be that there\n                // are external files with the same name as a project file\n                regex = regexEscape(gitRoot) + (leadingSlash ? \"\" : \"((.+)/)?\") + regexEscape(line) + (trailingSlash ? \"\" : \"(/.{0,})?\");\n                // replace all the possible asterisks\n                regex = regex.replace(/\\*\\*$/g, \"(.{0,})\").replace(/(\\*\\*|\\*$)/g, \"(.+)\").replace(/\\*/g, \"([^/]*)\");\n                regex = \"^\" + regex + \"$\";\n\n                return {\n                    regexp: new RegExp(regex),\n                    type: type\n                };\n            }));\n        });\n    }\n\n    function isIgnored(path) {\n        var ignored = false;\n        _.forEach(ignoreEntries, function (entry) {\n            if (entry.regexp.test(path)) {\n                ignored = (entry.type === \"deny\");\n            }\n        });\n        return ignored;\n    }\n\n    function isNew(fullPath) {\n        return newPaths.indexOf(fullPath) !== -1;\n    }\n\n    function isModified(fullPath) {\n        return modifiedPaths.indexOf(fullPath) !== -1;\n    }\n\n    ProjectManager.addClassesProvider(function (data) {\n        var fullPath = data.fullPath;\n        if (isIgnored(fullPath)) {\n            return \"git-ignored\";\n        } else if (isNew(fullPath)) {\n            return \"git-new\";\n        } else if (isModified(fullPath)) {\n            return \"git-modified\";\n        }\n    });\n\n    function _refreshOpenFiles() {\n        $(\"#working-set-list-container\").find(\"li\").each(function () {\n            var $li = $(this),\n                data = $li.data(\"file\");\n            if (data) {\n                var fullPath = data.fullPath;\n                $li.toggleClass(\"git-ignored\", isIgnored(fullPath))\n                   .toggleClass(\"git-new\", isNew(fullPath))\n                   .toggleClass(\"git-modified\", isModified(fullPath));\n            }\n        });\n    }\n\n    var refreshOpenFiles = _.debounce(function () {\n        _refreshOpenFiles();\n    }, 100);\n\n    function attachEvents() {\n        $(\"#working-set-list-container\").on(\"contentChanged\", refreshOpenFiles).triggerHandler(\"contentChanged\");\n    }\n\n    function detachEvents() {\n        $(\"#working-set-list-container\").off(\"contentChanged\", refreshOpenFiles);\n    }\n\n    // this will refresh ignore entries when .gitignore is modified\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (file) {\n        if (file.fullPath === Preferences.get(\"currentGitRoot\") + \".gitignore\") {\n            refreshIgnoreEntries().finally(function () {\n                refreshOpenFiles();\n            });\n        }\n    });\n\n    // this will refresh new/modified paths on every status results\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (files) {\n        var gitRoot = Preferences.get(\"currentGitRoot\");\n\n        newPaths = [];\n        modifiedPaths = [];\n\n        files.forEach(function (entry) {\n            var isNew = entry.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1 ||\n                        entry.status.indexOf(Git.FILE_STATUS.ADDED) !== -1;\n\n            var fullPath = gitRoot + entry.file;\n            if (isNew) {\n                newPaths.push(fullPath);\n            } else {\n                modifiedPaths.push(fullPath);\n            }\n        });\n\n        ProjectManager.rerenderTree();\n        refreshOpenFiles();\n    });\n\n    // this will refresh ignore entries when git project is opened\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        refreshIgnoreEntries();\n        attachEvents();\n    });\n\n    // this will clear entries when non-git project is opened\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        ignoreEntries = [];\n        newPaths      = [];\n        modifiedPaths = [];\n        detachEvents();\n    });\n\n});\n\ndefine(\"src/Remotes\", function (require) {\n\n    // Brackets modules\n    var _               = brackets.getModule(\"thirdparty/lodash\"),\n        DefaultDialogs  = brackets.getModule(\"widgets/DefaultDialogs\"),\n        Dialogs         = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache        = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics         = brackets.getModule(\"utils/Metrics\"),\n        Strings         = brackets.getModule(\"strings\"),\n        StringUtils     = brackets.getModule(\"utils/StringUtils\");\n\n    // Local modules\n    var ErrorHandler    = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"src/Preferences\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\"),\n        PullDialog      = require(\"src/dialogs/Pull\"),\n        PushDialog      = require(\"src/dialogs/Push\"),\n        Utils           = require(\"src/Utils\");\n\n    // Templates\n    var gitRemotesPickerTemplate = `<!-- List of remotes defined for the current local repository -->\n{{#remotes}}\n<li class=\"remote\">\n    <a href=\"#\" data-remote-name=\"{{name}}\" data-type=\"git\" class=\"remote-name\">\n        {{#deletable}}<span class=\"trash-icon hover-icon remove-remote\">&times;</span>{{/deletable}}\n        <span class=\"change-remote\">{{name}}</span>\n    </a>\n</li>\n{{/remotes}}\n<li><a class=\"git-remote-new\"><span>{{Strings.CREATE_NEW_REMOTE}}</span></a></li>\n`;\n\n    // Module variables\n    var $selectedRemote  = null,\n        $remotesDropdown = null,\n        $gitPanel = null,\n        $gitPush = null;\n\n    function initVariables() {\n        $gitPanel = $(\"#git-panel\");\n        $selectedRemote = $gitPanel.find(\".git-selected-remote\");\n        $remotesDropdown = $gitPanel.find(\".git-remotes-dropdown\");\n        $gitPush = $gitPanel.find(\".git-push\");\n    }\n\n    // Implementation\n\n    function getDefaultRemote(allRemotes) {\n        var defaultRemotes = Preferences.get(\"defaultRemotes\") || {},\n            candidate = defaultRemotes[Preferences.get(\"currentGitRoot\")];\n\n        var exists = _.find(allRemotes, function (remote) {\n            return remote.name === candidate;\n        });\n        if (!exists) {\n            candidate = null;\n            if (allRemotes.length > 0) {\n                candidate = _.first(allRemotes).name;\n            }\n        }\n\n        return candidate;\n    }\n\n    function setDefaultRemote(remoteName) {\n        var defaultRemotes = Preferences.get(\"defaultRemotes\") || {};\n        defaultRemotes[Preferences.get(\"currentGitRoot\")] = remoteName;\n        Preferences.set(\"defaultRemotes\", defaultRemotes);\n    }\n\n    function clearRemotePicker() {\n        $selectedRemote\n            .html(\"&mdash;\")\n            .data(\"remote\", null);\n    }\n\n    function selectRemote(remoteName, type) {\n        if (!remoteName) {\n            return clearRemotePicker();\n        }\n\n        // Set as default remote only if is a normal git remote\n        if (type === \"git\") { setDefaultRemote(remoteName); }\n\n        // Disable pull if it is not a normal git remote\n        $gitPanel.find(\".git-pull\").prop(\"disabled\", type !== \"git\");\n\n        // Enable push and set selected-remote-type to Git push button by type of remote\n        $gitPush\n            .prop(\"disabled\", false)\n            .attr(\"x-selected-remote-type\", type);\n\n        // Update remote name of $selectedRemote\n        $selectedRemote\n            .text(remoteName)\n            .attr(\"data-type\", type) // use attr to apply CSS styles\n            .data(\"remote\", remoteName);\n    }\n\n    function refreshRemotesPicker() {\n        Git.getRemotes().then(function (remotes) {\n            // Set default remote name and cache the remotes dropdown menu\n            var defaultRemoteName = getDefaultRemote(remotes);\n\n            // Disable Git-push and Git-pull if there are not remotes defined\n            $gitPanel\n                .find(\".git-pull, .git-push, .git-fetch\")\n                .prop(\"disabled\", remotes.length === 0);\n\n            // Add options to change remote\n            remotes.forEach(function (remote) {\n                remote.deletable = remote.name !== \"origin\";\n            });\n\n            // Pass to Mustache the needed data\n            var compiledTemplate = Mustache.render(gitRemotesPickerTemplate, {\n                Strings: Strings,\n                remotes: remotes\n            });\n\n            // Inject the rendered template inside the $remotesDropdown\n            $remotesDropdown.html(compiledTemplate);\n\n            // Notify others that they may add more stuff to this dropdown\n            EventEmitter.emit(Events.REMOTES_REFRESH_PICKER);\n            // TODO: is it possible to wait for listeners to finish?\n\n            // TODO: if there're no remotes but there are some ftp remotes\n            // we need to adjust that something other may be put as default\n            // low priority\n            if (remotes.length > 0) {\n                selectRemote(defaultRemoteName, \"git\");\n            } else {\n                clearRemotePicker();\n            }\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GETTING_REMOTES);\n        });\n    }\n\n    function handleRemoteCreation() {\n        return Utils.askQuestion(Strings.CREATE_NEW_REMOTE, Strings.ENTER_REMOTE_NAME)\n            .then(function (name) {\n                return Utils.askQuestion(Strings.CREATE_NEW_REMOTE, Strings.ENTER_REMOTE_URL).then(function (url) {\n                    return [name, url];\n                });\n            })\n            .then(function ([name, url]) {\n                return Git.createRemote(name, url).then(function () {\n                    return refreshRemotesPicker();\n                });\n            })\n            .catch(function (err) {\n                if (!ErrorHandler.equals(err, Strings.USER_ABORTED)) {\n                    ErrorHandler.showError(err, Strings.ERROR_REMOTE_CREATION);\n                }\n            });\n    }\n\n    function deleteRemote(remoteName) {\n        return Utils.askQuestion(Strings.DELETE_REMOTE, StringUtils.format(Strings.DELETE_REMOTE_NAME, remoteName), { booleanResponse: true })\n            .then(function (response) {\n                if (response === true) {\n                    return Git.deleteRemote(remoteName).then(function () {\n                        return refreshRemotesPicker();\n                    });\n                }\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n            });\n    }\n\n    function showPushResult(result) {\n        if (typeof result.remoteUrl === \"string\") {\n            result.remoteUrl = Utils.encodeSensitiveInformation(result.remoteUrl);\n        }\n\n        var template = [\n            \"<h3>{{flagDescription}}</h3>\",\n            \"Info:\",\n            \"Remote url - {{remoteUrl}}\",\n            \"Local branch - {{from}}\",\n            \"Remote branch - {{to}}\",\n            \"Summary - {{summary}}\",\n            \"<h4>Status - {{status}}</h4>\"\n        ].join(\"<br>\");\n\n        Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_INFO,\n            Strings.GIT_PUSH_RESPONSE, // title\n            Mustache.render(template, result) // message\n        );\n    }\n\n    function pushToRemote(remote) {\n        if (!remote) {\n            return ErrorHandler.showError(StringUtils.format(Strings.ERROR_NO_REMOTE_SELECTED, \"push\"));\n        }\n\n        var pushConfig = {\n            remote: remote\n        };\n\n        PushDialog.show(pushConfig)\n            .then(function (pushConfig) {\n                var q = Promise.resolve(),\n                    additionalArgs = [];\n\n                if (pushConfig.tags) {\n                    additionalArgs.push(\"--tags\");\n                }\n                if (pushConfig.noVerify) {\n                    additionalArgs.push(\"--no-verify\");\n                }\n\n                // set a new tracking branch if desired\n                if (pushConfig.branch && pushConfig.setBranchAsTracking) {\n                    q = q.then(function () {\n                        return Git.setUpstreamBranch(pushConfig.remote, pushConfig.branch);\n                    });\n                }\n                // put username and password into remote url\n                if (pushConfig.remoteUrlNew) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(pushConfig.remote, pushConfig.remoteUrlNew);\n                    });\n                }\n                // do the pull itself (we are not using pull command)\n                q = q.then(function () {\n                    let op;\n                    const progressTracker = ProgressDialog.newProgressTracker();\n                    if (pushConfig.pushToNew) {\n                        op = Git.pushToNewUpstream(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    } else if (pushConfig.strategy === \"DEFAULT\") {\n                        op = Git.push(pushConfig.remote, pushConfig.branch, additionalArgs, progressTracker);\n                    } else if (pushConfig.strategy === \"FORCED\") {\n                        op = Git.pushForced(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    } else if (pushConfig.strategy === \"DELETE_BRANCH\") {\n                        op = Git.deleteRemoteBranch(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    }\n                    return ProgressDialog.show(op, progressTracker)\n                        .then(function (result) {\n                            return ProgressDialog.waitForClose().then(function () {\n                                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'push', \"success\");\n                                showPushResult(result);\n                            });\n                        })\n                        .catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'push', \"fail\");\n                            ErrorHandler.showError(err, Strings.ERROR_PUSHING_REMOTE, {errorMetric: \"push\"});\n                        });\n                });\n                // restore original url if desired\n                if (pushConfig.remoteUrlRestore) {\n                    q = q.finally(function () {\n                        return Git.setRemoteUrl(pushConfig.remote, pushConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            })\n            .catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.ERROR_PUSHING_OPERATION); }\n            });\n    }\n\n    function pullFromRemote(remote) {\n        if (!remote) {\n            return ErrorHandler.showError(StringUtils.format(Strings.ERROR_NO_REMOTE_SELECTED, \"pull\"));\n        }\n\n        var pullConfig = {\n            remote: remote\n        };\n\n        PullDialog.show(pullConfig)\n            .then(function (pullConfig) {\n                var q = Promise.resolve();\n\n                // set a new tracking branch if desired\n                if (pullConfig.branch && pullConfig.setBranchAsTracking) {\n                    q = q.then(function () {\n                        return Git.setUpstreamBranch(pullConfig.remote, pullConfig.branch);\n                    });\n                }\n                // put username and password into remote url\n                if (pullConfig.remoteUrlNew) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(pullConfig.remote, pullConfig.remoteUrlNew);\n                    });\n                }\n                // do the pull itself (we are not using pull command)\n                q = q.then(function () {\n                    // fetch the remote first\n                    const progressTracker = ProgressDialog.newProgressTracker();\n                    return ProgressDialog.show(Git.fetchRemote(pullConfig.remote, progressTracker), progressTracker)\n                        .then(function () {\n                            if (pullConfig.strategy === \"DEFAULT\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    false, false, {progressTracker});\n                            } else if (pullConfig.strategy === \"AVOID_MERGING\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    true, false, {progressTracker});\n                            } else if (pullConfig.strategy === \"MERGE_NOCOMMIT\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    false, true, {progressTracker});\n                            } else if (pullConfig.strategy === \"REBASE\") {\n                                return Git.rebaseRemote(pullConfig.remote, pullConfig.branch, progressTracker);\n                            } else if (pullConfig.strategy === \"RESET\") {\n                                return Git.resetRemote(pullConfig.remote, pullConfig.branch, progressTracker);\n                            }\n                        })\n                        .then(function (result) {\n                            return ProgressDialog.waitForClose().then(function () {\n                                // Git writes status messages (including informational messages) to stderr,\n                                // even when the command succeeds. For example, during `git pull --rebase`,\n                                // the \"Successfully rebased and updated\" message is sent to stderr,\n                                // leaving the result as empty in stdout.\n                                // If we reach this point, the command has succeeded,\n                                // so we display a success message if `result` is \"\".\n                                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'pull', \"success\");\n                                return Utils.showOutput(result || Strings.GIT_PULL_SUCCESS,\n                                    Strings.GIT_PULL_RESPONSE);\n                            });\n                        })\n                        .catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'pull', \"fail\");\n                            ErrorHandler.showError(err, Strings.ERROR_PULLING_REMOTE, {errorMetric: \"pull\"});\n                        });\n                });\n                // restore original url if desired\n                if (pullConfig.remoteUrlRestore) {\n                    q = q.finally(function () {\n                        return Git.setRemoteUrl(pullConfig.remote, pullConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            })\n            .catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.ERROR_PULLING_OPERATION); }\n            });\n    }\n\n    function handleFetch() {\n\n        // Tell the rest of the plugin that the fetch has started\n        EventEmitter.emit(Events.FETCH_STARTED);\n\n        const tracker = ProgressDialog.newProgressTracker();\n        return ProgressDialog.show(Git.fetchAllRemotes(tracker), tracker)\n            .then(()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'fetch', \"success\");\n            })\n            .catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'fetch', \"fail\");\n                ErrorHandler.showError(err, undefined, {errorMetric: \"fetch\"});\n            })\n            .then(ProgressDialog.waitForClose)\n            .finally(function () {\n                EventEmitter.emit(Events.FETCH_COMPLETE);\n            });\n    }\n\n    // Event subscriptions\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        initVariables();\n        refreshRemotesPicker();\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_PICK, function (event) {\n        var $remote     = $(event.target).closest(\".remote-name\"),\n            remoteName  = $remote.data(\"remote-name\"),\n            type        = $remote.data(\"type\");\n        selectRemote(remoteName, type);\n        EventEmitter.emit(Events.REFRESH_COUNTERS);\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_CREATE, function () {\n        handleRemoteCreation();\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_DELETE, function (event) {\n        var remoteName = $(event.target).closest(\".remote-name\").data(\"remote-name\");\n        deleteRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_PULL, function () {\n        var remoteName = $selectedRemote.data(\"remote\");\n        pullFromRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_PUSH, function () {\n        var remoteName = $selectedRemote.data(\"remote\");\n        pushToRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_FETCH, function () {\n        handleFetch();\n    });\n\n});\n\ndefine(\"src/SettingsDialog\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache                = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Preferences             = require(\"./Preferences\"),\n        Strings             = brackets.getModule(\"strings\"),\n        Git                     = require(\"./git/Git\"),\n        Setup                   = require(\"src/utils/Setup\"),\n        settingsDialogTemplate  = `<div id=\"git-settings-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.GIT_SETTINGS_TITLE}}</h1>\n    </div>\n    <div class=\"modal-body\" style=\"max-height: fit-content;\">\n        <div>\n            <label for=\"git-settings-enableGit\">\n                <input id=\"git-settings-enableGit\" type=\"checkbox\" settingsProperty=\"enableGit\" />\n                {{Strings.ENABLE_GIT}}&nbsp;&nbsp;<i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n            </label>\n        </div>\n        <div class=\"git-settings-content {{#gitDisabled}}forced-inVisible{{/gitDisabled}}\">\n            <!-- #features -->\n            <div>\n                <div>\n                    <label for=\"git-settings-stripWhitespaceFromCommits\">\n                        <input id=\"git-settings-stripWhitespaceFromCommits\" type=\"checkbox\" settingsProperty=\"stripWhitespaceFromCommits\" />\n                        {{Strings.STRIP_WHITESPACE_FROM_COMMITS}}\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-addEndlineToTheEndOfFile\">\n                        <input id=\"git-settings-addEndlineToTheEndOfFile\" type=\"checkbox\" settingsProperty=\"addEndlineToTheEndOfFile\" />\n                        {{Strings.ADD_ENDLINE_TO_THE_END_OF_FILE}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-removeByteOrderMark\">\n                        <input id=\"git-settings-removeByteOrderMark\" type=\"checkbox\" settingsProperty=\"removeByteOrderMark\" />\n                        {{Strings.REMOVE_BOM}}\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-normalizeLineEndings\">\n                        <input id=\"git-settings-normalizeLineEndings\" type=\"checkbox\" settingsProperty=\"normalizeLineEndings\" />\n                        {{Strings.NORMALIZE_LINE_ENDINGS}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-useGitGutter\">\n                        <input id=\"git-settings-useGitGutter\" type=\"checkbox\" settingsProperty=\"useGitGutter\" />\n                        {{Strings.USE_GIT_GUTTER}}&nbsp;&nbsp;<i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-markModifiedInTree\">\n                        <input id=\"git-settings-markModifiedInTree\" type=\"checkbox\" settingsProperty=\"markModifiedInTree\" />\n                        {{Strings.MARK_MODIFIED_FILES_IN_TREE}}&nbsp;&nbsp;<i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-useVerboseDiff\">\n                        <input id=\"git-settings-useVerboseDiff\" type=\"checkbox\" settingsProperty=\"useVerboseDiff\" />\n                        {{Strings.USE_VERBOSE_DIFF}}\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-useDifftool\">\n                        <input id=\"git-settings-useDifftool\" type=\"checkbox\" settingsProperty=\"useDifftool\" />\n                        {{Strings.USE_DIFFTOOL}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-clearWhitespaceOnSave\">\n                        <input id=\"git-settings-clearWhitespaceOnSave\" type=\"checkbox\" settingsProperty=\"clearWhitespaceOnSave\" />\n                        {{Strings.CLEAR_WHITESPACE_ON_FILE_SAVE}}\n                    </label>\n                </div>\n            </div>\n            <!-- /features -->\n            <!-- #gitConfig -->\n            <h4>{{Strings.SYSTEM_CONFIGURATION}}</h4>\n            <div class=\"row-fluid\">\n                {{#gitNotFound}}\n                <div class=\"alert alert-warning\">\n                    {{Strings.GIT_NOT_FOUND_MESSAGE}}\n                </div>\n                {{/gitNotFound}}\n                <label for=\"git-settings-gitPath\">\n                    {{Strings.PATH_TO_GIT_EXECUTABLE}}:&nbsp;&nbsp;\n                    {{#gitNotFound}}\n                    <i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n                    {{/gitNotFound}}\n                </label>\n                <input id=\"git-settings-gitPath\" type=\"text\" settingsProperty=\"gitPath\" autocomplete=\"off\" spellcheck=\"false\"/>\n            </div>\n            <div class=\"row-fluid\">\n                <label for=\"git-settings-gitTimeout\">{{Strings.DEFAULT_GIT_TIMEOUT}}:</label>\n                <input id=\"git-settings-gitTimeout\" type=\"number\" settingsProperty=\"gitTimeout\" />\n            </div>\n            <!-- /gitConfig -->\n        </div>\n\n\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"defaults\"  class=\"dialog-button btn left\"          >{{Strings.BUTTON_DEFAULTS}}</button>\n        <button data-button-id=\"cancel\"    class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"        class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_SAVE}}</button>\n    </div>\n</div>\n`;\n\n    var dialog,\n        $dialog;\n\n    function setValues(values) {\n        $(\"*[settingsProperty]\", $dialog).each(function () {\n            var $this = $(this),\n                type = $this.attr(\"type\"),\n                tag = $this.prop(\"tagName\").toLowerCase(),\n                property = $this.attr(\"settingsProperty\");\n            if (type === \"checkbox\") {\n                $this.prop(\"checked\", values[property]);\n            } else if (tag === \"select\") {\n                $(\"option[value=\" + values[property] + \"]\", $this).prop(\"selected\", true);\n            } else {\n                $this.val(values[property]);\n            }\n        });\n    }\n\n    function collectDialogValues() {\n        $(\"*[settingsProperty]\", $dialog).each(function () {\n            var $this = $(this),\n                type = $this.attr(\"type\"),\n                property = $this.attr(\"settingsProperty\"),\n                prefType = Preferences.getType(property);\n            if (type === \"checkbox\") {\n                Preferences.set(property, $this.prop(\"checked\"));\n            } else if (prefType === \"number\") {\n                var newValue = parseInt($this.val().trim(), 10);\n                if (isNaN(newValue)) { newValue = Preferences.getDefaults()[property]; }\n                Preferences.set(property, newValue);\n            } else {\n                Preferences.set(property, $this.val().trim() || null);\n            }\n        });\n        Preferences.save();\n    }\n\n    function assignActions() {\n        var $useDifftoolCheckbox = $(\"#git-settings-useDifftool\", $dialog);\n\n        Git.getConfig(\"diff.tool\").then(function (diffToolConfiguration) {\n\n            if (!diffToolConfiguration) {\n                $useDifftoolCheckbox.prop({\n                    checked: false,\n                    disabled: true\n                });\n            } else {\n                $useDifftoolCheckbox.prop({\n                    disabled: false\n                });\n            }\n\n        }).catch(function () {\n\n            // an error with git\n            // we were not able to check whether diff tool is configured or not\n            // so we disable it just to be sure\n            $useDifftoolCheckbox.prop({\n                checked: false,\n                disabled: true\n            });\n\n        });\n\n        $(\"#git-settings-stripWhitespaceFromCommits\", $dialog).on(\"change\", function () {\n            var on = $(this).is(\":checked\");\n            $(\"#git-settings-addEndlineToTheEndOfFile,#git-settings-removeByteOrderMark,#git-settings-normalizeLineEndings\", $dialog)\n                .prop(\"checked\", on)\n                .prop(\"disabled\", !on);\n        });\n\n        $(\"button[data-button-id='defaults']\", $dialog).on(\"click\", function (e) {\n            e.stopPropagation();\n            setValues(Preferences.getDefaults());\n        });\n    }\n\n    function init() {\n        setValues(Preferences.getAll());\n        assignActions();\n    }\n\n    exports.show = function () {\n        const enableGitPreference = Preferences.get(\"enableGit\");\n        const compiledTemplate = Mustache.render(settingsDialogTemplate, {\n            Strings,\n            gitDisabled: !enableGitPreference,\n            gitNotFound: enableGitPreference ? !Setup.isExtensionActivated() : false\n        });\n\n        dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n        $dialog = dialog.getElement();\n\n        init();\n        $dialog.find(\"#git-settings-enableGit\").on(\"change\", function () {\n            const anyChecked = $dialog.find(\"#git-settings-enableGit:checked\").length > 0;\n            if (anyChecked) {\n                $dialog.find(\".git-settings-content\").removeClass(\"forced-inVisible\");\n            } else {\n                $dialog.find(\".git-settings-content\").addClass(\"forced-inVisible\");\n            }\n        });\n\n        dialog.done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                // Save everything to preferences\n                collectDialogValues();\n            }\n        });\n    };\n});\n\n/*globals jsPromise, logger*/\ndefine(\"src/Utils\", function (require, exports, module) {\n\n    // Brackets modules\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        Commands        = brackets.getModule(\"command/Commands\"),\n        Dialogs         = brackets.getModule(\"widgets/Dialogs\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileSystem      = brackets.getModule(\"filesystem/FileSystem\"),\n        FileUtils       = brackets.getModule(\"file/FileUtils\"),\n        LanguageManager = brackets.getModule(\"language/LanguageManager\"),\n        Mustache        = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        ProjectManager  = brackets.getModule(\"project/ProjectManager\");\n\n    // Local modules\n    const ErrorHandler    = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"src/Preferences\"),\n        Setup           = require(\"src/utils/Setup\"),\n        Constants       = require(\"src/Constants\"),\n        Strings         = brackets.getModule(\"strings\");\n\n    const FORMAT_DIFF_TOO_LARGE = \"<div>\" + Strings.DIFF_TOO_LONG + \"</div>\";\n\n    // Module variables\n    const formatDiffTemplate      = `<table>\n    <tbody>\n        {{#files}}\n            <tr class=\"meta-file\">\n                <th colspan=\"3\">{{name}}</th>\n            </tr>\n            {{#lines}}\n                <tr class=\"diff-row {{lineClass}}\">\n                    <td class=\"row-num\">{{numLineOld}}</td>\n                    <td class=\"row-num\">{{numLineNew}}</td>\n                    <td><pre>{{{line}}}</pre></td>\n                </tr>\n            {{/lines}}\n            <tr class=\"separator\"></tr>\n        {{/files}}\n    </tbody>\n</table>\n`,\n        questionDialogTemplate  = `<div id=\"git-question-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <p>{{{question}}}</p>\n        {{#stringInput}}\n        <input class=\"stringInput\" type=\"text\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/stringInput}}\n        {{#passwordInput}}\n        <input class=\"stringInput\" type=\"password\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/passwordInput}}\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn btn-80 {{#customOkBtnClass}}{{customOkBtnClass}}{{/customOkBtnClass}}{{^customOkBtnClass}}primary{{/customOkBtnClass}}\">\n            {{#customOkBtn}}{{customOkBtn}}{{/customOkBtn}}{{^customOkBtn}}{{Strings.BUTTON_OK}}{{/customOkBtn}}\n        </button>\n    </div>\n</div>\n`,\n        outputDialogTemplate    = `<div id=\"git-output-dialog\" class=\"modal\">\n    {{#title}}\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    {{/title}}\n    <div class=\"modal-body table-striped tab-content\">\n        <pre class=\"git-output\">{{{output}}}</pre>\n        {{#question}}\n        <h4>{{question}}</h4>\n        {{/question}}\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\" class=\"dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n        {{#question}}\n        <button data-button-id=\"ok\"    class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n        {{/question}}\n    </div>\n</div>\n`,\n        writeTestResults        = {},\n        EXT_NAME                = \"[brackets-git] \";\n\n    // Implementation\n    function getProjectRoot() {\n        var projectRoot = ProjectManager.getProjectRoot();\n        return projectRoot ? projectRoot.fullPath : null;\n    }\n\n    // returns \"C:/Users/Zaggi/AppData/Roaming/Brackets/extensions/user/zaggino.brackets-git/\"\n    function getExtensionDirectory() {\n        throw new Error(\"api unsupported\");\n        // var modulePath = ExtensionUtils.getModulePath(module);\n        // return modulePath.slice(0, -1 * \"src/\".length);\n    }\n\n    function formatDiff(diff) {\n        var DIFF_MAX_LENGTH = 2000;\n\n        var tabReplace   = \"\",\n            verbose      = Preferences.get(\"useVerboseDiff\"),\n            numLineOld   = 0,\n            numLineNew   = 0,\n            lastStatus   = 0,\n            diffData     = [];\n\n        var i = Preferences.getGlobal(\"tabSize\");\n        while (i--) {\n            tabReplace += \"&nbsp;\";\n        }\n\n        var LINE_STATUS = {\n            HEADER: 0,\n            UNCHANGED: 1,\n            REMOVED: 2,\n            ADDED: 3,\n            EOF: 4\n        };\n\n        var diffSplit = diff.split(\"\\n\");\n\n        if (diffSplit.length > DIFF_MAX_LENGTH) {\n            return \"\" + FORMAT_DIFF_TOO_LARGE; // create new str to return\n        }\n\n        diffSplit.forEach(function (line) {\n            if (line === \" \") { line = \"\"; }\n\n            var lineClass   = \"\",\n                pushLine    = true;\n\n            if (line.indexOf(\"diff --git\") === 0) {\n                lineClass = \"diffCmd\";\n\n                diffData.push({\n                    name: line.split(\"b/\")[1],\n                    lines: []\n                });\n\n                if (!verbose) {\n                    pushLine = false;\n                }\n            } else if (line.match(/index\\s[A-z0-9]{7}\\.\\.[A-z0-9]{7}/)) {\n                if (!verbose) {\n                    pushLine = false;\n                }\n            } else if (line.substr(0, 3) === \"+++\" || line.substr(0, 3) === \"---\") {\n                if (!verbose) {\n                    pushLine = false;\n                }\n            } else if (line.indexOf(\"@@\") === 0) {\n                lineClass = \"position\";\n\n                // Define the type of the line: Header\n                lastStatus = LINE_STATUS.HEADER;\n\n                // This read the start line for the diff and substract 1 for this line\n                var m = line.match(/^@@ -([,0-9]+) \\+([,0-9]+) @@/);\n                var s1 = m[1].split(\",\");\n                var s2 = m[2].split(\",\");\n\n                numLineOld = s1[0] - 1;\n                numLineNew = s2[0] - 1;\n            } else if (line[0] === \"+\") {\n                lineClass = \"added\";\n                line = line.substring(1);\n\n                // Define the type of the line: Added\n                lastStatus = LINE_STATUS.ADDED;\n\n                // Add 1 to the num line for new document\n                numLineNew++;\n            } else if (line[0] === \"-\") {\n                lineClass = \"removed\";\n                line = line.substring(1);\n\n                // Define the type of the line: Removed\n                lastStatus = LINE_STATUS.REMOVED;\n\n                // Add 1 to the num line for old document\n                numLineOld++;\n            } else if (line[0] === \" \" || line === \"\") {\n                lineClass = \"unchanged\";\n                line = line.substring(1);\n\n                // Define the type of the line: Unchanged\n                lastStatus = LINE_STATUS.UNCHANGED;\n\n                // Add 1 to old a new num lines\n                numLineOld++;\n                numLineNew++;\n            } else if (line === \"\\\\ No newline at end of file\") {\n                lastStatus = LINE_STATUS.EOF;\n                lineClass = \"end-of-file\";\n            } else {\n                console.log(\"Unexpected line in diff: \" + line);\n            }\n\n            if (pushLine) {\n                var _numLineOld = \"\",\n                    _numLineNew = \"\";\n\n                switch (lastStatus) {\n                    case LINE_STATUS.HEADER:\n                    case LINE_STATUS.EOF:\n                        // _numLineOld = \"\";\n                        // _numLineNew = \"\";\n                        break;\n                    case LINE_STATUS.UNCHANGED:\n                        _numLineOld = numLineOld;\n                        _numLineNew = numLineNew;\n                        break;\n                    case LINE_STATUS.REMOVED:\n                        _numLineOld = numLineOld;\n                        // _numLineNew = \"\";\n                        break;\n                    // case LINE_STATUS.ADDED:\n                    default:\n                        // _numLineOld = \"\";\n                        _numLineNew = numLineNew;\n                }\n\n                // removes ZERO WIDTH NO-BREAK SPACE character (BOM)\n                line = line.replace(/\\uFEFF/g, \"\");\n\n                // exposes other potentially harmful characters\n                line = line.replace(/[\\u2000-\\uFFFF]/g, function (x) {\n                    return \"<U+\" + x.charCodeAt(0).toString(16).toUpperCase() + \">\";\n                });\n\n                line = _.escape(line)\n                    .replace(/\\t/g, tabReplace)\n                    .replace(/\\s/g, \"&nbsp;\");\n\n                line = line.replace(/(&nbsp;)+$/g, function (trailingWhitespace) {\n                    return \"<span class='trailingWhitespace'>\" + trailingWhitespace + \"</span>\";\n                });\n\n                if (diffData.length > 0) {\n                    _.last(diffData).lines.push({\n                        \"numLineOld\": _numLineOld,\n                        \"numLineNew\": _numLineNew,\n                        \"line\": line,\n                        \"lineClass\": lineClass\n                    });\n                }\n            }\n        });\n\n        return Mustache.render(formatDiffTemplate, { files: diffData });\n    }\n\n    function askQuestion(title, question, options) {\n        return new Promise(function (resolve, reject) {\n            options = options || {};\n\n            if (!options.noescape) {\n                question = _.escape(question);\n            }\n\n            var compiledTemplate = Mustache.render(questionDialogTemplate, {\n                title: title,\n                question: question,\n                stringInput: !options.booleanResponse && !options.password,\n                passwordInput: options.password,\n                defaultValue: options.defaultValue,\n                customOkBtn: options.customOkBtn,\n                customOkBtnClass: options.customOkBtnClass,\n                Strings: Strings\n            });\n\n            var dialog  = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n                $dialog = dialog.getElement();\n\n            _.defer(function () {\n                var $input = $dialog.find(\"input:visible\");\n                if ($input.length > 0) {\n                    $input.focus();\n                } else {\n                    $dialog.find(\".primary\").focus();\n                }\n            });\n\n            dialog.done(function (buttonId) {\n                if (options.booleanResponse) {\n                    return resolve(buttonId === \"ok\");\n                }\n                if (buttonId === \"ok\") {\n                    resolve(dialog.getElement().find(\"input\").val().trim());\n                } else {\n                    reject(Strings.USER_ABORTED);\n                }\n            });\n        });\n    }\n\n    function showOutput(output, title, options) {\n        return new Promise(function (resolve) {\n            options = options || {};\n            var compiledTemplate = Mustache.render(outputDialogTemplate, {\n                title: title,\n                output: output,\n                Strings: Strings,\n                question: options.question\n            });\n            var dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n            dialog.getElement().find(\"button\").focus();\n            dialog.done(function (buttonId) {\n                resolve(buttonId === \"ok\");\n            });\n        });\n    }\n\n    function isProjectRootWritable() {\n        return new Promise(function (resolve) {\n\n            var folder = getProjectRoot();\n\n            // if we previously tried, assume nothing has changed\n            if (writeTestResults[folder]) {\n                return resolve(writeTestResults[folder]);\n            }\n\n            // create entry for temporary file\n            var fileEntry = FileSystem.getFileForPath(folder + \".phoenixGitTemp\");\n\n            function finish(bool) {\n                // delete the temp file and resolve\n                fileEntry.unlink(function () {\n                    writeTestResults[folder] = bool;\n                    resolve(bool);\n                });\n            }\n\n            // try writing some text into the temp file\n            jsPromise(FileUtils.writeText(fileEntry, \"\"))\n                .then(function () {\n                    finish(true);\n                })\n                .catch(function () {\n                    finish(false);\n                });\n        });\n    }\n\n    function pathExists(path) {\n        return new Promise(function (resolve) {\n            FileSystem.resolve(path, function (err, entry) {\n                resolve(!err && entry ? true : false);\n            });\n        });\n    }\n\n    function loadPathContent(path) {\n        return new Promise(function (resolve) {\n            FileSystem.resolve(path, function (err, entry) {\n                if (err) {\n                    return resolve(null);\n                }\n                if (entry._clearCachedData) {\n                    entry._clearCachedData();\n                }\n                if (entry.isFile) {\n                    entry.read(function (err, content) {\n                        if (err) {\n                            return resolve(null);\n                        }\n                        resolve(content);\n                    });\n                } else {\n                    entry.getContents(function (err, contents) {\n                        if (err) {\n                            return resolve(null);\n                        }\n                        resolve(contents);\n                    });\n                }\n            });\n        });\n    }\n\n    function isLoading($btn) {\n        return $btn.hasClass(\"btn-loading\");\n    }\n\n    function setLoading($btn) {\n        $btn.prop(\"disabled\", true).addClass(\"btn-loading\");\n    }\n\n    function unsetLoading($btn) {\n        $btn.prop(\"disabled\", false).removeClass(\"btn-loading\");\n    }\n\n    function encodeSensitiveInformation(str) {\n        // should match passwords in http/https urls\n        str = str.replace(/(https?:\\/\\/)([^:@\\s]*):([^:@]*)?@/g, function (a, protocol, user/*, pass*/) {\n            return protocol + user + \":***@\";\n        });\n        // should match user name in windows user folders\n        str = str.replace(/(users)(\\\\|\\/)([^\\\\\\/]+)(\\\\|\\/)/i, function (a, users, slash1, username, slash2) {\n            return users + slash1 + \"***\" + slash2;\n        });\n        return str;\n    }\n\n    function consoleWarn(msg) {\n        console.warn(encodeSensitiveInformation(msg));\n    }\n\n    function consoleError(msg) {\n        console.error(encodeSensitiveInformation(msg));\n    }\n\n    function consoleDebug(msg) {\n        if (logger.loggingOptions.logGit) {\n            console.log(EXT_NAME + encodeSensitiveInformation(msg));\n        }\n    }\n\n    /**\n     * Reloads the Document's contents from disk, discarding any unsaved changes in the editor.\n     *\n     * @param {!Document} doc\n     * @return {Promise} Resolved after editor has been refreshed; rejected if unable to load the\n     *      file's new content. Errors are logged but no UI is shown.\n     */\n    function reloadDoc(doc) {\n        return jsPromise(FileUtils.readAsText(doc.file))\n            .then(function (text) {\n                doc.refreshText(text, new Date());\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(\"Error reloading contents of \" + doc.file.fullPath);\n                ErrorHandler.logError(err);\n            });\n    }\n\n    /**\n     *  strips trailing whitespace from all the diffs and adds \\n to the end\n     */\n    function stripWhitespaceFromFile(filename, clearWholeFile) {\n        return new Promise(function (resolve, reject) {\n\n            var fullPath                  = Preferences.get(\"currentGitRoot\") + filename,\n                addEndlineToTheEndOfFile  = Preferences.get(\"addEndlineToTheEndOfFile\"),\n                removeBom                 = Preferences.get(\"removeByteOrderMark\"),\n                normalizeLineEndings      = Preferences.get(\"normalizeLineEndings\");\n\n            var _cleanLines = function (lineNumbers) {\n                // do not clean if there's nothing to clean\n                if (lineNumbers && lineNumbers.length === 0) {\n                    return resolve();\n                }\n                // clean the file\n                var fileEntry = FileSystem.getFileForPath(fullPath);\n                return jsPromise(FileUtils.readAsText(fileEntry))\n                    .catch(function (err) {\n                        ErrorHandler.logError(err + \" on FileUtils.readAsText for \" + fileEntry.fullPath);\n                        return null;\n                    })\n                    .then(function (text) {\n                        if (text === null) {\n                            return resolve();\n                        }\n\n                        if (removeBom) {\n                            // remove BOM - \\uFEFF\n                            text = text.replace(/\\uFEFF/g, \"\");\n                        }\n                        if (normalizeLineEndings) {\n                            // normalizes line endings\n                            text = text.replace(/\\r\\n/g, \"\\n\");\n                        }\n                        // process lines\n                        var lines = text.split(\"\\n\");\n\n                        if (lineNumbers) {\n                            lineNumbers.forEach(function (lineNumber) {\n                                if (typeof lines[lineNumber] === \"string\") {\n                                    lines[lineNumber] = lines[lineNumber].replace(/\\s+$/, \"\");\n                                }\n                            });\n                        } else {\n                            lines.forEach(function (ln, lineNumber) {\n                                if (typeof lines[lineNumber] === \"string\") {\n                                    lines[lineNumber] = lines[lineNumber].replace(/\\s+$/, \"\");\n                                }\n                            });\n                        }\n\n                        // add empty line to the end, i've heard that git likes that for some reason\n                        if (addEndlineToTheEndOfFile) {\n                            var lastLineNumber = lines.length - 1;\n                            if (lines[lastLineNumber].length > 0) {\n                                lines[lastLineNumber] = lines[lastLineNumber].replace(/\\s+$/, \"\");\n                            }\n                            if (lines[lastLineNumber].length > 0) {\n                                lines.push(\"\");\n                            }\n                        }\n\n                        text = lines.join(\"\\n\");\n                        return jsPromise(FileUtils.writeText(fileEntry, text))\n                            .catch(function (err) {\n                                ErrorHandler.logError(\"Wasn't able to clean whitespace from file: \" + fullPath);\n                                resolve();\n                                throw err;\n                            })\n                            .then(function () {\n                                // refresh the file if it's open in the background\n                                DocumentManager.getAllOpenDocuments().forEach(function (doc) {\n                                    if (doc.file.fullPath === fullPath) {\n                                        reloadDoc(doc);\n                                    }\n                                });\n                                // diffs were cleaned in this file\n                                resolve();\n                            });\n                    });\n            };\n\n            if (clearWholeFile) {\n                _cleanLines(null);\n            } else {\n                Git.diffFile(filename).then(function (diff) {\n                    // if git returned an empty diff\n                    if (!diff) { return resolve(); }\n\n                    // if git detected that the file is binary\n                    if (diff.match(/^binary files.*differ$/img)) { return resolve(); }\n\n                    var modified = [],\n                        changesets = diff.split(\"\\n\").filter(function (l) { return l.match(/^@@/) !== null; });\n                    // collect line numbers to clean\n                    changesets.forEach(function (line) {\n                        var i,\n                            m = line.match(/^@@ -([,0-9]+) \\+([,0-9]+) @@/),\n                            s = m[2].split(\",\"),\n                            from = parseInt(s[0], 10),\n                            to = from - 1 + (parseInt(s[1], 10) || 1);\n                        for (i = from; i <= to; i++) { modified.push(i > 0 ? i - 1 : 0); }\n                    });\n                    _cleanLines(modified);\n                }).catch(function (ex) {\n                    // This error will bubble up to preparing commit dialog so just log here\n                    ErrorHandler.logError(ex);\n                    reject(ex);\n                });\n            }\n        });\n    }\n\n    function stripWhitespaceFromFiles(gitStatusResults, stageChanges, progressTracker) {\n        return new Promise((resolve, reject)=>{\n            const startTime = (new Date()).getTime();\n            let queue = Promise.resolve();\n\n            gitStatusResults.forEach(function (fileObj) {\n                var isDeleted = fileObj.status.indexOf(Git.FILE_STATUS.DELETED) !== -1;\n\n                // strip whitespace if the file was not deleted\n                if (!isDeleted) {\n                    // strip whitespace only for recognized languages so binary files won't get corrupted\n                    var langId = LanguageManager.getLanguageForPath(fileObj.file).getId();\n                    if ([\"unknown\", \"binary\", \"image\", \"markdown\", \"audio\"].indexOf(langId) === -1) {\n\n                        queue = queue.then(function () {\n                            var clearWholeFile = fileObj.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1 ||\n                                fileObj.status.indexOf(Git.FILE_STATUS.RENAMED) !== -1;\n\n                            var t = (new Date()).getTime() - startTime;\n                            progressTracker.trigger(Events.GIT_PROGRESS_EVENT,\n                                t + \"ms - \" + Strings.CLEAN_FILE_START + \": \" + fileObj.file);\n\n                            return stripWhitespaceFromFile(fileObj.file, clearWholeFile).then(function () {\n                                // stage the files again to include stripWhitespace changes\n                                var notifyProgress = function () {\n                                    var t = (new Date()).getTime() - startTime;\n                                    progressTracker.trigger(Events.GIT_PROGRESS_EVENT,\n                                        t + \"ms - \" + Strings.CLEAN_FILE_END + \": \" + fileObj.file);\n                                };\n                                if (stageChanges) {\n                                    return Git.stage(fileObj.file).then(notifyProgress);\n                                } else {\n                                    notifyProgress();\n                                }\n                            });\n                        });\n\n                    }\n                }\n            });\n\n            queue\n                .then(function () {\n                    resolve();\n                })\n                .catch(function () {\n                    reject();\n                });\n        });\n    }\n\n    function openEditorForFile(file, relative) {\n        if (relative) {\n            file = getProjectRoot() + file;\n        }\n        CommandManager.execute(Commands.FILE_OPEN, {\n            fullPath: file\n        });\n    }\n\n    let clearWhitespace = Preferences.get(\"clearWhitespaceOnSave\");\n    Preferences.getExtensionPref().on(\"change\", \"clearWhitespaceOnSave\", ()=>{\n        clearWhitespace = Preferences.get(\"clearWhitespaceOnSave\");\n    });\n\n    EventEmitter.on(Events.BRACKETS_DOCUMENT_SAVED, function (doc) {\n        if(!clearWhitespace){\n            return;\n        }\n        var fullPath       = doc.file.fullPath,\n            currentGitRoot = Preferences.get(\"currentGitRoot\"),\n            path           = fullPath.substring(currentGitRoot.length);\n        stripWhitespaceFromFile(path);\n    });\n\n    function enableCommand(commandID, enabled) {\n        const command = CommandManager.get(commandID);\n        if(!command){\n            return;\n        }\n        enabled = commandID === Constants.CMD_GIT_SETTINGS_COMMAND_ID ?\n            true : enabled && Setup.isExtensionActivated();\n        command.setEnabled(enabled);\n    }\n\n    // Public API\n    exports.FORMAT_DIFF_TOO_LARGE       = FORMAT_DIFF_TOO_LARGE;\n    exports.formatDiff                  = formatDiff;\n    exports.getProjectRoot              = getProjectRoot;\n    exports.getExtensionDirectory       = getExtensionDirectory;\n    exports.askQuestion                 = askQuestion;\n    exports.showOutput                  = showOutput;\n    exports.isProjectRootWritable       = isProjectRootWritable;\n    exports.pathExists                  = pathExists;\n    exports.loadPathContent             = loadPathContent;\n    exports.setLoading                  = setLoading;\n    exports.unsetLoading                = unsetLoading;\n    exports.isLoading                   = isLoading;\n    exports.consoleWarn                 = consoleWarn;\n    exports.consoleError                = consoleError;\n    exports.consoleDebug                = consoleDebug;\n    exports.encodeSensitiveInformation  = encodeSensitiveInformation;\n    exports.reloadDoc                   = reloadDoc;\n    exports.stripWhitespaceFromFiles    = stripWhitespaceFromFiles;\n    exports.openEditorForFile           = openEditorForFile;\n    exports.enableCommand               = enableCommand;\n\n});\n\ndefine(\"src/dialogs/Clone\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const RemoteCommon    = require(\"src/dialogs/RemoteCommon\"),\n        Strings           = brackets.getModule(\"strings\");\n\n    // Templates\n    const template            = `<div id=\"git-clone-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.CLONE_REPOSITORY}}</h1>\n    </div>\n    <div class=\"modal-body\">\n\n        <label for=\"git-clone-url\">{{Strings.ENTER_REMOTE_GIT_URL}}</label>\n        <input type=\"text\" class=\"stringInput\" id=\"git-clone-url\" autocomplete=\"off\" spellcheck=\"false\" />\n\n        <hr>\n\n        <div class=\"accordion\">\n            <!-- Hidden checkbox to toggle the accordion -->\n            <input type=\"checkbox\" id=\"advancedAccordionToggle\" class=\"accordion-toggle\" />\n\n            <!-- Accordion Header -->\n            <label for=\"advancedAccordionToggle\" class=\"accordion-header\">\n                {{Strings.MORE_OPTIONS}}\n                <i class=\"fas fa-chevron-down\"></i>\n            </label>\n\n            <!-- Accordion Content -->\n            <div class=\"accordion-content\">\n                <label class=\"text-bold\">\n                    {{Strings.CREDENTIALS}}\n                </label>\n                <div>\n                    <label class=\"text-quiet\">\n                        {{Strings.SAVE_CREDENTIALS_HELP}}\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.USERNAME}}:\n                    </label>\n                    <label>\n                        <input type=\"text\" name=\"username\" value=\"{{config.remoteUsername}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.PASSWORD}}:\n                    </label>\n                    <label>\n                        <input type=\"password\" name=\"password\" value=\"{{config.remotePassword}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"saveToUrl\" />\n                        {{Strings.SAVE_CREDENTIALS_IN_URL}}\n                    </label>\n                </div>\n            </div>\n        </div>\n\n\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n</div>\n`;\n\n    // Module variables\n    let $cloneInput;\n\n    // Implementation\n    function _attachEvents($dialog) {\n        // Detect changes to URL, disable auth if not http\n        $cloneInput.on(\"keyup change\", function () {\n            var $authInputs = $dialog.find(\"input[name='username'],input[name='password'],input[name='saveToUrl']\");\n            if ($(this).val().length > 0) {\n                if (/^https?:/.test($(this).val())) {\n                    $authInputs.prop(\"disabled\", false);\n\n                    // Update the auth fields if the URL contains auth\n                    var auth = /:\\/\\/([^:]+):?([^@]*)@/.exec($(this).val());\n                    if (auth) {\n                        $(\"input[name=username]\", $dialog).val(auth[1]);\n                        $(\"input[name=password]\", $dialog).val(auth[2]);\n                    }\n                } else {\n                    $authInputs.prop(\"disabled\", true);\n                }\n            } else {\n                $authInputs.prop(\"disabled\", false);\n            }\n        });\n        $cloneInput.focus();\n    }\n\n    function show() {\n        return new Promise((resolve, reject)=>{\n            const templateArgs = {\n                modeLabel: Strings.CLONE_REPOSITORY,\n                Strings: Strings\n            };\n\n            var compiledTemplate = Mustache.render(template, templateArgs),\n                dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n                $dialog = dialog.getElement();\n\n            $cloneInput = $dialog.find(\"#git-clone-url\");\n\n            _attachEvents($dialog);\n\n            dialog.done(function (buttonId) {\n                if (buttonId === \"ok\") {\n                    var cloneConfig = {};\n                    cloneConfig.remote = \"origin\";\n                    cloneConfig.remoteUrl = $cloneInput.val();\n                    RemoteCommon.collectValues(cloneConfig, $dialog);\n                    resolve(cloneConfig);\n                } else {\n                    reject();\n                }\n            });\n\n        });\n    }\n\n    exports.show = show;\n});\n\ndefine(\"src/dialogs/Progress\", function (require, exports) {\n    const EventDispatcher = brackets.getModule(\"utils/EventDispatcher\");\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Strings             = brackets.getModule(\"strings\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const Events        = require(\"src/Events\");\n\n    // Templates\n    var template = `<div id=\"git-progress-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    <div class=\"modal-body\">\n        <textarea readonly=\"readonly\"></textarea>\n    </div>\n    <!--\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n    -->\n</div>\n`;\n\n    // Module variables\n    var lines,\n        $textarea;\n\n    const maxLines = 5000;\n    // some git commit may have pre commit/push hooks which\n    // may run tests suits that print large amount of data on the console, so we need to\n    // debounce and truncate the git output we get in progress window.\n    function addLine(str) {\n        if (lines.length >= maxLines) {\n            lines.shift(); // Remove the oldest line\n        }\n        lines.push(str);\n    }\n    let updateTimeout = null;\n    function updateTextarea() {\n        if(updateTimeout){\n            // an update is scheduled, debounce, we dont need to print now\n            return;\n        }\n        updateTimeout = setTimeout(() => {\n            updateTimeout = null;\n            if(!$textarea || !lines.length){\n                return;\n            }\n            $textarea.val(lines.join(\"\\n\"));\n            $textarea.scrollTop($textarea[0].scrollHeight - $textarea.height());\n        }, 100);\n    }\n\n    function onProgress(str) {\n        if (typeof str === \"string\") {\n            addLine(str);\n        }\n        updateTextarea();\n    }\n\n    function show(promise, progressTracker, showOpts = {}) {\n        if (!promise || !promise.finally) {\n            throw new Error(\"Invalid promise argument for progress dialog!\");\n        }\n        if(!progressTracker) {\n            throw new Error(\"Invalid progressTracker argument for progress dialog!\");\n        }\n\n        const title = showOpts.title;\n        const options = showOpts.options || {};\n\n        return new Promise(function (resolve, reject) {\n\n            lines = showOpts.initialMessage ? [showOpts.initialMessage] : [];\n            $textarea = null;\n\n            var dialog,\n                finished = false;\n\n            function showDialog() {\n                if (finished) {\n                    return;\n                }\n\n                var templateArgs = {\n                    title: title || Strings.OPERATION_IN_PROGRESS_TITLE,\n                    Strings: Strings\n                };\n\n                var compiledTemplate = Mustache.render(template, templateArgs);\n                dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n\n                $textarea = dialog.getElement().find(\"textarea\");\n                $textarea.val(Strings.PLEASE_WAIT);\n                onProgress();\n            }\n\n            let finalValue, finalError;\n            function finish() {\n                finished = true;\n                if (dialog) {\n                    dialog.close();\n                }\n                if(finalError){\n                    reject(finalError);\n                } else {\n                    resolve(finalValue);\n                }\n            }\n\n            if (!options.preDelay) {\n                showDialog();\n            } else {\n                setTimeout(function () {\n                    showDialog();\n                }, options.preDelay * 1000);\n            }\n\n            progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.progressDlg`);\n            progressTracker.on(`${Events.GIT_PROGRESS_EVENT}.progressDlg`, (_evt, data)=>{\n                onProgress(data);\n            });\n            promise\n                .then(val => {\n                    finalValue = val;\n                })\n                .catch(err => {\n                    finalError = err;\n                })\n                .finally(function () {\n                    progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.progressDlg`);\n                    onProgress(\"Finished!\");\n                    if (!options.postDelay || !dialog) {\n                        finish();\n                    } else {\n                        setTimeout(function () {\n                            finish();\n                        }, options.postDelay * 1000);\n                    }\n                });\n\n        });\n    }\n\n    function waitForClose() {\n        return new Promise(function (resolve) {\n            function check() {\n                var visible = $(\"#git-progress-dialog\").is(\":visible\");\n                if (!visible) {\n                    resolve();\n                } else {\n                    setTimeout(check, 20);\n                }\n            }\n            setTimeout(check, 20);\n        });\n    }\n\n    function newProgressTracker() {\n        const tracker = {};\n        EventDispatcher.makeEventDispatcher(tracker);\n        return tracker;\n    }\n\n    exports.show = show;\n    exports.newProgressTracker = newProgressTracker;\n    exports.waitForClose = waitForClose;\n\n});\n\ndefine(\"src/dialogs/Pull\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const Preferences     = require(\"src/Preferences\"),\n        RemoteCommon    = require(\"src/dialogs/RemoteCommon\"),\n        Strings         = brackets.getModule(\"strings\");\n\n    // Templates\n    const template            = `<div id=\"git-pull-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.DIALOG_PULL_TITLE}} &mdash; {{config.remote}}</h1>\n    </div>\n    <div class=\"modal-body\">\n\n        {{> remotes}}\n\n        <hr>\n        <label class=\"text-bold\">\n            {{Strings.PULL_BEHAVIOR}}\n        </label>\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"DEFAULT\"> {{Strings.PULL_DEFAULT}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"AVOID_MERGING\"> {{Strings.PULL_AVOID_MERGING}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"MERGE_NOCOMMIT\"> {{Strings.PULL_MERGE_NOCOMMIT}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"REBASE\"> {{Strings.PULL_REBASE}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"RESET\"> {{Strings.PULL_RESET}}\n            </label>\n        </div>\n\n        <hr>\n\n        <div class=\"accordion\">\n            <!-- Hidden checkbox to toggle the accordion -->\n            <input type=\"checkbox\" id=\"advancedAccordionToggle\" class=\"accordion-toggle\" />\n\n            <!-- Accordion Header -->\n            <label for=\"advancedAccordionToggle\" class=\"accordion-header\">\n                {{Strings.MORE_OPTIONS}}\n                <i class=\"fas fa-chevron-down\"></i>\n            </label>\n\n            <!-- Accordion Content -->\n            <div class=\"accordion-content\">\n                <label class=\"text-bold\">\n                    {{Strings.CREDENTIALS}}\n                </label>\n                <div>\n                    <label class=\"text-quiet\">\n                        {{Strings.SAVE_CREDENTIALS_HELP}}\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.USERNAME}}:\n                    </label>\n                    <label>\n                        <input type=\"text\" name=\"username\" value=\"{{config.remoteUsername}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.PASSWORD}}:\n                    </label>\n                    <label>\n                        <input type=\"password\" name=\"password\" value=\"{{config.remotePassword}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"saveToUrl\" />\n                        {{Strings.SAVE_CREDENTIALS_IN_URL}}\n                    </label>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n</div>\n`,\n        remotesTemplate     = `<div class=\"current-tracking-branch\">\n    <label>\n        {{Strings.CURRENT_TRACKING_BRANCH}}:\n    </label>\n    <label class=\"text-bold\">\n        {{config.currentTrackingBranch}}\n        {{^config.currentTrackingBranch}}\n        none - \"{{config.currentBranchName}}\" branch will be created on remote\n        {{/config.currentTrackingBranch}}\n    </label>\n</div>\n\n<div>\n    <label class=\"text-bold\">\n        {{Strings.TARGET_BRANCH}}\n    </label>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_CURRENT\" checked> {{modeLabel}} {{Strings._CURRENT_TRACKING_BRANCH}}\n    </label>\n</div>\n\n<div>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_SELECTED\"> {{modeLabel}} {{Strings._ANOTHER_BRANCH}}\n    </label>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <div class=\"input-append\">\n        <select class=\"branchSelect\" name=\"selectedBranch\"></select>\n        <button class=\"btn fetchBranches\" type=\"button\"><i class=\"octicon octicon-sync\"></i></button>\n    </div>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <label>\n        <input type=\"checkbox\" name=\"setBranchAsTracking\"> {{Strings.SET_THIS_BRANCH_AS_TRACKING}}\n    </label>\n</div>\n`;\n\n    // Implementation\n    function _attachEvents($dialog, pullConfig) {\n        RemoteCommon.attachCommonEvents(pullConfig, $dialog);\n\n        // load last used\n        $dialog\n            .find(\"input[name='strategy']\")\n            .filter(\"[value='\" + (Preferences.get(\"pull.strategy\") || \"DEFAULT\") + \"']\")\n            .prop(\"checked\", true);\n    }\n\n    function _show(pullConfig, resolve, reject) {\n        const templateArgs = {\n            config: pullConfig,\n            mode: \"PULL_FROM\",\n            modeLabel: Strings.PULL_FROM,\n            Strings: Strings\n        };\n\n        const compiledTemplate = Mustache.render(template, templateArgs, {\n                remotes: remotesTemplate\n            }),\n            dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog = dialog.getElement();\n\n        _attachEvents($dialog, pullConfig);\n\n        dialog.done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                RemoteCommon.collectValues(pullConfig, $dialog);\n                Preferences.set(\"pull.strategy\", pullConfig.strategy);\n                resolve(pullConfig);\n            } else {\n                reject();\n            }\n        });\n    }\n\n    function show(pullConfig) {\n        return new Promise((resolve, reject) => {\n            pullConfig.pull = true;\n            // collectInfo never rejects\n            RemoteCommon.collectInfo(pullConfig).then(()=>{\n                _show(pullConfig, resolve, reject);\n            });\n        });\n    }\n\n    exports.show = show;\n\n});\n\ndefine(\"src/dialogs/Push\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const RemoteCommon    = require(\"src/dialogs/RemoteCommon\"),\n        Strings           = brackets.getModule(\"strings\");\n\n    // Templates\n    const template            = `<div id=\"git-push-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.DIALOG_PUSH_TITLE}} &mdash; {{config.remote}}</h1>\n    </div>\n    <div class=\"modal-body\">\n\n        {{> remotes}}\n\n        <hr>\n        <label class=\"text-bold\">\n            {{Strings.PUSH_BEHAVIOR}}\n        </label>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"DEFAULT\"> {{Strings.PUSH_DEFAULT}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"FORCED\"> {{Strings.PUSH_FORCED}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"DELETE_BRANCH\"> {{Strings.PUSH_DELETE_BRANCH}}\n            </label>\n        </div>\n\n        <hr>\n\n        <div class=\"accordion\">\n            <!-- Hidden checkbox to toggle the accordion -->\n            <input type=\"checkbox\" id=\"advancedAccordionToggle\" class=\"accordion-toggle\" />\n\n            <!-- Accordion Header -->\n            <label for=\"advancedAccordionToggle\" class=\"accordion-header\">\n                {{Strings.MORE_OPTIONS}}\n                <i class=\"fas fa-chevron-down\"></i>\n            </label>\n\n            <!-- Accordion Content -->\n            <div class=\"accordion-content\">\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"send_tags\" value=\"true\"> {{Strings.PUSH_SEND_TAGS}}\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"push-no-verify\" value=\"true\"> {{Strings.SKIP_PRE_PUSH_CHECKS}}\n                    </label>\n                </div>\n                <br>\n                <label class=\"text-bold\">\n                    {{Strings.CREDENTIALS}}\n                </label>\n                <div>\n                    <label class=\"text-quiet\">\n                        {{Strings.SAVE_CREDENTIALS_HELP}}\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.USERNAME}}:\n                    </label>\n                    <label>\n                        <input type=\"text\" name=\"username\" value=\"{{config.remoteUsername}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.PASSWORD}}:\n                    </label>\n                    <label>\n                        <input type=\"password\" name=\"password\" value=\"{{config.remotePassword}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"saveToUrl\" />\n                        {{Strings.SAVE_CREDENTIALS_IN_URL}}\n                    </label>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n</div>\n`,\n        remotesTemplate     = `<div class=\"current-tracking-branch\">\n    <label>\n        {{Strings.CURRENT_TRACKING_BRANCH}}:\n    </label>\n    <label class=\"text-bold\">\n        {{config.currentTrackingBranch}}\n        {{^config.currentTrackingBranch}}\n        none - \"{{config.currentBranchName}}\" branch will be created on remote\n        {{/config.currentTrackingBranch}}\n    </label>\n</div>\n\n<div>\n    <label class=\"text-bold\">\n        {{Strings.TARGET_BRANCH}}\n    </label>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_CURRENT\" checked> {{modeLabel}} {{Strings._CURRENT_TRACKING_BRANCH}}\n    </label>\n</div>\n\n<div>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_SELECTED\"> {{modeLabel}} {{Strings._ANOTHER_BRANCH}}\n    </label>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <div class=\"input-append\">\n        <select class=\"branchSelect\" name=\"selectedBranch\"></select>\n        <button class=\"btn fetchBranches\" type=\"button\"><i class=\"octicon octicon-sync\"></i></button>\n    </div>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <label>\n        <input type=\"checkbox\" name=\"setBranchAsTracking\"> {{Strings.SET_THIS_BRANCH_AS_TRACKING}}\n    </label>\n</div>\n`;\n\n    // Implementation\n    function _attachEvents($dialog, pushConfig) {\n        RemoteCommon.attachCommonEvents(pushConfig, $dialog);\n\n        // select default - we don't want to remember forced or delete branch as default\n        $dialog\n            .find(\"input[name='strategy']\")\n            .filter(\"[value='DEFAULT']\")\n            .prop(\"checked\", true);\n    }\n\n    function _show(pushConfig, resolve, reject) {\n        const templateArgs = {\n            config: pushConfig,\n            mode: \"PUSH_TO\",\n            modeLabel: Strings.PUSH_TO,\n            Strings: Strings\n        };\n\n        const compiledTemplate = Mustache.render(template, templateArgs, {\n                remotes: remotesTemplate\n            }),\n            dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog = dialog.getElement();\n\n        _attachEvents($dialog, pushConfig);\n\n        dialog.done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                RemoteCommon.collectValues(pushConfig, $dialog);\n                resolve(pushConfig);\n            } else {\n                reject();\n            }\n        });\n    }\n\n    function show(pushConfig) {\n        return new Promise((resolve, reject) => {\n            pushConfig.push = true;\n            // collectInfo never rejects\n            RemoteCommon.collectInfo(pushConfig).then(()=>{\n                _show(pushConfig, resolve, reject);\n            });\n        });\n    }\n\n    exports.show = show;\n\n});\n\ndefine(\"src/dialogs/RemoteCommon\", function (require, exports) {\n\n    // Brackets modules\n    const _ = brackets.getModule(\"thirdparty/lodash\"),\n        Strings = brackets.getModule(\"strings\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const ErrorHandler    = require(\"src/ErrorHandler\"),\n        Git             = require(\"src/git/Git\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\");\n\n    // Implementation\n\n    function fillBranches(config, $dialog) {\n        Git.getAllBranches().then(function (branches) {\n            // filter only branches for this remote\n            branches = _.filter(branches, function (branch) {\n                return branch.remote === config.remote;\n            });\n\n            const template = \"{{#branches}}<option value='{{name}}' remote='{{remote}}' \" +\n                \"{{#currentBranch}}selected{{/currentBranch}}>{{name}}</option>{{/branches}}\";\n            const html = Mustache.render(template, { branches: branches });\n            $dialog.find(\".branchSelect\").html(html);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_BRANCH_LIST);\n        });\n    }\n\n    // this should never reject for now, just show error message and bail out\n    exports.collectInfo = function (config) {\n        return Git.getCurrentUpstreamBranch().then(function (upstreamBranch) {\n            config.currentTrackingBranch = upstreamBranch;\n\n            return Git.getRemoteUrl(config.remote).then(function (remoteUrl) {\n                config.remoteUrl = remoteUrl;\n\n                if (remoteUrl.match(/^https?:/)) {\n                    const url = new URL(remoteUrl);\n                    config.remoteUsername = url.username;\n                    config.remotePassword = url.password;\n                } else {\n                    // disable the inputs\n                    config._usernamePasswordDisabled = true;\n                }\n\n                if (!upstreamBranch) {\n                    return Git.getCurrentBranchName().then(function (currentBranchName) {\n                        config.currentBranchName = currentBranchName;\n                    });\n                }\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE);\n        });\n    };\n\n    exports.attachCommonEvents = function (config, $dialog) {\n        const handleRadioChange = function () {\n            const val = $dialog.find(\"input[name='action']:checked\").val();\n            $dialog.find(\".only-from-selected\").toggle(val === \"PULL_FROM_SELECTED\" || val === \"PUSH_TO_SELECTED\");\n        };\n        $dialog.on(\"change\", \"input[name='action']\", handleRadioChange);\n        handleRadioChange();\n\n        let trackingBranchRemote = null;\n        if (config.currentTrackingBranch) {\n            trackingBranchRemote = config.currentTrackingBranch.substring(0, config.currentTrackingBranch.indexOf(\"/\"));\n        }\n\n        // if we're pulling from another remote than current tracking remote\n        if (config.currentTrackingBranch && trackingBranchRemote !== config.remote) {\n            if (config.pull) {\n                $dialog.find(\"input[value='PULL_FROM_CURRENT']\").prop(\"disabled\", true);\n                $dialog.find(\"input[value='PULL_FROM_SELECTED']\").prop(\"checked\", true).trigger(\"change\");\n            } else {\n                $dialog.find(\"input[value='PUSH_TO_CURRENT']\").prop(\"disabled\", true);\n                $dialog.find(\"input[value='PUSH_TO_SELECTED']\").prop(\"checked\", true).trigger(\"change\");\n            }\n        }\n\n        $dialog.on(\"click\", \".fetchBranches\", function () {\n            const tracker = ProgressDialog.newProgressTracker();\n            ProgressDialog.show(Git.fetchRemote(config.remote, tracker), tracker)\n                .then(function () {\n                    fillBranches(config, $dialog);\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE);\n                });\n        });\n        fillBranches(config, $dialog);\n\n        if (config._usernamePasswordDisabled) {\n            $dialog.find(\"input[name='username'],input[name='password'],input[name='saveToUrl']\").prop(\"disabled\", true);\n        }\n    };\n\n    exports.collectValues = function (config, $dialog) {\n        const action = $dialog.find(\"input[name='action']:checked\").val();\n        if (action === \"PULL_FROM_CURRENT\" || action === \"PUSH_TO_CURRENT\") {\n\n            if (config.currentTrackingBranch) {\n                config.branch = config.currentTrackingBranch.substring(config.remote.length + 1);\n            } else {\n                config.branch = config.currentBranchName;\n                config.pushToNew = true;\n            }\n\n        } else if (action === \"PULL_FROM_SELECTED\" || action === \"PUSH_TO_SELECTED\") {\n            config.branch = $dialog.find(\".branchSelect\").val().substring(config.remote.length + 1);\n            config.setBranchAsTracking = $dialog.find(\"input[name='setBranchAsTracking']\").is(\":checked\");\n        }\n\n        config.strategy = $dialog.find(\"input[name='strategy']:checked\").val();\n        config.tags = $dialog.find(\"input[name='send_tags']:checked\").val();\n        config.noVerify = $dialog.find(\"input[name='push-no-verify']:checked\").val();\n\n        config.remoteUsername = $dialog.find(\"input[name='username']\").val();\n        config.remotePassword = $dialog.find(\"input[name='password']\").val();\n\n        // new url that has to be set for merging\n        let remoteUrlNew;\n        if (config.remoteUrl.match(/^https?:/)) {\n            const url = new URL(config.remoteUrl);\n            url.username = config.remoteUsername;\n            url.password = config.remotePassword;\n            remoteUrlNew = url.toString();\n        }\n\n        // assign remoteUrlNew only if it's different from the original url\n        if (remoteUrlNew && config.remoteUrl !== remoteUrlNew) {\n            config.remoteUrlNew = remoteUrlNew;\n        }\n\n        // old url that has to be put back after merging\n        const saveToUrl = $dialog.find(\"input[name='saveToUrl']\").is(\":checked\");\n        // assign restore branch only if remoteUrlNew has some value\n        if (config.remoteUrlNew && !saveToUrl) {\n            config.remoteUrlRestore = config.remoteUrl;\n        }\n    };\n\n});\n\n/*\n    This file acts as an entry point to GitCli.js and other possible\n    implementations of Git communication besides Cli. Application\n    should not access GitCli directly.\n*/\ndefine(\"src/git/Git\", function (require, exports) {\n\n    // Local modules\n    const Preferences = require(\"src/Preferences\"),\n        GitCli      = require(\"src/git/GitCli\"),\n        Utils       = require(\"src/Utils\");\n\n    // Implementation\n    function pushToNewUpstream(remoteName, remoteBranch, options = {}) {\n        const args = [\"--set-upstream\"];\n\n        if (options.noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        return GitCli.push(remoteName, remoteBranch, args, options.progressTracker);\n    }\n\n    function getRemoteUrl(remote) {\n        return GitCli.getConfig(\"remote.\" + remote + \".url\");\n    }\n\n    function setRemoteUrl(remote, url) {\n        return GitCli.setConfig(\"remote.\" + remote + \".url\", url);\n    }\n\n    function sortBranches(branches) {\n        return branches.sort(function (a, b) {\n            var ar = a.remote || \"\",\n                br = b.remote || \"\";\n            // origin remote first\n            if (br && ar === \"origin\" && br !== \"origin\") {\n                return -1;\n            } else if (ar && ar !== \"origin\" && br === \"origin\") {\n                return 1;\n            }\n            // sort by remotes\n            if (ar < br) {\n                return -1;\n            } else if (ar > br) {\n                return 1;\n            }\n            // sort by sortPrefix (# character)\n            if (a.sortPrefix < b.sortPrefix) {\n                return -1;\n            } else if (a.sortPrefix > b.sortPrefix) {\n                return 1;\n            }\n            // master branch first\n            if (a.sortName === \"master\" && b.sortName !== \"master\") {\n                return -1;\n            } else if (a.sortName !== \"master\" && b.sortName === \"master\") {\n                return 1;\n            }\n            // sort by sortName (lowercased branch name)\n            return a.sortName < b.sortName ? -1 : a.sortName > b.sortName ? 1 : 0;\n        });\n    }\n\n    function getBranches() {\n        return GitCli.getBranches().then(function (branches) {\n            return sortBranches(branches);\n        });\n    }\n\n    function getAllBranches() {\n        return GitCli.getAllBranches().then(function (branches) {\n            return sortBranches(branches);\n        });\n    }\n\n    function getHistory(branch, skip) {\n        return GitCli.getHistory(branch, skip);\n    }\n\n    function getFileHistory(file, branch, skip) {\n        return GitCli.getHistory(branch, skip, file);\n    }\n\n    function resetIndex() {\n        return GitCli.reset();\n    }\n\n    function discardAllChanges() {\n        return GitCli.reset(\"--hard\").then(function () {\n            return GitCli.clean();\n        });\n    }\n\n    function getMergeInfo() {\n        var baseCheck  = [\"MERGE_MODE\", \"rebase-apply\"],\n            mergeCheck = [\"MERGE_HEAD\", \"MERGE_MSG\"],\n            rebaseCheck = [\"rebase-apply/next\", \"rebase-apply/last\", \"rebase-apply/head-name\"],\n            gitFolder  = Preferences.get(\"currentGitRoot\") + \".git/\";\n\n        return Promise.all(baseCheck.map(function (fileName) {\n            return Utils.loadPathContent(gitFolder + fileName);\n        })).then(function ([mergeMode, rebaseMode]) {\n            var obj = {\n                mergeMode: mergeMode !== null,\n                rebaseMode: rebaseMode !== null\n            };\n            if (obj.mergeMode) {\n\n                return Promise.all(mergeCheck.map(function (fileName) {\n                    return Utils.loadPathContent(gitFolder + fileName);\n                })).then(function ([head, msg]) {\n\n                    if (head) {\n                        obj.mergeHead = head.trim();\n                    }\n                    var msgSplit = msg ? msg.trim().split(/conflicts:/i) : [];\n                    if (msgSplit[0]) {\n                        obj.mergeMessage = msgSplit[0].trim();\n                    }\n                    if (msgSplit[1]) {\n                        obj.mergeConflicts = msgSplit[1].trim().split(\"\\n\").map(function (line) { return line.trim(); });\n                    }\n                    return obj;\n\n                });\n\n            }\n            if (obj.rebaseMode) {\n\n                return Promise.all(rebaseCheck.map(function (fileName) {\n                    return Utils.loadPathContent(gitFolder + fileName);\n                })).then(function ([next, last, head]) {\n\n                    if (next) { obj.rebaseNext = next.trim(); }\n                    if (last) { obj.rebaseLast = last.trim(); }\n                    if (head) { obj.rebaseHead = head.trim().substring(\"refs/heads/\".length); }\n                    return obj;\n\n                });\n\n            }\n            return obj;\n        });\n    }\n\n    function discardFileChanges(file) {\n        return GitCli.unstage(file).then(function () {\n            return GitCli.checkout(file);\n        });\n    }\n\n    function pushForced(remote, branch, options = {}) {\n        const args = [\"--force\"];\n\n        if (options.noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        return GitCli.push(remote, branch, args, options.progressTracker);\n    }\n\n    function deleteRemoteBranch(remote, branch, options = {}) {\n        const args = [\"--delete\"];\n\n        if (options.noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        return GitCli.push(remote, branch, args, options.progressTracker);\n    }\n\n    function undoLastLocalCommit() {\n        return GitCli.reset(\"--soft\", \"HEAD~1\");\n    }\n\n    // Public API\n    exports.pushToNewUpstream       = pushToNewUpstream;\n    exports.getBranches             = getBranches;\n    exports.getAllBranches          = getAllBranches;\n    exports.getHistory              = getHistory;\n    exports.getFileHistory          = getFileHistory;\n    exports.resetIndex              = resetIndex;\n    exports.discardAllChanges       = discardAllChanges;\n    exports.getMergeInfo            = getMergeInfo;\n    exports.discardFileChanges      = discardFileChanges;\n    exports.getRemoteUrl            = getRemoteUrl;\n    exports.setRemoteUrl            = setRemoteUrl;\n    exports.pushForced              = pushForced;\n    exports.deleteRemoteBranch      = deleteRemoteBranch;\n    exports.undoLastLocalCommit     = undoLastLocalCommit;\n\n    Object.keys(GitCli).forEach(function (method) {\n        if (!exports[method]) {\n            exports[method] = GitCli[method];\n        }\n    });\n});\n\n/*globals jsPromise, fs*/\n\n/*\n    This module is used to communicate with Git through Cli\n    Output string from Git should always be parsed here\n    to provide more sensible outputs than just plain strings.\n    Format of the output should be specified in Git.js\n*/\ndefine(\"src/git/GitCli\", function (require, exports) {\n\n    // Brackets modules\n    const _           = brackets.getModule(\"thirdparty/lodash\"),\n        FileSystem  = brackets.getModule(\"filesystem/FileSystem\"),\n        Strings     = brackets.getModule(\"strings\"),\n        FileUtils   = brackets.getModule(\"file/FileUtils\");\n\n    // Local modules\n    const Cli           = require(\"src/Cli\"),\n        ErrorHandler  = require(\"src/ErrorHandler\"),\n        Events        = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        ExpectedError = require(\"src/ExpectedError\"),\n        Preferences   = require(\"src/Preferences\"),\n        Utils         = require(\"src/Utils\");\n\n    // Module variables\n    let _gitPath = null,\n        _gitQueue = [],\n        _gitQueueBusy = false,\n        lastGitStatusResults;\n\n    var FILE_STATUS = {\n        STAGED: \"STAGED\",\n        UNMODIFIED: \"UNMODIFIED\",\n        IGNORED: \"IGNORED\",\n        UNTRACKED: \"UNTRACKED\",\n        MODIFIED: \"MODIFIED\",\n        ADDED: \"ADDED\",\n        DELETED: \"DELETED\",\n        RENAMED: \"RENAMED\",\n        COPIED: \"COPIED\",\n        UNMERGED: \"UNMERGED\"\n    };\n\n    // This SHA1 represents the empty tree. You get it using `git mktree < /dev/null`\n    var EMPTY_TREE = \"4b825dc642cb6eb9a060e54bf8d69288fbee4904\";\n\n    // Implementation\n    function getGitPath() {\n        if (_gitPath) { return _gitPath; }\n        _gitPath = Preferences.get(\"gitPath\");\n        return _gitPath;\n    }\n\n    Preferences.getExtensionPref().on(\"change\", \"gitPath\", ()=>{\n        _gitPath = Preferences.get(\"gitPath\");\n    });\n\n    function setGitPath(path) {\n        if (path === true) { path = \"git\"; }\n        Preferences.set(\"gitPath\", path);\n        _gitPath = path;\n    }\n\n    function strEndsWith(subjectString, searchString, position) {\n        if (position === undefined || position > subjectString.length) {\n            position = subjectString.length;\n        }\n        position -= searchString.length;\n        var lastIndex = subjectString.indexOf(searchString, position);\n        return lastIndex !== -1 && lastIndex === position;\n    }\n\n    /*\n    function fixCygwinPath(path) {\n        if (typeof path === \"string\" && brackets.platform === \"win\" && path.indexOf(\"/cygdrive/\") === 0) {\n            path = path.substring(\"/cygdrive/\".length)\n                       .replace(/^([a-z]+)\\//, function (a, b) {\n                           return b.toUpperCase() + \":/\";\n                       });\n        }\n        return path;\n    }\n    */\n\n    function _processQueue() {\n        // do nothing if the queue is busy\n        if (_gitQueueBusy) {\n            return;\n        }\n        // do nothing if the queue is empty\n        if (_gitQueue.length === 0) {\n            _gitQueueBusy = false;\n            return;\n        }\n        // get item from queue\n        const item  = _gitQueue.shift(),\n            resolve = item[0],\n            reject = item[1],\n            args  = item[2],\n            opts  = item[3];\n        // execute git command in a queue so no two commands are running at the same time\n        if (opts.nonblocking !== true) { _gitQueueBusy = true; }\n        Cli.spawnCommand(getGitPath(), args, opts)\n            .then(function (r) {\n                resolve(r);\n            })\n            .catch(function (e) {\n                const call = \"call: git \" + args.join(\" \");\n                e.stack = [call, e.stack].join(\"\\n\");\n                reject(e);\n            })\n            .finally(function () {\n                if (opts.nonblocking !== true) { _gitQueueBusy = false; }\n                _processQueue();\n            });\n    }\n\n    function git(args, opts) {\n        return new Promise((resolve, reject) => {\n            _gitQueue.push([resolve, reject, args || [], opts || {}]);\n            setTimeout(_processQueue);\n        });\n    }\n\n    /*\n        git branch\n        -d --delete Delete a branch.\n        -D Delete a branch irrespective of its merged status.\n        --no-color Turn off branch colors\n        -r --remotes List or delete (if used with -d) the remote-tracking branches.\n        -a --all List both remote-tracking branches and local branches.\n        --track When creating a new branch, set up branch.<name>.remote and branch.<name>.merge\n        --set-upstream If specified branch does not exist yet or if --force has been given, acts exactly like --track\n    */\n\n    function setUpstreamBranch(remoteName, remoteBranch, progressTracker) {\n        if (!remoteName) { throw new TypeError(\"remoteName argument is missing!\"); }\n        if (!remoteBranch) { throw new TypeError(\"remoteBranch argument is missing!\"); }\n        return git([\"branch\", \"--no-color\", \"-u\", remoteName + \"/\" + remoteBranch],\n            {progressTracker});\n    }\n\n    function branchDelete(branchName, progressTracker) {\n        return git([\"branch\", \"--no-color\", \"-d\", branchName], {progressTracker});\n    }\n\n    function forceBranchDelete(branchName, progressTracker) {\n        return git([\"branch\", \"--no-color\", \"-D\", branchName], {progressTracker});\n    }\n\n    function getBranches(moreArgs, progressTracker) {\n        var args = [\"branch\", \"--no-color\"];\n        if (moreArgs) { args = args.concat(moreArgs); }\n\n        return git(args, {progressTracker}).then(function (stdout) {\n            if (!stdout) { return []; }\n            return stdout.split(\"\\n\").reduce(function (arr, l) {\n                var name = l.trim(),\n                    currentBranch = false,\n                    remote = null,\n                    sortPrefix = \"\";\n\n                if (name.indexOf(\"->\") !== -1) {\n                    return arr;\n                }\n\n                if (name.indexOf(\"* \") === 0) {\n                    name = name.substring(2);\n                    currentBranch = true;\n                }\n\n                if (name.indexOf(\"remotes/\") === 0) {\n                    name = name.substring(\"remotes/\".length);\n                    remote = name.substring(0, name.indexOf(\"/\"));\n                }\n\n                var sortName = name.toLowerCase();\n                if (remote) {\n                    sortName = sortName.substring(remote.length + 1);\n                }\n                if (sortName.indexOf(\"#\") !== -1) {\n                    sortPrefix = sortName.slice(0, sortName.indexOf(\"#\"));\n                }\n\n                arr.push({\n                    name: name,\n                    sortPrefix: sortPrefix,\n                    sortName: sortName,\n                    currentBranch: currentBranch,\n                    remote: remote\n                });\n                return arr;\n            }, []);\n        });\n    }\n\n    function getAllBranches(progressTracker) {\n        return getBranches([\"-a\"], progressTracker);\n    }\n\n    /*\n        git fetch\n        --all Fetch all remotes.\n        --dry-run Show what would be done, without making any changes.\n        --multiple Allow several <repository> and <group> arguments to be specified. No <refspec>s may be specified.\n        --prune After fetching, remove any remote-tracking references that no longer exist on the remote.\n        --progress This flag forces progress status even if the standard error stream is not directed to a terminal.\n    */\n\n    function repositoryNotFoundHandler(err) {\n        var m = ErrorHandler.matches(err, /Repository (.*) not found$/gim);\n        if (m) {\n            throw new ExpectedError(m[0]);\n        }\n        throw err;\n    }\n\n    function fetchRemote(remote, progressTracker) {\n        return git([\"fetch\", \"--progress\", remote], {\n            progressTracker,\n            timeout: false // never timeout this\n        }).catch(repositoryNotFoundHandler);\n    }\n\n    function fetchAllRemotes(progressTracker) {\n        return git([\"fetch\", \"--progress\", \"--all\"], {\n            progressTracker,\n            timeout: false // never timeout this\n        }).catch(repositoryNotFoundHandler);\n    }\n\n    /*\n        git remote\n        add Adds a remote named <name> for the repository at <url>.\n        rename Rename the remote named <old> to <new>.\n        remove Remove the remote named <name>.\n        show Gives some information about the remote <name>.\n        prune Deletes all stale remote-tracking branches under <name>.\n\n    */\n\n    function getRemotes() {\n        return git([\"remote\", \"-v\"])\n            .then(function (stdout) {\n                return !stdout ? [] : _.uniq(stdout.replace(/\\((push|fetch)\\)/g, \"\").split(\"\\n\")).map(function (l) {\n                    var s = l.trim().split(\"\\t\");\n                    return {\n                        name: s[0],\n                        url: s[1]\n                    };\n                });\n            });\n    }\n\n    function createRemote(name, url) {\n        return git([\"remote\", \"add\", name, url])\n            .then(function () {\n                // stdout is empty so just return success\n                return true;\n            });\n    }\n\n    function deleteRemote(name) {\n        return git([\"remote\", \"rm\", name])\n            .then(function () {\n                // stdout is empty so just return success\n                return true;\n            });\n    }\n\n    /*\n        git pull\n        --no-commit Do not commit result after merge\n        --ff-only Refuse to merge and exit with a non-zero status\n                  unless the current HEAD is already up-to-date\n                  or the merge can be resolved as a fast-forward.\n    */\n\n    /**\n     *\n     * @param remote\n     * @param branch\n     * @param {boolean} [ffOnly]\n     * @param {boolean} [noCommit]\n     * @param {object} [options]\n     * @param [options.progressTracker]\n     * @returns {Promise<unknown>}\n     */\n    function mergeRemote(remote, branch, ffOnly, noCommit, options = {}) {\n        var args = [\"merge\"];\n\n        if (ffOnly) { args.push(\"--ff-only\"); }\n        if (noCommit) { args.push(\"--no-commit\", \"--no-ff\"); }\n\n        args.push(remote + \"/\" + branch);\n\n        var readMergeMessage = function () {\n            return Utils.loadPathContent(Preferences.get(\"currentGitRoot\") + \"/.git/MERGE_MSG\").then(function (msg) {\n                return msg;\n            });\n        };\n\n        return git(args, {progressTracker: options.progressTracker})\n            .then(function (stdout) {\n                // return stdout if available - usually not\n                if (stdout) { return stdout; }\n\n                return readMergeMessage().then(function (msg) {\n                    if (msg) { return msg; }\n                    return \"Remote branch \" + branch + \" from \" + remote + \" was merged to current branch\";\n                });\n            })\n            .catch(function (error) {\n                return readMergeMessage().then(function (msg) {\n                    if (msg) { return msg; }\n                    throw error;\n                });\n            });\n    }\n\n    function rebaseRemote(remote, branch, progressTracker) {\n        return git([\"rebase\", remote + \"/\" + branch], {progressTracker});\n    }\n\n    function resetRemote(remote, branch, progressTracker) {\n        return git([\"reset\", \"--soft\", remote + \"/\" + branch], {progressTracker}).then(function (stdout) {\n            return stdout || \"Current branch was resetted to branch \" + branch + \" from \" + remote;\n        });\n    }\n\n    function mergeBranch(branchName, mergeMessage, useNoff) {\n        var args = [\"merge\"];\n        if (useNoff) { args.push(\"--no-ff\"); }\n        if (mergeMessage && mergeMessage.trim()) { args.push(\"-m\", mergeMessage); }\n        args.push(branchName);\n        return git(args);\n    }\n\n    /*\n        git push\n        --porcelain Produce machine-readable output.\n        --delete All listed refs are deleted from the remote repository. This is the same as prefixing all refs with a colon.\n        --force Usually, the command refuses to update a remote ref that is not an ancestor of the local ref used to overwrite it.\n        --set-upstream For every branch that is up to date or successfully pushed, add upstream (tracking) reference\n        --progress This flag forces progress status even if the standard error stream is not directed to a terminal.\n    */\n\n    /*\n        returns parsed push response in this format:\n        {\n            flag: \"=\"\n            flagDescription: \"Ref was up to date and did not need pushing\"\n            from: \"refs/heads/rewrite-remotes\"\n            remoteUrl: \"http://github.com/zaggino/brackets-git.git\"\n            status: \"Done\"\n            summary: \"[up to date]\"\n            to: \"refs/heads/rewrite-remotes\"\n        }\n    */\n    function push(remoteName, remoteBranch, additionalArgs, progressTracker) {\n        if (!remoteName) { throw new TypeError(\"remoteName argument is missing!\"); }\n\n        var args = [\"push\", \"--porcelain\", \"--progress\"];\n        if (Array.isArray(additionalArgs)) {\n            args = args.concat(additionalArgs);\n        }\n        args.push(remoteName);\n\n        if (remoteBranch && Preferences.get(\"gerritPushref\")) {\n            return getConfig(\"gerrit.pushref\").then(function (strGerritEnabled) {\n                if (strGerritEnabled === \"true\") {\n                    args.push(\"HEAD:refs/for/\" + remoteBranch);\n                } else {\n                    args.push(remoteBranch);\n                }\n                return doPushWithArgs(args, progressTracker);\n            });\n        }\n\n        if (remoteBranch) {\n            args.push(remoteBranch);\n        }\n\n        return doPushWithArgs(args, progressTracker);\n    }\n\n    function doPushWithArgs(args, progressTracker) {\n        return git(args, {progressTracker})\n            .catch(repositoryNotFoundHandler)\n            .then(function (stdout) {\n                // this should clear lines from push hooks\n                var lines = stdout.split(\"\\n\");\n                while (lines.length > 0 && lines[0].match(/^To/) === null) {\n                    lines.shift();\n                }\n\n                var retObj = {},\n                    lineTwo = lines[1].split(\"\\t\");\n\n                retObj.remoteUrl = lines[0].trim().split(\" \")[1];\n                retObj.flag = lineTwo[0];\n                retObj.from = lineTwo[1].split(\":\")[0];\n                retObj.to = lineTwo[1].split(\":\")[1];\n                retObj.summary = lineTwo[2];\n                retObj.status = lines[2];\n\n                switch (retObj.flag) {\n                    case \" \":\n                        retObj.flagDescription = Strings.GIT_PUSH_SUCCESS_MSG;\n                        break;\n                    case \"+\":\n                        retObj.flagDescription = Strings.GIT_PUSH_FORCE_UPDATED_MSG;\n                        break;\n                    case \"-\":\n                        retObj.flagDescription = Strings.GIT_PUSH_DELETED_MSG;\n                        break;\n                    case \"*\":\n                        retObj.flagDescription = Strings.GIT_PUSH_NEW_REF_MSG;\n                        break;\n                    case \"!\":\n                        retObj.flagDescription = Strings.GIT_PUSH_REJECTED_MSG;\n                        break;\n                    case \"=\":\n                        retObj.flagDescription = Strings.GIT_PUSH_UP_TO_DATE_MSG;\n                        break;\n                    default:\n                        retObj.flagDescription = \"Unknown push flag received: \" + retObj.flag; // internal error not translated\n                }\n\n                return retObj;\n            });\n    }\n\n    function getCurrentBranchName() {\n        return git([\"branch\", \"--no-color\"]).then(function (stdout) {\n            var branchName = _.find(stdout.split(\"\\n\"), function (l) { return l[0] === \"*\"; });\n            if (branchName) {\n                branchName = branchName.substring(1).trim();\n\n                var m = branchName.match(/^\\(.*\\s(\\S+)\\)$/); // like (detached from f74acd4)\n                if (m) { return m[1]; }\n\n                return branchName;\n            }\n\n            // no branch situation so we need to create one by doing a commit\n            if (stdout.match(/^\\s*$/)) {\n                EventEmitter.emit(Events.GIT_NO_BRANCH_EXISTS);\n                // master is the default name of the branch after git init\n                return \"master\";\n            }\n\n            // alternative\n            return git([\"log\", \"--pretty=format:%H %d\", \"-1\"]).then(function (stdout) {\n                var m = stdout.trim().match(/^(\\S+)\\s+\\((.*)\\)$/);\n                var hash = m[1].substring(0, 20);\n                m[2].split(\",\").forEach(function (info) {\n                    info = info.trim();\n\n                    if (info === \"HEAD\") { return; }\n\n                    var m = info.match(/^tag:(.+)$/);\n                    if (m) {\n                        hash = m[1].trim();\n                        return;\n                    }\n\n                    hash = info;\n                });\n                return hash;\n            });\n        });\n    }\n\n    function getCurrentUpstreamBranch() {\n        return git([\"rev-parse\", \"--abbrev-ref\", \"--symbolic-full-name\", \"@{u}\"])\n            .catch(function () {\n                return null;\n            });\n    }\n\n    // Get list of deleted files between two branches\n    function getDeletedFiles(oldBranch, newBranch) {\n        return git([\"diff\", \"--no-ext-diff\", \"--name-status\", oldBranch + \"..\" + newBranch])\n            .then(function (stdout) {\n                var regex = /^D/;\n                return stdout.split(\"\\n\").reduce(function (arr, row) {\n                    if (regex.test(row)) {\n                        arr.push(row.substring(1).trim());\n                    }\n                    return arr;\n                }, []);\n            });\n    }\n\n    function getConfig(key) {\n        return git([\"config\", key.replace(/\\s/g, \"\")]);\n    }\n\n    function setConfig(key, value, allowGlobal) {\n        key = key.replace(/\\s/g, \"\");\n        return git([\"config\", key, value]).catch(function (err) {\n\n            if (allowGlobal && ErrorHandler.contains(err, \"No such file or directory\")) {\n                return git([\"config\", \"--global\", key, value]);\n            }\n\n            throw err;\n\n        });\n    }\n\n    function getHistory(branch, skipCommits, file) {\n        var separator = \"_._\",\n            newline   = \"_.nw._\",\n            format = [\n                \"%h\",  // abbreviated commit hash\n                \"%H\",  // commit hash\n                \"%an\", // author name\n                \"%aI\", // author date, ISO 8601 format\n                \"%ae\", // author email\n                \"%s\",  // subject\n                \"%b\",  // body\n                \"%d\"   // tags\n            ].join(separator) + newline;\n\n        var args = [\"log\", \"-100\", \"--date=iso\"];\n        if (skipCommits) { args.push(\"--skip=\" + skipCommits); }\n        args.push(\"--format=\" + format, branch, \"--\");\n\n        // follow is too buggy - do not use\n        // if (file) { args.push(\"--follow\"); }\n        if (file) { args.push(file); }\n\n        return git(args).then(function (stdout) {\n            stdout = stdout.substring(0, stdout.length - newline.length);\n            return !stdout ? [] : stdout.split(newline).map(function (line) {\n\n                var data = line.trim().split(separator),\n                    commit = {};\n\n                commit.hashShort  = data[0];\n                commit.hash       = data[1];\n                commit.author     = data[2];\n                commit.date       = data[3];\n                commit.email      = data[4];\n                commit.subject    = data[5];\n                commit.body       = data[6];\n\n                if (data[7]) {\n                    var tags = data[7];\n                    var regex = new RegExp(\"tag: ([^,|\\)]+)\", \"g\");\n                    tags = tags.match(regex);\n\n                    for (var key in tags) {\n                        if (tags[key] && tags[key].replace) {\n                            tags[key] = tags[key].replace(\"tag:\", \"\");\n                        }\n                    }\n                    commit.tags = tags;\n                }\n\n                return commit;\n\n            });\n        });\n    }\n\n    function init() {\n        return git([\"init\"]);\n    }\n\n    function clone(remoteGitUrl, destinationFolder, progressTracker) {\n        return git([\"clone\", remoteGitUrl, destinationFolder, \"--progress\"], {\n            progressTracker,\n            timeout: false // never timeout this\n        });\n    }\n\n    function stage(fileOrFiles, updateIndex) {\n        var args = [\"add\"];\n        if (updateIndex) { args.push(\"-u\"); }\n        return git(args.concat(\"--\", fileOrFiles));\n    }\n\n    function stageAll() {\n        return git([\"add\", \"--all\"]);\n    }\n\n    function commit(message, amend, noVerify, progressTracker) {\n        var lines = message.split(\"\\n\"),\n            args = [\"commit\"];\n\n        if (amend) {\n            args.push(\"--amend\", \"--reset-author\");\n        }\n\n        if (noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        if (lines.length === 1) {\n            args.push(\"-m\", message);\n            return git(args, {progressTracker});\n        } else {\n            return new Promise(function (resolve, reject) {\n                // FUTURE: maybe use git commit --file=-\n                var fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + \".phoenixGitTemp\");\n                jsPromise(FileUtils.writeText(fileEntry, message))\n                    .then(function () {\n                        args.push(\"-F\", \".phoenixGitTemp\");\n                        return git(args, {progressTracker});\n                    })\n                    .then(function (res) {\n                        fileEntry.unlink(function () {\n                            resolve(res);\n                        });\n                    })\n                    .catch(function (err) {\n                        fileEntry.unlink(function () {\n                            reject(err);\n                        });\n                    });\n            });\n        }\n    }\n\n    function reset(type, hash) {\n        var args = [\"reset\", type || \"--mixed\"]; // mixed is the default action\n        if (hash) { args.push(hash, \"--\"); }\n        return git(args);\n    }\n\n    function unstage(file) {\n        return git([\"reset\", \"--\", file]);\n    }\n\n    function checkout(hash) {\n        return git([\"checkout\", hash], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function createBranch(branchName, originBranch, trackOrigin) {\n        var args = [\"checkout\", \"-b\", branchName];\n\n        if (originBranch) {\n            if (trackOrigin) {\n                args.push(\"--track\");\n            }\n            args.push(originBranch);\n        }\n\n        return git(args);\n    }\n\n    function _isquoted(str) {\n        return str[0] === \"\\\"\" && str[str.length - 1] === \"\\\"\";\n    }\n\n    function _unquote(str) {\n        return str.substring(1, str.length - 1);\n    }\n\n    function _isescaped(str) {\n        return /\\\\[0-9]{3}/.test(str);\n    }\n\n    function status(type) {\n        return git([\"status\", \"-u\", \"--porcelain\"]).then(function (stdout) {\n            if (!stdout) { return []; }\n\n            var currentSubFolder = Preferences.get(\"currentGitSubfolder\");\n\n            // files that are modified both in index and working tree should be resetted\n            var isEscaped = false,\n                needReset = [],\n                results = [],\n                lines = stdout.split(\"\\n\");\n\n            lines.forEach(function (line) {\n                var statusStaged = line.substring(0, 1),\n                    statusUnstaged = line.substring(1, 2),\n                    status = [],\n                    file = line.substring(3);\n\n                // check if the file is quoted\n                if (_isquoted(file)) {\n                    file = _unquote(file);\n                    if (_isescaped(file)) {\n                        isEscaped = true;\n                    }\n                }\n\n                if (statusStaged !== \" \" && statusUnstaged !== \" \" &&\n                    statusStaged !== \"?\" && statusUnstaged !== \"?\") {\n                    needReset.push(file);\n                    return;\n                }\n\n                var statusChar;\n                if (statusStaged !== \" \" && statusStaged !== \"?\") {\n                    status.push(FILE_STATUS.STAGED);\n                    statusChar = statusStaged;\n                } else {\n                    statusChar = statusUnstaged;\n                }\n\n                switch (statusChar) {\n                    case \" \":\n                        status.push(FILE_STATUS.UNMODIFIED);\n                        break;\n                    case \"!\":\n                        status.push(FILE_STATUS.IGNORED);\n                        break;\n                    case \"?\":\n                        status.push(FILE_STATUS.UNTRACKED);\n                        break;\n                    case \"M\":\n                        status.push(FILE_STATUS.MODIFIED);\n                        break;\n                    case \"A\":\n                        status.push(FILE_STATUS.ADDED);\n                        break;\n                    case \"D\":\n                        status.push(FILE_STATUS.DELETED);\n                        break;\n                    case \"R\":\n                        status.push(FILE_STATUS.RENAMED);\n                        break;\n                    case \"C\":\n                        status.push(FILE_STATUS.COPIED);\n                        break;\n                    case \"U\":\n                        status.push(FILE_STATUS.UNMERGED);\n                        break;\n                    default:\n                        throw new Error(\"Unexpected status: \" + statusChar);\n                }\n\n                var display = file,\n                    io = file.indexOf(\"->\");\n                if (io !== -1) {\n                    file = file.substring(io + 2).trim();\n                }\n\n                // we don't want to display paths that lead to this file outside the project\n                if (currentSubFolder && display.indexOf(currentSubFolder) === 0) {\n                    display = display.substring(currentSubFolder.length);\n                }\n\n                results.push({\n                    status: status,\n                    display: display,\n                    file: file,\n                    name: file.substring(file.lastIndexOf(\"/\") + 1)\n                });\n            });\n\n            if (isEscaped) {\n                return setConfig(\"core.quotepath\", \"false\").then(function () {\n                    if (type === \"SET_QUOTEPATH\") {\n                        throw new Error(\"git status is calling itself in a recursive loop!\");\n                    }\n                    return status(\"SET_QUOTEPATH\");\n                });\n            }\n\n            if (needReset.length > 0) {\n                return Promise.all(needReset.map(function (fileName) {\n                    if (fileName.indexOf(\"->\") !== -1) {\n                        fileName = fileName.split(\"->\")[1].trim();\n                    }\n                    return unstage(fileName);\n                })).then(function () {\n                    if (type === \"RECURSIVE_CALL\") {\n                        throw new Error(\"git status is calling itself in a recursive loop!\");\n                    }\n                    return status(\"RECURSIVE_CALL\");\n                });\n            }\n\n            return results.sort(function (a, b) {\n                if (a.file < b.file) {\n                    return -1;\n                }\n                if (a.file > b.file) {\n                    return 1;\n                }\n                return 0;\n            });\n        }).then(function (results) {\n            lastGitStatusResults = results;\n            EventEmitter.emit(Events.GIT_STATUS_RESULTS, results);\n            return results;\n        });\n    }\n\n    function hasStatusChanged() {\n        const prevStatus = lastGitStatusResults;\n        return status().then(function (currentStatus) {\n            // the results are already sorted by file name\n            // Compare the current statuses with the previous ones\n            if (!prevStatus || prevStatus.length !== currentStatus.length) {\n                return true;\n            }\n            for (let i = 0; i < prevStatus.length; i++) {\n                if (prevStatus[i].file !== currentStatus[i].file ||\n                    prevStatus[i].status.join(\", \") !== currentStatus[i].status.join(\", \")) {\n                    return true;\n                }\n            }\n\n            return false;\n        }).catch(function (error) {\n            console.error(\"Error fetching Git status in hasStatusChanged:\", error);\n            return false;\n        });\n    }\n\n    function _isFileStaged(file) {\n        return git([\"status\", \"-u\", \"--porcelain\", \"--\", file]).then(function (stdout) {\n            if (!stdout) { return false; }\n            return _.any(stdout.split(\"\\n\"), function (line) {\n                return line[0] !== \" \" && line[0] !== \"?\" && // first character marks staged status\n                    line.lastIndexOf(\" \" + file) === line.length - file.length - 1; // in case another file appeared here?\n            });\n        });\n    }\n\n    function getDiffOfStagedFiles() {\n        return git([\"diff\", \"--no-ext-diff\", \"--no-color\", \"--staged\"], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function getDiffOfAllIndexFiles(files) {\n        var args = [\"diff\", \"--no-ext-diff\", \"--no-color\", \"--full-index\"];\n        if (files) {\n            args = args.concat(\"--\", files);\n        }\n        return git(args, {\n            timeout: false // never timeout this\n        });\n    }\n\n    function getListOfStagedFiles() {\n        return git([\"diff\", \"--no-ext-diff\", \"--no-color\", \"--staged\", \"--name-only\"], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function diffFile(file) {\n        return _isFileStaged(file).then(function (staged) {\n            var args = [\"diff\", \"--no-ext-diff\", \"--no-color\"];\n            if (staged) { args.push(\"--staged\"); }\n            args.push(\"-U0\", \"--\", file);\n            return git(args, {\n                timeout: false // never timeout this\n            });\n        });\n    }\n\n    function diffFileNice(file) {\n        return _isFileStaged(file).then(function (staged) {\n            var args = [\"diff\", \"--no-ext-diff\", \"--no-color\"];\n            if (staged) { args.push(\"--staged\"); }\n            args.push(\"--\", file);\n            return git(args, {\n                timeout: false // never timeout this\n            });\n        });\n    }\n\n    function difftool(file) {\n        return _isFileStaged(file).then(function (staged) {\n            var args = [\"difftool\"];\n            if (staged) {\n                args.push(\"--staged\");\n            }\n            args.push(\"--\", file);\n            return git(args, {\n                timeout: false, // never timeout this\n                nonblocking: true // allow running other commands before this command finishes its work\n            });\n        });\n    }\n\n    function clean() {\n        return git([\"clean\", \"-f\", \"-d\"]);\n    }\n\n    function getFilesFromCommit(hash, isInitial) {\n        var args = [\"diff\", \"--no-ext-diff\", \"--name-only\"];\n        args = args.concat((isInitial ? EMPTY_TREE : hash + \"^\") + \"..\" + hash);\n        args = args.concat(\"--\");\n        return git(args).then(function (stdout) {\n            return !stdout ? [] : stdout.split(\"\\n\");\n        });\n    }\n\n    function getDiffOfFileFromCommit(hash, file, isInitial) {\n        var args = [\"diff\", \"--no-ext-diff\", \"--no-color\"];\n        args = args.concat((isInitial ? EMPTY_TREE : hash + \"^\") + \"..\" + hash);\n        args = args.concat(\"--\", file);\n        return git(args);\n    }\n\n    function difftoolFromHash(hash, file, isInitial) {\n        return git([\"difftool\", (isInitial ? EMPTY_TREE : hash + \"^\") + \"..\" + hash, \"--\", file], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function rebaseInit(branchName) {\n        return git([\"rebase\", \"--ignore-date\", branchName]);\n    }\n\n    function rebase(whatToDo) {\n        return git([\"rebase\", \"--\" + whatToDo]);\n    }\n\n    function getVersion() {\n        return git([\"--version\"]).then(function (stdout) {\n            var m = stdout.match(/[0-9].*/);\n            return m ? m[0] : stdout.trim();\n        });\n    }\n\n    function getCommitCountsFallback() {\n        return git([\"rev-list\", \"HEAD\", \"--not\", \"--remotes\"])\n            .then(function (stdout) {\n                var ahead = stdout ? stdout.split(\"\\n\").length : 0;\n                return \"-1 \" + ahead;\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n                return \"-1 -1\";\n            });\n    }\n\n    function getCommitCounts() {\n        var remotes = Preferences.get(\"defaultRemotes\") || {};\n        var remote = remotes[Preferences.get(\"currentGitRoot\")];\n        return getCurrentBranchName()\n            .then(function (branch) {\n                if (!branch || !remote) {\n                    return getCommitCountsFallback();\n                }\n                return git([\"rev-list\", \"--left-right\", \"--count\", remote + \"/\" + branch + \"...@{0}\", \"--\"])\n                    .catch(function (err) {\n                        ErrorHandler.logError(err);\n                        return getCommitCountsFallback();\n                    })\n                    .then(function (stdout) {\n                        var matches = /(-?\\d+)\\s+(-?\\d+)/.exec(stdout);\n                        return matches ? {\n                            behind: parseInt(matches[1], 10),\n                            ahead: parseInt(matches[2], 10)\n                        } : {\n                            behind: -1,\n                            ahead: -1\n                        };\n                    });\n            });\n    }\n\n    function getLastCommitMessage() {\n        return git([\"log\", \"-1\", \"--pretty=%B\"]).then(function (stdout) {\n            return stdout.trim();\n        });\n    }\n\n    function getBlame(file, from, to) {\n        var args = [\"blame\", \"-w\", \"--line-porcelain\"];\n        if (from || to) { args.push(\"-L\" + from + \",\" + to); }\n        args.push(file);\n\n        return git(args).then(function (stdout) {\n            if (!stdout) { return []; }\n\n            var sep  = \"-@-BREAK-HERE-@-\",\n                sep2 = \"$$#-#$BREAK$$-$#\";\n            stdout = stdout.replace(sep, sep2)\n                .replace(/^\\t(.*)$/gm, function (a, b) { return b + sep; });\n\n            return stdout.split(sep).reduce(function (arr, lineInfo) {\n                lineInfo = lineInfo.replace(sep2, sep).trimLeft();\n                if (!lineInfo) { return arr; }\n\n                var obj = {},\n                    lines = lineInfo.split(\"\\n\"),\n                    firstLine = _.first(lines).split(\" \");\n\n                obj.hash = firstLine[0];\n                obj.num = firstLine[2];\n                obj.content = _.last(lines);\n\n                // process all but first and last lines\n                for (var i = 1, l = lines.length - 1; i < l; i++) {\n                    var line = lines[i],\n                        io = line.indexOf(\" \"),\n                        key = line.substring(0, io),\n                        val = line.substring(io + 1);\n                    obj[key] = val;\n                }\n\n                arr.push(obj);\n                return arr;\n            }, []);\n        }).catch(function (stderr) {\n            var m = stderr.match(/no such path (\\S+)/);\n            if (m) {\n                throw new Error(\"File is not tracked by Git: \" + m[1]);\n            }\n            throw stderr;\n        });\n    }\n\n    function getGitRoot() {\n        var projectRoot = Utils.getProjectRoot();\n        return git([\"rev-parse\", \"--show-toplevel\"], {\n            cwd: fs.getTauriPlatformPath(projectRoot)\n        })\n            .catch(function (e) {\n                if (ErrorHandler.contains(e, \"Not a git repository\")) {\n                    return null;\n                }\n                throw e;\n            })\n            .then(function (root) {\n                if (root === null) {\n                    return root;\n                }\n\n                // paths on cygwin look a bit different\n                // root = fixCygwinPath(root);\n\n                // we know projectRoot is in a Git repo now\n                // because --show-toplevel didn't return Not a git repository\n                // we need to find closest .git\n\n                function checkPathRecursive(path) {\n\n                    if (strEndsWith(path, \"/\")) {\n                        path = path.slice(0, -1);\n                    }\n\n                    Utils.consoleDebug(\"Checking path for .git: \" + path);\n\n                    return new Promise(function (resolve) {\n\n                        // keep .git away from file tree for now\n                        // this branch of code will not run for intel xdk\n                        if (typeof brackets !== \"undefined\" && brackets.fs && brackets.fs.stat) {\n                            brackets.fs.stat(path + \"/.git\", function (err, result) {\n                                var exists = err ? false : (result.isFile() || result.isDirectory());\n                                if (exists) {\n                                    Utils.consoleDebug(\"Found .git in path: \" + path);\n                                    resolve(path);\n                                } else {\n                                    Utils.consoleDebug(\"Failed to find .git in path: \" + path);\n                                    path = path.split(\"/\");\n                                    path.pop();\n                                    path = path.join(\"/\");\n                                    resolve(checkPathRecursive(path));\n                                }\n                            });\n                            return;\n                        }\n\n                        FileSystem.resolve(path + \"/.git\", function (err, item, stat) {\n                            var exists = err ? false : (stat.isFile || stat.isDirectory);\n                            if (exists) {\n                                Utils.consoleDebug(\"Found .git in path: \" + path);\n                                resolve(path);\n                            } else {\n                                Utils.consoleDebug(\"Failed to find .git in path: \" + path);\n                                path = path.split(\"/\");\n                                path.pop();\n                                path = path.join(\"/\");\n                                resolve(checkPathRecursive(path));\n                            }\n                        });\n\n                    });\n\n                }\n\n                return checkPathRecursive(projectRoot).then(function (path) {\n                    return path + \"/\";\n                });\n\n            });\n    }\n\n    function setTagName(tagname, commitHash) {\n        const args = [\"tag\", tagname];\n        if (commitHash) {\n            args.push(commitHash); // Add the commit hash to the arguments if provided\n        }\n        return git(args).then(function (stdout) {\n            return stdout.trim();\n        });\n    }\n\n    // Public API\n    exports._git                      = git;\n    exports.setGitPath                = setGitPath;\n    exports.FILE_STATUS               = FILE_STATUS;\n    exports.fetchRemote               = fetchRemote;\n    exports.fetchAllRemotes           = fetchAllRemotes;\n    exports.getRemotes                = getRemotes;\n    exports.createRemote              = createRemote;\n    exports.deleteRemote              = deleteRemote;\n    exports.push                      = push;\n    exports.setUpstreamBranch         = setUpstreamBranch;\n    exports.getCurrentBranchName      = getCurrentBranchName;\n    exports.getCurrentUpstreamBranch  = getCurrentUpstreamBranch;\n    exports.getConfig                 = getConfig;\n    exports.setConfig                 = setConfig;\n    exports.getBranches               = getBranches;\n    exports.getAllBranches            = getAllBranches;\n    exports.branchDelete              = branchDelete;\n    exports.forceBranchDelete         = forceBranchDelete;\n    exports.getDeletedFiles           = getDeletedFiles;\n    exports.getHistory                = getHistory;\n    exports.init                      = init;\n    exports.clone                     = clone;\n    exports.stage                     = stage;\n    exports.unstage                   = unstage;\n    exports.stageAll                  = stageAll;\n    exports.commit                    = commit;\n    exports.reset                     = reset;\n    exports.checkout                  = checkout;\n    exports.createBranch              = createBranch;\n    exports.status                    = status;\n    exports.hasStatusChanged          = hasStatusChanged;\n    exports.diffFile                  = diffFile;\n    exports.diffFileNice              = diffFileNice;\n    exports.difftool                  = difftool;\n    exports.clean                     = clean;\n    exports.getFilesFromCommit        = getFilesFromCommit;\n    exports.getDiffOfFileFromCommit   = getDiffOfFileFromCommit;\n    exports.difftoolFromHash          = difftoolFromHash;\n    exports.rebase                    = rebase;\n    exports.rebaseInit                = rebaseInit;\n    exports.mergeRemote               = mergeRemote;\n    exports.rebaseRemote              = rebaseRemote;\n    exports.resetRemote               = resetRemote;\n    exports.getVersion                = getVersion;\n    exports.getCommitCounts           = getCommitCounts;\n    exports.getLastCommitMessage      = getLastCommitMessage;\n    exports.mergeBranch               = mergeBranch;\n    exports.getDiffOfAllIndexFiles    = getDiffOfAllIndexFiles;\n    exports.getDiffOfStagedFiles      = getDiffOfStagedFiles;\n    exports.getListOfStagedFiles      = getListOfStagedFiles;\n    exports.getBlame                  = getBlame;\n    exports.getGitRoot                = getGitRoot;\n    exports.setTagName                = setTagName;\n});\n\ndefine(\"src/utils/Setup\", function (require, exports) {\n\n    // Brackets modules\n    const _ = brackets.getModule(\"thirdparty/lodash\"),\n        Metrics = brackets.getModule(\"utils/Metrics\");\n\n    // Local modules\n    const Cli         = require(\"src/Cli\"),\n        Git         = require(\"src/git/Git\"),\n        Preferences = require(\"src/Preferences\");\n\n    // Module variables\n    let standardGitPathsWin = [\n        \"C:\\\\Program Files (x86)\\\\Git\\\\cmd\\\\git.exe\",\n        \"C:\\\\Program Files\\\\Git\\\\cmd\\\\git.exe\"\n    ];\n\n    let standardGitPathsNonWin = [\n        \"/usr/local/git/bin/git\",\n        \"/usr/local/bin/git\",\n        \"/usr/bin/git\"\n    ];\n\n    let extensionActivated = false;\n\n    // Implementation\n    function getGitVersion() {\n        return new Promise(function (resolve, reject) {\n\n            // TODO: do this in two steps - first check user config and then check all\n            var pathsToLook = [Preferences.get(\"gitPath\"), \"git\"].concat(brackets.platform === \"win\" ? standardGitPathsWin : standardGitPathsNonWin);\n            pathsToLook = _.unique(_.compact(pathsToLook));\n\n            var results = [],\n                errors = [];\n            var finish = _.after(pathsToLook.length, function () {\n\n                var searchedPaths = \"\\n\\nSearched paths:\\n\" + pathsToLook.join(\"\\n\");\n\n                if (results.length === 0) {\n                    // no git found\n                    reject(\"No Git has been found on this computer\" + searchedPaths);\n                } else {\n                    // at least one git is found\n                    var gits = _.sortBy(results, \"version\").reverse(),\n                        latestGit = gits[0],\n                        m = latestGit.version.match(/([0-9]+)\\.([0-9]+)/),\n                        major = parseInt(m[1], 10),\n                        minor = parseInt(m[2], 10);\n\n                    if (major === 1 && minor < 8) {\n                        return reject(\"Brackets Git requires Git 1.8 or later - latest version found was \" + latestGit.version + searchedPaths);\n                    }\n\n                    // prefer the first defined so it doesn't change all the time and confuse people\n                    latestGit = _.sortBy(_.filter(gits, function (git) { return git.version === latestGit.version; }), \"index\")[0];\n\n                    // this will save the settings also\n                    Git.setGitPath(latestGit.path);\n                    resolve(latestGit.version);\n                }\n\n            });\n\n            pathsToLook.forEach(function (path, index) {\n                Cli.spawnCommand(path, [\"--version\"], {\n                    cwd: \"./\"\n                }).then(function (stdout) {\n                    var m = stdout.match(/^git version\\s+(.*)$/);\n                    if (m) {\n                        results.push({\n                            path: path,\n                            version: m[1],\n                            index: index\n                        });\n                    }\n                }).catch(function (err) {\n                    errors.push({\n                        path: path,\n                        err: err\n                    });\n                }).finally(function () {\n                    finish();\n                });\n            });\n\n        });\n    }\n\n    function isExtensionActivated() {\n        return extensionActivated && Preferences.get(\"enableGit\");\n    }\n\n    /**\n     * Initializes the Git extension by checking for the Git executable and returns true if active.\n     *\n     * @async\n     * @function init\n     * @returns {Promise<boolean>}\n     *   A promise that resolves to a boolean indicating whether the extension was activated (`true`)\n     *   or deactivated (`false`) due to a missing or inaccessible Git executable.\n     * });\n     */\n    function init() {\n        return new Promise((resolve) =>{\n            if(!Preferences.get(\"enableGit\")){\n                resolve(false);\n                console.log(\"Git is disabled in preferences.\");\n                return;\n            }\n            getGitVersion().then(function (_version) {\n                extensionActivated = true;\n                resolve(extensionActivated);\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'installed', \"yes\");\n            }).catch(function (err) {\n                extensionActivated = false;\n                console.warn(\"Failed to launch Git executable. Deactivating Git extension. Is git installed?\", err);\n                resolve(extensionActivated);\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'installed', \"no\");\n            });\n        });\n    }\n\n    // Public API\n    exports.init = init;\n    exports.isExtensionActivated = isExtensionActivated;\n    exports.getGitVersion = getGitVersion;\n\n});\n"],"file":"extension-min.js"}