{"version":3,"sources":["extensions/default/Git/src/CloseNotModified.js"],"names":["define","require","exports","DocumentManager","brackets","getModule","Commands","CommandManager","Strings","MainViewManager","Events","EventEmitter","Git","Preferences","Constants","Utils","closeUnmodifiedCmd","handleCloseNotModified","status","then","modifiedFiles","openFiles","getWorkingSet","ALL_PANES","currentGitRoot","get","forEach","openFile","removeOpenFile","modifiedFile","file","fullPath","doc","getOpenDocumentForPath","isDirty","execute","FILE_CLOSE_LIST","PaneId","fileList","focusActivePane","init","register","CMD_CLOSE_UNMODIFIED","CMD_GIT_CLOSE_UNMODIFIED","enableCommand","on","GIT_ENABLED","GIT_DISABLED"],"mappings":"AAGAA,OAAO,SAAUC,QAASC,SAEtB,MAAMC,gBAAkBC,SAASC,UAAU,4BACvCC,SAAkBF,SAASC,UAAU,oBACrCE,eAAkBH,SAASC,UAAU,0BACrCG,QAAkBJ,SAASC,UAAU,WACrCI,gBAAkBL,SAASC,UAAU,wBAEnCK,OAAcT,QAAQ,cACxBU,aAAgBV,QAAQ,oBACxBW,IAAgBX,QAAQ,eACxBY,YAAgBZ,QAAQ,mBACxBa,UAAgBb,QAAQ,iBACxBc,MAAgBd,QAAQ,aAE5B,IAAIe,mBAEJ,SAASC,yBACLL,IAAIM,SAASC,KAAK,SAAUC,eACxB,IAAIC,UAAiBZ,gBAAgBa,cAAcb,gBAAgBc,WAC/DC,eAAiBX,YAAYY,IAAI,kBAErCJ,UAAUK,QAAQ,SAAUC,UACxB,IAAIC,gBAAiB,EAOrB,GANAR,cAAcM,QAAQ,SAAUG,cACxBL,eAAiBK,aAAaC,OAASH,SAASI,WAChDH,gBAAiB,KAIrBA,eAAgB,CAEhB,MAAMI,IAAM7B,gBAAgB8B,uBAAuBN,SAASI,UAGvDC,KAAQA,IAAIE,SACb3B,eAAe4B,QAAQ7B,SAAS8B,gBAAiB,CAACC,OAAQ5B,gBAAgBc,UAAWe,SAAU,CAACX,eAK5GlB,gBAAgB8B,oBAIxB,SAASC,OACLxB,mBAA2BT,eAAekC,SAASjC,QAAQkC,qBACvD5B,UAAU6B,yBAA0B1B,wBACxCF,MAAM6B,cAAc9B,UAAU6B,0BAA0B,GAG5DhC,aAAakC,GAAGnC,OAAOoC,YAAa,WAChC/B,MAAM6B,cAAc9B,UAAU6B,0BAA0B,KAG5DhC,aAAakC,GAAGnC,OAAOqC,aAAc,WACjChC,MAAM6B,cAAc9B,UAAU6B,0BAA0B,KAI5DzC,QAAQsC,KAAOA","sourcesContent":["/*jslint plusplus: true, vars: true, nomen: true */\n/*global $, brackets, define */\n\ndefine(function (require, exports) {\n\n    const DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        Commands        = brackets.getModule(\"command/Commands\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        Strings         = brackets.getModule(\"strings\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\");\n\n    const Events      = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        Git           = require(\"src/git/Git\"),\n        Preferences   = require(\"src/Preferences\"),\n        Constants     = require(\"src/Constants\"),\n        Utils         = require(\"src/Utils\");\n\n    let closeUnmodifiedCmd;\n\n    function handleCloseNotModified() {\n        Git.status().then(function (modifiedFiles) {\n            var openFiles      = MainViewManager.getWorkingSet(MainViewManager.ALL_PANES),\n                currentGitRoot = Preferences.get(\"currentGitRoot\");\n\n            openFiles.forEach(function (openFile) {\n                var removeOpenFile = true;\n                modifiedFiles.forEach(function (modifiedFile) {\n                    if (currentGitRoot + modifiedFile.file === openFile.fullPath) {\n                        removeOpenFile = false;\n                    }\n                });\n\n                if (removeOpenFile) {\n                    // check if file doesn't have any unsaved changes\n                    const doc = DocumentManager.getOpenDocumentForPath(openFile.fullPath);\n                    // document will not  be present for images, or if the file is in working set but\n                    // no editor is attached yet(eg. session restore on app start)\n                    if (!doc || !doc.isDirty) {\n                        CommandManager.execute(Commands.FILE_CLOSE_LIST, {PaneId: MainViewManager.ALL_PANES, fileList: [openFile]});\n                    }\n                }\n            });\n\n            MainViewManager.focusActivePane();\n        });\n    }\n\n    function init() {\n        closeUnmodifiedCmd       = CommandManager.register(Strings.CMD_CLOSE_UNMODIFIED,\n            Constants.CMD_GIT_CLOSE_UNMODIFIED, handleCloseNotModified);\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, false);\n    }\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, true);\n    });\n\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, false);\n    });\n\n    // Public API\n    exports.init = init;\n});\n"],"file":"CloseNotModified.js"}