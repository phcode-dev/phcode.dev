define(function(require,exports,module){const Global=require("./global"),FileSystem=require("filesystem/FileSystem"),FileUtils=require("file/FileUtils"),FileSystemError=require("filesystem/FileSystemError"),Helper=require("./helper"),SNIPPETS_FILE_PATH=brackets.app.getApplicationSupportDirectory()+"/customSnippets.json";function loadSnippetsFromState(){return new Promise((resolve,reject)=>{const file=FileSystem.getFileForPath(SNIPPETS_FILE_PATH),readPromise=FileUtils.readAsText(file,!0);readPromise.done(function(text){try{const data=JSON.parse(text);data&&data.snippets&&Array.isArray(data.snippets)?Global.SnippetHintsList=data.snippets:Global.SnippetHintsList=[],Helper.rebuildOptimizedStructures(),resolve()}catch(error){logger.reportError(error,"Custom Snippets: Failed to parse snippets JSON file. File might be corrupted."),Global.SnippetHintsList=[],Helper.rebuildOptimizedStructures(),resolve()}}).fail(function(error){error===FileSystemError.NOT_FOUND?(Global.SnippetHintsList=[],Helper.rebuildOptimizedStructures(),resolve()):(logger.reportError(error,"Custom Snippets: unexpected file system error loading snippets"),Global.SnippetHintsList=[],Helper.rebuildOptimizedStructures(),resolve())})})}function saveSnippetsToState(){const dataToSave={snippets:Global.SnippetHintsList},file=FileSystem.getFileForPath(SNIPPETS_FILE_PATH),jsonText=JSON.stringify(dataToSave);return jsPromise(FileUtils.writeText(file,jsonText,!0))}exports.loadSnippetsFromState=loadSnippetsFromState,exports.saveSnippetsToState=saveSnippetsToState});