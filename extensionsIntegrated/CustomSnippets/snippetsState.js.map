{"version":3,"sources":["extensionsIntegrated/CustomSnippets/snippetsState.js"],"names":["define","require","exports","module","Global","FileSystem","FileUtils","FileSystemError","Helper","SNIPPETS_FILE_PATH","brackets","app","getApplicationSupportDirectory","loadSnippetsFromState","Promise","resolve","reject","file","getFileForPath","readPromise","readAsText","done","text","data","JSON","parse","snippets","Array","isArray","SnippetHintsList","rebuildOptimizedStructures","error","logger","reportError","fail","NOT_FOUND","saveSnippetsToState","dataToSave","jsonText","stringify","jsPromise","writeText"],"mappings":"AAqBAA,OAAO,SAAUC,QAASC,QAASC,QAC/B,MAAMC,OAASH,QAAQ,YACjBI,WAAaJ,QAAQ,yBACrBK,UAAYL,QAAQ,kBACpBM,gBAAkBN,QAAQ,8BAC1BO,OAASP,QAAQ,YAEjBQ,mBAAqBC,SAASC,IAAIC,iCAAmC,uBAM3E,SAASC,wBACL,OAAO,IAAIC,QAAQ,CAACC,QAASC,UACzB,MAAMC,KAAOZ,WAAWa,eAAeT,oBAGjCU,YAAcb,UAAUc,WAAWH,MAAM,GAE/CE,YACKE,KAAK,SAAUC,MACZ,IACI,MAAMC,KAAOC,KAAKC,MAAMH,MACpBC,MAAQA,KAAKG,UAAYC,MAAMC,QAAQL,KAAKG,UAC5CtB,OAAOyB,iBAAmBN,KAAKG,SAG/BtB,OAAOyB,iBAAmB,GAG9BrB,OAAOsB,6BACPf,UACF,MAAOgB,OACLC,OAAOC,YACHF,MACA,iFAEJ3B,OAAOyB,iBAAmB,GAC1BrB,OAAOsB,6BACPf,aAGPmB,KAAK,SAAUH,OACRA,QAAUxB,gBAAgB4B,WAE1B/B,OAAOyB,iBAAmB,GAC1BrB,OAAOsB,6BACPf,YAEAiB,OAAOC,YAAYF,MAAO,kEAC1B3B,OAAOyB,iBAAmB,GAC1BrB,OAAOsB,6BACPf,eAUpB,SAASqB,sBACL,MAAMC,WAAa,CACfX,SAAUtB,OAAOyB,kBAGfZ,KAAOZ,WAAWa,eAAeT,oBACjC6B,SAAWd,KAAKe,UAAUF,YAGhC,OAAOG,UAAUlC,UAAUmC,UAAUxB,KAAMqB,UAAU,IAGzDpC,QAAQW,sBAAwBA,sBAChCX,QAAQkC,oBAAsBA","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/* global jsPromise, logger */\ndefine(function (require, exports, module) {\n    const Global = require(\"./global\");\n    const FileSystem = require(\"filesystem/FileSystem\");\n    const FileUtils = require(\"file/FileUtils\");\n    const FileSystemError = require(\"filesystem/FileSystemError\");\n    const Helper = require(\"./helper\");\n\n    const SNIPPETS_FILE_PATH = brackets.app.getApplicationSupportDirectory() + \"/customSnippets.json\";\n\n    /**\n     * This function is responsible to load snippets from file storage\n     * @returns {Promise} a promise that resolves when snippets are loaded\n     */\n    function loadSnippetsFromState() {\n        return new Promise((resolve, reject) => {\n            const file = FileSystem.getFileForPath(SNIPPETS_FILE_PATH);\n\n            // true is for bypassCache, to get the latest content always\n            const readPromise = FileUtils.readAsText(file, true);\n\n            readPromise\n                .done(function (text) {\n                    try {\n                        const data = JSON.parse(text);\n                        if (data && data.snippets && Array.isArray(data.snippets)) {\n                            Global.SnippetHintsList = data.snippets;\n                        } else {\n                            // no snippets are present\n                            Global.SnippetHintsList = [];\n                        }\n                        // rebuild the optimized data structures after loading snippets\n                        Helper.rebuildOptimizedStructures();\n                        resolve();\n                    } catch (error) {\n                        logger.reportError(\n                            error,\n                            \"Custom Snippets: Failed to parse snippets JSON file. File might be corrupted.\"\n                        );\n                        Global.SnippetHintsList = []; // fallback\n                        Helper.rebuildOptimizedStructures();\n                        resolve();\n                    }\n                })\n                .fail(function (error) {\n                    if (error === FileSystemError.NOT_FOUND) {\n                        // file is not present, empty array\n                        Global.SnippetHintsList = [];\n                        Helper.rebuildOptimizedStructures();\n                        resolve();\n                    } else {\n                        logger.reportError(error, \"Custom Snippets: unexpected file system error loading snippets\");\n                        Global.SnippetHintsList = [];\n                        Helper.rebuildOptimizedStructures();\n                        resolve();\n                    }\n                });\n        });\n    }\n\n    /**\n     * this function is responsible to save snippets to file storage\n     * @returns {Promise} a promise that resolves when snippets are saved\n     */\n    function saveSnippetsToState() {\n        const dataToSave = {\n            snippets: Global.SnippetHintsList\n        };\n\n        const file = FileSystem.getFileForPath(SNIPPETS_FILE_PATH);\n        const jsonText = JSON.stringify(dataToSave);\n\n        // true is allowBlindWrite to overwrite without checking file contents\n        return jsPromise(FileUtils.writeText(file, jsonText, true));\n    }\n\n    exports.loadSnippetsFromState = loadSnippetsFromState;\n    exports.saveSnippetsToState = saveSnippetsToState;\n});\n"],"file":"snippetsState.js"}