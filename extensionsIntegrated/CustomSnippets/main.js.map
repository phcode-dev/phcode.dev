{"version":3,"sources":["extensionsIntegrated/CustomSnippets/main.js"],"names":["define","require","exports","module","AppInit","CommandManager","Menus","Commands","WorkspaceManager","Strings","Mustache","Metrics","Driver","SnippetsList","CodeHintIntegration","Helper","UIHelper","SnippetsState","SnippetCursorManager","Global","snippetsPanelTpl","$snippetsPanel","MY_COMMAND_ID","PANEL_ID","MENU_ITEM_NAME","CUSTOM_SNIPPETS_MENU_ITEM_NAME","PANEL_MIN_SIZE","customSnippetsPanel","_createPanel","createBottomPanel","show","_registerHandlers","$","val","initializeListViewToolbarTitle","showSnippetsList","_togglePanelVisibility","isVisible","hide","get","setChecked","_hidePanel","showCustomSnippetsPanel","_addToMenu","menu","getMenu","AppMenuBar","FILE_MENU","addMenuItem","BEFORE","FILE_EXTENSION_MANAGER","$closePanelBtn","$saveCustomSnippetBtn","$cancelCustomSnippetBtn","$abbrInput","$descInput","$templateInput","$fileExtnInput","$addSnippetBtn","$addNewSnippetBtn","$backToListMenuBtn","$filterInput","$editAbbrInput","$editDescInput","$editTemplateInput","$editFileExtnInput","$saveEditSnippetBtn","$cancelEditSnippetBtn","on","showAddSnippetMenu","showSnippetListMenu","handleSaveBtnClick","toggleSaveButtonDisability","e","validateAbbrInput","this","handleAbbrPaste","validateDescInput","handleDescPaste","handleTextareaTabKey","handleFileExtensionInput","handleFileExtensionKeypress","handleFileExtensionPaste","toggleEditSaveButtonDisability","handleEditSaveBtnClick","handleCancelEditBtnClick","event","key","appReady","register","renderedHtml","render","init","loadSnippetsFromState","then","snippetCount","SnippetHintsList","length","countRange","getRangeName","countEvent","EVENT_TYPE","EDITOR","catch","error","logger","reportError","registerHandlers"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/* eslint-disable no-invalid-this */\n/* global logger */\ndefine(function (require, exports, module) {\n    const AppInit = require(\"utils/AppInit\");\n    const CommandManager = require(\"command/CommandManager\");\n    const Menus = require(\"command/Menus\");\n    const Commands = require(\"command/Commands\");\n    const WorkspaceManager = require(\"view/WorkspaceManager\");\n    const Strings = require(\"strings\");\n    const Mustache = require(\"thirdparty/mustache/mustache\");\n    const Metrics = require(\"utils/Metrics\");\n\n    const Driver = require(\"./driver\");\n    const SnippetsList = require(\"./snippetsList\");\n    const CodeHintIntegration = require(\"./codeHintIntegration\");\n    const Helper = require(\"./helper\");\n    const UIHelper = require(\"./UIHelper\");\n    const SnippetsState = require(\"./snippetsState\");\n    const SnippetCursorManager = require(\"./snippetCursorManager\");\n    const Global = require(\"./global\");\n\n    const snippetsPanelTpl = require(\"text!./htmlContent/snippets-panel.html\");\n    // the html content of the panel will be stored in this variable\n    let $snippetsPanel;\n\n    const MY_COMMAND_ID = \"custom_snippets\";\n    const PANEL_ID = \"customSnippets.panel\";\n    const MENU_ITEM_NAME = Strings.CUSTOM_SNIPPETS_MENU_ITEM_NAME; // this name will appear as the menu item\n    const PANEL_MIN_SIZE = 340; // the minimum size more than which its height cannot be decreased\n\n    // this is to store the panel reference,\n    // as we only need to create this once. rest of the time we can just toggle the visibility of the panel\n    let customSnippetsPanel;\n\n    /**\n     * This function is called when the first time the custom snippets panel button is clicked\n     * this is responsible to create the custom snippets bottom panel and show that\n     * @private\n     */\n    function _createPanel() {\n        customSnippetsPanel = WorkspaceManager.createBottomPanel(PANEL_ID, $snippetsPanel, PANEL_MIN_SIZE);\n        customSnippetsPanel.show();\n\n        // also register the handlers\n        _registerHandlers();\n\n        $(\"#filter-snippets-input\").val(\"\");\n        UIHelper.initializeListViewToolbarTitle();\n        SnippetsList.showSnippetsList(); // to show the snippets list in the snippets panel\n    }\n\n    /**\n     * This function is responsible to toggle the visibility of the panel\n     * this is called every time (after the panel is created) to show/hide the panel\n     * @private\n     */\n    function _togglePanelVisibility() {\n        if (customSnippetsPanel.isVisible()) {\n            customSnippetsPanel.hide();\n            CommandManager.get(MY_COMMAND_ID).setChecked(false);\n        } else {\n            customSnippetsPanel.show();\n            CommandManager.get(MY_COMMAND_ID).setChecked(true);\n\n            $(\"#filter-snippets-input\").val(\"\");\n            UIHelper.initializeListViewToolbarTitle();\n            SnippetsList.showSnippetsList(); // we just remake the snippets list UI to make sure it is always on point\n        }\n    }\n\n    /**\n     * This function is responsible to hide the panel\n     * this is called when user clicks on the 'cross' icon inside the panel itself and that is the reason,\n     * why we don't need to check whether the panel is visible or not\n     * @private\n     */\n    function _hidePanel() {\n        customSnippetsPanel.hide();\n        CommandManager.get(MY_COMMAND_ID).setChecked(false);\n    }\n\n    /**\n     * This function is responsible to create the bottom panel, if not created\n     * if panel is already created, we just toggle its visibility\n     * this will be called when the custom snippets menu item is clicked from the menu bar\n     */\n    function showCustomSnippetsPanel() {\n        // make sure that the panel is not created,\n        // if it is then we can just toggle its visibility\n        if (!customSnippetsPanel) {\n            _createPanel();\n            CommandManager.get(MY_COMMAND_ID).setChecked(true);\n        } else {\n            _togglePanelVisibility();\n        }\n    }\n\n    /**\n     * This function is responsible to add the Custom Snippets menu item to the menu bar\n     * @private\n     */\n    function _addToMenu() {\n        const menu = Menus.getMenu(Menus.AppMenuBar.FILE_MENU);\n        menu.addMenuItem(MY_COMMAND_ID, \"\", Menus.BEFORE, Commands.FILE_EXTENSION_MANAGER);\n    }\n\n    /**\n     * This function is responsible to register all the required handlers\n     * @private\n     */\n    function _registerHandlers() {\n        const $closePanelBtn = $(\"#close-custom-snippets-panel-btn\");\n        const $saveCustomSnippetBtn = $(\"#save-custom-snippet-btn\");\n        const $cancelCustomSnippetBtn = $(\"#cancel-custom-snippet-btn\");\n        const $abbrInput = $(\"#abbr-box\");\n        const $descInput = $(\"#desc-box\");\n        const $templateInput = $(\"#template-text-box\");\n        const $fileExtnInput = $(\"#file-extn-box\");\n        const $addSnippetBtn = $(\"#add-snippet-btn\");\n        const $addNewSnippetBtn = $(\"#add-new-snippet-btn\");\n        const $backToListMenuBtn = $(\"#back-to-list-menu-btn\");\n        const $filterInput = $(\"#filter-snippets-input\");\n\n        const $editAbbrInput = $(\"#edit-abbr-box\");\n        const $editDescInput = $(\"#edit-desc-box\");\n        const $editTemplateInput = $(\"#edit-template-text-box\");\n        const $editFileExtnInput = $(\"#edit-file-extn-box\");\n        const $saveEditSnippetBtn = $(\"#save-edit-snippet-btn\");\n        const $cancelEditSnippetBtn = $(\"#cancel-edit-snippet-btn\");\n\n        $addSnippetBtn.on(\"click\", function () {\n            UIHelper.showAddSnippetMenu();\n        });\n\n        $addNewSnippetBtn.on(\"click\", function () {\n            UIHelper.showAddSnippetMenu();\n        });\n\n        $backToListMenuBtn.on(\"click\", function () {\n            UIHelper.showSnippetListMenu();\n            SnippetsList.showSnippetsList();\n        });\n\n        $closePanelBtn.on(\"click\", function () {\n            _hidePanel();\n        });\n\n        $saveCustomSnippetBtn.on(\"click\", function () {\n            Driver.handleSaveBtnClick();\n        });\n\n        $cancelCustomSnippetBtn.on(\"click\", function () {\n            UIHelper.showSnippetListMenu();\n            SnippetsList.showSnippetsList();\n        });\n\n        $abbrInput.on(\"input\", Helper.toggleSaveButtonDisability);\n        $templateInput.on(\"input\", Helper.toggleSaveButtonDisability);\n\n        $abbrInput.on(\"keydown\", function (e) {\n            Helper.validateAbbrInput(e, this);\n        });\n        $abbrInput.on(\"paste\", function (e) {\n            Helper.handleAbbrPaste(e, $(this));\n        });\n\n        $descInput.on(\"keydown\", function (e) {\n            Helper.validateDescInput(e, this);\n        });\n        $descInput.on(\"paste\", function (e) {\n            Helper.handleDescPaste(e, $(this));\n        });\n\n        $templateInput.on(\"keydown\", function (e) {\n            Helper.handleTextareaTabKey(e, this);\n        });\n\n        $fileExtnInput.on(\"input\", function () {\n            Helper.handleFileExtensionInput($(this));\n        });\n        $fileExtnInput.on(\"keypress\", function (e) {\n            Helper.handleFileExtensionKeypress(e, this);\n        });\n        $fileExtnInput.on(\"paste\", function (e) {\n            Helper.handleFileExtensionPaste(e, $(this));\n        });\n\n        $editAbbrInput.on(\"input\", Helper.toggleEditSaveButtonDisability);\n        $editDescInput.on(\"input\", Helper.toggleEditSaveButtonDisability);\n        $editTemplateInput.on(\"input\", Helper.toggleEditSaveButtonDisability);\n        $editFileExtnInput.on(\"input\", Helper.toggleEditSaveButtonDisability);\n\n        $editAbbrInput.on(\"keydown\", function (e) {\n            Helper.validateAbbrInput(e, this);\n        });\n        $editAbbrInput.on(\"paste\", function (e) {\n            Helper.handleAbbrPaste(e, $(this));\n        });\n\n        $editDescInput.on(\"keydown\", function (e) {\n            Helper.validateDescInput(e, this);\n        });\n        $editDescInput.on(\"paste\", function (e) {\n            Helper.handleDescPaste(e, $(this));\n        });\n\n        $editTemplateInput.on(\"keydown\", function (e) {\n            Helper.handleTextareaTabKey(e, this);\n        });\n\n        $editFileExtnInput.on(\"input\", function () {\n            Helper.handleFileExtensionInput($(this));\n        });\n        $editFileExtnInput.on(\"keypress\", function (e) {\n            Helper.handleFileExtensionKeypress(e, this);\n        });\n        $editFileExtnInput.on(\"paste\", function (e) {\n            Helper.handleFileExtensionPaste(e, $(this));\n        });\n\n        $saveEditSnippetBtn.on(\"click\", function () {\n            Driver.handleEditSaveBtnClick();\n        });\n\n        $cancelEditSnippetBtn.on(\"click\", function () {\n            Driver.handleCancelEditBtnClick();\n        });\n\n        // filter input event handler\n        $filterInput.on(\"keyup input\", function (event) {\n            // if user presses 'esc' we clear the input field\n            if (event && event.key === \"Escape\") {\n                $(this).val(\"\");\n                SnippetsList.showSnippetsList();\n                return;\n            }\n            SnippetsList.showSnippetsList();\n        });\n    }\n\n    AppInit.appReady(function () {\n        CommandManager.register(MENU_ITEM_NAME, MY_COMMAND_ID, showCustomSnippetsPanel);\n        // Render template with localized strings\n        const renderedHtml = Mustache.render(snippetsPanelTpl, {Strings: Strings});\n        $snippetsPanel = $(renderedHtml);\n        _addToMenu();\n        CodeHintIntegration.init();\n\n        // load snippets from file storage\n        SnippetsState.loadSnippetsFromState()\n            .then(function () {\n                // track boot-time snippet count (only if user has snippets)\n                const snippetCount = Global.SnippetHintsList.length;\n                if (snippetCount > 0) {\n                    const countRange = Metrics.getRangeName(snippetCount);\n                    Metrics.countEvent(Metrics.EVENT_TYPE.EDITOR, \"snipt\", `boot.${countRange}`);\n                }\n            })\n            .catch(function (error) {\n                logger.reportError(error, \"Custom Snippets: didn't load on app init\");\n            });\n\n        SnippetCursorManager.registerHandlers();\n    });\n});\n"],"file":"main.js"}