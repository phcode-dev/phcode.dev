{"version":3,"sources":["extensionsIntegrated/TabBar/more-options.js"],"names":["define","require","exports","module","DropdownButton","Strings","CommandManager","Commands","FileSystem","Global","items","CLOSE_TAB","CLOSE_TABS_TO_THE_LEFT","CLOSE_TABS_TO_THE_RIGHT","CLOSE_SAVED_TABS","CLOSE_ALL_TABS","CMD_FILE_RENAME","CMD_FILE_DELETE","CMD_SHOW_IN_TREE","REOPEN_CLOSED_FILE","handleCloseTab","filePath","paneId","fileObj","getFileForPath","execute","FILE_CLOSE","file","handleCloseAllTabs","workingSet","firstPaneWorkingSet","secondPaneWorkingSet","length","i","path","handleCloseSavedTabs","unmodifiedEntries","filter","entry","isDirty","handleCloseTabsToTheLeft","currentIndex","findIndex","filesToClose","slice","handleCloseTabsToTheRight","reopenClosedFile","FILE_REOPEN_CLOSED","handleFileRename","SHOW_SIDEBAR","FILE_RENAME","handleFileDelete","FILE_DELETE","handleShowInFileTree","NAVIGATE_SHOW_IN_FILE_TREE","showMoreOptionsContextMenu","x","y","dropdown","$","append","$button","css","position","left","top","zIndex","dropdownExtraClasses","showDropdown","on","e","item","_handleSelection","display"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*\n * This file manages the more options context menu.\n * The more options context menu is shown when a tab is right-clicked\n */\ndefine(function (require, exports, module) {\n    const DropdownButton = require(\"widgets/DropdownButton\");\n    const Strings = require(\"strings\");\n    const CommandManager = require(\"command/CommandManager\");\n    const Commands = require(\"command/Commands\");\n    const FileSystem = require(\"filesystem/FileSystem\");\n\n    const Global = require(\"./global\");\n\n    // List of items to show in the context menu\n    // Strings defined in `src/nls/root/strings.js`\n    const items = [\n        Strings.CLOSE_TAB,\n        Strings.CLOSE_TABS_TO_THE_LEFT,\n        Strings.CLOSE_TABS_TO_THE_RIGHT,\n        Strings.CLOSE_SAVED_TABS,\n        Strings.CLOSE_ALL_TABS,\n        \"---\",\n        Strings.CMD_FILE_RENAME,\n        Strings.CMD_FILE_DELETE,\n        Strings.CMD_SHOW_IN_TREE,\n        \"---\",\n        Strings.REOPEN_CLOSED_FILE\n    ];\n\n    /**\n     * \"CLOSE TAB\"\n     * this function handles the closing of the tab that was right-clicked\n     *\n     * @param {String} filePath - path of the file to close\n     * @param {String} paneId - the id of the pane in which the file is present\n     */\n    function handleCloseTab(filePath, paneId) {\n        if (filePath) {\n            // Get the file object using FileSystem\n            const fileObj = FileSystem.getFileForPath(filePath);\n\n            // Execute close command with file object and pane ID\n            CommandManager.execute(Commands.FILE_CLOSE, { file: fileObj, paneId: paneId });\n        }\n    }\n\n    /**\n     * \"CLOSE ALL TABS\"\n     * This will close all tabs in the specified pane\n     *\n     * @param {String} paneId - the id of the pane [\"first-pane\", \"second-pane\"]\n     */\n    function handleCloseAllTabs(paneId) {\n        if (!paneId) {\n            return;\n        }\n\n        let workingSet;\n        workingSet = paneId === \"first-pane\" ? Global.firstPaneWorkingSet : Global.secondPaneWorkingSet;\n        if (!workingSet || workingSet.length === 0) {\n            return;\n        }\n\n        // close each file in the pane, start from the rightmost [to avoid index shifts]\n        for (let i = workingSet.length - 1; i >= 0; i--) {\n            const fileObj = FileSystem.getFileForPath(workingSet[i].path);\n            CommandManager.execute(Commands.FILE_CLOSE, { file: fileObj, paneId: paneId });\n        }\n    }\n\n    /**\n     * \"CLOSE SAVED TABS\"\n     * This will close all tabs that are not dirty in the specified pane\n     *\n     * @param {String} paneId - the id of the pane [\"first-pane\", \"second-pane\"]\n     */\n    function handleCloseSavedTabs(paneId) {\n        if (!paneId) {\n            return;\n        }\n\n        let workingSet;\n        workingSet = paneId === \"first-pane\" ? Global.firstPaneWorkingSet : Global.secondPaneWorkingSet;\n        if (!workingSet || workingSet.length === 0) {\n            return;\n        }\n\n        // get all those entries that are not dirty\n        const unmodifiedEntries = workingSet.filter((entry) => !entry.isDirty);\n\n        // close each non-dirty file in the pane\n        for (let i = unmodifiedEntries.length - 1; i >= 0; i--) {\n            const fileObj = FileSystem.getFileForPath(unmodifiedEntries[i].path);\n            CommandManager.execute(Commands.FILE_CLOSE, { file: fileObj, paneId: paneId });\n        }\n    }\n\n    /**\n     * \"CLOSE TABS TO THE LEFT\"\n     * This function is responsible for closing all tabs to the left of the right-clicked tab\n     *\n     * @param {String} filePath - path of the file that was right-clicked\n     * @param {String} paneId - the id of the pane in which the file is present\n     */\n    function handleCloseTabsToTheLeft(filePath, paneId) {\n        if (!filePath) {\n            return;\n        }\n\n        let workingSet;\n        workingSet = paneId === \"first-pane\" ? Global.firstPaneWorkingSet : Global.secondPaneWorkingSet;\n        if (!workingSet) {\n            return;\n        }\n\n        // find the index of the current file in the working set\n        const currentIndex = workingSet.findIndex((entry) => entry.path === filePath);\n\n        if (currentIndex > 0) {\n            // we only proceed if there are tabs to the left\n            // get all files to the left of the current file\n            const filesToClose = workingSet.slice(0, currentIndex);\n\n            // Close each file, starting from the rightmost [to avoid index shifts]\n            for (let i = filesToClose.length - 1; i >= 0; i--) {\n                const fileObj = FileSystem.getFileForPath(filesToClose[i].path);\n                CommandManager.execute(Commands.FILE_CLOSE, { file: fileObj, paneId: paneId });\n            }\n        }\n    }\n\n    /**\n     * \"CLOSE TABS TO THE RIGHT\"\n     * This function is responsible for closing all tabs to the right of the right-clicked tab\n     *\n     * @param {String} filePath - path of the file that was right-clicked\n     * @param {String} paneId - the id of the pane in which the file is present\n     */\n    function handleCloseTabsToTheRight(filePath, paneId) {\n        if (!filePath) {\n            return;\n        }\n\n        let workingSet;\n        workingSet = paneId === \"first-pane\" ? Global.firstPaneWorkingSet : Global.secondPaneWorkingSet;\n        if (!workingSet) {\n            return;\n        }\n\n        // get the index of the current file in the working set\n        const currentIndex = workingSet.findIndex((entry) => entry.path === filePath);\n        // only proceed if there are tabs to the right\n        if (currentIndex !== -1 && currentIndex < workingSet.length - 1) {\n            // get all files to the right of the current file\n            const filesToClose = workingSet.slice(currentIndex + 1);\n\n            for (let i = filesToClose.length - 1; i >= 0; i--) {\n                const fileObj = FileSystem.getFileForPath(filesToClose[i].path);\n                CommandManager.execute(Commands.FILE_CLOSE, { file: fileObj, paneId: paneId });\n            }\n        }\n    }\n\n    /**\n     * \"REOPEN CLOSED FILE\"\n     * This just calls the reopen closed file command. everthing else is handled there\n     * TODO: disable the command if there are no closed files, look into the file menu\n     */\n    function reopenClosedFile() {\n        CommandManager.execute(Commands.FILE_REOPEN_CLOSED);\n    }\n\n    /**\n     * \"RENAME FILE\"\n     * This function handles the renaming of the file that was right-clicked\n     *\n     * @param {String} filePath - path of the file to rename\n     */\n    function handleFileRename(filePath) {\n        if (filePath) {\n            // First ensure the sidebar is visible so users can see the rename action\n            CommandManager.execute(Commands.SHOW_SIDEBAR);\n\n            // Get the file object using FileSystem\n            const fileObj = FileSystem.getFileForPath(filePath);\n\n            // Execute the rename command with the file object\n            CommandManager.execute(Commands.FILE_RENAME, { file: fileObj });\n        }\n    }\n\n    /**\n     * \"DELETE FILE\"\n     * This function handles the deletion of the file that was right-clicked\n     *\n     * @param {String} filePath - path of the file to delete\n     */\n    function handleFileDelete(filePath) {\n        if (filePath) {\n            // Get the file object using FileSystem\n            const fileObj = FileSystem.getFileForPath(filePath);\n\n            // Execute the delete command with the file object\n            CommandManager.execute(Commands.FILE_DELETE, { file: fileObj });\n        }\n    }\n\n    /**\n     * \"SHOW IN FILE TREE\"\n     * This function handles showing the file in the file tree\n     *\n     * @param {String} filePath - path of the file to show in file tree\n     */\n    function handleShowInFileTree(filePath) {\n        if (filePath) {\n            // First ensure the sidebar is visible so users can see the file in the tree\n            CommandManager.execute(Commands.SHOW_SIDEBAR);\n\n            // Get the file object using FileSystem\n            const fileObj = FileSystem.getFileForPath(filePath);\n\n            // Execute the show in tree command with the file object\n            CommandManager.execute(Commands.NAVIGATE_SHOW_IN_FILE_TREE, { file: fileObj });\n        }\n    }\n\n    /**\n     * This function is called when a tab is right-clicked\n     * This will show the more options context menu\n     *\n     * @param {String} paneId - the id of the pane [\"first-pane\", \"second-pane\"]\n     * @param {Number} x - the x coordinate for positioning the menu\n     * @param {Number} y - the y coordinate for positioning the menu\n     * @param {String} filePath - [optional] the path of the file that was right-clicked\n     */\n    function showMoreOptionsContextMenu(paneId, x, y, filePath) {\n        const dropdown = new DropdownButton.DropdownButton(\"\", items);\n\n        // Append to document body for absolute positioning\n        $(\"body\").append(dropdown.$button);\n\n        // Position the dropdown at the mouse coordinates\n        dropdown.$button.css({\n            position: \"absolute\",\n            left: x + \"px\",\n            top: y + \"px\",\n            zIndex: 1000\n        });\n\n        // Add a custom class to override the max-height, not sure why a scroll bar was coming but this did the trick\n        dropdown.dropdownExtraClasses = \"tabbar-context-menu\";\n\n        dropdown.showDropdown();\n\n        $(\".tabbar-context-menu\").css(\"max-height\", \"300px\");\n\n        // handle the option selection\n        dropdown.on(\"select\", function (e, item) {\n            _handleSelection(item, filePath, paneId);\n        });\n\n        // Remove the button after the dropdown is hidden\n        dropdown.$button.css({\n            display: \"none\"\n        });\n    }\n\n    /**\n     * Handles the selection of an option in the more options context menu\n     *\n     * @param {String} item - the item being selected\n     * @param {String} filePath - the path of the file that was right-clicked\n     * @param {String} paneId - the id of the pane [\"first-pane\", \"second-pane\"]\n     */\n    function _handleSelection(item, filePath, paneId) {\n        switch (item) {\n        case Strings.CLOSE_TAB:\n            handleCloseTab(filePath, paneId);\n            break;\n        case Strings.CLOSE_TABS_TO_THE_LEFT:\n            handleCloseTabsToTheLeft(filePath, paneId);\n            break;\n        case Strings.CLOSE_TABS_TO_THE_RIGHT:\n            handleCloseTabsToTheRight(filePath, paneId);\n            break;\n        case Strings.CLOSE_ALL_TABS:\n            handleCloseAllTabs(paneId);\n            break;\n        case Strings.CLOSE_SAVED_TABS:\n            handleCloseSavedTabs(paneId);\n            break;\n        case Strings.CMD_FILE_RENAME:\n            handleFileRename(filePath);\n            break;\n        case Strings.CMD_FILE_DELETE:\n            handleFileDelete(filePath);\n            break;\n        case Strings.CMD_SHOW_IN_TREE:\n            handleShowInFileTree(filePath);\n            break;\n        case Strings.REOPEN_CLOSED_FILE:\n            reopenClosedFile();\n            break;\n        }\n    }\n\n    module.exports = {\n        showMoreOptionsContextMenu\n    };\n});\n"],"file":"more-options.js"}