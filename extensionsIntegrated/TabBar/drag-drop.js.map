{"version":3,"sources":["extensionsIntegrated/TabBar/drag-drop.js"],"names":["define","require","exports","module","MainViewManager","CommandManager","Commands","draggedTab","dragIndicator","dragSourcePane","cleanupDragState","$","removeClass","hide","css","top","left","height","remove","ensureDragIndicator","length","append","updateDragIndicator","targetTab","insertBefore","rect","getBoundingClientRect","x","right","position","width","zIndex","show","getDropPosition","mouseX","midpoint","findClosestTab","container","tabs","find","get","closestTab","closestDistance","Infinity","tab","tabCenter","distance","Math","abs","handleDragStart","event","this","closest","originalEvent","dataTransfer","effectAllowed","setData","addClass","setTimeout","handleDragOver","preventDefault","dropEffect","currentTarget","clientX","handleContainerDragOver","handleDrop","stopPropagation","targetPaneId","performTabMove","handleContainerDrop","attr","draggedPath","targetPath","moveWorkingSetItem","moveTabBetweenPanes","paneId","beforeTarget","workingSet","getWorkingSet","draggedIndex","targetIndex","i","fullPath","newPosition","_moveWorkingSetItem","sourcePaneId","sourceWorkingSet","targetWorkingSet","draggedFile","execute","FILE_CLOSE","file","insertIndex","addToWorkingSet","FILE_OPEN","error","console","handleDragEnd","handleDragLeave","relatedTarget","is","has","setupTabBarDragHandlers","tabBarSelector","$tabBar","off","on","setupPaneDropTargets","panes","forEach","paneSelector","index","$pane","tabBarId","isEmptyPane","children","currentActiveFile","getCurrentlyViewedFile","setupGlobalCleanup","document","key","init","firstPaneSelector","secondPaneSelector"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/* This file houses the functionality for dragging and dropping tabs */\n/* eslint-disable no-invalid-this */\ndefine(function (require, exports, module) {\n    const MainViewManager = require(\"view/MainViewManager\");\n    const CommandManager = require(\"command/CommandManager\");\n    const Commands = require(\"command/Commands\");\n\n    /**\n     * These variables track the drag and drop state of tabs\n     * draggedTab: The tab that is currently being dragged\n     * dragIndicator: Visual indicator showing where the tab will be dropped\n     * dragSourcePane: To track which pane the dragged tab originated from\n     */\n    let draggedTab = null;\n    let dragIndicator = null;\n    let dragSourcePane = null;\n\n    /**\n     * this function is responsible to make sure that all the drag state is properly cleaned up\n     * it is needed to make sure that the tab bar doesn't get unresponsive\n     * because of handlers not being attached properly\n     */\n    function cleanupDragState() {\n        $(\".tab\").removeClass(\"dragging drag-target\");\n        $(\".empty-pane-drop-target\").removeClass(\"empty-pane-drop-target\");\n\n        // this is to make sure that the drag indicator is hidden and remove any inline styles\n        if (dragIndicator) {\n            dragIndicator.hide().css({\n                top: \"\",\n                left: \"\",\n                height: \"\"\n            });\n        }\n\n        // Reset all drag state variables\n        draggedTab = null;\n        dragSourcePane = null;\n\n        // remove any temporary elements\n        $(\"#tab-drag-helper\").remove();\n    }\n\n    /**\n     * create the drag indicator if it doesn't exist\n     */\n    function ensureDragIndicator() {\n        if (!dragIndicator || !dragIndicator.length) {\n            dragIndicator = $('<div class=\"tab-drag-indicator\"></div>');\n            $(\"body\").append(dragIndicator);\n        }\n    }\n\n    /**\n     * this function is to update the drag indicator position\n     * @param {Element} targetTab - The target tab element\n     * @param {boolean} insertBefore - Whether to insert before the target tab\n     */\n    function updateDragIndicator(targetTab, insertBefore) {\n        if (!targetTab) {\n            dragIndicator.hide();\n            return;\n        }\n\n        const rect = targetTab.getBoundingClientRect();\n        const x = insertBefore ? rect.left : rect.right;\n\n        dragIndicator\n            .css({\n                position: \"fixed\",\n                left: x + \"px\",\n                top: rect.top + \"px\",\n                height: rect.height + \"px\",\n                width: \"2px\",\n                zIndex: 10001\n            })\n            .show();\n    }\n\n    /**\n     * get the drop position relative to a target tab\n     * @param {Element} targetTab - The target tab element\n     * @param {number} mouseX - The mouse X coordinate\n     * @returns {boolean} True if should insert before, false if after\n     */\n    function getDropPosition(targetTab, mouseX) {\n        const rect = targetTab.getBoundingClientRect();\n        const midpoint = rect.left + rect.width / 2;\n        return mouseX < midpoint;\n    }\n\n    /**\n     * find the closest tab to mouse position\n     * @param {jQuery} container - The tab container element\n     * @param {number} mouseX - The mouse X coordinate\n     * @returns {Element|null} The closest tab element or null\n     */\n    function findClosestTab(container, mouseX) {\n        const tabs = container.find(\".tab\").get();\n        let closestTab = null;\n        let closestDistance = Infinity;\n\n        for (let tab of tabs) {\n            if (tab === draggedTab) {\n                continue;\n            }\n\n            const rect = tab.getBoundingClientRect();\n            const tabCenter = rect.left + rect.width / 2;\n            const distance = Math.abs(mouseX - tabCenter);\n\n            if (distance < closestDistance) {\n                closestDistance = distance;\n                closestTab = tab;\n            }\n        }\n\n        return closestTab;\n    }\n\n    /**\n     * this function handles the drag start\n     * @param {Event} event - the event instance\n     */\n    function handleDragStart(event) {\n        draggedTab = this;\n        dragSourcePane = $(this).closest(\"#phoenix-tab-bar-2\").length > 0 ? \"second-pane\" : \"first-pane\";\n\n        // Set up drag data\n        event.originalEvent.dataTransfer.effectAllowed = \"move\";\n        event.originalEvent.dataTransfer.setData(\"application/x-phoenix-tab\", \"tab-drag\");\n\n        // Add visual styling\n        $(this).addClass(\"dragging\");\n\n        ensureDragIndicator();\n\n        // Small delay to let the dragging class take effect\n        setTimeout(() => {\n            dragIndicator.hide();\n        }, 10);\n    }\n\n    /**\n     * this function handles the drag over\n     * @param {Event} event - the event instance\n     */\n    function handleDragOver(event) {\n        if (!draggedTab) {\n            return;\n        }\n\n        event.preventDefault();\n        event.originalEvent.dataTransfer.dropEffect = \"move\";\n\n        const targetTab = event.currentTarget;\n        if (targetTab === draggedTab) {\n            return;\n        }\n\n        const insertBefore = getDropPosition(targetTab, event.originalEvent.clientX);\n        updateDragIndicator(targetTab, insertBefore);\n\n        // Clear any existing drag-target classes\n        $(\".tab\").removeClass(\"drag-target\");\n        $(targetTab).addClass(\"drag-target\");\n    }\n\n    /**\n     * handles the container drag over (for empty space drops)\n     * @param {Event} event\n     */\n    function handleContainerDragOver(event) {\n        if (!draggedTab) {\n            return;\n        }\n\n        event.preventDefault();\n\n        const container = $(this);\n        const mouseX = event.originalEvent.clientX;\n        const closestTab = findClosestTab(container, mouseX);\n\n        if (closestTab) {\n            const insertBefore = getDropPosition(closestTab, mouseX);\n            updateDragIndicator(closestTab, insertBefore);\n\n            // Clear existing classes and add to closest\n            $(\".tab\").removeClass(\"drag-target\");\n            $(closestTab).addClass(\"drag-target\");\n        } else {\n            dragIndicator.hide();\n        }\n    }\n\n    /**\n     * this handles the drop\n     * @param {Event} event\n     */\n    function handleDrop(event) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (!draggedTab || this === draggedTab) {\n            cleanupDragState();\n            return;\n        }\n\n        const targetTab = this;\n        const targetPaneId = $(targetTab).closest(\"#phoenix-tab-bar-2\").length > 0 ? \"second-pane\" : \"first-pane\";\n        const insertBefore = getDropPosition(targetTab, event.originalEvent.clientX);\n\n        performTabMove(targetTab, targetPaneId, insertBefore);\n        cleanupDragState();\n    }\n\n    /**\n     * this function handles the drop on container (empty space)\n     * @param {Event} event\n     */\n    function handleContainerDrop(event) {\n        event.preventDefault();\n\n        if (!draggedTab) {\n            cleanupDragState();\n            return;\n        }\n\n        const container = $(this);\n        const mouseX = event.originalEvent.clientX;\n        const closestTab = findClosestTab(container, mouseX);\n\n        if (closestTab) {\n            const targetPaneId = container.attr(\"id\") === \"phoenix-tab-bar-2\" ? \"second-pane\" : \"first-pane\";\n            const insertBefore = getDropPosition(closestTab, mouseX);\n            performTabMove(closestTab, targetPaneId, insertBefore);\n        }\n\n        cleanupDragState();\n    }\n\n    /**\n     * this function performs the actual tab move\n     * it can be of two types: tab move in same pane, tab move between different panes\n     * @param {Element} targetTab - The target tab element\n     * @param {string} targetPaneId - The target pane ID\n     * @param {boolean} insertBefore - Whether to insert before the target\n     */\n    function performTabMove(targetTab, targetPaneId, insertBefore) {\n        const draggedPath = $(draggedTab).attr(\"data-path\");\n        const targetPath = $(targetTab).attr(\"data-path\");\n\n        if (dragSourcePane === targetPaneId) {\n            // same pane move\n            moveWorkingSetItem(targetPaneId, draggedPath, targetPath, insertBefore);\n        } else {\n            // different pane move\n            moveTabBetweenPanes(dragSourcePane, targetPaneId, draggedPath, targetPath, insertBefore);\n        }\n    }\n\n    /**\n     * this function is responsible to move the tab within the pane\n     * @param {string} paneId - The pane ID\n     * @param {string} draggedPath - The path of the dragged file\n     * @param {string} targetPath - The path of the target file\n     * @param {boolean} beforeTarget - Whether to insert before the target\n     */\n    function moveWorkingSetItem(paneId, draggedPath, targetPath, beforeTarget) {\n        const workingSet = MainViewManager.getWorkingSet(paneId);\n        let draggedIndex = -1;\n        let targetIndex = -1;\n\n        // Find the indices of both the dragged item and the target item\n        for (let i = 0; i < workingSet.length; i++) {\n            if (workingSet[i].fullPath === draggedPath) {\n                draggedIndex = i;\n            }\n            if (workingSet[i].fullPath === targetPath) {\n                targetIndex = i;\n            }\n        }\n\n        if (draggedIndex !== -1 && targetIndex !== -1) {\n            let newPosition = beforeTarget ? targetIndex : targetIndex + 1;\n            if (draggedIndex < newPosition) {\n                newPosition--;\n            }\n            MainViewManager._moveWorkingSetItem(paneId, draggedIndex, newPosition);\n        }\n    }\n\n    /**\n     * this function is responsible to move the tab in between different panes\n     * @param {string} sourcePaneId - The source pane ID\n     * @param {string} targetPaneId - The target pane ID\n     * @param {string} draggedPath - The path of the dragged file\n     * @param {string} targetPath - The path of the target file\n     * @param {boolean} beforeTarget - Whether to insert before the target\n     */\n    function moveTabBetweenPanes(sourcePaneId, targetPaneId, draggedPath, targetPath, beforeTarget) {\n        try {\n            const sourceWorkingSet = MainViewManager.getWorkingSet(sourcePaneId);\n            const targetWorkingSet = MainViewManager.getWorkingSet(targetPaneId);\n\n            let draggedFile = null;\n            let targetIndex = -1;\n\n            // Find the dragged file and its index in the source pane\n            for (let i = 0; i < sourceWorkingSet.length; i++) {\n                if (sourceWorkingSet[i].fullPath === draggedPath) {\n                    draggedFile = sourceWorkingSet[i];\n                    break;\n                }\n            }\n\n            // Find the target index in the target pane\n            for (let i = 0; i < targetWorkingSet.length; i++) {\n                if (targetWorkingSet[i].fullPath === targetPath) {\n                    targetIndex = i;\n                    break;\n                }\n            }\n\n            if (draggedFile) {\n                // Close in source pane\n                CommandManager.execute(Commands.FILE_CLOSE, { file: draggedFile, paneId: sourcePaneId });\n\n                // calculate where to insert it in the target pane\n                const insertIndex =\n                    targetIndex !== -1 ? (beforeTarget ? targetIndex : targetIndex + 1) : targetWorkingSet.length;\n\n                // Add to target pane\n                MainViewManager.addToWorkingSet(targetPaneId, draggedFile, insertIndex);\n                CommandManager.execute(Commands.FILE_OPEN, { fullPath: draggedPath, paneId: targetPaneId });\n            }\n        } catch (error) {\n            console.error(\"Error during cross-pane tab move:\", error);\n        }\n    }\n\n    /**\n     * this function handles the drag end event\n     * @param {Event} event - the event instance\n     */\n    function handleDragEnd(event) {\n        // Small delay to ensure other events finish\n        setTimeout(() => {\n            cleanupDragState();\n        }, 50);\n    }\n\n    /**\n     * this function handles drag leave\n     * @param {Event} event - the event instance\n     */\n    function handleDragLeave(event) {\n        // Only remove styling if truly leaving the element\n        const relatedTarget = event.originalEvent.relatedTarget;\n        if (!$(this).is(relatedTarget) && !$(this).has(relatedTarget).length) {\n            $(this).removeClass(\"drag-target\");\n        }\n    }\n\n    /**\n     * Setup drag handlers for a tab bar\n     * @param {string} tabBarSelector - The jQuery selector for the tab bar\n     */\n    function setupTabBarDragHandlers(tabBarSelector) {\n        const $tabBar = $(tabBarSelector);\n\n        // Remove existing handlers to prevent duplicates\n        $tabBar.off(\"dragstart dragover dragenter dragleave drop dragend\");\n\n        // add the handlers\n        $tabBar.on(\"dragstart\", \".tab\", handleDragStart);\n        $tabBar.on(\"dragover\", \".tab\", handleDragOver);\n        $tabBar.on(\"dragleave\", \".tab\", handleDragLeave);\n        $tabBar.on(\"drop\", \".tab\", handleDrop);\n        $tabBar.on(\"dragend\", \".tab\", handleDragEnd);\n\n        // container level handlers (for empty space)\n        $tabBar.on(\"dragover\", handleContainerDragOver);\n        $tabBar.on(\"drop\", handleContainerDrop);\n\n        // Make tabs draggable\n        $tabBar.find(\".tab\").attr(\"draggable\", true);\n    }\n\n    /**\n     * setup the pane drop targets\n     */\n    function setupPaneDropTargets() {\n        const panes = [\"#first-pane .pane-content\", \"#second-pane .pane-content\"];\n\n        panes.forEach((paneSelector, index) => {\n            const paneId = index === 0 ? \"first-pane\" : \"second-pane\";\n            const $pane = $(paneSelector);\n\n            $pane.off(\"dragover dragenter dragleave drop\");\n\n            $pane.on(\"dragover dragenter\", function (event) {\n                if (draggedTab && dragSourcePane !== paneId) {\n                    // Only allow cross-pane drops\n                    event.preventDefault();\n\n                    // Check if this pane is empty for visual styling\n                    const tabBarId = paneId === \"first-pane\" ? \"#phoenix-tab-bar\" : \"#phoenix-tab-bar-2\";\n                    const $tabBar = $(tabBarId);\n                    const isEmptyPane =\n                        !$tabBar.length || $tabBar.is(\":hidden\") || $tabBar.children(\".tab\").length === 0;\n\n                    if (isEmptyPane) {\n                        $(this).addClass(\"empty-pane-drop-target\");\n                    } else {\n                        // Add a different class for non-empty panes\n                        $(this).addClass(\"pane-drop-target\");\n                    }\n                }\n            });\n\n            $pane.on(\"dragleave\", function (event) {\n                $(this).removeClass(\"empty-pane-drop-target pane-drop-target\");\n            });\n\n            $pane.on(\"drop\", function (event) {\n                if (draggedTab && dragSourcePane !== paneId) {\n                    event.preventDefault();\n                    $(this).removeClass(\"empty-pane-drop-target pane-drop-target\");\n\n                    const draggedPath = $(draggedTab).attr(\"data-path\");\n                    const sourceWorkingSet = MainViewManager.getWorkingSet(dragSourcePane);\n                    const targetWorkingSet = MainViewManager.getWorkingSet(paneId);\n                    let draggedFile = null;\n\n                    // Find dragged file\n                    for (let file of sourceWorkingSet) {\n                        if (file.fullPath === draggedPath) {\n                            draggedFile = file;\n                            break;\n                        }\n                    }\n\n                    if (draggedFile) {\n                        // Close in source pane\n                        CommandManager.execute(Commands.FILE_CLOSE, { file: draggedFile, paneId: dragSourcePane });\n\n                        // Check if target pane is empty or has files\n                        const tabBarId = paneId === \"first-pane\" ? \"#phoenix-tab-bar\" : \"#phoenix-tab-bar-2\";\n                        const $tabBar = $(tabBarId);\n                        const isEmptyPane =\n                            !$tabBar.length || $tabBar.is(\":hidden\") || $tabBar.children(\".tab\").length === 0;\n\n                        if (isEmptyPane) {\n                            // Empty pane: just add the file\n                            MainViewManager.addToWorkingSet(paneId, draggedFile);\n                        } else {\n                            // Non-empty pane: add after the currently active file\n                            const currentActiveFile = MainViewManager.getCurrentlyViewedFile(paneId);\n                            if (currentActiveFile) {\n                                // Find index of current active file and insert after it\n                                let targetIndex = -1;\n                                for (let i = 0; i < targetWorkingSet.length; i++) {\n                                    if (targetWorkingSet[i].fullPath === currentActiveFile.fullPath) {\n                                        targetIndex = i;\n                                        break;\n                                    }\n                                }\n                                MainViewManager.addToWorkingSet(paneId, draggedFile, targetIndex + 1);\n                            } else {\n                                // Fallback: add to end\n                                MainViewManager.addToWorkingSet(paneId, draggedFile);\n                            }\n                        }\n\n                        // Open file in target pane\n                        CommandManager.execute(Commands.FILE_OPEN, { fullPath: draggedPath, paneId: paneId });\n                    }\n\n                    cleanupDragState();\n                }\n            });\n        });\n    }\n\n    /**\n     * clean up the handlers\n     */\n    function setupGlobalCleanup() {\n        // Clean up on document level events\n        $(document).on(\"dragend mouseup\", function () {\n            if (draggedTab) {\n                setTimeout(() => cleanupDragState(), 100);\n            }\n        });\n\n        // Clean up on escape key\n        $(document).on(\"keydown\", function (event) {\n            if (event.key === \"Escape\" && draggedTab) {\n                cleanupDragState();\n            }\n        });\n    }\n\n    /**\n     * Initialize drag and drop functionality\n     * @param {string} firstPaneSelector - The selector for the first pane tab bar\n     * @param {string} secondPaneSelector - The selector for the second pane tab bar\n     */\n    function init(firstPaneSelector, secondPaneSelector) {\n        // setup drag handlers for both tab bars\n        if (firstPaneSelector) {\n            setupTabBarDragHandlers(firstPaneSelector);\n        }\n        if (secondPaneSelector) {\n            setupTabBarDragHandlers(secondPaneSelector);\n        }\n\n        setupPaneDropTargets();\n        setupGlobalCleanup();\n        ensureDragIndicator();\n    }\n\n    module.exports = {\n        init\n    };\n});\n"],"file":"drag-drop.js"}