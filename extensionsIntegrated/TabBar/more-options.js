define(function(require,exports,module){const CommandManager=require("command/CommandManager"),Commands=require("command/Commands"),FileSystem=require("filesystem/FileSystem"),Menus=require("command/Menus"),Strings=require("strings"),Global=require("./global"),TABBAR_CLOSE_TABS_LEFT="tabbar.closeTabsLeft",TABBAR_CLOSE_TABS_RIGHT="tabbar.closeTabsRight",TABBAR_CLOSE_SAVED_TABS="tabbar.closeSavedTabs",TABBAR_CLOSE_ALL="tabbar.closeAllTabs";let _currentTabContext={filePath:null,paneId:null};function _getWorkingSet(paneId){return"first-pane"===paneId?Global.firstPaneWorkingSet:Global.secondPaneWorkingSet}function _closeFiles(files,paneId){for(let i=files.length-1;i>=0;i--){const fileObj=FileSystem.getFileForPath(files[i].path);CommandManager.execute(Commands.FILE_CLOSE,{file:fileObj,paneId:paneId})}}function _executeWithFileContext(commandId,options={}){if(_currentTabContext.filePath){const fileObj=FileSystem.getFileForPath(_currentTabContext.filePath);CommandManager.execute(commandId,{file:fileObj,...options})}}function handleCloseAllTabs(){const workingSet=_getWorkingSet(_currentTabContext.paneId);workingSet&&0!==workingSet.length&&_closeFiles(workingSet,_currentTabContext.paneId)}function handleCloseSavedTabs(){const workingSet=_getWorkingSet(_currentTabContext.paneId);if(workingSet&&0!==workingSet.length){const savedTabs=workingSet.filter(entry=>!entry.isDirty);_closeFiles(savedTabs,_currentTabContext.paneId)}}function handleCloseTabsToTheLeft(){const workingSet=_getWorkingSet(_currentTabContext.paneId);if(!workingSet)return;const currentIndex=workingSet.findIndex(entry=>entry.path===_currentTabContext.filePath);currentIndex>0&&_closeFiles(workingSet.slice(0,currentIndex),_currentTabContext.paneId)}function handleCloseTabsToTheRight(){const workingSet=_getWorkingSet(_currentTabContext.paneId);if(!workingSet)return;const currentIndex=workingSet.findIndex(entry=>entry.path===_currentTabContext.filePath);-1!==currentIndex&&currentIndex<workingSet.length-1&&_closeFiles(workingSet.slice(currentIndex+1),_currentTabContext.paneId)}function showMoreOptionsContextMenu(paneId,filePath,x,y){_currentTabContext.filePath=filePath,_currentTabContext.paneId=paneId;const contextMenu=Menus.getContextMenu("tabbar-context-menu"),event=$.Event("contextmenu",{pageX:x,pageY:y});contextMenu.open(event)}function init(){CommandManager.register(Strings.CLOSE_TABS_TO_THE_LEFT,TABBAR_CLOSE_TABS_LEFT,handleCloseTabsToTheLeft),CommandManager.register(Strings.CLOSE_TABS_TO_THE_RIGHT,TABBAR_CLOSE_TABS_RIGHT,handleCloseTabsToTheRight),CommandManager.register(Strings.CLOSE_SAVED_TABS,TABBAR_CLOSE_SAVED_TABS,handleCloseSavedTabs),CommandManager.register(Strings.CLOSE_ALL_TABS,TABBAR_CLOSE_ALL,handleCloseAllTabs);const menu=Menus.registerContextMenu("tabbar-context-menu");menu.addMenuItem(Commands.FILE_CLOSE),menu.addMenuItem(TABBAR_CLOSE_TABS_LEFT),menu.addMenuItem(TABBAR_CLOSE_TABS_RIGHT),menu.addMenuItem(TABBAR_CLOSE_SAVED_TABS),menu.addMenuItem(TABBAR_CLOSE_ALL),menu.addMenuDivider(),menu.addMenuItem(Commands.FILE_RENAME),menu.addMenuItem(Commands.FILE_DELETE),menu.addMenuItem(Commands.NAVIGATE_SHOW_IN_FILE_TREE),menu.addMenuDivider(),menu.addMenuItem(Commands.FILE_REOPEN_CLOSED)}module.exports={showMoreOptionsContextMenu:showMoreOptionsContextMenu,init:init}});