define(function(require,exports,module){const KernalModeTrust=window.KernalModeTrust;if(!KernalModeTrust)throw new Error("Login utils should have access to KernalModeTrust. Cannot boot without trust ring");function validTillExpired(entitlements,lastRecordedEntitlement){if(!entitlements)return null;const now=Date.now();function isNewlyExpired(validTill,lastValidTill){return validTill&&validTill<now&&(!lastValidTill||lastValidTill>=now)}if(entitlements.plan){const validTill=entitlements.plan.validTill,lastValidTill=lastRecordedEntitlement&&lastRecordedEntitlement.plan?lastRecordedEntitlement.plan.validTill:null;if(isNewlyExpired(validTill,lastValidTill))return entitlements.plan.name||brackets.config.main_pro_plan}if(entitlements.entitlements)for(const key in entitlements.entitlements){const entitlement=entitlements.entitlements[key];if(!entitlement)continue;const validTill=entitlement.validTill,lastValidTill=lastRecordedEntitlement&&lastRecordedEntitlement.entitlements&&lastRecordedEntitlement.entitlements[key]?lastRecordedEntitlement.entitlements[key].validTill:null;if(isNewlyExpired(validTill,lastValidTill))return key}return null}function haveEntitlementsChanged(current,last){if(!last&&!current)return!1;if(!last&&current||!current&&last)return!0;if(!last.entitlements&&current.entitlements||!current.entitlements&&last.entitlements)return!0;const currentPaidSub=current.plan&&current.plan.paidSubscriber,lastPaidSub=last.plan&&last.plan.paidSubscriber,currentIsSubscriber=current.plan&&current.plan.isSubscriber,lastIsSubscriber=last.plan&&last.plan.isSubscriber;if(currentIsSubscriber!==lastIsSubscriber||currentPaidSub!==lastPaidSub)return!0;const currentPlanName=current.plan&&current.plan.name,lastPlanName=last.plan&&last.plan.name;if(currentPlanName!==lastPlanName)return!0;if(current.entitlements&&last.entitlements)for(const key of Object.keys(current.entitlements)){const currentActivated=current.entitlements[key]&&current.entitlements[key].activated,lastActivated=last.entitlements[key]&&last.entitlements[key].activated;if(currentActivated!==lastActivated)return!0}return!1}KernalModeTrust.LoginUtils={validTillExpired:validTillExpired,haveEntitlementsChanged:haveEntitlementsChanged},Phoenix.isTestWindow&&(exports.validTillExpired=validTillExpired,exports.haveEntitlementsChanged=haveEntitlementsChanged)});
//# sourceMappingURL=login-utils.js.map
