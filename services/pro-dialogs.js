define(function(require,exports,module){const KernalModeTrust=window.KernalModeTrust;if(!KernalModeTrust)throw new Error("pro-dialogs.js should have access to KernalModeTrust. Cannot boot without trust ring");const proTitle=`<span class="phoenix-pro-title">\n                    <span class="pro-plan-name">${brackets.config.main_pro_plan}</span>\n                    <i class="fa-solid fa-feather orange-gold" style="margin-left: 3px;"></i>\n                </span>`,proTitlePlain=`<span class="pro-plan-name">${brackets.config.main_pro_plan}</span>\n                    <i class="fa-solid fa-feather" style="margin-left: 2px;"></i>`;require("./setup-login-service");const Dialogs=require("widgets/Dialogs"),Mustache=require("thirdparty/mustache/mustache"),Strings=require("strings"),StringUtils=require("utils/StringUtils"),ThemeManager=require("view/ThemeManager"),Metrics=require("utils/Metrics"),proUpgradeHTML=require("text!./html/pro-upgrade.html"),proEndedHTML=require("text!./html/promo-ended.html");let fetchFn=window.fetch;const UPSELL_TYPE_LIVE_EDIT="live_edit",UPSELL_TYPE_PRO_TRIAL_ENDED="pro_trial_ended",UPSELL_TYPE_GET_PRO="get_pro";function showProTrialStartDialog(trialDays){const title=StringUtils.format(Strings.PROMO_UPGRADE_TITLE,proTitle),message=StringUtils.format(Strings.PROMO_UPGRADE_MESSAGE,trialDays),$template=$(Mustache.render(proUpgradeHTML,{title:title,message:message,Strings:Strings,secondaryButton:Strings.PROMO_LEARN_MORE,primaryButton:Strings.OK}));Dialogs.showModalDialogUsingTemplate($template).done(function(id){console.log("Dialog closed with id: "+id),Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgShow","promo"),"secondaryButton"===id?(Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgAct","promoLearn"),Phoenix.app.openURLInDefaultBrowser(brackets.config.purchase_url)):Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgAct","promoCancel")})}function _getUpsellDialogText(upsellType){const buttonGetProText=StringUtils.format(Strings.PROMO_GET_APP_UPSELL_BUTTON,proTitlePlain);switch(upsellType){case UPSELL_TYPE_PRO_TRIAL_ENDED:return{title:StringUtils.format(Strings.PROMO_PRO_ENDED_TITLE,proTitle),localDialogMessage:Strings.PROMO_ENDED_MESSAGE,buttonGetProText:buttonGetProText};case UPSELL_TYPE_LIVE_EDIT:return{title:StringUtils.format(Strings.PROMO_PRO_UNLOCK_LIVE_EDIT_TITLE,proTitle),localDialogMessage:Strings.PROMO_PRO_UNLOCK_MESSAGE,buttonGetProText:buttonGetProText};case UPSELL_TYPE_GET_PRO:default:return{title:StringUtils.format(Strings.PROMO_PRO_UNLOCK_PRO_TITLE,proTitle),localDialogMessage:Strings.PROMO_PRO_UNLOCK_MESSAGE,buttonGetProText:buttonGetProText}}}function _showLocalProEndedDialog(upsellType){const dlgText=_getUpsellDialogText(upsellType),title=dlgText.title,buttonGetPro=dlgText.buttonGetProText,$template=$(Mustache.render(proUpgradeHTML,{title:title,Strings:Strings,message:dlgText.localDialogMessage,secondaryButton:Strings.CANCEL,primaryButton:buttonGetPro}));Dialogs.showModalDialogUsingTemplate($template).done(function(id){console.log("Dialog closed with id: "+id),Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgShow","localUpgrade"),"ok"===id?(Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgAct","localGetPro"),Phoenix.app.openURLInDefaultBrowser(brackets.config.purchase_url)):Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgAct","localCancel")})}function _showRemoteProEndedDialog(upsellType,currentVersion,promoHtmlURL,upsellPurchaseURL){const dlgText=_getUpsellDialogText(upsellType),title=dlgText.title,buttonGetPro=dlgText.buttonGetProText,currentTheme=ThemeManager.getCurrentTheme(),theme=currentTheme&&currentTheme.dark?"dark":"light",promoURL=`${promoHtmlURL}?lang=${brackets.getLocale()}&theme=${theme}&version=${currentVersion}&upsellType=${upsellType}`,$template=$(Mustache.render(proEndedHTML,{Strings:Strings,title:title,buttonGetPro:buttonGetPro,promoURL:promoURL}));Dialogs.showModalDialogUsingTemplate($template).done(function(id){console.log("Dialog closed with id: "+id),Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgShow","remoteUpgrade"),"get_pro"===id?(Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgAct","remoteGetPro"),Phoenix.app.openURLInDefaultBrowser(upsellPurchaseURL||brackets.config.purchase_url)):Metrics.countEvent(Metrics.EVENT_TYPE.PRO,"dlgAct","remoteCancel")})}async function showProUpsellDialog(upsellType){const currentVersion=window.AppConfig.apiVersion;if(navigator.onLine)try{const configURL=`${brackets.config.promotions_url}app/config.json`,response=await fetchFn(configURL);if(!response.ok)return void _showLocalProEndedDialog(upsellType);const config=await response.json();config.upsell_after_trial_url?_showRemoteProEndedDialog(upsellType,currentVersion,config.upsell_after_trial_url,config.upsell_purchase_url):_showLocalProEndedDialog(upsellType)}catch(error){_showLocalProEndedDialog(upsellType)}else _showLocalProEndedDialog(upsellType)}function showAIUpsellDialog(getAIEntitlementResponse){if(!getAIEntitlementResponse||!getAIEntitlementResponse.upsellDialog)return;const upsellDialog=getAIEntitlementResponse.upsellDialog,title=upsellDialog.title,message=upsellDialog.message,buyURL=upsellDialog.buyURL,needsLogin=getAIEntitlementResponse.needsLogin;let buttons;if(needsLogin||buyURL){const primaryButtonText=needsLogin?Strings.PROFILE_SIGN_IN:Strings.AI_LOGIN_DIALOG_BUTTON;buttons=[{className:Dialogs.DIALOG_BTN_CLASS_NORMAL,id:Dialogs.DIALOG_BTN_CANCEL,text:Strings.CANCEL},{className:Dialogs.DIALOG_BTN_CLASS_PRIMARY,id:"mainAction",text:primaryButtonText}]}else buttons=[{className:Dialogs.DIALOG_BTN_CLASS_PRIMARY,id:Dialogs.DIALOG_BTN_OK,text:Strings.OK}];Dialogs.showModalDialog(Dialogs.DIALOG_ID_INFO,title,message,buttons).done(function(id){Metrics.countEvent(Metrics.EVENT_TYPE.AI,"dlgUpsell","show"),"mainAction"===id?needsLogin?(Metrics.countEvent(Metrics.EVENT_TYPE.AI,"dlgUpsell","signIn"),KernalModeTrust.EntitlementsManager.loginToAccount()):(Metrics.countEvent(Metrics.EVENT_TYPE.AI,"dlgUpsell","buyClick"),Phoenix.app.openURLInDefaultBrowser(buyURL)):Metrics.countEvent(Metrics.EVENT_TYPE.AI,"dlgUpsell",id)})}Phoenix.isTestWindow&&(window._test_pro_dlg_login_exports={setFetchFn:function _setDdateNowFn(fn){fetchFn=fn}}),exports.showProTrialStartDialog=showProTrialStartDialog,exports.showProUpsellDialog=showProUpsellDialog,exports.showAIUpsellDialog=showAIUpsellDialog,exports.UPSELL_TYPE_PRO_TRIAL_ENDED=UPSELL_TYPE_PRO_TRIAL_ENDED,exports.UPSELL_TYPE_GET_PRO=UPSELL_TYPE_GET_PRO,exports.UPSELL_TYPE_LIVE_EDIT=UPSELL_TYPE_LIVE_EDIT});
//# sourceMappingURL=pro-dialogs.js.map
