{"version":3,"sources":["assets/new-project/assets/js/new-git-project.js"],"names":["desktopInit","LAST_GIT_CLONE_BASE_DIR","createProjectBtn","websiteURLInput","locationInput","_validateGitURL","errors","gitURL","value","$","removeClass","addClass","push","Strings","ERROR_GIT_URL_INVALID","_validateProjectLocation","location","PLEASE_SELECT_A_FOLDER","error","_validate","isValid","prop","$messageDisplay","html","join","async","_deduceClonePath","newPath","originalPath","clonePath","newProjectExtension","getGitCloneDir","window","top","Phoenix","fs","getTauriPlatformPath","_selectFolder","showFolderSelect","then","catch","err","console","_createProjectClicked","localStorage","setItem","gitClone","Metrics","countEvent","EVENT_TYPE","NEW_PROJECT","closeDialogue","initGitProject","text","GIT_CLONE_URL","document","getElementById","onclick","keyup","getItem","isNativeApp"],"mappings":"AAyBA,SAASA,cACL,MAAMC,wBAA0B,6BAChC,IAAIC,iBAAkBC,gBAAiBC,cAEvC,SAASC,gBAAgBC,QACrB,IAAIC,OACJ,OADaJ,gBAAgBK,OAEzBC,EAAEN,iBAAiBO,YAAY,iBACxB,IAEXD,EAAEN,iBAAiBQ,SAAS,gBAC5BL,OAAOM,4FAA4FC,QAAQC,iCACpG,GAGX,SAASC,yBAAyBT,QAC9B,IAAIU,SACJ,OADeZ,cAAcI,QACZK,QAAQI,wBACrBR,EAAEL,eAAeO,SAAS,iBACnB,GAERP,cAAcc,OACbZ,OAAOM,4FAA4FR,cAAcc,gBACjHT,EAAEL,eAAeO,SAAS,iBACnB,IAEXF,EAAEL,eAAeM,YAAY,iBACtB,GAGX,SAASS,YACL,MAAMb,OAAS,GACf,IAAIc,QAAUf,gBAAgBC,QAC9Bc,QAAUL,yBAAyBT,SAAWc,QAC9CX,EAAEP,kBAAkBmB,KAAK,YAAaD,SACtC,MAAME,gBAAkBb,EAAE,mBAK1B,OAJAa,gBAAgBC,KAAK,IACjBH,SACAE,gBAAgBC,KAAKjB,OAAOkB,KAAK,SAE9BJ,QAGXK,eAAeC,iBAAiBC,SAI5B,GAHIA,UACAA,QAAUvB,cAAcwB,eAExBD,QACA,OAEJ,MAAME,UAACA,UAASX,MAAEA,aAAeY,oBAAoBC,eAAeJ,QAASxB,gBAAgBK,OAC7FJ,cAAcyB,UAAYA,UAC1BzB,cAAcI,MAAQwB,OAAOC,IAAIC,QAAQC,GAAGC,qBAAqBP,WACjEzB,cAAcc,MAAQA,MACtBd,cAAcwB,aAAeD,QAGjC,SAASU,gBACLP,oBAAoBQ,iBAAiBlC,cAAcwB,cAAgB,IAC9DW,KAAMZ,UACHD,iBAAiBC,SAASY,KAAKpB,aAChCqB,MAAOC,MACNC,QAAQxB,MAAM,0BAA2BuB,OAIrD,SAASE,wBACLC,aAAaC,QAAQ5C,wBAAyBG,cAAcwB,cAC5DE,oBAAoBgB,SAAS3C,gBAAgBK,MAAOJ,cAAcyB,WAClEkB,QAAQC,WAAWD,QAAQE,WAAWC,YAAa,YAAa,UAChEpB,oBAAoBqB,gBAGxB,SAASC,iBACL3C,EAAE,gBAAgB4C,KAAKxC,QAAQyC,eAC/BpD,iBAAmBqD,SAASC,eAAe,oBAC3CrD,gBAAkBoD,SAASC,eAAe,mBAC1CpD,cAAgBmD,SAASC,eAAe,iBACxCtD,iBAAiBuD,QAAUd,sBAC3BlC,EAAEN,iBAAiBuD,MAAM,KACrBhC,mBAAmBa,KAAKpB,aAE5Bf,cAAcI,MAAQK,QAAQI,uBAC9Bb,cAAcqD,QAAUpB,cACxBlC,gBAAgBK,MAAQ,2DACxBkB,iBAAiBkB,aAAae,QAAQ1D,0BAA0BsC,KAAKpB,WAEzEa,OAAOoB,eAAiBA,eAGzBpB,OAAOC,IAAIC,QAAQ0B,aAClB5D","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global newProjectExtension, Strings, Metrics*/\n/*eslint no-console: 0*/\n/*eslint strict: [\"error\", \"global\"]*/\n/* jshint ignore:start */\n\nfunction desktopInit() {\n    const LAST_GIT_CLONE_BASE_DIR = \"PH_LAST_GIT_CLONE_BASE_DIR\";\n    let createProjectBtn, websiteURLInput, locationInput;\n\n    function _validateGitURL(errors) {\n        let gitURL = websiteURLInput.value;\n        if(gitURL){\n            $(websiteURLInput).removeClass(\"error-border\");\n            return true;\n        }\n        $(websiteURLInput).addClass(\"error-border\");\n        errors.push(`<span><i class=\"fas fa-exclamation-triangle\" style=\"color: #f89406\"></i>&nbsp;&nbsp;${Strings.ERROR_GIT_URL_INVALID}</span>`);\n        return false;\n    }\n\n    function _validateProjectLocation(errors) {\n        let location = locationInput.value;\n        if( location === Strings.PLEASE_SELECT_A_FOLDER){\n            $(locationInput).addClass(\"error-border\");\n            return false;\n        }\n        if(locationInput.error){\n            errors.push(`<span><i class=\"fas fa-exclamation-triangle\" style=\"color: #f89406\"></i>&nbsp;&nbsp;${locationInput.error}</span>`);\n            $(locationInput).addClass(\"error-border\");\n            return false;\n        }\n        $(locationInput).removeClass(\"error-border\");\n        return true;\n    }\n\n    function _validate() {\n        const errors = [];\n        let isValid = _validateGitURL(errors);\n        isValid = _validateProjectLocation(errors) && isValid;\n        $(createProjectBtn).prop('disabled', !isValid);\n        const $messageDisplay = $(\"#messageDisplay\");\n        $messageDisplay.html(\"\");\n        if(!isValid) {\n            $messageDisplay.html(errors.join(\"<br>\"));\n        }\n        return isValid;\n    }\n\n    async function _deduceClonePath(newPath) {\n        if(!newPath){\n            newPath = locationInput.originalPath;\n        }\n        if(!newPath){\n            return;\n        }\n        const {clonePath, error} = await newProjectExtension.getGitCloneDir(newPath, websiteURLInput.value);\n        locationInput.clonePath = clonePath;\n        locationInput.value = window.top.Phoenix.fs.getTauriPlatformPath(clonePath);\n        locationInput.error = error;\n        locationInput.originalPath = newPath;\n    }\n\n    function _selectFolder() {\n        newProjectExtension.showFolderSelect(locationInput.originalPath || \"\")\n            .then((newPath)=>{\n                _deduceClonePath(newPath).then(_validate);\n            }).catch((err)=>{\n                console.error(\"user cancelled or error\", err);\n            });\n    }\n\n    function _createProjectClicked() {\n        localStorage.setItem(LAST_GIT_CLONE_BASE_DIR, locationInput.originalPath);\n        newProjectExtension.gitClone(websiteURLInput.value, locationInput.clonePath);\n        Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT, \"git.Click\", \"create\");\n        newProjectExtension.closeDialogue();\n    }\n\n    function initGitProject() {\n        $(\".label-clone\").text(Strings.GIT_CLONE_URL);\n        createProjectBtn = document.getElementById(\"createProjectBtn\");\n        websiteURLInput = document.getElementById(\"websiteURLInput\");\n        locationInput = document.getElementById(\"locationInput\");\n        createProjectBtn.onclick = _createProjectClicked;\n        $(websiteURLInput).keyup(()=>{\n            _deduceClonePath().then(_validate);\n        });\n        locationInput.value = Strings.PLEASE_SELECT_A_FOLDER;\n        locationInput.onclick = _selectFolder;\n        websiteURLInput.value = \"https://github.com/phcode-dev/HTML-Starter-Templates.git\";\n        _deduceClonePath(localStorage.getItem(LAST_GIT_CLONE_BASE_DIR)).then(_validate);\n    }\n    window.initGitProject = initGitProject;\n}\n\nif(window.top.Phoenix.isNativeApp){\n    desktopInit();\n}\n"],"file":"new-git-project.js"}