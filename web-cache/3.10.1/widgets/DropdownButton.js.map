{"version":3,"sources":["widgets/DropdownButton.js"],"names":["define","require","exports","module","DropdownEventHandler","EventDispatcher","WorkspaceManager","Menus","ViewUtils","_","EVENT_SELECTED","EVENT_LIST_RENDERED","EVENT_DROPDOWN_SHOWN","EVENT_DROPDOWN_CLOSED","DropdownButton","label","items","itemRenderer","options","this","enableFilter","customFilter","_onClick","bind","closeDropdown","_onClickOutside","$button","$","cssClasses","text","on","makeEventDispatcher","prototype","itemsSearchFilterText","$dropdown","dropdownExtraClasses","_lastFocus","_dropdownEventHandler","event","hasClass","toggleDropdown","stopPropagation","setButtonLabel","isOpen","item","index","escape","String","_renderList","$parent","self","html","searchStr","append","forEach","i","rendered","itemHtml","disabledClass","enabled","$html","$atag","$itemHtml","trigger","reRegisterMouseHandlers","refresh","remove","_reposition","setChecked","checked","listItems","count","length","toggleClass","toggleOffset","offset","posLeft","left","posTop","top","outerHeight","elementRect","height","width","clip","getElementClipSize","window","bottom","Math","max","dropdownElement","scrollWidth","offsetWidth","clientWidth","right","css","showDropdown","closeAll","addClass","outerWidth","appendTo","data","_onSelect","_onDropdownClose","_onKeyDown","open","document","body","addEventListener","activeElement","focus","removeEventListener","off","filterDropdown","searchString","$stickyLi","find","itemText","$liElementAtIndex","shouldShow","toLowerCase","includes","removeClass","ctrlKey","metaKey","key","Phoenix","app","clipboardReadText","then","stopImmediatePropagation","preventDefault","slice","close","$container","target","closest","is","$link","itemIndex","Number"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2021 - present core.ai . All rights reserved.\n *  Original work Copyright (c) 2014 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n// @INCLUDE_IN_API_DOCS\n\n/**\n * Button that opens a dropdown list when clicked. More akin to a popup menu than a combobox. Compared to a\n * simple <select> element:\n *  - There's no \"selected\" state\n *  - The button's label is not automatically changed when an item in the list is clicked\n *  - Its width is not the max of all the dropdown items' labels\n *  - The button & dropdown's appearance can be customized far more\n * Events\n *  - listRendered -- This event is dispatched after the entire list is rendered so that custom event handlers can be\n *                    set up for any custom UI in the list.\n *\n * TODO: merge DropdownEventHandler into this? Are there any other widgets that might want to use it separately?\n *\n */\ndefine(function (require, exports, module) {\n\n\n    // Load dependent modules\n    const DropdownEventHandler = require(\"utils/DropdownEventHandler\").DropdownEventHandler,\n        EventDispatcher = require(\"utils/EventDispatcher\"),\n        WorkspaceManager = require(\"view/WorkspaceManager\"),\n        Menus = require(\"command/Menus\"),\n        ViewUtils = require(\"utils/ViewUtils\"),\n        _ = require(\"thirdparty/lodash\");\n\n    /**\n     * Event triggered when an item is selected.\n     * @type {string}\n     * @const\n     */\n    const EVENT_SELECTED = \"select\";\n\n    /**\n     * Event triggered when the list is rendered.\n     * @type {string}\n     * @const\n     */\n    const EVENT_LIST_RENDERED = \"listRendered\";\n\n    /**\n     * Event triggered when the dropdown is shown.\n     * @type {string}\n     * @const\n     */\n    const EVENT_DROPDOWN_SHOWN = \"shown\";\n\n    /**\n     * Event triggered when the dropdown is closed.\n     * @type {string}\n     * @const\n     */\n    const EVENT_DROPDOWN_CLOSED = \"closed\";\n\n    /**\n     * Creates a single dropdown-button instance. The DOM node is created but not attached to\n     * the document anywhere - clients should append `this.$button` to the appropriate location.\n     *\n     * DropdownButton dispatches the following events:\n     *  - \"select\" - triggered when an option in the dropdown is clicked. Passed item object and index.\n     *\n     * @param {!string} label - The label to display on the button.\n     * @param {!Array<*>} items - Items in the dropdown list. Items can have any type/value. \n     *          An item with the value `\"---\"` will be treated as a divider, which is not clickable, \n     *          and `itemRenderer()` will not be called for it.\n     * @param {?function(*, number): (string|{html: string, enabled: boolean})} [itemRenderer] - \n     *          Optional function to convert a single item to HTML. If not provided, items are assumed \n     *          to be plain text strings. The function receives the item and its index.\n     * @param {Object} [options] - Additional options for the dropdown.\n     * @param {boolean} [options.enableFilter=false] - Set to `true` to enable filtering by typing.\n     * @param {string} [options.cssClasses] - A space-separated list of CSS classes to apply to the button.\n     * @param {function(string, string, number): boolean} [options.customFilter] - Optional. When `enableFilter` \n     *      is enabled, this function is used as a custom filtering callback. It receives the user's search text, \n     *      the text of the element being filtered, and the element's index. Return `true` to display the list item, \n     *      or `false` to hide it.\n     */\n    function DropdownButton(label, items, itemRenderer, options) {\n        this.items = items;\n        options = options || {};\n        this.enableFilter = (typeof options.enableFilter === 'boolean' ? options.enableFilter : true);\n        this.customFilter = options.customFilter;\n\n        this.itemRenderer = itemRenderer || this.itemRenderer;\n\n        this._onClick = this._onClick.bind(this);\n        this.closeDropdown = this.closeDropdown.bind(this);\n        this._onClickOutside = this._onClickOutside.bind(this);\n\n        this.$button = $(`<button class='btn btn-dropdown ${options.cssClasses ? options.cssClasses : ''}'/>`)\n            .text(label)\n            .on(\"click\", this._onClick);\n    }\n    EventDispatcher.makeEventDispatcher(DropdownButton.prototype);\n\n    /**\n     * Items in dropdown list - may be changed any time dropdown isn't open\n     * @type {!Array.<*>}\n     */\n    DropdownButton.prototype.items = null;\n\n    /**\n     * This is filter text corresponding to each items. it will be used to filter the items based on\n     * the keyboard key presses the user does to enter search filter in popup.\n     * @type {null}\n     */\n    DropdownButton.prototype.itemsSearchFilterText = null;\n\n    /**\n     * The clickable button. Available as soon as the DropdownButton is constructed.\n     * @type {!jQueryObject}\n     */\n    DropdownButton.prototype.$button = null;\n\n    /**\n     * The dropdown element. Only non-null while open.\n     * @type {?jQueryObject}\n     */\n    DropdownButton.prototype.$dropdown = null;\n\n    /**\n     * Extra CSS class(es) to apply to $dropdown\n     * @type {?string}\n     */\n    DropdownButton.prototype.dropdownExtraClasses = null;\n\n    /**\n     * @private\n     * Where to restore focus when dropdown closed\n     * @type {?HTMLElement}\n     */\n    DropdownButton.prototype._lastFocus = null;\n\n    /**\n     * @private\n     * Helper object for dropdown. Only non-null while open.\n     * @type {?DropdownEventHandler}\n     */\n    DropdownButton.prototype._dropdownEventHandler = null;\n\n    /**\n     * @private\n     * Handle clicking button\n     */\n    DropdownButton.prototype._onClick = function (event) {\n        if (!this.$button.hasClass(\"disabled\")) {\n            this.toggleDropdown();\n        }\n        // Indicate click was handled (e.g. to shield from MultiRangeInlineEditor._onClick())\n        event.stopPropagation();\n    };\n\n    /**\n     * Update the button label.\n     * @param {string} label\n     */\n    DropdownButton.prototype.setButtonLabel = function (label) {\n        if (!this.$button) {\n            return;\n        }\n        $(this.$button).text(label);\n    };\n\n    /**\n     * returns true if the dropdown is open\n     */\n    DropdownButton.prototype.isOpen = function () {\n        if (this.$dropdown) {\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Called for each item when rendering the dropdown.\n     * @param {*} item from items array\n     * @param {number} index in items array\n     * @return {!string|{html:string, enabled:boolean}} Formatted & escaped HTML, either as a simple string\n     *      or as the 'html' field in an object that also conveys enabled state. Disabled items inherit gray\n     *      text color and cannot be selected.\n     */\n    DropdownButton.prototype.itemRenderer = function (item, index) {\n        return _.escape(String(item));\n    };\n\n    /**\n     * Converts the list of item objects into HTML list items in format required by DropdownEventHandler\n     * @private\n     * @param {!jQueryObject} $parent The dropdown element\n     * @return {!jQueryObject} The dropdown element with the rendered list items appended.\n     */\n    DropdownButton.prototype._renderList = function ($parent) {\n        if (!$parent) {\n            return null;\n        }\n\n        const self = this;\n        this.itemsSearchFilterText = [];\n        let html = \"\";\n        this.searchStr = \"\";\n        if (self.enableFilter) {\n            $parent.append(`<li class=\"sticky-li-top forced-hidden\"><a class='stylesheet-link'><i class=\"fa fa-search\" aria-hidden=\"true\"></i>&nbsp;&nbsp;<span class=\"searchTextSpan\"></span></a></li>`);\n        }\n        this.items.forEach(function (item, i) {\n            self.itemsSearchFilterText[i] = \"\";\n            if (item === \"---\") {\n                $parent.append(\"<li class='divider'></li>\");\n            } else {\n                let rendered = self.itemRenderer(item, i),\n                    itemHtml = rendered.html || rendered || \"\",\n                    disabledClass = (rendered.html && !rendered.enabled) ? \"disabled\" : \"\";\n\n                if (rendered.$html) {\n                    const $atag = $(`<a class='stylesheet-link ${disabledClass}' data-index='${i}'></a>`);\n                    $atag.append(rendered.$html);\n                    const $itemHtml = $(`<li data-index='${i}'></li>`).append($atag);\n                    self.itemsSearchFilterText[i] = $itemHtml.text();\n                    $parent.append($itemHtml);\n                } else {\n                    const $itemHtml = $(`<li data-index='${i}'><a class='stylesheet-link ${disabledClass}' data-index='${i}'>${itemHtml}</a></li>`);\n                    self.itemsSearchFilterText[i] = $itemHtml.text();\n                    $parent.append($itemHtml);\n                }\n            }\n        }.bind(this));\n\n        $parent.append(html);\n\n        // Also trigger listRendered handler so that custom event handlers can be\n        // set up for any custom UI in the list.\n        this.trigger(EVENT_LIST_RENDERED, $parent);\n\n        // Also need to re-register mouse event handlers with the updated list.\n        if (this._dropdownEventHandler) {\n            this._dropdownEventHandler.reRegisterMouseHandlers($parent);\n        }\n\n        return $parent;\n    };\n\n    /**\n     * Refresh the dropdown list by removing and re-creating all list items.\n     * Call this after deleting/adding any item in the dropdown list.\n     */\n    DropdownButton.prototype.refresh = function () {\n        if (!this.$dropdown) {\n            return;\n        }\n\n        // Remove all list items and then re-create them from this.items.\n        $(\"li\", this.$dropdown).remove();\n        this._renderList(this.$dropdown);\n        this._reposition();\n    };\n\n    /**\n     * Check/Uncheck the list item of the given index.\n     * @param {number} index The index of the list item to be checked or unchecked\n     * @param {boolean} checked True if the list item is to be checked, false to get check\n     *    mark removed.\n     */\n    DropdownButton.prototype.setChecked = function (index, checked) {\n        if (!this.$dropdown) {\n            return;\n        }\n\n        var listItems = $(\"li\", this.$dropdown),\n            count = listItems.length;\n\n        if (index > -1 && index < count) {\n            $(\"a\", listItems[index]).toggleClass(\"checked\", checked);\n        }\n    };\n\n    DropdownButton.prototype._reposition = function () {\n        const $dropdown = this.$dropdown;\n        // Calculate position of dropdown\n        var toggleOffset = this.$button.offset(),\n            posLeft = toggleOffset.left,\n            posTop = toggleOffset.top + this.$button.outerHeight(),\n            elementRect = {\n                top: posTop,\n                left: posLeft,\n                height: $dropdown.height(),\n                width: $dropdown.width()\n            },\n            clip = ViewUtils.getElementClipSize($(window), elementRect);\n\n        if (clip.bottom > 0) {\n            // Bottom is clipped, so move entire menu above button\n            posTop = Math.max(0, toggleOffset.top - $dropdown.height() - 4);\n        }\n\n        // Take in consideration the scrollbar to prevent unexpected behaviours (see #10963).\n        var dropdownElement = this.$dropdown[0];\n        var scrollWidth = dropdownElement.offsetWidth - dropdownElement.clientWidth + 1;\n\n        if (clip.right > 0) {\n            // Right is clipped, so adjust left to fit menu in editor.\n            posLeft = Math.max(0, posLeft - clip.right - scrollWidth);\n        }\n\n        $dropdown.css({\n            left: posLeft,\n            top: posTop,\n            width: $dropdown.width() + scrollWidth\n        });\n    };\n\n    /**\n     * Pops open the dropdown if currently closed. Does nothing if items.length == 0\n     */\n    DropdownButton.prototype.showDropdown = function () {\n        // Act like a plain old button if no items to show\n        if (!this.items.length) {\n            return;\n        }\n\n        if (this.$dropdown) {\n            return;\n        }\n\n        Menus.closeAll();\n        this.searchStr = \"\";\n        var $dropdown = $(\"<ul class='dropdown-menu dropdownbutton-popup' tabindex='-1'>\")\n            .addClass(this.dropdownExtraClasses)  // (no-op if unspecified)\n            .css(\"min-width\", this.$button.outerWidth());  // do this before the clipping calcs below\n\n        this.$dropdown = $dropdown;\n        this._renderList(this.$dropdown)\n            .appendTo($(\"body\"))\n            .data(\"attached-to\", this.$button[0]);  // keep ModalBar open while dropdown focused\n\n        this._reposition();\n\n        // Attach event handlers\n        this._dropdownEventHandler = new DropdownEventHandler($dropdown, this._onSelect.bind(this),\n            this._onDropdownClose.bind(this), this._onKeyDown.bind(this));\n        this._dropdownEventHandler.open();\n\n        window.document.body.addEventListener(\"mousedown\", this._onClickOutside, true);\n        WorkspaceManager.on(\"workspaceUpdateLayout\", this.closeDropdown);\n\n        // Manage focus\n        this._lastFocus = window.document.activeElement;\n        $dropdown.focus();\n        this.trigger(EVENT_DROPDOWN_SHOWN);\n    };\n\n    /**\n     * @private\n     * Clean up event handlers after dropdown closed & dispose old dropdown DOM. Called regardless of how the dropdown\n     * was closed.\n     */\n    DropdownButton.prototype._onDropdownClose = function () {\n        window.document.body.removeEventListener(\"mousedown\", this._onClickOutside, true);\n        WorkspaceManager.off(\"workspaceUpdateLayout\", this.closeDropdown);\n\n        // Restore focus to old pos, unless \"select\" handler changed it\n        if (window.document.activeElement === this.$dropdown[0]) {\n            this._lastFocus.focus();\n        }\n\n        this._dropdownEventHandler = null;\n        this.$dropdown = null;  // already remvoed from DOM automatically by PopUpManager\n        this.trigger(EVENT_DROPDOWN_CLOSED);\n    };\n\n    /**\n     * hides all elements in popup that doesn't match the given search string, also shows the search bar in popup\n     * @param searchString\n     */\n    DropdownButton.prototype.filterDropdown = function (searchString) {\n        this.searchStr = searchString;\n        const $stickyLi = this.$dropdown.find('li.sticky-li-top');\n        for (let i = 0; i < this.itemsSearchFilterText.length; i++) {\n            const itemText = this.itemsSearchFilterText[i];\n            const $liElementAtIndex = this.$dropdown.find(`li[data-index='${i}']`);\n            let shouldShow = itemText && itemText.toLowerCase().includes(searchString.toLowerCase());\n            if (this.customFilter) {\n                shouldShow = this.customFilter(searchString, itemText, i);\n            }\n            if (shouldShow) {\n                $liElementAtIndex.removeClass('forced-hidden');\n            } else {\n                $liElementAtIndex.addClass('forced-hidden');\n            }\n        }\n        if (searchString) {\n            $stickyLi.removeClass('forced-hidden');\n            $stickyLi.find('.searchTextSpan').text(searchString);\n        } else {\n            $stickyLi.addClass('forced-hidden');\n        }\n    };\n\n    DropdownButton.prototype._onKeyDown = function (event) {\n        if (!this.enableFilter) {\n            return false;\n        }\n        const self = this;\n        if ((event.ctrlKey || event.metaKey) && event.key === 'v') {\n            Phoenix.app.clipboardReadText().then(text => {\n                self.searchStr += text;\n                self.filterDropdown(this.searchStr);\n            });\n            event.stopImmediatePropagation();\n            event.preventDefault();\n            return true;\n        } else if (event.key.length === 1) {\n            this.searchStr += event.key;\n        } else if (event.key === 'Backspace') {\n            // Remove the last character when Backspace is pressed\n            this.searchStr = this.searchStr.slice(0, -1);\n        } else {\n            // bubble up, not for us to handle\n            return false;\n        }\n        this.filterDropdown(this.searchStr);\n        event.stopImmediatePropagation();\n        event.preventDefault();\n        return true;\n    };\n\n    /** Closes the dropdown if currently open */\n    DropdownButton.prototype.closeDropdown = function () {\n        if (this._dropdownEventHandler) {\n            this._dropdownEventHandler.close();\n        }\n    };\n\n    /**\n     * @private\n     * Clicking outside the dropdown closes it\n     */\n    DropdownButton.prototype._onClickOutside = function (event) {\n        var $container = $(event.target).closest(\".dropdownbutton-popup\");\n\n        // If click is outside dropdown list or dropdown button, then close dropdown list\n        if (!$(event.target).is(this.$button) &&\n            ($container.length === 0 || $container[0] !== this.$dropdown[0])) {\n            this.closeDropdown();\n            event.stopPropagation();\n            event.preventDefault();\n        }\n    };\n\n    /** Opens the dropdown if closed; closes it if open */\n    DropdownButton.prototype.toggleDropdown = function () {\n        if (this.$dropdown) {\n            this.closeDropdown();\n        } else {\n            this.showDropdown();\n        }\n    };\n\n    /**\n     * @private\n     * Callback from DropdownEventHandler when item in dropdown list is selected (via mouse or keyboard)\n     * @param {!jQueryObject} $link  The `a` element selected\n     */\n    DropdownButton.prototype._onSelect = function ($link) {\n        var itemIndex = Number($link.data(\"index\"));\n        this.trigger(EVENT_SELECTED, this.items[itemIndex], itemIndex);\n    };\n\n\n    exports.DropdownButton = DropdownButton;\n    // public events\n    exports.EVENT_SELECTED = EVENT_SELECTED;\n    exports.EVENT_LIST_RENDERED = EVENT_LIST_RENDERED;\n    exports.EVENT_DROPDOWN_SHOWN = EVENT_DROPDOWN_SHOWN;\n    exports.EVENT_DROPDOWN_CLOSED = EVENT_DROPDOWN_CLOSED;\n});\n"],"file":"DropdownButton.js"}