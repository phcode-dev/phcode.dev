{"version":3,"sources":["assets/new-project/assets/js/new-project-from-url.js"],"names":["createProjectBtn","locationInput","projectNameInput","createProjectWithNameBtn","urlSearchParams","URLSearchParams","window","location","search","params","Object","fromEntries","entries","PARAM_SUGGESTED_NAME","suggestedName","PARAM_SUGGESTED_TITLE","title","Strings","CMD_PROJECT_NEW","PARAM_SUGGESTED_URL","url","FLATTEN_ZIP_FIRST_LEVEL_DIR","flattenZipFirstLevel","LICENSE","license","LICENSE_URL","licenseURL","CREDITS","credits","CREDITS_URL","creditsURL","PREVIEW_URL","previewURL","BACK_URL","backURL","projectLocation","projectName","_computeProjectPath","$","is","value","async","_validateProjectLocation","isLocationValid","newProjectExtension","alreadyExists","removeClass","addClass","_validateSuggestedName","_validateAll","locIsValid","nameIsValid","document","getElementById","disabled","_selectFolder","showFolderSelect","then","file","endsWith","parent","Phoenix","app","getDisplayPath","_createProjectClicked","projectPath","VFS","ensureExistsDirAsync","downloadAndOpenProject","Metrics","countEvent","EVENT_TYPE","NEW_PROJECT","closeDialogue","showErrorDialogue","MISSING_FIELDS","PLEASE_FILL_ALL_REQUIRED","_showLicensingInfo","el","textContent","click","evt","brackets","openURLInDefaultBrowser","preventDefault","stopPropagation","_showPreview","src","_setupNavigation","href","initNewProjectFromURL","isNativeApp","getLocalProjectsPath","showDirectoryPicker","onclick","keyup","PLEASE_SELECT_A_FOLDER"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global newProjectExtension, Strings, Metrics*/\n/*eslint no-console: 0*/\n/*eslint strict: [\"error\", \"global\"]*/\n/* jshint ignore:start */\n\nlet createProjectBtn, locationInput, projectNameInput, createProjectWithNameBtn;\n\nconst urlSearchParams = new URLSearchParams(window.location.search);\nconst params = Object.fromEntries(urlSearchParams.entries());\nconst PARAM_SUGGESTED_NAME = params.suggestedName || \"project\";\nconst PARAM_SUGGESTED_TITLE = params.title || Strings.CMD_PROJECT_NEW;\nconst PARAM_SUGGESTED_URL = params.url;\nconst FLATTEN_ZIP_FIRST_LEVEL_DIR = (params.flattenZipFirstLevel ==='true');\nconst LICENSE = params.license;\nconst LICENSE_URL = params.licenseURL;\nconst CREDITS = params.credits;\nconst CREDITS_URL = params.creditsURL;\nconst PREVIEW_URL = params.previewURL;\nconst BACK_URL = params.backURL;\nlet projectLocation = null, projectName = null;\n\nfunction _computeProjectPath() {\n    if($(projectNameInput).is(\":visible\")){\n        let suggestedName = projectNameInput.value;\n        if(suggestedName && projectLocation){\n            return projectLocation+suggestedName;\n        }\n        return null;\n    }\n    return projectLocation;\n}\n\nasync function _validateProjectLocation() {\n    if($(locationInput).is(\":visible\")){\n        // this is desktop or browsers with fs access api\n        let isLocationValid = projectLocation &&\n            await newProjectExtension.alreadyExists(projectLocation);\n        if(isLocationValid){\n            $(locationInput).removeClass(\"error-border\");\n            return true;\n        }\n        $(locationInput).addClass(\"error-border\");\n        return false;\n    }\n    // location input is hidden only in browsers with no fs access API. If its hidden,\n    // we dont need to validate location, as _validateSuggestedName will be in effect\n    return true;\n}\n\nasync function _validateSuggestedName() {\n    if($(projectNameInput).is(\":visible\")){\n        // the project name input is only visible in desktop and browsers with no fs access api.\n        let suggestedName = projectNameInput.value;\n        if(!suggestedName || !projectLocation ||\n            await newProjectExtension.alreadyExists(projectLocation+suggestedName)){\n            $(projectNameInput).addClass(\"error-border\");\n            return false;\n        }\n        $(projectNameInput).removeClass(\"error-border\");\n    }\n    return true;\n}\n\nasync function _validateAll() {\n    const locIsValid = await _validateProjectLocation();\n    const nameIsValid = await _validateSuggestedName();\n    document.getElementById('createProjectBtn').disabled = !(locIsValid && nameIsValid);\n    document.getElementById('createProjectWithNameBtn').disabled = !(locIsValid && nameIsValid);\n    return locIsValid && nameIsValid;\n}\n\nfunction _selectFolder() {\n    newProjectExtension.showFolderSelect()\n        .then(file =>{\n            projectLocation = file;\n            if(!projectLocation.endsWith(\"/\")){\n                projectLocation = projectLocation + \"/\";\n            }\n            locationInput.value = window.parent.Phoenix.app.getDisplayPath(file);\n            _validateAll();\n        });\n}\n\nasync function _createProjectClicked() {\n    const projectPath = _computeProjectPath();\n    if(!projectPath){\n        newProjectExtension.showErrorDialogue(\n            Strings.MISSING_FIELDS,\n            Strings.PLEASE_FILL_ALL_REQUIRED);\n        return;\n    }\n    await window.parent.Phoenix.VFS.ensureExistsDirAsync(projectPath);\n    newProjectExtension.downloadAndOpenProject(\n        PARAM_SUGGESTED_URL,\n        projectPath, PARAM_SUGGESTED_NAME, FLATTEN_ZIP_FIRST_LEVEL_DIR)\n        .then(()=>{\n            Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT, \"createProject.Click\", \"create.success\");\n            newProjectExtension.closeDialogue();\n        });\n    Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT, \"createProject.Click\", \"create\");\n}\n\nfunction _showLicensingInfo() {\n    if(LICENSE || LICENSE_URL || CREDITS || CREDITS_URL){\n        $(document.getElementById(\"License\")).removeClass(\"forced-hidden\");\n    }\n    if(LICENSE || LICENSE_URL){\n        let el = document.getElementById(\"licenseLink\");\n        el.textContent = LICENSE || LICENSE_URL;\n        if(LICENSE_URL){\n            $(el).click((evt)=>{\n                window.parent.brackets.app.openURLInDefaultBrowser(LICENSE_URL);\n                evt.preventDefault();\n                evt.stopPropagation();\n            });\n        }\n    }\n    if(CREDITS || CREDITS_URL){\n        let el = document.getElementById(\"creditsLink\");\n        el.textContent = CREDITS || CREDITS_URL;\n        if(CREDITS_URL){\n            $(el).click((evt)=>{\n                window.parent.brackets.app.openURLInDefaultBrowser(CREDITS_URL);\n                evt.preventDefault();\n                evt.stopPropagation();\n            });\n        }\n    }\n}\n\nfunction _showPreview() {\n    if(!PREVIEW_URL){\n        return;\n    }\n    $(document.getElementById(\"previewBox\")).removeClass(\"forced-hidden\");\n    document.getElementById(\"bigFrame\").src = PREVIEW_URL;\n    document.getElementById(\"littleFrame\").src = PREVIEW_URL;\n}\n\nfunction _setupNavigation() {\n    if(BACK_URL){\n        document.getElementById(\"backButton\").href = BACK_URL;\n    }\n}\n\nfunction initNewProjectFromURL() {\n    _setupNavigation();\n    if(window.parent.Phoenix.isNativeApp){ // desktop builds\n        projectLocation = newProjectExtension.getLocalProjectsPath();\n        projectName = PARAM_SUGGESTED_NAME;\n        $(document.getElementById(\"createProjectBtn\")).addClass(\"forced-inVisible\");\n    } else if(window.showDirectoryPicker){ // fs access apis- chrome/opera etc..\n        $(document.getElementById(\"projectName\")).addClass(\"forced-hidden\");\n    } else {\n        projectName = PARAM_SUGGESTED_NAME;\n        projectLocation = newProjectExtension.getLocalProjectsPath();\n        $(document.getElementById(\"projectLocation\")).addClass(\"forced-hidden\");\n    }\n    document.getElementById(\"titleNewProject\").textContent = PARAM_SUGGESTED_TITLE;\n    projectNameInput = document.getElementById(\"projectNameInput\");\n    locationInput = document.getElementById(\"locationInput\");\n    createProjectBtn = document.getElementById(\"createProjectBtn\");\n    createProjectWithNameBtn = document.getElementById(\"createProjectWithNameBtn\");\n    createProjectBtn.onclick = _createProjectClicked;\n    createProjectWithNameBtn.onclick = _createProjectClicked;\n    $(projectNameInput).keyup(_validateAll);\n    locationInput.value = Strings.PLEASE_SELECT_A_FOLDER;\n    projectNameInput.value = projectName;\n    locationInput.onclick = _selectFolder;\n    if(projectLocation){\n        locationInput.value = window.parent.Phoenix.app.getDisplayPath(projectLocation);\n    }\n    _showLicensingInfo();\n    _showPreview();\n    _validateAll();\n}\n"],"file":"new-project-from-url.js"}