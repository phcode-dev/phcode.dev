{"version":3,"sources":["extensions/default/PrefsCodeHints/main.js"],"names":["define","require","exports","module","AppInit","brackets","getModule","CodeHintManager","PreferencesManager","StringMatch","ExtensionUtils","EditorManager","LanguageManager","JSONUtils","Strings","ThemeManager","CodeInspection","_","ProjectManager","languages","getLanguages","isPrefDocument","isPrefHintsEnabled","data","language","type","description","DESCRIPTION_LANGUAGE","path","DESCRIPTION_PATH","stringMatcherOptions","preferPrefixMatches","parentKeyBlacklist","_isPrefHintsEnabled","get","_isPrefDocument","document","test","file","_name","formatHints","hints","query","hasMetadata","some","token","basicMatchSort","map","$hintItem","$","addClass","$hintObj","stringRanges","forEach","item","matched","append","text","value","PrefsCodeHints","this","ctxInfo","preferences","getAllPreferences","preference","Object","keys","pref","excludeFromHints","extend","clone","definePreference","DESCRIPTION_PREF_HINTS","on","e","editor","prototype","hasHints","implicitChar","getModeForSelection","getContextInfo","getCursorPos","tokenType","TOKEN_KEY","indexOf","parentKeyName","getHints","values","option","stripQuotes","string","substr","offset","trim","regexAllowedChars","key","exclusionList","match","stringMatch","TOKEN_VALUE","keyName","isArray","getProviderIDsForLanguage","getAllThemes","theme","name","valueType","val","toString","selectInitial","handleWideResults","insertHint","completion","pos","start","line","ch","end","startChar","quoteChar","jquery","find","charAt","shouldReplace","replaceRange","setCursorPos","length","ERROR_MESSAGE","errors","message","ERROR_PREFS_PROJECT_LINT_MESSAGE","Type","ERROR","PHOENIX_PREF_FILE","SETTINGS_FILENAME","BRACKETS_PREF_FILE","SETTINGS_FILENAME_BRACKETS","async","_hasConflictingPrefFiles","root","getProjectRoot","bracketsExists","Phoenix","VFS","existsAsync","fullPath","phoenixExists","lintOneFile","Promise","resolve","fileName","replace","then","isConflicting","undefined","_setupTestEnvironment","testDocument","testPreferences","appReady","hintProvider","registerHintProvider","loadStyleSheet","isSpecRunnerWindow","register","ERROR_PREFS_PROJECT_LINT","scanFileAsync"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2015 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\ndefine(function (require, exports, module) {\n\n\n    // Load dependencies.\n    var AppInit             = brackets.getModule(\"utils/AppInit\"),\n        CodeHintManager     = brackets.getModule(\"editor/CodeHintManager\"),\n        PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        StringMatch         = brackets.getModule(\"utils/StringMatch\"),\n        ExtensionUtils      = brackets.getModule(\"utils/ExtensionUtils\"),\n        EditorManager       = brackets.getModule(\"editor/EditorManager\"),\n        LanguageManager     = brackets.getModule(\"language/LanguageManager\"),\n        JSONUtils           = brackets.getModule(\"language/JSONUtils\"),\n        Strings             = brackets.getModule(\"strings\"),\n        ThemeManager        = brackets.getModule(\"view/ThemeManager\"),\n        CodeInspection      = brackets.getModule(\"language/CodeInspection\"),\n        _                   = brackets.getModule(\"thirdparty/lodash\"),\n        ProjectManager      = brackets.getModule(\"project/ProjectManager\"),\n        languages           = LanguageManager.getLanguages(),\n        isPrefDocument      = false,\n        isPrefHintsEnabled  = false;\n\n    // Stores data of preferences used by Brackets and its core/thirdparty extensions.\n    var data = {\n        language: {\n            type: \"object\",\n            description: Strings.DESCRIPTION_LANGUAGE\n        },\n        path: {\n            type: \"object\",\n            description: Strings.DESCRIPTION_PATH\n        }\n    };\n\n    var stringMatcherOptions = {\n        preferPrefixMatches: true\n    };\n\n    // List of parent keys for which no key hints will be provided.\n    var parentKeyBlacklist = [\n        \"language.fileExtensions\",\n        \"language.fileNames\",\n        \"path\"\n    ];\n\n    // Define a preference for code hinting.\n    PreferencesManager.definePreference(\"codehint.PrefHints\", \"boolean\", true, {\n        description: Strings.DESCRIPTION_PREF_HINTS\n    });\n\n    /**\n     * @private\n     *\n     * Determines whether or not the current document is a preferences document and\n     * user has enabled code hints\n     *\n     * @return {Boolean}\n     */\n    function _isPrefHintsEnabled() {\n        return (isPrefDocument &&\n                PreferencesManager.get(\"showCodeHints\") !== false &&\n                PreferencesManager.get(\"codehint.PrefHints\") !== false);\n    }\n\n    /**\n     * @private\n     *\n     * Determines whether or not the name of a file matches the preferences files\n     *\n     * @param {!Document} document\n     * @return {Boolean}\n     */\n    function _isPrefDocument(document) {\n        return (/^\\.?brackets\\.json$/).test(document.file._name) || (/^\\.?phcode\\.json$/).test(document.file._name);\n    }\n\n    // Set listeners on preference, editor and language changes.\n    PreferencesManager.on(\"change\", \"showCodeHints\", function () {\n        isPrefHintsEnabled = _isPrefHintsEnabled();\n    });\n    PreferencesManager.on(\"change\", \"codehint.PrefHints\", function () {\n        isPrefHintsEnabled = _isPrefHintsEnabled();\n    });\n    EditorManager.on(\"activeEditorChange\", function (e, editor) {\n        if (editor) {\n            isPrefDocument = _isPrefDocument(editor.document);\n        }\n        isPrefHintsEnabled = _isPrefHintsEnabled();\n    });\n    LanguageManager.on(\"languageAdded\", function () {\n        languages = LanguageManager.getLanguages();\n    });\n\n    /*\n     * Returns a sorted and formatted list of hints with the query substring\n     * highlighted.\n     *\n     * @param {Array.<Object>} hints - the list of hints to format\n     * @param {string} query - querystring used for highlighting matched\n     *      portions of each hint\n     * @return {Array.jQuery} sorted Array of jQuery DOM elements to insert\n     */\n    function formatHints(hints, query) {\n\n        var hasMetadata = hints.some(function (token) {\n            return token.type || token.description;\n        });\n\n        StringMatch.basicMatchSort(hints);\n        return hints.map(function (token) {\n            var $hintItem = $(\"<span>\").addClass(\"brackets-pref-hints brackets-hints\"),\n                $hintObj  = $(\"<span>\").addClass(\"hint-obj\");\n\n            // highlight the matched portion of each hint\n            if (token.stringRanges) {\n                token.stringRanges.forEach(function (item) {\n                    if (item.matched) {\n                        $hintObj.append($(\"<span>\")\n                            .text(item.text)\n                            .addClass(\"matched-hint\"));\n                    } else {\n                        $hintObj.append(item.text);\n                    }\n                });\n            } else {\n                $hintObj.text(token.value);\n            }\n\n            $hintItem.append($hintObj);\n\n            if (hasMetadata) {\n                $hintItem.data(\"type\", token.type);\n                if (token.description) {\n                    $hintItem.append($(\"<span>\")\n                                        .addClass(\"hint-description\")\n                                        .text(token.description));\n                }\n            }\n            return $hintItem;\n        });\n    }\n\n    /**\n     * @constructor\n     */\n    function PrefsCodeHints() {\n        this.ctxInfo = null;\n\n        // Add all the preferences defined except the excluded ones.\n        var preferences = PreferencesManager.getAllPreferences(),\n            preference;\n        Object.keys(preferences).forEach(function (pref) {\n            preference = preferences[pref];\n            if (preference.excludeFromHints) {\n                return;\n            }\n            data[pref] = $.extend(data[pref], preference);\n\n            // If child keys found, add them.\n            if (preference.keys) {\n                data[pref].keys = _.clone(preference.keys);\n            }\n        });\n    }\n\n    /**\n     * Determines whether or not hints are available in the current context\n     *\n     * @param {!Editor} editor\n     * @param {String} implicitChar\n     * @return {Boolean}\n     */\n    PrefsCodeHints.prototype.hasHints = function (editor, implicitChar) {\n        if (isPrefHintsEnabled && editor.getModeForSelection() === \"application/json\") {\n            this.editor = editor;\n            this.ctxInfo = JSONUtils.getContextInfo(this.editor, this.editor.getCursorPos(), true);\n\n            if (this.ctxInfo && this.ctxInfo.tokenType) {\n                // Disallow hints for blacklisted keys.\n                if (this.ctxInfo.tokenType === JSONUtils.TOKEN_KEY &&\n                        parentKeyBlacklist.indexOf(this.ctxInfo.parentKeyName) !== -1) {\n                    return false;\n                }\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Returns a list of hints available in the current context\n     *\n     * @param {String} implicitChar\n     * @return {!{hints: Array.<jQueryObject>, match: string, selectInitial: boolean, handleWideResults: boolean}}\n     */\n    PrefsCodeHints.prototype.getHints = function (implicitChar) {\n        var hints = [], ctxInfo, query, keys, values, option = {type: null, description: null, values: null};\n\n        ctxInfo = this.ctxInfo = JSONUtils.getContextInfo(this.editor, this.editor.getCursorPos(), true);\n\n        if (ctxInfo && ctxInfo.token) {\n            query = JSONUtils.stripQuotes(ctxInfo.token.string.substr(0, ctxInfo.offset)).trim();\n            if (JSONUtils.regexAllowedChars.test(query)) {\n                query = \"\";\n            }\n\n            if (ctxInfo.tokenType === JSONUtils.TOKEN_KEY) {\n                // Provide hints for keys\n\n                // Get options for parent key else use general options.\n                if (data[ctxInfo.parentKeyName] && data[ctxInfo.parentKeyName].keys) {\n                    keys = data[ctxInfo.parentKeyName].keys;\n                } else if (ctxInfo.parentKeyName === \"language\") {\n                    keys = languages;\n                    option.type = \"object\";\n                } else {\n                    keys = data;\n                }\n\n                hints = $.map(Object.keys(keys), function (key) {\n                    if (ctxInfo.exclusionList.indexOf(key) === -1) {\n                        var match = StringMatch.stringMatch(key, query, stringMatcherOptions);\n                        if (match) {\n                            match.type = keys[key].type || option.type;\n                            match.description = keys[key].description || null;\n                            return match;\n                        }\n                    }\n                });\n            } else if (ctxInfo.tokenType === JSONUtils.TOKEN_VALUE) {\n                // Provide hints for values.\n\n                // Get the key from data.\n                if (data[ctxInfo.parentKeyName] && data[ctxInfo.parentKeyName].keys &&\n                        data[ctxInfo.parentKeyName].keys[ctxInfo.keyName]) {\n                    option = data[ctxInfo.parentKeyName].keys[ctxInfo.keyName];\n                } else if (data[ctxInfo.keyName]) {\n                    option = data[ctxInfo.keyName];\n                }\n\n                // Get the values depending on the selected key.\n                if (option && option.type === \"boolean\") {\n                    values = [\"false\", \"true\"];\n                } else if (option && option.values && ([\"number\", \"string\"].indexOf(option.type) !== -1 ||\n                                                       (option.type === \"array\" && ctxInfo.isArray))) {\n                    values = option.values;\n                } else if (ctxInfo.isArray && ctxInfo.keyName === \"linting.prefer\" && languages[ctxInfo.parentKeyName]) {\n                    values = CodeInspection.getProviderIDsForLanguage(ctxInfo.parentKeyName);\n                } else if (ctxInfo.keyName === \"themes.theme\") {\n                    values = ThemeManager.getAllThemes().map(function (theme) {\n                        return theme.name;\n                    });\n                } else if (ctxInfo.parentKeyName === \"language.fileExtensions\" ||\n                           ctxInfo.parentKeyName === \"language.fileNames\") {\n                    values = Object.keys(languages);\n                } else {\n                    return null;\n                }\n\n                // Convert integers to strings, so StringMatch.stringMatch can match it.\n                if (option.type === \"number\" || option.valueType === \"number\") {\n                    values = values.map(function (val) {\n                        return val.toString();\n                    });\n                }\n\n                // filter through the values.\n                hints = $.map(values, function (value) {\n                    var match = StringMatch.stringMatch(value, query, stringMatcherOptions);\n                    if (match) {\n                        match.type = option.valueType || option.type;\n                        match.description = option.description || null;\n                        return match;\n                    }\n                });\n            }\n\n            return {\n                hints: formatHints(hints, query),\n                match: null,\n                selectInitial: true,\n                handleWideResults: false\n            };\n        }\n        return null;\n    };\n\n    /**\n     * Inserts a completion at current position\n     *\n     * @param {!String} completion\n     * @return {Boolean}\n     */\n    PrefsCodeHints.prototype.insertHint = function (completion) {\n        var ctxInfo = JSONUtils.getContextInfo(this.editor, this.editor.getCursorPos(), false, true),\n            pos     = this.editor.getCursorPos(),\n            start   = {line: -1, ch: -1},\n            end     = {line: -1, ch: -1},\n            startChar,\n            quoteChar,\n            type;\n\n        if (completion.jquery) {\n            type = completion.data(\"type\");\n            completion = completion.find(\".hint-obj\").text();\n        }\n        start.line = end.line = pos.line;\n\n        if (ctxInfo.tokenType === JSONUtils.TOKEN_KEY) {\n            startChar = ctxInfo.token.string.charAt(0);\n\n            // Get the quote char.\n            if (/^['\"]$/.test(startChar)) {\n                quoteChar = startChar;\n            }\n\n            // Put quotes around completion.\n            completion = quoteChar + completion + quoteChar;\n\n            // Append colon and braces, brackets and quotes.\n            if (!ctxInfo.shouldReplace) {\n                completion += \": \";\n\n                switch (type) {\n                case \"object\":\n                    completion += \"{}\";\n                    break;\n\n                case \"array\":\n                    completion += \"[]\";\n                    break;\n\n                case \"string\":\n                    completion += \"\\\"\\\"\";\n                    break;\n                }\n            }\n\n            start.ch = pos.ch - ctxInfo.offset;\n            end.ch = ctxInfo.token.end;\n            this.editor.document.replaceRange(completion, start, end);\n\n            // Place cursor inside the braces, brackets or quotes.\n            if ([\"object\", \"array\", \"string\"].indexOf(type) !== -1) {\n                this.editor.setCursorPos(start.line, start.ch + completion.length - 1);\n\n                // Start a new session in case it is an array or string.\n                if (type !== \"object\" && !ctxInfo.shouldReplace) {\n                    return true;\n                }\n                return false;\n            }\n            return true;\n        } else if (ctxInfo.tokenType === JSONUtils.TOKEN_VALUE) {\n            // In case the current token is a white-space, start and end will be same.\n            if (JSONUtils.regexAllowedChars.test(ctxInfo.token.string)) {\n                start.ch = end.ch = pos.ch;\n            } else if (ctxInfo.shouldReplace) {\n                start.ch = ctxInfo.token.start;\n                end.ch = ctxInfo.token.end;\n            } else {\n                start.ch = pos.ch - ctxInfo.offset;\n                end.ch = ctxInfo.token.end;\n            }\n\n            if (!type || type === \"string\") {\n                startChar = ctxInfo.token.string.charAt(0);\n                if (/^['\"]$/.test(startChar)) {\n                    quoteChar = startChar;\n                } else {\n                    quoteChar = \"\\\"\";\n                }\n                completion = quoteChar + completion + quoteChar;\n            }\n\n            this.editor.document.replaceRange(completion, start, end);\n            return false;\n        }\n    };\n\n    const ERROR_MESSAGE = { errors: [{\n        // JSLint returns 1-based line/col numbers\n        pos: { line: 0, ch: 0 },\n        message: Strings.ERROR_PREFS_PROJECT_LINT_MESSAGE,\n        type: CodeInspection.Type.ERROR\n    }]};\n\n    const PHOENIX_PREF_FILE = \".\"+PreferencesManager.SETTINGS_FILENAME;\n    const BRACKETS_PREF_FILE = \".\"+PreferencesManager.SETTINGS_FILENAME_BRACKETS;\n\n    async function _hasConflictingPrefFiles() {\n        const root = ProjectManager.getProjectRoot();\n        let bracketsExists = await Phoenix.VFS.existsAsync(root.fullPath+PHOENIX_PREF_FILE);\n        let phoenixExists = await Phoenix.VFS.existsAsync(root.fullPath+BRACKETS_PREF_FILE);\n        if(phoenixExists && bracketsExists) {\n            return true;\n        }\n    }\n\n    function lintOneFile(text, fullPath) {\n        return new Promise((resolve)=>{\n            const root = ProjectManager.getProjectRoot();\n            const fileName = fullPath.replace(root.fullPath, \"\");\n            if(!(fileName === PHOENIX_PREF_FILE || fileName === BRACKETS_PREF_FILE)){\n                resolve();\n                return;\n            }\n            _hasConflictingPrefFiles()\n                .then(isConflicting=>{\n                    resolve(isConflicting?ERROR_MESSAGE:undefined);\n                });\n        });\n    }\n\n    /**\n     * @private\n     *\n     * `isPrefHintsEnabled` must be set to true to allow code hints\n     *\n     * It also loads a set of preferences that we need for running unit tests, this\n     * will not break unit tests in case we add new preferences in the future.\n     *\n     * @param {!Document} testDocument\n     * @param {!Object} testPreferences\n     */\n    function _setupTestEnvironment(testDocument, testPreferences) {\n        isPrefHintsEnabled = _isPrefDocument(testDocument);\n        data = testPreferences;\n    }\n\n    AppInit.appReady(function () {\n        var hintProvider = new PrefsCodeHints();\n        CodeHintManager.registerHintProvider(hintProvider, [\"json\"], 0);\n        ExtensionUtils.loadStyleSheet(module, \"styles/brackets-prefs-hints.css\");\n        if(!Phoenix.isSpecRunnerWindow){\n            CodeInspection.register(\"json\", {\n                name: Strings.ERROR_PREFS_PROJECT_LINT,\n                scanFileAsync: lintOneFile\n            });\n        }\n\n        // For unit tests only.\n        exports.hintProvider            = hintProvider;\n        exports._setupTestEnvironment   = _setupTestEnvironment;\n    });\n\n});\n"],"file":"main.js"}