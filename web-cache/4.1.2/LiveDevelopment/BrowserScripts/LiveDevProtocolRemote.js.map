{"version":3,"sources":["LiveDevelopment/BrowserScripts/LiveDevProtocolRemote.js"],"names":["global","transport","_Brackets_LiveDev_Transport","MessageBroker","handlers","trigger","msg","msgHandlers","method","this","length","forEach","handler","e","console","error","stack","warn","respond","orig","response","id","send","on","push","msgStr","JSON","stringify","_Brackets_MessageBroker","Runtime","evaluate","result","eval","params","expression","CSS","setStylesheetText","text","url","i","node","head","window","document","getElementsByTagName","s","createElement","type","appendChild","createTextNode","styleSheets","ownerNode","insertBefore","parentNode","removeChild","href","disabled","getStylesheetText","sheet","textContent","j","rules","cssRules","name","cssText","Page","reload","location","ignoreCache","close","ProtocolManager","_documentObserver","_protocolHandler","enable","setCallbacks","onConnect","start","onClose","body","overlay","background","status","style","width","height","zIndex","position","top","left","backgroundColor","opacity","color","padding","verticalAlign","textAlign","title","setDocumentObserver","documentOberver","setProtocolHandler","protocolHandler","_Brackets_LiveDev_ProtocolManager","ProtocolHandler","message","parse","evt","connect","addEventListener","onDocumentClick","ctrlKey","metaKey","key","toLowerCase","livePreviewEditEnabled","undoLivePreviewOperation","redoLivePreviewOperation","_getAllInheritedSelectorsInOrder","element","selectorsFound","Map","selectorsList","classList","cls","get","set","parentElement","event","selection","getSelection","target","hasAttribute","detail","includes","tagName","toString","tagId","getAttribute","nodeID","nodeClassList","nodeName","allSelectors","contentEditable","clicked","_LD","DOMEditHandler","startEditing","edit","preventDefault","stopPropagation"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2014 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*jslint evil: true */\n\n// This is the script that Brackets live development injects into HTML pages in order to\n// establish and maintain the live development socket connection. Note that Brackets may\n// also inject other scripts via \"evaluate\" once this has connected back to Brackets.\n\n(function (global) {\n\n\n    // This protocol handler assumes that there is also an injected transport script that\n    // has the following methods:\n    //     setCallbacks(obj) - a method that takes an object with a \"message\" callback that\n    //         will be called with the message string whenever a message is received by the transport.\n    //     send(msgStr) - sends the given message string over the transport.\n    var transport = global._Brackets_LiveDev_Transport;\n\n    /**\n     * Manage messaging between Editor and Browser at the protocol layer.\n     * Handle messages that arrives through the current transport and dispatch them\n     * to subscribers. Subscribers are handlers that implements remote commands/functions.\n     * Property 'method' of messages body is used as the 'key' to identify message types.\n     * Provide a 'send' operation that allows remote commands sending messages to the Editor.\n     */\n    var MessageBroker = {\n\n        /**\n         * Collection of handlers (subscribers) per each method.\n         * To be pushed by 'on' and consumed by 'trigger' stored this way:\n         *      handlers[method] = [handler1, handler2, ...]\n         */\n        handlers: {},\n\n         /**\n          * Dispatch messages to handlers according to msg.method value.\n          * @param {Object} msg Message to be dispatched.\n          */\n        trigger: function (msg) {\n            var msgHandlers;\n            if (!msg.method) {\n                // no message type, ignoring it\n                // TODO: should we trigger a generic event?\n                console.error(\"[Brackets LiveDev] Received message without method.\");\n                return;\n            }\n            // get handlers for msg.method\n            msgHandlers = this.handlers[msg.method];\n\n            if (msgHandlers && msgHandlers.length > 0) {\n                // invoke handlers with the received message\n                msgHandlers.forEach(function (handler) {\n                    try {\n                        // TODO: check which context should be used to call handlers here.\n                        handler(msg);\n                        return;\n                    } catch (e) {\n                        console.error(\"[Brackets LiveDev] Error executing a handler for \" + msg.method, e.stack);\n                        return;\n                    }\n                });\n            } else {\n                // no subscribers, ignore it.\n                // TODO: any other default handling? (eg. specific respond, trigger as a generic event, etc.);\n                console.warn(\"[Brackets LiveDev] No subscribers for message \" + msg.method);\n                return;\n            }\n        },\n\n        /**\n         * Send a response of a particular message to the Editor.\n         * Original message must provide an 'id' property\n         * @param {Object} orig Original message.\n         * @param {Object} response Message to be sent as the response.\n         */\n        respond: function (orig, response) {\n            if (!orig.id) {\n                console.error(\"[Brackets LiveDev] Trying to send a response for a message with no ID\");\n                return;\n            }\n            response.id = orig.id;\n            this.send(response);\n        },\n\n        /**\n         * Subscribe handlers to specific messages.\n         * @param {string} method Message type.\n         * @param {function} handler.\n         * TODO: add handler name or any identification mechanism to then implement 'off'?\n         */\n        on: function (method, handler) {\n            if (!method || !handler) {\n                return;\n            }\n            if (!this.handlers[method]) {\n                //initialize array\n                this.handlers[method] = [];\n            }\n            // add handler to the stack\n            this.handlers[method].push(handler);\n        },\n\n        /**\n         * Send a message to the Editor.\n         * @param {string} msgStr Message to be sent.\n         */\n        send: function (msgStr) {\n            transport.send(JSON.stringify(msgStr));\n        }\n    };\n\n    global._Brackets_MessageBroker = MessageBroker;\n\n    /**\n     * Runtime Domain. Implements remote commands for \"Runtime.*\"\n     */\n    var Runtime = {\n        /**\n         * Evaluate an expresion and return its result.\n         */\n        evaluate: function (msg) {\n            var result = eval(msg.params.expression);\n            MessageBroker.respond(msg, {\n                result: JSON.stringify(result) // TODO: in original protocol this is an object handle\n            });\n        }\n    };\n\n    // subscribe handler to method Runtime.evaluate\n    MessageBroker.on(\"Runtime.evaluate\", Runtime.evaluate);\n\n    /**\n     * CSS Domain.\n     */\n    var CSS = {\n\n        setStylesheetText : function (msg) {\n\n            if (!msg || !msg.params || !msg.params.text || !msg.params.url) {\n                return;\n            }\n\n            var i,\n                node;\n\n            var head = window.document.getElementsByTagName('head')[0];\n            // create an style element to replace the one loaded with <link>\n            var s = window.document.createElement('style');\n            s.type = 'text/css';\n            s.appendChild(window.document.createTextNode(msg.params.text));\n\n            for (i = 0; i < window.document.styleSheets.length; i++) {\n                node = window.document.styleSheets[i];\n                if (node.ownerNode.id === msg.params.url) {\n                    head.insertBefore(s, node.ownerNode); // insert the style element here\n                    // now can remove the style element previously created (if any)\n                    node.ownerNode.parentNode.removeChild(node.ownerNode);\n                } else if (node.href === msg.params.url  && !node.disabled) {\n                    // if the link element to change\n                    head.insertBefore(s, node.ownerNode); // insert the style element here\n                    node.disabled = true;\n                    i++; // since we have just inserted a stylesheet\n                }\n            }\n            s.id = msg.params.url;\n        },\n\n        /**\n        * retrieves the content of the stylesheet\n        * TODO: it now depends on reloadCSS implementation\n        */\n        getStylesheetText: function (msg) {\n            var i,\n                sheet,\n                text = \"\";\n            for (i = 0; i < window.document.styleSheets.length; i++) {\n                sheet = window.document.styleSheets[i];\n                // if it was already 'reloaded'\n                if (sheet.ownerNode.id ===  msg.params.url) {\n                    text = sheet.ownerNode.textContent;\n                } else if (sheet.href === msg.params.url && !sheet.disabled) {\n                    var j,\n                        rules;\n\n                    // Deal with Firefox's SecurityError when accessing sheets\n                    // from other domains, and Chrome returning `undefined`.\n                    try {\n                        rules = window.document.styleSheets[i].cssRules;\n                    } catch (e) {\n                        if (e.name !== \"SecurityError\") {\n                            throw e;\n                        }\n                    }\n                    if (!rules) {\n                        return;\n                    }\n\n                    for (j = 0; j < rules.length; j++) {\n                        text += rules[j].cssText + '\\n';\n                    }\n                }\n            }\n\n            MessageBroker.respond(msg, {\n                text: text\n            });\n        }\n    };\n\n    MessageBroker.on(\"CSS.setStylesheetText\", CSS.setStylesheetText);\n    MessageBroker.on(\"CSS.getStylesheetText\", CSS.getStylesheetText);\n\n    /**\n     * Page Domain.\n     */\n    var Page = {\n        /**\n         * Reload the current page optionally ignoring cache.\n         * @param {Object} msg\n         */\n        reload: function (msg) {\n            // just reload the page\n            window.location.reload(msg.params.ignoreCache);\n        }\n    };\n\n    // subscribe handler to method Page.reload\n    MessageBroker.on(\"Page.reload\", Page.reload);\n    MessageBroker.on(\"ConnectionClose\", Page.close);\n\n\n\n    // By the time this executes, there must already be an active transport.\n    if (!transport) {\n        console.error(\"[Brackets LiveDev] No transport set\");\n        return;\n    }\n\n    var ProtocolManager = {\n\n        _documentObserver: {},\n\n        _protocolHandler: {},\n\n        enable: function () {\n            transport.setCallbacks(this._protocolHandler);\n            transport.enable();\n        },\n\n        onConnect: function () {\n            this._documentObserver.start(window.document, transport);\n        },\n\n        onClose: function () {\n            var body = window.document.getElementsByTagName(\"body\")[0],\n                overlay = window.document.createElement(\"div\"),\n                background = window.document.createElement(\"div\"),\n                status = window.document.createElement(\"div\");\n\n            overlay.style.width = \"100%\";\n            overlay.style.height = \"100%\";\n            overlay.style.zIndex = 2227;\n            overlay.style.position = \"fixed\";\n            overlay.style.top = 0;\n            overlay.style.left = 0;\n\n            background.style.backgroundColor = \"#fff\";\n            background.style.opacity = 0.5;\n            background.style.width = \"100%\";\n            background.style.height = \"100%\";\n            background.style.position = \"fixed\";\n            background.style.top = 0;\n            background.style.left = 0;\n\n            status.textContent = \"Live Development Session has Ended\";\n            status.style.width = \"100%\";\n            status.style.color = \"#fff\";\n            status.style.backgroundColor = \"#666\";\n            status.style.position = \"fixed\";\n            status.style.top = 0;\n            status.style.left = 0;\n            status.style.padding = \"0.2em\";\n            status.style.verticalAlign = \"top\";\n            status.style.textAlign = \"center\";\n            overlay.appendChild(background);\n            overlay.appendChild(status);\n            body.appendChild(overlay);\n\n            // change the title as well\n            window.document.title = \"(Brackets Live Preview: closed) \" + window.document.title;\n        },\n\n        setDocumentObserver: function (documentOberver) {\n            if (!documentOberver) {\n                return;\n            }\n            this._documentObserver = documentOberver;\n        },\n\n        setProtocolHandler: function (protocolHandler) {\n            if (!protocolHandler) {\n                return;\n            }\n            this._protocolHandler = protocolHandler;\n        }\n    };\n\n    // exposing ProtocolManager\n    global._Brackets_LiveDev_ProtocolManager = ProtocolManager;\n\n    /**\n     * The remote handler for the protocol.\n     */\n    var ProtocolHandler = {\n        /**\n         * Handles a message from the transport. Parses it as JSON and delegates\n         * to MessageBroker who is in charge of routing them to handlers.\n         * @param {string} msgStr The protocol message as stringified JSON.\n         */\n        message: function (msgStr) {\n            var msg;\n            try {\n                msg = JSON.parse(msgStr);\n            } catch (e) {\n                console.error(\"[Brackets LiveDev] Malformed message received: \", msgStr);\n                return;\n            }\n            // delegates handling/routing to MessageBroker.\n            MessageBroker.trigger(msg);\n        },\n\n        close: function (evt) {\n            ProtocolManager.onClose();\n        },\n\n        connect: function (evt) {\n            ProtocolManager.onConnect();\n        }\n    };\n\n    ProtocolManager.setProtocolHandler(ProtocolHandler);\n\n    window.addEventListener('load', function () {\n        ProtocolManager.enable();\n    });\n\n    function _getAllInheritedSelectorsInOrder(element) {\n        let selectorsFound= new Map();\n        const selectorsList = [];\n        while (element) {\n            if(element.id){\n                selectorsList.push(`#${element.id}`);\n            }\n            if (element.classList) {\n                element.classList.forEach(cls => {\n                    if(!selectorsFound.get(cls)){\n                        selectorsFound.set(cls, true);\n                        selectorsList.push(`.${cls}`);\n                    }\n                });\n            }\n            element = element.parentElement; // Move up to the next parent element\n        }\n        return selectorsList;\n    }\n\n\n    /**\n    * Sends the message containing tagID which is being clicked\n    * to the editor in order to change the cursor position to\n    * the HTML tag corresponding to the clicked element.\n    */\n    function onDocumentClick(event) {\n        // Get the user's current selection\n        const selection = window.getSelection();\n        var element = event.target;\n        if (element && element.hasAttribute('data-brackets-id')) {\n            // Check if it's a double-click for direct editing\n            if (event.detail === 2 && !['INPUT', 'TEXTAREA', 'SELECT'].includes(element.tagName)) {\n                // Double-click detected, enable direct editing\n                // Make the element editable\n                if (window._LD && window._LD.DOMEditHandler) {\n                    // Use the existing DOMEditHandler to handle the edit\n                    window._LD.startEditing(element);\n                } else {\n                    MessageBroker.send({\n                        \"tagId\": element.getAttribute('data-brackets-id'),\n                        \"nodeID\": element.id,\n                        \"nodeClassList\": element.classList,\n                        \"nodeName\": element.nodeName,\n                        \"allSelectors\": _getAllInheritedSelectorsInOrder(element),\n                        \"contentEditable\": element.contentEditable === 'true',\n                        \"clicked\": true,\n                        \"edit\": true\n                    });\n                }\n\n                // Prevent default behavior and stop propagation\n                event.preventDefault();\n                event.stopPropagation();\n            } else {\n                // Regular click, just send the information\n                // Check if there is a selection\n                if (selection.toString().length > 0) {\n                    // if there is any selection like text or others, we don't see it as a live selection event\n                    // Eg: user may selects ome text in live preview to copy, in which case we should nt treat it\n                    // as a live select.\n                    return;\n                }\n                MessageBroker.send({\n                    \"tagId\": element.getAttribute('data-brackets-id'),\n                    \"nodeID\": element.id,\n                    \"nodeClassList\": element.classList,\n                    \"nodeName\": element.nodeName,\n                    \"allSelectors\": _getAllInheritedSelectorsInOrder(element),\n                    \"contentEditable\": element.contentEditable === 'true',\n                    \"clicked\": true\n                });\n            }\n        }\n    }\n    window.document.addEventListener(\"click\", onDocumentClick);\n    window.document.addEventListener(\"keydown\", function (e) {\n        // for undo. refer to LivePreviewEdit.js file 'handleLivePreviewEditOperation' function\n        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"z\") {\n            MessageBroker.send({\n                livePreviewEditEnabled: true,\n                undoLivePreviewOperation: true\n            });\n        }\n\n        // for redo\n        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"y\") {\n            MessageBroker.send({\n                livePreviewEditEnabled: true,\n                redoLivePreviewOperation: true\n            });\n        }\n    });\n\n}(this));\n"],"file":"LiveDevProtocolRemote.js"}