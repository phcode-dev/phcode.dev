function RemoteFunctions(config={}){let previouslyClickedElement=null;var req,timeout,animateHighlight=function(time){req&&(window.cancelAnimationFrame(req),window.clearTimeout(timeout)),req=window.requestAnimationFrame(redrawHighlights),timeout=setTimeout(function(){window.cancelAnimationFrame(req),req=null},1e3*time)},_editHandler,HIGHLIGHT_CLASSNAME="__brackets-ld-highlight";let _autoScrollTimer=null,_isAutoScrolling=!1;const AUTO_SCROLL_SPEED=12,AUTO_SCROLL_EDGE_SIZE=.05;function _handleAutoScroll(clientY){const viewportHeight=window.innerHeight,scrollEdgeSize=viewportHeight*AUTO_SCROLL_EDGE_SIZE;_autoScrollTimer&&(clearInterval(_autoScrollTimer),_autoScrollTimer=null);let scrollDirection=0;clientY<=scrollEdgeSize?scrollDirection=-AUTO_SCROLL_SPEED:clientY>=viewportHeight-scrollEdgeSize&&(scrollDirection=AUTO_SCROLL_SPEED),0!==scrollDirection&&(_isAutoScrolling=!0,_autoScrollTimer=setInterval(()=>{window.scrollBy(0,scrollDirection)},16))}function _stopAutoScroll(){_autoScrollTimer&&(clearInterval(_autoScrollTimer),_autoScrollTimer=null),_isAutoScrolling=!1}function _validEvent(event){return"Mac"===window.navigator.platform.substr(0,3)?event.metaKey:event.ctrlKey}function isElementEditable(element,onlyHighlight=!1){return!(!config.isProUser&&!onlyHighlight)&&!(!element||!element.hasAttribute("data-brackets-id")||"BODY"===element.tagName||"HTML"===element.tagName||_isInsideHeadTag(element))}function _isInsideHeadTag(element){let parent=element;for(;parent&&parent!==window.document;){if("HEAD"===parent.tagName)return"STYLE"!==element.tagName;parent=parent.parentElement}return!1}function _screenOffset(element){var elemBounds=element.getBoundingClientRect(),body=window.document.body,offsetTop,offsetLeft;if("static"===window.getComputedStyle(body).position)offsetLeft=elemBounds.left+window.pageXOffset,offsetTop=elemBounds.top+window.pageYOffset;else{var bodyBounds=body.getBoundingClientRect();offsetLeft=elemBounds.left-bodyBounds.left,offsetTop=elemBounds.top-bodyBounds.top}return{left:offsetLeft,top:offsetTop}}function _trigger(element,name,value,autoRemove){var key="data-ld-"+name;null!=value?(element.setAttribute(key,value),autoRemove&&window.setTimeout(element.removeAttribute.bind(element,key))):element.removeAttribute(key)}function isInViewport(element){var rect=element.getBoundingClientRect(),html=window.document.documentElement;return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||html.clientHeight)&&rect.right<=(window.innerWidth||html.clientWidth)}function isElementVisible(element){const rect=element.getBoundingClientRect();if(0===rect.width&&0===rect.height)return!1;const computedStyle=window.getComputedStyle(element);if("none"===computedStyle.display||"hidden"===computedStyle.visibility||"0"===computedStyle.opacity)return!1;let parent=element.parentElement;for(;parent&&parent!==document.body;){const parentStyle=window.getComputedStyle(parent);if("none"===parentStyle.display||"hidden"===parentStyle.visibility)return!1;parent=parent.parentElement}return!0}function getDocumentOffsetTop(element){return element.offsetTop+(element.offsetParent?getDocumentOffsetTop(element.offsetParent):0)}function _handleAIOptionClick(event,element){dismissAllUIBoxes(),_aiPromptBox=new AIPromptBox(element)}function _handleDeleteOptionClick(event,element){if(isElementEditable(element)){const tagId=element.getAttribute("data-brackets-id");window._Brackets_MessageBroker.send({livePreviewEditEnabled:!0,element:element,event:event,tagId:Number(tagId),delete:!0})}else console.error("The TagID might be unavailable or the element tag is directly body or html")}function _handleDuplicateOptionClick(event,element){if(isElementEditable(element)){const tagId=element.getAttribute("data-brackets-id");window._Brackets_MessageBroker.send({livePreviewEditEnabled:!0,element:element,event:event,tagId:Number(tagId),duplicate:!0})}else console.error("The TagID might be unavailable or the element tag is directly body or html")}function _handleSelectParentOptionClick(event,element){if(!isElementEditable(element))return;const parentElement=element.parentElement;isElementEditable(parentElement)?parentElement.click():console.error("The TagID might be unavailable or the parent element tag is directly body or html")}function handleOptionClick(e,action,element){"select-parent"===action?_handleSelectParentOptionClick(e,element):"edit-text"===action?startEditing(element):"duplicate"===action?_handleDuplicateOptionClick(e,element):"delete"===action?_handleDeleteOptionClick(e,element):"ai"===action&&_handleAIOptionClick(e,element)}function _dragStartChores(element){element._originalDragOpacity=element.style.opacity,element.style.opacity=.4}function _dragEndChores(element){element._originalDragOpacity?element.style.opacity=element._originalDragOpacity:element.style.opacity=1,delete element._originalDragOpacity}let DROP_MARKER_CLASSNAME="__brackets-drop-marker-horizontal",DROP_MARKER_VERTICAL_CLASSNAME="__brackets-drop-marker-vertical",DROP_MARKER_INSIDE_CLASSNAME="__brackets-drop-marker-inside";function _getIndicatorType(element){const parent=element.parentElement;if(!parent)return"horizontal";const parentStyle=window.getComputedStyle(parent),display=parentStyle.display,flexDirection=parentStyle.flexDirection;return"flex"!==display&&"inline-flex"!==display||!flexDirection.startsWith("row")?"horizontal":"vertical"}function _canAcceptChildren(element){const voidElements=["IMG","BR","HR","INPUT","META","LINK","AREA","BASE","COL","EMBED","SOURCE","TRACK","WBR"],nonContainerElements=["SCRIPT","STYLE","NOSCRIPT","CANVAS","SVG","VIDEO","AUDIO","IFRAME","OBJECT"],tagName=element.tagName.toUpperCase();return!voidElements.includes(tagName)&&!nonContainerElements.includes(tagName)}function _isValidNesting(sourceElement,targetElement){const sourceTag=sourceElement.tagName.toUpperCase(),targetTag=targetElement.tagName.toUpperCase(),blockElements=["DIV","P","H1","H2","H3","H4","H5","H6","SECTION","ARTICLE","HEADER","FOOTER","NAV","ASIDE","MAIN","BLOCKQUOTE","PRE","TABLE","UL","OL","LI","DL","DT","DD","FORM","FIELDSET","ADDRESS","FIGURE","FIGCAPTION","DETAILS","SUMMARY"],inlineElements=["SPAN","A","STRONG","EM","B","I","U","SMALL","CODE","KBD","SAMP","VAR","SUB","SUP","MARK","DEL","INS","Q","CITE","ABBR","TIME","DATA","OUTPUT"],interactiveElements=["A","BUTTON","INPUT","SELECT","TEXTAREA","LABEL","DETAILS","SUMMARY","AUDIO","VIDEO","EMBED","IFRAME","OBJECT"],sectioningContent=["ARTICLE","ASIDE","NAV","SECTION"],noSelfNesting=["P","A","BUTTON","LABEL","FORM","HEADER","FOOTER","NAV","MAIN","ASIDE","SECTION","ARTICLE","ADDRESS","H1","H2","H3","H4","H5","H6","FIGURE","FIGCAPTION","DETAILS","SUMMARY"],restrictedContainers={UL:["LI"],OL:["LI"],DL:["DT","DD"],TABLE:["THEAD","TBODY","TFOOT","TR","CAPTION","COLGROUP"],THEAD:["TR"],TBODY:["TR"],TFOOT:["TR"],TR:["TD","TH"],COLGROUP:["COL"],SELECT:["OPTION","OPTGROUP"],OPTGROUP:["OPTION"],DATALIST:["OPTION"],PICTURE:["SOURCE","IMG"],AUDIO:["SOURCE","TRACK"],VIDEO:["SOURCE","TRACK"],FIGURE:["FIGCAPTION","DIV","P","IMG","CANVAS","SVG","TABLE","PRE","CODE"],DETAILS:["SUMMARY"]};return(!noSelfNesting.includes(sourceTag)||sourceTag!==targetTag)&&((!blockElements.includes(sourceTag)||!inlineElements.includes(targetTag))&&(restrictedContainers[targetTag]?restrictedContainers[targetTag].includes(sourceTag):("P"!==targetTag||!blockElements.includes(sourceTag))&&((!interactiveElements.includes(targetTag)||!interactiveElements.includes(sourceTag))&&(("HEADER"!==targetTag||!["HEADER","FOOTER","MAIN"].includes(sourceTag))&&(("FOOTER"!==targetTag||!["HEADER","FOOTER","MAIN"].includes(sourceTag))&&(("MAIN"!==targetTag||"MAIN"!==sourceTag)&&(("ADDRESS"!==targetTag||!sectioningContent.includes(sourceTag)&&!["HEADER","FOOTER","ADDRESS","MAIN"].includes(sourceTag))&&(("FORM"!==targetTag||"FORM"!==sourceTag)&&(("LABEL"!==targetTag||!["LABEL","BUTTON","SELECT","TEXTAREA"].includes(sourceTag))&&((!["H1","H2","H3","H4","H5","H6"].includes(targetTag)||!blockElements.includes(sourceTag))&&(!("LI"===sourceTag&&!["UL","OL","MENU"].includes(targetTag))&&((!["DT","DD"].includes(sourceTag)||"DL"===targetTag)&&((!["THEAD","TBODY","TFOOT"].includes(sourceTag)||"TABLE"===targetTag)&&(!("TR"===sourceTag&&!["TABLE","THEAD","TBODY","TFOOT"].includes(targetTag))&&((!["TD","TH"].includes(sourceTag)||"TR"===targetTag)&&(("CAPTION"!==sourceTag||"TABLE"===targetTag)&&(!(["SOURCE","TRACK"].includes(sourceTag)&&!["AUDIO","VIDEO","PICTURE"].includes(targetTag))&&((!["RP","RT"].includes(sourceTag)||"RUBY"===targetTag)&&!("OPTION"===sourceTag&&!["SELECT","OPTGROUP","DATALIST"].includes(targetTag))))))))))))))))))))}function _getDropZone(element,clientX,clientY,indicatorType,sourceElement){const rect=element.getBoundingClientRect(),canAcceptChildren=_canAcceptChildren(element),isValidNesting=!sourceElement||_isValidNesting(sourceElement,element);if("vertical"===indicatorType){const leftThird=rect.left+.3*rect.width,rightThird=rect.right-.3*rect.width;return clientX<leftThird?"before":clientX>rightThird?"after":canAcceptChildren&&isValidNesting?"inside":clientX<rect.left+rect.width/2?"before":"after"}const topThird=rect.top+.3*rect.height,bottomThird=rect.bottom-.3*rect.height;return clientY<topThird?"before":clientY>bottomThird?"after":canAcceptChildren&&isValidNesting?"inside":clientY<rect.top+rect.height/2?"before":"after"}function _createDropMarker(element,dropZone,indicatorType="horizontal"){_removeDropMarkerFromElement(element);let marker=window.document.createElement("div");marker.className="inside"===dropZone?DROP_MARKER_INSIDE_CLASSNAME:"vertical"===indicatorType?DROP_MARKER_VERTICAL_CLASSNAME:DROP_MARKER_CLASSNAME;let rect=element.getBoundingClientRect();marker.style.position="fixed",marker.style.zIndex="2147483647",marker.style.borderRadius="2px",marker.style.pointerEvents="none","inside"===dropZone?(marker.style.border="2px dashed #4285F4",marker.style.backgroundColor="rgba(66, 133, 244, 0.05)",marker.style.left=rect.left+"px",marker.style.top=rect.top+"px",marker.style.width=rect.width+"px",marker.style.height=rect.height+"px",marker.style.animation="insideMarkerPulse 1s ease-in-out infinite alternate"):(marker.style.background="linear-gradient(90deg, #4285F4, #1976D2)",marker.style.boxShadow="0 0 8px rgba(66, 133, 244, 0.5)",marker.style.animation="dropMarkerPulse 0.8s ease-in-out infinite alternate","vertical"===indicatorType?(marker.style.width="3px",marker.style.height=rect.height+"px",marker.style.top=rect.top+"px",marker.style.left="after"===dropZone?rect.right+3+"px":rect.left-5+"px"):(marker.style.width=rect.width+"px",marker.style.height="3px",marker.style.left=rect.left+"px",marker.style.top="after"===dropZone?rect.bottom+3+"px":rect.top-5+"px")),element._dropMarker=marker,window.document.body.appendChild(marker)}function _removeDropMarkerFromElement(element){element._dropMarker&&element._dropMarker.parentNode&&(element._dropMarker.parentNode.removeChild(element._dropMarker),delete element._dropMarker)}function _clearDropMarkers(){let horizontalMarkers=window.document.querySelectorAll("."+DROP_MARKER_CLASSNAME),verticalMarkers=window.document.querySelectorAll("."+DROP_MARKER_VERTICAL_CLASSNAME),insideMarkers=window.document.querySelectorAll("."+DROP_MARKER_INSIDE_CLASSNAME);for(let i=0;i<horizontalMarkers.length;i++)horizontalMarkers[i].parentNode&&horizontalMarkers[i].parentNode.removeChild(horizontalMarkers[i]);for(let i=0;i<verticalMarkers.length;i++)verticalMarkers[i].parentNode&&verticalMarkers[i].parentNode.removeChild(verticalMarkers[i]);for(let i=0;i<insideMarkers.length;i++)insideMarkers[i].parentNode&&insideMarkers[i].parentNode.removeChild(insideMarkers[i]);let elements=window.document.querySelectorAll("[data-brackets-id]");for(let j=0;j<elements.length;j++)delete elements[j]._dropMarker,void 0!==elements[j]._originalDragBackgroundColor&&(elements[j].style.backgroundColor=elements[j]._originalDragBackgroundColor,delete elements[j]._originalDragBackgroundColor),void 0!==elements[j]._originalDragTransform&&(elements[j].style.transform=elements[j]._originalDragTransform,delete elements[j]._originalDragTransform),void 0!==elements[j]._originalDragTransition&&(elements[j].style.transition=elements[j]._originalDragTransition,delete elements[j]._originalDragTransition)}function _findNearestValidTarget(clientX,clientY){const searchRadius=500,step=10;for(let radius=10;radius<=500;radius+=10){const points=[[clientX+radius,clientY],[clientX-radius,clientY],[clientX,clientY+radius],[clientX,clientY-radius],[clientX+radius,clientY+radius],[clientX-radius,clientY-radius],[clientX+radius,clientY-radius],[clientX-radius,clientY+radius]];for(let point of points){const[x,y]=point;let target=document.elementFromPoint(x,y);if(target&&target!==window._currentDraggedElement){for(;target&&!target.hasAttribute("data-brackets-id");)target=target.parentElement;if(isElementEditable(target)&&target!==window._currentDraggedElement)return target}}}return null}function onDragOver(event){if(!window._currentDraggedElement)return;event.preventDefault();let target=document.elementFromPoint(event.clientX,event.clientY);if(!target||target===window._currentDraggedElement)return;for(;target&&!target.hasAttribute("data-brackets-id");)target=target.parentElement;if(!(isElementEditable(target)&&target!==window._currentDraggedElement||(target=_findNearestValidTarget(event.clientX,event.clientY))))return;void 0===target._originalDragBackgroundColor&&(target._originalDragBackgroundColor=target.style.backgroundColor),void 0===target._originalDragTransition&&(target._originalDragTransition=target.style.transition),target.style.backgroundColor="rgba(66, 133, 244, 0.1)",target.style.transition="background-color 0.2s ease";const indicatorType=_getIndicatorType(target),dropZone=_getDropZone(target,event.clientX,event.clientY,indicatorType,window._currentDraggedElement);_clearDropMarkers(),_createDropMarker(target,dropZone,indicatorType),_handleAutoScroll(event.clientY)}function onDragLeave(event){event.relatedTarget||(_clearDropMarkers(),_stopAutoScroll())}function onDrop(event){if(!window._currentDraggedElement)return;event.preventDefault(),event.stopPropagation();let target=document.elementFromPoint(event.clientX,event.clientY);for(;target&&!target.hasAttribute("data-brackets-id");)target=target.parentElement;if(isElementEditable(target)&&target!==window._currentDraggedElement||(target=_findNearestValidTarget(event.clientX,event.clientY)),!isElementEditable(target)||target===window._currentDraggedElement)return _clearDropMarkers(),_stopAutoScroll(),_dragEndChores(window._currentDraggedElement),dismissUIAndCleanupState(),void delete window._currentDraggedElement;const indicatorType=_getIndicatorType(target),dropZone=_getDropZone(target,event.clientX,event.clientY,indicatorType,window._currentDraggedElement),sourceId=window._currentDraggedElement.getAttribute("data-brackets-id"),targetId=target.getAttribute("data-brackets-id");let messageData={livePreviewEditEnabled:!0,sourceElement:window._currentDraggedElement,targetElement:target,sourceId:Number(sourceId),targetId:Number(targetId),move:!0};"inside"===dropZone?(messageData.insertInside=!0,messageData.insertAfter=!1):messageData.insertAfter="after"===dropZone,window._Brackets_MessageBroker.send(messageData),_clearDropMarkers(),_stopAutoScroll(),_dragEndChores(window._currentDraggedElement),dismissUIAndCleanupState(),delete window._currentDraggedElement}function _shouldShowEditTextOption(element){if(!element||!element.tagName)return!1;const tagName=element.tagName.toLowerCase(),voidElements=["img","br","hr","input","meta","link","area","base","col","embed","source","track","wbr"],nonEditableElements=["script","style","noscript","canvas","svg","video","audio","iframe","object","select","textarea"];return!voidElements.includes(tagName)&&!nonEditableElements.includes(tagName)}function _shouldShowSelectParentOption(element){if(!isElementEditable(element))return!1;const parentElement=element.parentElement;return!!isElementEditable(parentElement)}function NodeMoreOptionsBox(element){this.element=element,this.remove=this.remove.bind(this),this.create()}function NodeInfoBox(element){this.element=element,this.remove=this.remove.bind(this),this.create()}function AIPromptBox(element){this.element=element,this.selectedModel="fast",this.remove=this.remove.bind(this),this.create()}NodeMoreOptionsBox.prototype={_registerDragDrop:function(){const allElements=document.querySelectorAll("[data-brackets-id]");allElements.forEach(el=>el.setAttribute("draggable",!1)),this.element.setAttribute("draggable",!0),this.element.addEventListener("dragstart",event=>{event.stopPropagation(),event.dataTransfer.setData("text/plain",this.element.getAttribute("data-brackets-id")),_dragStartChores(this.element),_clearDropMarkers(),window._currentDraggedElement=this.element,dismissUIAndCleanupState(),dismissImageRibbonGallery(),event.dataTransfer.effectAllowed="move"}),this.element.addEventListener("dragend",event=>{event.preventDefault(),event.stopPropagation(),_dragEndChores(this.element),_clearDropMarkers(),_stopAutoScroll(),delete window._currentDraggedElement})},_getBoxPosition:function(boxWidth,boxHeight){const elemBounds=this.element.getBoundingClientRect(),offset=_screenOffset(this.element);let topPos=offset.top-boxHeight-6,leftPos=offset.left+elemBounds.width-boxWidth;return elemBounds.top-boxHeight<6&&(topPos=offset.top+elemBounds.height+6),leftPos<0&&(leftPos=offset.left),{topPos:topPos,leftPos:leftPos}},_style:function(){this.body=window.document.createElement("div");const shadow=this.body.attachShadow({mode:"open"}),showEditTextOption=_shouldShowEditTextOption(this.element),showSelectParentOption=_shouldShowSelectParentOption(this.element),ICONS_ai='\n                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0,0,256,256">\n                    <g fill="#fffbfb" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(4,4)"><path d="M30.701,41.663l-2.246,5.145c-0.864,1.978 -3.6,1.978 -4.464,0l-2.247,-5.145c-1.999,-4.579 -5.598,-8.224 -10.086,-10.216l-6.183,-2.745c-1.966,-0.873 -1.966,-3.733 0,-4.605l5.99,-2.659c4.604,-2.044 8.267,-5.824 10.232,-10.559l2.276,-5.483c0.844,-2.035 3.656,-2.035 4.5,0l2.276,5.483c1.965,4.735 5.628,8.515 10.232,10.559l5.99,2.659c1.966,0.873 1.966,3.733 0,4.605l-6.183,2.745c-4.489,1.992 -8.088,5.637 -10.087,10.216z"></path><path d="M30.701,41.663l-2.246,5.145c-0.864,1.978 -3.6,1.978 -4.464,0l-2.247,-5.145c-1.999,-4.579 -5.598,-8.224 -10.086,-10.216l-6.183,-2.745c-1.966,-0.873 -1.966,-3.733 0,-4.605l5.99,-2.659c4.604,-2.044 8.267,-5.824 10.232,-10.559l2.276,-5.483c0.844,-2.035 3.656,-2.035 4.5,0l2.276,5.483c1.965,4.735 5.628,8.515 10.232,10.559l5.99,2.659c1.966,0.873 1.966,3.733 0,4.605l-6.183,2.745c-4.489,1.992 -8.088,5.637 -10.087,10.216z"></path><g><path d="M51.578,57.887l-0.632,1.448c-0.462,1.06 -1.93,1.06 -2.393,0l-0.632,-1.448c-1.126,-2.582 -3.155,-4.637 -5.686,-5.762l-1.946,-0.865c-1.052,-0.468 -1.052,-1.998 0,-2.465l1.838,-0.816c2.596,-1.153 4.661,-3.285 5.768,-5.955l0.649,-1.565c0.452,-1.091 1.96,-1.091 2.412,0l0.649,1.565c1.107,2.669 3.172,4.801 5.768,5.955l1.837,0.816c1.053,0.468 1.053,1.998 0,2.465l-1.946,0.865c-2.531,1.125 -4.56,3.18 -5.686,5.762z"></path><path d="M51.578,57.887l-0.632,1.448c-0.462,1.06 -1.93,1.06 -2.393,0l-0.632,-1.448c-1.126,-2.582 -3.155,-4.637 -5.686,-5.762l-1.946,-0.865c-1.052,-0.468 -1.052,-1.998 0,-2.465l1.838,-0.816c2.596,-1.153 4.661,-3.285 5.768,-5.955l0.649,-1.565c0.452,-1.091 1.96,-1.091 2.412,0l0.649,1.565c1.107,2.669 3.172,4.801 5.768,5.955l1.837,0.816c1.053,0.468 1.053,1.998 0,2.465l-1.946,0.865c-2.531,1.125 -4.56,3.18 -5.686,5.762z"></path></g></g></g>\n                </svg>\n                ',ICONS_arrowUp='\n                <svg viewBox="0 0 24 24" fill="currentColor">\n                  <path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.59 5.58L20 12l-8-8-8 8z"/>\n                </svg>\n              ',ICONS_edit='\n                <svg viewBox="0 0 24 24" fill="currentColor">\n                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>\n                </svg>\n              ',ICONS_duplicate='\n                <svg viewBox="0 0 24 24" fill="currentColor">\n                  <path d="M18 3H4C3.44772 3 3 3.44772 3 4V18C3 18.5523 2.55228 19 2 19C1.44772 19 1 18.5523 1 18V4C1 2.34315 2.34315 1 4 1H18C18.5523 1 19 1.44772 19 2C19 2.55228 18.5523 3 18 3Z"/>\n                  <path d="M13 11C13 10.4477 13.4477 10 14 10C14.5523 10 15 10.4477 15 11V13H17C17.5523 13 18 13.4477 18 14C18 14.5523 17.5523 15 17 15H15V17C15 17.5523 14.5523 18 14 18C13.4477 18 13 17.5523 13 17V15H11C10.4477 15 10 14.5523 10 14C10 13.4477 10.4477 13 11 13H13V11Z"/>\n                  <path fill-rule="evenodd" clip-rule="evenodd" d="M20 5C21.6569 5 23 6.34315 23 8V20C23 21.6569 21.6569 23 20 23H8C6.34315 23 5 21.6569 5 20V8C5 6.34315 6.34315 5 8 5H20ZM20 7C20.5523 7 21 7.44772 21 8V20C21 20.5523 20.5523 21 20 21H8C7.44772 21 7 20.5523 7 20V8C7 7.44772 7.44772 7 8 7H20Z"/>\n                </svg>\n              ',ICONS_trash='\n                <svg viewBox="0 0 24 24" fill="currentColor">\n                  <path d="M6 7V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h3v2h-2l-1.5 12.5a2 2 0 0\n                  1-2 1.5H8.5a2 2 0 0 1-2-1.5L5 9H3V7h3zm2 0h8V5H8v2z"/>\n                </svg>\n              ';let content='<div class="node-options">';content+=`<span data-action="ai" title="${config.strings.ai}">\n                    ${ICONS_ai}\n                </span>`,showSelectParentOption&&(content+=`<span data-action="select-parent" title="${config.strings.selectParent}">\n                    ${ICONS_arrowUp}\n                </span>`),showEditTextOption&&(content+=`<span data-action="edit-text" title="${config.strings.editText}">\n                    ${ICONS_edit}\n                </span>`),content+=`<span data-action="duplicate" title="${config.strings.duplicate}">\n                    ${ICONS_duplicate}\n                </span>\n                <span data-action="delete" title="${config.strings.delete}">\n                    ${ICONS_trash}\n                </span>\n            </div>`;const styles="\n                :host {\n                  all: initial !important;\n                }\n\n                .phoenix-more-options-box {\n                    background-color: #4285F4 !important;\n                    color: white !important;\n                    border-radius: 3px !important;\n                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2) !important;\n                    font-size: 12px !important;\n                    font-family: Arial, sans-serif !important;\n                    z-index: 2147483647 !important;\n                    position: absolute !important;\n                    left: -1000px;\n                    top: -1000px;\n                    box-sizing: border-box !important;\n                }\n\n                .node-options {\n                    display: flex !important;\n                    align-items: center !important;\n                }\n\n                .node-options span {\n                    padding: 4px 3.9px !important;\n                    cursor: pointer !important;\n                    display: flex !important;\n                    align-items: center !important;\n                    border-radius: 0 !important;\n                }\n\n                .node-options span:first-child {\n                    border-radius: 3px 0 0 3px !important;\n                }\n\n                .node-options span:last-child {\n                    border-radius: 0 3px 3px 0 !important;\n                }\n\n                .node-options span:hover {\n                    background-color: rgba(255, 255, 255, 0.15) !important;\n                }\n\n                .node-options span > svg {\n                    width: 16px !important;\n                    height: 16px !important;\n                    display: block !important;\n                }\n            ";shadow.innerHTML=`<style>${styles}</style><div class="phoenix-more-options-box">${content}</div>`,this._shadow=shadow},create:function(){if(this.remove(),!config.isProUser)return;if(!isElementVisible(this.element))return;this._style(),window.document.body.appendChild(this.body);const boxElement=this._shadow.querySelector(".phoenix-more-options-box");if(boxElement){const boxRect=boxElement.getBoundingClientRect(),pos=this._getBoxPosition(boxRect.width,boxRect.height);boxElement.style.left=pos.leftPos+"px",boxElement.style.top=pos.topPos+"px"}const spans=this._shadow.querySelectorAll(".node-options span");spans.forEach(span=>{span.addEventListener("click",event=>{event.stopPropagation(),event.preventDefault();const action=event.currentTarget.getAttribute("data-action");handleOptionClick(event,action,this.element),"duplicate"!==action&&this.remove()})}),this._registerDragDrop()},remove:function(){this.body&&this.body.parentNode&&this.body.parentNode===window.document.body&&(window.document.body.removeChild(this.body),this.body=null,_nodeMoreOptionsBox=null)}},NodeInfoBox.prototype={_checkOverlap:function(nodeInfoBoxPos,nodeInfoBoxDimensions){if(_nodeMoreOptionsBox&&_nodeMoreOptionsBox._shadow){const moreOptionsBoxElement=_nodeMoreOptionsBox._shadow.querySelector(".phoenix-more-options-box");if(moreOptionsBoxElement){const moreOptionsBoxOffset=_screenOffset(moreOptionsBoxElement),moreOptionsBoxRect=moreOptionsBoxElement.getBoundingClientRect(),infoBox={left:nodeInfoBoxPos.leftPos,top:nodeInfoBoxPos.topPos,right:nodeInfoBoxPos.leftPos+nodeInfoBoxDimensions.width,bottom:nodeInfoBoxPos.topPos+nodeInfoBoxDimensions.height},moreOptionsBox={left:moreOptionsBoxOffset.left,top:moreOptionsBoxOffset.top,right:moreOptionsBoxOffset.left+moreOptionsBoxRect.width,bottom:moreOptionsBoxOffset.top+moreOptionsBoxRect.height},isOverlapping=!(infoBox.right<moreOptionsBox.left||moreOptionsBox.right<infoBox.left||infoBox.bottom<moreOptionsBox.top||moreOptionsBox.bottom<infoBox.top);return isOverlapping}}return!1},_getBoxPosition:function(boxDimensions,overlap=!1){const elemBounds=this.element.getBoundingClientRect(),offset=_screenOffset(this.element);let topPos=0,leftPos=0;if(overlap)topPos=offset.top+2,(leftPos=offset.left+elemBounds.width+6)+boxDimensions.width>window.innerWidth&&(leftPos=offset.left-boxDimensions.width-6)<0&&(topPos=offset.top+elemBounds.height+6,leftPos=offset.left,elemBounds.bottom+6+boxDimensions.height>window.innerHeight&&(topPos=offset.top-boxDimensions.height-34,leftPos=offset.left));else{if(topPos=offset.top-boxDimensions.height-6,leftPos=offset.left,elemBounds.top-boxDimensions.height<6){const bottomPosition=offset.top+elemBounds.height+6,wouldIncreaseViewportHeight=bottomPosition+boxDimensions.height>window.innerHeight,isHoverMode=shouldShowHighlightOnHover(),shouldUseFloatingPosition=wouldIncreaseViewportHeight&&isHoverMode;shouldUseFloatingPosition?(topPos=offset.top+elemBounds.height-boxDimensions.height-6,(leftPos=offset.left+elemBounds.width-boxDimensions.width)<0&&(leftPos=offset.left),topPos<0&&(topPos=offset.top+6)):topPos=bottomPosition}leftPos+boxDimensions.width>window.innerWidth&&(leftPos=window.innerWidth-boxDimensions.width-10)}return{topPos:topPos,leftPos:leftPos}},_style:function(){this.body=window.document.createElement("div");const shadow=this.body.attachShadow({mode:"open"}),id=this.element.id,classes=Array.from(this.element.classList||[]);let content="";if(content+="<div class='tag-name'>"+this.element.tagName.toLowerCase()+"</div>",id&&(content+="<div class='id-name'>#"+id+"</div>"),classes.length>0){content+="<div class='class-name'>";for(var i=0;i<Math.min(classes.length,3);i++)content+="."+classes[i]+" ";classes.length>3&&(content+="<span class='exceeded-classes'>+"+(classes.length-3)+" more</span>"),content+="</div>"}const offset=_screenOffset(this.element),leftPos=offset.left,styles=`\n                :host {\n                  all: initial !important;\n                }\n\n                .phoenix-node-info-box {\n                    background-color: #4285F4 !important;\n                    color: white !important;\n                    border-radius: 3px !important;\n                    padding: 5px 8px !important;\n                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2) !important;\n                    font-size: 12px !important;\n                    font-family: Arial, sans-serif !important;\n                    z-index: 2147483647 !important;\n                    position: absolute !important;\n                    left: ${leftPos}px;\n                    top: -1000px;\n                    max-width: 300px !important;\n                    box-sizing: border-box !important;\n                    pointer-events: none !important;\n                }\n\n                .tag-name {\n                    font-weight: bold !important;\n                }\n\n                .id-name,\n                .class-name {\n                    margin-top: 3px !important;\n                }\n\n                .exceeded-classes {\n                    opacity: 0.8 !important;\n                }\n            `;shadow.innerHTML=`<style>${styles}</style><div class="phoenix-node-info-box">${content}</div>`,this._shadow=shadow},create:function(){if(this.remove(),!config.isProUser)return;if(!isElementVisible(this.element))return;this._style(),window.document.body.appendChild(this.body);const boxElement=this._shadow.querySelector(".phoenix-node-info-box");if(boxElement){const nodeInfoBoxDimensions={height:boxElement.getBoundingClientRect().height,width:boxElement.getBoundingClientRect().width},nodeInfoBoxPos=this._getBoxPosition(nodeInfoBoxDimensions,!1);boxElement.style.left=nodeInfoBoxPos.leftPos+"px",boxElement.style.top=nodeInfoBoxPos.topPos+"px";const isBoxOverlapping=this._checkOverlap(nodeInfoBoxPos,nodeInfoBoxDimensions);if(isBoxOverlapping){const newPos=this._getBoxPosition(nodeInfoBoxDimensions,!0);boxElement.style.left=newPos.leftPos+"px",boxElement.style.top=newPos.topPos+"px"}}},remove:function(){this.body&&this.body.parentNode&&this.body.parentNode===window.document.body&&(window.document.body.removeChild(this.body),this.body=null)}},AIPromptBox.prototype={_getBoxPosition:function(boxWidth,boxHeight){const elemBounds=this.element.getBoundingClientRect(),offset=_screenOffset(this.element);let topPos=offset.top-boxHeight-6,leftPos=offset.left+elemBounds.width-boxWidth;return elemBounds.top-boxHeight<6&&(topPos=offset.top+elemBounds.height+6),leftPos<0&&(leftPos=offset.left),{topPos:topPos,leftPos:leftPos}},_style:function(){this.body=window.document.createElement("div");const shadow=this.body.attachShadow({mode:"open"}),viewportWidth=window.innerWidth;let boxWidth,boxHeight;viewportWidth>=400?(boxWidth=Math.min(310,.85*viewportWidth),boxHeight=60):viewportWidth>=350?(boxWidth=Math.min(275,.85*viewportWidth),boxHeight=70):viewportWidth>=300?(boxWidth=Math.min(230,.85*viewportWidth),boxHeight=80):viewportWidth>=250?(boxWidth=Math.min(180,.85*viewportWidth),boxHeight=100):viewportWidth>=200?(boxWidth=Math.min(130,.85*viewportWidth),boxHeight=120):(boxWidth=Math.min(100,.85*viewportWidth),boxHeight=140);const styles=`\n                :host {\n                  all: initial !important;\n                }\n\n                .phoenix-ai-prompt-box {\n                    position: absolute !important;\n                    background: white !important;\n                    border: 1px solid #4285F4 !important;\n                    border-radius: 8px !important;\n                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;\n                    font-family: Arial, sans-serif !important;\n                    z-index: 2147483647 !important;\n                    width: ${boxWidth}px !important;\n                    padding: 0 !important;\n                    box-sizing: border-box !important;\n                }\n\n                .phoenix-ai-prompt-input-container {\n                    position: relative !important;\n                }\n\n                .phoenix-ai-prompt-textarea {\n                    width: 100% !important;\n                    height: ${boxHeight}px !important;\n                    border: none !important;\n                    border-radius: 8px !important;\n                    padding: 12px 40px 12px 16px !important;\n                    font-size: 14px !important;\n                    font-family: Arial, sans-serif !important;\n                    resize: none !important;\n                    outline: none !important;\n                    box-sizing: border-box !important;\n                    background: #f9f9f9 !important;\n                }\n\n                .phoenix-ai-prompt-textarea:focus {\n                    background: white !important;\n                }\n\n                .phoenix-ai-prompt-textarea::placeholder {\n                    color: #999 !important;\n                }\n\n                .phoenix-ai-prompt-send-button {\n                    width: 28px !important;\n                    height: 28px !important;\n                    border: none !important;\n                    border-radius: 50% !important;\n                    background: #4285F4 !important;\n                    color: white !important;\n                    cursor: pointer !important;\n                    display: flex !important;\n                    align-items: center !important;\n                    justify-content: center !important;\n                    font-size: 14px !important;\n                    transition: background-color 0.2s !important;\n                    line-height: 0.5 !important;\n                }\n\n                .phoenix-ai-prompt-send-button:hover:not(:disabled) {\n                    background: #4285F4 !important;\n                }\n\n                .phoenix-ai-prompt-send-button:disabled {\n                    background: #dadce0 !important;\n                    color: #9aa0a6 !important;\n                    cursor: not-allowed !important;\n                }\n\n                .phoenix-ai-bottom-controls {\n                    border-top: 1px solid #e0e0e0 !important;\n                    padding: 8px 16px !important;\n                    background: #f9f9f9 !important;\n                    border-radius: 0 0 8px 8px !important;\n                    display: flex !important;\n                    align-items: center !important;\n                    justify-content: space-between !important;\n                }\n\n                .phoenix-ai-model-select {\n                    padding: 4px 8px !important;\n                    border: 1px solid #ddd !important;\n                    border-radius: 4px !important;\n                    font-size: 12px !important;\n                    background: white !important;\n                    outline: none !important;\n                    cursor: pointer !important;\n                }\n\n                .phoenix-ai-model-select:focus {\n                    border-color: #4285F4 !important;\n                }\n            `,content=`\n                <div class="phoenix-ai-prompt-box">\n                    <div class="phoenix-ai-prompt-input-container">\n                        <textarea\n                            class="phoenix-ai-prompt-textarea"\n                            placeholder="${config.strings.aiPromptPlaceholder}"\n                        ></textarea>\n                    </div>\n                    <div class="phoenix-ai-bottom-controls">\n                        <select class="phoenix-ai-model-select">\n                            <option value="fast">Fast AI</option>\n                            <option value="moderate">Moderate AI</option>\n                            <option value="slow">Slow AI</option>\n                        </select>\n                        <button class="phoenix-ai-prompt-send-button" disabled>\n                            âž¤\n                        </button>\n                    </div>\n                </div>\n            `;shadow.innerHTML=`<style>${styles}</style>${content}`,this._shadow=shadow},create:function(){this._style(),window.document.body.appendChild(this.body);const boxElement=this._shadow.querySelector(".phoenix-ai-prompt-box");if(boxElement){const boxRect=boxElement.getBoundingClientRect(),pos=this._getBoxPosition(boxRect.width,boxRect.height);boxElement.style.left=pos.leftPos+"px",boxElement.style.top=pos.topPos+"px"}const textarea=this._shadow.querySelector(".phoenix-ai-prompt-textarea");textarea&&setTimeout(()=>textarea.focus(),50),this._attachEventHandlers(),this.body.addEventListener("click",event=>{event.stopPropagation()})},_attachEventHandlers:function(){const textarea=this._shadow.querySelector(".phoenix-ai-prompt-textarea"),sendButton=this._shadow.querySelector(".phoenix-ai-prompt-send-button"),modelSelect=this._shadow.querySelector(".phoenix-ai-model-select");textarea&&sendButton&&(textarea.addEventListener("input",event=>{const hasText=event.target.value.trim().length>0;sendButton.disabled=!hasText}),textarea.addEventListener("keydown",event=>{"Enter"!==event.key||event.shiftKey?"Escape"===event.key&&(event.preventDefault(),this.remove()):(event.preventDefault(),textarea.value.trim()&&this._handleSend(event,textarea.value.trim()))})),sendButton&&sendButton.addEventListener("click",event=>{event.preventDefault(),event.stopPropagation(),textarea&&textarea.value.trim()&&this._handleSend(event,textarea.value.trim())}),modelSelect&&modelSelect.addEventListener("change",event=>{this.selectedModel=event.target.value})},_handleSend:function(event,prompt){const element=this.element;if(!isElementEditable(element))return;const tagId=element.getAttribute("data-brackets-id");window._Brackets_MessageBroker.send({livePreviewEditEnabled:!0,event:event,element:element,prompt:prompt,tagId:Number(tagId),selectedModel:this.selectedModel,AISend:!0}),this.remove()},remove:function(){this._handleKeydown&&(document.removeEventListener("keydown",this._handleKeydown),this._handleKeydown=null),this._handleResize&&(window.removeEventListener("resize",this._handleResize),this._handleResize=null),this.body&&this.body.parentNode&&this.body.parentNode===window.document.body&&(window.document.body.removeChild(this.body),this.body=null,_aiPromptBox=null)}};const _imageGalleryCache={currentQuery:null,allImages:[],totalPages:1,currentPage:1,maxImages:50};function ImageRibbonGallery(element){this.element=element,this.remove=this.remove.bind(this),this.currentPage=1,this.totalPages=1,this.allImages=[],this.imagesPerPage=10,this.scrollPosition=0,this.maxWidth="800px",this.maxHeight="600px",this.create()}function Highlight(color,trigger){this.color=color,this.trigger=!!trigger,this.elements=[],this.selector=""}var _localHighlight,_hoverHighlight,_clickHighlight,_nodeInfoBox,_nodeMoreOptionsBox,_aiPromptBox,_imageRibbonGallery;ImageRibbonGallery.prototype={_style:function(){this.body=window.document.createElement("div"),this._shadow=this.body.attachShadow({mode:"closed"}),this._shadow.innerHTML=`\n                <style>\n                    .phoenix-image-ribbon {\n                        position: fixed !important;\n                        bottom: 0 !important;\n                        left: 0 !important;\n                        right: 0 !important;\n                        width: 100vw !important;\n                        background: linear-gradient(180deg, rgba(12,14,20,0.0), rgba(12,14,20,0.7)) !important;\n                        z-index: 2147483647 !important;\n                        display: flex !important;\n                        font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial !important;\n                        pointer-events: auto !important;\n                    }\n\n                    .phoenix-ribbon-container {\n                        width: 100% !important;\n                        height: 156px !important;\n                        background: rgba(255, 255, 255, 0.3) !important;\n                        backdrop-filter: blur(10px) !important;\n                        -webkit-backdrop-filter: blur(10px) !important;\n                        border: 1px solid rgba(255, 255, 255, 0.2) !important;\n                        border-radius: 12px !important;\n                        position: relative !important;\n                    }\n\n                    .phoenix-ribbon-strip {\n                        position: absolute !important;\n                        inset: 0 !important;\n                        overflow: hidden !important;\n                        scroll-behavior: smooth !important;\n                        padding: 6px !important;\n                        top: 34px !important;\n                    }\n\n                    .phoenix-ribbon-row {\n                        display: flex !important;\n                        gap: 2px !important;\n                    }\n\n                    .phoenix-ribbon-thumb {\n                        flex: 0 0 auto !important;\n                        width: 112px !important;\n                        height: 112px !important;\n                        border-radius: 14px !important;\n                        overflow: hidden !important;\n                        position: relative !important;\n                        cursor: pointer !important;\n                        outline: 1px solid rgba(255,255,255,0.08) !important;\n                        transition: transform 0.15s ease, outline-color 0.15s ease, box-shadow 0.15s ease !important;\n                        background: #0b0e14 !important;\n                    }\n\n                    .phoenix-ribbon-thumb img {\n                        width: 100% !important;\n                        height: 100% !important;\n                        object-fit: cover !important;\n                        display: block !important;\n                    }\n\n                    .phoenix-ribbon-thumb:hover {\n                        transform: translateY(-2px) scale(1.02) !important;\n                        outline-color: rgba(255,255,255,0.25) !important;\n                        box-shadow: 0 8px 18px rgba(0,0,0,0.36) !important;\n                    }\n\n                    .phoenix-ribbon-nav {\n                        position: absolute !important;\n                        top: 58% !important;\n                        transform: translateY(-50%) !important;\n                        border-radius: 12px !important;\n                        border: 1px solid rgba(255,255,255,0.14) !important;\n                        color: #eaeaf0 !important;\n                        background: rgba(21,25,36,0.65) !important;\n                        cursor: pointer !important;\n                        backdrop-filter: blur(8px) !important;\n                        font-size: 20px !important;\n                        font-weight: 600 !important;\n                        user-select: none !important;\n                        transition: all 0.2s ease !important;\n                        z-index: 2147483647 !important;\n                        padding: 2px 12px 6px 12px !important;\n                    }\n\n                    .phoenix-ribbon-nav:hover {\n                        background: rgba(21,25,36,0.85) !important;\n                        border-color: rgba(255,255,255,0.25) !important;\n                        transform: translateY(-50%) scale(1.05) !important;\n                        box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;\n                    }\n\n                    .phoenix-ribbon-nav:active {\n                        transform: translateY(-50%) scale(0.95) !important;\n                    }\n\n                    .phoenix-ribbon-nav.left {\n                        left: 18px !important;\n                    }\n\n                    .phoenix-ribbon-nav.right {\n                        right: 18px !important;\n                    }\n\n                    .phoenix-ribbon-loading {\n                        display: flex !important;\n                        align-items: center !important;\n                        justify-content: center !important;\n                        height: 100% !important;\n                        color: #eaeaf0 !important;\n                        font-size: 14px !important;\n                    }\n\n                    .phoenix-ribbon-error {\n                        display: flex !important;\n                        align-items: center !important;\n                        justify-content: center !important;\n                        height: 100% !important;\n                        color: #ff6b6b !important;\n                        font-size: 14px !important;\n                    }\n\n                    .phoenix-ribbon-header {\n                        display: flex !important;\n                        width: 100% !important;\n                        position: absolute !important;\n                        top: 5px !important;\n                    }\n\n                    .phoenix-ribbon-header-left {\n                        width: 80% !important;\n                        display: flex !important;\n                    }\n\n                    .phoenix-ribbon-header-right {\n                        width: 20% !important;\n                        display: flex !important;\n                        justify-content: flex-end !important;\n                    }\n\n                    .phoenix-ribbon-search {\n                        display: flex !important;\n                        align-items: center !important;\n                        background: rgba(0,0,0,0.5) !important;\n                        padding: 5px !important;\n                        border-radius: 5px !important;\n                        margin-left: 8px !important;\n                    }\n\n                    .phoenix-ribbon-search input {\n                        background: transparent !important;\n                        border: none !important;\n                        outline: none !important;\n                        color: white !important;\n                        width: 200px !important;\n                    }\n\n                    .phoenix-ribbon-search input::placeholder {\n                        color: rgba(255, 255, 255, 0.7) !important;\n                        opacity: 1 !important;\n                    }\n\n                    .phoenix-ribbon-search input::-webkit-input-placeholder {\n                        color: rgba(255, 255, 255, 0.7) !important;\n                    }\n\n                    .phoenix-ribbon-search input::-moz-placeholder {\n                        color: rgba(255, 255, 255, 0.7) !important;\n                        opacity: 1 !important;\n                    }\n\n                    .phoenix-ribbon-search-btn {\n                        background: none !important;\n                        border: none !important;\n                        color: #6aa9ff !important;\n                        cursor: pointer !important;\n                    }\n\n                    .phoenix-ribbon-select {\n                        margin-left: 10px !important;\n                    }\n\n                    .phoenix-select-image-btn {\n                        background: gray !important;\n                        border: 1px solid rgba(255, 255, 255, 0.2) !important;\n                        color: #fff !important;\n                        padding: 2px 4px !important;\n                        border-radius: 6px !important;\n                        font-size: 12px !important;\n                        cursor: pointer !important;\n                        transition: all 0.2s ease !important;\n                    }\n\n                    .phoenix-ribbon-close {\n                        background: rgba(0,0,0,0.5) !important;\n                        border: none !important;\n                        color: white !important;\n                        cursor: pointer !important;\n                        padding: 4px 8px !important;\n                        border-radius: 3px !important;\n                        margin-right: 16px !important;\n                    }\n\n                    .phoenix-ribbon-attribution {\n                        position: absolute !important;\n                        bottom: 6px !important;\n                        left: 6px !important;\n                        background: rgba(0,0,0,0.8) !important;\n                        color: white !important;\n                        padding: 4px 6px !important;\n                        border-radius: 5px !important;\n                        font-size: 10px !important;\n                        line-height: 1.2 !important;\n                        max-width: calc(100% - 12px) !important;\n                        text-shadow: 0 1px 2px rgba(0,0,0,0.9) !important;\n                        pointer-events: auto !important;\n                        opacity: 0 !important;\n                        transition: all 0.2s ease !important;\n                    }\n\n                    .phoenix-ribbon-attribution .photographer {\n                        display: block !important;\n                        font-weight: 500 !important;\n                        white-space: nowrap !important;\n                        overflow: hidden !important;\n                        text-overflow: ellipsis !important;\n                        color: white !important;\n                        text-decoration: none !important;\n                    }\n\n                    .phoenix-ribbon-attribution .photographer:hover {\n                        text-decoration: underline !important;\n                    }\n\n                    .phoenix-ribbon-attribution .source {\n                        display: block !important;\n                        font-size: 9px !important;\n                        opacity: 0.85 !important;\n                        color: white !important;\n                        text-decoration: none !important;\n                    }\n\n                    .phoenix-ribbon-attribution .source:hover {\n                        text-decoration: underline !important;\n                    }\n\n                    .phoenix-download-icon {\n                        position: absolute !important;\n                        top: 8px !important;\n                        right: 8px !important;\n                        background: rgba(0,0,0,0.7) !important;\n                        border: none !important;\n                        color: #eee !important;\n                        border-radius: 50% !important;\n                        width: 18px !important;\n                        height: 18px !important;\n                        padding: 4px !important;\n                        display: flex !important;\n                        align-items: center !important;\n                        justify-content: center !important;\n                        cursor: pointer !important;\n                        font-size: 16px !important;\n                        z-index: 2147483647 !important;\n                        transition: all 0.2s ease !important;\n                        pointer-events: none !important;\n                        opacity: 0 !important;\n                    }\n\n                    .phoenix-ribbon-thumb:hover .phoenix-download-icon {\n                        opacity: 1 !important;\n                        pointer-events: auto !important;\n                    }\n\n                    .phoenix-ribbon-thumb:hover .phoenix-ribbon-attribution {\n                        opacity: 1 !important;\n                    }\n\n                    .phoenix-ribbon-attribution:hover {\n                        opacity: 1 !important;\n                    }\n\n                    .phoenix-download-icon:hover {\n                        background: rgba(0,0,0,0.9) !important;\n                        transform: scale(1.1) !important;\n                    }\n\n                    .phoenix-ribbon-thumb {\n                        cursor: pointer !important;\n                    }\n\n                    .phoenix-ribbon-thumb.downloading {\n                        opacity: 0.6 !important;\n                        pointer-events: none !important;\n                    }\n\n                    .phoenix-download-indicator {\n                        position: absolute !important;\n                        top: 50% !important;\n                        left: 50% !important;\n                        transform: translate(-50%, -50%) !important;\n                        background: rgba(0, 0, 0, 0.8) !important;\n                        border-radius: 50% !important;\n                        width: 40px !important;\n                        height: 40px !important;\n                        display: flex !important;\n                        align-items: center !important;\n                        justify-content: center !important;\n                        z-index: 10 !important;\n                    }\n\n                    .phoenix-download-spinner {\n                        width: 20px !important;\n                        height: 20px !important;\n                        border: 2px solid rgba(255, 255, 255, 0.3) !important;\n                        border-top: 2px solid #fff !important;\n                        border-radius: 50% !important;\n                        animation: phoenix-spin 1s linear infinite !important;\n                    }\n\n                    @keyframes phoenix-spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                </style>\n                <div class="phoenix-image-ribbon">\n                    <div class="phoenix-ribbon-container">\n                        <div class="phoenix-ribbon-header">\n                            <div class="phoenix-ribbon-header-left">\n                                <div class="phoenix-ribbon-search">\n                                    <input type="text" placeholder="${config.strings.imageGallerySearchPlaceholder}" />\n                                    <button class="phoenix-ribbon-search-btn">Search</button>\n                                </div>\n                                <div class="phoenix-ribbon-select">\n                                    <button class="phoenix-select-image-btn" title="${config.strings.imageGallerySelectFromComputer}">\n                                        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>\n                                            <path d="M12,12L10.5,13.5L8.5,11.5L6,14H18L15,11L12,12Z"/>\n                                        </svg>\n                                    </button>\n                                    <input type="file" class="phoenix-file-input" accept="image/*" style="display: none;">\n                                </div>\n                            </div>\n                            <div class="phoenix-ribbon-header-right">\n                                <button class="phoenix-ribbon-close">Ã—</button>\n                            </div>\n                        </div>\n                        <div class="phoenix-ribbon-nav left">&#8249;</div>\n                        <div class="phoenix-ribbon-strip">\n                            <div class="phoenix-ribbon-row phoenix-ribbon-loading">\n                                Loading images...\n                            </div>\n                        </div>\n                        <div class="phoenix-ribbon-nav right">&#8250;</div>\n                    </div>\n                </div>\n            `},_getDefaultQuery:function(){const qualityQueries=["nature","minimal","workspace","abstract","coffee","mountains","city","flowers","ocean","sunset","architecture","forest","travel","technology","sky","landscape","creative","design","art","modern","food","patterns","colors","photography","studio","light","winter","summer","vintage","geometric","water","beach","space","garden","textures","urban","portrait","music","books","home","cozy","aesthetic","autumn","spring","clouds"],randIndex=Math.floor(Math.random()*qualityQueries.length);return qualityQueries[randIndex]},_fetchImages:function(searchQuery,page=1,append=!1){this._currentSearchQuery=searchQuery,!append&&this._loadFromCache(searchQuery)||append&&this._loadPageFromCache(searchQuery,page)||this._fetchFromAPI(searchQuery,page,append)},_fetchFromAPI:function(searchQuery,page,append){searchQuery!==_imageGalleryCache.currentQuery&&this._clearCache();const apiUrl=`https://images.phcode.dev/api/images/search?q=${encodeURIComponent(searchQuery)}&per_page=10&page=${page}&safe=true`;append||this._showLoading(),fetch(apiUrl).then(response=>{if(!response.ok)throw new Error(`API request failed: ${response.status}`);return response.json()}).then(data=>{data.results&&data.results.length>0?(append?(this.allImages=this.allImages.concat(data.results),this._renderImages(data.results,!0)):(this.allImages=data.results,this._renderImages(this.allImages,!1)),this.totalPages=data.total_pages||1,this.currentPage=page,this._updateNavButtons(),this._updateSearchInput(searchQuery),this._updateCache(searchQuery,data,append)):append||this._showError("No images found"),append&&(this._isLoadingMore=!1,this._hideLoadingMore())}).catch(error=>{console.error("Failed to fetch images:",error),append?(this._isLoadingMore=!1,this._hideLoadingMore()):this._showError("Failed to load images")})},_updateCache:function(searchQuery,data,append){if(_imageGalleryCache.currentQuery=searchQuery,_imageGalleryCache.totalPages=data.total_pages||1,_imageGalleryCache.currentPage=this.currentPage,append){const newImages=_imageGalleryCache.allImages.concat(data.results);newImages.length>_imageGalleryCache.maxImages?_imageGalleryCache.allImages=newImages.slice(-_imageGalleryCache.maxImages):_imageGalleryCache.allImages=newImages}else _imageGalleryCache.allImages=data.results},_clearCache:function(){_imageGalleryCache.currentQuery=null,_imageGalleryCache.allImages=[],_imageGalleryCache.totalPages=1,_imageGalleryCache.currentPage=1},_updateSearchInput:function(searchQuery){const searchInput=this._shadow.querySelector(".phoenix-ribbon-search input");searchInput&&searchQuery&&(searchInput.value=searchQuery,searchInput.placeholder=searchQuery)},_loadFromCache:function(searchQuery){return searchQuery===_imageGalleryCache.currentQuery&&_imageGalleryCache.allImages.length>0&&(this.allImages=_imageGalleryCache.allImages,this.totalPages=_imageGalleryCache.totalPages,this.currentPage=_imageGalleryCache.currentPage,this._renderImages(this.allImages,!1),this._updateNavButtons(),this._updateSearchInput(searchQuery),!0)},_loadPageFromCache:function(searchQuery,page){if(searchQuery===_imageGalleryCache.currentQuery&&page<=Math.ceil(_imageGalleryCache.allImages.length/10)){const startIdx=10*(page-1),endIdx=startIdx+10,pageImages=_imageGalleryCache.allImages.slice(startIdx,endIdx);if(pageImages.length>0)return this.allImages=this.allImages.concat(pageImages),this._renderImages(pageImages,!0),this.currentPage=page,this._updateNavButtons(),this._isLoadingMore=!1,this._hideLoadingMore(),!0}return!1},_handleNavLeft:function(){const container=this._shadow.querySelector(".phoenix-ribbon-strip");if(!container)return;const containerWidth=container.clientWidth,scrollAmount=containerWidth;this.scrollPosition=Math.max(0,this.scrollPosition-scrollAmount),container.scrollTo({left:this.scrollPosition,behavior:"smooth"}),this._updateNavButtons()},_handleNavRight:function(){const container=this._shadow.querySelector(".phoenix-ribbon-strip");if(!container)return;const containerWidth=container.clientWidth,totalWidth=container.scrollWidth,scrollAmount=containerWidth,nearEnd=this.scrollPosition+containerWidth+scrollAmount>=totalWidth-100;nearEnd&&this.currentPage<this.totalPages&&!this._isLoadingMore&&(this._isLoadingMore=!0,this._showLoadingMore(),this._fetchImages(this._currentSearchQuery,this.currentPage+1,!0)),this.scrollPosition=Math.min(totalWidth-containerWidth,this.scrollPosition+scrollAmount),container.scrollTo({left:this.scrollPosition,behavior:"smooth"}),this._updateNavButtons()},_updateNavButtons:function(){const navLeft=this._shadow.querySelector(".phoenix-ribbon-nav.left"),navRight=this._shadow.querySelector(".phoenix-ribbon-nav.right"),container=this._shadow.querySelector(".phoenix-ribbon-strip");if(!navLeft||!navRight||!container)return;this.scrollPosition<=0?navLeft.style.display="none":navLeft.style.display="block";const containerWidth=container.clientWidth,totalWidth=container.scrollWidth,atEnd=this.scrollPosition+containerWidth>=totalWidth-10,hasMorePages=this.currentPage<this.totalPages;navRight.style.display=atEnd&&!hasMorePages?"none":"block"},_showLoading:function(){const rowElement=this._shadow.querySelector(".phoenix-ribbon-row");rowElement&&(rowElement.innerHTML="Loading images...",rowElement.className="phoenix-ribbon-row phoenix-ribbon-loading")},_showLoadingMore:function(){const rowElement=this._shadow.querySelector(".phoenix-ribbon-row");if(!rowElement)return;const loadingIndicator=window.document.createElement("div");loadingIndicator.className="phoenix-loading-more",loadingIndicator.style.cssText="\n                display: flex !important;\n                align-items: center !important;\n                justify-content: center !important;\n                min-width: 120px !important;\n                height: 116px !important;\n                margin-left: 2px !important;\n                background: rgba(255,255,255,0.03) !important;\n                border-radius: 8px !important;\n                color: #e8eaf0 !important;\n                font-size: 12px !important;\n                border: 1px dashed rgba(255,255,255,0.1) !important;\n            ",loadingIndicator.textContent="Loading...",rowElement.appendChild(loadingIndicator)},_hideLoadingMore:function(){const loadingIndicator=this._shadow.querySelector(".phoenix-loading-more");loadingIndicator&&loadingIndicator.remove()},_attachEventHandlers:function(){const ribbonContainer=this._shadow.querySelector(".phoenix-image-ribbon"),searchInput=this._shadow.querySelector(".phoenix-ribbon-search input"),searchButton=this._shadow.querySelector(".phoenix-ribbon-search-btn"),closeButton=this._shadow.querySelector(".phoenix-ribbon-close"),navLeft=this._shadow.querySelector(".phoenix-ribbon-nav.left"),navRight=this._shadow.querySelector(".phoenix-ribbon-nav.right"),selectImageBtn=this._shadow.querySelector(".phoenix-select-image-btn"),fileInput=this._shadow.querySelector(".phoenix-file-input");if(searchInput&&searchButton){const performSearch=e=>{e.stopPropagation();const query=searchInput.value.trim();query&&(this.currentPage=1,this.allImages=[],this.scrollPosition=0,this._fetchImages(query))};searchButton.addEventListener("click",performSearch),searchInput.addEventListener("keydown",e=>{"Enter"===e.key&&performSearch(e)}),searchInput.addEventListener("click",e=>{e.stopPropagation()})}selectImageBtn&&fileInput&&(selectImageBtn.addEventListener("click",e=>{e.stopPropagation(),fileInput.click()}),fileInput.addEventListener("change",e=>{e.stopPropagation();const file=e.target.files[0];file&&(this._handleLocalImageSelection(file),fileInput.value="")})),closeButton&&closeButton.addEventListener("click",e=>{e.stopPropagation(),this.remove()}),navLeft&&navLeft.addEventListener("click",e=>{e.stopPropagation(),this._handleNavLeft()}),navRight&&navRight.addEventListener("click",e=>{e.stopPropagation(),this._handleNavRight()}),ribbonContainer&&ribbonContainer.addEventListener("click",e=>{e.stopPropagation()})},_renderImages:function(images,append=!1){const rowElement=this._shadow.querySelector(".phoenix-ribbon-row");if(!rowElement)return;const container=this._shadow.querySelector(".phoenix-ribbon-strip"),savedScrollPosition=container?container.scrollLeft:0;if(append){const loadingIndicator=this._shadow.querySelector(".phoenix-loading-more");loadingIndicator&&loadingIndicator.remove()}else rowElement.innerHTML="",rowElement.className="phoenix-ribbon-row";images.forEach(image=>{const thumbDiv=window.document.createElement("div");thumbDiv.className="phoenix-ribbon-thumb";const img=window.document.createElement("img");img.src=image.thumb_url||image.url,img.alt=image.alt_text||"Unsplash image",img.loading="lazy",thumbDiv.addEventListener("mouseenter",()=>{this.element.style.width=this._originalImageStyle.width||this.maxWidth,this.element.style.height=this._originalImageStyle.height||this.maxHeight,this.element.style.objectFit=this._originalImageStyle.objectFit||"cover",this.element.src=image.url||image.thumb_url}),thumbDiv.addEventListener("mouseleave",()=>{this.element.src=this._originalImageSrc});const attribution=window.document.createElement("div");attribution.className="phoenix-ribbon-attribution";const photographer=window.document.createElement("a");photographer.className="photographer",photographer.href=image.photographer_url,photographer.target="_blank",photographer.rel="noopener noreferrer",photographer.textContent=image.user&&image.user.name||"Anonymous",photographer.addEventListener("click",e=>{e.stopPropagation()});const source=window.document.createElement("a");source.className="source",source.href=image.unsplash_url,source.target="_blank",source.rel="noopener noreferrer",source.textContent="on Unsplash",source.addEventListener("click",e=>{e.stopPropagation()}),attribution.appendChild(photographer),attribution.appendChild(source);const downloadIcon=window.document.createElement("div");downloadIcon.className="phoenix-download-icon",downloadIcon.title=config.strings.imageGalleryUseImage,downloadIcon.innerHTML='<svg viewBox="0 0 640 640" fill="currentColor">\n                  <path d="M352 96C352 78.3 337.7 64 320 64C302.3 64 288 78.3 288 96L288 306.7L246.6 265.3C234.1 252.8 213.8 252.8 201.3 265.3C188.8 277.8 188.8 298.1 201.3 310.6L297.3 406.6C309.8 419.1 330.1 419.1 342.6 406.6L438.6 310.6C451.1 298.1 451.1 277.8 438.6 265.3C426.1 252.8 405.8 252.8 393.3 265.3L352 306.7L352 96zM160 384C124.7 384 96 412.7 96 448L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 448C544 412.7 515.3 384 480 384L433.1 384L376.5 440.6C345.3 471.8 294.6 471.8 263.4 440.6L206.9 384L160 384zM464 440C477.3 440 488 450.7 488 464C488 477.3 477.3 488 464 488C450.7 488 440 477.3 440 464C440 450.7 450.7 440 464 440z"/>\n                </svg>',thumbDiv.addEventListener("click",e=>{if(e.stopPropagation(),e.preventDefault(),thumbDiv.classList.contains("downloading"))return;this._showDownloadIndicator(thumbDiv);const filename=this._generateFilename(image),extnName=".jpg",targetWidth=this._originalImageStyle.width||this.maxWidth,targetHeight=this._originalImageStyle.height||this.maxHeight,widthNum=parseInt(targetWidth),heightNum=parseInt(targetHeight),downloadUrl=image.url?`${image.url}?w=${widthNum}&h=${heightNum}&fit=crop`:image.thumb_url;this._useImage(downloadUrl,filename,".jpg",!1,thumbDiv)}),thumbDiv.appendChild(img),thumbDiv.appendChild(attribution),thumbDiv.appendChild(downloadIcon),rowElement.appendChild(thumbDiv)}),append&&container&&savedScrollPosition>0&&setTimeout(()=>{container.scrollLeft=savedScrollPosition},0)},_showError:function(message){const rowElement=this._shadow.querySelector(".phoenix-ribbon-row");rowElement&&(rowElement.innerHTML=message,rowElement.className="phoenix-ribbon-row phoenix-ribbon-error")},_generateFilename:function(image){const photographerName=image.user&&image.user.name||"Anonymous",searchTerm=this._currentSearchQuery||"image",cleanSearchTerm=searchTerm.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),cleanPhotographerName=photographerName.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");return`${cleanSearchTerm}-by-${cleanPhotographerName}`},_useImage:function(imageUrl,filename,extnName,isLocalFile,thumbDiv){const tagId=this.element.getAttribute("data-brackets-id"),messageData={livePreviewEditEnabled:!0,useImage:!0,imageUrl:imageUrl,filename:filename,extnName:extnName,element:this.element,tagId:Number(tagId)};if(isLocalFile){messageData.isLocalFile=!0;const byteCharacters=atob(imageUrl.split(",")[1]),byteNumbers=new Array(byteCharacters.length);for(let i=0;i<byteCharacters.length;i++)byteNumbers[i]=byteCharacters.charCodeAt(i);messageData.imageData=byteNumbers}window._Brackets_MessageBroker.send(messageData),thumbDiv&&setTimeout(()=>{this._hideDownloadIndicator(thumbDiv)},3e3)},_handleLocalImageSelection:function(file){if(!file||!file.type.startsWith("image/"))return;const reader=new FileReader;reader.onload=(e=>{const imageDataUrl=e.target.result,originalName=file.name,nameWithoutExt=originalName.substring(0,originalName.lastIndexOf("."))||originalName,extension=originalName.substring(originalName.lastIndexOf("."))||".jpg",cleanName=nameWithoutExt.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),filename=cleanName||"selected-image";this._useImage(imageDataUrl,filename,extension,!0,null),this.remove()}),reader.onerror=(error=>{console.error("Something went wrong when reading the image:",error)}),reader.readAsDataURL(file)},create:function(){this.remove(),this._originalImageSrc=this.element.src,this._originalImageStyle={width:window.getComputedStyle(this.element).width,height:window.getComputedStyle(this.element).height,objectFit:window.getComputedStyle(this.element).objectFit},this._style(),window.document.body.appendChild(this.body),this._attachEventHandlers();const queryToUse=_imageGalleryCache.currentQuery||this._getDefaultQuery();this._fetchImages(queryToUse),setTimeout(()=>this._updateNavButtons(),0)},remove:function(){_imageRibbonGallery=null,this.body&&this.body.parentNode&&this.body.parentNode===window.document.body&&(window.document.body.removeChild(this.body),this.body=null)},_showDownloadIndicator:function(thumbDiv){thumbDiv.classList.add("downloading");const indicator=window.document.createElement("div");indicator.className="phoenix-download-indicator";const spinner=window.document.createElement("div");spinner.className="phoenix-download-spinner",indicator.appendChild(spinner),thumbDiv.appendChild(indicator)},_hideDownloadIndicator:function(thumbDiv){thumbDiv.classList.remove("downloading");const indicator=thumbDiv.querySelector(".phoenix-download-indicator");indicator&&indicator.remove()}},Highlight.prototype={_elementExists:function(element){var i;for(i in this.elements)if(this.elements[i]===element)return!0;return!1},_makeHighlightDiv:function(element,doAnimation){var elementBounds=element.getBoundingClientRect(),highlight=window.document.createElement("div"),elementStyling=window.getComputedStyle(element),transitionDuration=parseFloat(elementStyling.getPropertyValue("transition-duration")),animationDuration=parseFloat(elementStyling.getPropertyValue("animation-duration"));if(highlight.trackingElement=element,transitionDuration&&animateHighlight(transitionDuration),animationDuration&&animateHighlight(animationDuration),0!==elementBounds.width||0!==elementBounds.height){var realElBorder={right:elementStyling.getPropertyValue("border-right-width"),left:elementStyling.getPropertyValue("border-left-width"),top:elementStyling.getPropertyValue("border-top-width"),bottom:elementStyling.getPropertyValue("border-bottom-width")},borderBox="border-box"===elementStyling.boxSizing,innerWidth=parseFloat(elementStyling.width),innerHeight=parseFloat(elementStyling.height),outerHeight=innerHeight,outerWidth=innerWidth;borderBox||(innerWidth+=parseFloat(elementStyling.paddingLeft)+parseFloat(elementStyling.paddingRight),innerHeight+=parseFloat(elementStyling.paddingTop)+parseFloat(elementStyling.paddingBottom),outerWidth=innerWidth+parseFloat(realElBorder.right)+parseFloat(realElBorder.left),outerHeight=innerHeight+parseFloat(realElBorder.bottom)+parseFloat(realElBorder.top));var visualisations={horizontal:"left, right",vertical:"top, bottom"},drawPaddingRect=function(side){var elStyling={};return visualisations.horizontal.indexOf(side)>=0?(elStyling.width=elementStyling.getPropertyValue("padding-"+side),elStyling.height=innerHeight+"px",elStyling.top=0,borderBox&&(elStyling.height=innerHeight-parseFloat(realElBorder.top)-parseFloat(realElBorder.bottom)+"px")):(elStyling.height=elementStyling.getPropertyValue("padding-"+side),elStyling.width=innerWidth+"px",elStyling.left=0,borderBox&&(elStyling.width=innerWidth-parseFloat(realElBorder.left)-parseFloat(realElBorder.right)+"px")),elStyling[side]=0,elStyling.position="absolute",elStyling},drawMarginRect=function(side){var elStyling={},margin=[];return margin.right=parseFloat(elementStyling.getPropertyValue("margin-right")),margin.top=parseFloat(elementStyling.getPropertyValue("margin-top")),margin.bottom=parseFloat(elementStyling.getPropertyValue("margin-bottom")),margin.left=parseFloat(elementStyling.getPropertyValue("margin-left")),visualisations.horizontal.indexOf(side)>=0?(elStyling.width=elementStyling.getPropertyValue("margin-"+side),elStyling.height=outerHeight+margin.top+margin.bottom+"px",elStyling.top="-"+(margin.top+parseFloat(realElBorder.top))+"px"):(elStyling.height=elementStyling.getPropertyValue("margin-"+side),elStyling.width=outerWidth+"px",elStyling.left="-"+realElBorder.left),elStyling[side]="-"+(margin[side]+parseFloat(realElBorder[side]))+"px",elStyling.position="absolute",elStyling},setVisibility=function(el){!config.remoteHighlight.showPaddingMargin||parseInt(el.height,10)<=0||parseInt(el.width,10)<=0?el.display="none":el.display="block"},mainBoxStyles=config.remoteHighlight.stylesToSet,paddingVisualisations=[drawPaddingRect("top"),drawPaddingRect("right"),drawPaddingRect("bottom"),drawPaddingRect("left")],marginVisualisations,setupVisualisations=function(arr,config){var i;for(i=0;i<arr.length;i++){setVisibility(arr[i]),arr[i].transform="none";var el=window.document.createElement("div"),styles;_setStyleValues(Object.assign({},config,arr[i]),el.style),highlight.appendChild(el)}};setupVisualisations([drawMarginRect("top"),drawMarginRect("right"),drawMarginRect("bottom"),drawMarginRect("left")],config.remoteHighlight.marginStyling),setupVisualisations(paddingVisualisations,config.remoteHighlight.paddingStyling),highlight.className=HIGHLIGHT_CLASSNAME;var offset=_screenOffset(element),stylesToSet={left:offset.left+"px",top:offset.top+"px",width:elementBounds.width+"px",height:elementBounds.height+"px","z-index":2147483647,margin:0,padding:0,position:"absolute","pointer-events":"none","box-shadow":"0 0 1px #fff","box-sizing":elementStyling.getPropertyValue("box-sizing"),"border-right":elementStyling.getPropertyValue("border-right"),"border-left":elementStyling.getPropertyValue("border-left"),"border-top":elementStyling.getPropertyValue("border-top"),"border-bottom":elementStyling.getPropertyValue("border-bottom"),"border-color":config.remoteHighlight.borderColor},mergedStyles=Object.assign({},stylesToSet,config.remoteHighlight.stylesToSet),animateStartValues=config.remoteHighlight.animateStartValue,animateEndValues=config.remoteHighlight.animateEndValue,transitionValues={"transition-property":"opacity, background-color, transform","transition-duration":"300ms, 2.3s"};_setStyleValues(mergedStyles,highlight.style),_setStyleValues(doAnimation?animateStartValues:animateEndValues,highlight.style),doAnimation&&(_setStyleValues(transitionValues,highlight.style),window.setTimeout(function(){_setStyleValues(animateEndValues,highlight.style)},20)),window.document.body.appendChild(highlight)}function _setStyleValues(styleValues,obj){var prop;for(prop in styleValues)obj.setProperty(prop,styleValues[prop])}},add:function(element,doAnimation,shouldAutoScroll){if(!this._elementExists(element)&&element!==window.document){if(this.trigger&&_trigger(element,"highlight",1),shouldAutoScroll&&(!window.event||window.event instanceof MessageEvent)&&!isInViewport(element)){var top=getDocumentOffsetTop(element);top&&(top-=window.innerHeight/2,window.scrollTo(0,top))}this.elements.push(element),this._makeHighlightDiv(element,doAnimation)}},clear:function(){var i,highlights=window.document.querySelectorAll("."+HIGHLIGHT_CLASSNAME),body=window.document.body;for(i=0;i<highlights.length;i++)body.removeChild(highlights[i]);if(this.trigger)for(i=0;i<this.elements.length;i++)_trigger(this.elements[i],"highlight",0);this.elements=[]},redraw:function(){var i,highlighted;for(highlighted=this.selector?window.document.querySelectorAll(this.selector):this.elements.slice(0),this.clear(),i=0;i<highlighted.length;i++)this.add(highlighted[i],!1,!1)}};var _setup=!1;function onMouseOver(event){if(_validEvent(event)){const element=event.target;isElementEditable(element)&&element.nodeType===Node.ELEMENT_NODE&&_localHighlight.add(element,!0,!1)}}function onMouseOut(event){_validEvent(event)&&_localHighlight.clear()}function onMouseMove(event){onMouseOver(event),window.document.removeEventListener("mousemove",onMouseMove)}function getHighlightMode(){return config.elemHighlights?config.elemHighlights.toLowerCase():"hover"}function shouldShowHighlightOnHover(){return"click"!==getHighlightMode()}function shouldShowImageRibbon(){return!_imageRibbonGallery&&!1!==config.imageRibbon}function clearElementBackground(element){if(void 0!==element._originalBackgroundColor)element.style.backgroundColor=element._originalBackgroundColor;else{const currentBg=element.style.backgroundColor;("rgba(0, 162, 255, 0.2)"===currentBg||currentBg.includes("rgba(0, 162, 255"))&&(element.style.backgroundColor="")}delete element._originalBackgroundColor}function onElementHover(event){if(_isAutoScrolling)return;const element=event.target;if(!isElementEditable(element)||element.nodeType!==Node.ELEMENT_NODE)return!1;!_hoverHighlight&&shouldShowHighlightOnHover()&&(_hoverHighlight=new Highlight("#c8f9c5",!0)),_hoverHighlight&&shouldShowHighlightOnHover()&&(_hoverHighlight.clear(),element._originalBackgroundColor=element.style.backgroundColor,element.style.backgroundColor="rgba(0, 162, 255, 0.2)",_hoverHighlight.add(element,!1,!1),dismissNodeInfoBox(),_nodeInfoBox=new NodeInfoBox(element))}function onElementHoverOut(event){if(_isAutoScrolling)return;const element=event.target;isElementEditable(element)&&element.nodeType===Node.ELEMENT_NODE&&_hoverHighlight&&shouldShowHighlightOnHover()&&(_hoverHighlight.clear(),clearElementBackground(element),dismissNodeInfoBox())}function _selectElement(element){if(dismissUIAndCleanupState(),dismissImageRibbonGallery(),!isElementEditable(element))return!1;isElementVisible(element)?(_nodeMoreOptionsBox=new NodeMoreOptionsBox(element),_nodeInfoBox=new NodeInfoBox(element)):_nodeMoreOptionsBox=null,element&&"img"===element.tagName.toLowerCase()&&shouldShowImageRibbon()&&(_imageRibbonGallery||(_imageRibbonGallery=new ImageRibbonGallery(element))),element._originalOutline=element.style.outline,element.style.outline="1px solid #4285F4",void 0===element._originalBackgroundColor&&(element._originalBackgroundColor=element.style.backgroundColor),element.style.backgroundColor="rgba(0, 162, 255, 0.2)",_hoverHighlight&&(_hoverHighlight.clear(),_hoverHighlight.add(element,!0,!1)),previouslyClickedElement=element}function onClick(event){const element=event.target;isElementEditable(element)&&(event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation())}function onDoubleClick(event){const element=event.target;isElementEditable(element)&&_shouldShowEditTextOption(element)&&(event.preventDefault(),event.stopPropagation(),startEditing(element))}function onKeyUp(event){_setup&&!_validEvent(event)&&(window.document.removeEventListener("keyup",onKeyUp),window.document.removeEventListener("mouseover",onMouseOver),window.document.removeEventListener("mouseout",onMouseOut),window.document.removeEventListener("mousemove",onMouseMove),_localHighlight.clear(),_localHighlight=void 0,_setup=!1)}function onKeyDown(event){!_setup&&_validEvent(event)&&(window.document.addEventListener("keyup",onKeyUp),window.document.addEventListener("mouseover",onMouseOver),window.document.addEventListener("mouseout",onMouseOut),window.document.addEventListener("mousemove",onMouseMove),window.document.addEventListener("click",onClick),_localHighlight=new Highlight("#ecc",!0),_setup=!0)}function hideHighlight(){_clickHighlight&&(_clickHighlight.clear(),_clickHighlight=null),_hoverHighlight&&_hoverHighlight.clear()}function highlight(element,clear){_clickHighlight||(_clickHighlight=new Highlight("#cfc")),clear&&_clickHighlight.clear(),isElementEditable(element,!0)&&element.nodeType===Node.ELEMENT_NODE&&_clickHighlight.add(element,!0,!0)}function highlightRule(rule){hideHighlight();var i,nodes=window.document.querySelectorAll(rule);for(i=0;i<nodes.length;i++)highlight(nodes[i]);_clickHighlight&&(_clickHighlight.selector=rule);var foundValidElement=!1;for(i=0;i<nodes.length;i++)if(isElementEditable(nodes[i],!0)&&"BR"!==nodes[i].tagName){_selectElement(nodes[i]),foundValidElement=!0;break}foundValidElement||(dismissUIAndCleanupState(),dismissImageRibbonGallery())}function redrawUIBoxes(){if(_nodeMoreOptionsBox){const element=_nodeMoreOptionsBox.element;_nodeMoreOptionsBox.remove(),_nodeMoreOptionsBox=new NodeMoreOptionsBox(element),_nodeInfoBox&&(dismissNodeInfoBox(),_nodeInfoBox=new NodeInfoBox(element))}if(_aiPromptBox){const element=_aiPromptBox.element;_aiPromptBox.remove(),_aiPromptBox=new AIPromptBox(element)}}function redrawHighlights(){_clickHighlight&&_clickHighlight.redraw(),_hoverHighlight&&_hoverHighlight.redraw()}function redrawEverything(){redrawHighlights(),redrawUIBoxes()}function _dismissBoxesForFixedElements(){if(_nodeMoreOptionsBox&&_nodeMoreOptionsBox.element){const moreOptionsBoxElement=_nodeMoreOptionsBox._shadow.querySelector(".phoenix-more-options-box");if(moreOptionsBoxElement){const moreOptionsBoxBounds=moreOptionsBoxElement.getBoundingClientRect(),elementBounds=_nodeMoreOptionsBox.element.getBoundingClientRect();if(_nodeMoreOptionsBox._possDifference){const calcNewDifference=moreOptionsBoxBounds.top-elementBounds.top,prevDifference=_nodeMoreOptionsBox._possDifference;Math.abs(calcNewDifference-prevDifference)>4&&dismissUIAndCleanupState()}else _nodeMoreOptionsBox._possDifference=moreOptionsBoxBounds.top-elementBounds.top}}else if(_nodeInfoBox&&_nodeInfoBox.element){const infoBoxElement=_nodeInfoBox._shadow.querySelector(".phoenix-node-info-box");if(infoBoxElement)if(_nodeInfoBox._prevElement){if(_nodeInfoBox._prevElement!==_nodeInfoBox.element)return;{const infoBoxBounds=infoBoxElement.getBoundingClientRect(),elementBounds=_nodeInfoBox.element.getBoundingClientRect();if(_nodeInfoBox._possDifference){const calcNewDifference=infoBoxBounds.top-elementBounds.top,prevDifference=_nodeInfoBox._possDifference;Math.abs(calcNewDifference-prevDifference)>4&&dismissUIAndCleanupState()}else _nodeInfoBox._possDifference=infoBoxBounds.top-elementBounds.top}}else _nodeInfoBox._prevElement=_nodeInfoBox.element}}function _scrollHandler(e){e.target===window.document?(redrawHighlights(),_dismissBoxesForFixedElements()):((_localHighlight||_clickHighlight||_hoverHighlight)&&window.setTimeout(redrawHighlights,0),_dismissBoxesForFixedElements())}function DOMEditHandler(htmlDocument){this.htmlDocument=htmlDocument,this.rememberedNodes=null,this.entityParseParent=htmlDocument.createElement("div")}function _isRawTextNode(node){return node.nodeType===Node.ELEMENT_NODE&&/script|style|noscript|noframes|noembed|iframe|xmp/i.test(node.tagName)}function applyDOMEdits(edits){_editHandler.apply(edits)}function updateConfig(newConfig){const oldConfig=config;config=JSON.parse(newConfig);const oldHighlightMode=oldConfig.elemHighlights?oldConfig.elemHighlights.toLowerCase():"hover",newHighlightMode=getHighlightMode(),highlightModeChanged=oldHighlightMode!==newHighlightMode,isProStatusChanged=oldConfig.isProUser!==config.isProUser,highlightSettingChanged=oldConfig.highlight!==config.highlight,imageRibbonJustEnabled=!oldConfig.imageRibbon&&config.imageRibbon;return(highlightModeChanged||isProStatusChanged||highlightSettingChanged)&&_handleConfigurationChange(),imageRibbonJustEnabled&&previouslyClickedElement&&"img"===previouslyClickedElement.tagName.toLowerCase()&&(_imageRibbonGallery||(_imageRibbonGallery=new ImageRibbonGallery(previouslyClickedElement))),_updateEventListeners(),JSON.stringify(config)}function _handleConfigurationChange(){_hoverHighlight&&_hoverHighlight.clear(),cleanupPreviousElementState();const allElements=window.document.querySelectorAll("[data-brackets-id]");for(let i=0;i<allElements.length;i++)void 0!==allElements[i]._originalBackgroundColor&&clearElementBackground(allElements[i]);dismissUIAndCleanupState()}function _updateEventListeners(){window.document.removeEventListener("mouseover",onElementHover),window.document.removeEventListener("mouseout",onElementHoverOut),(config.highlight||config.isProUser&&shouldShowHighlightOnHover())&&(window.document.addEventListener("mouseover",onElementHover),window.document.addEventListener("mouseout",onElementHoverOut))}function hasVisibleLivePreviewBoxes(){return null!==_nodeMoreOptionsBox||null!==_nodeInfoBox||null!==_aiPromptBox||null!==previouslyClickedElement}function dismissNodeMoreOptionsBox(){return!!_nodeMoreOptionsBox&&(_nodeMoreOptionsBox.remove(),_nodeMoreOptionsBox=null,!0)}function dismissNodeInfoBox(){return!!_nodeInfoBox&&(_nodeInfoBox.remove(),_nodeInfoBox=null,!0)}function dismissAIPromptBox(){return!!_aiPromptBox&&(_aiPromptBox.remove(),_aiPromptBox=null,!0)}function dismissImageRibbonGallery(){return!!_imageRibbonGallery&&(_imageRibbonGallery.remove(),_imageRibbonGallery=null,!0)}function dismissAllUIBoxes(){let dismissed=!1;return dismissed=dismissNodeMoreOptionsBox()||dismissed,dismissed=dismissAIPromptBox()||dismissed,dismissed=dismissNodeInfoBox()||dismissed}function cleanupPreviousElementState(){return!!previouslyClickedElement&&(void 0!==previouslyClickedElement._originalOutline?previouslyClickedElement.style.outline=previouslyClickedElement._originalOutline:previouslyClickedElement.style.outline="",delete previouslyClickedElement._originalOutline,clearElementBackground(previouslyClickedElement),_hoverHighlight&&_hoverHighlight.clear(),previouslyClickedElement=null,!0)}function dismissUIAndCleanupState(){let dismissed=!1;return dismissed=dismissAllUIBoxes()||dismissed,dismissed=cleanupPreviousElementState()||dismissed}function moveCursorToEnd(selection,element){const range=document.createRange();range.selectNodeContents(element),range.collapse(!1),selection.removeAllRanges(),selection.addRange(range)}function startEditing(element){if(!isElementEditable(element))return;element.setAttribute("contenteditable","true"),element.focus();const oldContent=element.textContent,selection=window.getSelection();(0===selection.rangeCount||selection.isCollapsed)&&moveCursorToEnd(selection,element),dismissUIAndCleanupState();let isEscapePressed=!1;function onBlur(){setTimeout(()=>{if(isEscapePressed)return isEscapePressed=!1,void finishEditingCleanup(element);const newContent=element.textContent;oldContent!==newContent?finishEditing(element):finishEditingCleanup(element)},10)}function onKeyDown(event){if("Escape"===event.key){isEscapePressed=!0,event.preventDefault();const newContent=element.textContent;oldContent!==newContent?finishEditing(element,!1):finishEditingCleanup(element)}else"Enter"!==event.key||event.shiftKey?" "!==event.key&&"Spacebar"!==event.key||"button"!==element.tagName.toLowerCase()||(event.preventDefault(),document.execCommand("insertText",!1," ")):(isEscapePressed=!1,event.preventDefault(),finishEditing(element))}element.addEventListener("blur",onBlur),element.addEventListener("keydown",onKeyDown),element._editListeners={blur:onBlur,keydown:onKeyDown}}function finishEditingCleanup(element){isElementEditable(element)&&element.hasAttribute("contenteditable")&&(element.removeAttribute("contenteditable"),dismissUIAndCleanupState(),element._editListeners&&(element.removeEventListener("blur",element._editListeners.blur),element.removeEventListener("keydown",element._editListeners.keydown),delete element._editListeners))}function finishEditing(element,isEditSuccessful=!0){finishEditingCleanup(element);const tagId=element.getAttribute("data-brackets-id");window._Brackets_MessageBroker.send({livePreviewEditEnabled:!0,livePreviewTextEdit:!0,element:element,newContent:element.outerHTML,tagId:Number(tagId),isEditSuccessful:isEditSuccessful})}function registerHandlers(){window.document.removeEventListener("mouseover",onElementHover),window.document.removeEventListener("mouseout",onElementHoverOut),window.document.removeEventListener("click",onClick),window.document.removeEventListener("dblclick",onDoubleClick),window.document.removeEventListener("dragover",onDragOver),window.document.removeEventListener("drop",onDrop),window.document.removeEventListener("dragleave",onDragLeave),window.document.removeEventListener("keydown",onKeyDown),config.isProUser?(_hoverHighlight=new Highlight("#c8f9c5",!0),_clickHighlight=new Highlight("#cfc",!0),window.document.addEventListener("mouseover",onElementHover),window.document.addEventListener("mouseout",onElementHoverOut),window.document.addEventListener("click",onClick),window.document.addEventListener("dblclick",onDoubleClick),window.document.addEventListener("dragover",onDragOver),window.document.addEventListener("drop",onDrop),window.document.addEventListener("dragleave",onDragLeave),window.document.addEventListener("keydown",onKeyDown)):dismissUIAndCleanupState()}return window.addEventListener("resize",redrawEverything),window.addEventListener("scroll",_scrollHandler,!0),DOMEditHandler.prototype._queryBracketsID=function(id){if(!id)return null;if(this.rememberedNodes&&this.rememberedNodes[id])return this.rememberedNodes[id];var results=this.htmlDocument.querySelectorAll("[data-brackets-id='"+id+"']");return results&&results[0]},DOMEditHandler.prototype._insertChildNode=function(targetElement,childElement,edit){var before=this._queryBracketsID(edit.beforeID),after=this._queryBracketsID(edit.afterID);edit.firstChild?before=targetElement.firstChild:edit.lastChild&&(after=targetElement.lastChild),before?targetElement.insertBefore(childElement,before):after&&after!==targetElement.lastChild?targetElement.insertBefore(childElement,after.nextSibling):targetElement.appendChild(childElement)},DOMEditHandler.prototype._parseEntities=function(text){var result;return this.entityParseParent.innerHTML=text,result=this.entityParseParent.textContent,this.entityParseParent.textContent="",result},DOMEditHandler.prototype._textReplace=function(targetElement,edit){function prevIgnoringHighlights(node){do{node=node.previousSibling}while(node&&node.className===HIGHLIGHT_CLASSNAME);return node}function nextIgnoringHighlights(node){do{node=node.nextSibling}while(node&&node.className===HIGHLIGHT_CLASSNAME);return node}function lastChildIgnoringHighlights(node){return(node=node.childNodes.length?node.childNodes.item(node.childNodes.length-1):null)&&node.className===HIGHLIGHT_CLASSNAME&&(node=prevIgnoringHighlights(node)),node}for(var start=edit.afterID?this._queryBracketsID(edit.afterID):null,startMissing=edit.afterID&&!start,end=edit.beforeID?this._queryBracketsID(edit.beforeID):null,endMissing=edit.beforeID&&!end,moveNext=start&&nextIgnoringHighlights(start),current=moveNext||end&&prevIgnoringHighlights(end)||lastChildIgnoringHighlights(targetElement),next,textNode=void 0!==edit.content?this.htmlDocument.createTextNode(_isRawTextNode(targetElement)?edit.content:this._parseEntities(edit.content)):null,lastRemovedWasText,isText;current&&current!==end&&(isText=current.nodeType===Node.TEXT_NODE,next=moveNext?nextIgnoringHighlights(current):prevIgnoringHighlights(current),!(current.nodeType===Node.ELEMENT_NODE||(startMissing||endMissing)&&isText&&lastRemovedWasText));)lastRemovedWasText=isText,current.remove?current.remove():current.parentNode&&current.parentNode.removeChild&&current.parentNode.removeChild(current),current=next;textNode&&(start&&start.nextSibling?targetElement.insertBefore(textNode,start.nextSibling):end?targetElement.insertBefore(textNode,end):targetElement.appendChild(textNode))},DOMEditHandler.prototype.apply=function(edits){var targetID,targetElement,childElement,self=this;this.rememberedNodes={},edits.forEach(function(edit){var editIsSpecialTag="elementInsert"===edit.type&&("html"===edit.tag||"head"===edit.tag||"body"===edit.tag);if("rememberNodes"!==edit.type)if(targetID=edit.type.match(/textReplace|textDelete|textInsert|elementInsert|elementMove/)?edit.parentID:edit.tagID,(targetElement=self._queryBracketsID(targetID))||editIsSpecialTag)switch(edit.type){case"attrChange":case"attrAdd":targetElement.setAttribute(edit.attribute,self._parseEntities(edit.value));break;case"attrDelete":targetElement.removeAttribute(edit.attribute);break;case"elementDelete":targetElement.remove?targetElement.remove():targetElement.parentNode&&targetElement.parentNode.removeChild&&targetElement.parentNode.removeChild(targetElement);break;case"elementInsert":childElement=null,editIsSpecialTag&&((childElement=self.htmlDocument["html"===edit.tag?"documentElement":edit.tag])||(editIsSpecialTag=!1)),editIsSpecialTag||(childElement=self.htmlDocument.createElement(edit.tag)),Object.keys(edit.attributes).forEach(function(attr){childElement.setAttribute(attr,self._parseEntities(edit.attributes[attr]))}),childElement.setAttribute("data-brackets-id",edit.tagID),editIsSpecialTag||self._insertChildNode(targetElement,childElement,edit);break;case"elementMove":childElement=self._queryBracketsID(edit.tagID),self._insertChildNode(targetElement,childElement,edit);break;case"textInsert":var textElement=self.htmlDocument.createTextNode(_isRawTextNode(targetElement)?edit.content:self._parseEntities(edit.content));self._insertChildNode(targetElement,textElement,edit);break;case"textReplace":case"textDelete":self._textReplace(targetElement,edit)}else console.error("data-brackets-id="+targetID+" not found");else edit.tagIDs.forEach(function(tagID){var node=self._queryBracketsID(tagID);self.rememberedNodes[tagID]=node,node.remove?node.remove():node.parentNode&&node.parentNode.removeChild&&node.parentNode.removeChild(node)})}),this.rememberedNodes={},redrawEverything()},_editHandler=new DOMEditHandler(window.document),registerHandlers(),{DOMEditHandler:DOMEditHandler,hideHighlight:hideHighlight,highlight:highlight,highlightRule:highlightRule,redrawHighlights:redrawHighlights,redrawEverything:redrawEverything,applyDOMEdits:applyDOMEdits,updateConfig:updateConfig,startEditing:startEditing,finishEditing:finishEditing,hasVisibleLivePreviewBoxes:hasVisibleLivePreviewBoxes,dismissUIAndCleanupState:dismissUIAndCleanupState,dismissImageRibbonGallery:dismissImageRibbonGallery,registerHandlers:registerHandlers}}
//# sourceMappingURL=RemoteFunctions.js.map
