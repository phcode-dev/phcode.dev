define(function main(require,exports,module){const Commands=require("command/Commands"),AppInit=require("utils/AppInit"),MultiBrowserLiveDev=require("LiveDevelopment/LiveDevMultiBrowser"),LivePreviewTransport=require("LiveDevelopment/MultiBrowserImpl/transports/LivePreviewTransport"),CommandManager=require("command/CommandManager"),PreferencesManager=require("preferences/PreferencesManager"),UrlParams=require("utils/UrlParams").UrlParams,Strings=require("strings"),ExtensionUtils=require("utils/ExtensionUtils"),StringUtils=require("utils/StringUtils"),EventDispatcher=require("utils/EventDispatcher"),WorkspaceManager=require("view/WorkspaceManager"),EditorManager=require("editor/EditorManager");let isProUser=!!window.KernalModeTrust,isFreeTrialUser=!0;const EVENT_LIVE_HIGHLIGHT_PREF_CHANGED="liveHighlightPrefChange";var params=new UrlParams,config={experimental:!1,debug:!0,highlight:!0,highlightConfig:{borderColor:{r:255,g:229,b:153,a:.66},contentColor:{r:111,g:168,b:220,a:.55},marginColor:{r:246,g:178,b:107,a:.66},paddingColor:{r:147,g:196,b:125,a:.66},showInfo:!0},isProUser:isProUser,elemHighlights:"hover",imageRibbon:!0,strings:{selectParent:Strings.LIVE_DEV_MORE_OPTIONS_SELECT_PARENT,editText:Strings.LIVE_DEV_MORE_OPTIONS_EDIT_TEXT,duplicate:Strings.LIVE_DEV_MORE_OPTIONS_DUPLICATE,delete:Strings.LIVE_DEV_MORE_OPTIONS_DELETE,ai:Strings.LIVE_DEV_MORE_OPTIONS_AI,aiPromptPlaceholder:Strings.LIVE_DEV_AI_PROMPT_PLACEHOLDER,imageGalleryUseImage:Strings.LIVE_DEV_IMAGE_GALLERY_USE_IMAGE,imageGallerySelectFromComputer:Strings.LIVE_DEV_IMAGE_GALLERY_SELECT_FROM_COMPUTER,imageGalleryChooseFolder:Strings.LIVE_DEV_IMAGE_GALLERY_CHOOSE_FOLDER,imageGallerySearchPlaceholder:Strings.LIVE_DEV_IMAGE_GALLERY_SEARCH_PLACEHOLDER}},_status,_allStatusStyles=["warning","info","success","out-of-sync","sync-error"].join(" "),_$btnGoLive,prefs=PreferencesManager.getExtensionPrefs("livedev"),PREF_REMOTEHIGHLIGHT="remoteHighlight",remoteHighlightPref=prefs.definePreference("remoteHighlight","object",{animateStartValue:{"background-color":"rgba(0, 162, 255, 0.5)",opacity:0},animateEndValue:{"background-color":"rgba(0, 162, 255, 0)",opacity:.6},paddingStyling:{"background-color":"rgba(200, 249, 197, 0.7)"},marginStyling:{"background-color":"rgba(249, 204, 157, 0.7)"},borderColor:"rgba(200, 249, 197, 0.85)",showPaddingMargin:!0},{description:Strings.DESCRIPTION_LIVE_DEV_HIGHLIGHT_SETTINGS});function _loadStyles(){var lessText=require("text!LiveDevelopment/main.less");less.render(lessText,function onParse(err,tree){console.assert(!err,err),ExtensionUtils.addEmbeddedStyleSheet(tree.css)})}function _setLabel($btn,text,style,tooltip){$("span",$btn).remove(),$btn.removeClass(_allStatusStyles),text&&text.length>0?$('<span class="label">').addClass(style).text(text).appendTo($btn):$btn.addClass(style),tooltip&&$btn.attr("title",tooltip)}function closeLivePreview(){MultiBrowserLiveDev.close()}function openLivePreview(doc){Phoenix.isTestWindow||MultiBrowserLiveDev.open(doc)}function isInactive(){return MultiBrowserLiveDev.status===MultiBrowserLiveDev.STATUS_INACTIVE}function isActive(){return MultiBrowserLiveDev.status===MultiBrowserLiveDev.STATUS_ACTIVE}function setLivePreviewPinned(urlPinned,currentPinnedFilePath){MultiBrowserLiveDev.setLivePreviewPinned(urlPinned,currentPinnedFilePath)}function setLivePreviewTransportBridge(transportBridge){LivePreviewTransport.setLivePreviewTransportBridge(transportBridge)}function _showStatusChangeReason(reason){if(_$btnGoLive.twipsy("hide").removeData("twipsy"),reason&&"explicit_close"!==reason){var translatedReason=Strings["LIVE_DEV_"+reason.toUpperCase()];translatedReason||(translatedReason=StringUtils.format(Strings.LIVE_DEV_CLOSED_UNKNOWN_REASON,reason));var options={placement:"left",trigger:"manual",autoHideDelay:5e3,title:function(){return translatedReason}};_$btnGoLive.twipsy(options).twipsy("show")}}function _setupGoLiveButton(){_$btnGoLive||(_$btnGoLive=$("#toolbar-go-live")),MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_STATUS_CHANGE,function statusChange(event,status,reason){_setLabel(_$btnGoLive,null,_status[status+1].style,_status[status+1].tooltip),_showStatusChangeReason(reason)}),_setLabel(_$btnGoLive,null,_status[1].style,_status[1].tooltip)}function _setupGoLiveMenu(){MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_STATUS_CHANGE,function statusChange(event,status){CommandManager.get(Commands.FILE_LIVE_FILE_PREVIEW).setChecked(status===MultiBrowserLiveDev.STATUS_ACTIVE),CommandManager.get(Commands.FILE_LIVE_HIGHLIGHT).setEnabled(status===MultiBrowserLiveDev.STATUS_ACTIVE)})}function _updateHighlightCheckmark(){CommandManager.get(Commands.FILE_LIVE_HIGHLIGHT).setChecked(config.highlight),exports.trigger(EVENT_LIVE_HIGHLIGHT_PREF_CHANGED,config.highlight)}function togglePreviewHighlight(){config.highlight=!config.highlight,_updateHighlightCheckmark(),config.highlight?MultiBrowserLiveDev.showHighlight():MultiBrowserLiveDev.hideHighlight(),PreferencesManager.setViewState("livedevHighlight",config.highlight)}function _setupDebugHelpers(){window.report=function report(params){window.params=params,console.info(params)}}function _handleReloadLivePreviewCommand(){MultiBrowserLiveDev.status>=MultiBrowserLiveDev.STATUS_ACTIVE&&MultiBrowserLiveDev.reload()}function _handleLivePreviewEscapeKey(event){return MultiBrowserLiveDev.status===MultiBrowserLiveDev.STATUS_ACTIVE&&MultiBrowserLiveDev.dismissLivePreviewBoxes(),!1}function setLivePreviewEditFeaturesActive(enabled){isProUser=enabled,config.isProUser=enabled,MultiBrowserLiveDev&&MultiBrowserLiveDev.status>=MultiBrowserLiveDev.STATUS_ACTIVE&&(MultiBrowserLiveDev.updateConfig(JSON.stringify(config)),MultiBrowserLiveDev.registerHandlers())}function updateElementHighlightConfig(){const prefValue=PreferencesManager.get("livePreviewElementHighlights");config.elemHighlights=prefValue||"hover",MultiBrowserLiveDev&&MultiBrowserLiveDev.status>=MultiBrowserLiveDev.STATUS_ACTIVE&&(MultiBrowserLiveDev.updateConfig(JSON.stringify(config)),MultiBrowserLiveDev.registerHandlers())}function updateImageRibbonConfig(){const prefValue=PreferencesManager.get("livePreviewImagePicker");config.imageRibbon=!1!==prefValue,MultiBrowserLiveDev&&MultiBrowserLiveDev.status>=MultiBrowserLiveDev.STATUS_ACTIVE&&(prefValue||MultiBrowserLiveDev.dismissImageRibbonGallery(),MultiBrowserLiveDev.updateConfig(JSON.stringify(config)),MultiBrowserLiveDev.registerHandlers())}AppInit.appReady(function(){params.parse(),config.remoteHighlight=prefs.get("remoteHighlight"),MultiBrowserLiveDev.init(config),_loadStyles(),_updateHighlightCheckmark(),_status=[{tooltip:Strings.LIVE_DEV_STATUS_TIP_NOT_CONNECTED,style:"warning"},{tooltip:Strings.LIVE_DEV_STATUS_TIP_NOT_CONNECTED,style:""},{tooltip:Strings.LIVE_DEV_STATUS_TIP_PROGRESS1,style:"info"},{tooltip:Strings.LIVE_DEV_STATUS_TIP_CONNECTED,style:"success"},{tooltip:Strings.LIVE_DEV_STATUS_TIP_OUT_OF_SYNC,style:"out-of-sync"},{tooltip:Strings.LIVE_DEV_STATUS_TIP_SYNC_ERROR,style:"sync-error"},{tooltip:Strings.LIVE_DEV_STATUS_TIP_PROGRESS1,style:"info"},{tooltip:Strings.LIVE_DEV_STATUS_TIP_PROGRESS1,style:"info"}],_setupGoLiveButton(),_setupGoLiveMenu(),config.debug&&_setupDebugHelpers(),remoteHighlightPref.on("change",function(){config.remoteHighlight=prefs.get("remoteHighlight"),MultiBrowserLiveDev&&MultiBrowserLiveDev.status>=MultiBrowserLiveDev.STATUS_ACTIVE&&MultiBrowserLiveDev.updateConfig(JSON.stringify(config))}),MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_OPEN_PREVIEW_URL,function(event,previewDetails){exports.trigger(exports.EVENT_OPEN_PREVIEW_URL,previewDetails)}),MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_CONNECTION_CLOSE,function(event,{clientId:clientId}){exports.trigger(exports.EVENT_CONNECTION_CLOSE,{clientId:clientId})}),MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_CLICKED,function(_event,clickDetails){exports.trigger(exports.EVENT_LIVE_PREVIEW_CLICKED,clickDetails)}),MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_RELOAD,function(_event,clientDetails){exports.trigger(exports.EVENT_LIVE_PREVIEW_RELOAD,clientDetails)}),WorkspaceManager.addEscapeKeyEventHandler("livePreview",_handleLivePreviewEscapeKey)}),PreferencesManager.stateManager.definePreference("livedevHighlight","boolean",!0).on("change",function(){config.highlight=PreferencesManager.getViewState("livedevHighlight"),_updateHighlightCheckmark(),MultiBrowserLiveDev&&MultiBrowserLiveDev.status>=MultiBrowserLiveDev.STATUS_ACTIVE&&MultiBrowserLiveDev.updateConfig(JSON.stringify(config))}),config.highlight=PreferencesManager.getViewState("livedevHighlight"),CommandManager.register(Strings.CMD_LIVE_HIGHLIGHT,Commands.FILE_LIVE_HIGHLIGHT,togglePreviewHighlight),CommandManager.register(Strings.CMD_RELOAD_LIVE_PREVIEW,Commands.CMD_RELOAD_LIVE_PREVIEW,_handleReloadLivePreviewCommand),CommandManager.get(Commands.FILE_LIVE_HIGHLIGHT).setEnabled(!1),EventDispatcher.makeEventDispatcher(exports),exports.isProUser=isProUser,exports.isFreeTrialUser=!0,exports.EVENT_OPEN_PREVIEW_URL=MultiBrowserLiveDev.EVENT_OPEN_PREVIEW_URL,exports.EVENT_CONNECTION_CLOSE=MultiBrowserLiveDev.EVENT_CONNECTION_CLOSE,exports.EVENT_LIVE_PREVIEW_CLICKED=MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_CLICKED,exports.EVENT_LIVE_PREVIEW_RELOAD=MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_RELOAD,exports.EVENT_LIVE_HIGHLIGHT_PREF_CHANGED=EVENT_LIVE_HIGHLIGHT_PREF_CHANGED,exports.openLivePreview=openLivePreview,exports.closeLivePreview=closeLivePreview,exports.isInactive=isInactive,exports.isActive=isActive,exports.setLivePreviewPinned=setLivePreviewPinned,exports.setLivePreviewTransportBridge=setLivePreviewTransportBridge,exports.togglePreviewHighlight=togglePreviewHighlight,exports.setLivePreviewEditFeaturesActive=setLivePreviewEditFeaturesActive,exports.updateElementHighlightConfig=updateElementHighlightConfig,exports.updateImageRibbonConfig=updateImageRibbonConfig,exports.getConnectionIds=MultiBrowserLiveDev.getConnectionIds,exports.getLivePreviewDetails=MultiBrowserLiveDev.getLivePreviewDetails,exports.hideHighlight=MultiBrowserLiveDev.hideHighlight,exports.dismissLivePreviewBoxes=MultiBrowserLiveDev.dismissLivePreviewBoxes});
//# sourceMappingURL=main.js.map
