{"version":3,"sources":["LiveDevelopment/main.js"],"names":["define","main","require","exports","module","Commands","AppInit","MultiBrowserLiveDev","LivePreviewTransport","CommandManager","PreferencesManager","UrlParams","Strings","ExtensionUtils","StringUtils","EventDispatcher","WorkspaceManager","EditorManager","isProUser","window","KernalModeTrust","isFreeTrialUser","EVENT_LIVE_HIGHLIGHT_PREF_CHANGED","params","config","experimental","debug","highlight","highlightConfig","borderColor","r","g","b","a","contentColor","marginColor","paddingColor","showInfo","elemHighlights","imageRibbon","strings","selectParent","LIVE_DEV_MORE_OPTIONS_SELECT_PARENT","editText","LIVE_DEV_MORE_OPTIONS_EDIT_TEXT","duplicate","LIVE_DEV_MORE_OPTIONS_DUPLICATE","delete","LIVE_DEV_MORE_OPTIONS_DELETE","ai","LIVE_DEV_MORE_OPTIONS_AI","aiPromptPlaceholder","LIVE_DEV_AI_PROMPT_PLACEHOLDER","imageGalleryUseImage","LIVE_DEV_IMAGE_GALLERY_USE_IMAGE","imageGallerySelectFromComputer","LIVE_DEV_IMAGE_GALLERY_SELECT_FROM_COMPUTER","imageGalleryChooseFolder","LIVE_DEV_IMAGE_GALLERY_CHOOSE_FOLDER","imageGallerySearchPlaceholder","LIVE_DEV_IMAGE_GALLERY_SEARCH_PLACEHOLDER","_status","_allStatusStyles","join","_$btnGoLive","prefs","getExtensionPrefs","PREF_REMOTEHIGHLIGHT","remoteHighlightPref","definePreference","animateStartValue","background-color","opacity","animateEndValue","paddingStyling","marginStyling","showPaddingMargin","description","DESCRIPTION_LIVE_DEV_HIGHLIGHT_SETTINGS","_loadStyles","lessText","less","render","onParse","err","tree","console","assert","addEmbeddedStyleSheet","css","_setLabel","$btn","text","style","tooltip","$","remove","removeClass","length","addClass","appendTo","attr","closeLivePreview","close","openLivePreview","doc","Phoenix","isTestWindow","open","isInactive","status","STATUS_INACTIVE","isActive","STATUS_ACTIVE","setLivePreviewPinned","urlPinned","currentPinnedFilePath","setLivePreviewTransportBridge","transportBridge","_showStatusChangeReason","reason","twipsy","removeData","translatedReason","toUpperCase","format","LIVE_DEV_CLOSED_UNKNOWN_REASON","options","placement","trigger","autoHideDelay","title","_setupGoLiveButton","on","EVENT_STATUS_CHANGE","statusChange","event","_setupGoLiveMenu","get","FILE_LIVE_FILE_PREVIEW","setChecked","FILE_LIVE_HIGHLIGHT","setEnabled","_updateHighlightCheckmark","togglePreviewHighlight","showHighlight","hideHighlight","setViewState","_setupDebugHelpers","report","info","_handleReloadLivePreviewCommand","reload","_handleLivePreviewEscapeKey","dismissLivePreviewBoxes","setLivePreviewEditFeaturesActive","enabled","updateConfig","JSON","stringify","registerHandlers","updateElementHighlightConfig","prefValue","updateImageRibbonConfig","dismissImageRibbonGallery","appReady","parse","remoteHighlight","init","LIVE_DEV_STATUS_TIP_NOT_CONNECTED","LIVE_DEV_STATUS_TIP_PROGRESS1","LIVE_DEV_STATUS_TIP_CONNECTED","LIVE_DEV_STATUS_TIP_OUT_OF_SYNC","LIVE_DEV_STATUS_TIP_SYNC_ERROR","EVENT_OPEN_PREVIEW_URL","previewDetails","EVENT_CONNECTION_CLOSE","clientId","EVENT_LIVE_PREVIEW_CLICKED","_event","clickDetails","EVENT_LIVE_PREVIEW_RELOAD","clientDetails","addEscapeKeyEventHandler","stateManager","getViewState","register","CMD_LIVE_HIGHLIGHT","CMD_RELOAD_LIVE_PREVIEW","makeEventDispatcher","getConnectionIds","getLivePreviewDetails"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2012 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global less, Phoenix */\n\n/**\n * main integrates LiveDevelopment into Brackets\n *\n * This module creates two menu items:\n *\n *  \"Go Live\": open or close a Live Development session and visualize the status\n *  \"Highlight\": toggle source highlighting\n */\ndefine(function main(require, exports, module) {\n\n\n    const Commands            = require(\"command/Commands\"),\n        AppInit             = require(\"utils/AppInit\"),\n        MultiBrowserLiveDev = require(\"LiveDevelopment/LiveDevMultiBrowser\"),\n        LivePreviewTransport  = require(\"LiveDevelopment/MultiBrowserImpl/transports/LivePreviewTransport\"),\n        CommandManager      = require(\"command/CommandManager\"),\n        PreferencesManager  = require(\"preferences/PreferencesManager\"),\n        UrlParams           = require(\"utils/UrlParams\").UrlParams,\n        Strings             = require(\"strings\"),\n        ExtensionUtils      = require(\"utils/ExtensionUtils\"),\n        StringUtils         = require(\"utils/StringUtils\"),\n        EventDispatcher      = require(\"utils/EventDispatcher\"),\n        WorkspaceManager    = require(\"view/WorkspaceManager\"),\n        EditorManager      = require(\"editor/EditorManager\");\n\n\n    // this is responsible to make the advanced live preview features active or inactive\n    // @abose (make the first value true when its a paid user, everything rest is handled automatically)\n    let isProUser = window.KernalModeTrust ? true : false;\n    // when isFreeTrialUser is true isProUser should also be true\n    // when its false, isProUser can be true/false doesn't matter\n    let isFreeTrialUser = true;\n\n    const EVENT_LIVE_HIGHLIGHT_PREF_CHANGED = \"liveHighlightPrefChange\";\n\n    var params = new UrlParams();\n    var config = {\n        experimental: false, // enable experimental features\n        debug: true, // enable debug output and helpers\n        highlight: true, // enable highlighting?\n        highlightConfig: { // the highlight configuration for the Inspector\n            borderColor:  {r: 255, g: 229, b: 153, a: 0.66},\n            contentColor: {r: 111, g: 168, b: 220, a: 0.55},\n            marginColor:  {r: 246, g: 178, b: 107, a: 0.66},\n            paddingColor: {r: 147, g: 196, b: 125, a: 0.66},\n            showInfo: true\n        },\n        isProUser: isProUser,\n        elemHighlights: \"hover\", // default value, this will get updated when the extension loads\n        imageRibbon: true, // default value, this will get updated when the extension loads\n        // this strings are used in RemoteFunctions.js\n        // we need to pass this through config as remoteFunctions runs in browser context and cannot\n        // directly reference Strings file\n        strings: {\n            selectParent: Strings.LIVE_DEV_MORE_OPTIONS_SELECT_PARENT,\n            editText: Strings.LIVE_DEV_MORE_OPTIONS_EDIT_TEXT,\n            duplicate: Strings.LIVE_DEV_MORE_OPTIONS_DUPLICATE,\n            delete: Strings.LIVE_DEV_MORE_OPTIONS_DELETE,\n            ai: Strings.LIVE_DEV_MORE_OPTIONS_AI,\n            aiPromptPlaceholder: Strings.LIVE_DEV_AI_PROMPT_PLACEHOLDER,\n            imageGalleryUseImage: Strings.LIVE_DEV_IMAGE_GALLERY_USE_IMAGE,\n            imageGallerySelectFromComputer: Strings.LIVE_DEV_IMAGE_GALLERY_SELECT_FROM_COMPUTER,\n            imageGalleryChooseFolder: Strings.LIVE_DEV_IMAGE_GALLERY_CHOOSE_FOLDER,\n            imageGallerySearchPlaceholder: Strings.LIVE_DEV_IMAGE_GALLERY_SEARCH_PLACEHOLDER\n        }\n    };\n    // Status labels/styles are ordered: error, not connected, progress1, progress2, connected.\n    var _status,\n        _allStatusStyles = [\"warning\", \"info\", \"success\", \"out-of-sync\", \"sync-error\"].join(\" \");\n\n    var _$btnGoLive; // reference to the GoLive button\n\n    var prefs = PreferencesManager.getExtensionPrefs(\"livedev\");\n\n    // \"livedev.remoteHighlight\" preference\n    var PREF_REMOTEHIGHLIGHT = \"remoteHighlight\";\n    var remoteHighlightPref = prefs.definePreference(PREF_REMOTEHIGHLIGHT, \"object\", {\n        animateStartValue: {\n            \"background-color\": \"rgba(0, 162, 255, 0.5)\",\n            \"opacity\": 0\n        },\n        animateEndValue: {\n            \"background-color\": \"rgba(0, 162, 255, 0)\",\n            \"opacity\": 0.6\n        },\n        \"paddingStyling\": {\n            \"background-color\": \"rgba(200, 249, 197, 0.7)\"\n        },\n        \"marginStyling\": {\n            \"background-color\": \"rgba(249, 204, 157, 0.7)\"\n        },\n        \"borderColor\": \"rgba(200, 249, 197, 0.85)\",\n        \"showPaddingMargin\": true\n    }, {\n        description: Strings.DESCRIPTION_LIVE_DEV_HIGHLIGHT_SETTINGS\n    });\n\n    /** Load Live Development LESS Style */\n    function _loadStyles() {\n        var lessText = require(\"text!LiveDevelopment/main.less\");\n\n        less.render(lessText, function onParse(err, tree) {\n            console.assert(!err, err);\n            ExtensionUtils.addEmbeddedStyleSheet(tree.css);\n        });\n    }\n\n    /**\n     * Change the appearance of a button. Omit text to remove any extra text; omit style to return to default styling;\n     * omit tooltip to leave tooltip unchanged.\n     */\n    function _setLabel($btn, text, style, tooltip) {\n        // Clear text/styles from previous status\n        $(\"span\", $btn).remove();\n        $btn.removeClass(_allStatusStyles);\n\n        // Set text/styles for new status\n        if (text && text.length > 0) {\n            $(\"<span class=\\\"label\\\">\")\n                .addClass(style)\n                .text(text)\n                .appendTo($btn);\n        } else {\n            $btn.addClass(style);\n        }\n\n        if (tooltip) {\n            $btn.attr(\"title\", tooltip);\n        }\n    }\n\n    function closeLivePreview() {\n        MultiBrowserLiveDev.close();\n    }\n\n    function openLivePreview(doc) {\n        if (!Phoenix.isTestWindow) {\n            MultiBrowserLiveDev.open(doc);\n        }\n    }\n\n    function isInactive() {\n        return MultiBrowserLiveDev.status === MultiBrowserLiveDev.STATUS_INACTIVE;\n    }\n\n    function isActive() {\n        return MultiBrowserLiveDev.status === MultiBrowserLiveDev.STATUS_ACTIVE;\n    }\n\n    function setLivePreviewPinned(urlPinned, currentPinnedFilePath) {\n        MultiBrowserLiveDev.setLivePreviewPinned(urlPinned, currentPinnedFilePath);\n    }\n\n    function setLivePreviewTransportBridge(transportBridge) {\n        LivePreviewTransport.setLivePreviewTransportBridge(transportBridge);\n    }\n\n    /** Called on status change */\n    function _showStatusChangeReason(reason) {\n        // Destroy the previous twipsy (options are not updated otherwise)\n        _$btnGoLive.twipsy(\"hide\").removeData(\"twipsy\");\n\n        // If there was no reason or the action was an explicit request by the user, don't show a twipsy\n        if (!reason || reason === \"explicit_close\") {\n            return;\n        }\n\n        // Translate the reason\n        var translatedReason = Strings[\"LIVE_DEV_\" + reason.toUpperCase()];\n        if (!translatedReason) {\n            translatedReason = StringUtils.format(Strings.LIVE_DEV_CLOSED_UNKNOWN_REASON, reason);\n        }\n\n        // Configure the twipsy\n        var options = {\n            placement: \"left\",\n            trigger: \"manual\",\n            autoHideDelay: 5000,\n            title: function () {\n                return translatedReason;\n            }\n        };\n\n        // Show the twipsy with the explanation\n        _$btnGoLive.twipsy(options).twipsy(\"show\");\n    }\n\n    /** Create the menu item \"Go Live\" */\n    function _setupGoLiveButton() {\n        if (!_$btnGoLive) {\n            _$btnGoLive = $(\"#toolbar-go-live\");\n        }\n        MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_STATUS_CHANGE, function statusChange(event, status, reason) {\n            // status starts at -1 (error), so add one when looking up name and style\n            // See the comments at the top of LiveDevelopment.js for details on the\n            // various status codes.\n            _setLabel(_$btnGoLive, null, _status[status + 1].style, _status[status + 1].tooltip);\n            _showStatusChangeReason(reason);\n        });\n\n        // Initialize tooltip for 'not connected' state\n        _setLabel(_$btnGoLive, null, _status[1].style, _status[1].tooltip);\n    }\n\n    /** Maintains state of the Live Preview menu item */\n    function _setupGoLiveMenu() {\n        MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_STATUS_CHANGE, function statusChange(event, status) {\n            // Update the checkmark next to 'Live Preview' menu item\n            // Add checkmark when status is STATUS_ACTIVE; otherwise remove it\n            CommandManager.get(Commands.FILE_LIVE_FILE_PREVIEW)\n                .setChecked(status === MultiBrowserLiveDev.STATUS_ACTIVE);\n            CommandManager.get(Commands.FILE_LIVE_HIGHLIGHT)\n                .setEnabled(status === MultiBrowserLiveDev.STATUS_ACTIVE);\n        });\n    }\n\n    function _updateHighlightCheckmark() {\n        CommandManager.get(Commands.FILE_LIVE_HIGHLIGHT).setChecked(config.highlight);\n        exports.trigger(EVENT_LIVE_HIGHLIGHT_PREF_CHANGED, config.highlight);\n    }\n\n    function togglePreviewHighlight() {\n        config.highlight = !config.highlight;\n        _updateHighlightCheckmark();\n        if (config.highlight) {\n            MultiBrowserLiveDev.showHighlight();\n        } else {\n            MultiBrowserLiveDev.hideHighlight();\n        }\n        PreferencesManager.setViewState(\"livedevHighlight\", config.highlight);\n    }\n\n    /** Setup window references to useful LiveDevelopment modules */\n    function _setupDebugHelpers() {\n        window.report = function report(params) { window.params = params; console.info(params); };\n    }\n\n    /** force reload the live preview currently only with shortcut ctrl-shift-R */\n    function _handleReloadLivePreviewCommand() {\n        if (MultiBrowserLiveDev.status >= MultiBrowserLiveDev.STATUS_ACTIVE) {\n            MultiBrowserLiveDev.reload();\n        }\n    }\n\n    /**\n     * this function handles escape key for live preview to hide boxes if they are visible\n     * @param {Event} event\n     */\n    function _handleLivePreviewEscapeKey(event) {\n        // we only handle the escape keypress for live preview when its active\n        if (MultiBrowserLiveDev.status === MultiBrowserLiveDev.STATUS_ACTIVE) {\n            MultiBrowserLiveDev.dismissLivePreviewBoxes();\n        }\n        // returning false to let the editor also handle the escape key\n        return false;\n    }\n\n    /** Initialize LiveDevelopment */\n    AppInit.appReady(function () {\n        params.parse();\n        config.remoteHighlight = prefs.get(PREF_REMOTEHIGHLIGHT);\n\n        // init experimental multi-browser implementation\n        // it can be enable by setting 'livedev.multibrowser' preference to true.\n        // It has to be initiated at this point in case of dynamically switching\n        // by changing the preference value.\n        MultiBrowserLiveDev.init(config);\n\n        _loadStyles();\n        _updateHighlightCheckmark();\n\n        // update styles for UI status\n        _status = [\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_NOT_CONNECTED, style: \"warning\" },\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_NOT_CONNECTED, style: \"\" },\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_PROGRESS1, style: \"info\" },\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_CONNECTED, style: \"success\" },\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_OUT_OF_SYNC, style: \"out-of-sync\" },\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_SYNC_ERROR, style: \"sync-error\" },\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_PROGRESS1, style: \"info\" },\n            { tooltip: Strings.LIVE_DEV_STATUS_TIP_PROGRESS1, style: \"info\" }\n        ];\n        // setup status changes listeners for new implementation\n        _setupGoLiveButton();\n        _setupGoLiveMenu();\n\n        if (config.debug) {\n            _setupDebugHelpers();\n        }\n\n        remoteHighlightPref\n            .on(\"change\", function () {\n                config.remoteHighlight = prefs.get(PREF_REMOTEHIGHLIGHT);\n                if (MultiBrowserLiveDev && MultiBrowserLiveDev.status >= MultiBrowserLiveDev.STATUS_ACTIVE) {\n                    MultiBrowserLiveDev.updateConfig(JSON.stringify(config));\n                }\n            });\n\n        MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_OPEN_PREVIEW_URL, function (event, previewDetails) {\n            exports.trigger(exports.EVENT_OPEN_PREVIEW_URL, previewDetails);\n        });\n        MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_CONNECTION_CLOSE, function (event, {clientId}) {\n            exports.trigger(exports.EVENT_CONNECTION_CLOSE, {clientId});\n        });\n        MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_CLICKED, function (_event, clickDetails) {\n            exports.trigger(exports.EVENT_LIVE_PREVIEW_CLICKED, clickDetails);\n        });\n        MultiBrowserLiveDev.on(MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_RELOAD, function (_event, clientDetails) {\n            exports.trigger(exports.EVENT_LIVE_PREVIEW_RELOAD, clientDetails);\n        });\n\n        // allow live preview to handle escape key event\n        // Escape is mainly to hide boxes if they are visible\n        WorkspaceManager.addEscapeKeyEventHandler(\"livePreview\", _handleLivePreviewEscapeKey);\n    });\n\n    // init prefs\n    PreferencesManager.stateManager.definePreference(\"livedevHighlight\", \"boolean\", true)\n        .on(\"change\", function () {\n            config.highlight = PreferencesManager.getViewState(\"livedevHighlight\");\n            _updateHighlightCheckmark();\n            if (MultiBrowserLiveDev && MultiBrowserLiveDev.status >= MultiBrowserLiveDev.STATUS_ACTIVE) {\n                MultiBrowserLiveDev.updateConfig(JSON.stringify(config));\n            }\n        });\n\n    config.highlight = PreferencesManager.getViewState(\"livedevHighlight\");\n\n    function setLivePreviewEditFeaturesActive(enabled) {\n        // TODO: @abose here add kernal mode trust check\n        isProUser = enabled;\n        config.isProUser = enabled;\n        if (MultiBrowserLiveDev && MultiBrowserLiveDev.status >= MultiBrowserLiveDev.STATUS_ACTIVE) {\n            MultiBrowserLiveDev.updateConfig(JSON.stringify(config));\n            MultiBrowserLiveDev.registerHandlers();\n        }\n    }\n\n    // this function is responsible to update element highlight config\n    // called from live preview extension when preference changes\n    function updateElementHighlightConfig() {\n        const prefValue = PreferencesManager.get(\"livePreviewElementHighlights\");\n        config.elemHighlights = prefValue || \"hover\";\n        if (MultiBrowserLiveDev && MultiBrowserLiveDev.status >= MultiBrowserLiveDev.STATUS_ACTIVE) {\n            MultiBrowserLiveDev.updateConfig(JSON.stringify(config));\n            MultiBrowserLiveDev.registerHandlers();\n        }\n    }\n\n    // this function is responsible to update image picker config\n    // called from live preview extension when preference changes\n    function updateImageRibbonConfig() {\n        const prefValue = PreferencesManager.get(\"livePreviewImagePicker\");\n        config.imageRibbon = prefValue !== false; // default to true if undefined\n\n        if (MultiBrowserLiveDev && MultiBrowserLiveDev.status >= MultiBrowserLiveDev.STATUS_ACTIVE) {\n            if (!prefValue) { MultiBrowserLiveDev.dismissImageRibbonGallery(); } // to remove any existing image ribbons\n\n            MultiBrowserLiveDev.updateConfig(JSON.stringify(config));\n            MultiBrowserLiveDev.registerHandlers();\n        }\n    }\n\n    // init commands\n    CommandManager.register(Strings.CMD_LIVE_HIGHLIGHT, Commands.FILE_LIVE_HIGHLIGHT, togglePreviewHighlight);\n    CommandManager.register(Strings.CMD_RELOAD_LIVE_PREVIEW, Commands.CMD_RELOAD_LIVE_PREVIEW, _handleReloadLivePreviewCommand);\n\n    CommandManager.get(Commands.FILE_LIVE_HIGHLIGHT).setEnabled(false);\n\n    EventDispatcher.makeEventDispatcher(exports);\n\n    exports.isProUser = isProUser;\n    exports.isFreeTrialUser = isFreeTrialUser;\n\n    // public events\n    exports.EVENT_OPEN_PREVIEW_URL = MultiBrowserLiveDev.EVENT_OPEN_PREVIEW_URL;\n    exports.EVENT_CONNECTION_CLOSE = MultiBrowserLiveDev.EVENT_CONNECTION_CLOSE;\n    exports.EVENT_LIVE_PREVIEW_CLICKED = MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_CLICKED;\n    exports.EVENT_LIVE_PREVIEW_RELOAD = MultiBrowserLiveDev.EVENT_LIVE_PREVIEW_RELOAD;\n    exports.EVENT_LIVE_HIGHLIGHT_PREF_CHANGED = EVENT_LIVE_HIGHLIGHT_PREF_CHANGED;\n\n    // Export public functions\n    exports.openLivePreview = openLivePreview;\n    exports.closeLivePreview = closeLivePreview;\n    exports.isInactive = isInactive;\n    exports.isActive = isActive;\n    exports.setLivePreviewPinned = setLivePreviewPinned;\n    exports.setLivePreviewTransportBridge = setLivePreviewTransportBridge;\n    exports.togglePreviewHighlight = togglePreviewHighlight;\n    exports.setLivePreviewEditFeaturesActive = setLivePreviewEditFeaturesActive;\n    exports.updateElementHighlightConfig = updateElementHighlightConfig;\n    exports.updateImageRibbonConfig = updateImageRibbonConfig;\n    exports.getConnectionIds = MultiBrowserLiveDev.getConnectionIds;\n    exports.getLivePreviewDetails = MultiBrowserLiveDev.getLivePreviewDetails;\n    exports.hideHighlight = MultiBrowserLiveDev.hideHighlight;\n    exports.dismissLivePreviewBoxes = MultiBrowserLiveDev.dismissLivePreviewBoxes;\n});\n"],"file":"main.js"}