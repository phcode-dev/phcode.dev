const t={attributeStringValueLimit:1024,attributeArrayLengthLimit:1e3,attributeCountLimit:128},e={attributeStringValueLimit:1/0,attributeArrayLengthLimit:1/0,attributeCountLimit:1/0},s=t=>!0===t||!1===t,n=t=>!!t&&"object"==typeof t&&!Array.isArray(t),r=t=>"number"==typeof t&&Number.isFinite(t)&&!Number.isNaN(t),i=t=>"string"==typeof t,a=t=>i(t)&&t.length>0,o=t=>Array.isArray(t)&&t.every(t=>a(t)||t instanceof RegExp),u=t=>n(t)&&"string"==typeof t.id&&"string"==typeof t.traceId;function l(t){return Array.isArray(t)&&t.every(t=>"function"==typeof t)}class c{get droppedAttributesCount(){return this._droppedAttributesCount}constructor(t,e,s,n){this._droppedAttributesCount=0,this.attributes=t,this.spanAttributeLimits=e,this.spanName=s,this.logger=n}truncateAttribute(t,e){if("string"==typeof e&&e.length>this.spanAttributeLimits.attributeStringValueLimit&&(this.attributes.set(t,function(t,e){const s=t.length,n=t.slice(0,e);return`${n} *** ${s-n.length} CHARS TRUNCATED`}(e,this.spanAttributeLimits.attributeStringValueLimit)),this.logger.warn(`Span attribute ${t} in span ${this.spanName} was truncated as the string exceeds the ${this.spanAttributeLimits.attributeStringValueLimit} character limit set by attributeStringValueLimit.`)),Array.isArray(e)&&e.length>this.spanAttributeLimits.attributeArrayLengthLimit){const s=e.slice(0,this.spanAttributeLimits.attributeArrayLengthLimit);this.attributes.set(t,s),this.logger.warn(`Span attribute ${t} in span ${this.spanName} was truncated as the array exceeds the ${this.spanAttributeLimits.attributeArrayLengthLimit} element limit set by attributeArrayLengthLimit.`)}}isValidAttributeValue(t){return"string"==typeof t||"boolean"==typeof t||r(t)||Array.isArray(t)}isValidAttributeName(t){return"string"==typeof t&&t.length>0}set(t,e){this.isValidAttributeName(t)&&(null!=e?this.isValidAttributeValue(e)&&this.attributes.set(t,e):this.remove(t))}setCustom(t,e){if(this.isValidAttributeName(t))if(null!=e){if(this.isValidAttributeValue(e)){if(!this.attributes.has(t)&&this.attributes.size>=this.spanAttributeLimits.attributeCountLimit)return this._droppedAttributesCount++,void this.logger.warn(`Span attribute ${t} in span ${this.spanName} was dropped as the number of attributes exceeds the ${this.spanAttributeLimits.attributeCountLimit} attribute limit set by attributeCountLimit.`);if(t.length>128)return this._droppedAttributesCount++,void this.logger.warn(`Span attribute ${t} in span ${this.spanName} was dropped as the key length exceeds the 128 character fixed limit.`);this.attributes.set(t,e)}}else this.remove(t)}remove(t){this.attributes.delete(t)}toJson(){return Array.from(this.attributes).forEach(([t,e])=>{this.truncateAttribute(t,e)}),Array.from(this.attributes).map(([t,e])=>(function(t,e){switch(typeof e){case"number":if(Number.isNaN(e)||!Number.isFinite(e))return;return"bugsnag.sampling.p"!==t&&Number.isInteger(e)?{key:t,value:{intValue:`${e}`}}:{key:t,value:{doubleValue:e}};case"boolean":return{key:t,value:{boolValue:e}};case"string":return{key:t,value:{stringValue:e}};case"object":if(Array.isArray(e)){const s=e.map(t=>(function(t){switch(typeof t){case"number":if(Number.isNaN(t)||!Number.isFinite(t))return;return Number.isInteger(t)?{intValue:`${t}`}:{doubleValue:t};case"boolean":return{boolValue:t};case"string":return{stringValue:t}}})(t)).filter(t=>void 0!==t);return{key:t,value:{arrayValue:s.length>0?{values:s}:{}}}}return;default:return}})(t,e)).filter(t=>void 0!==t)}toObject(){return Object.fromEntries(this.attributes)}}class d extends c{constructor(t,s,n,r,i,a){const o=new Map([["deployment.environment",t],["telemetry.sdk.name",r],["telemetry.sdk.version",i],["service.name",n]]);s.length>0&&o.set("service.version",s),super(o,e,"resource-attributes",a)}}const h=1e6;function g(t){return Math.round(t*h)}const p={appVersion:{defaultValue:"",message:"should be a string",validate:a},endpoint:{defaultValue:"https://otlp.bugsnag.com/v1/traces",message:"should be a string",validate:a},apiKey:{defaultValue:"",message:"should be a 32 character hexadecimal string",validate:t=>i(t)&&/^[a-f0-9]{32}$/.test(t)},logger:{defaultValue:{debug(t){console.debug(t)},info(t){console.info(t)},warn(t){console.warn(t)},error(t){console.error(t)}},message:"should be a Logger object",validate:t=>n(t)&&"function"==typeof t.debug&&"function"==typeof t.info&&"function"==typeof t.warn&&"function"==typeof t.error},releaseStage:{defaultValue:"production",message:"should be a string",validate:a},enabledReleaseStages:{defaultValue:null,message:"should be an array of strings",validate:t=>null===t||(t=>Array.isArray(t)&&t.every(a))(t)},plugins:{defaultValue:[],message:"should be an array of plugin objects",validate:function(t){return Array.isArray(t)&&t.every(t=>(function(t){return n(t)&&"function"==typeof t.install&&"function"==typeof t.start})(t))}},bugsnag:{defaultValue:void 0,message:"should be an instance of Bugsnag",validate:t=>n(t)&&"function"==typeof t.addOnError},samplingProbability:{defaultValue:void 0,message:"should be a number between 0 and 1",validate:t=>void 0===t||r(t)&&t>=0&&t<=1},onSpanStart:{defaultValue:void 0,message:"should be an array of functions",validate:l},onSpanEnd:{defaultValue:void 0,message:"should be an array of functions",validate:l},attributeStringValueLimit:{defaultValue:1024,message:"should be a number between 1 and 10000",validate:t=>r(t)&&t>0&&t<=1e4},attributeArrayLengthLimit:{defaultValue:1e3,message:"should be a number between 1 and 10000",validate:t=>r(t)&&t>0&&t<=1e4},attributeCountLimit:{defaultValue:128,message:"should be a number between 1 and 1000",validate:t=>r(t)&&t>0&&t<=1e3}};class b{constructor(){this.events=[]}add(t,e){this.events.push({name:t,time:e})}toJson(t){return this.events.map(({name:e,time:s})=>({name:e,timeUnixNano:t.toUnixTimestampNanoseconds(s)}))}}function f(t){let e=0;for(let s=0;s<t.length/8;s++){const n=8*s;e=(e^Number.parseInt(t.slice(n,n+8),16))>>>0}return e}async function m(t,e,s){if(!s||0===s.length)return!0;const n=function(t){return{get id(){return t.id},get traceId(){return t.traceId},get samplingRate(){return t.samplingRate},get samplingProbability(){return t.samplingProbability.raw},get name(){return t.name},isValid:()=>!1,end:()=>{},setAttribute:(e,s)=>{t.attributes.setCustom(e,s)}}}(t),r=performance.now();let i=!0;for(const t of s)try{let e=t(n);if("function"==typeof e.then&&(e=await e),!1===e){i=!1;break}}catch(t){e.error("Error in onSpanEnd callback: "+t)}if(i){const t=g(performance.now()-r);n.setAttribute("bugsnag.span.callbacks_duration",t)}return i}class y{constructor(t,e,s,n,r,i,a,o){this.kind=3,this.events=new b,this.id=t,this.traceId=e,this.parentSpanId=o,this.name=s,this.startTime=n,this.attributes=r,this.samplingRate=f(this.traceId),this.samplingProbability=a,this.clock=i}addEvent(t,e){this.events.add(t,e)}setAttribute(t,e){this.attributes.set(t,e)}setCustomAttribute(t,e){this.attributes.setCustom(t,e)}end(t,e){this.endTime=t;let s=e;return this.attributes.set("bugsnag.sampling.p",s.raw),{id:this.id,name:this.name,kind:this.kind,traceId:this.traceId,startTime:this.startTime,attributes:this.attributes,events:this.events,samplingRate:this.samplingRate,endTime:t,get samplingProbability(){return s},set samplingProbability(t){s=t,this.attributes.set("bugsnag.sampling.p",s.raw)},parentSpanId:this.parentSpanId}}isValid(){return void 0===this.endTime&&this.startTime>this.clock.now()-36e5}}const v={startTime:{message:"should be a number or Date",getDefaultValue:()=>{},validate:function(t){return r(t)||t instanceof Date}},parentContext:{message:"should be a ParentContext",getDefaultValue:()=>{},validate:t=>null===t||u(t)},makeCurrentContext:{message:"should be true|false",getDefaultValue:()=>{},validate:s},isFirstClass:{message:"should be true|false",getDefaultValue:()=>{},validate:s}};class S{constructor(t,e,s,n,r,i){this.spans=[],this.timeout=null,this.flushQueue=Promise.resolve(),this.delivery=t,this.configuration=e,this.retryQueue=s,this.sampler=n,this.probabilityManager=r,this.encoder=i,this.flush=this.flush.bind(this)}stop(){null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}start(){this.stop(),this.timeout=setTimeout(this.flush,this.configuration.batchInactivityTimeoutMs)}add(t){this.configuration.enabledReleaseStages&&!this.configuration.enabledReleaseStages.includes(this.configuration.releaseStage)||(this.spans.push(t),this.spans.length>=this.configuration.maximumBatchSize?this.flush():this.start())}async flush(){this.stop(),this.flushQueue=this.flushQueue.then(async()=>{const t=await this.prepareBatch();if(!t)return;const e=await this.encoder.encode(t),s=Date.now();try{const t=await this.delivery.send(e);switch(void 0!==t.samplingProbability&&this.probabilityManager.setProbability(t.samplingProbability),t.state){case"success":this.retryQueue.flush();break;case"failure-discard":this.configuration.logger.warn("delivery failed");break;case"failure-retryable":this.configuration.logger.info("delivery failed, adding to retry queue"),this.retryQueue.add(e,s);break;default:t.state}}catch(t){this.configuration.logger.warn("delivery failed")}}),await this.flushQueue}async prepareBatch(){if(0===this.spans.length)return;await this.probabilityManager.ensureFreshProbability();const t=[],e=this.sampler.spanProbability;for(const s of this.spans)s.samplingProbability.raw>e.raw&&(s.samplingProbability=e),this.sampler.sample(s)&&await m(s,this.configuration.logger,this.configuration.onSpanEnd)&&t.push(s);return this.spans=[],0!==t.length?t:void 0}}class w{constructor(t,e,s){this.clock=t,this.configuration=e,this.resourceAttributeSource=s}async encode(t){const e=await this.resourceAttributeSource(this.configuration),s=Array(t.length);for(let e=0;e<t.length;++e)s[e]=(n=t[e],r=this.clock,{name:n.name,kind:n.kind,spanId:n.id,traceId:n.traceId,parentSpanId:n.parentSpanId,...n.attributes.droppedAttributesCount>0?{droppedAttributesCount:n.attributes.droppedAttributesCount}:{},startTimeUnixNano:r.toUnixTimestampNanoseconds(n.startTime),endTimeUnixNano:r.toUnixTimestampNanoseconds(n.endTime),attributes:n.attributes.toJson(),events:n.events.toJson(r)});var n,r;return{body:{resourceSpans:[{resource:{attributes:e.toJson()},scopeSpans:[{spans:s}]}]},headers:{"Bugsnag-Api-Key":this.configuration.apiKey,"Content-Type":"application/json",...void 0!==this.configuration.samplingProbability?{}:{"Bugsnag-Span-Sampling":this.generateSamplingHeader(t)}}}}generateSamplingHeader(t){if(0===t.length)return"1:0";const e=Object.create(null);for(const s of t){const t=e[s.samplingProbability.raw]||0;e[s.samplingProbability.raw]=t+1}const s=Object.keys(e),n=Array(s.length);for(let t=0;t<s.length;++t){const r=s[t];n[t]=`${r}:${e[r]}`}return n.join(";")}}const k=new Set([402,407,408,429]);class C{static async create(t,e){return t.probability=e,new C(t,e)}constructor(t,e){this.sampler=t,this.samplingProbability=e}setProbability(t){return Promise.resolve()}ensureFreshProbability(){return Promise.resolve()}}const A=5e4;class P{constructor(t){this.items=[],t&&(this.items=t,this.sort())}add(t,e){return!this.items.some(e=>e.item===t)&&(this.items.push({item:t,priority:e}),this.sort(),!0)}addAll(t){let e=!1;for(const s of t)this.items.some(t=>t.item===s.item)||(this.items.push(s),e=!0);return e&&this.sort(),e}*[Symbol.iterator](){for(const t of this.items)yield t.item}sort(){this.items.sort((t,e)=>e.priority-t.priority)}}class T{constructor(t,e){this.configuration=t,this.clock=e,this.onSpanStartCallbacks=[],this.onSpanEndCallbacks=[],this.spanControlProviders=[]}addOnSpanStartCallback(t,e=A){this.onSpanStartCallbacks.push({item:t,priority:e})}addOnSpanEndCallback(t,e=A){this.onSpanEndCallbacks.push({item:t,priority:e})}addSpanControlProvider(t,e=A){this.spanControlProviders.push({item:t,priority:e})}mergeFrom(t){this.onSpanStartCallbacks.push(...t.onSpanStartCallbacks),this.onSpanEndCallbacks.push(...t.onSpanEndCallbacks),this.spanControlProviders.push(...t.spanControlProviders)}}class x{constructor(){this.plugins=[],this.installedPlugins=new Set}addPlugins(t){this.plugins.push(...t)}installPlugins(t,e){this.logger=t.logger;const s=new T(t,e);for(const n of this.plugins)if(!this.installedPlugins.has(n))try{const r=new T(t,e);n.install(r),s.mergeFrom(r),this.installedPlugins.add(n)}catch(t){this.logger&&this.logger.error(`Plugin ${n.constructor.name} failed to install: ${t}`)}return s}startPlugins(){for(const t of this.installedPlugins)try{t.start()}catch(e){this.logger&&this.logger.error(`Plugin ${t.constructor.name} failed to start: ${e}`)}}getPlugin(t){for(const e of this.installedPlugins)if(e instanceof t)return e}}class R{constructor(t,e){this.delivery=t,this.payload={body:{resourceSpans:[]},headers:{"Bugsnag-Api-Key":e,"Content-Type":"application/json","Bugsnag-Span-Sampling":"1.0:0"}}}async getNewProbability(){for(;;){const t=await this.delivery.send(this.payload);if(void 0!==t.samplingProbability)return t.samplingProbability;await this.timeBetweenRetries()}}timeBetweenRetries(){return new Promise(t=>{setTimeout(t,3e4)})}}const L=864e5;class E{static async create(t,e,s){const n=await t.load("bugsnag-sampling-probability");let r;return void 0===n?(e.probability=1,r=0):(n.time,Date.now(),e.probability=n.value,r=n.time),new E(t,e,s,r)}constructor(t,e,s,n){this.outstandingFreshnessCheck=void 0,this.persistence=t,this.sampler=e,this.probabilityFetcher=s,this.lastProbabilityTime=n,this.ensureFreshProbability()}setProbability(t){return this.lastProbabilityTime=Date.now(),this.sampler.probability=t,this.persistence.save("bugsnag-sampling-probability",{value:t,time:this.lastProbabilityTime})}ensureFreshProbability(){return this.outstandingFreshnessCheck?this.outstandingFreshnessCheck:Date.now()-this.lastProbabilityTime>=L?(this.outstandingFreshnessCheck=this.probabilityFetcher.getNewProbability().then(t=>{this.setProbability(t),this.outstandingFreshnessCheck=void 0}),this.outstandingFreshnessCheck):Promise.resolve()}}class V{constructor(){this.spans=[]}add(t){this.spans.push(t)}}function I(t){return Math.floor(4294967295*t)}class F{constructor(t){this._probability=t,this.scaledProbability=I(t)}get probability(){return this._probability}set probability(t){this._probability=t,this.scaledProbability=I(t)}get spanProbability(){return{raw:this._probability,scaled:this.scaledProbability}}sample(t){return t.samplingRate<=t.samplingProbability.scaled}shouldSample(t){return t<=this.spanProbability.scaled}}class q{constructor(t,e=[]){this.isInForeground=!0,this.onBackgroundStateChange=(t=>{this.isInForeground="in-foreground"===t,this.contextStack.length=0}),this.contextStack=e,t.onStateChange(this.onBackgroundStateChange)}*[Symbol.iterator](){for(let t=this.contextStack.length-1;t>=0;--t)yield this.contextStack[t]}push(t){t.isValid()&&this.isInForeground&&this.contextStack.push(t)}pop(t){var e,s;((e=t)===(s=this.current)||void 0!==e&&void 0!==s&&e.id===s.id&&e.traceId===s.traceId)&&this.contextStack.pop(),this.removeClosedContexts()}get first(){return this.removeClosedContexts(),this.contextStack.length>0?this.contextStack[0]:void 0}get current(){return this.removeClosedContexts(),this.contextStack.length>0?this.contextStack[this.contextStack.length-1]:void 0}removeClosedContexts(){for(;this.contextStack.length>0&&!1===this.contextStack[this.contextStack.length-1].isValid();)this.contextStack.pop()}}class N{constructor(){this.providers=new P}addProvider(t,e){this.providers.add(t,e)}addProviders(t){this.providers.addAll(t)}getSpanControls(t){for(const e of this.providers){const s=e.getSpanControls(t);if(s)return s}return null}}function O(t,e){return r(e)?e:e instanceof Date?t.convert(e):t.now()}class ${constructor(e,s,n,r,i,a,o,u){this.spanAttributeLimits=t,this.openSpans=new WeakSet,this.isInForeground=!0,this.onBackgroundStateChange=(t=>{this.isInForeground="in-foreground"===t,this.openSpans=new WeakSet}),this.processor=e,this.sampler=s,this.idGenerator=n,this.spanAttributesSource=r,this.clock=i,this.logger=o,this.spanContextStorage=u,a.onStateChange(this.onBackgroundStateChange)}startSpan(t,e){e.parentContext=u(e.parentContext)||null===e.parentContext?e.parentContext:this.spanContextStorage.current;const s=new c(new Map,this.spanAttributeLimits,t,this.logger);"boolean"==typeof e.isFirstClass&&s.set("bugsnag.span.first_class",e.isFirstClass);const n=this.createSpanInternal(t,e,s);return this.isInForeground&&(this.openSpans.add(n),!1!==e.makeCurrentContext&&this.spanContextStorage.push(n)),this.onSpanStart(n),n}onSpanStart(t){if(this.onSpanStartCallbacks){const e=this.toPublicApi(t);for(const t of this.onSpanStartCallbacks)try{t(e)}catch(t){this.logger.error("Error in onSpanStart callback: "+t)}}}createSpanInternal(t,e,s){const n=O(this.clock,e.startTime),r=this.idGenerator.generate(64),i=e.parentContext?e.parentContext.id:void 0,a=e.parentContext?e.parentContext.traceId:this.idGenerator.generate(128);return new y(r,a,t,n,s,this.clock,this.sampler.probability,i)}startNetworkSpan(t){const e=`[HTTP/${t.method.toUpperCase()}]`,s=this.validateSpanOptions(e,t),n=this.startSpan(s.name,{...s.options,makeCurrentContext:!1});return n.setAttribute("bugsnag.span.category","network"),n.setAttribute("http.method",t.method),n.setAttribute("http.url",t.url),n}configure(t){this.logger=t.logger,this.spanAttributesSource.configure(t),this.spanAttributeLimits={attributeArrayLengthLimit:t.attributeArrayLengthLimit,attributeCountLimit:t.attributeCountLimit,attributeStringValueLimit:t.attributeStringValueLimit},this.onSpanStartCallbacks=t.onSpanStart,this.onSpanEndCallbacks=t.onSpanEnd}reprocessEarlySpans(t){for(const e of this.processor.spans)t.add(e);this.processor=t}endSpan(t,e,s){this.spanContextStorage.pop(t);const n=!this.openSpans.delete(t),r=t.isValid();if(n&&!r&&this.logger.warn("Attempted to end a Span which is no longer valid."),!n&&r&&-1!==e){for(const[e,n]of Object.entries(s||{}))t.setAttribute(e,n);this.spanAttributesSource.requestAttributes(t),this.sendForProcessing(t,e)}else this.discardSpan(t)}discardSpan(t){t.end(-1,this.sampler.spanProbability)}sendForProcessing(t,e){const s=t.end(e,this.sampler.spanProbability);this.sampler.sample(s)&&this.processor.add(s)}toPublicApi(t){return{get id(){return t.id},get traceId(){return t.traceId},get samplingRate(){return t.samplingRate},get samplingProbability(){return t.samplingProbability},get name(){return t.name},isValid:()=>t.isValid(),setAttribute:(e,s)=>{t.setCustomAttribute(e,s)},end:e=>{const s=O(this.clock,e);this.endSpan(t,s)}}}validateSpanOptions(t,e,s=v){let r="";const i={};if("string"!=typeof t&&(r+="\n  - name should be a string, got "+typeof t,t=String(t)),void 0===e||n(e)){const t=e||{};for(const e of Object.keys(s))Object.prototype.hasOwnProperty.call(t,e)&&void 0!==t[e]?s[e].validate(t[e])?i[e]=t[e]:(r+=`\n  - ${e} ${s[e].message}, got ${typeof t[e]}`,i[e]=s[e].getDefaultValue(t[e])):i[e]=s[e].getDefaultValue(t[e])}else r+="\n  - options is not an object";return r.length>0&&this.logger.warn(`Invalid span options${r}`),{name:t,options:i}}}let U="starting";function B(){return U}function _(t){U=t}function D(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var j=function(t,e){var s="000000000"+t;return s.substr(s.length-e)},H=j,M="object"==typeof window?window:self,Q=0;for(var K in M)Object.hasOwnProperty.call(M,K)&&Q++;var z=H(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+Q.toString(36),4),J=function(){return z},W=function(t){return"string"==typeof t&&/^c[a-z0-9]{20,32}$/.test(t)},G=j,X=0,Y=4,Z=36,tt=Math.pow(Z,Y);function et(){return G((Math.random()*tt|0).toString(Z),Y)}function st(){return"c"+(new Date).getTime().toString(Z)+G((X=X<tt?X:0,++X-1).toString(Z),Y)+J()+(et()+et())}st.fingerprint=J,st.isCuid=W;const nt=D(st),{isCuid:rt}=nt;class it{constructor(){this.persistedItems=new Map}async load(t){return this.persistedItems.get(t)}async save(t,e){this.persistedItems.set(t,e)}}function at(t,e){switch(t){case"bugsnag-sampling-probability":{const t=JSON.parse(e);return n(s=t)&&r(s.value)&&r(s.time)?t:void 0}case"bugsnag-anonymous-id":return rt(e)?e:void 0}var s}class ot{constructor(t,e){this.delivery=t,this.retryQueueMaxSize=e,this.requestQueue=Promise.resolve(),this.payloads=[]}add(t,e){this.payloads.push({payload:t,time:e});let s=this.payloads.reduce((t,{payload:e})=>t+ut(e),0);for(;s>this.retryQueueMaxSize;){const t=this.payloads.shift();if(!t)break;s-=ut(t.payload)}}async flush(){if(0===this.payloads.length)return;const t=this.payloads;this.payloads=[],this.requestQueue=this.requestQueue.then(async()=>{for(const{payload:e,time:s}of t)if(!(Date.now()>=s+864e5))try{const{state:t}=await this.delivery.send(e);switch(t){case"success":case"failure-discard":break;case"failure-retryable":this.add(e,s)}}catch(t){}}),await this.requestQueue}}function ut(t){let e=0;for(let s=0;s<t.body.resourceSpans.length;++s){const n=t.body.resourceSpans[s].scopeSpans;for(let t=0;t<n.length;++t)e+=n[t].spans.length}return e}const lt=/^00-([0-9a-f]{32})-([0-9a-f]{16})-[0-9]{2}$/;class ct{constructor(t){this.id=t.id,this.traceId=t.traceId}encodeAsTraceParent(){return ct.toTraceParentString(this)}static parseTraceParent(t){const e=lt.exec(t);if(!e)return;const[,s,n]=e;return new ct({id:n,traceId:s})}static toTraceParentString(t){let e=!0;if(n(s=t)&&"string"==typeof s.id&&"string"==typeof s.traceId&&"function"==typeof s.isValid&&"number"==typeof s.samplingRate&&"number"==typeof s.samplingProbability){const s=I(t.samplingProbability);e=t.samplingRate<=s}var s;return`00-${t.traceId}-${t.id}-${e?"01":"00"}`}}function dt(t){const e=t.get("Bugsnag-Sampling-Probability");if("string"!=typeof e)return;const s=Number.parseFloat(e);return Number.isNaN(s)||s<0||s>1?void 0:s}function ht(t){return t}function gt(t){return"function"==typeof t}class pt{constructor(){this.callbacks=[]}onStart(t){this.callbacks.push(t)}start(t){const e=[];for(const s of this.callbacks){const n=s(t);n&&e.push(n)}return{onRequestEnd:t=>{for(const s of e)s&&s.onRequestEnd&&s.onRequestEnd(t)},extraRequestHeaders:e.map(t=>{if(t&&t.extraRequestHeaders)return t.extraRequestHeaders}).filter(bt)}}}function bt(t){return void 0!==t}function ft(t,e){if(0===t.indexOf("https://")||0===t.indexOf("http://"))return t;try{const s=new URL(t,e).href;return!t.endsWith("/")&&s.endsWith("/")?s.slice(0,-1):s}catch(e){return t}}function mt(t){return!(!t||"object"!=typeof t||t instanceof URL)}const yt={referrer:!0,title:!0,url:!0};function vt(t){return{...yt,...t}}function St(t){const e=["undefined","boolean"],s=Object.keys(yt);return n(t)&&s.every(s=>e.includes(typeof t[s]))}const wt=t=>t.pathname||"/",kt=()=>(class{constructor(t=wt){this.resolveRoute=t}listenForRouteChanges(t){}}),Ct=(t,e)=>(class{constructor(t=wt){this.resolveRoute=t}listenForRouteChanges(s){addEventListener("popstate",n=>{const r=new URL(e.href),i=s(r,"popstate");t(t=>{i.end(t)})});const n=history.pushState;history.pushState=function(...e){const r=e[2];if(r){const e=new URL(ft(r.toString(),document.baseURI)),n=s(e,"pushState");t(t=>{n.end(t)})}n.apply(this,e)}}});class At{constructor(t,e,s,n,r,i,a){this.wasBackgrounded=!1,this.enabled=!1,this.routeResolver=wt,this.sendPageAttributes=yt,this.document=t,this.location=e,this.spanFactory=s,this.webVitals=n,this.onSettle=r,this.performance=a,i.onStateChange(t=>{this.wasBackgrounded||"in-background"!==t||(this.wasBackgrounded=!0)})}install(t){if(!t.configuration.autoInstrumentFullPageLoads||this.wasBackgrounded)return;const{routingProvider:e,sendPageAttributes:s}=t.configuration;e&&(this.routeResolver=e.resolveRoute),s&&(this.sendPageAttributes=s),this.enabled=!0}start(){if(!this.enabled)return;let t=null;const e=document.querySelector('meta[name="traceparent"]');if(null!==e&&e.getAttribute("content")){const s=e.getAttribute("content"),[,n,r]=s.split("-");t={traceId:n,id:r}}const s=this.spanFactory.startSpan("[FullPageLoad]",{startTime:0,parentContext:t}),n=vt(this.sendPageAttributes||yt),r=new URL(this.location.href);this.onSettle(t=>{if(this.wasBackgrounded)return;const e=this.routeResolver(r)||wt(r);s.name+=e,((t,e,s,n)=>{function r(e,r,i){if(function(t,e){return void 0===t||void 0===e||0===t&&0===e}(r,i))return;const a=t.startSpan(`[PageLoadPhase/${e}]${s}`,{startTime:r,parentContext:n,makeCurrentContext:!1});a.setAttribute("bugsnag.span.category","page_load_phase"),a.setAttribute("bugsnag.phase",e),t.endSpan(a,i)}const i=e.getEntriesByType("navigation"),a=Array.isArray(i)&&i[0];if(a){r("Unload",a.unloadEventStart,a.unloadEventEnd),r("Redirect",a.redirectStart,a.redirectEnd),r("LoadFromCache",a.fetchStart,a.domainLookupStart),r("DNSLookup",a.domainLookupStart,a.domainLookupEnd);const t=a.secureConnectionStart||a.connectEnd;r("TCPHandshake",a.connectStart,t),r("TLS",a.secureConnectionStart,a.connectEnd),r("HTTPRequest",a.requestStart,a.responseStart),r("HTTPResponse",a.responseStart,a.responseEnd),r("DomContentLoadedEvent",a.domContentLoadedEventStart,a.domContentLoadedEventEnd),r("LoadEvent",a.loadEventStart,a.loadEventEnd)}})(this.spanFactory,this.performance,e,s),s.setAttribute("bugsnag.span.category","full_page_load"),s.setAttribute("bugsnag.browser.page.route",e),n.referrer&&s.setAttribute("bugsnag.browser.page.referrer",this.document.referrer),n.title&&s.setAttribute("bugsnag.browser.page.title",this.document.title),n.url&&s.setAttribute("bugsnag.browser.page.url",r.toString()),this.webVitals.attachTo(s),this.spanFactory.endSpan(s,t),"starting"===B()&&_("ready")})}}const Pt=["http://","https://","/","./","../"];class Tt{constructor(t,e,s,n){this.spanFactory=t,this.spanContextStorage=e,this.fetchTracker=s,this.xhrTracker=n,this.configEndpoint="",this.networkRequestCallback=ht,this.logger={debug:console.debug,warn:console.warn,info:console.info,error:console.error},this.enabled=!1,this.trackRequest=(t=>{if(!this.shouldTrackRequest(t))return;const e=!1,s={url:t.url,type:t.type,propagateTraceContext:e},n=this.networkRequestCallback(s);if(!n)return{onRequestEnd:void 0,extraRequestHeaders:void 0};if(void 0===n.propagateTraceContext&&(n.propagateTraceContext=e),!n.url)return{onRequestEnd:void 0,extraRequestHeaders:n.propagateTraceContext?this.getExtraRequestHeaders():void 0};if("string"!=typeof n.url)return void this.logger.warn("expected url to be a string following network request callback, got "+typeof n.url);const r=this.spanFactory.startNetworkSpan({method:t.method,startTime:t.startTime,url:n.url});return{onRequestEnd:t=>{"success"===t.state&&this.spanFactory.endSpan(r,t.endTime,{"http.status_code":t.status})},extraRequestHeaders:n.propagateTraceContext?this.getExtraRequestHeaders(r):void 0}})}install(t){if(!t.configuration.autoInstrumentNetworkRequests)return;const{endpoint:e,logger:s,networkRequestCallback:n}=t.configuration;s&&(this.logger=s),e&&(this.configEndpoint=e),n&&(this.networkRequestCallback=n),this.enabled=!0}start(){this.enabled&&(this.xhrTracker.onStart(this.trackRequest),this.fetchTracker.onStart(this.trackRequest))}shouldTrackRequest(t){return t.url!==this.configEndpoint&&Pt.some(e=>t.url.startsWith(e))}getExtraRequestHeaders(t=this.spanContextStorage.current){const e={};return t&&(e.traceparent=ct.toTraceParentString(t),e.tracestate=`sb=v:1;r32:${f(t.traceId)}`),e}}function xt(t){switch(t){case"":return;case"http/1.0":return"1.0";case"http/1.1":return"1.1";case"h2":case"h2c":return"2.0";case"h3":return"3.0";case"spdy/1":case"spdy/2":case"spdy/3":return"SPDY";default:return t}}class Rt{constructor(t,e,s){this.spanFactory=t,this.spanContextStorage=e,this.PerformanceObserverClass=s,this.enabled=!1,this.logger={debug:console.debug,warn:console.warn,info:console.info,error:console.error},this.networkRequestCallback=ht}install(t){if(!((e=this.PerformanceObserverClass)&&Array.isArray(e.supportedEntryTypes)&&e.supportedEntryTypes.includes("resource")))return;var e;const{logger:s,networkRequestCallback:n}=t.configuration;s&&(this.logger=s),n&&(this.networkRequestCallback=n),this.enabled=!0}start(){if(!this.enabled)return;const t=new this.PerformanceObserverClass(t=>{const e=t.getEntries();for(const t of e){if("fetch"===t.initiatorType||"xmlhttprequest"===t.initiatorType)continue;const e=this.spanContextStorage.first;if(e){const s=this.networkRequestCallback({url:t.name,type:t.initiatorType});if(!s)return;if("string"!=typeof s.url)return void this.logger.warn("expected url to be a string following network request callback, got "+typeof s.url);let n="";try{const t=new URL(s.url);t.search="",n=t.href}catch(t){return void this.logger.warn(`Unable to parse URL returned from networkRequestCallback: ${s.url}`)}const r=this.spanFactory.startSpan(`[ResourceLoad]${n}`,{parentContext:e,startTime:t.startTime,makeCurrentContext:!1});r.setAttribute("bugsnag.span.category","resource_load"),r.setAttribute("http.url",s.url);const i=xt(t.nextHopProtocol);i&&r.setAttribute("http.flavor",i),t.encodedBodySize&&t.decodedBodySize&&(r.setAttribute("http.response_content_length",t.encodedBodySize),r.setAttribute("http.response_content_length_uncompressed",t.decodedBodySize)),t.responseStatus&&r.setAttribute("http.status_code",t.responseStatus),this.spanFactory.endSpan(r,t.responseEnd)}}});try{t.observe({type:"resource",buffered:!0})}catch(e){this.logger.warn("Unable to get previous resource loads as buffered observer not supported, only showing resource loads from this point on"),t.observe({entryTypes:["resource"]})}}}const{startTime:Lt,parentContext:Et,makeCurrentContext:Vt}=v,It={startTime:Lt,parentContext:Et,makeCurrentContext:Vt,trigger:{getDefaultValue:t=>String(t),message:"should be a string",validate:i}};class Ft{constructor(t,e,s){this.spanFactory=t,this.location=e,this.document=s,this.enabled=!1,this.sendPageAttributes=yt,this.logger={debug:console.debug,warn:console.warn,info:console.info,error:console.error}}install(t){if(!t.configuration.autoInstrumentRouteChanges)return;const{logger:e,routingProvider:s,sendPageAttributes:n}=t.configuration;e&&(this.logger=e),s&&(this.routingProvider=s),n&&(this.sendPageAttributes=n),this.enabled=!0}start(){var t,e;if(!this.enabled)return;const s=new URL(this.location.href);let r=(null===(t=this.routingProvider)||void 0===t?void 0:t.resolveRoute(s))||wt(s);const i=vt(this.sendPageAttributes);null===(e=this.routingProvider)||void 0===e||e.listenForRouteChanges((t,e,s)=>{var a;let o;if(t instanceof URL)o=t;else try{const e=String(t);o=new URL(e)}catch(t){return this.logger.warn("Invalid span options\n  - url should be a URL"),{id:"",name:"",traceId:"",samplingRate:0,samplingProbability:0,isValid:()=>!1,setAttribute:()=>{},end:()=>{}}}_("navigating");const u={...s,trigger:e},l=this.spanFactory.validateSpanOptions("[RouteChange]",u,It),c=(null===(a=this.routingProvider)||void 0===a?void 0:a.resolveRoute(o))||wt(o);l.name+=c;const d=this.spanFactory.startSpan(l.name,l.options);return d.setAttribute("bugsnag.span.category","route_change"),d.setAttribute("bugsnag.browser.page.route",c),d.setAttribute("bugsnag.browser.page.previous_route",r),d.setAttribute("bugsnag.browser.page.route_change.trigger",l.options.trigger),i.url&&d.setAttribute("bugsnag.browser.page.url",t.toString()),r=c,{get id(){return d.id},get traceId(){return d.traceId},get samplingRate(){return d.samplingRate},get samplingProbability(){return d.samplingProbability},get name(){return d.name},isValid:d.isValid,setAttribute:d.setAttribute,end:t=>{var e;const s=n(t)?t:{endTime:t};if(i.title&&d.setAttribute("bugsnag.browser.page.title",this.document.title),s.url){const t=function(t){return"string"==typeof t?new URL(t):t}(s.url),n=(null===(e=this.routingProvider)||void 0===e?void 0:e.resolveRoute(t))||wt(t);d.name=`[RouteChange]${n}`,d.setAttribute("bugsnag.browser.page.route",n),r=n,i.url&&d.setAttribute("bugsnag.browser.page.url",t.toString())}this.spanFactory.toPublicApi(d).end(s.endTime),_("ready")}}})}}const qt=3e5;function Nt(t,e){return Math.abs(Date.now()-(t+e.now()))>qt?Date.now()-e.now():t}const Ot=t=>n(t)&&"function"==typeof t.resolveRoute&&"function"==typeof t.listenForRouteChanges;function $t(t){const e=t.toString(16);return 1===e.length?"0"+e:e}const Ut={generate(t){const e=new Uint8Array(t/8),s=window.crypto.getRandomValues(e);return Array.from(s).map($t).join("")}};class Bt{constructor(t){this.settled=!1,this.callbacks=new Set,this.clock=t}subscribe(t){this.callbacks.add(t),this.isSettled()&&t(this.clock.now())}unsubscribe(t){this.callbacks.delete(t)}isSettled(){return this.settled}settle(t){this.settled=!0;for(const e of this.callbacks)e(t)}}class _t extends Bt{constructor(t,e){super(t),this.timeout=void 0,new MutationObserver(()=>{this.restart()}).observe(e,{subtree:!0,childList:!0,characterData:!0}),this.restart()}restart(){clearTimeout(this.timeout),this.settled=!1;const t=this.clock.now();this.timeout=setTimeout(()=>{this.settle(t)},100)}}class Dt extends Bt{constructor(t,e,s,n){super(t),"complete"===n.readyState?setTimeout(()=>{this.settleUsingPerformance(s)},0):e("load",()=>{setTimeout(()=>{this.settleUsingPerformance(s)},0)})}settleUsingPerformance(t){const e=this.clock.now(),s="function"==typeof t.getEntriesByType?t.getEntriesByType("navigation")[0]:void 0;let n=0;!function(t){return!!t&&"navigation"===t.entryType}(s)?t.timing&&(n=t.timing.loadEventEnd-t.timing.navigationStart):n=s.loadEventEnd,(n<=0||n>e)&&(n=e),this.settle(n)}}class jt extends Bt{constructor(t,e){super(t),this.timeout=void 0,this.urlsToIgnore=[],this.outstandingRequests=0,this.settled=!0,e.onStart(this.onRequestStart.bind(this))}setUrlsToIgnore(t){this.urlsToIgnore=t}onRequestStart(t){if(!this.shouldIgnoreUrl(t.url))return clearTimeout(this.timeout),this.settled=!1,++this.outstandingRequests,{onRequestEnd:t=>{if(0==--this.outstandingRequests){const t=this.clock.now();this.timeout=setTimeout(()=>{this.settle(t)},100)}}}}shouldIgnoreUrl(t){return this.urlsToIgnore.some(e=>e.test(t))}}class Ht extends Bt{constructor(t,e){super(t),this.settlers=e;for(const t of e)t.subscribe(t=>{this.settlersAreSettled()?this.settle(t):this.settled=!1})}isSettled(){return super.isSettled()&&this.settlersAreSettled()}settlersAreSettled(){for(const t of this.settlers)if(!t.isSettled())return!1;return!0}}class Mt{constructor(t){this.storage=t}async load(t){try{const e=this.storage.getItem(t);if(e)return at(t,e)}catch(t){}}async save(t,e){try{this.storage.setItem(t,function(t,e){switch(t){case"bugsnag-sampling-probability":return JSON.stringify(e);case"bugsnag-anonymous-id":return e;default:return t}}(t,e))}catch(t){}}}class Qt{constructor(t,e,s){if(this.performance=t,this.clock=e,this.observers=[],s&&Array.isArray(s.supportedEntryTypes)){const t=s.supportedEntryTypes;t.includes("largest-contentful-paint")&&this.observeLargestContentfulPaint(s),t.includes("layout-shift")&&this.observeLayoutShift(s)}}attachTo(t){const e=this.firstContentfulPaint();e&&t.addEvent("fcp",e);const s=this.timeToFirstByte();s&&t.addEvent("ttfb",s);const n=this.firstInputDelay();n&&(t.addEvent("fid_start",n.start),t.addEvent("fid_end",n.end)),this.cumulativeLayoutShift&&t.setAttribute("bugsnag.metrics.cls",this.cumulativeLayoutShift),this.largestContentfulPaint&&t.addEvent("lcp",this.largestContentfulPaint);for(const t of this.observers)t.disconnect()}firstContentfulPaint(){const t=this.performance.getEntriesByName("first-contentful-paint","paint"),e=Array.isArray(t)&&t[0];if(e)return e.startTime}timeToFirstByte(){const t=this.performance.getEntriesByType("navigation"),e=Array.isArray(t)&&t[0];let s;if((s=e?e.responseStart:this.performance.timing.responseStart-this.performance.timing.navigationStart)>0&&s<=this.clock.now())return s}firstInputDelay(){const t=this.performance.getEntriesByType("first-input"),e=Array.isArray(t)&&t[0];if(e)return{start:e.startTime,end:e.processingStart}}observeLargestContentfulPaint(t){const e=new t(t=>{const e=t.getEntries();e.length>0&&(this.largestContentfulPaint=e[e.length-1].startTime)});e.observe({type:"largest-contentful-paint",buffered:!0}),this.observers.push(e)}observeLayoutShift(t){let e;const s=new t(t=>{for(const s of t.getEntries())s.hadRecentInput||(e&&s.startTime-e.previousStartTime<1e3&&s.startTime-e.firstStartTime<5e3?(e.value+=s.value,e.previousStartTime=s.startTime):e={value:s.value,firstStartTime:s.startTime,previousStartTime:s.startTime});e&&(void 0===this.cumulativeLayoutShift||e.value>this.cumulativeLayoutShift)&&(this.cumulativeLayoutShift=e.value)});s.observe({type:"layout-shift",buffered:!0}),this.observers.push(s)}}let Kt,zt,Jt;if("undefined"==typeof window||"undefined"==typeof document)Kt=function(){const t=()=>{};return t.install=(()=>{}),t.start=(()=>{}),t}(),zt=kt(),Jt=function(){const t=()=>{};return{start:t,startSpan:()=>({id:"",traceId:"",end:t,isValid:()=>!1}),currentSpanContext:void 0}}();else{const t="localhost"===window.location.hostname,e=function(t){const e=[];let s="hidden"===t.document.visibilityState?"in-background":"in-foreground";const n={onStateChange(t){e.push(t),"in-background"===s&&t(s)}},r=t=>{if(s!==t){s=t;for(const t of e)t(s)}};return t.document.addEventListener("visibilitychange",function(){const e="hidden"===t.document.visibilityState?"in-background":"in-foreground";r(e)}),t.addEventListener("pagehide",function(){r("in-background")}),t.addEventListener("pageshow",function(){r("in-foreground")}),n}(window),r=(t=>{const e={url:{name:"bugsnag.browser.page.url",getValue:()=>t.location.href,permitted:!1},title:{name:"bugsnag.browser.page.title",getValue:()=>t.title,permitted:!1}};return{configure(t){e.title.permitted=t.sendPageAttributes.title||!1,e.url.permitted=t.sendPageAttributes.url||!1},requestAttributes(t){for(const s of Object.values(e))s.permitted&&t.setAttribute(s.name,s.getValue())}}})(document),u=function(t,e){let s=Nt(void 0===t.timeOrigin?t.timing.navigationStart:t.timeOrigin,t);e.onStateChange(e=>{"in-foreground"===e&&(s=Nt(s,t))});const n=t=>g(s+t);return{now:()=>t.now(),date:()=>new Date(s+t.now()),convert:t=>t.getTime()-s,toUnixNanoseconds:n,toUnixTimestampNanoseconds:t=>n(t).toString()}}(performance,e),l=function(t){try{if(t.localStorage)return new Mt(t.localStorage)}catch(t){}return new it}(window),c=function(t,e){let s,n;return function(r){const i=new d(r.releaseStage,r.appVersion,r.serviceName,"bugsnag.performance.browser","2.15.0",r.logger);if(i.set("browser.user_agent",t.userAgent),t.userAgentData&&(i.set("browser.platform",t.userAgentData.platform),i.set("browser.mobile",t.userAgentData.mobile)),r.generateAnonymousId){if(s||(s=e.load("bugsnag-anonymous-id").then(t=>{const s=t||nt();return t||e.save("bugsnag-anonymous-id",s),n=s})),!n)return s.then(t=>(i.set("device.id",t),i));i.set("device.id",n)}return Promise.resolve(i)}}(navigator,l),h=function(t,e){const s=new pt,n=t.fetch;return t.fetch=function(r,i){const a=function(t,e,s,n){const r=mt(e),i=r?e.url:String(e),a=!!s&&s.method||r&&e.method||"GET";return{url:ft(i,n),method:a,startTime:t,type:"fetch"}}(e.now(),r,i,t.document&&t.document.baseURI),{onRequestEnd:o,extraRequestHeaders:u}=s.start(a),l=function(t,e,s){if(!s)return[t,e];const n=s.reduce((t,e)=>({...t,...e}),{});return!mt(t)||e&&e.headers?e=function(t,e){if(e||(e={}),function(t){return!!t&&"object"==typeof t&&t instanceof Headers}(e.headers)){for(const[s,n]of Object.entries(t))e.headers.has(s)||e.headers.set(s,n);return e}return{...e,headers:{...t,...e.headers}}}(n,e):function(t,e){for(const[s,n]of Object.entries(t))e.headers.has(s)||e.headers.set(s,n)}(n,t),[t,e]}(r,i,u);return n.call(this,l[0],l[1]).then(t=>(o({status:t.status,endTime:e.now(),state:"success"}),t)).catch(t=>{throw o({error:t,endTime:e.now(),state:"error"}),t})},s}(window,u),b=function(t,e,s){const n=new pt,r=new WeakMap,i=new WeakMap,a=t.prototype.open;t.prototype.open=function(t,e,...n){r.set(this,{method:t,url:ft(String(e),s&&s.baseURI)}),a.call(this,t,e,...n)};const o=t.prototype.send;return t.prototype.send=function(s){const a=r.get(this);if(a){const s=i.get(this);s&&this.removeEventListener("readystatechange",s);const{onRequestEnd:r,extraRequestHeaders:o}=n.start({type:"xmlhttprequest",method:a.method,url:a.url,startTime:e.now()});if(o)for(const t of o)for(const[e,s]of Object.entries(t))this.setRequestHeader(e,s);const u=s=>{if(this.readyState===t.DONE&&r){const t=this.status>0?{endTime:e.now(),status:this.status,state:"success"}:{endTime:e.now(),state:"error"};r(t)}};this.addEventListener("readystatechange",u),i.set(this,u)}o.call(this,s)},n}(XMLHttpRequest,u,document),f=new Qt(performance,u,window.PerformanceObserver);zt=Ct(Kt=function(t,e,s,n,r){const i=new _t(t,e.document),a=new jt(t,s),o=new jt(t,n),u=new Dt(t,e.addEventListener,r,e.document),l=new Ht(t,[i,u,a,o]);function c(e){const s=t=>{clearTimeout(n),l.unsubscribe(s),e(t)},n=setTimeout(()=>{const n=t.now();l.unsubscribe(s),e(n)},6e4),r=l.isSettled()?100:0,i=t.now();setTimeout(()=>{l.isSettled()?s(i):l.subscribe(s)},r)}return c.install=function(t){const e=[];t.configuration.endpoint&&e.push(RegExp(t.configuration.endpoint)),t.configuration.settleIgnoreUrls&&e.push(...t.configuration.settleIgnoreUrls.map(t=>"string"==typeof t?RegExp(t):t)),a.setUrlsToIgnore(e),o.setUrlsToIgnore(e)},c.start=function(){},c}(u,window,h,b,performance),window.location),Jt=function(t){const e=new V,s=t.spanContextStorage||new q(t.backgroundingListener);let r=t.schema.logger.defaultValue;_("starting");const a=new F(1),o=new(t.spanFactory||$)(e,a,t.idGenerator,t.spanAttributesSource,t.clock,t.backgroundingListener,r,s),u=new N,l=new x;return l.addPlugins(t.plugins(o,s)),{start:e=>{const c=function(t,e,s=!1){if("string"==typeof t&&(t={apiKey:t}),!n(t)||!i(t.apiKey)||0===t.apiKey.length)throw new Error("No Bugsnag API Key set");let r="";const a={};for(const s of Object.keys(e))Object.prototype.hasOwnProperty.call(t,s)?e[s].validate(t[s])?a[s]=t[s]:(r+=`\n  - ${s} ${e[s].message}, got ${typeof t[s]}`,a[s]=e[s].defaultValue):a[s]=e[s].defaultValue;const o=s?5e3:3e4;return a.apiKey=t.apiKey,a.maximumBatchSize=t.maximumBatchSize||100,a.batchInactivityTimeoutMs=t.batchInactivityTimeoutMs||o,r.length>0&&a.logger.warn(`Invalid configuration${r}`),a}(e,t.schema,t.isDevelopment);if(c.endpoint===p.endpoint.defaultValue&&(c.apiKey.startsWith("00000")?c.endpoint="https://otlp.insighthub.smartbear.com/v1/traces":c.endpoint=c.endpoint.replace("https://",`https://${c.apiKey}.`)),c.bugsnag&&"function"==typeof c.bugsnag.Event.prototype.setTraceCorrelation&&c.bugsnag.Client){const t=c.bugsnag.Client.prototype._notify;c.bugsnag.Client.prototype._notify=function(...e){const n=s.current;n&&"function"==typeof e[0].setTraceCorrelation&&e[0].setTraceCorrelation(n.traceId,n.id),t.apply(this,e)}}l.addPlugins(c.plugins);const d=l.installPlugins(c,t.clock);u.addProviders(d.spanControlProviders);const h=new P(d.onSpanStartCallbacks),g=new P(d.onSpanEndCallbacks);c.onSpanStart&&h.addAll(c.onSpanStart.map(t=>({item:t,priority:A}))),c.onSpanEnd&&g.addAll(c.onSpanEnd.map(t=>({item:t,priority:A}))),c.onSpanStart=Array.from(h),c.onSpanEnd=Array.from(g),o.configure(c);const b=t.deliveryFactory(c.endpoint);(void 0===c.samplingProbability?E.create(t.persistence,a,new R(b,c.apiKey)):C.create(a,c.samplingProbability)).then(e=>{const s=new S(b,c,t.retryQueueFactory(b,c.retryQueueMaxSize),a,e,new w(t.clock,c,t.resourceAttributesSource));o.reprocessEarlySpans(s),t.backgroundingListener.onStateChange(t=>{s.flush(),"in-foreground"===t&&e.ensureFreshProbability()}),r=c.logger}),l.startPlugins()},startSpan:(t,e)=>{const s=o.validateSpanOptions(t,e),n=o.startSpan(s.name,s.options);return n.setAttribute("bugsnag.span.category","custom"),o.toPublicApi(n)},startNetworkSpan:e=>{const s=o.startNetworkSpan(e);return{...o.toPublicApi(s),end:e=>{o.endSpan(s,O(t.clock,e.endTime),{"http.status_code":e.status})}}},getPlugin:t=>l.getPlugin(t),getSpanControls:t=>u.getSpanControls(t),get currentSpanContext(){return s.current},get appState(){return B()},...t.platformExtensions&&t.platformExtensions(o,s)}}({isDevelopment:t,backgroundingListener:e,clock:u,resourceAttributesSource:c,spanAttributesSource:r,deliveryFactory:function(t,e,s){let n=!1;return s&&s.onStateChange(t=>{n="in-background"===t}),function(s){return{async send(r){const i=JSON.stringify(r.body);r.headers["Bugsnag-Sent-At"]=e.date().toISOString();try{const e=await t(s,{method:"POST",keepalive:n,body:i,headers:r.headers});return{state:(a=e.status,a>=200&&a<300?"success":a>=400&&a<500&&!k.has(a)?"failure-discard":"failure-retryable"),samplingProbability:dt(e.headers)}}catch(t){return i.length>1e6?{state:"failure-discard"}:{state:"failure-retryable"}}var a}}}}(window.fetch,u,e),idGenerator:Ut,schema:function(t,e=!1){return{...p,releaseStage:{...p.releaseStage,defaultValue:e?"development":"production"},autoInstrumentFullPageLoads:{defaultValue:!0,message:"should be true|false",validate:s},autoInstrumentNetworkRequests:{defaultValue:!0,message:"should be true|false",validate:s},autoInstrumentRouteChanges:{defaultValue:!0,message:"should be true|false",validate:s},generateAnonymousId:{defaultValue:!0,message:"should be true|false",validate:s},routingProvider:{defaultValue:t,message:"should be a routing provider",validate:Ot},settleIgnoreUrls:{defaultValue:[],message:"should be an array of string|RegExp",validate:o},networkRequestCallback:{defaultValue:ht,message:"should be a function",validate:gt},sendPageAttributes:{defaultValue:yt,message:"should be an object",validate:St},serviceName:{defaultValue:"unknown_service",message:"should be a string",validate:a}}}(new zt,t),plugins:(t,s)=>[Kt,new At(document,window.location,t,f,Kt,e,performance),new Rt(t,s,window.PerformanceObserver),new Tt(t,s,h,b),new Ft(t,window.location,document)],persistence:l,retryQueueFactory:(t,e)=>new ot(t,e)})}const Wt=Jt;export{zt as DefaultRoutingProvider,Wt as default,wt as defaultRouteResolver,Kt as onSettle};
//# sourceMappingURL=bugsnag-performance.min.js.map
