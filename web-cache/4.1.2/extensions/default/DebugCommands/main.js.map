{"version":3,"sources":["extensions/default/DebugCommands/extension-min.js"],"names":["define","require","exports","module","_","brackets","getModule","Commands","CommandManager","Menus","FileSystem","FileUtils","PerfUtils","StringUtils","Dialogs","DragAndDrop","Strings","PreferencesManager","LocalizationUtils","MainViewManager","WorkingSetView","ExtensionManager","Mustache","Locales","ProjectManager","ExtensionLoader","NodeConnector","extensionDevelopment","PerfDialogTemplate","TestBuilder","LanguageDialogTemplate","KeyboardPrefs","JSON","parse","DIAGNOSTICS_SUBMENU","EXPERIMENTAL_FEATURES_SUB_MENU","DEFAULT_PREFERENCES_FILENAME","SUPPORTED_PREFERENCE_TYPES","recomputeDefaultPrefs","defaultPreferencesFullPath","path","normalize","app","getApplicationSupportDirectory","DEBUG_REFRESH_WINDOW","DEBUG_SHOW_DEVELOPER_TOOLS","DEBUG_LOAD_CURRENT_EXTENSION","DEBUG_UNLOAD_CURRENT_EXTENSION","DEBUG_RUN_UNIT_TESTS","DEBUG_SHOW_PERF_DATA","DEBUG_RELOAD_WITHOUT_USER_EXTS","DEBUG_SWITCH_LANGUAGE","DEBUG_ENABLE_LOGGING","DEBUG_ENABLE_PHNODE_INSPECTOR","DEBUG_GET_PHNODE_INSPECTOR_URL","DEBUG_LIVE_PREVIEW_LOGGING","DEBUG_GIT_EXTENSION_LOGGING","DEBUG_OPEN_VFS","DEBUG_OPEN_EXTENSION_FOLDER","DEBUG_OPEN_VIRTUAL_SERVER","DEBUG_OPEN_PREFERENCES_IN_SPLIT_VIEW","DEBUG_BUILD_TESTS","DEBUG_DRAG_AND_DROP","LOG_TO_CONSOLE_KEY","logger","loggingOptions","LOCAL_STORAGE_KEYS","LOG_LIVE_PREVIEW_KEY","LOG_LIVE_PREVIEW","LOG_GIT_KEY","LOG_GIT","prefs","getExtensionPrefs","_runUnitTests","spec","queryString","testBaseURL","window","location","hostname","Phoenix","openURLInPhoenixWindow","windowTitle","preferTabs","width","height","handleReload","execute","APP_RELOAD","handleReloadWithoutUserExts","APP_RELOAD_WITHOUT_EXTS","handleShowPerfData","templateVars","delimitedPerfData","getDelimitedPerfData","perfData","getValue","entry","Array","isArray","i","e","avg","sum","min","Number","MAX_VALUE","max","length","Math","round","String","getData","forEach","value","testName","push","breakableUrl","template","render","showModalDialogUsingTemplate","$","click","this","focus","select","handleSwitchLanguage","supportedLocales","Object","keys","$dialog","$submit","$select","locale","curLocale","isLocaleDefault","getLocale","languages","setLanguage","event","val","prop","supportedLocale","match","language","label","toUpperCase","getLocalizedLabel","sort","lang1","lang2","localeCompare","unshift","LANGUAGE_SYSTEM_DEFAULT","done","id","DIALOG_BTN_OK","setLocale","find","on","_openPrefFilesInSplitView","prefsPath","defaultPrefsPath","deferredPromise","currScheme","getLayoutScheme","file","getFileForPath","defaultPrefsFile","DEFAULT_PREFS_PANE","USER_PREFS_PANE","_openFiles","rows","columns","setLayoutScheme","FILE_OPEN","fullPath","paneId","options","isReadOnly","findInWorkingSet","_moveView","refresh","resolve","fail","reject","get","resultObj","findInAllWorkingSets","FILE_CLOSE","_isSupportedPrefType","prefType","indexOf","_getPrefType","prefItem","finalPrefType","_prefType","type","undefined","toLowerCase","initial","_initialType","_prefVar","_isValidPref","pref","excludeFromHints","_getChildPrefs","finalObj","keysFound","_populateKeys","allKeys","hasOwnProperty","_formatBasicPref","prefName","tabIndentStr","prefDescription","description","prefDefault","prefFormatText","prefItemType","DEFAULT_PREFERENCES_JSON_DEFAULT","format","_formatPref","indentLevel","iLevel","prefItemKeys","entireText","prefItemDesc","hasKeys","tabIndents","numKeys","property","formattedText","slice","_getDefaultPreferencesString","allPrefs","getAllPreferences","headerComment","DEFAULT_PREFERENCES_JSON_HEADER_COMMENT","_loadDefaultPrefs","_executeDefaultOpenPrefsCommand","FILE_OPEN_PREFERENCES","exists","err","doesExist","prefsString","unlink","console","error","writeText","_prefsString","handleOpenPrefsInSplitView","getUserPrefFile","splitViewPrefOn","result","Deferred","promise","_updateLogToConsoleMenuItemChecked","isLogging","setupLogging","setChecked","setEnabled","logLivePreview","isLoggingEnabled","logGit","isInspectEnabled","_handleLogging","toggleLoggingKey","_handlePhNodeInspectEnable","setInspectEnabled","_handleGetPhNodeInspectURL","showInfoDialog","CMD_GET_PHNODE_INSPECTOR_URL","getInspectPort","_handleLivePreviewLogging","_handleGitLogging","_openVFS","openProject","_openExtensionsFolder","openPathInFileBrowser","getUserExtensionPath","_openVirtualServer","virtualServingURL","VFS","getVirtualServingURLForPath","Error","_handleShowDeveloperTools","toggleDevtools","definePreference","DESCRIPTION_OPEN_PREFS_IN_SPLIT_VIEW","DESCRIPTION_OPEN_USER_PREFS_IN_SECOND_PANE","loadOrReloadString","isProjectLoadedAsExtension","CMD_RELOAD_CURRENT_EXTENSION","CMD_LOAD_CURRENT_EXTENSION","register","loadCurrentExtension","CMD_UNLOAD_CURRENT_EXTENSION","unloadCurrentExtension","CMD_REFRESH_WINDOW","CMD_RELOAD_WITHOUT_USER_EXTS","CMD_RUN_UNIT_TESTS","CMD_SHOW_PERF_DATA","switchLanguageStr","CMD_SWITCH_LANGUAGE","CMD_ENABLE_LOGGING","CMD_ENABLE_PHNODE_INSPECTOR","CMD_ENABLE_LIVE_PREVIEW_LOGS","CMD_ENABLE_GIT_LOGS","CMD_OPEN_VFS","CMD_OPEN_EXTENSIONS_FOLDER","CMD_OPEN_VIRTUAL_SERVER","CMD_OPEN_PREFERENCES","debugMenu","getMenu","AppMenuBar","DEBUG_MENU","addMenuItem","debugMode","refreshWindow","reloadWithoutUserExts","hideWhenCommandDisabled","addMenuDivider","isNativeApp","CMD_SHOW_DEV_TOOLS","showDeveloperTools","FILE_OPEN_KEYMAP","REINSTALL_CREDS","diagnosticsSubmenu","addSubMenu","CMD_DIAGNOSTIC_TOOLS","CMD_BUILD_TESTS","toggleTestBuilder","experimentalSubmenu","CMD_EXPERIMENTAL_FEATURES","CMD_ENABLE_DRAG_AND_DROP","set","_PREF_DRAG_AND_DROP","helpMenu","HELP_MENU","BEFORE","HELP_YOUTUBE","AFTER","fileMenu","FILE_MENU","MenuSection","FILE_SETTINGS","sectionMarker","FileViewController","EditorManager","KeyEvent","Editor","openFile","filePath","startsWith","jsPromise","openFileAndAddToWorkingSet","projectFilePath","join","getProjectRoot","readTextFile","bypassCache","readAsText","writeTextFile","text","allowBlindWrite","deletePath","Promise","fs","setCursors","selections","activeEditor","getActiveEditor","parsedSelections","map","selection","parts","split","line","ch","isNaN","start","end","fromLine","fromCh","toLine","toCh","setSelections","computeCursors","editor","addQuotes","getSelections","cursor","expectCursorsToBe","expectedSelections","currentSelections","includes","raiseKeyEvent","key","element","doc","ownerDocument","view","defaultView","bubbles","cancelable","keyIdentifer","keyIdentifier","oEvent","KeyboardEvent","defineProperty","keyCodeVal","keyCode","log","dispatchEvent","keydown","keysArray","modifiers","document","activeElement","typeAtCursor","origin","replaceRange","_toPos","posString","pos","validateText","from","to","selectedText","getTextBetween","_getMarkLocations","markType","whichAPI","marks","getAllMarks","marksLocations","mark","loc","validateAllMarks","validateEqual","obj1","obj2","message","isEqual","stringify","validateNotEqual","validateMarks","totalMarkCount","closeFile","_forceClose","closeAll","FILE_CLOSE_ALL","execCommand","commandID","arg","undo","EDIT_UNDO","redo","EDIT_REDO","setPreference","getPreference","_getFullPath","EDITING","setEditorSpacing","useTabs","spaceOrTabCount","isAutoMode","getAutoTabSpaces","setAutoTabSpaces","_autoDetectTabSpaces","setUseTabChar","setTabSize","setSpaceUnits","splitVertical","CMD_SPLITVIEW_VERTICAL","splitHorizontal","CMD_SPLITVIEW_HORIZONTAL","splitNone","CMD_SPLITVIEW_NONE","getFirstPaneEditor","getCurrentlyViewedEditor","getSecondPaneEditor","isSplit","getPaneCount","openFileInFirstPane","addToWorkingSet","command","CMD_ADD_TO_WORKINGSET_AND_OPEN","openFileInSecondPane","focusFirstPane","setActivePaneId","focusSecondPane","awaitsFor","pollFn","_timeoutMessageOrMessageFn","timeoutms","pollInterval","async","_getExpectMessage","stack","_timeoutPromise","ms","timeout","setTimeout","race","startTime","Date","now","lapsedTime","pollingFn","prototype","toString","call","waitForModalDialog","dialogClass","friendlyName","$dlg","waitForModalDialogClosed","_clickDialogButtonWithSelector","selectorOrButtonID","isButtonID","$button","clickDialogButtonID","buttonID","clickDialogButton","buttonSelector","saveActiveFile","FILE_SAVE","__PR","runMacro","macroText","errors","AsyncFunction","constructor","macroAsync","lineNo","errorCode","errorText","isTestWindow","DocumentManager","DefaultDialogs","UrlParams","_showError","title","ERROR_LOADING_EXTENSION","showModalDialog","DIALOG_ID_ERROR","_validatePackageJson","docText","packageJson","requiredFields","missingFields","requiredField","engines","ERROR_INVALID_EXTENSION_PACKAGE_FIELDS","ERROR_INVALID_EXTENSION_PACKAGE","projectRoot","getDocumentText","ERROR_NO_EXTENSION_PACKAGE","params","AppInit","WorkspaceManager","MacroRunner","BUILD_SCRATCH_FILE","builderPanel","$panel","builderEditor","panelHTML","createBottomPanel","hide","_setupPanel","then","setVisible","isVisible","saveFile","openErr","runTests","getText","errorHTML","showErrorDialog","runSelection","getSelectedText","_locateCursor","formattedSelections","getCursorPos","_validateText","getSelection","selectionText","quotedString","replaceAll","_validateMarks","findMarksAt","filter","markTypeMap","isExists","existsAsync","write","blind","getDocumentForPath","_$editor","updateLayout","ResizeObserver","observe","appReady"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2012 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*globals path, logger, Phoenix*/\n/*jslint regexp: true */\n\ndefine(function (require, exports, module) {\n\n\n    const _ = brackets.getModule(\"thirdparty/lodash\");\n\n    const Commands               = brackets.getModule(\"command/Commands\"),\n        CommandManager         = brackets.getModule(\"command/CommandManager\"),\n        Menus                  = brackets.getModule(\"command/Menus\"),\n        FileSystem             = brackets.getModule(\"filesystem/FileSystem\"),\n        FileUtils              = brackets.getModule(\"file/FileUtils\"),\n        PerfUtils              = brackets.getModule(\"utils/PerfUtils\"),\n        StringUtils            = brackets.getModule(\"utils/StringUtils\"),\n        Dialogs                = brackets.getModule(\"widgets/Dialogs\"),\n        DragAndDrop            = brackets.getModule(\"utils/DragAndDrop\"),\n        Strings                = brackets.getModule(\"strings\"),\n        PreferencesManager     = brackets.getModule(\"preferences/PreferencesManager\"),\n        LocalizationUtils      = brackets.getModule(\"utils/LocalizationUtils\"),\n        MainViewManager        = brackets.getModule(\"view/MainViewManager\"),\n        WorkingSetView         = brackets.getModule(\"project/WorkingSetView\"),\n        ExtensionManager       = brackets.getModule(\"extensibility/ExtensionManager\"),\n        Mustache               = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Locales                = brackets.getModule(\"nls/strings\"),\n        ProjectManager         = brackets.getModule(\"project/ProjectManager\"),\n        ExtensionLoader        = brackets.getModule(\"utils/ExtensionLoader\"),\n        NodeConnector          = brackets.getModule(\"NodeConnector\"),\n        extensionDevelopment   = require(\"extensionDevelopment\"),\n        PerfDialogTemplate     = require(\"text!htmlContent/perf-dialog.html\"),\n        TestBuilder      = require(\"./testBuilder\"),\n        LanguageDialogTemplate = require(\"text!htmlContent/language-dialog.html\");\n\n    const KeyboardPrefs = JSON.parse(require(\"text!keyboard.json\"));\n\n    const DIAGNOSTICS_SUBMENU = \"debug-diagnostics-sub-menu\",\n        EXPERIMENTAL_FEATURES_SUB_MENU = \"debug-experimental-features\";\n\n    // default preferences file name\n    const DEFAULT_PREFERENCES_FILENAME = \"defaultPreferences.json\",\n        SUPPORTED_PREFERENCE_TYPES   = [\"number\", \"boolean\", \"string\", \"array\", \"object\"];\n\n    let recomputeDefaultPrefs        = true,\n        defaultPreferencesFullPath   = path.normalize(brackets.app.getApplicationSupportDirectory() + \"/\" + DEFAULT_PREFERENCES_FILENAME);\n\n     /**\n      * Debug commands IDs\n      * @enum {string}\n      */\n    const DEBUG_REFRESH_WINDOW                = \"debug.refreshWindow\", // string must MATCH string in native code (brackets_extensions)\n        DEBUG_SHOW_DEVELOPER_TOOLS            = \"debug.showDeveloperTools\",\n        DEBUG_LOAD_CURRENT_EXTENSION          = \"debug.loadCurrentExtension\",\n        DEBUG_UNLOAD_CURRENT_EXTENSION        = \"debug.unloadCurrentExtension\",\n        DEBUG_RUN_UNIT_TESTS                  = \"debug.runUnitTests\",\n        DEBUG_SHOW_PERF_DATA                  = \"debug.showPerfData\",\n        DEBUG_RELOAD_WITHOUT_USER_EXTS        = \"debug.reloadWithoutUserExts\",\n        DEBUG_SWITCH_LANGUAGE                 = \"debug.switchLanguage\",\n        DEBUG_ENABLE_LOGGING                  = \"debug.enableLogging\",\n        DEBUG_ENABLE_PHNODE_INSPECTOR         = \"debug.enablePhNodeInspector\",\n        DEBUG_GET_PHNODE_INSPECTOR_URL        = \"debug.getPhNodeInspectorURL\",\n        DEBUG_LIVE_PREVIEW_LOGGING            = \"debug.livePreviewLogging\",\n        DEBUG_GIT_EXTENSION_LOGGING           = \"debug.gitLogging\",\n        DEBUG_OPEN_VFS                        = \"debug.openVFS\",\n        DEBUG_OPEN_EXTENSION_FOLDER           = \"debug.openExtensionFolders\",\n        DEBUG_OPEN_VIRTUAL_SERVER             = \"debug.openVirtualServer\",\n        DEBUG_OPEN_PREFERENCES_IN_SPLIT_VIEW  = \"debug.openPrefsInSplitView\",\n        DEBUG_BUILD_TESTS                     = \"debug.buildTests\",\n        DEBUG_DRAG_AND_DROP                   = \"debug.dragAndDrop\";\n\n    const LOG_TO_CONSOLE_KEY = logger.loggingOptions.LOCAL_STORAGE_KEYS.LOG_TO_CONSOLE_KEY,\n        LOG_LIVE_PREVIEW_KEY = logger.loggingOptions.LOCAL_STORAGE_KEYS.LOG_LIVE_PREVIEW,\n        LOG_GIT_KEY = logger.loggingOptions.LOCAL_STORAGE_KEYS.LOG_GIT;\n\n    // define a preference to turn off opening preferences in split-view.\n    var prefs = PreferencesManager.getExtensionPrefs(\"preferencesView\");\n    prefs.definePreference(\"openPrefsInSplitView\",   \"boolean\", true, {\n        description: Strings.DESCRIPTION_OPEN_PREFS_IN_SPLIT_VIEW\n    });\n\n    prefs.definePreference(\"openUserPrefsInSecondPane\",   \"boolean\", true, {\n        description: Strings.DESCRIPTION_OPEN_USER_PREFS_IN_SECOND_PANE\n    });\n\n    // Implements the 'Run Tests' menu to bring up the Jasmine unit test window\n    function _runUnitTests(spec) {\n        let queryString = spec ? \"?spec=\" + spec : \"?suite=unit\";\n        let testBaseURL = \"../test/SpecRunner.html\";\n        if(window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1'){\n            // must be a deployed in phcode.dev/other sites. point to site test url\n            testBaseURL = \"test/SpecRunner.html\";\n        }\n        Phoenix.app.openURLInPhoenixWindow(testBaseURL + queryString, {\n            windowTitle: \"Test Runner\",\n            preferTabs: true,\n            width: 1670,\n            height: 900\n        });\n    }\n\n    function handleReload() {\n        CommandManager.execute(Commands.APP_RELOAD);\n    }\n\n    function handleReloadWithoutUserExts() {\n        CommandManager.execute(Commands.APP_RELOAD_WITHOUT_EXTS);\n    }\n\n    function handleShowPerfData() {\n        var templateVars = {\n            delimitedPerfData: PerfUtils.getDelimitedPerfData(),\n            perfData: []\n        };\n\n        var getValue = function (entry) {\n            // entry is either an Array or a number\n            if (Array.isArray(entry)) {\n                // For Array of values, return: minimum/average(count)/maximum/last\n                var i, e, avg, sum = 0, min = Number.MAX_VALUE, max = 0;\n\n                for (i = 0; i < entry.length; i++) {\n                    e = entry[i];\n                    min = Math.min(min, e);\n                    sum += e;\n                    max = Math.max(max, e);\n                }\n                avg = Math.round(sum * 10 / entry.length) / 10; // tenth of a millisecond\n                return String(min) + \"/\" + String(avg) + \"(\" + entry.length + \")/\" + String(max) + \"/\" + String(e);\n            }\n            return entry;\n\n        };\n\n        var perfData = PerfUtils.getData();\n        _.forEach(perfData, function (value, testName) {\n            templateVars.perfData.push({\n                testName: StringUtils.breakableUrl(testName),\n                value: getValue(value)\n            });\n        });\n\n        var template = Mustache.render(PerfDialogTemplate, templateVars);\n        Dialogs.showModalDialogUsingTemplate(template);\n\n        // Select the raw perf data field on click since select all doesn't\n        // work outside of the editor\n        $(\"#brackets-perf-raw-data\").click(function () {\n            $(this).focus().select();\n        });\n    }\n\n    function handleSwitchLanguage() {\n        const supportedLocales = Object.keys(Locales);\n\n        var $dialog,\n            $submit,\n            $select,\n            locale,\n            curLocale = (brackets.isLocaleDefault() ? null : brackets.getLocale()),\n            languages = [];\n\n        var setLanguage = function (event) {\n            locale = $select.val();\n            $submit.prop(\"disabled\", locale === (curLocale || \"\"));\n        };\n\n        for(let supportedLocale of supportedLocales){\n            var match = supportedLocale.match(/^([a-z]{2})(-[a-z]{2})?$/);\n\n            if (match) {\n                var language = supportedLocale,\n                    label = match[1];\n\n                if (match[2]) {\n                    label += match[2].toUpperCase();\n                }\n\n                languages.push({label: LocalizationUtils.getLocalizedLabel(label), language: language});\n            }\n        }\n        // add English (US), which is the root folder and should be sorted as well\n        languages.push({label: LocalizationUtils.getLocalizedLabel(\"en\"),  language: \"en\"});\n\n        // sort the languages via their display name\n        languages.sort(function (lang1, lang2) {\n            return lang1.label.localeCompare(lang2.label);\n        });\n\n        // add system default (which is placed on the very top)\n        languages.unshift({label: Strings.LANGUAGE_SYSTEM_DEFAULT, language: null});\n\n        var template = Mustache.render(LanguageDialogTemplate, {languages: languages, Strings: Strings});\n        Dialogs.showModalDialogUsingTemplate(template).done(function (id) {\n            if (id === Dialogs.DIALOG_BTN_OK && locale !== curLocale) {\n                brackets.setLocale(locale);\n                CommandManager.execute(Commands.APP_RELOAD);\n            }\n        });\n\n        $dialog = $(\".switch-language.instance\");\n        $submit = $dialog.find(\".dialog-button[data-button-id='\" + Dialogs.DIALOG_BTN_OK + \"']\");\n        $select = $dialog.find(\"select\");\n\n        $select.on(\"change\", setLanguage).val(curLocale);\n    }\n\n    function _openPrefFilesInSplitView(prefsPath, defaultPrefsPath, deferredPromise) {\n\n        var currScheme         = MainViewManager.getLayoutScheme(),\n            file               = FileSystem.getFileForPath(prefsPath),\n            defaultPrefsFile   = FileSystem.getFileForPath(defaultPrefsPath),\n            DEFAULT_PREFS_PANE = \"first-pane\",\n            USER_PREFS_PANE    = \"second-pane\";\n\n        // Exchange the panes, if default preferences need to be opened\n        // in the right pane.\n        if (!prefs.get(\"openUserPrefsInSecondPane\")) {\n            DEFAULT_PREFS_PANE = \"second-pane\";\n            USER_PREFS_PANE    = \"first-pane\";\n        }\n\n        function _openFiles() {\n\n            if (currScheme.rows === 1 && currScheme.columns === 1) {\n                // Split layout is not active yet. Initiate the\n                // split view.\n                MainViewManager.setLayoutScheme(1, 2);\n            }\n\n            // Open the default preferences in the left pane in the read only mode.\n            CommandManager.execute(Commands.FILE_OPEN, { fullPath: defaultPrefsPath, paneId: DEFAULT_PREFS_PANE, options: { isReadOnly: true } })\n                .done(function () {\n\n                    // Make sure the preference file is going to be opened in pane\n                    // specified in the preference.\n                    if (MainViewManager.findInWorkingSet(DEFAULT_PREFS_PANE, prefsPath) >= 0) {\n\n                        MainViewManager._moveView(DEFAULT_PREFS_PANE, USER_PREFS_PANE, file, 0, true);\n\n                        // Now refresh the project tree by asking\n                        // it to rebuild the UI.\n                        WorkingSetView.refresh(true);\n                    }\n\n                    CommandManager.execute(Commands.FILE_OPEN, { fullPath: prefsPath, paneId: USER_PREFS_PANE})\n                        .done(function () {\n                            deferredPromise.resolve();\n                        }).fail(function () {\n                            deferredPromise.reject();\n                        });\n                }).fail(function () {\n                    deferredPromise.reject();\n                });\n        }\n\n        var resultObj = MainViewManager.findInAllWorkingSets(defaultPrefsPath);\n        if (resultObj && resultObj.length > 0) {\n            CommandManager.execute(Commands.FILE_CLOSE, {file: defaultPrefsFile, paneId: resultObj[0].paneId})\n                .done(function () {\n                    _openFiles();\n                }).fail(function () {\n                    deferredPromise.reject();\n                });\n        } else {\n            _openFiles();\n        }\n\n    }\n\n    function _isSupportedPrefType(prefType) {\n\n        if (SUPPORTED_PREFERENCE_TYPES.indexOf(prefType) >= 0) {\n            return true;\n        }\n        return false;\n\n    }\n\n   /*\n    * This method tries to deduce the preference type\n    * based on various parameters like objects initial\n    * value, object type, object's type property.\n    */\n    function _getPrefType(prefItem) {\n\n        var finalPrefType = \"undefined\";\n\n        if (prefItem) {\n            // check the type parameter.\n            var _prefType = prefItem.type;\n            if (_prefType !== undefined) {\n                finalPrefType = prefItem.type.toLowerCase();\n                // make sure the initial property's\n                // object type matches to that of 'type' property.\n                if (prefItem.initial !== undefined) {\n\n                    if (Array.isArray(prefItem.initial)) {\n                        _prefType = \"array\";\n                    } else {\n                        var _initialType = typeof (prefItem.initial);\n                        _initialType = _initialType.toLowerCase();\n                        if (_prefType !== _initialType) {\n                            _prefType = _initialType;\n                        }\n                    }\n                }\n            }\n\n            if (_prefType) {\n                // preference object's type\n                // is defined. Check if that is valid or not.\n                finalPrefType = _prefType;\n                if (!_isSupportedPrefType(finalPrefType)) {\n                    finalPrefType = \"undefined\";\n                }\n            } else if (Array.isArray(prefItem)) {\n                // Check if the object itself\n                // is an array, in which case\n                // we log the default.\n                finalPrefType = \"array\";\n            } else if (prefItem.initial !== undefined  ||\n                       prefItem.keys !== undefined) {\n\n                // OK looks like this preference has\n                // no explicit type defined. instead\n                // it needs to be deduced from initial/keys\n                // variable.\n                var _prefVar;\n                if (prefItem.initial !== undefined) {\n                    _prefVar = prefItem.initial;\n                } else {\n                    _prefVar = prefItem.keys;\n                }\n\n                if (Array.isArray(_prefVar)) {\n                    // In cases of array the\n                    // typeof is returning a function.\n                    finalPrefType = \"array\";\n                }\n\n            } else {\n                finalPrefType = typeof (prefItem);\n            }\n        }\n\n        // Now make sure we recognize this format.\n        if (!_isSupportedPrefType(finalPrefType)) {\n            finalPrefType = \"undefined\";\n        }\n\n        return finalPrefType;\n    }\n\n    function _isValidPref(pref) {\n\n        // Make sure to generate pref description only for\n        // user overrides and don't generate for properties\n        // meant to be used for internal purposes. Also check\n        // if the preference type is valid or not.\n        if (pref && !pref.excludeFromHints && _getPrefType(pref) !== \"undefined\") {\n            return true;\n        }\n\n        return false;\n    }\n\n   /*\n    * This method tries to match between initial objects\n    * and key objects and then aggregates objects from both\n    * the properties.\n    */\n    function _getChildPrefs(prefItem) {\n\n        var finalObj = {},\n            keysFound = false;\n\n        if (!prefItem) {\n            return {};\n        }\n\n        function _populateKeys(allKeys) {\n\n            var prop;\n            if (typeof (allKeys) === \"object\") {\n                // iterate through the list.\n                keysFound = true;\n                for (prop in allKeys) {\n                    if (allKeys.hasOwnProperty(prop)) {\n                        finalObj[prop] = allKeys[prop];\n                    }\n                }\n            }\n        }\n\n        _populateKeys(prefItem.initial);\n        _populateKeys(prefItem.keys);\n\n        // Last resort: Maybe plain objects, in which case\n        // we blindly extract all the properties.\n        if (!keysFound) {\n            _populateKeys(prefItem);\n        }\n\n        return finalObj;\n    }\n\n    function _formatBasicPref(prefItem, prefName, tabIndentStr) {\n\n        if (!prefItem || typeof (prefName) !== \"string\" || _getPrefType(prefItem) === \"object\") {\n            // return empty string in case of\n            // object or pref is not defined.\n            return \"\";\n        }\n\n        var prefDescription = prefItem.description || \"\",\n            prefDefault     = prefItem.initial,\n            prefFormatText  = tabIndentStr + \"\\t// {0}\\n\" + tabIndentStr + \"\\t\\\"{1}\\\": {2}\",\n            prefItemType    = _getPrefType(prefItem);\n\n        if (prefDefault === undefined && !prefItem.description) {\n            // This could be the case when prefItem is a basic JS variable.\n            if (prefItemType === \"number\" || prefItemType === \"boolean\" || prefItemType === \"string\") {\n                prefDefault = prefItem;\n            }\n        }\n\n        if (prefDefault === undefined) {\n            if (prefItemType === \"number\") {\n                prefDefault = 0;\n            } else if (prefItemType === \"boolean\") {\n                // Defaulting the preference to false,\n                // in case this is missing.\n                prefDefault = false;\n            } else {\n                // for all other types\n                prefDefault = \"\";\n            }\n        }\n\n        if ((prefDescription === undefined || prefDescription.length === 0)) {\n            if (!Array.isArray(prefDefault)) {\n                prefDescription = Strings.DEFAULT_PREFERENCES_JSON_DEFAULT + \": \" + prefDefault;\n            } else {\n                prefDescription = \"\";\n            }\n        }\n\n        if (prefItemType === \"array\") {\n            prefDefault = \"[]\";\n        } else if (prefDefault.length === 0 || (prefItemType !== \"boolean\" && prefItemType !== \"number\")) {\n            prefDefault = \"\\\"\" + prefDefault + \"\\\"\";\n        }\n\n        return StringUtils.format(prefFormatText, prefDescription, prefName, prefDefault);\n    }\n\n    function _formatPref(prefName,  prefItem, indentLevel) {\n\n        // check for validity of the parameters being passed\n        if (!prefItem || indentLevel < 0 || !prefName || !prefName.length) {\n            return \"\";\n        }\n\n        var iLevel,\n            prefItemKeys,\n            entireText     = \"\",\n            prefItemDesc   = prefItem.description || \"\",\n            prefItemType   = _getPrefType(prefItem),\n            hasKeys        = false,\n            tabIndents     = \"\",\n            numKeys        = 0;\n\n        // Generate the indentLevel string\n        for (iLevel = 0; iLevel < indentLevel; iLevel++) {\n            tabIndents += \"\\t\";\n        }\n\n        // Check if the preference is an object.\n        if (_getPrefType(prefItem) === \"object\") {\n            prefItemKeys = _getChildPrefs(prefItem);\n            if (Object.keys(prefItemKeys).length > 0) {\n                hasKeys = true;\n            }\n        }\n\n        // There are some properties like \"highlightMatches\" that\n        // are declared as boolean type but still can take object keys.\n        // The below condition check can take care of cases like this.\n        if (prefItemType !== \"object\" && hasKeys === false) {\n            return _formatBasicPref(prefItem, prefName, tabIndents);\n        }\n\n        // Indent the beginning of the object.\n        tabIndents += \"\\t\";\n\n        if (prefItemDesc && prefItemDesc.length > 0) {\n            entireText = tabIndents + \"// \" + prefItemDesc + \"\\n\";\n        }\n\n        entireText += tabIndents + \"\\\"\" + prefName + \"\\\": \" + \"{\";\n\n        if (prefItemKeys) {\n            numKeys = Object.keys(prefItemKeys).length;\n        }\n\n        // In case the object array is empty\n        if (numKeys <= 0) {\n            entireText += \"}\";\n            return entireText;\n        }\n        entireText += \"\\n\";\n\n\n        // Now iterate through all the keys\n        // and generate nested formatted objects.\n\n        Object.keys(prefItemKeys).sort().forEach(function (property) {\n\n            if (prefItemKeys.hasOwnProperty(property)) {\n\n                var pref = prefItemKeys[property];\n\n                if (_isValidPref(pref)) {\n\n                    var formattedText = \"\";\n\n                    if (_getPrefType(pref) === \"object\") {\n                        formattedText = _formatPref(property, pref, indentLevel + 1);\n                    } else {\n                        formattedText = _formatBasicPref(pref, property, tabIndents);\n                    }\n\n                    if (formattedText.length > 0) {\n                        entireText += formattedText + \",\\n\\n\";\n                    }\n                }\n            }\n        });\n\n        // Strip \",\\n\\n\" that got added above, for the last property\n        if (entireText.length > 0) {\n            entireText = entireText.slice(0, -3) + \"\\n\" + tabIndents + \"}\";\n        } else {\n            entireText = \"{}\";\n        }\n\n        return entireText;\n    }\n\n    function _getDefaultPreferencesString() {\n\n        var allPrefs       = PreferencesManager.getAllPreferences(),\n            headerComment  = Strings.DEFAULT_PREFERENCES_JSON_HEADER_COMMENT + \"\\n\\n{\\n\",\n            entireText     = \"\";\n\n        Object.keys(allPrefs).sort().forEach(function (property) {\n            if (allPrefs.hasOwnProperty(property)) {\n\n                var pref = allPrefs[property];\n\n                if (_isValidPref(pref)) {\n                    entireText += _formatPref(property, pref, 0) + \",\\n\\n\";\n                }\n            }\n        });\n\n        // Strip \",\\n\\n\" that got added above, for the last property\n        if (entireText.length > 0) {\n            entireText = headerComment + entireText.slice(0, -3) + \"\\n}\\n\";\n        } else {\n            entireText = headerComment + \"}\\n\";\n        }\n\n        return entireText;\n    }\n\n    function _loadDefaultPrefs(prefsPath, deferredPromise) {\n\n        var defaultPrefsPath = defaultPreferencesFullPath,\n            file             = FileSystem.getFileForPath(defaultPrefsPath);\n\n        function _executeDefaultOpenPrefsCommand() {\n\n            CommandManager.execute(Commands.FILE_OPEN_PREFERENCES)\n                .done(function () {\n                    deferredPromise.resolve();\n                }).fail(function () {\n                    deferredPromise.reject();\n                });\n        }\n\n        file.exists(function (err, doesExist) {\n\n            if (doesExist) {\n\n                // Go about recreating the default preferences file.\n                if (recomputeDefaultPrefs) {\n\n                    var prefsString       = _getDefaultPreferencesString();\n                    recomputeDefaultPrefs = false;\n\n                    // We need to delete this first\n                    file.unlink(function (err) {\n                        if (!err) {\n                            // Go about recreating this\n                            // file and write the default\n                            // preferences string to this file.\n                            FileUtils.writeText(file, prefsString, true)\n                                .done(function () {\n                                    recomputeDefaultPrefs = false;\n                                    _openPrefFilesInSplitView(prefsPath, defaultPrefsPath, deferredPromise);\n                                }).fail(function (error) {\n                                    // Give a chance for default preferences command.\n                                    console.error(\"Unable to write to default preferences file! error code:\" + error);\n                                    _executeDefaultOpenPrefsCommand();\n                                });\n                        } else {\n                            // Some error occured while trying to delete\n                            // the file. In this case open the user\n                            // preferences alone.\n                            console.error(\"Unable to delete the existing default preferences file! error code:\" + err);\n                            _executeDefaultOpenPrefsCommand();\n                        }\n                    });\n\n                } else {\n                    // Default preferences already generated.\n                    // Just go about opening both the files.\n                    _openPrefFilesInSplitView(prefsPath, defaultPrefsPath, deferredPromise);\n                }\n            } else {\n\n                // The default prefs file does not exist at all.\n                // So go about recreating the default preferences\n                // file.\n                var _prefsString = _getDefaultPreferencesString();\n                FileUtils.writeText(file, _prefsString, true)\n                    .done(function () {\n                        recomputeDefaultPrefs = false;\n                        _openPrefFilesInSplitView(prefsPath, defaultPrefsPath, deferredPromise);\n                    }).fail(function (error) {\n                        // Give a chance for default preferences command.\n                        console.error(\"Unable to write to default preferences file! error code:\" + error);\n                        _executeDefaultOpenPrefsCommand();\n                    });\n            }\n        });\n    }\n\n    function handleOpenPrefsInSplitView() {\n\n        var fullPath        = PreferencesManager.getUserPrefFile(),\n            file            = FileSystem.getFileForPath(fullPath),\n            splitViewPrefOn = prefs.get(\"openPrefsInSplitView\"),\n            result          = new $.Deferred();\n\n        if (!splitViewPrefOn) {\n            return CommandManager.execute(Commands.FILE_OPEN_PREFERENCES);\n        }\n        file.exists(function (err, doesExist) {\n            if (doesExist) {\n                _loadDefaultPrefs(fullPath, result);\n            } else {\n                FileUtils.writeText(file, \"\", true)\n                        .done(function () {\n                            _loadDefaultPrefs(fullPath, result);\n                        }).fail(function () {\n                            result.reject();\n                        });\n            }\n        });\n\n\n        return result.promise();\n    }\n\n    function _updateLogToConsoleMenuItemChecked() {\n        const isLogging = window.setupLogging();\n        CommandManager.get(DEBUG_ENABLE_LOGGING).setChecked(isLogging);\n        CommandManager.get(DEBUG_LIVE_PREVIEW_LOGGING).setEnabled(isLogging);\n        logger.loggingOptions.logLivePreview = window.isLoggingEnabled(LOG_LIVE_PREVIEW_KEY);\n        logger.loggingOptions.logGit = window.isLoggingEnabled(LOG_GIT_KEY);\n        CommandManager.get(DEBUG_LIVE_PREVIEW_LOGGING).setChecked(logger.loggingOptions.logLivePreview);\n        CommandManager.get(DEBUG_GIT_EXTENSION_LOGGING).setChecked(logger.loggingOptions.logGit);\n        CommandManager.get(DEBUG_ENABLE_PHNODE_INSPECTOR).setChecked(NodeConnector.isInspectEnabled());\n    }\n\n    function _handleLogging() {\n        window.toggleLoggingKey(LOG_TO_CONSOLE_KEY);\n        _updateLogToConsoleMenuItemChecked();\n    }\n\n    function _handlePhNodeInspectEnable() {\n        NodeConnector.setInspectEnabled(!NodeConnector.isInspectEnabled());\n        _updateLogToConsoleMenuItemChecked();\n    }\n\n    function _handleGetPhNodeInspectURL() {\n        Dialogs.showInfoDialog(Strings.CMD_GET_PHNODE_INSPECTOR_URL,\n            `<div id=\"instructions\">\n  <p>\n    1. Go to <a href=\"chrome://inspect/\" target=\"_blank\">chrome://inspect/#devices</a>\n    <button onclick=\"Phoenix.app.copyToClipboard('chrome://inspect/')\">\n      <i class=\"fas fa-copy\"></i> Copy\n    </button>\n  </p>\n  <p>2. Select Option 'Open dedicated DevTools for Node'</p>\n  <p>\n    3. Use the URL in connection tab'<code>localhost:${NodeConnector.getInspectPort()}</code>'\n    <button onclick=\"Phoenix.app.copyToClipboard('localhost:${NodeConnector.getInspectPort()}')\">\n      <i class=\"fas fa-copy\"></i> Copy\n    </button>\n  </p>\n</div>`);\n    }\n\n    function _handleLivePreviewLogging() {\n        window.toggleLoggingKey(LOG_LIVE_PREVIEW_KEY);\n        _updateLogToConsoleMenuItemChecked();\n    }\n\n    function _handleGitLogging() {\n        window.toggleLoggingKey(LOG_GIT_KEY);\n        _updateLogToConsoleMenuItemChecked();\n    }\n\n    ExtensionManager.on(\"statusChange\", function (id) {\n        // Seems like an extension(s) got installed.\n        // Need to recompute the default prefs.\n        recomputeDefaultPrefs = true;\n    });\n\n    function _openVFS() {\n        ProjectManager.openProject(\"/\");\n    }\n\n    function _openExtensionsFolder() {\n        Phoenix.app.openPathInFileBrowser(ExtensionLoader.getUserExtensionPath());\n    }\n\n    function _openVirtualServer() {\n        const virtualServingURL = Phoenix.VFS.getVirtualServingURLForPath(\"/\");\n        if(!virtualServingURL) {\n            throw new Error(\"Unable to find virtual server!\");\n        }\n        Phoenix.app.openURLInPhoenixWindow(virtualServingURL, {\n            preferTabs: true\n        });\n    }\n\n    function _handleShowDeveloperTools() {\n        brackets.app.toggleDevtools();\n    }\n\n    /* Register all the command handlers */\n    let loadOrReloadString = extensionDevelopment.isProjectLoadedAsExtension() ?\n        Strings.CMD_RELOAD_CURRENT_EXTENSION : Strings.CMD_LOAD_CURRENT_EXTENSION;\n    CommandManager.register(loadOrReloadString,     DEBUG_LOAD_CURRENT_EXTENSION,\n        extensionDevelopment.loadCurrentExtension);\n    CommandManager.register(Strings.CMD_UNLOAD_CURRENT_EXTENSION,     DEBUG_UNLOAD_CURRENT_EXTENSION,\n        extensionDevelopment.unloadCurrentExtension);\n    CommandManager.register(Strings.CMD_REFRESH_WINDOW,             DEBUG_REFRESH_WINDOW,           handleReload);\n    CommandManager.register(Strings.CMD_RELOAD_WITHOUT_USER_EXTS,   DEBUG_RELOAD_WITHOUT_USER_EXTS, handleReloadWithoutUserExts);\n\n    // Start with the \"Run Tests\" item disabled. It will be enabled later if the test file can be found.\n    CommandManager.register(Strings.CMD_RUN_UNIT_TESTS,       DEBUG_RUN_UNIT_TESTS,         _runUnitTests);\n\n    CommandManager.register(Strings.CMD_SHOW_PERF_DATA,            DEBUG_SHOW_PERF_DATA,            handleShowPerfData);\n\n    let switchLanguageStr = Strings.CMD_SWITCH_LANGUAGE === \"Switch Language\\u2026\" ?\n        Strings.CMD_SWITCH_LANGUAGE :\n        `${Strings.CMD_SWITCH_LANGUAGE} (Switch Language)`;\n    CommandManager.register(switchLanguageStr,           DEBUG_SWITCH_LANGUAGE,           handleSwitchLanguage);\n\n    CommandManager.register(Strings.CMD_ENABLE_LOGGING, DEBUG_ENABLE_LOGGING,   _handleLogging);\n    CommandManager.register(Strings.CMD_ENABLE_PHNODE_INSPECTOR, DEBUG_ENABLE_PHNODE_INSPECTOR, _handlePhNodeInspectEnable);\n    CommandManager.register(Strings.CMD_GET_PHNODE_INSPECTOR_URL, DEBUG_GET_PHNODE_INSPECTOR_URL, _handleGetPhNodeInspectURL);\n    CommandManager.register(Strings.CMD_ENABLE_LIVE_PREVIEW_LOGS, DEBUG_LIVE_PREVIEW_LOGGING, _handleLivePreviewLogging);\n    CommandManager.register(Strings.CMD_ENABLE_GIT_LOGS, DEBUG_GIT_EXTENSION_LOGGING, _handleGitLogging);\n    CommandManager.register(Strings.CMD_OPEN_VFS, DEBUG_OPEN_VFS,   _openVFS);\n    CommandManager.register(Strings.CMD_OPEN_EXTENSIONS_FOLDER, DEBUG_OPEN_EXTENSION_FOLDER,   _openExtensionsFolder);\n    CommandManager.register(Strings.CMD_OPEN_VIRTUAL_SERVER, DEBUG_OPEN_VIRTUAL_SERVER,   _openVirtualServer);\n\n    CommandManager.register(Strings.CMD_OPEN_PREFERENCES, DEBUG_OPEN_PREFERENCES_IN_SPLIT_VIEW, handleOpenPrefsInSplitView);\n    const debugMenu = Menus.getMenu(Menus.AppMenuBar.DEBUG_MENU);\n    debugMenu.addMenuItem(DEBUG_REFRESH_WINDOW, window.debugMode ? KeyboardPrefs.refreshWindow : undefined);\n    debugMenu.addMenuItem(DEBUG_RELOAD_WITHOUT_USER_EXTS, window.debugMode ? KeyboardPrefs.reloadWithoutUserExts : undefined);\n    debugMenu.addMenuItem(DEBUG_LOAD_CURRENT_EXTENSION);\n    debugMenu.addMenuItem(DEBUG_UNLOAD_CURRENT_EXTENSION, undefined, undefined, undefined, {\n        hideWhenCommandDisabled: true\n    });\n    debugMenu.addMenuItem(DEBUG_OPEN_EXTENSION_FOLDER, undefined, undefined, undefined, {\n        hideWhenCommandDisabled: true\n    });\n    debugMenu.addMenuDivider();\n    // Show Developer Tools (optionally enabled)\n    if(Phoenix.isNativeApp){\n        CommandManager.register(Strings.CMD_SHOW_DEV_TOOLS, DEBUG_SHOW_DEVELOPER_TOOLS, _handleShowDeveloperTools);\n        debugMenu.addMenuItem(DEBUG_SHOW_DEVELOPER_TOOLS, KeyboardPrefs.showDeveloperTools);\n    }\n    // this command is defined in core, but exposed only in Debug menu for now\n    debugMenu.addMenuItem(Commands.FILE_OPEN_KEYMAP, null);\n    // Reinstall credentials menu item (native apps only)\n    if(Phoenix.isNativeApp) {\n        debugMenu.addMenuItem(Commands.REINSTALL_CREDS, null);\n    }\n    const diagnosticsSubmenu = debugMenu.addSubMenu(Strings.CMD_DIAGNOSTIC_TOOLS, DIAGNOSTICS_SUBMENU);\n    diagnosticsSubmenu.addMenuItem(DEBUG_RUN_UNIT_TESTS);\n    CommandManager.register(Strings.CMD_BUILD_TESTS, DEBUG_BUILD_TESTS, TestBuilder.toggleTestBuilder);\n    diagnosticsSubmenu.addMenuItem(DEBUG_BUILD_TESTS);\n    diagnosticsSubmenu.addMenuDivider();\n    diagnosticsSubmenu.addMenuItem(DEBUG_ENABLE_LOGGING);\n    diagnosticsSubmenu.addMenuItem(DEBUG_ENABLE_PHNODE_INSPECTOR, undefined, undefined, undefined, {\n        hideWhenCommandDisabled: true\n    });\n    diagnosticsSubmenu.addMenuItem(DEBUG_GET_PHNODE_INSPECTOR_URL, undefined, undefined, undefined, {\n        hideWhenCommandDisabled: true\n    });\n    diagnosticsSubmenu.addMenuItem(DEBUG_LIVE_PREVIEW_LOGGING);\n    if(Phoenix.isNativeApp) {\n        diagnosticsSubmenu.addMenuItem(DEBUG_GIT_EXTENSION_LOGGING);\n    }\n    diagnosticsSubmenu.addMenuDivider();\n    diagnosticsSubmenu.addMenuItem(DEBUG_SHOW_PERF_DATA);\n    diagnosticsSubmenu.addMenuItem(DEBUG_OPEN_VFS);\n    diagnosticsSubmenu.addMenuItem(DEBUG_OPEN_VIRTUAL_SERVER, undefined, undefined, undefined, {\n        hideWhenCommandDisabled: true\n    });\n\n    if(Phoenix.isNativeApp) {\n        // there is only one experimental feature- drag and drop available in native apps only.\n        const experimentalSubmenu = debugMenu.addSubMenu(Strings.CMD_EXPERIMENTAL_FEATURES, EXPERIMENTAL_FEATURES_SUB_MENU);\n        CommandManager.register(Strings.CMD_ENABLE_DRAG_AND_DROP, DEBUG_DRAG_AND_DROP, ()=>{\n            PreferencesManager.set(DragAndDrop._PREF_DRAG_AND_DROP,\n                !PreferencesManager.get(DragAndDrop._PREF_DRAG_AND_DROP));\n        });\n        PreferencesManager.on(\"change\", DragAndDrop._PREF_DRAG_AND_DROP, function () {\n            CommandManager.get(DEBUG_DRAG_AND_DROP).setChecked(PreferencesManager.get(DragAndDrop._PREF_DRAG_AND_DROP));\n        });\n        experimentalSubmenu.addMenuItem(DEBUG_DRAG_AND_DROP);\n    }\n\n    CommandManager.get(DEBUG_UNLOAD_CURRENT_EXTENSION)\n        .setEnabled(extensionDevelopment.isProjectLoadedAsExtension());\n    CommandManager.get(DEBUG_OPEN_EXTENSION_FOLDER)\n        .setEnabled(Phoenix.isNativeApp); // only show in tauri\n    CommandManager.get(DEBUG_ENABLE_PHNODE_INSPECTOR)\n        .setEnabled(Phoenix.isNativeApp); // only show in tauri\n    CommandManager.get(DEBUG_GET_PHNODE_INSPECTOR_URL)\n        .setEnabled(Phoenix.isNativeApp); // only show in tauri\n    CommandManager.get(DEBUG_OPEN_VIRTUAL_SERVER)\n        .setEnabled(!Phoenix.isNativeApp); // don't show in tauri as there is no virtual server in tauri\n\n    _updateLogToConsoleMenuItemChecked();\n\n    const helpMenu = Menus.getMenu(Menus.AppMenuBar.HELP_MENU);\n    helpMenu.addMenuItem(DEBUG_SWITCH_LANGUAGE, \"\", Menus.BEFORE, Commands.HELP_YOUTUBE);\n    helpMenu.addMenuDivider(Menus.AFTER, DEBUG_SWITCH_LANGUAGE);\n\n    const fileMenu = Menus.getMenu(Menus.AppMenuBar.FILE_MENU);\n    // this command will enable defaultPreferences and brackets preferences to be open side by side in split view.\n    fileMenu.addMenuItem(DEBUG_OPEN_PREFERENCES_IN_SPLIT_VIEW, null, Menus.BEFORE, Menus.MenuSection.FILE_SETTINGS.sectionMarker);\n\n    // exposed for convenience, but not official API\n    exports._runUnitTests = _runUnitTests;\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global path, jsPromise*/\n\n/**\n *  Utilities functions for running macros.\n *  Eg:\n *  await __PR.openFile(\"a.html\");\n *   __PR.setCursors([\"17:28\", \"17:28-17:30\"])\n * __PR.expectCursorsToBe([\"17:28\", \"17:28-17:30\"])\n * __PR.keydown([\"BACK_SPACE\"])\n * __PR.typeAtCursor(\"hello\")\n * __PR.validateText(`a`, \"16:14-16:15\")\n * __PR.validateAllMarks(\"startTagSyncEdit\", [\"16:14-16:15\"]); // All marks of type startTagSyncEdit should be there\n * __PR.validateMarks(\"startTagSyncEdit\", [\"16:14-16:15\"], 1); // 1 is total marks of type startTagSyncEdit\n *\n *  This can be later extended to run macros. But since this uses eval, the\n *  security posture must be changed. One way is to:\n *  1. create an iframe that contains the macro panel and codemirror surface in a sandboxed or 3rd party context. This\n *     will create origin isolation in browser so that extensions cannot read or write to the ifrmae macro code.\n *  2. The iframe should be created in an extensions and once created, only that iframe should be tested to run evaled\n *     code. So the iframe will post message with code to eval and we will only eval that.\n *  3. The iframe can request to save data to eval which we need to carefully handle.\n *  4. Now this is a problem only when we securely sandbox extensions in the future, as for now an extension can run\n *     eval itself and pretty much all of this is no-op till we have extension sandbox. So this is not the security\n *     model now.\n */\ndefine(\"MacroRunner\", function (require, exports, module) {\n    const FileViewController = brackets.getModule(\"project/FileViewController\"),\n        CommandManager = brackets.getModule(\"command/CommandManager\"),\n        EditorManager = brackets.getModule(\"editor/EditorManager\"),\n        KeyEvent = brackets.getModule(\"utils/KeyEvent\"),\n        Commands = brackets.getModule(\"command/Commands\"),\n        FileSystem = brackets.getModule(\"filesystem/FileSystem\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\"),\n        FileUtils   = brackets.getModule(\"file/FileUtils\"),\n        PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        Editor = brackets.getModule(\"editor/Editor\"),\n        Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        _ = brackets.getModule(\"thirdparty/lodash\"),\n        ProjectManager = brackets.getModule(\"project/ProjectManager\");\n\n    /**\n     * Open a project relative file or absolute file path. if no leading slash, path is assumed to be project relative\n     * @param filePath\n     * @returns {Promise<null>}\n     */\n    function openFile(filePath) {\n        if(filePath.startsWith('/')) {\n            return jsPromise(FileViewController.openFileAndAddToWorkingSet(filePath));\n        }\n        const projectFilePath = path.join(ProjectManager.getProjectRoot().fullPath, filePath);\n        return jsPromise(FileViewController.openFileAndAddToWorkingSet(projectFilePath));\n    }\n\n    /**\n     * Reads a text file and returns a promise that resolves to the text\n     * @param filePath - project relative or full path\n     * @param {boolean?} bypassCache - an optional argument, if specified will read from disc instead of using cache.\n     * @returns {Promise<String>}\n     */\n    function readTextFile(filePath, bypassCache) {\n        if(!filePath.startsWith('/')) {\n            filePath = path.join(ProjectManager.getProjectRoot().fullPath, filePath);\n        }\n        const file = FileSystem.getFileForPath(filePath);\n        return jsPromise(FileUtils.readAsText(file, bypassCache));\n    }\n\n    /**\n     * Asynchronously writes a file as UTF-8 encoded text.\n     * @param filePath - project relative or full path\n     * @param {String} text\n     * @param {boolean} allowBlindWrite Indicates whether or not CONTENTS_MODIFIED\n     *      errors---which can be triggered if the actual file contents differ from\n     *      the FileSystem's last-known contents---should be ignored.\n     * @return {Promise<null>} promise that will be resolved when\n     * file writing completes, or rejected with a FileSystemError string constant.\n     */\n    function writeTextFile(filePath, text, allowBlindWrite) {\n        if(!filePath.startsWith('/')) {\n            filePath = path.join(ProjectManager.getProjectRoot().fullPath, filePath);\n        }\n        const file = FileSystem.getFileForPath(filePath);\n        return jsPromise(FileUtils.writeText(file, text, allowBlindWrite));\n    }\n\n    /**\n     * deletes a file or dir at given path\n     * @param filePath - project relative or full path\n     * @return {Promise<null>} promise that will be resolved when path removed\n     */\n    function deletePath(filePath) {\n        if(!filePath.startsWith('/')) {\n            filePath = path.join(ProjectManager.getProjectRoot().fullPath, filePath);\n        }\n        return new Promise((resolve, reject) => {\n            window.fs.unlink(filePath, (err)=>{\n                if (err) {\n                    reject(err);\n                    return;\n                }\n                resolve();\n            });\n        });\n    }\n\n\n    /**\n     * Set cursor positions or text selections in the active CodeMirror editor based on a specified format.\n     * The input should be an array of strings where each string can denote a cursor position (\"line:char\")\n     * or a text selection range (\"line:char-line:char\"). For a selection, the first part is the anchor and\n     * the second is the head of the selection.\n     *\n     * Example usage: [\"1:2\", \"2:2-3:4\"]\n     *\n     * @param {Array<string>} selections - An array of strings defining cursor positions or selection ranges.\n     * @throws {Error} Throws an error if no active editor is found or if there are parsing issues with the input.\n     */\n    function setCursors(selections) {\n        const activeEditor = EditorManager.getActiveEditor();\n        if(!activeEditor){\n            throw new Error(`No active editor found to set cursor at: ${selections}`);\n        }\n        // Parse the selection strings to CodeMirror positions\n        const parsedSelections = selections.map(selection => {\n            const parts = selection.split('-');\n            if (parts.length === 1) {\n                const [line, ch] = parts[0].split(':').map(Number);\n                if (isNaN(line) || isNaN(ch)) {\n                    throw new Error(`Invalid cursor format: ${parts[0]} for ${selections}`);\n                }\n                return {start: {line: line - 1, ch: ch - 1}, end: {line: line - 1, ch: ch - 1}};\n            } else if (parts.length === 2) {\n                const [fromLine, fromCh] = parts[0].split(':').map(Number);\n                const [toLine, toCh] = parts[1].split(':').map(Number);\n                if (isNaN(fromLine) || isNaN(fromCh) || isNaN(toLine) || isNaN(toCh)) {\n                    throw new Error(`Invalid selection range format: ${selection}`);\n                }\n                return {start: {line: fromLine - 1, ch: fromCh -1}, end: {line: toLine - 1, ch: toCh - 1}};\n            } else {\n                throw new Error(`Invalid format: ${selection}`);\n            }\n        });\n\n        // Set the selections in the editor\n        activeEditor.setSelections(parsedSelections);\n    }\n\n    /**\n     * gets cursor selections array that can be used in the setCursors API\n     * @param editor\n     * @returns {*}\n     */\n    function computeCursors(editor, addQuotes) {\n        const selections = editor.getSelections();\n        return selections.map(selection => {\n            const start = selection.start;\n            const end = selection.end;\n            let cursor;\n\n            // Check if the selection is a cursor (start and end are the same)\n            if (start.line === end.line && start.ch === end.ch) {\n                cursor = `${start.line + 1}:${start.ch + 1}`;\n            } else {\n                cursor = `${start.line + 1}:${start.ch + 1}-${end.line + 1}:${end.ch + 1}`;\n            }\n            return addQuotes ? `\"${cursor}\"` : cursor;\n        });\n    }\n\n    /**\n     * Validates the currently active editor has selections as given here\n     */\n    function expectCursorsToBe(expectedSelections) {\n        const activeEditor = EditorManager.getActiveEditor();\n        if(!activeEditor){\n            throw new Error(`No active editor found for expectCursorsToBe: ${expectedSelections}`);\n        }\n        const currentSelections = computeCursors(activeEditor);\n        if(currentSelections.length !== expectedSelections.length) {\n            throw new Error(`expectCursorsToBe: [${expectedSelections.join(\", \")}] `+\n             `but got [${currentSelections.join(\", \")}]`);\n        }\n        for(let i = 0; i < currentSelections.length; i++) {\n            if(!currentSelections.includes(`${expectedSelections[i]}`) ||\n                !expectedSelections.includes(currentSelections[i])){\n                throw new Error(`expectCursorsToBe: [${expectedSelections.join(\", \")}] `+\n                    `but got [${currentSelections.join(\", \")}]`);\n            }\n        }\n    }\n\n    /**\n     * Simulate a key event.\n     * @param {Number} key Key code available as One of the KeyEvent.DOM_VK_*\n     * @param {String} event Key event to simulate. one of keydown, keyup or keypress\n     * @param {HTMLElement} element Element to receive event\n     * @param {KeyboardEventInit} options Optional arguments for key event\n     */\n    function raiseKeyEvent(key, event, element, options) {\n        const doc = element.ownerDocument;\n\n        if(typeof options === 'undefined') {\n            options = {\n                view: doc.defaultView,\n                bubbles: true,\n                cancelable: true,\n                keyIdentifer: key\n            };\n        } else {\n            options.view = doc.defaultView;\n            options.bubbles = true;\n            options.cancelable = true;\n            options.keyIdentifier = key;\n        }\n        const oEvent = new KeyboardEvent(event, options);\n\n        if (event !== \"keydown\" && event !== \"keyup\" && event !== \"keypress\") {\n            console.log(\"SpecRunnerUtils.simulateKeyEvent() - unsupported keyevent: \" + event);\n            return;\n        }\n\n        // Chromium Hack: need to override the 'which' property.\n        // Note: this code is not designed to work in IE, Safari,\n        // or other browsers. Well, maybe with Firefox. YMMV.\n        Object.defineProperty(oEvent, 'keyCode', {\n            get: function () {\n                return this.keyCodeVal;\n            }\n        });\n        Object.defineProperty(oEvent, 'which', {\n            get: function () {\n                return this.keyCodeVal;\n            }\n        });\n        Object.defineProperty(oEvent, 'charCode', {\n            get: function () {\n                return this.keyCodeVal;\n            }\n        });\n\n        oEvent.keyCodeVal = key;\n        if (oEvent.keyCode !== key) {\n            console.log(\"SpecRunnerUtils.simulateKeyEvent() - keyCode mismatch: \" + oEvent.keyCode);\n        }\n\n        element.dispatchEvent(oEvent);\n    }\n\n    /**\n     * @param {Array<string>} keysArray An array of Key strings available as One of the KeyEvent.DOM_VK_* without the\n     *    `KeyEvent.DOM_VK_` prefix. Eg: use `[\"ESCAPE\"]` instead of fully specifying [`DOM_VK_ESCAPE`]\n     *    E.g: __PR.keydown([\"BACK_SPACE\"]) or __PR.keydown([\"BACK_SPACE\"], {ctrlKey: true})\n     * @param {object} modifiers to modify the key\n     * @param {boolean} modifiers.ctrlKey\n     * @param {boolean} modifiers.altKey\n     * @param {boolean} modifiers.shiftKey\n     * @param {boolean} modifiers.metaKey\n     * @param keysArray\n     */\n    function keydown(keysArray, modifiers) {\n        for(let key of keysArray) {\n            if(typeof key === \"string\"){\n                if(!key.startsWith(\"DOM_VK_\")){\n                    key = \"DOM_VK_\"+key;\n                }\n                key = KeyEvent[key];\n                if(!key){\n                    throw new Error(`Invalid key \"${key}\"`);\n                }\n            }\n            raiseKeyEvent(key, \"keydown\", document.activeElement, modifiers);\n        }\n    }\n\n    function typeAtCursor(text, origin) {\n        const activeEditor = EditorManager.getActiveEditor();\n        if(!activeEditor){\n            throw new Error(`No active editor found to typeAtCursor: ${text}`);\n        }\n        const selections = activeEditor.getSelections();\n        // Insert text at each cursor or the head of each selection.\n        // We perform the insertions in reverse order to avoid affecting the indices of subsequent insertions.\n        for (let selection of selections) {\n            activeEditor.replaceRange(text, selection.start, selection.end, origin);\n        }\n    }\n\n    // converts string of from \"ln:ch\" to pos object\n    function _toPos(posString) {\n        const pos = posString.split(\":\");\n        return {line: Number(pos[0]) - 1, ch: Number(pos[1]) - 1 };\n    }\n\n    /**\n     * Verify if the given text is same as what is in between the given selection.\n     * @param {string} text\n     * @param {string} selection of the form \"ln:ch-ln:ch\"\n     */\n    function validateText(text, selection) {\n        const activeEditor = EditorManager.getActiveEditor();\n        if(!activeEditor){\n            throw new Error(`No active editor found to validateText: ${text} at selection ${selection}`);\n        }\n        const from = selection.split(\"-\")[0], to = selection.split(\"-\")[1];\n        const selectedText = activeEditor.getTextBetween(_toPos(from), _toPos(to));\n        if(selectedText !== text){\n            throw new Error(`validateText: expected text at [${selection}] to be \"${text}\" but got \"${selectedText}\"`);\n        }\n    }\n\n    function _getMarkLocations(markType, whichAPI, selections) {\n        const activeEditor = EditorManager.getActiveEditor();\n        if(!activeEditor){\n            throw new Error(`No active editor found to ${whichAPI}: \"${markType}\" for selection \"${selections}\"`);\n        }\n        const marks = activeEditor.getAllMarks(markType);\n        const marksLocations = [];\n        for(let mark of marks){\n            const loc = mark.find();\n            marksLocations.push(`${loc.from.line+1}:${loc.from.ch+1}-${loc.to.line+1}:${loc.to.ch+1}`);\n        }\n        return marksLocations;\n    }\n\n    /**\n     * validates all marks of the given mark type\n     * @param {string} markType\n     * @param {Array<string>} selections - An array of strings defining cursor positions or selection ranges.\n     */\n    function validateAllMarks(markType, selections) {\n        const marksLocations = _getMarkLocations(markType, \"validateAllMarks\", selections);\n        if(!selections || marksLocations.length !== selections.length){\n            throw new Error(`validateAllMarks expected marks \"${markType}\" at: [${selections&&selections.join(\", \")}] `+\n                `but got marked locations [${marksLocations.join(\", \")}]`);\n        }\n        for(let i = 0; i < selections.length; i++) {\n            if(!selections.includes(`${marksLocations[i]}`) ||\n                !marksLocations.includes(selections[i])){\n                throw new Error(`validateAllMarks expected marks \"${markType}\" at: [${selections.join(\", \")}] `+\n                    `but got marked locations [${marksLocations.join(\", \")}]`);\n            }\n        }\n    }\n\n    function validateEqual(obj1, obj2, message = \"\") {\n        if(!_.isEqual(obj1, obj2)){\n            throw new Error(`validateEqual: ${ message ? message + \"\\n\" : \"\"\n            } expected ${JSON.stringify(obj1)} to equal ${JSON.stringify(obj2)}`);\n        }\n    }\n\n    function validateNotEqual(obj1, obj2) {\n        if(_.isEqual(obj1, obj2)){\n            throw new Error(`validateEqual: expected ${JSON.stringify(obj1)} to NOT equal ${JSON.stringify(obj2)}`);\n        }\n    }\n\n    /**\n     * validates if the given mark type is present in the specified selections\n     * @param {string} markType\n     * @param {Array<string>} selections - An array of strings defining cursor positions or selection ranges.\n     * @param {number} [totalMarkCount] optional to validate against the total number of expected marks of the type\n     */\n    function validateMarks(markType, selections, totalMarkCount) {\n        const marksLocations = _getMarkLocations(markType, \"validateMarks\", selections);\n        if(!selections){\n            return;\n        }\n        if(totalMarkCount !== undefined && marksLocations.length !== totalMarkCount){\n            throw new Error(`validateMarks expected mark count for \"${markType}\" to be: ${totalMarkCount} `+\n                `but got ${marksLocations.length}`);\n        }\n        for(let selection of selections) {\n            if(!marksLocations.includes(selection)){\n                throw new Error(`validateMarks expected marks \"${markType}\" to be at: [${selections.join(\", \")}] `+\n                    `but got marked locations [${marksLocations.join(\", \")}]`);\n            }\n        }\n    }\n\n    function closeFile() {\n        return jsPromise(CommandManager.execute(Commands.FILE_CLOSE, { _forceClose: true }));\n    }\n\n    function closeAll() {\n        return jsPromise(CommandManager.execute(Commands.FILE_CLOSE_ALL, { _forceClose: true }));\n    }\n\n    function execCommand(commandID, arg) {\n        return jsPromise(CommandManager.execute(commandID, arg));\n    }\n\n    function undo() {\n        return execCommand(Commands.EDIT_UNDO);\n    }\n\n    function redo() {\n        return execCommand(Commands.EDIT_REDO);\n    }\n\n    function setPreference(key, value){\n        PreferencesManager.set(key, value);\n    }\n\n    function getPreference(key){\n        return PreferencesManager.get(key);\n    }\n\n    // Helper function to get full path (reusing existing openFile logic)\n    function _getFullPath(filePath) {\n        if(filePath.startsWith('/')) {\n            return filePath;\n        }\n        return path.join(ProjectManager.getProjectRoot().fullPath, filePath);\n    }\n\n    const EDITING = {\n        setEditorSpacing: function (useTabs, spaceOrTabCount, isAutoMode) {\n            const activeEditor = EditorManager.getActiveEditor();\n            if(!activeEditor){\n                throw new Error(`No active editor found to setEditorSpacing`);\n            }\n            const fullPath = activeEditor.document.file.fullPath;\n            if(Editor.Editor.getAutoTabSpaces(fullPath) !== isAutoMode){\n                Editor.Editor.setAutoTabSpaces(isAutoMode, fullPath);\n                isAutoMode && Editor.Editor._autoDetectTabSpaces(activeEditor, true, true);\n            }\n            Editor.Editor.setUseTabChar(useTabs, fullPath);\n            if(useTabs) {\n                Editor.Editor.setTabSize(spaceOrTabCount, fullPath);\n            } else {\n                Editor.Editor.setSpaceUnits(spaceOrTabCount, fullPath);\n            }\n        },\n        /**\n         * Split the editor pane vertically\n         */\n        splitVertical: function() {\n            CommandManager.execute(Commands.CMD_SPLITVIEW_VERTICAL);\n        },\n\n        /**\n         * Split the editor pane horizontally\n         */\n        splitHorizontal: function() {\n            CommandManager.execute(Commands.CMD_SPLITVIEW_HORIZONTAL);\n        },\n\n        /**\n         * Remove split pane and return to single pane view\n         */\n        splitNone: function() {\n            CommandManager.execute(Commands.CMD_SPLITVIEW_NONE);\n        },\n        /**\n         * Gets the editor in the first pane (left/top)\n         * @return {?Editor} The editor in first pane or null if not available\n         */\n        getFirstPaneEditor: function() {\n            return MainViewManager.getCurrentlyViewedEditor(\"first-pane\");\n        },\n\n        /**\n         * Gets the editor in the second pane (right/bottom)\n         * @return {?Editor} The editor in second pane or null if not available\n         */\n        getSecondPaneEditor: function() {\n            return MainViewManager.getCurrentlyViewedEditor(\"second-pane\");\n        },\n\n        /**\n         * Checks if the view is currently split\n         * @return {boolean} True if view is split, false otherwise\n         */\n        isSplit: function() {\n            return MainViewManager.getPaneCount() > 1;\n        },\n        /**\n         * Opens a file in the first pane (left/top)\n         * @param {string} filePath - Project relative or absolute file path\n         * @param {boolean} [addToWorkingSet] - true to add to working set\n         * @returns {Promise} A promise that resolves when the file is opened\n         */\n        openFileInFirstPane: function(filePath, addToWorkingSet) {\n            const command = addToWorkingSet ? Commands.CMD_ADD_TO_WORKINGSET_AND_OPEN : Commands.FILE_OPEN;\n            return jsPromise(CommandManager.execute(command, {\n                fullPath: _getFullPath(filePath),\n                paneId: \"first-pane\"\n            }));\n        },\n\n        /**\n         * Opens a file in the second pane (right/bottom)\n         * @param {string} filePath - Project relative or absolute file path\n         * @param {boolean} addToWorkingSet - true to add to working set\n         * @returns {Promise} A promise that resolves when the file is opened\n         */\n        openFileInSecondPane: function(filePath, addToWorkingSet) {\n            const command = addToWorkingSet ? Commands.CMD_ADD_TO_WORKINGSET_AND_OPEN : Commands.FILE_OPEN;\n            return jsPromise(CommandManager.execute(command, {\n                fullPath: _getFullPath(filePath),\n                paneId: \"second-pane\"\n            }));\n        },\n        /**\n         * Focus the first pane (left/top)\n         */\n        focusFirstPane: function() {\n            MainViewManager.setActivePaneId(\"first-pane\");\n        },\n\n        /**\n         * Focus the second pane (right/bottom)\n         */\n        focusSecondPane: function() {\n            MainViewManager.setActivePaneId(\"second-pane\");\n        }\n    };\n\n    /**\n     * Waits for a polling function to succeed or until a timeout is reached.\n     * The polling function is periodically invoked to check for success, and\n     * the function rejects with a timeout message if the timeout duration elapses.\n     *\n     * @param {function} pollFn - A function that returns `true` or a promise resolving to `true`/`false`\n     *                            to indicate success and stop waiting.\n     *                            The function will be called repeatedly until it succeeds or times out.\n     * @param {string|function} _timeoutMessageOrMessageFn - A helpful string message or an async function\n     *                                                       that returns a string message to reject with in case of timeout.\n     *                                                       Example:\n     *                                                       - String: \"Condition not met within the allowed time.\"\n     *                                                       - Function: `async () => \"Timeout while waiting for the process to complete.\"`\n     * @param {number} [timeoutms=2000] - The maximum time to wait in milliseconds before timing out. Defaults to 2 seconds.\n     * @param {number} [pollInterval=10] - The interval in milliseconds at which `pollFn` is invoked. Defaults to 10ms.\n     * @returns {Promise<void>} A promise that resolves when `pollFn` succeeds or rejects with a timeout message.\n     *\n     * @throws {Error} If `timeoutms` or `pollInterval` is not a number.\n     *\n     * @example\n     * // Example 1: Using a string as the timeout message\n     * awaitsFor(\n     *   () => document.getElementById(\"element\") !== null,\n     *   \"Element did not appear within the allowed time.\",\n     *   5000,\n     *   100\n     * ).then(() => {\n     *   console.log(\"Element appeared!\");\n     * }).catch(err => {\n     *   console.error(err.message);\n     * });\n     *\n     * @example\n     * // Example 2: Using a function as the timeout message\n     * awaitsFor(\n     *  () => document.getElementById(\"element\") !== null,\n     *   async () => {\n     *     const el = document.getElementById(\"element\");\n     *     return `expected ${el} to be null`;\n     *   },\n     *   10000,\n     *   500\n     * ).then(() => {\n     *   console.log(\"Element appeared!\");\n     * }).catch(err => {\n     *   console.error(err.message);\n     * });\n     */\n    function awaitsFor(pollFn, _timeoutMessageOrMessageFn, timeoutms = 2000, pollInterval = 10){\n        if(typeof  _timeoutMessageOrMessageFn === \"number\"){\n            timeoutms = _timeoutMessageOrMessageFn;\n            pollInterval = timeoutms;\n        }\n        if(!(typeof  timeoutms === \"number\" && typeof  pollInterval === \"number\")){\n            throw new Error(\"awaitsFor: invalid parameters when awaiting for \" + _timeoutMessageOrMessageFn);\n        }\n\n        async function _getExpectMessage(_timeoutMessageOrMessageFn) {\n            try{\n                if(typeof _timeoutMessageOrMessageFn === \"function\") {\n                    _timeoutMessageOrMessageFn = _timeoutMessageOrMessageFn();\n                    if(_timeoutMessageOrMessageFn instanceof Promise){\n                        _timeoutMessageOrMessageFn = await _timeoutMessageOrMessageFn;\n                    }\n                }\n            } catch (e) {\n                _timeoutMessageOrMessageFn = \"Error executing expected message function:\" + e.stack;\n            }\n            return _timeoutMessageOrMessageFn;\n        }\n\n        function _timeoutPromise(promise, ms) {\n            const timeout = new Promise((_, reject) => {\n                setTimeout(async () => {\n                    _timeoutMessageOrMessageFn = await _getExpectMessage(_timeoutMessageOrMessageFn);\n                    reject(new Error(_timeoutMessageOrMessageFn || `Promise timed out after ${ms}ms`));\n                }, ms);\n            });\n\n            return Promise.race([promise, timeout]);\n        }\n\n        return new Promise((resolve, reject)=>{\n            let startTime = Date.now(),\n                lapsedTime;\n            async function pollingFn() {\n                try{\n                    let result = pollFn();\n\n                    // If pollFn returns a promise, await it\n                    if (Object.prototype.toString.call(result) === \"[object Promise]\") {\n                        // we cant simply check for result instanceof Promise as the Promise may be returned from\n                        // an iframe and iframe has a different instance of Promise than this js context.\n                        result = await _timeoutPromise(result, timeoutms);\n                    }\n\n                    if (result) {\n                        resolve();\n                        return;\n                    }\n                    lapsedTime = Date.now() - startTime;\n                    if(lapsedTime>timeoutms){\n                        _timeoutMessageOrMessageFn = await _getExpectMessage(_timeoutMessageOrMessageFn);\n                        reject(\"awaitsFor timed out waiting for - \" + _timeoutMessageOrMessageFn);\n                        return;\n                    }\n                    setTimeout(pollingFn, pollInterval);\n                } catch (e) {\n                    reject(e);\n                }\n            }\n            pollingFn();\n        });\n    }\n\n    async function waitForModalDialog(dialogClass, friendlyName, timeout = 2000) {\n        dialogClass = dialogClass || \"\";\n        friendlyName = friendlyName || dialogClass || \"Modal Dialog\";\n        await awaitsFor(()=>{\n            let $dlg = $(`.modal.instance${dialogClass}`);\n            return $dlg.length >= 1;\n        }, `Waiting for Modal Dialog to show ${friendlyName}`, timeout);\n    }\n\n    async function waitForModalDialogClosed(dialogClass, friendlyName, timeout = 2000) {\n        dialogClass = dialogClass || \"\";\n        friendlyName = friendlyName || dialogClass || \"Modal Dialog\";\n        await awaitsFor(()=>{\n            let $dlg = $(`.modal.instance${dialogClass}`);\n            return $dlg.length === 0;\n        }, `Waiting for Modal Dialog to not there ${friendlyName}`, timeout);\n    }\n\n    /** Clicks on a button within a specified dialog.\n     * This function identifies a dialog using its class and locates a button either by its selector or button ID.\n     * Validation to ensure the dialog and button exist and that the button is enabled before attempting to click.\n     *\n     * @param {string} selectorOrButtonID - The selector or button ID to identify the button to be clicked.\n     *                                       Example (as selector): \".my-button-class\".\n     *                                       Example (as button ID): \"ok\".\n     * @param {string} dialogClass - The class of the dialog (optional). If omitted, defaults to an empty string.\n     *                               Example: \"my-dialog-class\".\n     * @param {boolean} isButtonID - If `true`, `selectorOrButtonid` is treated as a button ID.\n     *                                If `false`, it is treated as a jQuery selector. Default is `false`.\n     *\n     * @throws {Error} Throws an error if:\n     *   - The specified dialog does not exist.\n     *   - Multiple buttons match the given selector or ID.\n     *   - No button matches the given selector or ID.\n     *   - The button is disabled and cannot be clicked.\n     *\n     */\n    function _clickDialogButtonWithSelector(selectorOrButtonID, dialogClass, isButtonID) {\n        dialogClass = dialogClass || \"\";\n        const $dlg = $(`.modal.instance${dialogClass}`);\n\n        if(!$dlg.length){\n            throw new Error(`No such dialog present: \"${dialogClass}\"`);\n        }\n\n        const $button = isButtonID ?\n            $dlg.find(\".dialog-button[data-button-id='\" + selectorOrButtonID + \"']\") :\n            $dlg.find(selectorOrButtonID);\n        if($button.length > 1){\n            throw new Error(`Multiple button in dialog \"${selectorOrButtonID}\"`);\n        } else if(!$button.length){\n            throw new Error(`No such button in dialog \"${selectorOrButtonID}\"`);\n        }\n\n        if($button.prop(\"disabled\")) {\n            throw new Error(`Cannot click, button is disabled. \"${selectorOrButtonID}\"`);\n        }\n\n        $button.click();\n    }\n\n    /**\n     * Clicks on a button within a specified dialog using its button ID.\n     *\n     * @param {string} buttonID - The unique ID of the button to be clicked. usually One of the\n     *                            __PR.Dialogs.DIALOG_BTN_* symbolic constants or a custom id. You can find the button\n     *                            id in the dialog by inspecting the button and checking its `data-button-id` attribute\n     *                            Example: __PR.Dialogs.DIALOG_BTN_OK.\n     * @param {string} [dialogClass] - The class of the dialog containing the button. Optional, if only one dialog\n     *                               is present, you can omit this.\n     *                               Example: \"my-dialog-class\".\n     * @throws {Error} Throws an error if:\n     *   - The specified dialog does not exist.\n     *   - No button matches the given button ID.\n     *   - Multiple buttons match the given button ID.\n     *   - The button is disabled and cannot be clicked.\n     *\n     * @example\n     * // Example: Click a button by its ID\n     * __PR.clickDialogButtonID(__PR.Dialogs.DIALOG_BTN_OK, \"my-dialog-class\");\n     * __PR.clickDialogButtonID(__PR.Dialogs.DIALOG_BTN_OK); // if only 1 dialog is present, can omit the dialog class\n     * __PR.clickDialogButtonID(\"customBtnID\", \"my-dialog-class\");\n     */\n    function clickDialogButtonID(buttonID, dialogClass) {\n        _clickDialogButtonWithSelector(buttonID, dialogClass, true);\n    }\n\n    /**\n     * Clicks on a button within a specified dialog using a selector.\n     *\n     * @param {string} buttonSelector - A jQuery selector to identify the button to be clicked.\n     *                                   Example: \".showImageBtn\".\n     * @param {string} [dialogClass] - The class of the dialog containing the button. Optional, if only one dialog\n     *                               is present, you can omit this.\n     *                               Example: \"my-dialog-class\".\n     * @throws {Error} Throws an error if:\n     *   - The specified dialog does not exist.\n     *   - No button matches the given selector.\n     *   - Multiple buttons match the given selector.\n     *   - The button is disabled and cannot be clicked.\n     *\n     * @example\n     * // Example: Click a button using a selector\n     * __PR.clickDialogButton(\".showImageBtn\", \"my-dialog-class\");\n     * __PR.clickDialogButton(\".showImageBtn\"); // if only 1 dialog is present, can omit the dialog class\n     */\n    function clickDialogButton(buttonSelector, dialogClass) {\n        _clickDialogButtonWithSelector(buttonSelector, dialogClass, false);\n    }\n\n    /**\n     * Saves the currently active file\n     * @returns {Promise<void>} A promise that resolves when file is saved to disc\n     */\n    function saveActiveFile() {\n        return jsPromise(CommandManager.execute(Commands.FILE_SAVE));\n    }\n\n    const __PR= {\n        readTextFile, writeTextFile, deletePath,\n        openFile, setCursors, expectCursorsToBe, keydown, typeAtCursor, validateText, validateAllMarks, validateMarks,\n        closeFile, closeAll, undo, redo, setPreference, getPreference, validateEqual, validateNotEqual, execCommand,\n        saveActiveFile,\n        awaitsFor, waitForModalDialog, waitForModalDialogClosed, clickDialogButtonID, clickDialogButton,\n        EDITING, // contains apis like splitVertical, openFileInFirstPane. focus pane etc...\n        $, Commands, Dialogs\n    };\n\n    async function runMacro(macroText) {\n        let errors = [];\n        try{\n            const AsyncFunction = async function () {}.constructor;\n            const macroAsync = new AsyncFunction(\"__PR\", \"KeyEvent\", macroText);\n            await macroAsync(__PR, KeyEvent);\n        } catch (e) {\n            console.error(\"Error executing macro: \", macroText, e);\n            errors.push({\n                lineNo: 0, line: '',\n                errorCode: `ERROR_EXEC`,\n                errorText: `${e}`\n            });\n        }\n        return errors;\n    }\n\n    if(Phoenix.isTestWindow) {\n        window.__PR = __PR;\n    }\n    exports.computeCursors = computeCursors;\n    exports.runMacro = runMacro;\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2012 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*globals path, logger*/\n\ndefine(\"extensionDevelopment\", function (require, exports, module) {\n    const ProjectManager         = brackets.getModule(\"project/ProjectManager\"),\n        Commands                 = brackets.getModule(\"command/Commands\"),\n        CommandManager           = brackets.getModule(\"command/CommandManager\"),\n        Strings                  = brackets.getModule(\"strings\"),\n        StringUtils              = brackets.getModule(\"utils/StringUtils\"),\n        DocumentManager          = brackets.getModule(\"document/DocumentManager\"),\n        DefaultDialogs           = brackets.getModule(\"widgets/DefaultDialogs\"),\n        Dialogs                  = brackets.getModule(\"widgets/Dialogs\"),\n        UrlParams                = brackets.getModule(\"utils/UrlParams\").UrlParams,\n        FileSystem               = brackets.getModule(\"filesystem/FileSystem\");\n\n    function _showError(message, title = Strings.ERROR_LOADING_EXTENSION) {\n        Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_ERROR,\n            title, message\n        );\n    }\n\n    function _validatePackageJson(docText) {\n        try {\n            let packageJson = JSON.parse(docText);\n            let requiredFields = [\"name\", \"title\", \"description\", \"homepage\", \"version\", \"author\", \"license\",\n                \"engines\"];\n            let missingFields = [];\n            for(let requiredField of requiredFields){\n                if(!packageJson[requiredField]){\n                    missingFields.push(requiredField);\n                }\n            }\n            if(packageJson.engines && !packageJson.engines.brackets){\n                missingFields.push(`engines:{\"brackets\": \">=2.0.0\"}`);\n            }\n            if(missingFields.length){\n                _showError(StringUtils.format(Strings.ERROR_INVALID_EXTENSION_PACKAGE_FIELDS, missingFields));\n                return false;\n            }\n            return true;\n        } catch (e) {\n            console.log(\"Cannot load extension\", Strings.ERROR_INVALID_EXTENSION_PACKAGE);\n            _showError(Strings.ERROR_INVALID_EXTENSION_PACKAGE);\n            return false;\n        }\n    }\n\n    function loadCurrentExtension() {\n        const projectRoot = ProjectManager.getProjectRoot().fullPath;\n        const file = FileSystem.getFileForPath(projectRoot + \"package.json\");\n        DocumentManager.getDocumentText(file).done(function (docText) {\n            console.log(docText);\n            if(!_validatePackageJson(docText)){\n                return;\n            }\n            CommandManager.execute(Commands.APP_RELOAD, false, projectRoot);\n        }).fail((err)=>{\n            console.log(\"No extension package.json in \", file.fullPath, err);\n            Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                Strings.ERROR_LOADING_EXTENSION,\n                Strings.ERROR_NO_EXTENSION_PACKAGE\n            );\n        });\n    }\n\n    function unloadCurrentExtension() {\n        CommandManager.execute(Commands.APP_RELOAD, false, []);\n    }\n\n    function isProjectLoadedAsExtension() {\n        const params  = new UrlParams();\n\n        // Make sure the Reload Without User Extensions parameter is removed\n        params.parse();\n        return !!params.get(\"loadDevExtensionPath\");\n    }\n\n    exports.loadCurrentExtension = loadCurrentExtension;\n    exports.unloadCurrentExtension = unloadCurrentExtension;\n    exports.isProjectLoadedAsExtension = isProjectLoadedAsExtension;\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*globals path*/\n\ndefine(\"testBuilder\", function (require, exports, module) {\n    const AppInit = brackets.getModule(\"utils/AppInit\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        EditorManager = brackets.getModule(\"editor/EditorManager\"),\n        FileSystem = brackets.getModule(\"filesystem/FileSystem\"),\n        Editor = brackets.getModule(\"editor/Editor\"),\n        Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        CommandManager = brackets.getModule(\"command/CommandManager\"),\n        Commands = brackets.getModule(\"command/Commands\"),\n        WorkspaceManager = brackets.getModule(\"view/WorkspaceManager\"),\n        MacroRunner = require(\"./MacroRunner\");\n\n    const BUILD_SCRATCH_FILE = path.join(brackets.app.getApplicationSupportDirectory(), \"testBuilder.js\");\n    let builderPanel, $panel, builderEditor;\n\n    function toggleTestBuilder() {\n        if(!$panel){\n            $panel = $(panelHTML);\n            builderPanel = WorkspaceManager.createBottomPanel(\"phcode-test-builder-panel\", $panel, 100);\n            builderPanel.hide();\n            _setupPanel().then(()=>{\n                builderPanel.setVisible(!builderPanel.isVisible());\n            });\n            return;\n        }\n        builderPanel.setVisible(!builderPanel.isVisible());\n    }\n    const panelHTML = `\n<div id=\"test-builder-panel-phcode\" class=\"bottom-panel vert-resizable top-resizer\">\n    <div class=\"toolbar\" style=\"display: flex; justify-content: space-between;\">\n      <div style=\"display: flex\">\n         <div class=\"title\">Test Builder</div>\n         <button class=\"btn btn-mini no-focus save-test-builder\">Save</button>\n         <button class=\"btn btn-mini primary no-focus run-test-builder\">Run</button>\n         <button class=\"btn btn-mini no-focus run-selected\">Run Selected</button>\n      </div>\n      <div>\n         <button class=\"btn btn-mini no-focus mark-validate\" title=\"Validate marks at cursor\">Marks</button>\n         <button class=\"btn btn-mini no-focus cursor-locate\">cursor</button>\n         <button class=\"btn btn-mini no-focus text-validate\" title=\"validate text\" style=\"margin-right: 20px;\">\n            Text</button>\n         <a href=\"#\" class=\"close\" style=\"right: 0;margin-right: 10px;\">&times;</a>\n      </div>  \n    </div>\n    <div style=\"display: flex; height: 100%; overflow: scroll;\">\n<!--27 px is status bar height. If this is not set, the preview code mirror editor gives weird layout issues at times-->\n        <div class=\"test_builder-editor\" style=\"width: 100%; height: 100%;\"></div>\n    </div>\n</div>`;\n\n    function saveFile() {\n        return new Promise((resolve, reject) => {\n            CommandManager.execute(Commands.FILE_SAVE,\n                {doc: builderEditor.document})\n                .done(resolve)\n                .fail(function (openErr) {\n                    console.error(\"error saving test builder file: \", BUILD_SCRATCH_FILE, openErr);\n                    reject();\n                });\n        });\n    }\n\n    async function runTests(macroText) {\n        saveFile();\n        const errors = await MacroRunner.runMacro(macroText || builderEditor.document.getText());\n        if(errors.length) {\n            let errorHTML = \"\";\n            for (let error of errors) {\n                errorHTML += `${error.errorText}<br>`;\n            }\n            Dialogs.showErrorDialog(\"Error running macro: \", errorHTML);\n        }\n    }\n\n    function runSelection() {\n        return runTests(builderEditor.getSelectedText());\n    }\n\n    function _locateCursor() {\n        const editor = EditorManager.getActiveEditor();\n        if(!editor) {\n            return;\n        }\n        const formattedSelections = MacroRunner.computeCursors(editor, true);\n        builderEditor.replaceRange(`\\n__PR.setCursors([${formattedSelections.join(\", \")}]);`,\n            builderEditor.getCursorPos());\n        editor.focus();\n    }\n\n    function _validateText() {\n        const editor = EditorManager.getActiveEditor();\n        if(!editor) {\n            return;\n        }\n        const selection = editor.getSelection();\n        const start = selection.start, end = selection.end;\n        const selectionText = `${start.line+1}:${start.ch+1}-${end.line+1}:${end.ch+1}`;\n        let quotedString = editor.getSelectedText().replaceAll(\"\\n\", \"\\\\n\");\n        builderEditor.replaceRange(`\\n__PR.validateText(\\`${quotedString}\\`, \"${selectionText}\");`,\n            builderEditor.getCursorPos());\n        editor.focus();\n    }\n\n    function _validateMarks(){\n        const editor = EditorManager.getActiveEditor();\n        if(!editor) {\n            return;\n        }\n        const marks = editor.findMarksAt(editor.getCursorPos()).filter(mark => mark.markType);\n        const markTypeMap = {};\n        for(let mark of marks){\n            if(!markTypeMap[mark.markType]){\n                markTypeMap[mark.markType] = [];\n            }\n            const loc = mark.find();\n            markTypeMap[mark.markType].push(`\"${loc.from.line+1}:${loc.from.ch+1}-${loc.to.line+1}:${loc.to.ch+1}\"`);\n        }\n        for(let markType of Object.keys(markTypeMap)) {\n            const selections = markTypeMap[markType];\n            builderEditor.replaceRange(`\\n__PR.validateMarks(\"${markType}\", [${selections.join(\", \")}]);`,\n                builderEditor.getCursorPos());\n        }\n    }\n\n    async function _setupPanel() {\n        let file = FileSystem.getFileForPath(BUILD_SCRATCH_FILE);\n        let isExists = await file.existsAsync();\n        if(!isExists) {\n            await new Promise(resolve => {\n                file.write(\"\", {blind: true}, resolve);\n            });\n        }\n        DocumentManager.getDocumentForPath(BUILD_SCRATCH_FILE).done(function (doc) {\n            const _$editor   = $panel.find(\".test_builder-editor\");\n            builderEditor = new Editor.Editor(doc, false, _$editor, null, {});\n            builderEditor.updateLayout();\n        });\n        new ResizeObserver(()=>{\n            builderEditor && builderEditor.updateLayout();\n        }).observe($panel[0]);\n\n        $panel.find(\".close\").click(toggleTestBuilder);\n        $panel.find(\".save-test-builder\").click(saveFile);\n        $panel.find(\".run-test-builder\").click(()=>{\n            runTests();\n        });\n        $panel.find(\".run-selected\").click(runSelection);\n        $panel.find(\".cursor-locate\").click(_locateCursor);\n        $panel.find(\".text-validate\").click(_validateText);\n        $panel.find(\".mark-validate\").click(_validateMarks);\n    }\n\n    AppInit.appReady(function () {\n        if(Phoenix.isTestWindow) {\n            return;\n        }\n        $panel = $(panelHTML);\n        builderPanel = WorkspaceManager.createBottomPanel(\"phcode-test-builder-panel\", $panel, 100);\n        builderPanel.hide();\n        _setupPanel();\n    });\n\n    exports.toggleTestBuilder = toggleTestBuilder;\n});\n"],"file":"extension-min.js"}