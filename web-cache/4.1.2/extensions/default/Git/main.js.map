{"version":3,"sources":["extensions/default/Git/extension-min.js"],"names":["define","require","exports","module","_","brackets","getModule","AppInit","ExtensionUtils","EventEmitter","Events","Main","Preferences","Git","BracketsEvents","modules","Phoenix","config","environment","loadStyleSheet","appReady","init","then","enabled","disableAll","window","TabBarIntegration","phoenixGitEvents","DocumentManager","FileSystem","ProjectManager","MainViewManager","HistoryViewer","Utils","watchedInsideGit","GIT_EVENTS","off","on","evt","file","currentGitRoot","get","fullPath","indexOf","whitelisted","any","entry","consoleDebug","emit","BRACKETS_FILE_CHANGED","doc","BRACKETS_DOCUMENT_SAVED","currentDocument","previousDocument","getCurrentDocument","isVisible","hide","BRACKETS_CURRENT_DOCUMENT_CHANGE","BRACKETS_PROJECT_CHANGE","BRACKETS_PROJECT_REFRESH","GIT_DISABLED","CommandManager","Dialogs","EditorManager","FileSyncManager","Menus","Mustache","PopUpManager","StringUtils","Strings","Metrics","ErrorHandler","Panel","Setup","ProgressDialog","branchesMenuTemplate","newBranchTemplate","mergeBranchTemplate","$gitBranchName","$","currentEditor","$dropdown","renderList","branches","map","name","currentBranch","canDelete","templateVars","branchList","filter","o","render","closeDropdown","removePopUp","detachCloseEvents","doMerge","fromBranch","getBranches","compiledTemplate","dialog","showModalDialogUsingTemplate","$dialog","getElement","find","focus","$toBranch","$useRebase","$useNoff","prop","val","$mergeMessage","attr","prMsg","setSelectionRange","useRebase","trigger","done","buttonId","useNoff","mergeMsg","rebaseInit","catch","err","countEvent","EVENT_TYPE","GIT","showError","ERROR_REBASE_FAILED","stdout","showOutput","GIT_REBASE_SUCCESS","REBASE_RESULT","finally","REFRESH_ALL","console","error","mergeBranch","ERROR_MERGE_FAILED","GIT_MERGE_SUCCESS","MERGE_RESULT","Error","_reloadBranchSelect","$el","template","html","closeNotExistingFiles","oldBranchName","newBranchName","getDeletedFiles","deletedFiles","gitRoot","openedFiles","getWorkingSet","ALL_PANES","forEach","dFile","oFile","closeFullEditor","ERROR_GETTING_DELETED_FILES","handleEvents","e","stopPropagation","getAllBranches","$input","$select","$opt","remote","newVal","substring","length","$this","this","tracker","newProgressTracker","show","fetchAllRemotes","ERROR_FETCH_REMOTE_INFO","branchName","trim","$option","children","originName","isRemote","track","createBranch","ERROR_CREATE_BRANCH","addClass","removeClass","parent","data","askQuestion","DELETE_LOCAL_BRANCH","format","DELETE_LOCAL_BRANCH_NAME","booleanResponse","response","branchDelete","question","forceBranchDelete","output","GIT_BRANCH_DELETE_SUCCESS","ERROR_BRANCH_DELETE_FORCED","getCurrentBranchName","checkout","ERROR_SWITCHING_BRANCHES","ERROR_GETTING_CURRENT_BRANCH","attachCloseEvents","getCurrentFullEditor","_codeMirror","toggleDropdown","closeAll","ERROR_GETTING_BRANCH_LIST","reduce","arr","branch","push","$toggle","marginLeft","parseInt","css","toggleOffset","offset","left","top","outerHeight","appendTo","maxHeight","height","topOffset","position","addPopUp","closeCurrentPopups","handleSelectionEvents","enableSearchFilter","_getHeadFilePath","addHeadToTheFileIndex","resolve","logError","checkBranch","getFileForPath","read","contents","ERROR_READING_GIT_HEAD","m","match","branchInHead","branchInUi","text","refresh","ERROR_PARSING_BRANCH_NAME","getGitRoot","projectRoot","getProjectRoot","isRepositoryRootOrChild","toggle","set","getMergeInfo","mergeInfo","mergeMode","rebaseMode","rebaseHead","rebaseNext","rebaseLast","REBASE_MERGE_MODE","MAX_LEN","tooltip","ON_BRANCH","enable","ERROR_READING_GIT_STATE","ex","contains","disable","$html","click","isExtensionActivated","syncOpenDocuments","execute","GIT_ENABLED","NodeConnector","gitTimeout","nextCliId","deferredMap","getExtensionPref","MAX_COUNTER_VALUE","gitNodeConnector","createNodeConnector","getNextCliId","normalizePathForOs","path","platform","replace","sanitizeOutput","str","toString","logDebug","opts","debugInfo","method","type","out","logger","loggingOptions","logGit","processInfo","duration","Date","getTime","startTime","cliId","msg","join","cliHandler","cmd","args","retry","cliPromise","Promise","reject","progressTracker","savedDefer","watchProgress","cwd","fs","getTauriPlatformPath","resolved","timeoutLength","timeout","domainOpts","timeoutPromise","timeoutExpected","execPeer","toError","GIT_PROGRESS_EVENT","directory","command","invalidCwdErr","stack","message","isResolved","lastProgressTime","timeoutCall","setTimeout","currentTime","diff","which","spawnCommand","_event","evtData","deferred","Commands","Constants","closeUnmodifiedCmd","handleCloseNotModified","status","modifiedFiles","openFiles","openFile","removeOpenFile","modifiedFile","getOpenDocumentForPath","isDirty","FILE_CLOSE_LIST","PaneId","fileList","focusActivePane","register","CMD_CLOSE_UNMODIFIED","CMD_GIT_CLOSE_UNMODIFIED","enableCommand","GIT_STRING_UNIVERSAL","GIT_SUB_MENU","SubMenuIds","GIT_PANEL_CHANGES_CMENU","GIT_PANEL_HISTORY_CMENU","GIT_PANEL_OPTIONS_CMENU","CMD_GIT_INIT","CMD_GIT_CLONE","CMD_GIT_CLONE_WITH_URL","CMD_GIT_SETTINGS_COMMAND_ID","CMD_GIT_CHECKOUT","CMD_GIT_RESET_HARD","CMD_GIT_RESET_SOFT","CMD_GIT_RESET_MIXED","CMD_GIT_TOGGLE_PANEL","CMD_GIT_GOTO_NEXT_CHANGE","CMD_GIT_GOTO_PREVIOUS_CHANGE","CMD_GIT_COMMIT_CURRENT","CMD_GIT_COMMIT_ALL","CMD_GIT_FETCH","CMD_GIT_PULL","CMD_GIT_PUSH","CMD_GIT_REFRESH","CMD_GIT_TAG","CMD_GIT_DISCARD_ALL_CHANGES","CMD_GIT_UNDO_LAST_COMMIT","CMD_GIT_CHANGE_USERNAME","CMD_GIT_CHANGE_EMAIL","CMD_GIT_GERRIT_PUSH_REF","CMD_GIT_AUTHORS_OF_SELECTION","CMD_GIT_AUTHORS_OF_FILE","CMD_GIT_TOGGLE_UNTRACKED","CMD_GIT_HISTORY_GLOBAL","CMD_GIT_HISTORY_FILE","NotificationUI","errorDialogTemplate","errorToString","encodeSensitiveInformation","isTimeout","equals","what","toLowerCase","matches","regExp","consoleError","title","options","dontStripError","errorMetric","__shown","errorBody","errorStack","JSON","stringify","debugMode","useNotification","createToastFromTemplate","toastStyle","NOTIFICATION_STYLES_CSS_CLASS","ERROR","dismissOnClick","instantOpen","body","arg","apply","arguments","EventDispatcher","emInstance","getEmitter","eventName","optionalMetricToLog","callback","rest","one","makeEventDispatcher","GIT_USERNAME_CHANGED","GIT_EMAIL_CHANGED","GIT_COMMITED","GIT_NO_BRANCH_EXISTS","GIT_CHANGE_USERNAME","GIT_CHANGE_EMAIL","GERRIT_TOGGLE_PUSH_REF","GERRIT_PUSH_REF_TOGGLED","HANDLE_GIT_INIT","HANDLE_GIT_CLONE","HANDLE_GIT_COMMIT","HANDLE_FETCH","HANDLE_PUSH","HANDLE_PULL","HANDLE_REMOTE_PICK","HANDLE_REMOTE_DELETE","HANDLE_REMOTE_CREATE","HANDLE_FTP_PUSH","HISTORY_SHOW_FILE","HISTORY_SHOW_GLOBAL","REFRESH_COUNTERS","REFRESH_HISTORY","GIT_STATUS_RESULTS","GIT_REMOTE_AVAILABLE","GIT_REMOTE_NOT_AVAILABLE","REMOTES_REFRESH_PICKER","FETCH_STARTED","FETCH_COMPLETE","ExpectedError","prototype","ScrollTrackMarkers","GIT_SCROLL_MARKS","gitAvailable","gutterName","editorsWithGutters","openWidgets","_addDummyGutterMarkerIfNotExist","cm","line","lineInfo","gutters","gutterEnabled","getOption","slice","gutterMarkers","existingMarker","dummy","document","createElement","className","setGutterMarker","_cursorActivity","_evt","editor","hasSelection","getCursorPos","clearWidgets","lines","mark","w","lineWidget","visible","widget","clear","clearOld","io","splice","clearGutter","setOption","gutterClick","gitGutters","prepareGutter","unshift","prepareGutters","editors","idx","_showGutters","_results","sortBy","openBefore","obj","$marker","lineIndex","gutterId","parentMark","element","$btn","replaceRange","content","ch","append","addLineWidget","coverGutter","noHScroll","above","showIfHidden","getEditorFromPane","paneId","currentPath","getCurrentlyViewedPath","_masterEditor","hasVerticalScrollbar","scrollEl","getScrollerElement","scrollHeight","clientHeight","_markScrollbar","allChanges","added","item","removed","modified","trackers","posArray","addTickmarks","trackStyle","TRACK_STYLES","ON_LEFT","cssColorClass","processDiffResults","changesets","split","shift","s1","s2","lineRemovedFrom","lineFrom","lineCount","isNaN","l","isModifiedMark","firstAddedMark","i","lineTo","lineNo","pop","concat","compact","getPaneIdList","currentFilePath","filename","diffFile","ERROR_REFRESH_GUTTER","goToPrev","activeEditor","getActiveEditor","results","searched","currentPos","goToMark","setCursorPos","goToNext","event","newEditor","oldEditor","alreadyOpened","FileUtils","LocalizationUtils","gitPanelHistoryTemplate","gitPanelHistoryCommitsTemplate","$gitPanel","$tableContainer","$historyList","commitCache","lastDocumentSeen","initVariables","attachHandlers","loadMoreHistory","$tr","hash","commit","historyShown","isInitial","generateCssAvatar","memoize","author","email","seededRandom","max","min","seed","rnd","seedBase","charCodeAt","colors","texts","picked","Math","floor","renderHistory","p","getFileHistory","relative","getHistory","commits","addAdditionalCommitInfo","templateData","absolute","ERROR_GET_HISTORY","is","scrollTop","skipCount","commitsHtml","ERROR_GET_MORE_HISTORY","ERROR_GET_CURRENT_BRANCH","cssAvatar","avatarLetter","dateTime","date","shown","getFormattedDateTime","dateTimeFromNowFriendly","hasTag","tags","handleFileChange","handleToggleHistory","newHistoryMode","newDocument","historyEnabled","currentFile","currentHistoryMode","savedScrollTop","savedScrollLeft","selectedCommitHash","isRefresh","scrollLeft","getRelativeFilename","isEmpty","fileChanged","remove","$spinner","$newHistoryList","globalButtonActive","fileButtonActive","toggleClass","TOOLTIP_HIDE_HISTORY","TOOLTIP_SHOW_HISTORY","TOOLTIP_HIDE_FILE_HISTORY","TOOLTIP_SHOW_FILE_HISTORY","LanguageManager","WorkspaceManager","marked","historyViewerTemplate","historyViewerFilesTemplate","useDifftool","isShown","currentlyViewedCommit","$viewer","$editorHolder","setExpandState","debounce","allFiles","activeFiles","allExpanded","PAGE_SIZE","currentPage","hasNextPage","toggleDiff","$a","hasClass","$li","closest","relativeFilePath","$diffContainer","getDiffOfFileFromCommit","formatDiff","ERROR_GET_DIFF_FILE_COMMIT","showDiff","difftoolFromHash","expandAll","not","collapseAll","attachEvents","openEditorForFile","$parent","sha","renderViewerContent","files","selectedFile","bodyMarkdown","gfm","breaks","renderFiles","$fileEntry","first","animate","loadMoreFiles","getFilesFromCommit","list","fileExtension","getCompoundFileExtension","lastIndexOf","fileName","extension","ERROR_GET_DIFF_FILES","initialize","once","getConfig","commitInfo","commitHash","firstPaneStyle","cssText","secondPaneStyle","onRemove","recomputeLayout","Branch","SettingsDialog","CloseNotModified","gitTagDialogTemplate","CMD_ADD_TO_IGNORE","CMD_REMOVE_FROM_IGNORE","$icon","STATUSBAR_SHOW_GIT","prependTo","gitEnabled","initUi","_addRemoveItemInGitignore","selectedEntry","entryPath","gitignoreEntry","consoleWarn","without","write","ERROR_MODIFY_GITIGNORE","addItemToGitingore","getSelectedItem","removeItemFromGitingore","addItemToGitingoreFromPanel","filePath","getPanel","fileEntry","removeItemFromGitingoreFromPanel","_refreshCallback","checkoutCommit","commitDetail","getSelectedHistoryCommit","commitDetailStr","subject","displayStr","CHECKOUT_COMMIT_DETAIL","TITLE_CHECKOUT","DIALOG_CHECKOUT","noescape","customOkBtn","CHECKOUT_COMMIT","tagCommit","tagname","setTagName","ERROR_CREATE_TAG","_resetOperation","operation","gitCmdUsed","RESET_DETAIL","RESET","customOkBtnClass","reset","resetHard","RESET_HARD_TITLE","RESET_HARD_MESSAGE","resetMixed","RESET_MIXED_TITLE","RESET_MIXED_MESSAGE","resetSoft","RESET_SOFT_TITLE","RESET_SOFT_MESSAGE","disableAllMenus","commandsToDisable","cmdId","initGitMenu","fileMenu","getMenu","AppMenuBar","FILE_MENU","gitSubMenu","addSubMenu","AFTER","FILE_EXTENSION_MANAGER","addMenuDivider","addMenuItem","undefined","hideWhenCommandDisabled","ADD_TO_GITIGNORE","REMOVE_FROM_GITIGNORE","panelCmenu","registerContextMenu","historyCmenu","MENU_RESET_HARD","MENU_RESET_MIXED","MENU_RESET_SOFT","MENU_TAG_COMMIT","optionsCmenu","ContextMenu","assignContextMenuToSelector","GIT_SETTINGS","sortedResults","_toggleMenuEntriesState","_divider1","_divider2","toggleMenuEntries","bool","projectCmenu","getContextMenu","ContextMenuIds","PROJECT_MENU","workingCmenu","WORKING_SET_CONTEXT_MENU","removeMenuDivider","id","removeMenuItem","_enableAllCommands","isCommandExecuting","scheduledRefresh","REFRESH_DEDUPE_TIME","refreshOnFocusChange","isGitPanelVisible","fail","always","clearTimeout","projectSwitched","CloneDialog","gitignoreTemplate","createGitIgnore","gitIgnorePath","pathExists","exists","jsPromise","writeText","stageGitIgnore","stage","handleGitInit","isProjectRootWritable","writable","initPath","app","getDisplayPath","errorStr","FOLDER_NOT_WRITABLE","result","INIT_NEW_REPO_FAILED","isProjectRootEmpty","getContents","entries","handleGitClone","gitCloneURL","destPath","$cloneButton","_clone","remoteUrlNew","GIT_CLONE_REMOTE_FAILED","clonePath","GIT_CLONE_ERROR_EXPLAIN","cloneConfig","q","remoteUrl","clone","remoteUrlRestore","setRemoteUrl","GIT_CLONE","StateManager","CodeInspection","FileViewController","FindInFiles","GutterManager","gitPanelTemplate","gitPanelResultsTemplate","gitAuthorsDialogTemplate","gitCommitDialogTemplate","gitCommitLintResultTemplate","gitDiffDialogTemplate","questionDialogTemplate","showFileWhiteList","GIT_PANEL_SHOWN_ON_FIRST_BOOT","COMMIT_MODE","CURRENT","ALL","DEFAULT","gitPanel","$mainToolbar","gitPanelDisabled","gitPanelMode","showingUntracked","lastCommitMessage","lintFile","codeInspectionPromise","inspectFile","_makeDialogBig","$wrapper","parents","width","end","_showCommitDialog","stagedDiff","prefilledMessage","commitMode","totalLintErrors","inspectFiles","lintResults","lintResult","errors","lintingFilePath","Array","isArray","resultSet","providerName","provider","errorLineMessage","pos","hasErrors","getRangeName","compiledResultHTML","CODE_INSPECTION_PROBLEMS","CODE_INSPECTION_PROBLEMS_NONE","preventDefault","target","fileToOpen","FILE_OPEN","close","FORMAT_DIFF_TOO_LARGE","toggleAmendCheckbox","AMEND_COMMIT_FORBIDDEN","getCommitMessageElement","r","getCommitCounts","hasRemote","hasCommitsAhead","ahead","$commitMessageCount","recalculateMessageLength","usingTextArea","switchCommitMessageElement","findStr","currentValue","prefillMessage","$commitMessage","getLastCommitMessage","commitMessageElement","filePaths","next","_getStagedDiff","_doGitCommit","ERROR_CANT_GET_STAGED_DIFF","commitMessage","amendCommit","noVerify","s","GIT_COMMIT_IN_PROGRESS","preDelay","postDelay","ERROR_MODIFIED_DIALOG_FILES","ERROR_GIT_COMMIT_FAILED","_showAuthors","blame","fromLine","toLine","linesTotal","blameStats","stats","key","authorName","percentage","round","reverse","LINES","_getCurrentFilePath","handleAuthorsSelection","currentSelection","getSelection","start","isSomethingSelected","ERROR_SAVE_FIRST","getBlame","ERROR_GIT_BLAME_FAILED","ERROR_NOTHING_SELECTED","handleAuthorsFile","handleGitDiff","difftool","diffFileNice","diffVal","ERROR_GIT_DIFF_FAILED","handleGitUndo","UNDO_CHANGES","Q_UNDO_CHANGES","escape","discardFileChanges","getAllOpenDocuments","reloadDoc","ERROR_DISCARD_CHANGES_FAILED","handleGitDelete","ERROR_COULD_NOT_RESOLVE_FILE","FILE_DELETE","fileNamesString","_getStagedDiffForCommitMode","GETTING_STAGED_DIFF_PROGRESS","initialMessage","PLEASE_WAIT","getListOfStagedFiles","filesList","DIFF_FAILED_SEE_FILES","_getStaggedDiffForAllFiles","FILE_STATUS","UNTRACKED","_getDiffForUntrackedFiles","getDiffOfAllIndexFiles","getDiffOfStagedFiles","isUntracked","statusFiles","untrackedFiles","fileArray","fileObject","_diff","resetIndex","handleRebase","whatToDo","rebase","abortMerge","discardAllChanges","ERROR_MERGE_ABORT_FAILED","findConflicts","doSearch","commitMerge","loadPathContent","handleGitCommit","gitStatusResults","totalFiles","totalFilesLinted","filesDone","showProgress","$progressBar","style","progressString","CODE_INSPECTION_DONE_FILES","codeInspectionPromises","fileObj","isDeleted","DELETED","all","isMerge","isLoading","stripWhitespace","setLoading","STAGED","handleGitCommitInternal","currentDoc","relativePath","ERROR_PREPARING_COMMIT_DIALOG","unsetLoading","queue","stripWhitespaceFromFiles","CLEANING_WHITESPACE_PROGRESS","refreshCurrentFile","each","currentFullPath","thisFile","shouldShow","test","_refreshTableContainer","allStaged","$editedList","visibleBefore","NOTHING_TO_COMMIT","staged","statusText","allowDiff","RENAMED","allowDelete","ADDED","allowUndo","_setName","commandID","newName","setName","refreshCommitCounts","$pullBtn","$pushBtn","clearCounts","PULL_SHORTCUT","PUSH_SHORTCUT","remotes","defaultRemote","behind","PULL_SHORTCUT_BEHIND","PUSH_SHORTCUT_AHEAD","empty","p1","p2","setVisible","setChecked","handleToggleUntracked","commitCurrentFile","commitAllFiles","_toggleCommitButton","anyStaged","undoLastLocalCommit","UNDO_COMMIT","UNDO_LOCAL_COMMIT_CONFIRM","ERROR_UNDO_LAST_COMMIT_FAILED","lastCheckOneClicked","attachDefaultTableHandlers","isChecked","shiftKey","lc","localeCompare","lcClickedSelector","sequence","prevUntil","andSelf","nextUntil","promises","add","toArray","ERROR_MODIFY_FILE_STATUS_FAILED","stagePromise","unstage","ERROR_STAGE_FAILED","currentTarget","openFileAndAddToWorkingSet","setGerritCheckState","RESET_LOCAL_REPO","RESET_LOCAL_REPO_CONFIRM","DISCARD_CHANGES","ERROR_RESET_LOCAL_REPO_FAILED","$historyRow","_panelResized","_entries","mainToolbarWidth","overFlowWidth","breakpoints","bp","panelHtml","S","$panelHtml","createBottomPanel","$panel","resizeObserver","ResizeObserver","observe","stageAll","typeOfRemote","open","PANEL_COMMAND","COMMIT_CURRENT_SHORTCUT","COMMIT_ALL_SHORTCUT","FETCH_SHORTCUT","GOTO_PREVIOUS_GIT_CHANGE","GOTO_NEXT_GIT_CHANGE","REFRESH_GIT","UNDO_LAST_LOCAL_COMMIT","CHANGE_USER_NAME","CHANGE_USER_EMAIL","ENABLE_GERRIT_PUSH_REF","VIEW_AUTHORS_SELECTION","VIEW_AUTHORS_FILE","HIDE_UNTRACKED","GIT_INIT","GIT_SHOW_HISTORY","GIT_SHOW_FILE_HISTORY","cause","currentUserName","CHANGE_USER_NAME_TITLE","ENTER_NEW_USER_NAME","defaultValue","userName","setConfig","ERROR_CHANGE_USERNAME_FAILED","currentUserEmail","CHANGE_USER_EMAIL_TITLE","ENTER_NEW_USER_EMAIL","userEmail","ERROR_CHANGE_EMAIL_FAILED","strEnabled","toggledValue","ERROR_TOGGLE_GERRIT_PUSH_REF_FAILED","CHANGE_USER_NAME_MENU","CHANGE_USER_EMAIL_MENU","createFromTemplate","GIT_TOAST_TITLE","GIT_TOAST_MESSAGE","allowedPlacements","currentEmail","fileSystemEntry","isDirectory","rebaseEnabled","mergeEnabled","PreferencesManager","stateManager","prefix","defaultPreferences","stripWhitespaceFromCommits","value","addEndlineToTheEndOfFile","removeByteOrderMark","normalizeLineEndings","useGitGutter","markModifiedInTree","useVerboseDiff","clearWhitespaceOnSave","gerritPushref","enableGit","gitPath","prefs","getExtensionPrefs","location","getAll","definition","getDefaults","os","getType","getGlobal","save","definePreference","ignoreEntries","newPaths","modifiedPaths","addClassesProvider","isIgnored","isNew","isModified","refreshOpenFiles","_refreshOpenFiles","refreshIgnoreEntries","rerenderTree","detachEvents","loadIgnoreContents","excludeContents","gitignoreContents","finish","after","regexEscape","leadingSlash","trailingSlash","regex","regexp","RegExp","ignored","triggerHandler","DefaultDialogs","PullDialog","PushDialog","gitRemotesPickerTemplate","$selectedRemote","$remotesDropdown","$gitPush","getDefaultRemote","allRemotes","defaultRemotes","candidate","setDefaultRemote","remoteName","clearRemotePicker","selectRemote","refreshRemotesPicker","getRemotes","defaultRemoteName","deletable","ERROR_GETTING_REMOTES","handleRemoteCreation","CREATE_NEW_REMOTE","ENTER_REMOTE_NAME","ENTER_REMOTE_URL","url","createRemote","USER_ABORTED","ERROR_REMOTE_CREATION","deleteRemote","DELETE_REMOTE","DELETE_REMOTE_NAME","showPushResult","showModalDialog","DIALOG_ID_INFO","GIT_PUSH_RESPONSE","pushToRemote","ERROR_NO_REMOTE_SELECTED","pushConfig","additionalArgs","setBranchAsTracking","setUpstreamBranch","op","pushToNew","pushToNewUpstream","strategy","pushForced","deleteRemoteBranch","waitForClose","ERROR_PUSHING_REMOTE","ERROR_PUSHING_OPERATION","pullFromRemote","pullConfig","fetchRemote","mergeRemote","rebaseRemote","resetRemote","GIT_PULL_SUCCESS","GIT_PULL_RESPONSE","ERROR_PULLING_REMOTE","ERROR_PULLING_OPERATION","handleFetch","$remote","settingsDialogTemplate","setValues","values","tag","property","collectDialogValues","prefType","newValue","assignActions","$useDifftoolCheckbox","diffToolConfiguration","disabled","checked","enableGitPreference","gitDisabled","gitNotFound","anyChecked","fileStatusCache","getFileStatus","some","statusType","MODIFIED","COPIED","includes","DIFF_TOO_LONG","formatDiffTemplate","outputDialogTemplate","writeTestResults","EXT_NAME","getExtensionDirectory","DIFF_MAX_LENGTH","tabReplace","verbose","numLineOld","numLineNew","lastStatus","diffData","LINE_STATUS","diffSplit","lineClass","pushLine","substr","log","_numLineOld","_numLineNew","x","toUpperCase","trailingWhitespace","last","stringInput","password","passwordInput","defer","folder","unlink","_clearCachedData","isFile","a","protocol","user","users","slash1","username","slash2","warn","readAsText","refreshText","stripWhitespaceFromFile","clearWholeFile","removeBom","_cleanLines","lineNumbers","lineNumber","ln","lastLineNumber","from","to","stageChanges","langId","getLanguageForPath","getId","t","CLEAN_FILE_START","notifyProgress","CLEAN_FILE_END","clearWhitespace","setEnabled","RemoteCommon","$cloneInput","_attachEvents","$authInputs","auth","exec","templateArgs","modeLabel","CLONE_REPOSITORY","collectValues","$textarea","maxLines","addLine","updateTimeout","updateTextarea","onProgress","promise","showOpts","finished","showDialog","OPERATION_IN_PROGRESS_TITLE","finalValue","finalError","check","remotesTemplate","attachCommonEvents","_show","mode","PULL_FROM","pull","collectInfo","PUSH_TO","fillBranches","ERROR_BRANCH_LIST","getCurrentUpstreamBranch","upstreamBranch","currentTrackingBranch","getRemoteUrl","URL","remoteUsername","remotePassword","_usernamePasswordDisabled","currentBranchName","ERROR_FETCH_REMOTE","handleRadioChange","trackingBranchRemote","action","saveToUrl","GitCli","remoteBranch","sortBranches","sort","b","ar","br","sortPrefix","sortName","skip","clean","baseCheck","mergeCheck","rebaseCheck","gitFolder","head","mergeHead","msgSplit","mergeMessage","mergeConflicts","Object","keys","Cli","_gitPath","_gitQueue","_gitQueueBusy","lastGitStatusResults","UNMODIFIED","IGNORED","UNMERGED","EMPTY_TREE","getGitPath","setGitPath","strEndsWith","subjectString","searchString","lastIndex","_processQueue","nonblocking","call","git","TypeError","moreArgs","repositoryNotFoundHandler","uniq","ffOnly","noCommit","readMergeMessage","strGerritEnabled","doPushWithArgs","retObj","lineTwo","flag","summary","flagDescription","GIT_PUSH_SUCCESS_MSG","GIT_PUSH_FORCE_UPDATED_MSG","GIT_PUSH_DELETED_MSG","GIT_PUSH_NEW_REF_MSG","GIT_PUSH_REJECTED_MSG","GIT_PUSH_UP_TO_DATE_MSG","info","oldBranch","newBranch","row","allowGlobal","skipCommits","separator","newline","hashShort","remoteGitUrl","destinationFolder","fileOrFiles","updateIndex","amend","res","originBranch","trackOrigin","_isquoted","_unquote","_isescaped","currentSubFolder","isEscaped","needReset","statusStaged","statusUnstaged","statusChar","display","hasStatusChanged","prevStatus","currentStatus","_isFileStaged","getVersion","getCommitCountsFallback","sep","sep2","trimLeft","firstLine","num","stderr","root","checkPathRecursive","stat","_git","standardGitPathsWin","standardGitPathsNonWin","extensionActivated","getGitVersion","pathsToLook","unique","searchedPaths","gits","latestGit","version","major","minor","index","_version"],"mappings":"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","sourcesContent":["/*!\n * Brackets Git Extension\n *\n * @author Martin Zagora\n * @license http://opensource.org/licenses/MIT\n */\n\ndefine(function (require, exports, module) {\n\n    // Brackets modules\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        AppInit         = brackets.getModule(\"utils/AppInit\"),\n        ExtensionUtils  = brackets.getModule(\"utils/ExtensionUtils\");\n\n    // Local modules\n    require(\"src/SettingsDialog\");\n    const EventEmitter    = require(\"src/EventEmitter\"),\n        Events          = require(\"src/Events\"),\n        Main            = require(\"src/Main\"),\n        Preferences     = require(\"src/Preferences\"),\n        Git             = require(\"src/git/Git\"),\n        BracketsEvents     = require(\"src/BracketsEvents\");\n\n    // Load extension modules that are not included by core\n    var modules = [\n        \"src/GutterManager\",\n        \"src/History\",\n        \"src/NoRepo\",\n        \"src/ProjectTreeMarks\",\n        \"src/Remotes\",\n        \"src/TabBarIntegration\"\n    ];\n    require(modules);\n\n    // Load CSS\n    if(Phoenix.config.environment === \"dev\"){\n        ExtensionUtils.loadStyleSheet(module, \"styles/git-styles.less\");\n    } else {\n        ExtensionUtils.loadStyleSheet(module, \"styles/git-styles-min.css\");\n    }\n\n    AppInit.appReady(function () {\n        Main.init().then((enabled)=>{\n            if(!enabled) {\n                BracketsEvents.disableAll();\n            }\n        });\n    });\n\n    // export API's for other extensions\n    if (typeof window === \"object\") {\n        const TabBarIntegration = require(\"src/TabBarIntegration\");\n        window.phoenixGitEvents = {\n            EventEmitter: EventEmitter,\n            Events: Events,\n            Git,\n            TabBarIntegration\n        };\n    }\n});\n\ndefine(\"src/BracketsEvents\", function (require, exports, module) {\n\n    // Brackets modules\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileSystem      = brackets.getModule(\"filesystem/FileSystem\"),\n        ProjectManager  = brackets.getModule(\"project/ProjectManager\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\");\n\n    // Local modules\n    const Events        = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        HistoryViewer = require(\"src/HistoryViewer\"),\n        Preferences   = require(\"src/Preferences\"),\n        Utils         = require(\"src/Utils\");\n\n    // White-list for .git file watching\n    const watchedInsideGit = [\"HEAD\"];\n    const GIT_EVENTS = \"gitEvents\";\n\n    FileSystem.on(`change.${GIT_EVENTS}`, function (evt, file) {\n        // we care only for files in current project\n        var currentGitRoot = Preferences.get(\"currentGitRoot\");\n        if (file && file.fullPath.indexOf(currentGitRoot) === 0) {\n\n            if (file.fullPath.indexOf(currentGitRoot + \".git/\") === 0) {\n\n                var whitelisted = _.any(watchedInsideGit, function (entry) {\n                    return file.fullPath === currentGitRoot + \".git/\" + entry;\n                });\n                if (!whitelisted) {\n                    Utils.consoleDebug(\"Ignored FileSystem.change event: \" + file.fullPath);\n                    return;\n                }\n\n            }\n\n            EventEmitter.emit(Events.BRACKETS_FILE_CHANGED, file);\n        }\n    });\n\n    DocumentManager.on(`documentSaved.${GIT_EVENTS}`, function (evt, doc) {\n        // we care only for files in current project\n        if (doc.file.fullPath.indexOf(Preferences.get(\"currentGitRoot\")) === 0) {\n            EventEmitter.emit(Events.BRACKETS_DOCUMENT_SAVED, doc);\n        }\n    });\n\n    MainViewManager.on(`currentFileChange.${GIT_EVENTS}`, function (evt, currentDocument, previousDocument) {\n        currentDocument = currentDocument || DocumentManager.getCurrentDocument();\n        if (!HistoryViewer.isVisible()) {\n            EventEmitter.emit(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, currentDocument, previousDocument);\n        } else {\n            HistoryViewer.hide();\n        }\n    });\n\n    ProjectManager.on(`projectOpen.${GIT_EVENTS}`, function () {\n        EventEmitter.emit(Events.BRACKETS_PROJECT_CHANGE);\n    });\n\n    ProjectManager.on(`projectRefresh.${GIT_EVENTS}`, function () {\n        EventEmitter.emit(Events.BRACKETS_PROJECT_REFRESH);\n    });\n\n    ProjectManager.on(`beforeProjectClose.${GIT_EVENTS}`, function () {\n        // Disable Git when closing a project so listeners won't fire before new is opened\n        EventEmitter.emit(Events.GIT_DISABLED);\n    });\n\n    function disableAll() {\n        FileSystem.off(`change.${GIT_EVENTS}`);\n        DocumentManager.off(`documentSaved.${GIT_EVENTS}`);\n        MainViewManager.off(`currentFileChange.${GIT_EVENTS}`);\n        ProjectManager.off(`projectOpen.${GIT_EVENTS}`);\n        ProjectManager.off(`projectRefresh.${GIT_EVENTS}`);\n        ProjectManager.off(`beforeProjectClose.${GIT_EVENTS}`);\n    }\n\n    exports.disableAll = disableAll;\n});\n\ndefine(\"src/Branch\", function (require, exports) {\n\n    var _                       = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager          = brackets.getModule(\"command/CommandManager\"),\n        Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        EditorManager           = brackets.getModule(\"editor/EditorManager\"),\n        FileSyncManager         = brackets.getModule(\"project/FileSyncManager\"),\n        FileSystem              = brackets.getModule(\"filesystem/FileSystem\"),\n        Menus                   = brackets.getModule(\"command/Menus\"),\n        Mustache                = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        PopUpManager            = brackets.getModule(\"widgets/PopUpManager\"),\n        StringUtils             = brackets.getModule(\"utils/StringUtils\"),\n        DocumentManager         = brackets.getModule(\"document/DocumentManager\"),\n        Strings                 = brackets.getModule(\"strings\"),\n        Metrics                 = brackets.getModule(\"utils/Metrics\"),\n        MainViewManager         = brackets.getModule(\"view/MainViewManager\");\n\n    var Git                     = require(\"src/git/Git\"),\n        Events                  = require(\"src/Events\"),\n        EventEmitter            = require(\"src/EventEmitter\"),\n        ErrorHandler            = require(\"src/ErrorHandler\"),\n        Panel                   = require(\"src/Panel\"),\n        Setup                   = require(\"src/utils/Setup\"),\n        Preferences             = require(\"src/Preferences\"),\n        ProgressDialog          = require(\"src/dialogs/Progress\"),\n        Utils                   = require(\"src/Utils\"),\n        branchesMenuTemplate    = `<ul id=\"git-branch-dropdown\" class=\"dropdown-menu\" tabindex=\"-1\">\n    <li>\n        <a class=\"git-branch-new\">\n            <span>{{Strings.CREATE_NEW_BRANCH}}</span>\n        </a>\n    </li>\n\n    {{#branchList.length}}\n    <li class=\"divider\"></li>\n    {{/branchList.length}}\n\n    {{#branchList}}\n    <li>\n        <a class=\"git-branch-link\" data-branch=\"{{name}}\">\n            {{#canDelete}}\n            <span class=\"trash-icon\">&times;</span>\n            {{/canDelete}}\n            <span class=\"merge-branch\"><i title=\"{{Strings.MERGE_BRANCH}}\" class=\"octicon octicon-git-merge\"></i></span>\n            <span class=\"switch-branch\">{{name}}</span>\n        </a>\n    </li>\n    {{/branchList}}\n</ul>\n`,\n        newBranchTemplate       = `<div class=\"modal git\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.CREATE_NEW_BRANCH_TITLE}}</h1>\n    </div>\n    <div class=\"modal-body tab-content\">\n\n        <form>\n            <div>\n                <label>{{Strings.ORIGIN_BRANCH}}:</label>\n                <div>\n                    <div class=\"input-append\">\n                        <select class=\"branchSelect\" name=\"branch-origin\"></select>\n                        <button class=\"btn fetchBranches\" type=\"button\">\n                            <i class=\"octicon octicon-sync\"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div>\n                <label>{{Strings.BRANCH_NAME}}:</label>\n                <div>\n                    <input name=\"branch-name\" type=\"text\" autocomplete=\"off\" spellcheck=\"false\" />\n                </div>\n            </div>\n        </form>\n\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`,\n        mergeBranchTemplate     = `<div class=\"modal git\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.MERGE_BRANCH}} \"{{fromBranch}}\"</h1>\n    </div>\n    <div class=\"modal-body tab-content\">\n        <form>\n            <div>\n                <label>{{Strings.TARGET_BRANCH}}:</label>\n                <div>\n                    <select disabled name=\"branch-target\">\n                        {{#branches}}\n                        <option value=\"{{name}}\" remote=\"{{remote}}\" {{#currentBranch}}selected{{/currentBranch}}>\n                        {{name}}\n                        </option>\n                        {{/branches}}\n                    </select>\n                </div>\n            </div>\n            <div>\n                <label>{{Strings.MERGE_MESSAGE}}:</label>\n                <div>\n                    <div class=\"input-append\">\n                        <input name=\"merge-message\" type=\"text\" placeholder=\"default\" autocomplete=\"off\">\n                        <button class=\"btn fill-pr\" type=\"button\">PR</button>\n                    </div>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"use-rebase\"> {{Strings.USE_REBASE}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"use-noff\"> {{Strings.USE_NOFF}}\n                    </label>\n                </div>\n            </div>\n        </form>\n    </div>\n\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`;\n\n    var $gitBranchName          = $(null),\n        currentEditor,\n        $dropdown;\n\n    function renderList(branches) {\n        branches = branches.map(function (name) {\n            return {\n                name: name,\n                currentBranch: name.indexOf(\"* \") === 0,\n                canDelete: name !== \"master\"\n            };\n        });\n        var templateVars  = {\n            branchList: _.filter(branches, function (o) { return !o.currentBranch; }),\n            Strings:    Strings\n        };\n        return Mustache.render(branchesMenuTemplate, templateVars);\n    }\n\n    function closeDropdown() {\n        if ($dropdown) {\n            PopUpManager.removePopUp($dropdown);\n        }\n        detachCloseEvents();\n    }\n\n    function doMerge(fromBranch) {\n        Git.getBranches().then(function (branches) {\n\n            var compiledTemplate = Mustache.render(mergeBranchTemplate, {\n                fromBranch: fromBranch,\n                branches: branches,\n                Strings: Strings\n            });\n\n            var dialog  = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n            var $dialog = dialog.getElement();\n            $dialog.find(\"input\").focus();\n\n            var $toBranch = $dialog.find(\"[name='branch-target']\");\n            var $useRebase = $dialog.find(\"[name='use-rebase']\");\n            var $useNoff = $dialog.find(\"[name='use-noff']\");\n\n            if (fromBranch === \"master\") {\n                $useRebase.prop(\"checked\", true);\n            }\n            if ($toBranch.val() === \"master\") {\n                $useRebase.prop(\"checked\", false).prop(\"disabled\", true);\n            }\n\n            // fill merge message if possible\n            var $mergeMessage = $dialog.find(\"[name='merge-message']\");\n            $mergeMessage.attr(\"placeholder\", \"Merge branch '\" + fromBranch + \"'\");\n            $dialog.find(\".fill-pr\").on(\"click\", function () {\n                var prMsg = \"Merge pull request #??? from \" + fromBranch;\n                $mergeMessage.val(prMsg);\n                $mergeMessage[0].setSelectionRange(prMsg.indexOf(\"???\"), prMsg.indexOf(\"???\") + 3);\n            });\n\n            // can't use rebase and no-ff together so have a change handler for this\n            $useRebase.on(\"change\", function () {\n                var useRebase = $useRebase.prop(\"checked\");\n                $useNoff.prop(\"disabled\", useRebase);\n                if (useRebase) { $useNoff.prop(\"checked\", false); }\n            }).trigger(\"change\");\n\n            dialog.done(function (buttonId) {\n                // right now only merge to current branch without any configuration\n                // later delete merge branch and so ...\n                var useRebase = $useRebase.prop(\"checked\");\n                var useNoff = $useNoff.prop(\"checked\");\n                var mergeMsg = $mergeMessage.val();\n\n                if (buttonId === \"ok\") {\n\n                    if (useRebase) {\n\n                        Git.rebaseInit(fromBranch).catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'rebase', \"fail\");\n                            throw ErrorHandler.showError(err, Strings.ERROR_REBASE_FAILED);\n                        }).then(function (stdout) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'rebase', \"success\");\n                            Utils.showOutput(stdout || Strings.GIT_REBASE_SUCCESS, Strings.REBASE_RESULT).finally(function () {\n                                EventEmitter.emit(Events.REFRESH_ALL);\n                            });\n                        }).catch(console.error);\n                    } else {\n\n                        Git.mergeBranch(fromBranch, mergeMsg, useNoff).catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'merge', \"fail\");\n                            throw ErrorHandler.showError(err, Strings.ERROR_MERGE_FAILED);\n                        }).then(function (stdout) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'merge', \"success\");\n                            Utils.showOutput(stdout || Strings.GIT_MERGE_SUCCESS, Strings.MERGE_RESULT).finally(function () {\n                                EventEmitter.emit(Events.REFRESH_ALL);\n                            });\n                        }).catch(console.error);\n                    }\n                }\n            });\n        }).catch(err => {\n            console.error(\"Error Getting branches\", err);\n            // we need to strip all user entered info from git thrown exception for get branches which shouldn't fail,\n            // so we throw a blank error for bugsnag\n            throw new Error(\"Failed to get getBranches while doMerge\");\n        });\n    }\n\n    function _reloadBranchSelect($el, branches) {\n        var template = \"{{#branches}}<option value='{{name}}' remote='{{remote}}' \" +\n            \"{{#currentBranch}}selected{{/currentBranch}}>{{name}}</option>{{/branches}}\";\n        var html = Mustache.render(template, { branches: branches });\n        $el.html(html);\n    }\n\n    function closeNotExistingFiles(oldBranchName, newBranchName) {\n        return Git.getDeletedFiles(oldBranchName, newBranchName).then(function (deletedFiles) {\n\n            var gitRoot     = Preferences.get(\"currentGitRoot\"),\n                openedFiles = MainViewManager.getWorkingSet(MainViewManager.ALL_PANES);\n\n            // Close files that does not exists anymore in the new selected branch\n            deletedFiles.forEach(function (dFile) {\n                var oFile = _.find(openedFiles, function (oFile) {\n                    return oFile.fullPath === gitRoot + dFile;\n                });\n                if (oFile) {\n                    DocumentManager.closeFullEditor(oFile);\n                }\n            });\n\n            EventEmitter.emit(Events.REFRESH_ALL);\n\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GETTING_DELETED_FILES);\n        });\n    }\n\n    function handleEvents() {\n        $dropdown.on(\"click\", \"a.git-branch-new\", function (e) {\n            e.stopPropagation();\n            closeDropdown();\n\n            Git.getAllBranches().catch(function (err) {\n                ErrorHandler.showError(err);\n            }).then(function (branches = []) {\n\n                var compiledTemplate = Mustache.render(newBranchTemplate, {\n                    branches: branches,\n                    Strings: Strings\n                });\n\n                var dialog  = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n\n                var $input  = dialog.getElement().find(\"[name='branch-name']\"),\n                    $select = dialog.getElement().find(\".branchSelect\");\n\n                $select.on(\"change\", function () {\n                    if (!$input.val()) {\n                        var $opt = $select.find(\":selected\"),\n                            remote = $opt.attr(\"remote\"),\n                            newVal = $opt.val();\n                        if (remote) {\n                            newVal = newVal.substring(remote.length + 1);\n                            if (remote !== \"origin\") {\n                                newVal = remote + \"#\" + newVal;\n                            }\n                        }\n                        $input.val(newVal);\n                    }\n                });\n\n                _reloadBranchSelect($select, branches);\n                dialog.getElement().find(\".fetchBranches\").on(\"click\", function () {\n                    var $this = $(this);\n                    const tracker = ProgressDialog.newProgressTracker();\n                    ProgressDialog.show(Git.fetchAllRemotes(tracker), tracker)\n                        .then(function () {\n                            return Git.getAllBranches().then(function (branches) {\n                                $this.prop(\"disabled\", true).attr(\"title\", \"Already fetched\");\n                                _reloadBranchSelect($select, branches);\n                            });\n                        }).catch(function (err) {\n                            throw ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE_INFO);\n                        });\n                });\n\n                dialog.getElement().find(\"input\").focus();\n                dialog.done(function (buttonId) {\n                    if (buttonId === \"ok\") {\n\n                        var $dialog     = dialog.getElement(),\n                            branchName  = $dialog.find(\"input[name='branch-name']\").val().trim(),\n                            $option     = $dialog.find(\"select[name='branch-origin']\").children(\"option:selected\"),\n                            originName  = $option.val(),\n                            isRemote    = $option.attr(\"remote\"),\n                            track       = !!isRemote;\n\n                        Git.createBranch(branchName, originName, track).catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"createFail\");\n                            throw ErrorHandler.showError(err, Strings.ERROR_CREATE_BRANCH);\n                        }).then(function () {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"create\");\n                            EventEmitter.emit(Events.REFRESH_ALL);\n                        });\n                    }\n                });\n            });\n\n        }).on(\"mouseenter\", \"a\", function () {\n            $(this).addClass(\"selected\");\n        }).on(\"mouseleave\", \"a\", function () {\n            $(this).removeClass(\"selected\");\n        }).on(\"click\", \"a.git-branch-link .trash-icon\", function (e) {\n            e.stopPropagation();\n            closeDropdown();\n            var branchName = $(this).parent().data(\"branch\");\n            Utils.askQuestion(Strings.DELETE_LOCAL_BRANCH,\n                              StringUtils.format(Strings.DELETE_LOCAL_BRANCH_NAME, branchName),\n                              { booleanResponse: true })\n                .then(function (response) {\n                    if (response === true) {\n                        return Git.branchDelete(branchName).catch(function (err) {\n\n                            return Utils.showOutput(err, \"Branch deletion failed\", {\n                                question: \"Do you wish to force branch deletion?\"\n                            }).then(function (response) {\n                                if (response === true) {\n                                    return Git.forceBranchDelete(branchName).then(function (output) {\n                                        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"delete\");\n                                        return Utils.showOutput(output || Strings.GIT_BRANCH_DELETE_SUCCESS);\n                                    }).catch(function (err) {\n                                        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"deleteFail\");\n                                        ErrorHandler.showError(err, Strings.ERROR_BRANCH_DELETE_FORCED);\n                                    });\n                                }\n                            });\n\n                        });\n                    }\n                })\n                .catch(function (err) {\n                    ErrorHandler.showError(err);\n                });\n\n        }).on(\"click\", \".merge-branch\", function (e) {\n            e.stopPropagation();\n            closeDropdown();\n            var fromBranch = $(this).parent().data(\"branch\");\n            doMerge(fromBranch);\n        }).on(\"click\", \"a.git-branch-link\", function (e) {\n\n            e.stopPropagation();\n            closeDropdown();\n            var newBranchName = $(this).data(\"branch\");\n\n            Git.getCurrentBranchName().then(function (oldBranchName) {\n                Git.checkout(newBranchName).then(function () {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"switch\");\n                    return closeNotExistingFiles(oldBranchName, newBranchName);\n                }).catch(function (err) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"switchFail\");\n                    ErrorHandler.showError(err, Strings.ERROR_SWITCHING_BRANCHES);\n                });\n            }).catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'branch', \"switchFail\");\n                ErrorHandler.showError(err, Strings.ERROR_GETTING_CURRENT_BRANCH);\n            });\n\n        });\n    }\n\n    function attachCloseEvents() {\n        $(\"html\").on(\"click\", closeDropdown);\n        $(\"#project-files-container\").on(\"scroll\", closeDropdown);\n        $(\"#titlebar .nav\").on(\"click\", closeDropdown);\n\n        currentEditor = EditorManager.getCurrentFullEditor();\n        if (currentEditor) {\n            currentEditor._codeMirror.on(\"focus\", closeDropdown);\n        }\n\n        // $(window).on(\"keydown\", keydownHook);\n    }\n\n    function detachCloseEvents() {\n        $(\"html\").off(\"click\", closeDropdown);\n        $(\"#project-files-container\").off(\"scroll\", closeDropdown);\n        $(\"#titlebar .nav\").off(\"click\", closeDropdown);\n\n        if (currentEditor) {\n            currentEditor._codeMirror.off(\"focus\", closeDropdown);\n        }\n\n        // $(window).off(\"keydown\", keydownHook);\n\n        $dropdown = null;\n    }\n\n    function toggleDropdown(e) {\n        e.stopPropagation();\n\n        // If the dropdown is already visible, close it\n        if ($dropdown) {\n            closeDropdown();\n            return;\n        }\n\n        Menus.closeAll();\n\n        Git.getBranches().catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GETTING_BRANCH_LIST);\n        }).then(function (branches = []) {\n            branches = branches.reduce(function (arr, branch) {\n                if (!branch.currentBranch && !branch.remote) {\n                    arr.push(branch.name);\n                }\n                return arr;\n            }, []);\n\n            $dropdown = $(renderList(branches));\n            const $toggle = $(\"#git-branch-dropdown-toggle\");\n            // two margins to account for the preceding project dropdown as well\n            const marginLeft = (parseInt($toggle.css(\"margin-left\"), 10) * 2) || 0;\n\n            const toggleOffset = $toggle.offset();\n\n            $dropdown\n                .css({\n                    left: toggleOffset.left - marginLeft + 3,\n                    top: toggleOffset.top + $toggle.outerHeight() - 3\n                })\n                .appendTo($(\"body\"));\n\n            // fix so it doesn't overflow the screen\n            var maxHeight = $dropdown.parent().height(),\n                height = $dropdown.height(),\n                topOffset = $dropdown.position().top;\n            if (height + topOffset >= maxHeight - 10) {\n                $dropdown.css(\"bottom\", \"10px\");\n            }\n\n            PopUpManager.addPopUp($dropdown, detachCloseEvents, true, {closeCurrentPopups: true});\n            PopUpManager.handleSelectionEvents($dropdown, {enableSearchFilter: true});\n            attachCloseEvents();\n            handleEvents();\n        });\n    }\n\n    function _getHeadFilePath() {\n        return Preferences.get(\"currentGitRoot\") + \".git/HEAD\";\n    }\n\n    function addHeadToTheFileIndex() {\n        FileSystem.resolve(_getHeadFilePath(), function (err) {\n            if (err) {\n                ErrorHandler.logError(err, \"Resolving .git/HEAD file failed\");\n                return;\n            }\n        });\n    }\n\n    function checkBranch() {\n        FileSystem.getFileForPath(_getHeadFilePath()).read(function (err, contents) {\n            if (err) {\n                ErrorHandler.showError(err, Strings.ERROR_READING_GIT_HEAD);\n                return;\n            }\n\n            contents = contents.trim();\n\n            var m = contents.match(/^ref:\\s+refs\\/heads\\/(\\S+)/);\n\n            // alternately try to parse the hash\n            if (!m) { m = contents.match(/^([a-f0-9]{40})$/); }\n\n            if (!m) {\n                ErrorHandler.showError(new Error(StringUtils.format(Strings.ERROR_PARSING_BRANCH_NAME, contents)));\n                return;\n            }\n\n            var branchInHead  = m[1],\n                branchInUi    = $gitBranchName.text();\n\n            if (branchInHead !== branchInUi) {\n                refresh();\n            }\n        });\n    }\n\n    function refresh() {\n        if ($gitBranchName.length === 0) { return; }\n\n        // show info that branch is refreshing currently\n        $gitBranchName\n            .text(\"\\u2026\")\n            .parent()\n                .show();\n\n        return Git.getGitRoot().then(function (gitRoot) {\n            var projectRoot             = Utils.getProjectRoot(),\n                isRepositoryRootOrChild = gitRoot && projectRoot.indexOf(gitRoot) === 0;\n\n            $gitBranchName.parent().toggle(isRepositoryRootOrChild);\n\n            if (!isRepositoryRootOrChild) {\n                Preferences.set(\"currentGitRoot\", projectRoot);\n                Preferences.set(\"currentGitSubfolder\", \"\");\n\n                $gitBranchName\n                    .off(\"click\")\n                    .text(\"not a git repo\");\n                Panel.disable(\"not-repo\");\n\n                return;\n            }\n\n            Preferences.set(\"currentGitRoot\", gitRoot);\n            Preferences.set(\"currentGitSubfolder\", projectRoot.substring(gitRoot.length));\n\n            // we are in a .git repo so read the head\n            addHeadToTheFileIndex();\n\n            return Git.getCurrentBranchName().then(function (branchName) {\n\n                Git.getMergeInfo().then(function (mergeInfo) {\n\n                    if (mergeInfo.mergeMode) {\n                        branchName += \"|MERGING\";\n                    }\n\n                    if (mergeInfo.rebaseMode) {\n                        if (mergeInfo.rebaseHead) {\n                            branchName = mergeInfo.rebaseHead;\n                        }\n                        branchName += \"|REBASE\";\n                        if (mergeInfo.rebaseNext && mergeInfo.rebaseLast) {\n                            branchName += \"(\" + mergeInfo.rebaseNext + \"/\" + mergeInfo.rebaseLast + \")\";\n                        }\n                    }\n\n                    EventEmitter.emit(Events.REBASE_MERGE_MODE, mergeInfo.rebaseMode, mergeInfo.mergeMode);\n\n                    var MAX_LEN = 18;\n\n                    const tooltip = StringUtils.format(Strings.ON_BRANCH, branchName);\n                    const html = `<i class=\"fas fa-code-branch\"></i> ${\n                        branchName.length > MAX_LEN ? branchName.substring(0, MAX_LEN) + \"\\u2026\" : branchName\n                    }`;\n                    $gitBranchName\n                        .html(html)\n                        .attr(\"title\", tooltip)\n                        .off(\"click\")\n                        .on(\"click\", toggleDropdown);\n                    Panel.enable();\n\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_READING_GIT_STATE);\n                });\n\n            }).catch(function (ex) {\n                if (ErrorHandler.contains(ex, \"unknown revision\")) {\n                    $gitBranchName\n                        .off(\"click\")\n                        .text(\"no branch\");\n                    Panel.enable();\n                } else {\n                    throw ex;\n                }\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err);\n        });\n    }\n\n    function init() {\n        // Add branch name to project tree\n        const $html = $(`<div id='git-branch-dropdown-toggle' class='btn-alt-quiet'>\n            <span id='git-branch'>\n                <i class=\"fas fa-code-branch\"></i>\n            </span>\n            <span class=\"dropdown-arrow\"></span>\n            </div>`);\n        $html.appendTo($(\"#project-files-header\"));\n        $gitBranchName = $(\"#git-branch\");\n        $html.on(\"click\", function () {\n            $gitBranchName.click();\n            return false;\n        });\n        if(Setup.isExtensionActivated()){\n            refresh();\n            return;\n        }\n        $(\"#git-branch-dropdown-toggle\").addClass(\"forced-inVisible\");\n    }\n\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (file) {\n        if (file.fullPath === _getHeadFilePath()) {\n            checkBranch();\n        }\n    });\n\n    EventEmitter.on(Events.REFRESH_ALL, function () {\n        FileSyncManager.syncOpenDocuments();\n        CommandManager.execute(\"file.refresh\");\n        refresh();\n    });\n\n    EventEmitter.on(Events.BRACKETS_PROJECT_CHANGE, function () {\n        refresh();\n    });\n\n    EventEmitter.on(Events.BRACKETS_PROJECT_REFRESH, function () {\n        refresh();\n    });\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        $(\"#git-branch-dropdown-toggle\").removeClass(\"forced-inVisible\");\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        $(\"#git-branch-dropdown-toggle\").addClass(\"forced-inVisible\");\n    });\n\n    exports.init    = init;\n    exports.refresh = refresh;\n\n});\n\n/*globals logger, fs*/\ndefine(\"src/Cli\", function (require, exports, module) {\n\n    const NodeConnector = brackets.getModule('NodeConnector');\n\n    const ErrorHandler  = require(\"src/ErrorHandler\"),\n        Preferences   = require(\"src/Preferences\"),\n        Events        = require(\"src/Events\"),\n        Utils         = require(\"src/Utils\");\n\n    let gitTimeout        = Preferences.get(\"gitTimeout\") * 1000,\n        nextCliId         = 0,\n        deferredMap       = {};\n\n    Preferences.getExtensionPref().on(\"change\", \"gitTimeout\", ()=>{\n        gitTimeout = Preferences.get(\"gitTimeout\") * 1000;\n    });\n\n    // Constants\n    var MAX_COUNTER_VALUE = 4294967295; // 2^32 - 1\n\n    let gitNodeConnector = NodeConnector.createNodeConnector(\"phcode-git-core\", exports);\n    gitNodeConnector.on(Events.GIT_PROGRESS_EVENT, (_event, evtData) => {\n        const deferred = deferredMap[evtData.cliId];\n        if(!deferred){\n            ErrorHandler.logError(\"Progress sent for a non-existing process(\" + evtData.cliId + \"): \" + evtData);\n            return;\n        }\n        if (!deferred.isResolved && deferred.progressTracker) {\n            deferred.progressTracker.trigger(Events.GIT_PROGRESS_EVENT, evtData.data);\n        }\n    });\n\n    function getNextCliId() {\n        if (nextCliId >= MAX_COUNTER_VALUE) {\n            nextCliId = 0;\n        }\n        return ++nextCliId;\n    }\n\n    function normalizePathForOs(path) {\n        if (brackets.platform === \"win\") {\n            path = path.replace(/\\//g, \"\\\\\");\n        }\n        return path;\n    }\n\n    // this functions prevents sensitive info from going further (like http passwords)\n    function sanitizeOutput(str) {\n        if (typeof str !== \"string\") {\n            if (str != null) { // checks for both null & undefined\n                str = str.toString();\n            } else {\n                str = \"\";\n            }\n        }\n        return str;\n    }\n\n    function logDebug(opts, debugInfo, method, type, out) {\n        if (!logger.loggingOptions.logGit) {\n            return;\n        }\n        var processInfo = [];\n\n        var duration = (new Date()).getTime() - debugInfo.startTime;\n        processInfo.push(duration + \"ms\");\n\n        if (opts.cliId) {\n            processInfo.push(\"ID=\" + opts.cliId);\n        }\n\n        var msg = \"cmd-\" + method + \"-\" + type + \" (\" + processInfo.join(\";\") + \")\";\n        if (out) { msg += \": \\\"\" + out + \"\\\"\"; }\n        Utils.consoleDebug(msg);\n    }\n\n    function cliHandler(method, cmd, args, opts, retry) {\n        const cliPromise = new Promise((resolve, reject)=>{\n            const cliId     = getNextCliId();\n            args = args || [];\n            opts = opts || {};\n            const progressTracker = opts.progressTracker;\n\n            const savedDefer = {resolve, reject, progressTracker};\n            deferredMap[cliId] = savedDefer;\n\n            const watchProgress = !!progressTracker || (args.indexOf(\"--progress\") !== -1);\n            const startTime = (new Date()).getTime();\n\n            // it is possible to set a custom working directory in options\n            // otherwise the current project root is used to execute commands\n            if (!opts.cwd) {\n                opts.cwd = fs.getTauriPlatformPath(Preferences.get(\"currentGitRoot\") || Utils.getProjectRoot());\n            }\n\n            // convert paths like c:/foo/bar to c:\\foo\\bar on windows\n            opts.cwd = normalizePathForOs(opts.cwd);\n\n            // log all cli communication into console when debug mode is on\n            Utils.consoleDebug(\"cmd-\" + method + (watchProgress ? \"-watch\" : \"\") + \": \" +\n                opts.cwd + \" -> \" +\n                cmd + \" \" + args.join(\" \"));\n\n            let resolved      = false,\n                timeoutLength = opts.timeout ? (opts.timeout * 1000) : gitTimeout;\n\n            const domainOpts = {\n                cliId: cliId,\n                watchProgress: watchProgress\n            };\n\n            const debugInfo = {\n                startTime: startTime\n            };\n\n            if (watchProgress && progressTracker) {\n                progressTracker.trigger(Events.GIT_PROGRESS_EVENT,\n                    \"Running command: git \" + args.join(\" \"));\n            }\n\n            gitNodeConnector.execPeer(method, {directory: opts.cwd, command: cmd, args: args, opts: domainOpts})\n                .catch(function (err) {\n                    if (!resolved) {\n                        err = sanitizeOutput(err);\n                        logDebug(domainOpts, debugInfo, method, \"fail\", err);\n                        delete deferredMap[cliId];\n\n                        err = ErrorHandler.toError(err);\n\n                        // spawn ENOENT error\n                        var invalidCwdErr = \"spawn ENOENT\";\n                        if (err.stack && err.stack.indexOf(invalidCwdErr)) {\n                            err.message = err.message.replace(invalidCwdErr, invalidCwdErr + \" (\" + opts.cwd + \")\");\n                            err.stack = err.stack.replace(invalidCwdErr, invalidCwdErr + \" (\" + opts.cwd + \")\");\n                        }\n\n                        // socket was closed so we should try this once again (if not already retrying)\n                        if (err.stack && err.stack.indexOf(\"WebSocket.self._ws.onclose\") !== -1 && !retry) {\n                            cliHandler(method, cmd, args, opts, true)\n                                .then(function (response) {\n                                    savedDefer.isResolved = true;\n                                    resolve(response);\n                                })\n                                .catch(function (err) {\n                                    reject(err);\n                                });\n                            return;\n                        }\n\n                        reject(err);\n                    }\n                })\n                .then(function (out) {\n                    if (!resolved) {\n                        out = sanitizeOutput(out);\n                        logDebug(domainOpts, debugInfo, method, \"out\", out);\n                        delete deferredMap[cliId];\n                        resolve(out);\n                    }\n                })\n                .finally(function () {\n                    progressTracker && progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.${cliId}`);\n                    resolved = true;\n                });\n\n            function timeoutPromise() {\n                logDebug(domainOpts, debugInfo, method, \"timeout\");\n                var err = new Error(\"cmd-\" + method + \"-timeout: \" + cmd + \" \" + args.join(\" \"));\n                if (!opts.timeoutExpected) {\n                    ErrorHandler.logError(err);\n                }\n\n                // process still lives and we need to kill it\n                gitNodeConnector.execPeer(\"kill\", domainOpts.cliId)\n                    .catch(function (err) {\n                        ErrorHandler.logError(err);\n                    });\n\n                delete deferredMap[cliId];\n                reject(ErrorHandler.toError(err));\n                resolved = true;\n                progressTracker && progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.${cliId}`);\n            }\n\n            var lastProgressTime = 0;\n            function timeoutCall() {\n                setTimeout(function () {\n                    if (!resolved) {\n                        if (domainOpts.watchProgress) {\n                            // we are watching the promise progress\n                            // so we should check if the last message was sent in more than timeout time\n                            const currentTime = (new Date()).getTime();\n                            const diff = currentTime - lastProgressTime;\n                            if (diff > timeoutLength) {\n                                Utils.consoleDebug(\"cmd(\" + cliId + \") - last progress message was sent \" + diff + \"ms ago - timeout\");\n                                timeoutPromise();\n                            } else {\n                                Utils.consoleDebug(\"cmd(\" + cliId + \") - last progress message was sent \" + diff + \"ms ago - delay\");\n                                timeoutCall();\n                            }\n                        } else {\n                            // we don't have any custom handler, so just kill the promise here\n                            // note that command WILL keep running in the background\n                            // so even when timeout occurs, operation might finish after it\n                            timeoutPromise();\n                        }\n                    }\n                }, timeoutLength);\n            }\n\n            // when opts.timeout === false then never timeout the process\n            if (opts.timeout !== false) {\n                // if we are watching for progress events, mark the time when last progress was made\n                if (domainOpts.watchProgress && progressTracker) {\n                    progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.${cliId}`);\n                    progressTracker.on(`${Events.GIT_PROGRESS_EVENT}.${cliId}`, function () {\n                        lastProgressTime = (new Date()).getTime();\n                    });\n                }\n                // call the method which will timeout the promise after a certain period of time\n                timeoutCall();\n            }\n        });\n        return cliPromise;\n    }\n\n    function which(cmd) {\n        return cliHandler(\"which\", cmd);\n    }\n\n    function spawnCommand(cmd, args, opts) {\n        return cliHandler(\"spawn\", cmd, args, opts);\n    }\n\n    // Public API\n    exports.cliHandler      = cliHandler;\n    exports.which           = which;\n    exports.spawnCommand    = spawnCommand;\n});\n\n/*jslint plusplus: true, vars: true, nomen: true */\n/*global $, brackets, define */\n\ndefine(\"src/CloseNotModified\", function (require, exports) {\n\n    const DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        Commands        = brackets.getModule(\"command/Commands\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        Strings         = brackets.getModule(\"strings\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\");\n\n    const Events      = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        Git           = require(\"src/git/Git\"),\n        Preferences   = require(\"src/Preferences\"),\n        Constants     = require(\"src/Constants\"),\n        Utils         = require(\"src/Utils\");\n\n    let closeUnmodifiedCmd;\n\n    function handleCloseNotModified() {\n        Git.status().then(function (modifiedFiles) {\n            var openFiles      = MainViewManager.getWorkingSet(MainViewManager.ALL_PANES),\n                currentGitRoot = Preferences.get(\"currentGitRoot\");\n\n            openFiles.forEach(function (openFile) {\n                var removeOpenFile = true;\n                modifiedFiles.forEach(function (modifiedFile) {\n                    if (currentGitRoot + modifiedFile.file === openFile.fullPath) {\n                        removeOpenFile = false;\n                    }\n                });\n\n                if (removeOpenFile) {\n                    // check if file doesn't have any unsaved changes\n                    const doc = DocumentManager.getOpenDocumentForPath(openFile.fullPath);\n                    // document will not  be present for images, or if the file is in working set but\n                    // no editor is attached yet(eg. session restore on app start)\n                    if (!doc || !doc.isDirty) {\n                        CommandManager.execute(Commands.FILE_CLOSE_LIST, {PaneId: MainViewManager.ALL_PANES, fileList: [openFile]});\n                    }\n                }\n            });\n\n            MainViewManager.focusActivePane();\n        });\n    }\n\n    function init() {\n        closeUnmodifiedCmd       = CommandManager.register(Strings.CMD_CLOSE_UNMODIFIED,\n            Constants.CMD_GIT_CLOSE_UNMODIFIED, handleCloseNotModified);\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, false);\n    }\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, true);\n    });\n\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, false);\n    });\n\n    // Public API\n    exports.init = init;\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\ndefine(\"src/Constants\", function (require, exports) {\n    const Commands = brackets.getModule(\"command/Commands\"),\n        Menus = brackets.getModule(\"command/Menus\");\n\n    exports.GIT_STRING_UNIVERSAL = \"Git\";\n    exports.GIT_SUB_MENU = Menus.SubMenuIds.GIT_SUB_MENU;\n\n    // Menus\n    exports.GIT_PANEL_CHANGES_CMENU = \"git-panel-changes-cmenu\";\n    exports.GIT_PANEL_HISTORY_CMENU = \"git-panel-history-cmenu\";\n    exports.GIT_PANEL_OPTIONS_CMENU = \"git-panel-options-cmenu\";\n\n    // commands\n    exports.CMD_GIT_INIT = Commands.CMD_GIT_INIT;\n    exports.CMD_GIT_CLONE = Commands.CMD_GIT_CLONE;\n    exports.CMD_GIT_CLONE_WITH_URL = Commands.CMD_GIT_CLONE_WITH_URL;\n    exports.CMD_GIT_SETTINGS_COMMAND_ID = Commands.CMD_GIT_SETTINGS_COMMAND_ID;\n    exports.CMD_GIT_CLOSE_UNMODIFIED = Commands.CMD_GIT_CLOSE_UNMODIFIED;\n    exports.CMD_GIT_CHECKOUT = Commands.CMD_GIT_CHECKOUT;\n    exports.CMD_GIT_RESET_HARD = Commands.CMD_GIT_RESET_HARD;\n    exports.CMD_GIT_RESET_SOFT = Commands.CMD_GIT_RESET_SOFT;\n    exports.CMD_GIT_RESET_MIXED = Commands.CMD_GIT_RESET_MIXED;\n    exports.CMD_GIT_TOGGLE_PANEL = Commands.CMD_GIT_TOGGLE_PANEL;\n    exports.CMD_GIT_GOTO_NEXT_CHANGE = Commands.CMD_GIT_GOTO_NEXT_CHANGE;\n    exports.CMD_GIT_GOTO_PREVIOUS_CHANGE = Commands.CMD_GIT_GOTO_PREVIOUS_CHANGE;\n    exports.CMD_GIT_COMMIT_CURRENT = Commands.CMD_GIT_COMMIT_CURRENT;\n    exports.CMD_GIT_COMMIT_ALL = Commands.CMD_GIT_COMMIT_ALL;\n    exports.CMD_GIT_FETCH = Commands.CMD_GIT_FETCH;\n    exports.CMD_GIT_PULL = Commands.CMD_GIT_PULL;\n    exports.CMD_GIT_PUSH = Commands.CMD_GIT_PUSH;\n    exports.CMD_GIT_REFRESH = Commands.CMD_GIT_REFRESH;\n    exports.CMD_GIT_TAG = Commands.CMD_GIT_TAG;\n    exports.CMD_GIT_DISCARD_ALL_CHANGES = Commands.CMD_GIT_DISCARD_ALL_CHANGES;\n    exports.CMD_GIT_UNDO_LAST_COMMIT = Commands.CMD_GIT_UNDO_LAST_COMMIT;\n    exports.CMD_GIT_CHANGE_USERNAME = Commands.CMD_GIT_CHANGE_USERNAME;\n    exports.CMD_GIT_CHANGE_EMAIL = Commands.CMD_GIT_CHANGE_EMAIL;\n    exports.CMD_GIT_GERRIT_PUSH_REF = Commands.CMD_GIT_GERRIT_PUSH_REF;\n    exports.CMD_GIT_AUTHORS_OF_SELECTION = Commands.CMD_GIT_AUTHORS_OF_SELECTION;\n    exports.CMD_GIT_AUTHORS_OF_FILE = Commands.CMD_GIT_AUTHORS_OF_FILE;\n    exports.CMD_GIT_TOGGLE_UNTRACKED = Commands.CMD_GIT_TOGGLE_UNTRACKED;\n    exports.CMD_GIT_HISTORY_GLOBAL = Commands.CMD_GIT_HISTORY_GLOBAL;\n    exports.CMD_GIT_HISTORY_FILE = Commands.CMD_GIT_HISTORY_FILE;\n});\n\ndefine(\"src/ErrorHandler\", function (require, exports) {\n\n    const Dialogs                    = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache                   = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics                    = brackets.getModule(\"utils/Metrics\"),\n        Strings                    = brackets.getModule(\"strings\"),\n        NotificationUI             = brackets.getModule(\"widgets/NotificationUI\"),\n        Utils                      = require(\"src/Utils\"),\n        errorDialogTemplate        = `<div id=\"git-error-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.BRACKETS_GIT_ERROR}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <h3>{{title}}</h3>\n        <pre>{{body}}</pre>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\"  class=\"primary dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n    </div>\n</div>\n`;\n\n    function errorToString(err) {\n        return Utils.encodeSensitiveInformation(err.toString());\n    }\n\n    exports.isTimeout = function (err) {\n        return err instanceof Error && (\n            err.message.indexOf(\"cmd-execute-timeout\") === 0 ||\n            err.message.indexOf(\"cmd-spawn-timeout\") === 0\n        );\n    };\n\n    exports.equals = function (err, what) {\n        return err.toString().toLowerCase() === what.toLowerCase();\n    };\n\n    exports.contains = function (err, what) {\n        return err.toString().toLowerCase().indexOf(what.toLowerCase()) !== -1;\n    };\n\n    exports.matches = function (err, regExp) {\n        return err.toString().match(regExp);\n    };\n\n    exports.logError = function (err) {\n        const msg = err && err.stack ? err.stack : err;\n        Utils.consoleError(\"[brackets-git] \" + msg);\n        return err;\n    };\n\n    /**\n     *\n     * @param err\n     * @param title\n     * @param {dontStripError: boolean, errorMetric: string, useNotification: boolean} options\n     */\n    exports.showError = function (err, title, options = {}) {\n        const dontStripError = options.dontStripError;\n        const errorMetric = options.errorMetric;\n        if (err.__shown) { return err; }\n\n        exports.logError(err);\n\n        let errorBody,\n            errorStack;\n\n        if (typeof err === \"string\") {\n            errorBody = err;\n        } else if (err instanceof Error) {\n            errorBody = dontStripError ? err.toString() : errorToString(err);\n            errorStack = err.stack || \"\";\n        }\n\n        if (!errorBody || errorBody === \"[object Object]\") {\n            try {\n                errorBody = JSON.stringify(err, null, 4);\n            } catch (e) {\n                errorBody = \"Error can't be stringified by JSON.stringify\";\n            }\n        }\n        errorBody = window.debugMode ? `${errorBody}\\n${errorStack}` : errorBody;\n\n        if(options.useNotification){\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'notifyErr', errorMetric || \"Show\");\n            NotificationUI.createToastFromTemplate(title,\n                `<textarea readonly style=\"width: 200px; height: 200px; cursor: text; resize: none;\">${errorBody}</textarea>`, {\n                    toastStyle: NotificationUI.NOTIFICATION_STYLES_CSS_CLASS.ERROR,\n                    dismissOnClick: false,\n                    instantOpen: true\n                });\n        } else {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'dialogErr', errorMetric || \"Show\");\n            const compiledTemplate = Mustache.render(errorDialogTemplate, {\n                title: title,\n                body: errorBody,\n                Strings: Strings\n            });\n\n            Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n        }\n\n        if (typeof err === \"string\") { err = new Error(err); }\n        err.__shown = true;\n        return err;\n    };\n\n    exports.toError = function (arg) {\n        // FUTURE: use this everywhere and have a custom error class for this extension\n        if (arg instanceof Error) { return arg; }\n        var err = new Error(arg);\n        // TODO: new class for this?\n        err.match = function () {\n            return arg.match.apply(arg, arguments);\n        };\n        return err;\n    };\n\n});\n\ndefine(\"src/EventEmitter\", function (require, exports, module) {\n    const EventDispatcher = brackets.getModule(\"utils/EventDispatcher\"),\n        Metrics = brackets.getModule(\"utils/Metrics\");\n\n    const emInstance = {};\n    EventDispatcher.makeEventDispatcher(emInstance);\n\n    function getEmitter(eventName, optionalMetricToLog) {\n        if (!eventName) {\n            throw new Error(\"no event has been passed to get the emittor!\");\n        }\n        return function () {\n            emit(eventName, ...arguments);\n            if(optionalMetricToLog) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, optionalMetricToLog[0], optionalMetricToLog[1]);\n            }\n        };\n    }\n\n    function emit() {\n        emInstance.trigger(...arguments);\n    }\n\n    function on(eventName, callback) {\n        emInstance.on(eventName, (...args)=>{\n            // Extract everything except the first argument (_event) which is event data we don't use\n            const [, ...rest] = args;\n            callback(...rest);\n        });\n    }\n\n    function one(eventName, callback) {\n        emInstance.one(eventName, (...args)=>{\n            // Extract everything except the first argument (_event) which is event data we don't use\n            const [, ...rest] = args;\n            callback(...rest);\n        });\n    }\n\n    exports.getEmitter = getEmitter;\n    exports.emit = emit;\n    exports.on = on;\n    exports.one = one;\n});\n\ndefine(\"src/Events\", function (require, exports) {\n\n    /**\n     * List of Events to be used in the extension.\n     * Events should be structured by file who emits them.\n     */\n\n    // Brackets events\n    exports.BRACKETS_CURRENT_DOCUMENT_CHANGE = \"brackets_current_document_change\";\n    exports.BRACKETS_PROJECT_CHANGE = \"brackets_project_change\";\n    exports.BRACKETS_PROJECT_REFRESH = \"brackets_project_refresh\";\n    exports.BRACKETS_DOCUMENT_SAVED = \"brackets_document_saved\";\n    exports.BRACKETS_FILE_CHANGED = \"brackets_file_changed\";\n\n    // Git events\n    exports.GIT_PROGRESS_EVENT = \"git_progress\";\n    exports.GIT_USERNAME_CHANGED = \"git_username_changed\";\n    exports.GIT_EMAIL_CHANGED = \"git_email_changed\";\n    exports.GIT_COMMITED = \"git_commited\";\n    exports.GIT_NO_BRANCH_EXISTS = \"git_no_branch_exists\";\n    exports.GIT_CHANGE_USERNAME = \"git_change_username\";\n    exports.GIT_CHANGE_EMAIL = \"git_change_email\";\n\n    // Gerrit events\n    exports.GERRIT_TOGGLE_PUSH_REF = \"gerrit_toggle_push_ref\";\n    exports.GERRIT_PUSH_REF_TOGGLED = \"gerrit_push_ref_toggled\";\n\n    // Startup events\n    exports.REFRESH_ALL = \"git_refresh_all\";\n    exports.GIT_ENABLED = \"git_enabled\";\n    exports.GIT_DISABLED = \"git_disabled\";\n    exports.REBASE_MERGE_MODE = \"rebase_merge_mode\";\n\n    // Panel.js\n    exports.HANDLE_GIT_INIT = \"handle_git_init\";\n    exports.HANDLE_GIT_CLONE = \"handle_git_clone\";\n    exports.HANDLE_GIT_COMMIT = \"handle_git_commit\";\n    exports.HANDLE_FETCH = \"handle_fetch\";\n    exports.HANDLE_PUSH = \"handle_push\";\n    exports.HANDLE_PULL = \"handle_pull\";\n    exports.HANDLE_REMOTE_PICK = \"handle_remote_pick\";\n    exports.HANDLE_REMOTE_DELETE = \"handle_remote_delete\";\n    exports.HANDLE_REMOTE_CREATE = \"handle_remote_create\";\n    exports.HANDLE_FTP_PUSH = \"handle_ftp_push\";\n    exports.HISTORY_SHOW_FILE = \"history_showFile\";\n    exports.HISTORY_SHOW_GLOBAL = \"history_showGlobal\";\n    exports.REFRESH_COUNTERS = \"refresh_counters\";\n    exports.REFRESH_HISTORY = \"refresh_history\";\n\n    // Git results\n    exports.GIT_STATUS_RESULTS = \"git_status_results\";\n\n    // Remotes.js\n    exports.GIT_REMOTE_AVAILABLE = \"git_remote_available\";\n    exports.GIT_REMOTE_NOT_AVAILABLE = \"git_remote_not_available\";\n    exports.REMOTES_REFRESH_PICKER = \"remotes_refresh_picker\";\n    exports.FETCH_STARTED = \"remotes_fetch_started\";\n    exports.FETCH_COMPLETE = \"remotes_fetch_complete\";\n});\n\n/*jslint plusplus: true, vars: true, nomen: true */\n/*global define */\n\ndefine(\"src/ExpectedError\", function (require, exports, module) {\n\n    function ExpectedError() {\n        Error.apply(this, arguments);\n        this.message = arguments[0];\n    }\n    ExpectedError.prototype = new Error();\n    ExpectedError.prototype.name = \"ExpectedError\";\n    ExpectedError.prototype.toString = function () {\n        return this.message;\n    };\n\n    module.exports = ExpectedError;\n});\n\n// this file was composed with a big help from @MiguelCastillo extension Brackets-InteractiveLinter\n// @see https://github.com/MiguelCastillo/Brackets-InteractiveLinter\n\ndefine(\"src/GutterManager\", function (require, exports) {\n\n    // Brackets modules\n    var _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        EditorManager   = brackets.getModule(\"editor/EditorManager\"),\n        ScrollTrackMarkers  = brackets.getModule(\"search/ScrollTrackMarkers\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\"),\n        ErrorHandler    = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"./Preferences\"),\n        Strings             = brackets.getModule(\"strings\");\n\n    const GIT_SCROLL_MARKS = \"git_marks\";\n\n    var gitAvailable = false,\n        gutterName = \"brackets-git-gutter\",\n        editorsWithGutters = [],\n        openWidgets = [];\n\n    /**\n     * Checks if there's already a gutter marker on the given line;\n     * if not, inserts a blank <div> to prevent an empty gutter spot.\n     */\n    function _addDummyGutterMarkerIfNotExist(cm, line) {\n        var lineInfo = cm.lineInfo(line);\n        if (!lineInfo) {\n            return; // If line is out of range or doc is empty\n        }\n        var gutters = cm.getOption(\"gutters\").slice(0),\n            gutterEnabled = gutters.indexOf(gutterName);\n        if(gutterEnabled === -1){\n            return;\n        }\n        var gutterMarkers = lineInfo.gutterMarkers;\n        var existingMarker = gutterMarkers && gutterMarkers[gutterName];\n        if (!existingMarker) {\n            var dummy = document.createElement(\"div\");\n            dummy.className = \"CodeMirror-gitGutter-none\";\n            cm.setGutterMarker(line, gutterName, dummy);\n        }\n    }\n\n    function _cursorActivity(_evt, editor){\n        // this is to prevent a gutter gap in the active line if there is no color on this line.\n        if (editor.hasSelection()){\n            // we dont show the gutter gap color when there is a selection. also adding dummy gutter is expensive\n            // and make test selection with cursor choppy\n            return;\n        }\n        _addDummyGutterMarkerIfNotExist(editor._codeMirror, editor.getCursorPos().line);\n    }\n\n    EditorManager.on(\"activeEditorChange\", function (event, newEditor, oldEditor) {\n        if(newEditor){\n            newEditor.off(\"cursorActivity.gitGutter\");\n            newEditor.on(\"cursorActivity.gitGutter\", _cursorActivity);\n            _cursorActivity(null, newEditor);\n        }\n        if(oldEditor){\n            oldEditor.off(\"cursorActivity.gitGutter\");\n        }\n    });\n\n    function clearWidgets() {\n        var lines = openWidgets.map(function (mark) {\n            var w = mark.lineWidget;\n            if (w.visible) {\n                w.visible = false;\n                w.widget.clear();\n            }\n            return {\n                cm: mark.cm,\n                line: mark.line\n            };\n        });\n        openWidgets = [];\n        return lines;\n    }\n\n    function clearOld(editor) {\n        var cm = editor._codeMirror;\n        if (!cm) { return; }\n\n        var gutters = cm.getOption(\"gutters\").slice(0),\n            io = gutters.indexOf(gutterName);\n\n        if (io !== -1) {\n            gutters.splice(io, 1);\n            cm.clearGutter(gutterName);\n            cm.setOption(\"gutters\", gutters);\n            cm.off(\"gutterClick\", gutterClick);\n        }\n\n        delete cm.gitGutters;\n\n        clearWidgets();\n    }\n\n    function prepareGutter(editor) {\n        // add our gutter if its not already available\n        var cm = editor._codeMirror;\n\n        var gutters = cm.getOption(\"gutters\").slice(0);\n        if (gutters.indexOf(gutterName) === -1) {\n            gutters.unshift(gutterName);\n            cm.setOption(\"gutters\", gutters);\n            cm.on(\"gutterClick\", gutterClick);\n        }\n\n        if (editorsWithGutters.indexOf(editor) === -1) {\n            editorsWithGutters.push(editor);\n        }\n    }\n\n    function prepareGutters(editors) {\n        editors.forEach(function (editor) {\n            prepareGutter(editor);\n        });\n        // clear the rest\n        var idx = editorsWithGutters.length;\n        while (idx--) {\n            if (editors.indexOf(editorsWithGutters[idx]) === -1) {\n                clearOld(editorsWithGutters[idx]);\n                editorsWithGutters.splice(idx, 1);\n            }\n        }\n    }\n\n    function _showGutters(editor, _results) {\n        prepareGutter(editor);\n\n        var cm = editor._codeMirror;\n        cm.gitGutters = _.sortBy(_results, \"line\");\n\n        // get line numbers of currently opened widgets\n        var openBefore = clearWidgets();\n\n        cm.clearGutter(gutterName);\n        cm.gitGutters.forEach(function (obj) {\n            var $marker = $(\"<div>\")\n                .addClass(gutterName + \"-\" + obj.type + \" gitline-\" + (obj.line + 1))\n                .html(\"&nbsp;\");\n            cm.setGutterMarker(obj.line, gutterName, $marker[0]);\n        });\n        _cursorActivity(null, editor);\n        // reopen widgets that were opened before refresh\n        openBefore.forEach(function (obj) {\n            gutterClick(obj.cm, obj.line, gutterName);\n        });\n    }\n\n    function gutterClick(cm, lineIndex, gutterId) {\n        if (!cm) {\n            return;\n        }\n\n        if (gutterId !== gutterName && gutterId !== \"CodeMirror-linenumbers\") {\n            return;\n        }\n\n        var mark = _.find(cm.gitGutters, function (o) { return o.line === lineIndex; });\n        if (!mark || mark.type === \"added\") { return; }\n\n        // we need to be able to identify cm instance from any mark\n        mark.cm = cm;\n\n        if (mark.parentMark) { mark = mark.parentMark; }\n\n        if (!mark.lineWidget) {\n            mark.lineWidget = {\n                visible: false,\n                element: $(\"<div class='\" + gutterName + \"-deleted-lines'></div>\")\n            };\n            var $btn = $(\"<button/>\")\n                .addClass(\"brackets-git-gutter-copy-button\")\n                .text(\"R\")\n                .on(\"click\", function () {\n                    var doc = DocumentManager.getCurrentDocument();\n                    doc.replaceRange(mark.content + \"\\n\", {\n                        line: mark.line,\n                        ch: 0\n                    });\n                    CommandManager.execute(\"file.save\");\n                    refresh();\n                });\n            $(\"<pre/>\")\n                .attr(\"style\", \"tab-size:\" + cm.getOption(\"tabSize\"))\n                .text(mark.content || \" \")\n                .append($btn)\n                .appendTo(mark.lineWidget.element);\n        }\n\n        if (mark.lineWidget.visible !== true) {\n            mark.lineWidget.visible = true;\n            mark.lineWidget.widget = cm.addLineWidget(mark.line, mark.lineWidget.element[0], {\n                coverGutter: false,\n                noHScroll: false,\n                above: true,\n                showIfHidden: false\n            });\n            openWidgets.push(mark);\n        } else {\n            mark.lineWidget.visible = false;\n            mark.lineWidget.widget.clear();\n            var io = openWidgets.indexOf(mark);\n            if (io !== -1) {\n                openWidgets.splice(io, 1);\n            }\n        }\n    }\n\n    function getEditorFromPane(paneId) {\n        var currentPath = MainViewManager.getCurrentlyViewedPath(paneId),\n            doc = currentPath && DocumentManager.getOpenDocumentForPath(currentPath);\n        return doc && doc._masterEditor;\n    }\n\n    function hasVerticalScrollbar(editor) {\n        const cm = editor._codeMirror;\n        const scrollEl = cm.getScrollerElement();\n        return scrollEl.scrollHeight > scrollEl.clientHeight;\n    }\n\n\n    function _markScrollbar(editor, allChanges) {\n        ScrollTrackMarkers.clear(editor, GIT_SCROLL_MARKS);\n        if(!hasVerticalScrollbar(editor)){\n            return;\n        }\n        const added = allChanges\n            .filter(item => item.type === \"added\")\n            .map(({ line }) => ({ line, ch: 0 }));\n\n        const removed = allChanges\n            .filter(item => item.type === \"removed\")\n            .map(({ line }) => ({ line, ch: 0 }));\n\n        const modified = allChanges\n            .filter(item => item.type === \"modified\")\n            .map(({ line }) => ({ line, ch: 0 }));\n\n        const trackers = [\n            {arr: added, css: \"brackets-git-added\"},\n            {arr: removed, css: \"brackets-git-removed\"},\n            {arr: modified, css: \"brackets-git-modified\"}\n        ];\n        for(let tracker of trackers) {\n            if( !tracker.arr.length ){\n                continue;\n            }\n            let posArray = tracker.arr.map(item => ({ line: item.line, ch: 0 }));\n            ScrollTrackMarkers.addTickmarks(editor, posArray, {\n                trackStyle: ScrollTrackMarkers.TRACK_STYLES.ON_LEFT,\n                name: GIT_SCROLL_MARKS,\n                cssColorClass: tracker.css\n            });\n        }\n    }\n\n    function processDiffResults(editor, diff) {\n        var added = [],\n            removed = [],\n            modified = [],\n            changesets = diff.split(/\\n@@/).map(function (str) { return \"@@\" + str; });\n\n        // remove part before first\n        changesets.shift();\n\n        changesets.forEach(function (str) {\n            var m = str.match(/^@@ -([,0-9]+) \\+([,0-9]+) @@/);\n            var s1 = m[1].split(\",\");\n            var s2 = m[2].split(\",\");\n\n            // removed stuff\n            var lineRemovedFrom;\n            var lineFrom = parseInt(s2[0], 10);\n            var lineCount = parseInt(s1[1], 10);\n            if (isNaN(lineCount)) { lineCount = 1; }\n            if (lineCount > 0) {\n                lineRemovedFrom = lineFrom - 1;\n                removed.push({\n                    type: \"removed\",\n                    line: lineRemovedFrom,\n                    content: str.split(\"\\n\")\n                        .filter(function (l) { return l.indexOf(\"-\") === 0; })\n                        .map(function (l) { return l.substring(1); })\n                        .join(\"\\n\")\n                });\n            }\n\n            // added stuff\n            lineFrom = parseInt(s2[0], 10);\n            lineCount = parseInt(s2[1], 10);\n            if (isNaN(lineCount)) { lineCount = 1; }\n            var isModifiedMark = false;\n            var firstAddedMark = false;\n            for (var i = lineFrom, lineTo = lineFrom + lineCount; i < lineTo; i++) {\n                var lineNo = i - 1;\n                if (lineNo === lineRemovedFrom) {\n                    // modified\n                    var o = removed.pop();\n                    o.type = \"modified\";\n                    modified.push(o);\n                    isModifiedMark = o;\n                } else {\n                    var mark = {\n                        type: isModifiedMark ? \"modified\" : \"added\",\n                        line: lineNo,\n                        parentMark: isModifiedMark || firstAddedMark || null\n                    };\n                    if (!isModifiedMark && !firstAddedMark) {\n                        firstAddedMark = mark;\n                    }\n                    // added new\n                    added.push(mark);\n                }\n            }\n        });\n\n        // fix displaying of removed lines\n        removed.forEach(function (o) {\n            o.line = o.line + 1;\n        });\n\n        const allChanges = [].concat(added, removed, modified);\n        _showGutters(editor, allChanges);\n        _markScrollbar(editor, allChanges);\n    }\n\n    function refresh() {\n        if (!gitAvailable) {\n            return;\n        }\n\n        if (!Preferences.get(\"useGitGutter\")) {\n            return;\n        }\n\n        var currentGitRoot = Preferences.get(\"currentGitRoot\");\n\n        // we get a list of editors, which need to be refreshed\n        var editors = _.compact(_.map(MainViewManager.getPaneIdList(), function (paneId) {\n            return getEditorFromPane(paneId);\n        }));\n\n        // we create empty gutters in all of these editors, all other editors lose their gutters\n        prepareGutters(editors);\n\n        // now we launch a diff to fill the gutters in our editors\n        editors.forEach(function (editor) {\n\n            var currentFilePath = null;\n\n            if (editor.document && editor.document.file) {\n                currentFilePath = editor.document.file.fullPath;\n            }\n\n            if (currentFilePath.indexOf(currentGitRoot) !== 0) {\n                // file is not in the current project\n                return;\n            }\n\n            var filename = currentFilePath.substring(currentGitRoot.length);\n\n            Git.diffFile(filename).then(function (diff) {\n                processDiffResults(editor, diff);\n            }).catch(function (err) {\n                // if this is launched in a non-git repository, just ignore\n                if (ErrorHandler.contains(err, \"Not a git repository\")) {\n                    return;\n                }\n                // if this file was moved or deleted before this command could be executed, ignore\n                if (ErrorHandler.contains(err, \"No such file or directory\")) {\n                    return;\n                }\n                ErrorHandler.showError(err, Strings.ERROR_REFRESH_GUTTER);\n            });\n\n        });\n    }\n\n    function goToPrev() {\n        var activeEditor = EditorManager.getActiveEditor();\n        if (!activeEditor) { return; }\n\n        var results = activeEditor._codeMirror.gitGutters || [];\n        var searched = _.filter(results, function (i) { return !i.parentMark; });\n\n        var currentPos = activeEditor.getCursorPos();\n        var i = searched.length;\n        while (i--) {\n            if (searched[i].line < currentPos.line) {\n                break;\n            }\n        }\n        if (i > -1) {\n            var goToMark = searched[i];\n            activeEditor.setCursorPos(goToMark.line, currentPos.ch);\n        }\n    }\n\n    function goToNext() {\n        var activeEditor = EditorManager.getActiveEditor();\n        if (!activeEditor) { return; }\n\n        var results = activeEditor._codeMirror.gitGutters || [];\n        var searched = _.filter(results, function (i) { return !i.parentMark; });\n\n        var currentPos = activeEditor.getCursorPos();\n        for (var i = 0, l = searched.length; i < l; i++) {\n            if (searched[i].line > currentPos.line) {\n                break;\n            }\n        }\n        if (i < searched.length) {\n            var goToMark = searched[i];\n            activeEditor.setCursorPos(goToMark.line, currentPos.ch);\n        }\n    }\n\n    // Event handlers\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        gitAvailable = true;\n        refresh();\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        gitAvailable = false;\n        // calling this with an empty array will remove gutters from all editor instances\n        prepareGutters([]);\n    });\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function (file) {\n        // file will be null when switching to an empty pane\n        if (!file) { return; }\n\n        // document change gets launched even when switching panes,\n        // so we check if the file hasn't already got the gutters\n        var alreadyOpened = _.filter(editorsWithGutters, function (editor) {\n            return editor.document.file.fullPath === file.fullPath;\n        }).length > 0;\n\n        if (!alreadyOpened) {\n            // TODO: here we could sent a particular file to be refreshed only\n            refresh();\n        }\n    });\n    EventEmitter.on(Events.GIT_COMMITED, function () {\n        refresh();\n    });\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (file) {\n        var alreadyOpened = _.filter(editorsWithGutters, function (editor) {\n            return editor.document.file.fullPath === file.fullPath;\n        }).length > 0;\n\n        if (alreadyOpened) {\n            // TODO: here we could sent a particular file to be refreshed only\n            refresh();\n        }\n    });\n\n    function init() {\n        const editor = EditorManager.getActiveEditor();\n        if(!editor){\n            return;\n        }\n        editor.off(\"cursorActivity.gitGutter\");\n        editor.on(\"cursorActivity.gitGutter\", _cursorActivity);\n        _cursorActivity(null, editor);\n    }\n\n    // API\n    exports.init = init;\n    exports.goToPrev = goToPrev;\n    exports.goToNext = goToNext;\n});\n\ndefine(\"src/History\", function (require) {\n\n    // Brackets modules\n    var _ = brackets.getModule(\"thirdparty/lodash\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileUtils = brackets.getModule(\"file/FileUtils\"),\n        LocalizationUtils = brackets.getModule(\"utils/LocalizationUtils\"),\n        Strings = brackets.getModule(\"strings\"),\n        Metrics = brackets.getModule(\"utils/Metrics\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const ErrorHandler = require(\"src/ErrorHandler\"),\n        Events = require(\"src/Events\"),\n        EventEmitter = require(\"src/EventEmitter\"),\n        Git = require(\"src/git/Git\"),\n        HistoryViewer = require(\"src/HistoryViewer\"),\n        Preferences = require(\"src/Preferences\");\n\n    // Templates\n    var gitPanelHistoryTemplate = `<table id=\"git-history-list\" class=\"bottom-panel-table table table-striped table-condensed row-highlight\">\n    <tbody>\n        {{> commits}}\n    </tbody>\n</table>\n`,\n        gitPanelHistoryCommitsTemplate = `{{#commits}}\n<tr class=\"history-commit\" x-hash=\"{{hash}}\">\n    <td>\n        <div class=\"commit-author-avatar\">\n            <span style=\"{{cssAvatar}}\">{{avatarLetter}}</span>\n        </div>\n    </td>\n    <td><span title=\"{{date.title}}\">{{date.shown}}</span> {{Strings.HISTORY_COMMIT_BY}} <span class=\"commit-author\">{{author}}</span></td>\n    <td class=\"commit-title\"><span class=\"commit-subject\">{{subject}} </span>{{#hasTag}}<span class=\"commit-tags\" title=\"{{tags}}\"><i class=\"octicon octicon-tag\"></i>{{tags}}</span>{{/hasTag}}</td>\n    <td>{{hashShort}}</td>\n</tr>\n{{/commits}}\n`;\n\n    // Module variables\n    let $gitPanel         = $(null),\n        $tableContainer   = $(null),\n        $historyList      = $(null),\n        commitCache       = [],\n        lastDocumentSeen  = null;\n\n    // Implementation\n\n    function initVariables() {\n        $gitPanel = $(\"#git-panel\");\n        $tableContainer = $gitPanel.find(\".table-container\");\n        attachHandlers();\n    }\n\n    function attachHandlers() {\n        $tableContainer\n            .off(\".history\")\n            .on(\"scroll.history\", function () {\n                loadMoreHistory();\n            })\n            .on(\"click.history\", \".history-commit\", function () {\n                const $tr = $(this);\n                var hash = $tr.attr(\"x-hash\");\n                var commit = _.find(commitCache, function (commit) { return commit.hash === hash; });\n                const historyShown = HistoryViewer.toggle(commit, getCurrentDocument(), {\n                    isInitial: $(this).attr(\"x-initial-commit\") === \"true\"\n                });\n                $tr.parent().find(\"tr.selected\").removeClass(\"selected\");\n                if(historyShown){\n                    $tr.addClass(\"selected\");\n                }\n            });\n    }\n\n    var generateCssAvatar = _.memoize(function (author, email) {\n\n        // Original source: http://indiegamr.com/generate-repeatable-random-numbers-in-js/\n        var seededRandom = function (max, min, seed) {\n            max = max || 1;\n            min = min || 0;\n\n            seed = (seed * 9301 + 49297) % 233280;\n            var rnd = seed / 233280.0;\n\n            return min + rnd * (max - min);\n        };\n\n        // Use `seededRandom()` to generate a pseudo-random number [0-16] to pick a color from the list\n        var seedBase = parseInt(author.charCodeAt(3).toString(), email.length),\n            seed = parseInt(email.charCodeAt(seedBase.toString().substring(1, 2)).toString(), 16),\n            colors = [\n                \"#ffb13b\", \"#dd5f7a\", \"#8dd43a\", \"#2f7e2f\", \"#4141b9\", \"#3dafea\", \"#7e3e3e\", \"#f2f26b\",\n                \"#864ba3\", \"#ac8aef\", \"#f2f2ce\", \"#379d9d\", \"#ff6750\", \"#8691a2\", \"#d2fd8d\", \"#88eadf\"\n            ],\n            texts = [\n                \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#333333\",\n                \"#FEFEFE\", \"#FEFEFE\", \"#333333\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#333333\", \"#333333\"\n            ],\n            picked = Math.floor(seededRandom(0, 16, seed));\n\n        return \"background-color: \" + colors[picked] + \"; color: \" + texts[picked];\n\n    }, function (author, email) {\n        // calculate hash for memoize - both are strings so we don't need to convert\n        return author + email;\n    });\n\n    // Render history list the first time\n    function renderHistory(file) {\n        // clear cache\n        commitCache = [];\n\n        return Git.getCurrentBranchName().then(function (branchName) {\n            // Get the history commits of the current branch\n            var p = file ? Git.getFileHistory(file.relative, branchName) : Git.getHistory(branchName);\n            return p.then(function (commits) {\n\n                // calculate some missing stuff like avatars\n                commits = addAdditionalCommitInfo(commits);\n                commitCache = commitCache.concat(commits);\n\n                var templateData = {\n                    commits: commits,\n                    Strings: Strings\n                };\n\n                $tableContainer.append(Mustache.render(gitPanelHistoryTemplate, templateData, {\n                    commits: gitPanelHistoryCommitsTemplate\n                }));\n\n                $historyList = $tableContainer.find(\"#git-history-list\")\n                    .data(\"file\", file ? file.absolute : null)\n                    .data(\"file-relative\", file ? file.relative : null);\n\n                $historyList\n                    .find(\"tr.history-commit:last-child\")\n                    .attr(\"x-initial-commit\", \"true\");\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GET_HISTORY);\n        });\n    }\n\n    // Load more rows in the history list on scroll\n    function loadMoreHistory() {\n        if ($historyList.is(\":visible\")) {\n            if (($tableContainer.prop(\"scrollHeight\") - $tableContainer.scrollTop()) === $tableContainer.height()) {\n                if ($historyList.attr(\"x-finished\") === \"true\") {\n                    return;\n                }\n                return Git.getCurrentBranchName().then(function (branchName) {\n                    var p,\n                        file = $historyList.data(\"file-relative\"),\n                        skipCount = $tableContainer.find(\"tr.history-commit\").length;\n                    if (file) {\n                        p = Git.getFileHistory(file, branchName, skipCount);\n                    } else {\n                        p = Git.getHistory(branchName, skipCount);\n                    }\n                    return p.then(function (commits) {\n                        if (commits.length === 0) {\n                            $historyList.attr(\"x-finished\", \"true\");\n                            // marks initial commit as first\n                            $historyList\n                                .find(\"tr.history-commit:last-child\")\n                                .attr(\"x-initial-commit\", \"true\");\n                            return;\n                        }\n\n                        commits = addAdditionalCommitInfo(commits);\n                        commitCache = commitCache.concat(commits);\n\n                        var templateData = {\n                            commits: commits,\n                            Strings: Strings\n                        };\n                        var commitsHtml = Mustache.render(gitPanelHistoryCommitsTemplate, templateData);\n                        $historyList.children(\"tbody\").append(commitsHtml);\n                    })\n                    .catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_GET_MORE_HISTORY);\n                    });\n                })\n                .catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_GET_CURRENT_BRANCH);\n                });\n            }\n        }\n    }\n\n    function addAdditionalCommitInfo(commits) {\n        _.forEach(commits, function (commit) {\n\n            commit.cssAvatar = generateCssAvatar(commit.author, commit.email);\n            commit.avatarLetter = commit.author.substring(0, 1);\n\n            const dateTime = new Date(commit.date);\n            if (isNaN(dateTime.getTime())) {\n                // we got invalid date, use the original date itself\n                commit.date = {\n                    title: commit.date,\n                    shown: commit.date\n                };\n            } else {\n                commit.date = {\n                    title: LocalizationUtils.getFormattedDateTime(dateTime),\n                    shown: LocalizationUtils.dateTimeFromNowFriendly(dateTime)\n                };\n            }\n            commit.hasTag = !!commit.tags;\n        });\n\n        return commits;\n    }\n\n    function getCurrentDocument() {\n        if (HistoryViewer.isVisible()) {\n            return lastDocumentSeen;\n        }\n        var doc = DocumentManager.getCurrentDocument();\n        if (doc) {\n            lastDocumentSeen = doc;\n        }\n        return doc || lastDocumentSeen;\n    }\n\n    function handleFileChange() {\n        var currentDocument = getCurrentDocument();\n\n        if ($historyList.is(\":visible\") && $historyList.data(\"file\")) {\n            handleToggleHistory(\"FILE\", currentDocument);\n        }\n        $gitPanel.find(\".git-file-history\").prop(\"disabled\", !currentDocument);\n    }\n\n    // Show or hide the history list on click of .history button\n    // newHistoryMode can be \"FILE\", \"GLOBAL\" or \"REFRESH\"\n    function handleToggleHistory(newHistoryMode, newDocument) {\n        // this is here to check that $historyList is still attached to the DOM\n        $historyList = $tableContainer.find(\"#git-history-list\");\n\n        let historyEnabled = $historyList.is(\":visible\"),\n            currentFile = $historyList.data(\"file\") || null,\n            currentHistoryMode = historyEnabled ? (currentFile ? \"FILE\" : \"GLOBAL\") : \"DISABLED\",\n            doc = newDocument ? newDocument : getCurrentDocument(),\n            file;\n\n        // Variables to store scroll positions (only used for REFRESH case)\n        let savedScrollTop, savedScrollLeft, selectedCommitHash;\n        let isRefresh = false;\n        if(newHistoryMode === \"REFRESH\"){\n            newHistoryMode = currentHistoryMode;\n            isRefresh = true;\n            historyEnabled = true;\n            // Save current scroll positions before removing the list\n            if ($historyList.length > 0) {\n                savedScrollTop = $historyList.parent().scrollTop();\n                savedScrollLeft = $historyList.parent().scrollLeft();\n                selectedCommitHash = $historyList.find(\".selected\").attr(\"x-hash\");\n            }\n        } else if (currentHistoryMode !== newHistoryMode) {\n            // we are switching the modes so enable\n            historyEnabled = true;\n        } else if (!newDocument) {\n            // we are not changing the mode and we are not switching to a new document\n            historyEnabled = !historyEnabled;\n        }\n\n        if (historyEnabled && newHistoryMode === \"FILE\") {\n            if (doc) {\n                file = {};\n                file.absolute = doc.file.fullPath;\n                file.relative = FileUtils.getRelativeFilename(Preferences.get(\"currentGitRoot\"), file.absolute);\n            } else {\n                // we want a file history but no file was found\n                historyEnabled = false;\n            }\n        }\n\n        // Render #git-history-list if is not already generated or if the viewed file for file history has changed\n        var isEmpty = $historyList.find(\"tr\").length === 0,\n            fileChanged = currentFile !== (file ? file.absolute : null);\n        if (historyEnabled && (isEmpty || fileChanged || isRefresh)) {\n            if ($historyList.length > 0) {\n                $historyList.remove();\n            }\n            var $spinner = $(\"<div class='spinner spin large'></div>\").appendTo($gitPanel);\n            renderHistory(file).finally(function () {\n                $spinner.remove();\n                if (isRefresh) {\n                    // After rendering, we need to fetch the newly created #git-history-list\n                    let $newHistoryList = $tableContainer.find(\"#git-history-list\");\n                    // Restore the scroll position\n                    $newHistoryList.parent().scrollTop(savedScrollTop || 0);\n                    $newHistoryList.parent().scrollLeft(savedScrollLeft || 0);\n                    $historyList.find(`[x-hash=\"${selectedCommitHash}\"]`).addClass(\"selected\");\n                }\n            });\n        }\n\n        // disable commit button when viewing history\n        // refresh status when history is closed and commit button will correct its disabled state if required\n        if (historyEnabled) {\n            $gitPanel.find(\".git-commit, .check-all\").prop(\"disabled\", true);\n        } else {\n            Git.status();\n        }\n\n        // Toggle visibility of .git-edited-list and #git-history-list\n        $tableContainer.find(\".git-edited-list\").toggle(!historyEnabled);\n        $historyList.toggle(historyEnabled);\n\n        if (!historyEnabled) { HistoryViewer.hide(); }\n\n        // Toggle history button\n        var globalButtonActive  = historyEnabled && newHistoryMode === \"GLOBAL\",\n            fileButtonActive    = historyEnabled && newHistoryMode === \"FILE\";\n        $gitPanel.find(\".git-history-toggle\").toggleClass(\"active\", globalButtonActive)\n            .attr(\"title\", globalButtonActive ? Strings.TOOLTIP_HIDE_HISTORY : Strings.TOOLTIP_SHOW_HISTORY);\n        $gitPanel.find(\".git-file-history\").toggleClass(\"active\", fileButtonActive)\n            .attr(\"title\", fileButtonActive ? Strings.TOOLTIP_HIDE_FILE_HISTORY : Strings.TOOLTIP_SHOW_FILE_HISTORY);\n    }\n\n    // Event listeners\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        initVariables();\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        lastDocumentSeen = null;\n        $historyList.remove();\n        $historyList = $();\n    });\n    EventEmitter.on(Events.HISTORY_SHOW_FILE, function () {\n        handleToggleHistory(\"FILE\");\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"fileHistory\");\n    });\n    EventEmitter.on(Events.HISTORY_SHOW_GLOBAL, function () {\n        handleToggleHistory(\"GLOBAL\");\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"history\");\n    });\n    EventEmitter.on(Events.REFRESH_HISTORY, function () {\n        handleToggleHistory(\"REFRESH\");\n    });\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function () {\n        handleFileChange();\n    });\n\n});\n\ndefine(\"src/HistoryViewer\", function (require, exports) {\n\n    const _             = brackets.getModule(\"thirdparty/lodash\"),\n        LanguageManager = brackets.getModule(\"language/LanguageManager\"),\n        Mustache        = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        WorkspaceManager  = brackets.getModule(\"view/WorkspaceManager\"),\n        Strings           = brackets.getModule(\"strings\"),\n        Metrics         = brackets.getModule(\"utils/Metrics\"),\n        marked          = brackets.getModule('thirdparty/marked.min').marked;\n\n    const ErrorHandler  = require(\"src/ErrorHandler\"),\n        Git           = require(\"src/git/Git\"),\n        Preferences   = require(\"src/Preferences\"),\n        Utils         = require(\"src/Utils\");\n\n    var historyViewerTemplate       = `<div id=\"history-viewer\">\n    <div class=\"header\">\n        <div>\n            <a href=\"#\" class=\"close\">&times;</a>\n        </div>\n        <div class=\"author-line\">\n            <span class=\"commit-author\">\n                <div class=\"commit-author-avatar\">\n                    <span class=\"text\" style=\"{{commit.cssAvatar}}\">{{commit.avatarLetter}}</span>\n                </div>\n                <span class=\"commit-author-name\">{{commit.author}}</span>\n                <span class=\"commit-author-email\">&lt;{{commit.email}}&gt;</span>\n            </span>\n            <span class=\"commit-time\" title=\"{{commit.date.title}}\">\n                <i class=\"octicon octicon-calendar\"></i>&nbsp;\n                <span class=\"selectable-text\">{{commit.date.shown}}</span>\n            </span>\n            <span class=\"commit-hash\" data-hash=\"{{commit.hash}}\">\n                <i class=\"octicon octicon-git-commit\"></i>&nbsp;<span class=\"selectable-text\">{{commit.hashShort}}</span>\n                <a href=\"#\" class=\"git-extend-sha\">&hellip;</a>\n            </span>\n            <div class=\"actions\">\n                <span class=\"toggle-diffs\">\n                    <i class=\"octicon octicon-expand collapse\"></i>\n                    <i class=\"octicon octicon-collapse expand\"></i>\n                    <span class=\"expand\">{{Strings.EXPAND_ALL}}</span>\n                    <span class=\"collapse\">{{Strings.COLLAPSE_ALL}}</span>\n                </span>\n            </div>\n        </div>\n        <div>\n            <h1 class=\"commit-title selectable-text\"><span>{{commit.subject}}</span></h1>\n        </div>\n    </div>\n    <div class=\"body\">\n        <div class=\"commitBody selectable-text\">{{{bodyMarkdown}}}</div>\n        <div class=\"table-striped tab-content\">\n            <div class=\"commit-files\">\n                <ul class=\"nav nav-tabs nav-stacked filesContainer\"></ul>\n                <button class=\"btn loadMore\">\n                    Load more files from this commit\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n`,\n        historyViewerFilesTemplate  = `{{#files}}\n    <li x-file=\"{{file}}\">\n        <a>\n            <i class=\"caret caret-right closed\"></i>\n            <i class=\"caret opened\"></i>\n            {{name}}<span class=\"extension\">{{extension}}</span>\n            <i class=\"octicon octicon-eye openFile\" title=\"{{Strings.VIEW_THIS_FILE}}\"></i>\n            {{#useDifftool}}<i class=\"octicon octicon-diff difftool\" title=\"{{Strings.DIFFTOOL}}\"></i>{{/useDifftool}}\n        </a>\n        <div class=\"commit-diff\"></div>\n    </li>\n{{/files}}\n`;\n\n    let useDifftool            = false,\n        isShown                = false,\n        commit                 = null,\n        currentlyViewedCommit  = null,\n        isInitial              = null,\n        $viewer                = null,\n        $editorHolder          = null;\n\n    var setExpandState = _.debounce(function () {\n        var allFiles = $viewer.find(\".commit-files a\"),\n            activeFiles = allFiles.filter(\".active\"),\n            allExpanded = allFiles.length === activeFiles.length;\n        $viewer.find(\".toggle-diffs\").toggleClass(\"opened\", allExpanded);\n    }, 100);\n\n    var PAGE_SIZE = 25;\n    var currentPage = 0;\n    var hasNextPage = false;\n\n    function toggleDiff($a) {\n        if ($a.hasClass(\"active\")) {\n            // Close the clicked diff\n            $a.removeClass(\"active\");\n            setExpandState();\n            return;\n        }\n\n        // Open the clicked diff\n        $(\".commit-files a.active\").attr(\"scrollPos\", $(\".commit-diff\").scrollTop());\n\n        // If this diff was not previously loaded then load it\n        if (!$a.is(\".loaded\")) {\n            var $li = $a.closest(\"[x-file]\"),\n                relativeFilePath = $li.attr(\"x-file\"),\n                $diffContainer = $li.find(\".commit-diff\");\n\n            Git.getDiffOfFileFromCommit(commit.hash, relativeFilePath, isInitial).then(function (diff) {\n                $diffContainer.html(Utils.formatDiff(diff));\n                $diffContainer.scrollTop($a.attr(\"scrollPos\") || 0);\n\n                $a.addClass(\"active loaded\");\n                setExpandState();\n            }).catch(function (err) {\n                ErrorHandler.showError(err, Strings.ERROR_GET_DIFF_FILE_COMMIT);\n            });\n        } else {\n            // If this diff was previously loaded just open it\n            $a.addClass(\"active\");\n            setExpandState();\n        }\n    }\n\n    function showDiff($el) {\n        var file = $el.closest(\"[x-file]\").attr(\"x-file\");\n        Git.difftoolFromHash(commit.hash, file, isInitial);\n    }\n\n    function expandAll() {\n        $viewer.find(\".commit-files a\").not(\".active\").trigger(\"click\");\n        Preferences.set(\"autoExpandDiffsInHistory\", true);\n    }\n\n    function collapseAll() {\n        $viewer.find(\".commit-files a\").filter(\".active\").trigger(\"click\");\n        Preferences.set(\"autoExpandDiffsInHistory\", false);\n    }\n\n    function attachEvents() {\n        $viewer\n            .on(\"click\", \".commit-files a\", function () {\n                toggleDiff($(this));\n            })\n            .on(\"click\", \".commit-files .difftool\", function (e) {\n                e.stopPropagation();\n                showDiff($(this));\n            })\n            .on(\"click\", \".openFile\", function (e) {\n                e.stopPropagation();\n                var file = $(this).closest(\"[x-file]\").attr(\"x-file\");\n                Utils.openEditorForFile(file, true);\n                hide();\n            })\n            .on(\"click\", \".close\", function () {\n                // Close history viewer\n                remove();\n            })\n            .on(\"click\", \".git-extend-sha\", function () {\n                // Show complete commit SHA\n                var $parent = $(this).parent(),\n                    sha = $parent.data(\"hash\");\n                $parent.find(\"span.selectable-text\").text(sha);\n                $(this).remove();\n            })\n            .on(\"click\", \".toggle-diffs\", expandAll)\n            .on(\"click\", \".toggle-diffs.opened\", collapseAll);\n\n        // Add/Remove shadow on bottom of header\n        $viewer.find(\".body\")\n            .on(\"scroll\", function () {\n                if ($viewer.find(\".body\").scrollTop() > 0) {\n                    $viewer.find(\".header\").addClass(\"shadow\");\n                } else {\n                    $viewer.find(\".header\").removeClass(\"shadow\");\n                }\n            });\n\n        // Expand the diffs when wanted\n        if (Preferences.get(\"autoExpandDiffsInHistory\")) {\n            expandAll();\n        }\n    }\n\n    function renderViewerContent(files, selectedFile) {\n        var bodyMarkdown = marked(commit.body, { gfm: true, breaks: true });\n\n        $viewer.html(Mustache.render(historyViewerTemplate, {\n            commit: commit,\n            bodyMarkdown: bodyMarkdown,\n            Strings: Strings\n        }));\n\n        renderFiles(files);\n\n        if (selectedFile) {\n            var $fileEntry = $viewer.find(\".commit-files li[x-file='\" + selectedFile + \"'] a\").first();\n            if ($fileEntry.length) {\n                toggleDiff($fileEntry);\n                window.setTimeout(function () {\n                    $viewer.find(\".body\").animate({ scrollTop: $fileEntry.position().top - 10 });\n                }, 80);\n            }\n        }\n\n        attachEvents();\n    }\n\n    function renderFiles(files) {\n        $viewer.find(\".filesContainer\").append(Mustache.render(historyViewerFilesTemplate, {\n            files: files,\n            Strings: Strings,\n            useDifftool: useDifftool\n        }));\n\n        // Activate/Deactivate load more button\n        $viewer.find(\".loadMore\")\n            .toggle(hasNextPage)\n            .off(\"click\")\n            .on(\"click\", function () {\n                currentPage++;\n                loadMoreFiles();\n            });\n    }\n\n    function loadMoreFiles() {\n        Git.getFilesFromCommit(commit.hash, isInitial).then(function (files) {\n\n            hasNextPage = files.slice((currentPage + 1) * PAGE_SIZE).length > 0;\n            files = files.slice(currentPage * PAGE_SIZE, (currentPage + 1) * PAGE_SIZE);\n\n            var list = files.map(function (file) {\n                var fileExtension = LanguageManager.getCompoundFileExtension(file),\n                    i = file.lastIndexOf(\".\" + fileExtension),\n                    fileName = file.substring(0, fileExtension && i >= 0 ? i : file.length);\n                return {\n                    name: fileName,\n                    extension: fileExtension ? \".\" + fileExtension : \"\",\n                    file: file\n                };\n            });\n\n            if (currentPage === 0) {\n                var file = $(\"#git-history-list\").data(\"file-relative\");\n                return renderViewerContent(list, file);\n            } else {\n                return renderFiles(list);\n            }\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GET_DIFF_FILES);\n        }).finally(function () {\n            $viewer.removeClass(\"spinner large spin\");\n        });\n    }\n\n    function render() {\n        if ($viewer) {\n            // Reset the viewer listeners\n            $viewer.off(\"click\");\n            $viewer.find(\".body\").off(\"scroll\");\n        } else {\n            // Create the viewer if it doesn't exist\n            $viewer = $(\"<div>\").addClass(\"git spinner large spin\");\n            $viewer.appendTo($editorHolder);\n        }\n\n        currentPage = 0;\n        loadMoreFiles();\n    }\n\n    var initialize = _.once(function () {\n        Git.getConfig(\"diff.tool\").then(function (config) {\n            useDifftool = !!config;\n        });\n    });\n\n    function toggle(commitInfo, doc, options) {\n        const commitHash = commitInfo.hash;\n        if(isShown && commitHash === currentlyViewedCommit) {\n            // the history view already showing the current commit, the user intent is to close\n            remove();\n            return false;\n        }\n        // a new history is to be shown\n        show(commitInfo, doc, options);\n        return true;\n    }\n\n    function show(commitInfo, doc, options) {\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'history', \"detailView\");\n        initialize();\n\n        commit    = commitInfo;\n        isInitial = options.isInitial;\n\n        $editorHolder = $(\"#editor-holder\");\n        render();\n        currentlyViewedCommit = commitInfo.hash;\n        isShown   = true;\n        if ($(\"#first-pane\").length) {\n            const firstPaneStyle =\n                $(\"#first-pane\").prop(\"style\") && $(\"#first-pane\").prop(\"style\").cssText ?\n                    $(\"#first-pane\").prop(\"style\").cssText : \"\";\n            $(\"#first-pane\").prop(\"style\", firstPaneStyle + \";display: none !important;\");\n        }\n\n        if ($(\"#second-pane\").length) {\n            const secondPaneStyle =\n                $(\"#second-pane\").prop(\"style\") && $(\"#second-pane\").prop(\"style\").cssText ?\n                    $(\"#second-pane\").prop(\"style\").cssText : \"\";\n            $(\"#second-pane\").prop(\"style\", secondPaneStyle + \";display: none !important;\");\n        }\n    }\n\n    function onRemove() {\n        isShown = false;\n        $viewer = null;\n        currentlyViewedCommit = null;\n        $(\"#first-pane\").show();\n        $(\"#second-pane\").show();\n        // we need to relayout as when the history overlay is visible over the editor, we\n        // hide the editor with css, and if we resize app while history view is open, the editor wont\n        // be resized. So we relayout on panel close.\n        WorkspaceManager.recomputeLayout();\n        // detach events that were added by this viewer to another element than one added to $editorHolder\n    }\n\n    function hide() {\n        if (isShown) {\n            remove();\n        }\n    }\n\n    function remove() {\n        $viewer.remove();\n        onRemove();\n    }\n\n    function isVisible() {\n        return isShown;\n    }\n\n    // Public API\n    exports.toggle = toggle;\n    exports.show = show;\n    exports.hide = hide;\n    exports.isVisible = isVisible;\n\n});\n\ndefine(\"src/Main\", function (require, exports) {\n\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager    = brackets.getModule(\"command/CommandManager\"),\n        Commands          = brackets.getModule(\"command/Commands\"),\n        Menus             = brackets.getModule(\"command/Menus\"),\n        FileSystem        = brackets.getModule(\"filesystem/FileSystem\"),\n        Mustache          = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics           = brackets.getModule(\"utils/Metrics\"),\n        ProjectManager    = brackets.getModule(\"project/ProjectManager\");\n\n    const Constants       = require(\"src/Constants\"),\n        Events            = require(\"src/Events\"),\n        EventEmitter      = require(\"src/EventEmitter\"),\n        Strings             = brackets.getModule(\"strings\"),\n        StringUtils             = brackets.getModule(\"utils/StringUtils\"),\n        ErrorHandler      = require(\"src/ErrorHandler\"),\n        Panel             = require(\"src/Panel\"),\n        Branch            = require(\"src/Branch\"),\n        SettingsDialog    = require(\"src/SettingsDialog\"),\n        Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        CloseNotModified  = require(\"src/CloseNotModified\"),\n        Setup             = require(\"src/utils/Setup\"),\n        Preferences       = require(\"src/Preferences\"),\n        Utils             = require(\"src/Utils\"),\n        Git               = require(\"src/git/Git\"),\n        gitTagDialogTemplate    = `<div id=\"git-commit-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.TAG_NAME}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <div class=\"commit-message-box\">\n            <input name=\"commit-message\" class=\"commit-message\" type=\"text\" placeholder=\"{{Strings.TAG_NAME_PLACEHOLDER}}\" autocomplete=\"off\"/>\n            <textarea name=\"commit-message\" type=\"text\" placeholder=\"{{Strings.TAG_NAME_PLACEHOLDER}}\" autocomplete=\"off\" style=\"display: none;\"></textarea>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`;\n\n    const CMD_ADD_TO_IGNORE      = \"git.addToIgnore\",\n        CMD_REMOVE_FROM_IGNORE = \"git.removeFromIgnore\",\n        $icon                  = $(`<a id='git-toolbar-icon' title=\"${Strings.STATUSBAR_SHOW_GIT}\" href='#'></a>`)\n            .addClass(\"forced-hidden\")\n            .prependTo($(\".bottom-buttons\"));\n\n    let gitEnabled = false;\n\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        $icon.removeClass(\"dirty\");\n    });\n\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (sortedResults) {\n        $icon.toggleClass(\"dirty\", sortedResults.length !== 0);\n    });\n\n    // This only launches when Git is available\n    function initUi() {\n        // FUTURE: do we really need to launch init from here?\n        Panel.init();\n        Branch.init();\n        CloseNotModified.init();\n        // Attach events\n        $icon.on(\"click\", Panel.toggle);\n    }\n\n    function _addRemoveItemInGitignore(selectedEntry, method) {\n        var gitRoot = Preferences.get(\"currentGitRoot\"),\n            entryPath = \"/\" + selectedEntry.fullPath.substring(gitRoot.length),\n            gitignoreEntry = FileSystem.getFileForPath(gitRoot + \".gitignore\");\n\n        gitignoreEntry.read(function (err, content) {\n            if (err) {\n                Utils.consoleWarn(err);\n                content = \"\";\n            }\n\n            // use trimmed lines only\n            var lines = content.split(\"\\n\").map(function (l) { return l.trim(); });\n            // clean start and end empty lines\n            while (lines.length > 0 && !lines[0]) { lines.shift(); }\n            while (lines.length > 0 && !lines[lines.length - 1]) { lines.pop(); }\n\n            if (method === \"add\") {\n                // add only when not already present\n                if (lines.indexOf(entryPath) === -1) { lines.push(entryPath); }\n            } else if (method === \"remove\") {\n                lines = _.without(lines, entryPath);\n            }\n\n            // always have an empty line at the end of the file\n            if (lines[lines.length - 1]) { lines.push(\"\"); }\n\n            gitignoreEntry.write(lines.join(\"\\n\"), function (err) {\n                if (err) {\n                    return ErrorHandler.showError(err, Strings.ERROR_MODIFY_GITIGNORE);\n                }\n                Panel.refresh();\n            });\n        });\n    }\n\n    function addItemToGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"add\");\n    }\n\n    function removeItemFromGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"remove\");\n    }\n\n    function addItemToGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"add\");\n    }\n\n    function removeItemFromGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"remove\");\n    }\n\n    function _refreshCallback() {\n        EventEmitter.emit(Events.REFRESH_ALL);\n    }\n\n    function checkoutCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git checkout as commit hash is ${commitHash}`);\n            return;\n        }\n        const displayStr = StringUtils.format(Strings.CHECKOUT_COMMIT_DETAIL, commitDetailStr, commitHash);\n        Utils.askQuestion(Strings.TITLE_CHECKOUT,\n            displayStr + \"<br><br>\" + Strings.DIALOG_CHECKOUT,\n            { booleanResponse: true, noescape: true, customOkBtn: Strings.CHECKOUT_COMMIT })\n            .then(function (response) {\n                if (response === true) {\n                    return Git.checkout(commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function tagCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash || \"\";\n        const compiledTemplate = Mustache.render(gitTagDialogTemplate, { Strings }),\n            dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog          = dialog.getElement();\n        $dialog.find(\"input\").focus();\n        $dialog.find(\"button.primary\").on(\"click\", function () {\n            const tagname = $dialog.find(\"input.commit-message\").val();\n            Git.setTagName(tagname, commitHash).then(function () {\n                EventEmitter.emit(Events.REFRESH_HISTORY);\n            }).catch(function (err) {\n                ErrorHandler.showError(err, Strings.ERROR_CREATE_TAG);\n            });\n        });\n    }\n\n    function _resetOperation(operation, commitHash, title, message) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git Reset ${operation} as commit hash is ${commitHash}`);\n            return;\n        }\n        const gitCmdUsed = `git reset ${operation} ${commitHash}`;\n        const displayStr = StringUtils.format(Strings.RESET_DETAIL, commitDetailStr, gitCmdUsed);\n        Utils.askQuestion(title,\n            message + \"<br><br>\" + displayStr,\n            { booleanResponse: true, noescape: true,\n                customOkBtn: Strings.RESET, customOkBtnClass: \"danger\"})\n            .then(function (response) {\n                if (response === true) {\n                    return Git.reset(operation, commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function resetHard(commitHash) {\n        return _resetOperation(\"--hard\", commitHash,\n            Strings.RESET_HARD_TITLE, Strings.RESET_HARD_MESSAGE);\n    }\n\n    function resetMixed(commitHash) {\n        return _resetOperation(\"--mixed\", commitHash,\n            Strings.RESET_MIXED_TITLE, Strings.RESET_MIXED_MESSAGE);\n    }\n\n    function resetSoft(commitHash) {\n        return _resetOperation(\"--soft\", commitHash,\n            Strings.RESET_SOFT_TITLE, Strings.RESET_SOFT_MESSAGE);\n    }\n\n    /**\n     * Disables all Git-related commands that were registered in `initGitMenu`.\n     * After calling this function, none of these menu items will be clickable.\n     */\n    function disableAllMenus() {\n        // Collect all command IDs that were registered in initGitMenu\n        const commandsToDisable = [\n            // File menu items\n            Constants.CMD_GIT_INIT,\n            Constants.CMD_GIT_CLONE,\n            Constants.CMD_GIT_TOGGLE_PANEL,\n            Constants.CMD_GIT_REFRESH,\n            Constants.CMD_GIT_GOTO_NEXT_CHANGE,\n            Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE,\n            Constants.CMD_GIT_CLOSE_UNMODIFIED,\n            Constants.CMD_GIT_AUTHORS_OF_SELECTION,\n            Constants.CMD_GIT_AUTHORS_OF_FILE,\n            Constants.CMD_GIT_COMMIT_CURRENT,\n            Constants.CMD_GIT_COMMIT_ALL,\n            Constants.CMD_GIT_FETCH,\n            Constants.CMD_GIT_PULL,\n            Constants.CMD_GIT_PUSH,\n            Constants.CMD_GIT_GERRIT_PUSH_REF,\n            Constants.CMD_GIT_CHANGE_USERNAME,\n            Constants.CMD_GIT_CHANGE_EMAIL,\n            Constants.CMD_GIT_SETTINGS_COMMAND_ID,\n\n            // Project tree/working files commands\n            CMD_ADD_TO_IGNORE,\n            CMD_REMOVE_FROM_IGNORE,\n            // Panel context menu commands (with \"2\" suffix)\n            CMD_ADD_TO_IGNORE + \"2\",\n            CMD_REMOVE_FROM_IGNORE + \"2\",\n\n            // History context menu commands\n            Constants.CMD_GIT_CHECKOUT,\n            Constants.CMD_GIT_TAG,\n            Constants.CMD_GIT_RESET_HARD,\n            Constants.CMD_GIT_RESET_MIXED,\n            Constants.CMD_GIT_RESET_SOFT,\n\n            // \"More options\" context menu commands\n            Constants.CMD_GIT_DISCARD_ALL_CHANGES,\n            Constants.CMD_GIT_UNDO_LAST_COMMIT,\n            Constants.CMD_GIT_TOGGLE_UNTRACKED,\n\n            Constants.CMD_GIT_HISTORY_GLOBAL,\n            Constants.CMD_GIT_HISTORY_FILE\n        ];\n\n        // Disable each command\n        commandsToDisable.forEach((cmdId) => {\n            Utils.enableCommand(cmdId, false);\n        });\n    }\n\n\n    function initGitMenu() {\n        // Register command and add it to the menu.\n        const fileMenu = Menus.getMenu(Menus.AppMenuBar.FILE_MENU);\n        let gitSubMenu = fileMenu.addSubMenu(Constants.GIT_STRING_UNIVERSAL,\n            Constants.GIT_SUB_MENU, Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        fileMenu.addMenuDivider(Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_INIT, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLONE, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_TOGGLE_PANEL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_REFRESH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_NEXT_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLOSE_UNMODIFIED);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_HISTORY_GLOBAL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_HISTORY_FILE);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_CURRENT);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_ALL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PULL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        // register commands for project tree / working files\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE, addItemToGitingore);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE, removeItemFromGitingore);\n\n        // create context menu for git panel\n        const panelCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_CHANGES_CMENU);\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE + \"2\", addItemToGitingoreFromPanel);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE + \"2\", removeItemFromGitingoreFromPanel);\n        panelCmenu.addMenuItem(CMD_ADD_TO_IGNORE + \"2\");\n        panelCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE + \"2\");\n\n        // create context menu for git history\n        const historyCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_HISTORY_CMENU);\n        CommandManager.register(Strings.CHECKOUT_COMMIT, Constants.CMD_GIT_CHECKOUT, checkoutCommit);\n        CommandManager.register(Strings.MENU_RESET_HARD, Constants.CMD_GIT_RESET_HARD, resetHard);\n        CommandManager.register(Strings.MENU_RESET_MIXED, Constants.CMD_GIT_RESET_MIXED, resetMixed);\n        CommandManager.register(Strings.MENU_RESET_SOFT, Constants.CMD_GIT_RESET_SOFT, resetSoft);\n        CommandManager.register(Strings.MENU_TAG_COMMIT, Constants.CMD_GIT_TAG, tagCommit);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_CHECKOUT);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_TAG);\n        historyCmenu.addMenuDivider();\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_HARD);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_MIXED);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_SOFT);\n\n        // create context menu for git more options\n        const optionsCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_OPTIONS_CMENU);\n        Menus.ContextMenu.assignContextMenuToSelector(\".git-more-options-btn\", optionsCmenu);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_DISCARD_ALL_CHANGES);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_UNDO_LAST_COMMIT);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_HISTORY_GLOBAL);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_HISTORY_FILE);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PULL);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_TOGGLE_UNTRACKED);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        if(!Setup.isExtensionActivated()){\n            disableAllMenus();\n        }\n    }\n\n    function init() {\n        CommandManager.register(Strings.GIT_SETTINGS, Constants.CMD_GIT_SETTINGS_COMMAND_ID, SettingsDialog.show);\n        // Try to get Git version, if succeeds then Git works\n        return Setup.init().then(function (enabled) {\n            initUi();\n            initGitMenu();\n            return enabled;\n        });\n    }\n\n    var _toggleMenuEntriesState = false,\n        _divider1 = null,\n        _divider2 = null;\n    function toggleMenuEntries(bool) {\n        if (bool === _toggleMenuEntriesState) {\n            return;\n        }\n        var projectCmenu = Menus.getContextMenu(Menus.ContextMenuIds.PROJECT_MENU);\n        var workingCmenu = Menus.getContextMenu(Menus.ContextMenuIds.WORKING_SET_CONTEXT_MENU);\n        if (bool) {\n            _divider1 = projectCmenu.addMenuDivider();\n            _divider2 = workingCmenu.addMenuDivider();\n            projectCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n        } else {\n            projectCmenu.removeMenuDivider(_divider1.id);\n            workingCmenu.removeMenuDivider(_divider2.id);\n            projectCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n        }\n        _toggleMenuEntriesState = bool;\n    }\n\n    function _enableAllCommands(enabled) {\n        Utils.enableCommand(Constants.CMD_GIT_REFRESH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_NEXT_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_SELECTION, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_FILE, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_HISTORY_GLOBAL, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_HISTORY_FILE, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_CURRENT, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_ALL, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_FETCH, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PULL, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PUSH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_DISCARD_ALL_CHANGES, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_UNDO_LAST_COMMIT, enabled);\n        toggleMenuEntries(enabled);\n        if(enabled){\n            $icon.removeClass(\"forced-hidden\");\n        } else if(!$(\"#git-panel\").is(\":visible\")){\n            $icon.addClass(\"forced-hidden\");\n        }\n    }\n\n    let isCommandExecuting = false;\n    let scheduledRefresh = null;\n    const REFRESH_DEDUPE_TIME = 3000;\n\n    function refreshOnFocusChange() {\n        // to sync external git changes after switching to app.\n        if (gitEnabled) {\n            const isGitPanelVisible = Panel.getPanel().is(\":visible\");\n\n            if (isCommandExecuting) {\n                // if we haven't already scheduled a refresh, queue one\n                if (!scheduledRefresh) {\n                    scheduledRefresh = setTimeout(() => {\n                        scheduledRefresh = null;\n                        refreshOnFocusChange();\n                    }, REFRESH_DEDUPE_TIME);\n                }\n                return;\n            }\n            isCommandExecuting = true;\n\n            // if the git panel is visible, its very likely user is working with git (maybe external)\n            // so when Phoenix gains focus, we do a complete git refresh to show latest status\n            if(isGitPanelVisible) {\n                CommandManager.execute(Constants.CMD_GIT_REFRESH).fail((err) => {\n                    console.error(\"error refreshing on focus switch\", err);\n                }).always(() => {\n                    isCommandExecuting = false;\n                    // if a refresh got queued while we were executing, run it immediately now\n                    if (scheduledRefresh) {\n                        clearTimeout(scheduledRefresh);\n                        scheduledRefresh = null;\n                        refreshOnFocusChange();\n                    }\n                });\n            } else {\n                // if panel not visible, we just refresh the git branch (shown in sidebar)\n                Branch.refresh();\n                isCommandExecuting = false;\n\n                // run if something got queued\n                if (scheduledRefresh) {\n                    clearTimeout(scheduledRefresh);\n                    scheduledRefresh = null;\n                    refreshOnFocusChange();\n                }\n            }\n        }\n    }\n    $(window).focus(refreshOnFocusChange);\n\n    // Event handlers\n    let projectSwitched = true;\n    EventEmitter.on(Events.BRACKETS_PROJECT_CHANGE, function () {\n        // pressing refresh button will raise GIT_ENABLED event and we only want one enabled metric\n        // per project open.\n        projectSwitched = true;\n    });\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        _enableAllCommands(true);\n        gitEnabled = true;\n        projectSwitched && Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'enabled', \"project\");\n        projectSwitched = false;\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        _enableAllCommands(false);\n        gitEnabled = false;\n    });\n\n    // API\n    exports.$icon = $icon;\n    exports.init = init;\n\n});\n\n/*globals jsPromise, fs*/\ndefine(\"src/NoRepo\", function (require) {\n\n    // Brackets modules\n    const FileSystem    = brackets.getModule(\"filesystem/FileSystem\"),\n        FileUtils       = brackets.getModule(\"file/FileUtils\"),\n        ProjectManager  = brackets.getModule(\"project/ProjectManager\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        Metrics         = brackets.getModule(\"utils/Metrics\"),\n        Strings         = brackets.getModule(\"strings\"),\n        StringUtils     = brackets.getModule(\"utils/StringUtils\");\n\n    // Local modules\n    const ErrorHandler  = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        ExpectedError   = require(\"src/ExpectedError\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\"),\n        CloneDialog     = require(\"src/dialogs/Clone\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"src/Preferences\"),\n        Constants       = require(\"src/Constants\"),\n        Utils           = require(\"src/Utils\");\n\n    // Templates\n    var gitignoreTemplate = `# https://git-scm.com/docs/gitignore\n# https://help.github.com/articles/ignoring-files\n# Example .gitignore files: https://github.com/github/gitignore\n/bower_components/\n/node_modules/`;\n\n    // Module variables\n\n    // Implementation\n\n    function createGitIgnore() {\n        var gitIgnorePath = Preferences.get(\"currentGitRoot\") + \".gitignore\";\n        return Utils.pathExists(gitIgnorePath).then(function (exists) {\n            if (!exists) {\n                return jsPromise(\n                    FileUtils.writeText(FileSystem.getFileForPath(gitIgnorePath), gitignoreTemplate));\n            }\n        });\n    }\n\n    function stageGitIgnore() {\n        return createGitIgnore().then(function () {\n            return Git.stage(\".gitignore\");\n        });\n    }\n\n    function handleGitInit() {\n        Utils.isProjectRootWritable().then(function (writable) {\n            if (!writable) {\n                const initPath = Phoenix.app.getDisplayPath(Utils.getProjectRoot());\n                const errorStr = StringUtils.format(Strings.FOLDER_NOT_WRITABLE, initPath);\n                throw new ExpectedError(errorStr);\n            }\n            return Git.init().catch(function (err) {\n                return new Promise((resolve, reject)=>{\n                    if (ErrorHandler.contains(err, \"Please tell me who you are\")) {\n                        EventEmitter.emit(Events.GIT_CHANGE_USERNAME, function () {\n                            EventEmitter.emit(Events.GIT_CHANGE_EMAIL, function () {\n                                Git.init().then(function (result) {\n                                    resolve(result);\n                                }).catch(function (error) {\n                                    reject(error);\n                                });\n                            });\n                        });\n                        return;\n                    }\n\n                    reject(err);\n                });\n            });\n        }).then(function () {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'init', \"success\");\n            return stageGitIgnore(\"Initial staging\");\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.INIT_NEW_REPO_FAILED, {dontStripError: true});\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'init', \"fail\");\n        }).then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        });\n    }\n\n    // This checks if the project root is empty (to let Git clone repositories)\n    function isProjectRootEmpty() {\n        return new Promise(function (resolve, reject) {\n            ProjectManager.getProjectRoot().getContents(function (err, entries) {\n                if (err) {\n                    return reject(err);\n                }\n                resolve(entries.length === 0);\n            });\n        });\n    }\n\n    function handleGitClone(gitCloneURL, destPath) {\n        var $gitPanel = $(\"#git-panel\");\n        var $cloneButton = $gitPanel.find(\".git-clone\");\n        $cloneButton.prop(\"disabled\", true);\n        isProjectRootEmpty().then(function (isEmpty) {\n            if (!isEmpty) {\n                const clonePath = Phoenix.app.getDisplayPath(Utils.getProjectRoot());\n                const err = new ExpectedError(\n                    StringUtils.format(Strings.GIT_CLONE_ERROR_EXPLAIN, clonePath));\n                ErrorHandler.showError(err, Strings.GIT_CLONE_REMOTE_FAILED, {dontStripError: true});\n                return;\n            }\n            function _clone(cloneConfig) {\n                var q = Promise.resolve();\n                // put username and password into remote url\n                var remoteUrl = cloneConfig.remoteUrl;\n                if (cloneConfig.remoteUrlNew) {\n                    remoteUrl = cloneConfig.remoteUrlNew;\n                }\n\n                // do the clone\n                q = q.then(function () {\n                    const tracker = ProgressDialog.newProgressTracker();\n                    destPath = destPath ? fs.getTauriPlatformPath(destPath) : \".\";\n                    return ProgressDialog.show(Git.clone(remoteUrl, destPath, tracker), tracker);\n                }).then(()=>{\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'clone', \"success\");\n                }).catch(function (err) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'clone', \"fail\");\n                    ErrorHandler.showError(err, Strings.GIT_CLONE_REMOTE_FAILED, {errorMetric: \"clone\"});\n                });\n\n                // restore original url if desired\n                if (cloneConfig.remoteUrlRestore) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(cloneConfig.remote, cloneConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            }\n            if(gitCloneURL){\n                return _clone({\n                    remote: \"origin\",\n                    remoteUrlNew: gitCloneURL\n                });\n            }\n            CloneDialog.show().then(_clone).catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.GIT_CLONE_REMOTE_FAILED); }\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err);\n        }).finally(function () {\n            $cloneButton.prop(\"disabled\", false);\n        });\n    }\n\n    CommandManager.register(Strings.GIT_CLONE, Constants.CMD_GIT_CLONE_WITH_URL, handleGitClone);\n\n    // Event subscriptions\n    EventEmitter.on(Events.HANDLE_GIT_INIT, function () {\n        handleGitInit();\n    });\n    EventEmitter.on(Events.HANDLE_GIT_CLONE, function () {\n        handleGitClone();\n    });\n    EventEmitter.on(Events.GIT_NO_BRANCH_EXISTS, function () {\n        stageGitIgnore();\n    });\n\n});\n\n/*globals jsPromise, path*/\n\ndefine(\"src/Panel\", function (require, exports) {\n\n    const _                = brackets.getModule(\"thirdparty/lodash\"),\n        StateManager       = brackets.getModule(\"preferences/StateManager\"),\n        CodeInspection     = brackets.getModule(\"language/CodeInspection\"),\n        CommandManager     = brackets.getModule(\"command/CommandManager\"),\n        Commands           = brackets.getModule(\"command/Commands\"),\n        Dialogs            = brackets.getModule(\"widgets/Dialogs\"),\n        DocumentManager    = brackets.getModule(\"document/DocumentManager\"),\n        EditorManager      = brackets.getModule(\"editor/EditorManager\"),\n        FileViewController = brackets.getModule(\"project/FileViewController\"),\n        FileSystem         = brackets.getModule(\"filesystem/FileSystem\"),\n        Menus              = brackets.getModule(\"command/Menus\"),\n        Mustache           = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        FindInFiles        = brackets.getModule(\"search/FindInFiles\"),\n        WorkspaceManager   = brackets.getModule(\"view/WorkspaceManager\"),\n        ProjectManager     = brackets.getModule(\"project/ProjectManager\"),\n        StringUtils        = brackets.getModule(\"utils/StringUtils\"),\n        Strings            = brackets.getModule(\"strings\"),\n        Metrics            = brackets.getModule(\"utils/Metrics\"),\n        NotificationUI = brackets.getModule(\"widgets/NotificationUI\"),\n        Constants          = require(\"src/Constants\"),\n        Git                = require(\"src/git/Git\"),\n        Events             = require(\"./Events\"),\n        EventEmitter       = require(\"./EventEmitter\"),\n        Preferences        = require(\"./Preferences\"),\n        Setup                    = require(\"src/utils/Setup\"),\n        ErrorHandler       = require(\"./ErrorHandler\"),\n        ExpectedError      = require(\"./ExpectedError\"),\n        Main               = require(\"./Main\"),\n        GutterManager      = require(\"./GutterManager\"),\n        Utils              = require(\"src/Utils\"),\n        ProgressDialog     = require(\"src/dialogs/Progress\");\n\n    const gitPanelTemplate            = `<div id=\"git-panel\" class=\"git bottom-panel vert-resizable top-resizer no-focus\">\n    <div class=\"toolbar simple-toolbar-layout mainToolbar\">\n\n        <!-- on left -->\n        <input type=\"checkbox\" class=\"check-all git-available\" />\n        <div class=\"btn-group git-available\">\n            <button title=\"{{S.TOOLTIP_COMMIT}}\" class=\"btn small git-commit\" disabled><i class=\"octicon octicon-git-commit\"></i><span>{{S.BUTTON_COMMIT}}</span></button>\n        </div>\n        <div class=\"git-available padding-right-small\">\n            <div class=\"btn-group git-rebase\">\n                <button title=\"{{S.TOOLTIP_REBASE_CONTINUE}}\" class=\"btn small git-rebase-continue\">\n                    <i class=\"octicon octicon-git-commit\"></i><span>{{S.BUTTON_REBASE_CONTINUE}}</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_REBASE_SKIP}}\" class=\"btn small git-rebase-skip\">\n                    <span>{{S.BUTTON_REBASE_SKIP}}</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_REBASE_ABORT}}\" class=\"btn small git-rebase-abort\">\n                    <span>{{S.BUTTON_REBASE_ABORT}}</span>\n                </button>\n                <!--\n                <button title=\"{{S.TOOLTIP_FIND_CONFLICTS}}\" class=\"btn small git-find-conflicts\">\n                    <span>{{S.BUTTON_FIND_CONFLICTS}}</span>\n                </button>\n                -->\n            </div>\n        </div>\n        <div class=\"git-available padding-right-small\">\n            <div class=\"btn-group git-merge\">\n                <button title=\"{{S.TOOLTIP_COMMIT}}\" class=\"btn small git-commit-merge\">\n                    <i class=\"octicon octicon-git-commit\"></i><span>{{S.BUTTON_COMMIT}}</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_MERGE_ABORT}}\" class=\"btn small git-merge-abort\">\n                    <span>{{S.BUTTON_MERGE_ABORT}}</span>\n                </button>\n                <!--\n                <button title=\"{{S.TOOLTIP_FIND_CONFLICTS}}\" class=\"btn small git-find-conflicts\">\n                    <span>{{S.BUTTON_FIND_CONFLICTS}}</span>\n                </button>\n                -->\n            </div>\n        </div>\n        <div class=\"btn-group git-available hide-when-x-small\">\n            <button title=\"{{S.GOTO_PREVIOUS_GIT_CHANGE}}\" class=\"btn small git-prev-gutter\"><i class=\"octicon octicon-arrow-up\"></i></button>\n            <button title=\"{{S.GOTO_NEXT_GIT_CHANGE}}\" class=\"btn small git-next-gutter\"><i class=\"octicon octicon-arrow-down\"></i></button>\n        </div>\n        <div class=\"btn-group git-available hide-when-x-small\">\n            <button title=\"{{S.TOOLTIP_SHOW_HISTORY}}\" class=\"btn small git-history-toggle\"><i class=\"octicon octicon-history\"></i></button>\n            <button title=\"{{S.TOOLTIP_SHOW_FILE_HISTORY}}\" class=\"btn small git-file-history\"><i class=\"octicon octicon-file-text\"></i></button>\n        </div>\n        <div class=\"btn-group git-not-available\">\n          <button title=\"{{S.TOOLTIP_INIT}}\" class=\"btn small git-init\"><i class=\"octicon octicon-repo-create\"></i><span>{{S.GIT_INIT}}</span></button>\n          <button title=\"{{S.TOOLTIP_CLONE}}\" class=\"btn small git-clone\"><i class=\"octicon octicon-repo-clone\"></i><span>{{S.GIT_CLONE}}</span></button>\n        </div>\n        <!-- this should be last on left -->\n        <div class=\"btn-group git-available hide-when-x-small\">\n            <button title=\"{{S.TOOLTIP_REFRESH_PANEL}}\" class=\"btn small git-refresh git-icon\"><i class=\"octicon octicon-sync\"></i></button>\n        </div>\n        <!-- on right -->\n        <div class=\"git-right-icons hide-when-small\">\n            <div class=\"btn-group git-available dropup\">\n                <ul class=\"dropdown-menu git-remotes-dropdown\"></ul>\n                <button type=\"button\" class=\"git-remotes btn small dropdown-toggle\" data-toggle=\"dropdown\" title=\"{{S.TOOLTIP_PICK_REMOTE}}\">\n                    <span class=\"caret\"></span>\n                    <span class=\"git-selected-remote\">&mdash;</span>\n                </button>\n                <button title=\"{{S.TOOLTIP_FETCH}}\" class=\"btn small git-fetch\"><i class=\"octicon octicon-cloud-download\"></i></button>\n                <button title=\"{{S.TOOLTIP_PULL}}\" class=\"btn small git-pull\"><i class=\"octicon octicon-repo-pull\"></i></button>\n                <button title=\"{{S.TOOLTIP_PUSH}}\" class=\"btn small git-push\"><i class=\"octicon octicon-repo-push\"></i></button>\n            </div>\n        </div>\n        <div class=\"git-more-options-btn btn-alt-quiet\"><i class=\"fa-solid fa-ellipsis-vertical\"></i></div>\n        <a href=\"#\" class=\"close\">&times;</a>\n\n    </div>\n    <div class=\"table-container\" style=\"height: calc(100% - 42px);\"></div>\n</div>\n`,\n        gitPanelResultsTemplate     = `<table class=\"git-edited-list bottom-panel-table table table-striped table-condensed row-highlight\">\n    <tbody>\n        {{#files}}\n        <tr class=\"modified-file\" x-file=\"{{file}}\" x-status=\"{{status}}\">\n            <td class=\"checkbox-column\"><input type=\"checkbox\" class=\"check-one\" {{#staged}}checked=\"true\"{{/staged}} /></td>\n            <td class=\"icons-column\">\n                {{#allowDiff}}<button class=\"btn btn-mini btn-git-diff\" title=\"{{Strings.DIFF}}\"><i class=\"octicon octicon-diff\"></i></button>{{/allowDiff}}\n            </td>\n            <td class=\"status-column\">{{statusText}}</td>\n            <td>{{display}}</td>\n            <td>\n                <div class=\"btn-group\">\n                    {{#allowUndo}}   <button class=\"btn btn-mini btn-git-undo\">{{Strings.UNDO_CHANGES_BTN}}</button>  {{/allowUndo}}\n                    {{#allowDelete}} <button class=\"btn btn-mini btn-git-delete\">{{Strings.DELETE_FILE_BTN}}</button> {{/allowDelete}}\n                </div>\n            </td>\n        </tr>\n        {{/files}}\n    </tbody>\n</table>\n`,\n        gitAuthorsDialogTemplate    = `<div id=\"git-authors-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.AUTHORS_OF}} {{file}}</h1>\n    </div>\n    <div class=\"modal-body tab-content\">\n        <table class=\"table table-condensed\">\n            <tr>\n                <th>\n                    {{String.AUTHOR}}\n                </th>\n                <th>\n                </th>\n            </tr>\n            {{#blameStats}}\n            <tr>\n                <td>\n                    {{authorName}}\n                </td>\n                <td>\n                    {{percentage}}% ({{lines}} {{Strings._LINES}})\n                </td>\n            </tr>\n            {{/blameStats}}\n        </table>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\" class=\"dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n    </div>\n</div>\n`,\n        gitCommitDialogTemplate     = `<div id=\"git-commit-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <button class=\"extendedCommit btn pull-right\">{{Strings.EXTENDED_COMMIT_MESSAGE}}</button>\n        <label class=\"checkbox pull-right\" style=\"line-height: 28px; margin-right: 50px;\">\n            <input class=\"amend-commit\" type=\"checkbox\" style=\"margin-top: 10px;\" /> {{Strings.AMEND_COMMIT}}\n        </label>\n        <h1 class=\"dialog-title\">{{Strings.GIT_COMMIT}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <div>\n            <div class=\"accordion\">\n                <!-- Hidden checkbox to toggle the accordion -->\n                <input type=\"checkbox\" id=\"codeInspectionToggle\" class=\"accordion-toggle\" />\n                <label for=\"codeInspectionToggle\" class=\"accordion-header\">\n                    <span class=\"accordion-title\">{{Strings.CODE_INSPECTION_IN_PROGRESS}}</span>\n                    <i class=\"fas fa-chevron-down\"></i>\n                    <div class=\"accordion-progress-bar\">\n                        <div class=\"accordion-progress-bar-inner\"></div>\n                    </div>\n                </label>\n                <div class=\"accordion-content lint-errors\">\n                    {{Strings.PLEASE_WAIT}}\n                </div>\n            </div>\n        </div>\n        <div class=\"commit-diff\"></div>\n        <div class=\"commit-message-box\">\n            <input name=\"commit-message\" type=\"text\" placeholder=\"{{Strings.COMMIT_MESSAGE_PLACEHOLDER}}\" autocomplete=\"off\" />\n            <textarea name=\"commit-message\" type=\"text\" placeholder=\"{{Strings.COMMIT_MESSAGE_PLACEHOLDER}}\" autocomplete=\"off\" style=\"display: none;\"></textarea>\n            <input name=\"commit-message-count\" readonly=\"readonly\" type=\"text\" tabindex=\"-1\" />\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <label class=\"checkbox pull-left\" style=\"line-height: 28px; margin-right: 50px;\">\n            <input class=\"commit-no-verify\" type=\"checkbox\" style=\"margin-top: 10px;\" /> {{Strings.SKIP_COMMIT_CHECKS}}\n        </label>\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n    </div>\n</div>\n`,\n        gitCommitLintResultTemplate = `<ul>\n    {{#lintResults}}\n    {{#hasErrors}}\n    <li>\n        {{filename}}\n        <ul>\n            {{#errors}}\n            <li>\n                <a class=\"lint-error-commit-link\" data-file=\"{{file}}\" data-line=\"{{line}}\" data-ch=\"{{ch}}\" style=\"cursor: pointer\">\n                    {{errorLineMessage}}\n                </a>\n            </li>\n            {{/errors}}\n        </ul>\n    </li>\n    {{/hasErrors}}\n    {{/lintResults}}\n</ul>\n`,\n        gitDiffDialogTemplate       = `<div id=\"git-diff-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{{Strings.GIT_DIFF}}} {{file}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <div class=\"commit-diff\"></div>\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\" class=\"dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n    </div>\n</div>\n`,\n        questionDialogTemplate      = `<div id=\"git-question-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <p>{{{question}}}</p>\n        {{#stringInput}}\n        <input class=\"stringInput\" type=\"text\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/stringInput}}\n        {{#passwordInput}}\n        <input class=\"stringInput\" type=\"password\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/passwordInput}}\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn btn-80 {{#customOkBtnClass}}{{customOkBtnClass}}{{/customOkBtnClass}}{{^customOkBtnClass}}primary{{/customOkBtnClass}}\">\n            {{#customOkBtn}}{{customOkBtn}}{{/customOkBtn}}{{^customOkBtn}}{{Strings.BUTTON_OK}}{{/customOkBtn}}\n        </button>\n    </div>\n</div>\n`;\n\n    const showFileWhiteList = /^\\.gitignore$/,\n        GIT_PANEL_SHOWN_ON_FIRST_BOOT = \"GIT_PANEL_SHOWN_ON_FIRST_BOOT\";\n\n    const COMMIT_MODE = {\n        CURRENT: \"CURRENT\",\n        ALL: \"ALL\",\n        DEFAULT: \"DEFAULT\"\n    };\n\n    var gitPanel = null,\n        $gitPanel = $(null),\n        $mainToolbar,\n        gitPanelDisabled = null,\n        gitPanelMode = null,\n        showingUntracked = true,\n        $tableContainer = $(null),\n        lastCommitMessage = {};\n\n    function lintFile(filename) {\n        var fullPath = Preferences.get(\"currentGitRoot\") + filename,\n            codeInspectionPromise;\n\n        try {\n            codeInspectionPromise = CodeInspection.inspectFile(FileSystem.getFileForPath(fullPath));\n        } catch (e) {\n            ErrorHandler.logError(\"CodeInspection.inspectFile failed to execute for file \" + fullPath);\n            ErrorHandler.logError(e);\n            codeInspectionPromise = Promise.reject(e);\n        }\n\n        return jsPromise(codeInspectionPromise);\n    }\n\n    function _makeDialogBig($dialog) {\n        var $wrapper = $dialog.parents(\".modal-wrapper\").first();\n        if ($wrapper.length === 0) { return; }\n\n        $dialog\n            .width(\"80%\")\n            .children(\".modal-body\")\n                .css(\"max-height\", \"72vh\")\n            .end();\n    }\n\n    function _showCommitDialog(stagedDiff, prefilledMessage, commitMode, files) {\n        // Open the dialog\n        const compiledTemplate = Mustache.render(gitCommitDialogTemplate, {Strings: Strings}),\n            dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog          = dialog.getElement();\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"showDialog\");\n        let totalLintErrors = 0;\n        inspectFiles(files, $dialog).then(function (lintResults) {\n            // Flatten the error structure from various providers\n            lintResults = lintResults || [];\n            lintResults.forEach(function (lintResult) {\n                lintResult.errors = [];\n                const lintingFilePath = path.join(ProjectManager.getProjectRoot().fullPath, lintResult.filename);\n                if (Array.isArray(lintResult.result)) {\n                    lintResult.result.forEach(function (resultSet) {\n                        if (!resultSet.result || !resultSet.result.errors) { return; }\n\n                        var providerName = resultSet.provider.name;\n                        resultSet.result.errors.forEach(function (e) {\n                            lintResult.errors.push({\n                                errorLineMessage: (e.pos.line + 1) + \": \" + e.message + \" (\" + providerName + \")\",\n                                line: e.pos.line,\n                                ch: e.pos.ch,\n                                file: lintingFilePath\n                            });\n                        });\n                    });\n                } else {\n                    ErrorHandler.logError(\"[brackets-git] lintResults contain object in unexpected format: \" + JSON.stringify(lintResult));\n                }\n                lintResult.hasErrors = lintResult.errors.length > 0;\n                totalLintErrors += lintResult.errors.length;\n            });\n\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"lintErr\" + Metrics.getRangeName(totalLintErrors));\n\n            // Filter out only results with errors to show\n            lintResults = _.filter(lintResults, function (lintResult) {\n                return lintResult.hasErrors;\n            });\n            const compiledResultHTML = Mustache.render(gitCommitLintResultTemplate, {\n                    Strings: Strings,\n                    lintResults: lintResults\n                });\n            if(!$dialog || !$dialog.is(\":visible\")) {\n                return;\n            }\n            $dialog.find(\".accordion-title\").html(Strings.CODE_INSPECTION_PROBLEMS);\n            if(!lintResults.length){\n                $dialog.find(\".lint-errors\").html(Strings.CODE_INSPECTION_PROBLEMS_NONE);\n                $dialog.find(\".accordion\").addClass(\"forced-hidden\");\n                return;\n            }\n            $dialog.find(\".lint-errors\").html(compiledResultHTML);\n            if(!$dialog.find(\".lint-errors\").is(\":visible\")){\n                $dialog.find(\".accordion-toggle\").click();\n            }\n            $dialog.find(\".lint-error-commit-link\").click((e)=>{\n                e.preventDefault();\n                const $el = $(e.target);\n                const fileToOpen = $el.data(\"file\"),\n                    line = $el.data(\"line\"),\n                    ch = $el.data(\"ch\");\n                CommandManager.execute(Commands.FILE_OPEN, {fullPath: fileToOpen})\n                    .done(()=>{\n                        EditorManager.getCurrentFullEditor().setCursorPos(line, ch, true);\n                    });\n                dialog.close();\n            });\n        });\n\n        // We need bigger commit dialog\n        _makeDialogBig($dialog);\n\n        // Show nicely colored commit diff\n        const diff = Utils.formatDiff(stagedDiff);\n        if(diff === Utils.FORMAT_DIFF_TOO_LARGE) {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"diffTooLarge\");\n        }\n        $dialog.find(\".commit-diff\").append(diff);\n\n        // Enable / Disable amend checkbox\n        var toggleAmendCheckbox = function (bool) {\n            $dialog.find(\".amend-commit\")\n                .prop(\"disabled\", !bool)\n                .parent()\n                .attr(\"title\", !bool ? Strings.AMEND_COMMIT_FORBIDDEN : null);\n        };\n        toggleAmendCheckbox(false);\n\n        Git.getCommitCounts()\n            .then(function (commits) {\n                var hasRemote = $gitPanel.find(\".git-selected-remote\").data(\"remote\") != null;\n                var hasCommitsAhead = commits.ahead > 0;\n                toggleAmendCheckbox(!hasRemote || hasRemote && hasCommitsAhead);\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n            });\n\n        function getCommitMessageElement() {\n            var r = $dialog.find(\"[name='commit-message']:visible\");\n            if (r.length !== 1) {\n                r = $dialog.find(\"[name='commit-message']\");\n                for (var i = 0; i < r.length; i++) {\n                    if ($(r[i]).css(\"display\") !== \"none\") {\n                        return $(r[i]);\n                    }\n                }\n            }\n            return r;\n        }\n\n        var $commitMessageCount = $dialog.find(\"input[name='commit-message-count']\");\n\n        // Add event to count characters in commit message\n        var recalculateMessageLength = function () {\n            var val = getCommitMessageElement().val().trim(),\n                length = val.length;\n\n            if (val.indexOf(\"\\n\")) {\n                // longest line\n                length = Math.max.apply(null, val.split(\"\\n\").map(function (l) { return l.length; }));\n            }\n\n            $commitMessageCount\n                .val(length)\n                .toggleClass(\"over50\", length > 50 && length <= 100)\n                .toggleClass(\"over100\", length > 100);\n        };\n\n        var usingTextArea = false;\n\n        // commit message handling\n        function switchCommitMessageElement() {\n            usingTextArea = !usingTextArea;\n\n            var findStr = \"[name='commit-message']\",\n                currentValue = $dialog.find(findStr + \":visible\").val();\n            $dialog.find(findStr).toggle();\n            $dialog.find(findStr + \":visible\")\n                .val(currentValue)\n                .focus();\n            recalculateMessageLength();\n        }\n\n        $dialog.find(\"button.primary\").on(\"click\", function (e) {\n            var $commitMessage = getCommitMessageElement();\n            if ($commitMessage.val().trim().length === 0) {\n                e.stopPropagation();\n                $commitMessage.addClass(\"invalid\");\n            } else {\n                $commitMessage.removeClass(\"invalid\");\n            }\n        });\n\n        $dialog.find(\"button.extendedCommit\").on(\"click\", function () {\n            switchCommitMessageElement();\n            // this value will be set only when manually triggered\n            Preferences.set(\"useTextAreaForCommitByDefault\", usingTextArea);\n        });\n\n        function prefillMessage(msg) {\n            if (msg.indexOf(\"\\n\") !== -1 && !usingTextArea) {\n                switchCommitMessageElement();\n            }\n            $dialog.find(\"[name='commit-message']:visible\").val(msg);\n            recalculateMessageLength();\n        }\n\n        // Assign action to amend checkbox\n        $dialog.find(\".amend-commit\").on(\"click\", function () {\n            if ($(this).prop(\"checked\") === false) {\n                prefillMessage(\"\");\n            } else {\n                Git.getLastCommitMessage().then(function (msg) {\n                    prefillMessage(msg);\n                });\n            }\n        });\n\n        if (Preferences.get(\"useTextAreaForCommitByDefault\")) {\n            switchCommitMessageElement();\n        }\n\n        if (prefilledMessage) {\n            prefillMessage(prefilledMessage.trim());\n        }\n\n        // Add focus to commit message input\n        getCommitMessageElement().focus();\n\n        $dialog.find(\"[name='commit-message']\")\n            .on(\"keyup\", recalculateMessageLength)\n            .on(\"change\", recalculateMessageLength);\n        recalculateMessageLength();\n\n        dialog.done(function (buttonId) {\n            const commitMessageElement = getCommitMessageElement();\n            if(commitMessageElement){\n                lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = commitMessageElement.val();\n            }\n            if (buttonId === \"ok\") {\n                if (commitMode === COMMIT_MODE.ALL || commitMode === COMMIT_MODE.CURRENT) {\n                    var filePaths = _.map(files, function (next) {\n                        return next.file;\n                    });\n                    Git.stage(filePaths)\n                    .then(function () {\n                        return _getStagedDiff();\n                    })\n                    .then(function (diff) {\n                        _doGitCommit($dialog, getCommitMessageElement, diff);\n                    })\n                    .catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CANT_GET_STAGED_DIFF);\n                    });\n                } else {\n                    _doGitCommit($dialog, getCommitMessageElement, stagedDiff);\n                }\n            } else {\n                Git.status();\n            }\n        });\n    }\n\n    function _doGitCommit($dialog, getCommitMessageElement, stagedDiff) {\n        // this event won't launch when commit-message is empty so its safe to assume that it is not\n        var commitMessage = getCommitMessageElement().val(),\n            amendCommit = $dialog.find(\".amend-commit\").prop(\"checked\"),\n            noVerify = $dialog.find(\".commit-no-verify\").prop(\"checked\");\n\n        // if commit message is extended and has a newline, put an empty line after first line to separate subject and body\n        var s = commitMessage.split(\"\\n\");\n        if (s.length > 1 && s[1].trim() !== \"\") {\n            s.splice(1, 0, \"\");\n        }\n        commitMessage = s.join(\"\\n\");\n\n        // save lastCommitMessage in case the commit will fail\n        lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = commitMessage;\n\n        // now we are going to be paranoid and we will check if some mofo didn't change our diff\n        _getStagedDiff().then(function (diff) {\n            if (diff === stagedDiff) {\n                const tracker = ProgressDialog.newProgressTracker();\n                return ProgressDialog.show(Git.commit(commitMessage, amendCommit, noVerify, tracker),\n                    tracker, {\n                        title: Strings.GIT_COMMIT_IN_PROGRESS,\n                        options: { preDelay: 1, postDelay: 1 }\n                    })\n                    .then(function () {\n                        // clear lastCommitMessage because the commit was successful\n                        lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = null;\n                    });\n            } else {\n                throw new ExpectedError(Strings.ERROR_MODIFIED_DIALOG_FILES);\n            }\n        }).then(()=>{\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"success\");\n        }).catch(function (err) {\n            if (ErrorHandler.contains(err, \"Please tell me who you are\")) {\n                return new Promise((resolve)=>{\n                    EventEmitter.emit(Events.GIT_CHANGE_USERNAME, function () {\n                        EventEmitter.emit(Events.GIT_CHANGE_EMAIL, function () {\n                            resolve();\n                        });\n                    });\n                });\n            }\n\n            ErrorHandler.showError(err, Strings.ERROR_GIT_COMMIT_FAILED, {errorMetric: \"commit\"});\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"fail\");\n\n        }).finally(function () {\n            EventEmitter.emit(Events.GIT_COMMITED);\n            refresh();\n        });\n    }\n\n    function _showAuthors(file, blame, fromLine, toLine) {\n        var linesTotal = blame.length;\n        var blameStats = blame.reduce(function (stats, lineInfo) {\n            var name = lineInfo.author + \" \" + lineInfo[\"author-mail\"];\n            if (stats[name]) {\n                stats[name] += 1;\n            } else {\n                stats[name] = 1;\n            }\n            return stats;\n        }, {});\n        blameStats = _.reduce(blameStats, function (arr, val, key) {\n            arr.push({\n                authorName: key,\n                lines: val,\n                percentage: Math.round(val / (linesTotal / 100))\n            });\n            return arr;\n        }, []);\n        blameStats = _.sortBy(blameStats, \"lines\").reverse();\n\n        if (fromLine || toLine) {\n            file += \" (\" + Strings.LINES + \" \" + fromLine + \"-\" + toLine + \")\";\n        }\n\n        var compiledTemplate = Mustache.render(gitAuthorsDialogTemplate, {\n                file: file,\n                blameStats: blameStats,\n                Strings: Strings\n            });\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n    }\n\n    function _getCurrentFilePath(editor) {\n        var gitRoot = Preferences.get(\"currentGitRoot\"),\n            document = editor ? editor.document : DocumentManager.getCurrentDocument(),\n            filePath = document.file.fullPath;\n        if (filePath.indexOf(gitRoot) === 0) {\n            filePath = filePath.substring(gitRoot.length);\n        }\n        return filePath;\n    }\n\n    function handleAuthorsSelection() {\n        var editor = EditorManager.getActiveEditor(),\n            filePath = _getCurrentFilePath(editor),\n            currentSelection = editor.getSelection(),\n            fromLine = currentSelection.start.line + 1,\n            toLine = currentSelection.end.line + 1;\n\n        // fix when nothing is selected on that line\n        if (currentSelection.end.ch === 0) { toLine = toLine - 1; }\n\n        var isSomethingSelected = currentSelection.start.line !== currentSelection.end.line ||\n                                  currentSelection.start.ch !== currentSelection.end.ch;\n        if (!isSomethingSelected) {\n            ErrorHandler.showError(new ExpectedError(Strings.ERROR_NOTHING_SELECTED));\n            return;\n        }\n\n        if (editor.document.isDirty) {\n            ErrorHandler.showError(new ExpectedError(Strings.ERROR_SAVE_FIRST));\n            return;\n        }\n\n        Git.getBlame(filePath, fromLine, toLine).then(function (blame) {\n            return _showAuthors(filePath, blame, fromLine, toLine);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GIT_BLAME_FAILED);\n        });\n    }\n\n    function handleAuthorsFile() {\n        var filePath = _getCurrentFilePath();\n        Git.getBlame(filePath).then(function (blame) {\n            return _showAuthors(filePath, blame);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GIT_BLAME_FAILED);\n        });\n    }\n\n    function handleGitDiff(file) {\n        if (Preferences.get(\"useDifftool\")) {\n            Git.difftool(file);\n        } else {\n            Git.diffFileNice(file).then(function (diff) {\n                // show the dialog with the diff\n                var compiledTemplate = Mustache.render(gitDiffDialogTemplate, { file: file, Strings: Strings }),\n                    dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n                    $dialog          = dialog.getElement();\n                _makeDialogBig($dialog);\n                const diffVal = Utils.formatDiff(diff);\n                if(diffVal === Utils.FORMAT_DIFF_TOO_LARGE) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"diffTooLarge\");\n                } else {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"success\");\n                }\n                $dialog.find(\".commit-diff\").append(diffVal);\n            }).catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"error\");\n                ErrorHandler.showError(err, Strings.ERROR_GIT_DIFF_FAILED);\n            });\n        }\n    }\n\n    function handleGitUndo(file) {\n        var compiledTemplate = Mustache.render(questionDialogTemplate, {\n            title: Strings.UNDO_CHANGES,\n            question: StringUtils.format(Strings.Q_UNDO_CHANGES, _.escape(file)),\n            Strings: Strings\n        });\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate).done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                Git.discardFileChanges(file).then(function () {\n                    var gitRoot = Preferences.get(\"currentGitRoot\");\n                    DocumentManager.getAllOpenDocuments().forEach(function (doc) {\n                        if (doc.file.fullPath === gitRoot + file) {\n                            Utils.reloadDoc(doc);\n                        }\n                    });\n                    refresh();\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_DISCARD_CHANGES_FAILED);\n                });\n            }\n        });\n    }\n\n    function handleGitDelete(file) {\n        FileSystem.resolve(Preferences.get(\"currentGitRoot\") + file, function (err, fileEntry) {\n            if (err) {\n                ErrorHandler.showError(err, Strings.ERROR_COULD_NOT_RESOLVE_FILE);\n                return;\n            }\n            CommandManager.execute(Commands.FILE_DELETE, {file: fileEntry});\n        });\n    }\n\n    function _getStagedDiff(commitMode, files = []) {\n        const tracker = ProgressDialog.newProgressTracker();\n        const fileNamesString = files.map(file => file.file).join(\", \");\n        return ProgressDialog.show(_getStagedDiffForCommitMode(commitMode, files), tracker, {\n            title: Strings.GETTING_STAGED_DIFF_PROGRESS,\n            initialMessage: `${fileNamesString}\\n${Strings.PLEASE_WAIT}`,\n            options: { preDelay: 3, postDelay: 1 }\n        })\n        .catch(function (err) {\n            if (ErrorHandler.contains(err, \"cleanup\")) {\n                return false; // will display list of staged files instead\n            }\n            throw err;\n        })\n        .then(function (diff) {\n            if (!diff) {\n                return Git.getListOfStagedFiles().then(function (filesList) {\n                    return Strings.DIFF_FAILED_SEE_FILES + \"\\n\\n\" + filesList;\n                });\n            }\n            return diff;\n        });\n    }\n\n    function _getStagedDiffForCommitMode(commitMode, files) {\n\n        if (commitMode === COMMIT_MODE.ALL) {\n            return _getStaggedDiffForAllFiles();\n        }\n\n        if (commitMode === COMMIT_MODE.CURRENT && _.isArray(files)) {\n            if (files.length > 1) {\n                return Promise.reject(\"_getStagedDiffForCommitMode() got files.length > 1\");\n            }\n\n            var isUntracked = files[0].status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1;\n            if (isUntracked) {\n                return _getDiffForUntrackedFiles(files[0].file);\n            } else {\n                return Git.getDiffOfAllIndexFiles(files[0].file);\n            }\n        }\n\n        return Git.getDiffOfStagedFiles();\n    }\n\n    function _getStaggedDiffForAllFiles() {\n        return Git.status().then(function (statusFiles) {\n            var untrackedFiles = [];\n            var fileArray = [];\n\n            statusFiles.forEach(function (fileObject) {\n                var isUntracked = fileObject.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1;\n                if (isUntracked) {\n                    untrackedFiles.push(fileObject.file);\n                } else {\n                    fileArray.push(fileObject.file);\n                }\n            });\n\n            if (untrackedFiles.length > 0) {\n                return _getDiffForUntrackedFiles(fileArray.concat(untrackedFiles));\n            } else {\n                return Git.getDiffOfAllIndexFiles(fileArray);\n            }\n        });\n    }\n\n    function _getDiffForUntrackedFiles(files) {\n        var diff;\n        return Git.stage(files, false)\n            .then(function () {\n                return Git.getDiffOfStagedFiles();\n            })\n            .then(function (_diff) {\n                diff = _diff;\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return diff;\n            });\n    }\n\n    // whatToDo gets values \"continue\" \"skip\" \"abort\"\n    function handleRebase(whatToDo) {\n        Git.rebase(whatToDo).then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, \"Rebase \" + whatToDo + \" failed\");\n        });\n    }\n\n    function abortMerge() {\n        Git.discardAllChanges().then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_MERGE_ABORT_FAILED);\n        });\n    }\n\n    function findConflicts() {\n        FindInFiles.doSearch(/^<<<<<<<\\s|^=======\\s|^>>>>>>>\\s/gm);\n    }\n\n    function commitMerge() {\n        Utils.loadPathContent(Preferences.get(\"currentGitRoot\") + \"/.git/MERGE_MSG\").then(function (msg) {\n            handleGitCommit(msg, true, COMMIT_MODE.DEFAULT);\n            EventEmitter.once(Events.GIT_COMMITED, function () {\n                EventEmitter.emit(Events.REFRESH_ALL);\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, \"Merge commit failed\");\n        });\n    }\n\n    function inspectFiles(gitStatusResults, $dialog) {\n        const lintResults = [];\n        let totalFiles = gitStatusResults.length,\n            totalFilesLinted = 0,\n            filesDone = 0;\n        function showProgress() {\n            const $progressBar = $dialog.find('.accordion-progress-bar-inner');\n            if ($progressBar.length) {\n                $progressBar[0].style.width = `${filesDone/totalFiles*100}%`;\n            }\n            if(filesDone === totalFiles){\n                $dialog.find('.accordion-progress-bar').addClass(\"forced-inVisible\");\n            }\n            const progressString = StringUtils.format(Strings.CODE_INSPECTION_DONE_FILES, filesDone, totalFiles);\n            $dialog.find(\".lint-errors\").html(progressString);\n        }\n\n        const codeInspectionPromises = gitStatusResults.map(function (fileObj) {\n            const isDeleted = fileObj.status.indexOf(Git.FILE_STATUS.DELETED) !== -1;\n            if(isDeleted){\n                filesDone++;\n                showProgress();\n                return;\n            }\n\n            // Do a code inspection for the file, if it was not deleted\n            return new Promise((resolve) => {\n                // Delay lintFile execution to give the event loop some breathing room\n                setTimeout(() => {\n                    lintFile(fileObj.file)\n                        .catch(function () {\n                            return [\n                                {\n                                    provider: { name: \"See console [F12] for details\" },\n                                    result: {\n                                        errors: [\n                                            {\n                                                pos: { line: 0, ch: 0 },\n                                                message: \"CodeInspection failed to execute for this file.\"\n                                            }\n                                        ]\n                                    }\n                                }\n                            ];\n                        })\n                        .then(function (result) {\n                            if (result) {\n                                lintResults.push({\n                                    filename: fileObj.file,\n                                    result: result\n                                });\n                            }\n                            resolve();\n                        }).finally(()=>{\n                            filesDone++;\n                            totalFilesLinted++;\n                            showProgress();\n                        });\n                }, 0); // Delay of 0ms to defer to the next tick of the event loop\n            });\n        });\n\n        return Promise.all(_.compact(codeInspectionPromises)).then(function () {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"files\" + Metrics.getRangeName(totalFiles));\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"lint\" + Metrics.getRangeName(totalFilesLinted));\n            return lintResults;\n        });\n    }\n\n\n    function handleGitCommit(prefilledMessage, isMerge, commitMode) {\n        if(Utils.isLoading($gitPanel.find(\".git-commit\"))){\n            return;\n        }\n\n        var stripWhitespace = Preferences.get(\"stripWhitespaceFromCommits\");\n\n        // Disable button (it will be enabled when selecting files after reset)\n        Utils.setLoading($gitPanel.find(\".git-commit\"));\n\n        var p;\n\n        // First reset staged files, then add selected files to the index.\n        if (commitMode === COMMIT_MODE.DEFAULT) {\n            p = Git.status().then(function (files) {\n                files = _.filter(files, function (file) {\n                    return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1;\n                });\n\n                if (files.length === 0 && !isMerge) {\n                    return ErrorHandler.showError(\n                        new Error(\"Commit button should have been disabled\"),\n                        \"Nothing staged to commit\"\n                    );\n                }\n\n                return handleGitCommitInternal(stripWhitespace,\n                                               files,\n                                               commitMode,\n                                               prefilledMessage);\n            });\n        } else if (commitMode === COMMIT_MODE.ALL) {\n            p = Git.status().then(function (files) {\n                return handleGitCommitInternal(stripWhitespace,\n                                               files,\n                                               commitMode,\n                                               prefilledMessage);\n            });\n        } else if (commitMode === COMMIT_MODE.CURRENT) {\n            p = Git.status().then(function (files) {\n                var gitRoot = Preferences.get(\"currentGitRoot\");\n                var currentDoc = DocumentManager.getCurrentDocument();\n                if (currentDoc) {\n                    var relativePath = currentDoc.file.fullPath.substring(gitRoot.length);\n                    var currentFile = _.filter(files, function (next) {\n                        return relativePath === next.file;\n                    });\n                    return handleGitCommitInternal(stripWhitespace, currentFile, commitMode, prefilledMessage);\n                }\n            });\n        }\n\n        p.catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_PREPARING_COMMIT_DIALOG);\n        }).finally(function () {\n            Utils.unsetLoading($gitPanel.find(\".git-commit\"));\n        });\n\n    }\n\n    function handleGitCommitInternal(stripWhitespace, files, commitMode, prefilledMessage) {\n        let queue = Promise.resolve();\n\n        if (stripWhitespace) {\n            queue = queue.then(function () {\n                const tracker = ProgressDialog.newProgressTracker();\n                return ProgressDialog.show(\n                    Utils.stripWhitespaceFromFiles(files, commitMode === COMMIT_MODE.DEFAULT, tracker),\n                    tracker, {\n                        title: Strings.CLEANING_WHITESPACE_PROGRESS,\n                        options: { preDelay: 3, postDelay: 1 }\n                    }\n                );\n            });\n        }\n\n        return queue.then(function () {\n            // All files are in the index now, get the diff and show dialog.\n            return _getStagedDiff(commitMode, files).then(function (diff) {\n                return _showCommitDialog(diff, prefilledMessage, commitMode, files);\n            });\n        });\n    }\n\n    function refreshCurrentFile() {\n        var gitRoot = Preferences.get(\"currentGitRoot\");\n        var currentDoc = DocumentManager.getCurrentDocument();\n        if (currentDoc) {\n            $gitPanel.find(\"tr\").each(function () {\n                var currentFullPath = currentDoc.file.fullPath,\n                    thisFile = $(this).attr(\"x-file\");\n                $(this).toggleClass(\"selected\", gitRoot + thisFile === currentFullPath);\n            });\n        } else {\n            $gitPanel.find(\"tr\").removeClass(\"selected\");\n        }\n    }\n\n    function shouldShow(fileObj) {\n        if (showFileWhiteList.test(fileObj.name)) {\n            return true;\n        }\n        return ProjectManager.shouldShow(fileObj);\n    }\n\n    function _refreshTableContainer(files) {\n        if (!gitPanel.isVisible()) {\n            return;\n        }\n\n        // remove files that we should not show\n        files = _.filter(files, function (file) {\n            return shouldShow(file);\n        });\n\n        var allStaged = files.length > 0 && _.all(files, function (file) { return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1; });\n        $gitPanel.find(\".check-all\").prop(\"checked\", allStaged).prop(\"disabled\", files.length === 0);\n\n        var $editedList = $tableContainer.find(\".git-edited-list\");\n        var visibleBefore = $editedList.length ? $editedList.is(\":visible\") : true;\n        $editedList.remove();\n\n        if (files.length === 0) {\n            $tableContainer.append($(\"<p class='git-edited-list nothing-to-commit' />\").text(Strings.NOTHING_TO_COMMIT));\n        } else {\n            // if desired, remove untracked files from the results\n            if (showingUntracked === false) {\n                files = _.filter(files, function (file) {\n                    return file.status.indexOf(Git.FILE_STATUS.UNTRACKED) === -1;\n                });\n            }\n            // -\n            files.forEach(function (file) {\n                file.staged = file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1;\n                file.statusText = file.status.map(function (status) {\n                    return Strings[\"FILE_\" + status];\n                }).join(\", \");\n                file.allowDiff = file.status.indexOf(Git.FILE_STATUS.UNTRACKED) === -1 &&\n                                 file.status.indexOf(Git.FILE_STATUS.RENAMED) === -1 &&\n                                 file.status.indexOf(Git.FILE_STATUS.DELETED) === -1;\n                file.allowDelete = file.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1 ||\n                                   file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1 &&\n                                   file.status.indexOf(Git.FILE_STATUS.ADDED) !== -1;\n                file.allowUndo = !file.allowDelete;\n            });\n            $tableContainer.append(Mustache.render(gitPanelResultsTemplate, {\n                files: files,\n                Strings: Strings\n            }));\n\n            refreshCurrentFile();\n        }\n        $tableContainer.find(\".git-edited-list\").toggle(visibleBefore);\n    }\n\n    function _setName(commandID, newName) {\n        const command = CommandManager.get(commandID);\n        if (command) {\n            command.setName(newName);\n        }\n    }\n\n    function refreshCommitCounts() {\n        // Find Push and Pull buttons\n        var $pullBtn = $gitPanel.find(\".git-pull\");\n        var $pushBtn = $gitPanel.find(\".git-push\");\n        var clearCounts = function () {\n            $pullBtn.children(\"span\").remove();\n            $pushBtn.children(\"span\").remove();\n            _setName(Constants.CMD_GIT_PULL, Strings.PULL_SHORTCUT);\n            _setName(Constants.CMD_GIT_PUSH, Strings.PUSH_SHORTCUT);\n        };\n\n        // Check if there's a remote, resolve if there's not\n        var remotes = Preferences.get(\"defaultRemotes\") || {};\n        var defaultRemote = remotes[Preferences.get(\"currentGitRoot\")];\n        if (!defaultRemote) {\n            clearCounts();\n            return Promise.resolve();\n        }\n\n        // Get the commit counts and append them to the buttons\n        return Git.getCommitCounts().then(function (commits) {\n            clearCounts();\n            if (commits.behind > 0) {\n                $pullBtn.append($(\"<span/>\").text(\" (\" + commits.behind + \")\"));\n                _setName(Constants.CMD_GIT_PULL,\n                    StringUtils.format(Strings.PULL_SHORTCUT_BEHIND, commits.behind));\n            }\n            if (commits.ahead > 0) {\n                $pushBtn.append($(\"<span/>\").text(\" (\" + commits.ahead + \")\"));\n                _setName(Constants.CMD_GIT_PUSH,\n                    StringUtils.format(Strings.PUSH_SHORTCUT_AHEAD, commits.ahead));\n            }\n        }).catch(function (err) {\n            clearCounts();\n            ErrorHandler.logError(err);\n        });\n    }\n\n    function refresh() {\n        // set the history panel to false and remove the class that show the button history active when refresh\n        $gitPanel.find(\".git-history-toggle\").removeClass(\"active\").attr(\"title\", Strings.TOOLTIP_SHOW_HISTORY);\n        $gitPanel.find(\".git-file-history\").removeClass(\"active\").attr(\"title\", Strings.TOOLTIP_SHOW_FILE_HISTORY);\n\n        if (gitPanelMode === \"not-repo\") {\n            $tableContainer.empty();\n            return Promise.resolve();\n        }\n\n        $tableContainer.find(\"#git-history-list\").remove();\n        $tableContainer.find(\".git-edited-list\").show();\n\n        var p1 = Git.status().catch(function (err) {\n            // this is an expected \"error\"\n            if (ErrorHandler.contains(err, \"Not a git repository\")) {\n                return;\n            }\n        });\n\n        var p2 = refreshCommitCounts();\n\n        // Clone button\n        $gitPanel.find(\".git-clone\").prop(\"disabled\", false);\n\n        // FUTURE: who listens for this?\n        return Promise.all([p1, p2]);\n    }\n\n    function toggle(bool) {\n        if (gitPanelDisabled === true) {\n            return;\n        }\n        if (typeof bool !== \"boolean\") {\n            bool = !gitPanel.isVisible();\n        }\n        Preferences.set(\"panelEnabled\", bool);\n        Main.$icon.toggleClass(\"on\", bool);\n        Main.$icon.toggleClass(\"selected-button\", bool);\n        gitPanel.setVisible(bool);\n\n        // Mark menu item as enabled/disabled.\n        CommandManager.get(Constants.CMD_GIT_TOGGLE_PANEL).setChecked(bool);\n\n        if (bool) {\n            $(\"#git-toolbar-icon\").removeClass(\"forced-hidden\");\n            refresh();\n        }\n    }\n\n    function handleToggleUntracked() {\n        showingUntracked = !showingUntracked;\n        const command = CommandManager.get(Constants.CMD_GIT_TOGGLE_UNTRACKED);\n        if (command) {\n            command.setChecked(!showingUntracked);\n        }\n\n        refresh();\n    }\n\n    function commitCurrentFile() {\n        // do not return anything here, core expects jquery promise\n        jsPromise(CommandManager.execute(\"file.save\"))\n            .then(function () {\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath],\n                    false, COMMIT_MODE.CURRENT);\n            }).catch((err)=>{\n                console.error(err);\n                // rethrowing with stripped git error details as it may have sensitive info\n                throw new Error(\"Error commitCurrentFile in git panel.js. this should not have happened here.\");\n            });\n    }\n\n    function commitAllFiles() {\n        // do not return anything here, core expects jquery promise\n        jsPromise(CommandManager.execute(\"file.saveAll\"))\n            .then(function () {\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath],\n                    false, COMMIT_MODE.ALL);\n            }).catch((err)=>{\n                console.error(err);\n                // rethrowing with stripped git error details as it may have sensitive info\n                throw new Error(\"Error commitAllFiles in git panel.js. this should not have happened here.\");\n            });\n    }\n\n    // Disable \"commit\" button if there aren't staged files to commit\n    function _toggleCommitButton(files) {\n        var anyStaged = _.any(files, function (file) { return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1; });\n        $gitPanel.find(\".git-commit\").prop(\"disabled\", !anyStaged);\n    }\n\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (results) {\n        _refreshTableContainer(results);\n        _toggleCommitButton(results);\n    });\n\n    function undoLastLocalCommit() {\n        return Utils.askQuestion(Strings.UNDO_COMMIT, Strings.UNDO_LOCAL_COMMIT_CONFIRM, {booleanResponse: true})\n            .then(function (response) {\n                if (response) {\n                    Git.undoLastLocalCommit()\n                        .catch(function (err) {\n                            ErrorHandler.showError(err, Strings.ERROR_UNDO_LAST_COMMIT_FAILED);\n                        })\n                        .finally(function () {\n                            refresh();\n                        });\n                }\n            });\n    }\n\n    var lastCheckOneClicked = null;\n\n    function attachDefaultTableHandlers() {\n        $tableContainer = $gitPanel.find(\".table-container\")\n            .off()\n            .on(\"click\", \".check-one\", function (e) {\n                e.stopPropagation();\n                var $tr = $(this).closest(\"tr\"),\n                    file = $tr.attr(\"x-file\"),\n                    status = $tr.attr(\"x-status\"),\n                    isChecked = $(this).is(\":checked\");\n\n                if (e.shiftKey) {\n                    // stage/unstage all file between\n                    var lc = lastCheckOneClicked.localeCompare(file),\n                        lcClickedSelector = \"[x-file='\" + lastCheckOneClicked + \"']\",\n                        sequence;\n\n                    if (lc < 0) {\n                        sequence = $tr.prevUntil(lcClickedSelector).andSelf();\n                    } else if (lc > 0) {\n                        sequence = $tr.nextUntil(lcClickedSelector).andSelf();\n                    }\n\n                    if (sequence) {\n                        sequence = sequence.add($tr.parent().children(lcClickedSelector));\n                        var promises = sequence.map(function () {\n                            var $this = $(this),\n                                method = isChecked ? \"stage\" : \"unstage\",\n                                file = $this.attr(\"x-file\"),\n                                status = $this.attr(\"x-status\");\n                            return Git[method](file, status === Git.FILE_STATUS.DELETED);\n                        }).toArray();\n                        return Promise.all(promises).then(function () {\n                            return Git.status();\n                        }).catch(function (err) {\n                            ErrorHandler.showError(err, Strings.ERROR_MODIFY_FILE_STATUS_FAILED);\n                        });\n                    }\n                }\n\n                lastCheckOneClicked = file;\n\n                let stagePromise;\n                if (isChecked) {\n                    stagePromise = Git.stage(file, status === Git.FILE_STATUS.DELETED).then(function () {\n                        return Git.status();\n                    });\n                } else {\n                    stagePromise = Git.unstage(file).then(function () {\n                        return Git.status();\n                    });\n                }\n                stagePromise.catch((err)=>{\n                    ErrorHandler.showError(err, Strings.ERROR_STAGE_FAILED, {\n                        dontStripError: true,\n                        errorMetric: \"stageOne\",\n                        useNotification: true\n                    });\n                });\n            })\n            .on(\"dblclick\", \".check-one\", function (e) {\n                e.stopPropagation();\n            })\n            .on(\"click\", \".btn-git-diff\", function (e) {\n                e.stopPropagation();\n                handleGitDiff($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"click\", \".btn-git-undo\", function (e) {\n                e.stopPropagation();\n                handleGitUndo($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"click\", \".btn-git-delete\", function (e) {\n                e.stopPropagation();\n                handleGitDelete($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"mousedown\", \".modified-file\", function (e) {\n                var $this = $(e.currentTarget);\n                // we listen on mousedown event for faster file switch perception. but this results in\n                // this handler getting triggered before the above click handlers for table buttons and\n                // Check boxes. So we do a check to see if the clicked element is NOT a button,\n                // input, or tag inside a button.\n                if ($(e.target).is(\"button, input\") || $(e.target).closest(\"button\").length) {\n                    return;\n                }\n                if ($this.attr(\"x-status\") === Git.FILE_STATUS.DELETED) {\n                    return;\n                }\n                CommandManager.execute(Commands.FILE_OPEN, {\n                    fullPath: Preferences.get(\"currentGitRoot\") + $this.attr(\"x-file\")\n                });\n            })\n            .on(\"dblclick\", \".modified-file\", function (e) {\n                var $this = $(e.currentTarget);\n                if ($this.attr(\"x-status\") === Git.FILE_STATUS.DELETED) {\n                    return;\n                }\n                FileViewController.openFileAndAddToWorkingSet(Preferences.get(\"currentGitRoot\") + $this.attr(\"x-file\"));\n            });\n\n    }\n\n    EventEmitter.on(Events.GIT_CHANGE_USERNAME, function (callback) {\n        return Git.getConfig(\"user.name\").then(function (currentUserName) {\n            return Utils.askQuestion(Strings.CHANGE_USER_NAME_TITLE, Strings.ENTER_NEW_USER_NAME, { defaultValue: currentUserName })\n                .then(function (userName) {\n                    if (!userName.length) { userName = currentUserName; }\n                    return Git.setConfig(\"user.name\", userName, true).catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CHANGE_USERNAME_FAILED);\n                    }).then(function () {\n                        EventEmitter.emit(Events.GIT_USERNAME_CHANGED, userName);\n                    }).finally(function () {\n                        if (callback) {\n                            callback(userName);\n                        }\n                    });\n                });\n        });\n    });\n\n    EventEmitter.on(Events.GIT_CHANGE_EMAIL, function (callback) {\n        return Git.getConfig(\"user.email\").then(function (currentUserEmail) {\n            return Utils.askQuestion(Strings.CHANGE_USER_EMAIL_TITLE, Strings.ENTER_NEW_USER_EMAIL, { defaultValue: currentUserEmail })\n                .then(function (userEmail) {\n                    if (!userEmail.length) { userEmail = currentUserEmail; }\n                    return Git.setConfig(\"user.email\", userEmail, true).catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CHANGE_EMAIL_FAILED);\n                    }).then(function () {\n                        EventEmitter.emit(Events.GIT_EMAIL_CHANGED, userEmail);\n                    }).finally(function () {\n                        if (callback) {\n                            callback(userEmail);\n                        }\n                    });\n                });\n        });\n    });\n\n    EventEmitter.on(Events.GERRIT_TOGGLE_PUSH_REF, function () {\n        // update preference and emit so the menu item updates\n        return Git.getConfig(\"gerrit.pushref\").then(function (strEnabled) {\n            var toggledValue = strEnabled !== \"true\";\n\n            // Set the global preference\n            // Saving a preference to tell the GitCli.push() method to check for gerrit push ref enablement\n            // so we don't slow down people who aren't using gerrit.\n            Preferences.set(\"gerritPushref\", toggledValue);\n\n            return Git.setConfig(\"gerrit.pushref\", toggledValue, true)\n                .then(function () {\n                    EventEmitter.emit(Events.GERRIT_PUSH_REF_TOGGLED, toggledValue);\n                });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_TOGGLE_GERRIT_PUSH_REF_FAILED);\n        });\n    });\n\n    EventEmitter.on(Events.GERRIT_PUSH_REF_TOGGLED, function (enabled) {\n        setGerritCheckState(enabled);\n    });\n\n    function setGerritCheckState(enabled) {\n        const command = CommandManager.get(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        if (command) {\n            command.setChecked(enabled);\n        }\n    }\n\n    function discardAllChanges() {\n        return Utils.askQuestion(Strings.RESET_LOCAL_REPO, Strings.RESET_LOCAL_REPO_CONFIRM, {\n            booleanResponse: true, customOkBtn: Strings.DISCARD_CHANGES, customOkBtnClass: \"danger\"})\n            .then(function (response) {\n                if (response) {\n                    return Git.discardAllChanges().catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_RESET_LOCAL_REPO_FAILED);\n                    }).then(function () {\n                        refresh();\n                    });\n                }\n            });\n    }\n\n    /**\n     * Retrieves the hash of the selected history commit in the panel. if panel not visible\n     * or if there is no selection, returns null.\n     *\n     * @returns {{hash: string, subject: string}|{}} The `hash` value and commit string\n     *              of the selected history commit if visible, otherwise {}.\n     */\n    function getSelectedHistoryCommit() {\n        const $historyRow = $(\".history-commit.selected\");\n        if($historyRow.is(\":visible\")){\n            return {\n                hash: $historyRow.attr(\"x-hash\"),\n                subject: $historyRow.find(\".commit-subject\").text()\n            };\n        }\n        return {};\n    }\n\n    function _panelResized(_entries) {\n        if(!$mainToolbar || !$mainToolbar.is(\":visible\")){\n            return;\n        }\n        const mainToolbarWidth = $mainToolbar.width();\n        let overFlowWidth = 565;\n        const breakpoints = [\n            { width: overFlowWidth, className: \"hide-when-small\" },\n            { width: 400, className: \"hide-when-x-small\" }\n        ];\n\n        if(mainToolbarWidth < overFlowWidth) {\n            $gitPanel.find(\".mainToolbar\").addClass(\"hide-overflow\");\n        } else {\n            $gitPanel.find(\".mainToolbar\").removeClass(\"hide-overflow\");\n        }\n        breakpoints.forEach(bp => {\n            if (mainToolbarWidth < bp.width) {\n                $gitPanel.find(`.${bp.className}`).addClass(\"forced-hidden\");\n            } else {\n                $gitPanel.find(`.${bp.className}`).removeClass(\"forced-hidden\");\n            }\n        });\n    }\n\n    function init() {\n        // Add panel\n        var panelHtml = Mustache.render(gitPanelTemplate, {\n            S: Strings\n        });\n        var $panelHtml = $(panelHtml);\n        $panelHtml.find(\".git-available, .git-not-available\").hide();\n\n        gitPanel = WorkspaceManager.createBottomPanel(\"main-git.panel\", $panelHtml, 100);\n        $gitPanel = gitPanel.$panel;\n        const resizeObserver = new ResizeObserver(_panelResized);\n        resizeObserver.observe($gitPanel[0]);\n        $mainToolbar = $gitPanel.find(\".mainToolbar\");\n        $gitPanel\n            .on(\"click\", \".close\", toggle)\n            .on(\"click\", \".check-all\", function () {\n                if ($(this).is(\":checked\")) {\n                    return Git.stageAll().then(function () {\n                        return Git.status();\n                    }).catch((err)=>{\n                        // this usually happens hwen a git index is locked Eg. error.\n                        //  Error: Error: fatal: Unable to create 'E:/.../test-git/.git/index.lock': File exists.\n                        //\n                        // Another git process seems to be running in this repository, e.g.\n                        // an editor opened by 'git commit'. Please make sure all processes\n                        // are terminated then try again. If it still fails, a git process\n                        // may have crashed in this repository earlier:\n                        // remove the file manually to continue.\n                        ErrorHandler.showError(err, Strings.ERROR_STAGE_FAILED, {\n                            dontStripError: true,\n                            errorMetric: \"stageAll\",\n                            useNotification: true\n                        });\n                    });\n                }\n                return Git.resetIndex().then(function () {\n                    return Git.status();\n                }).catch((err)=>{\n                    console.error(err);\n                    // rethrowing with stripped git error details as it may have sensitive info\n                    throw new Error(\"Error unstage all by checkbox in git panel.js. this should not have happened\");\n                });\n            })\n            .on(\"click\", \".git-refresh\", EventEmitter.getEmitter(Events.REFRESH_ALL, [\"panel\", \"refreshBtn\"]))\n            .on(\"click\", \".git-commit\", EventEmitter.getEmitter(Events.HANDLE_GIT_COMMIT))\n            .on(\"click\", \".git-rebase-continue\", function (e) { handleRebase(\"continue\", e); })\n            .on(\"click\", \".git-rebase-skip\", function (e) { handleRebase(\"skip\", e); })\n            .on(\"click\", \".git-rebase-abort\", function (e) { handleRebase(\"abort\", e); })\n            .on(\"click\", \".git-commit-merge\", commitMerge)\n            .on(\"click\", \".git-merge-abort\", abortMerge)\n            .on(\"click\", \".git-find-conflicts\", findConflicts)\n            .on(\"click\", \".git-prev-gutter\", ()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"prevBtn\");\n                GutterManager.goToPrev();\n            })\n            .on(\"click\", \".git-next-gutter\", ()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"nextBtn\");\n                GutterManager.goToNext();\n            })\n            .on(\"click\", \".git-file-history\", EventEmitter.getEmitter(Events.HISTORY_SHOW_FILE))\n            .on(\"click\", \".git-history-toggle\", EventEmitter.getEmitter(Events.HISTORY_SHOW_GLOBAL))\n            .on(\"click\", \".git-fetch\", EventEmitter.getEmitter(Events.HANDLE_FETCH, [\"panel\", \"fetchBtn\"]))\n            .on(\"click\", \".git-push\", function () {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"pushBtn\");\n                var typeOfRemote = $(this).attr(\"x-selected-remote-type\");\n                if (typeOfRemote === \"git\") {\n                    EventEmitter.emit(Events.HANDLE_PUSH);\n                }\n            })\n            .on(\"click\", \".git-pull\", EventEmitter.getEmitter(Events.HANDLE_PULL, [\"panel\", \"pullBtn\"]))\n            .on(\"click\", \".git-init\", EventEmitter.getEmitter(Events.HANDLE_GIT_INIT))\n            .on(\"click\", \".git-clone\", EventEmitter.getEmitter(Events.HANDLE_GIT_CLONE))\n            .on(\"click\", \".change-remote\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_PICK, [\"panel\", \"changeRemote\"]))\n            .on(\"click\", \".remove-remote\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_DELETE, [\"panel\", \"removeRemote\"]))\n            .on(\"click\", \".git-remote-new\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_CREATE, [\"panel\", \"newRemote\"]))\n            .on(\"contextmenu\", \"tr\", function (e) {\n                const $this = $(this);\n                if ($this.hasClass(\"history-commit\")) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'cmenu', \"history\");\n                    if(!$this.hasClass(\"selected\")){\n                        $this.click();\n                    }\n                    Menus.getContextMenu(Constants.GIT_PANEL_HISTORY_CMENU).open(e);\n                    return;\n                }\n\n                $this.click();\n                setTimeout(function () {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'cmenu', \"filechanges\");\n                    Menus.getContextMenu(Constants.GIT_PANEL_CHANGES_CMENU).open(e);\n                }, 1);\n            });\n\n        // Attaching table handlers\n        attachDefaultTableHandlers();\n\n        // Add command to menu.\n        CommandManager.register(Strings.PANEL_COMMAND, Constants.CMD_GIT_TOGGLE_PANEL, toggle);\n        CommandManager.register(Strings.COMMIT_CURRENT_SHORTCUT, Constants.CMD_GIT_COMMIT_CURRENT, commitCurrentFile);\n        CommandManager.register(Strings.COMMIT_ALL_SHORTCUT, Constants.CMD_GIT_COMMIT_ALL, commitAllFiles);\n        CommandManager.register(Strings.PUSH_SHORTCUT, Constants.CMD_GIT_PUSH, EventEmitter.getEmitter(Events.HANDLE_PUSH));\n        CommandManager.register(Strings.PULL_SHORTCUT, Constants.CMD_GIT_PULL, EventEmitter.getEmitter(Events.HANDLE_PULL));\n        CommandManager.register(Strings.FETCH_SHORTCUT, Constants.CMD_GIT_FETCH, EventEmitter.getEmitter(Events.HANDLE_FETCH));\n        CommandManager.register(Strings.GOTO_PREVIOUS_GIT_CHANGE, Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE, GutterManager.goToPrev);\n        CommandManager.register(Strings.GOTO_NEXT_GIT_CHANGE, Constants.CMD_GIT_GOTO_NEXT_CHANGE, GutterManager.goToNext);\n        CommandManager.register(Strings.REFRESH_GIT, Constants.CMD_GIT_REFRESH, EventEmitter.getEmitter(Events.REFRESH_ALL));\n        CommandManager.register(Strings.RESET_LOCAL_REPO, Constants.CMD_GIT_DISCARD_ALL_CHANGES, discardAllChanges);\n        CommandManager.register(Strings.UNDO_LAST_LOCAL_COMMIT, Constants.CMD_GIT_UNDO_LAST_COMMIT, undoLastLocalCommit);\n        CommandManager.register(Strings.CHANGE_USER_NAME, Constants.CMD_GIT_CHANGE_USERNAME, EventEmitter.getEmitter(Events.GIT_CHANGE_USERNAME));\n        CommandManager.register(Strings.CHANGE_USER_EMAIL, Constants.CMD_GIT_CHANGE_EMAIL, EventEmitter.getEmitter(Events.GIT_CHANGE_EMAIL));\n        CommandManager.register(Strings.ENABLE_GERRIT_PUSH_REF, Constants.CMD_GIT_GERRIT_PUSH_REF, EventEmitter.getEmitter(Events.GERRIT_TOGGLE_PUSH_REF));\n        CommandManager.register(Strings.VIEW_AUTHORS_SELECTION, Constants.CMD_GIT_AUTHORS_OF_SELECTION, handleAuthorsSelection);\n        CommandManager.register(Strings.VIEW_AUTHORS_FILE, Constants.CMD_GIT_AUTHORS_OF_FILE, handleAuthorsFile);\n        CommandManager.register(Strings.HIDE_UNTRACKED, Constants.CMD_GIT_TOGGLE_UNTRACKED, handleToggleUntracked);\n        CommandManager.register(Strings.GIT_INIT, Constants.CMD_GIT_INIT, EventEmitter.getEmitter(Events.HANDLE_GIT_INIT));\n        CommandManager.register(Strings.GIT_CLONE, Constants.CMD_GIT_CLONE, EventEmitter.getEmitter(Events.HANDLE_GIT_CLONE));\n        CommandManager.register(Strings.GIT_SHOW_HISTORY, Constants.CMD_GIT_HISTORY_GLOBAL, ()=>{\n            toggle(true);\n            EventEmitter.emit(Events.HISTORY_SHOW_GLOBAL);\n        });\n        CommandManager.register(Strings.GIT_SHOW_FILE_HISTORY, Constants.CMD_GIT_HISTORY_FILE, ()=>{\n            toggle(true);\n            EventEmitter.emit(Events.HISTORY_SHOW_FILE);\n        });\n\n        // Show gitPanel when appropriate\n        if (Preferences.get(\"panelEnabled\") && Setup.isExtensionActivated()) {\n            toggle(true);\n        }\n        _panelResized();\n        GutterManager.init();\n    } // function init() {\n\n    function enable() {\n        EventEmitter.emit(Events.GIT_ENABLED);\n        // this function is called after every Branch.refresh\n        gitPanelMode = null;\n        //\n        $gitPanel.find(\".git-available\").show();\n        $gitPanel.find(\".git-not-available\").hide();\n        Utils.enableCommand(Constants.CMD_GIT_INIT, false);\n        Utils.enableCommand(Constants.CMD_GIT_CLONE, false);\n        //\n        Main.$icon.removeClass(\"warning\");\n        gitPanelDisabled = false;\n        // after all is enabled\n        refresh();\n    }\n\n    function disable(cause) {\n        EventEmitter.emit(Events.GIT_DISABLED, cause);\n        gitPanelMode = cause;\n        // causes: not-repo\n        if (gitPanelMode === \"not-repo\") {\n            $gitPanel.find(\".git-available\").hide();\n            $gitPanel.find(\".git-not-available\").show();\n            Utils.enableCommand(Constants.CMD_GIT_INIT, true);\n            Utils.enableCommand(Constants.CMD_GIT_CLONE, true);\n        } else {\n            Main.$icon.addClass(\"warning\");\n            toggle(false);\n            gitPanelDisabled = true;\n        }\n        refresh();\n    }\n\n    // Event listeners\n    EventEmitter.on(Events.GIT_USERNAME_CHANGED, function (userName) {\n        if(userName){\n            _setName(Constants.CMD_GIT_CHANGE_USERNAME,\n                StringUtils.format(Strings.CHANGE_USER_NAME_MENU, userName));\n        } else {\n            _setName(Constants.CMD_GIT_CHANGE_USERNAME, Strings.CHANGE_USER_NAME);\n        }\n    });\n\n    EventEmitter.on(Events.GIT_EMAIL_CHANGED, function (email) {\n        $gitPanel.find(\".git-user-email\").text(email);\n        if(email){\n            _setName(Constants.CMD_GIT_CHANGE_EMAIL,\n                StringUtils.format(Strings.CHANGE_USER_EMAIL_MENU, email));\n        } else {\n            _setName(Constants.CMD_GIT_CHANGE_EMAIL, Strings.CHANGE_USER_EMAIL);\n        }\n    });\n\n    EventEmitter.on(Events.GIT_REMOTE_AVAILABLE, function () {\n        $gitPanel.find(\".git-pull, .git-push, .git-fetch\").prop(\"disabled\", false);\n    });\n\n    EventEmitter.on(Events.GIT_REMOTE_NOT_AVAILABLE, function () {\n        $gitPanel.find(\".git-pull, .git-push, .git-fetch\").prop(\"disabled\", true);\n    });\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        if(!StateManager.get(GIT_PANEL_SHOWN_ON_FIRST_BOOT)){\n            StateManager.set(GIT_PANEL_SHOWN_ON_FIRST_BOOT, true);\n            toggle(true);\n            NotificationUI.createFromTemplate(\n                Strings.GIT_TOAST_TITLE,\n                Strings.GIT_TOAST_MESSAGE,\n                \"git-toolbar-icon\", {\n                    allowedPlacements: ['left'],\n                    dismissOnClick: true,\n                    toastStyle: \"width-250\"\n                }\n            );\n        }\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'project', \"enabled\");\n        // Add info from Git to panel\n        Git.getConfig(\"user.name\").then(function (currentUserName) {\n            EventEmitter.emit(Events.GIT_USERNAME_CHANGED, currentUserName);\n        });\n        Git.getConfig(\"user.email\").then(function (currentEmail) {\n            EventEmitter.emit(Events.GIT_EMAIL_CHANGED, currentEmail);\n        });\n        Git.getConfig(\"gerrit.pushref\").then(function (strEnabled) {\n            var enabled = strEnabled === \"true\";\n            // Handle the case where we switched to a repo that is using gerrit\n            if (enabled && !Preferences.get(\"gerritPushref\")) {\n                Preferences.set(\"gerritPushref\", true);\n            }\n            EventEmitter.emit(Events.GERRIT_PUSH_REF_TOGGLED, enabled);\n        });\n    });\n\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function () {\n        if (!gitPanel) { return; }\n        refreshCurrentFile();\n    });\n\n    EventEmitter.on(Events.BRACKETS_DOCUMENT_SAVED, function () {\n        if (!gitPanel) { return; }\n        refresh();\n    });\n\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (fileSystemEntry) {\n        // files are added or deleted from the directory\n        if (fileSystemEntry.isDirectory) {\n            refresh();\n        }\n    });\n\n    EventEmitter.on(Events.REBASE_MERGE_MODE, function (rebaseEnabled, mergeEnabled) {\n        $gitPanel.find(\".git-rebase\").toggle(rebaseEnabled);\n        $gitPanel.find(\".git-merge\").toggle(mergeEnabled);\n        $gitPanel.find(\"button.git-commit\").toggle(!rebaseEnabled && !mergeEnabled);\n    });\n\n    EventEmitter.on(Events.FETCH_STARTED, function () {\n        $gitPanel.find(\".git-fetch\")\n            .addClass(\"btn-loading\")\n            .prop(\"disabled\", true);\n    });\n\n    EventEmitter.on(Events.FETCH_COMPLETE, function () {\n        $gitPanel.find(\".git-fetch\")\n            .removeClass(\"btn-loading\")\n            .prop(\"disabled\", false);\n        refreshCommitCounts();\n    });\n\n    EventEmitter.on(Events.REFRESH_COUNTERS, function () {\n        refreshCommitCounts();\n    });\n\n    EventEmitter.on(Events.HANDLE_GIT_COMMIT, function () {\n        handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath], false, COMMIT_MODE.DEFAULT);\n    });\n\n    exports.init = init;\n    exports.refresh = refresh;\n    exports.toggle = toggle;\n    exports.enable = enable;\n    exports.disable = disable;\n    exports.getSelectedHistoryCommit = getSelectedHistoryCommit;\n    exports.getPanel = function () { return $gitPanel; };\n\n});\n\ndefine(\"src/Preferences\", function (require, exports, module) {\n\n    var _                   = brackets.getModule(\"thirdparty/lodash\"),\n        PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        StateManager        = PreferencesManager.stateManager,\n        prefix              = \"git\";\n\n    var defaultPreferences = {\n        // features\n        \"stripWhitespaceFromCommits\": {     \"type\": \"boolean\",           \"value\": true              },\n        \"addEndlineToTheEndOfFile\": {       \"type\": \"boolean\",           \"value\": true              },\n        \"removeByteOrderMark\": {            \"type\": \"boolean\",           \"value\": false             },\n        \"normalizeLineEndings\": {           \"type\": \"boolean\",           \"value\": false             },\n        \"useGitGutter\": {                   \"type\": \"boolean\",           \"value\": true              },\n        \"markModifiedInTree\": {             \"type\": \"boolean\",           \"value\": true              },\n        \"useVerboseDiff\": {                 \"type\": \"boolean\",           \"value\": false             },\n        \"useDifftool\": {                    \"type\": \"boolean\",           \"value\": false             },\n        \"clearWhitespaceOnSave\": {          \"type\": \"boolean\",           \"value\": false             },\n        \"gerritPushref\": {                  \"type\": \"boolean\",           \"value\": false             },\n        // system\n        \"enableGit\": {                      \"type\": \"boolean\",           \"value\": true              },\n        \"gitTimeout\": {                     \"type\": \"number\",            \"value\": 30                },\n        \"gitPath\": {                        \"type\": \"string\",            \"value\": \"\"                }\n    };\n\n    var prefs = PreferencesManager.getExtensionPrefs(prefix);\n    _.each(defaultPreferences, function (definition, key) {\n        if (definition.os && definition.os[brackets.platform]) {\n            prefs.definePreference(key, definition.type, definition.os[brackets.platform].value);\n        } else {\n            prefs.definePreference(key, definition.type, definition.value);\n        }\n    });\n    prefs.save();\n\n    function get(key) {\n        var location = defaultPreferences[key] ? PreferencesManager : StateManager;\n        arguments[0] = prefix + \".\" + key;\n        return location.get.apply(location, arguments);\n    }\n\n    function set(key) {\n        var location = defaultPreferences[key] ? PreferencesManager : StateManager;\n        arguments[0] = prefix + \".\" + key;\n        return location.set.apply(location, arguments);\n    }\n\n    function getAll() {\n        var obj = {};\n        _.each(defaultPreferences, function (definition, key) {\n            obj[key] = get(key);\n        });\n        return obj;\n    }\n\n    function getDefaults() {\n        var obj = {};\n        _.each(defaultPreferences, function (definition, key) {\n            var defaultValue;\n            if (definition.os && definition.os[brackets.platform]) {\n                defaultValue = definition.os[brackets.platform].value;\n            } else {\n                defaultValue = definition.value;\n            }\n            obj[key] = defaultValue;\n        });\n        return obj;\n    }\n\n    function getType(key) {\n        return defaultPreferences[key].type;\n    }\n\n    function getGlobal(key) {\n        return PreferencesManager.get(key);\n    }\n\n    function getExtensionPref() {\n        return prefs;\n    }\n\n    function save() {\n        PreferencesManager.save();\n    }\n\n    module.exports = {\n        get: get,\n        set: set,\n        getAll: getAll,\n        getDefaults: getDefaults,\n        getType: getType,\n        getGlobal: getGlobal,\n        getExtensionPref: getExtensionPref,\n        save: save\n    };\n\n});\n\ndefine(\"src/ProjectTreeMarks\", function (require) {\n\n    var _                 = brackets.getModule(\"thirdparty/lodash\"),\n        FileSystem        = brackets.getModule(\"filesystem/FileSystem\"),\n        ProjectManager    = brackets.getModule(\"project/ProjectManager\");\n\n    var EventEmitter      = require(\"src/EventEmitter\"),\n        Events            = require(\"src/Events\"),\n        Git               = require(\"src/git/Git\"),\n        Preferences       = require(\"src/Preferences\");\n\n    var ignoreEntries = [],\n        newPaths      = [],\n        modifiedPaths = [];\n\n    if (!Preferences.get(\"markModifiedInTree\")) {\n        // end here, no point in processing the code below\n        return;\n    }\n\n    function loadIgnoreContents() {\n        return new Promise((resolve)=>{\n            let gitRoot = Preferences.get(\"currentGitRoot\"),\n                excludeContents,\n                gitignoreContents;\n\n            const finish = _.after(2, function () {\n                resolve(excludeContents + \"\\n\" + gitignoreContents);\n            });\n\n            FileSystem.getFileForPath(gitRoot + \".git/info/exclude\").read(function (err, content) {\n                excludeContents = err ? \"\" : content;\n                finish();\n            });\n\n            FileSystem.getFileForPath(gitRoot + \".gitignore\").read(function (err, content) {\n                gitignoreContents = err ? \"\" : content;\n                finish();\n            });\n\n        });\n    }\n\n    function refreshIgnoreEntries() {\n        function regexEscape(str) {\n            // NOTE: We cannot use StringUtils.regexEscape() here because we don't wanna replace *\n            return str.replace(/([.?+\\^$\\\\(){}|])/g, \"\\\\$1\");\n        }\n\n        return loadIgnoreContents().then(function (content) {\n            var gitRoot = Preferences.get(\"currentGitRoot\");\n\n            ignoreEntries = _.compact(_.map(content.split(\"\\n\"), function (line) {\n                // Rules: http://git-scm.com/docs/gitignore\n                var type = \"deny\",\n                    leadingSlash,\n                    trailingSlash,\n                    regex;\n\n                line = line.trim();\n                if (!line || line.indexOf(\"#\") === 0) {\n                    return;\n                }\n\n                // handle explicitly allowed files/folders with a leading !\n                if (line.indexOf(\"!\") === 0) {\n                    line = line.slice(1);\n                    type = \"accept\";\n                }\n                // handle lines beginning with a backslash, which is used for escaping ! or #\n                if (line.indexOf(\"\\\\\") === 0) {\n                    line = line.slice(1);\n                }\n                // handle lines beginning with a slash, which only matches files/folders in the root dir\n                if (line.indexOf(\"/\") === 0) {\n                    line = line.slice(1);\n                    leadingSlash = true;\n                }\n                // handle lines ending with a slash, which only exludes dirs\n                if (line.lastIndexOf(\"/\") === line.length) {\n                    // a line ending with a slash ends with **\n                    line += \"**\";\n                    trailingSlash = true;\n                }\n\n                // NOTE: /(.{0,})/ is basically the same as /(.*)/, but we can't use it because the asterisk\n                // would be replaced later on\n\n                // create the intial regexp here. We need the absolute path 'cause it could be that there\n                // are external files with the same name as a project file\n                regex = regexEscape(gitRoot) + (leadingSlash ? \"\" : \"((.+)/)?\") + regexEscape(line) + (trailingSlash ? \"\" : \"(/.{0,})?\");\n                // replace all the possible asterisks\n                regex = regex.replace(/\\*\\*$/g, \"(.{0,})\").replace(/(\\*\\*|\\*$)/g, \"(.+)\").replace(/\\*/g, \"([^/]*)\");\n                regex = \"^\" + regex + \"$\";\n\n                return {\n                    regexp: new RegExp(regex),\n                    type: type\n                };\n            }));\n        });\n    }\n\n    function isIgnored(path) {\n        var ignored = false;\n        _.forEach(ignoreEntries, function (entry) {\n            if (entry.regexp.test(path)) {\n                ignored = (entry.type === \"deny\");\n            }\n        });\n        return ignored;\n    }\n\n    function isNew(fullPath) {\n        return newPaths.indexOf(fullPath) !== -1;\n    }\n\n    function isModified(fullPath) {\n        return modifiedPaths.indexOf(fullPath) !== -1;\n    }\n\n    ProjectManager.addClassesProvider(function (data) {\n        var fullPath = data.fullPath;\n        if (isIgnored(fullPath)) {\n            return \"git-ignored\";\n        } else if (isNew(fullPath)) {\n            return \"git-new\";\n        } else if (isModified(fullPath)) {\n            return \"git-modified\";\n        }\n    });\n\n    function _refreshOpenFiles() {\n        $(\"#working-set-list-container\").find(\"li\").each(function () {\n            var $li = $(this),\n                data = $li.data(\"file\");\n            if (data) {\n                var fullPath = data.fullPath;\n                $li.toggleClass(\"git-ignored\", isIgnored(fullPath))\n                   .toggleClass(\"git-new\", isNew(fullPath))\n                   .toggleClass(\"git-modified\", isModified(fullPath));\n            }\n        });\n    }\n\n    var refreshOpenFiles = _.debounce(function () {\n        _refreshOpenFiles();\n    }, 100);\n\n    function attachEvents() {\n        $(\"#working-set-list-container\").on(\"contentChanged\", refreshOpenFiles).triggerHandler(\"contentChanged\");\n    }\n\n    function detachEvents() {\n        $(\"#working-set-list-container\").off(\"contentChanged\", refreshOpenFiles);\n    }\n\n    // this will refresh ignore entries when .gitignore is modified\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (file) {\n        if (file.fullPath === Preferences.get(\"currentGitRoot\") + \".gitignore\") {\n            refreshIgnoreEntries().finally(function () {\n                refreshOpenFiles();\n            });\n        }\n    });\n\n    // this will refresh new/modified paths on every status results\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (files) {\n        var gitRoot = Preferences.get(\"currentGitRoot\");\n\n        newPaths = [];\n        modifiedPaths = [];\n\n        files.forEach(function (entry) {\n            var isNew = entry.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1 ||\n                        entry.status.indexOf(Git.FILE_STATUS.ADDED) !== -1;\n\n            var fullPath = gitRoot + entry.file;\n            if (isNew) {\n                newPaths.push(fullPath);\n            } else {\n                modifiedPaths.push(fullPath);\n            }\n        });\n\n        ProjectManager.rerenderTree();\n        refreshOpenFiles();\n    });\n\n    // this will refresh ignore entries when git project is opened\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        refreshIgnoreEntries();\n        attachEvents();\n    });\n\n    // this will clear entries when non-git project is opened\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        ignoreEntries = [];\n        newPaths      = [];\n        modifiedPaths = [];\n        detachEvents();\n    });\n\n});\n\ndefine(\"src/Remotes\", function (require) {\n\n    // Brackets modules\n    var _               = brackets.getModule(\"thirdparty/lodash\"),\n        DefaultDialogs  = brackets.getModule(\"widgets/DefaultDialogs\"),\n        Dialogs         = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache        = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics         = brackets.getModule(\"utils/Metrics\"),\n        Strings         = brackets.getModule(\"strings\"),\n        StringUtils     = brackets.getModule(\"utils/StringUtils\");\n\n    // Local modules\n    var ErrorHandler    = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"src/Preferences\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\"),\n        PullDialog      = require(\"src/dialogs/Pull\"),\n        PushDialog      = require(\"src/dialogs/Push\"),\n        Utils           = require(\"src/Utils\");\n\n    // Templates\n    var gitRemotesPickerTemplate = `<!-- List of remotes defined for the current local repository -->\n{{#remotes}}\n<li class=\"remote\">\n    <a href=\"#\" data-remote-name=\"{{name}}\" data-type=\"git\" class=\"remote-name\">\n        {{#deletable}}<span class=\"trash-icon hover-icon remove-remote\">&times;</span>{{/deletable}}\n        <span class=\"change-remote\">{{name}}</span>\n    </a>\n</li>\n{{/remotes}}\n<li><a class=\"git-remote-new\"><span>{{Strings.CREATE_NEW_REMOTE}}</span></a></li>\n`;\n\n    // Module variables\n    var $selectedRemote  = null,\n        $remotesDropdown = null,\n        $gitPanel = null,\n        $gitPush = null;\n\n    function initVariables() {\n        $gitPanel = $(\"#git-panel\");\n        $selectedRemote = $gitPanel.find(\".git-selected-remote\");\n        $remotesDropdown = $gitPanel.find(\".git-remotes-dropdown\");\n        $gitPush = $gitPanel.find(\".git-push\");\n    }\n\n    // Implementation\n\n    function getDefaultRemote(allRemotes) {\n        var defaultRemotes = Preferences.get(\"defaultRemotes\") || {},\n            candidate = defaultRemotes[Preferences.get(\"currentGitRoot\")];\n\n        var exists = _.find(allRemotes, function (remote) {\n            return remote.name === candidate;\n        });\n        if (!exists) {\n            candidate = null;\n            if (allRemotes.length > 0) {\n                candidate = _.first(allRemotes).name;\n            }\n        }\n\n        return candidate;\n    }\n\n    function setDefaultRemote(remoteName) {\n        var defaultRemotes = Preferences.get(\"defaultRemotes\") || {};\n        defaultRemotes[Preferences.get(\"currentGitRoot\")] = remoteName;\n        Preferences.set(\"defaultRemotes\", defaultRemotes);\n    }\n\n    function clearRemotePicker() {\n        $selectedRemote\n            .html(\"&mdash;\")\n            .data(\"remote\", null);\n    }\n\n    function selectRemote(remoteName, type) {\n        if (!remoteName) {\n            return clearRemotePicker();\n        }\n\n        // Set as default remote only if is a normal git remote\n        if (type === \"git\") { setDefaultRemote(remoteName); }\n\n        // Disable pull if it is not a normal git remote\n        $gitPanel.find(\".git-pull\").prop(\"disabled\", type !== \"git\");\n\n        // Enable push and set selected-remote-type to Git push button by type of remote\n        $gitPush\n            .prop(\"disabled\", false)\n            .attr(\"x-selected-remote-type\", type);\n\n        // Update remote name of $selectedRemote\n        $selectedRemote\n            .text(remoteName)\n            .attr(\"data-type\", type) // use attr to apply CSS styles\n            .data(\"remote\", remoteName);\n    }\n\n    function refreshRemotesPicker() {\n        Git.getRemotes().then(function (remotes) {\n            // Set default remote name and cache the remotes dropdown menu\n            var defaultRemoteName = getDefaultRemote(remotes);\n\n            // Disable Git-push and Git-pull if there are not remotes defined\n            $gitPanel\n                .find(\".git-pull, .git-push, .git-fetch\")\n                .prop(\"disabled\", remotes.length === 0);\n\n            // Add options to change remote\n            remotes.forEach(function (remote) {\n                remote.deletable = remote.name !== \"origin\";\n            });\n\n            // Pass to Mustache the needed data\n            var compiledTemplate = Mustache.render(gitRemotesPickerTemplate, {\n                Strings: Strings,\n                remotes: remotes\n            });\n\n            // Inject the rendered template inside the $remotesDropdown\n            $remotesDropdown.html(compiledTemplate);\n\n            // Notify others that they may add more stuff to this dropdown\n            EventEmitter.emit(Events.REMOTES_REFRESH_PICKER);\n            // TODO: is it possible to wait for listeners to finish?\n\n            // TODO: if there're no remotes but there are some ftp remotes\n            // we need to adjust that something other may be put as default\n            // low priority\n            if (remotes.length > 0) {\n                selectRemote(defaultRemoteName, \"git\");\n            } else {\n                clearRemotePicker();\n            }\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GETTING_REMOTES);\n        });\n    }\n\n    function handleRemoteCreation() {\n        return Utils.askQuestion(Strings.CREATE_NEW_REMOTE, Strings.ENTER_REMOTE_NAME)\n            .then(function (name) {\n                return Utils.askQuestion(Strings.CREATE_NEW_REMOTE, Strings.ENTER_REMOTE_URL).then(function (url) {\n                    return [name, url];\n                });\n            })\n            .then(function ([name, url]) {\n                return Git.createRemote(name, url).then(function () {\n                    return refreshRemotesPicker();\n                });\n            })\n            .catch(function (err) {\n                if (!ErrorHandler.equals(err, Strings.USER_ABORTED)) {\n                    ErrorHandler.showError(err, Strings.ERROR_REMOTE_CREATION);\n                }\n            });\n    }\n\n    function deleteRemote(remoteName) {\n        return Utils.askQuestion(Strings.DELETE_REMOTE, StringUtils.format(Strings.DELETE_REMOTE_NAME, remoteName), { booleanResponse: true })\n            .then(function (response) {\n                if (response === true) {\n                    return Git.deleteRemote(remoteName).then(function () {\n                        return refreshRemotesPicker();\n                    });\n                }\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n            });\n    }\n\n    function showPushResult(result) {\n        if (typeof result.remoteUrl === \"string\") {\n            result.remoteUrl = Utils.encodeSensitiveInformation(result.remoteUrl);\n        }\n\n        var template = [\n            \"<h3>{{flagDescription}}</h3>\",\n            \"Info:\",\n            \"Remote url - {{remoteUrl}}\",\n            \"Local branch - {{from}}\",\n            \"Remote branch - {{to}}\",\n            \"Summary - {{summary}}\",\n            \"<h4>Status - {{status}}</h4>\"\n        ].join(\"<br>\");\n\n        Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_INFO,\n            Strings.GIT_PUSH_RESPONSE, // title\n            Mustache.render(template, result) // message\n        );\n    }\n\n    function pushToRemote(remote) {\n        if (!remote) {\n            return ErrorHandler.showError(StringUtils.format(Strings.ERROR_NO_REMOTE_SELECTED, \"push\"));\n        }\n\n        var pushConfig = {\n            remote: remote\n        };\n\n        PushDialog.show(pushConfig)\n            .then(function (pushConfig) {\n                var q = Promise.resolve(),\n                    additionalArgs = [];\n\n                if (pushConfig.tags) {\n                    additionalArgs.push(\"--tags\");\n                }\n                if (pushConfig.noVerify) {\n                    additionalArgs.push(\"--no-verify\");\n                }\n\n                // set a new tracking branch if desired\n                if (pushConfig.branch && pushConfig.setBranchAsTracking) {\n                    q = q.then(function () {\n                        return Git.setUpstreamBranch(pushConfig.remote, pushConfig.branch);\n                    });\n                }\n                // put username and password into remote url\n                if (pushConfig.remoteUrlNew) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(pushConfig.remote, pushConfig.remoteUrlNew);\n                    });\n                }\n                // do the pull itself (we are not using pull command)\n                q = q.then(function () {\n                    let op;\n                    const progressTracker = ProgressDialog.newProgressTracker();\n                    if (pushConfig.pushToNew) {\n                        op = Git.pushToNewUpstream(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    } else if (pushConfig.strategy === \"DEFAULT\") {\n                        op = Git.push(pushConfig.remote, pushConfig.branch, additionalArgs, progressTracker);\n                    } else if (pushConfig.strategy === \"FORCED\") {\n                        op = Git.pushForced(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    } else if (pushConfig.strategy === \"DELETE_BRANCH\") {\n                        op = Git.deleteRemoteBranch(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    }\n                    return ProgressDialog.show(op, progressTracker)\n                        .then(function (result) {\n                            return ProgressDialog.waitForClose().then(function () {\n                                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'push', \"success\");\n                                showPushResult(result);\n                            });\n                        })\n                        .catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'push', \"fail\");\n                            ErrorHandler.showError(err, Strings.ERROR_PUSHING_REMOTE, {errorMetric: \"push\"});\n                        });\n                });\n                // restore original url if desired\n                if (pushConfig.remoteUrlRestore) {\n                    q = q.finally(function () {\n                        return Git.setRemoteUrl(pushConfig.remote, pushConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            })\n            .catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.ERROR_PUSHING_OPERATION); }\n            });\n    }\n\n    function pullFromRemote(remote) {\n        if (!remote) {\n            return ErrorHandler.showError(StringUtils.format(Strings.ERROR_NO_REMOTE_SELECTED, \"pull\"));\n        }\n\n        var pullConfig = {\n            remote: remote\n        };\n\n        PullDialog.show(pullConfig)\n            .then(function (pullConfig) {\n                var q = Promise.resolve();\n\n                // set a new tracking branch if desired\n                if (pullConfig.branch && pullConfig.setBranchAsTracking) {\n                    q = q.then(function () {\n                        return Git.setUpstreamBranch(pullConfig.remote, pullConfig.branch);\n                    });\n                }\n                // put username and password into remote url\n                if (pullConfig.remoteUrlNew) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(pullConfig.remote, pullConfig.remoteUrlNew);\n                    });\n                }\n                // do the pull itself (we are not using pull command)\n                q = q.then(function () {\n                    // fetch the remote first\n                    const progressTracker = ProgressDialog.newProgressTracker();\n                    return ProgressDialog.show(Git.fetchRemote(pullConfig.remote, progressTracker), progressTracker)\n                        .then(function () {\n                            if (pullConfig.strategy === \"DEFAULT\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    false, false, {progressTracker});\n                            } else if (pullConfig.strategy === \"AVOID_MERGING\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    true, false, {progressTracker});\n                            } else if (pullConfig.strategy === \"MERGE_NOCOMMIT\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    false, true, {progressTracker});\n                            } else if (pullConfig.strategy === \"REBASE\") {\n                                return Git.rebaseRemote(pullConfig.remote, pullConfig.branch, progressTracker);\n                            } else if (pullConfig.strategy === \"RESET\") {\n                                return Git.resetRemote(pullConfig.remote, pullConfig.branch, progressTracker);\n                            }\n                        })\n                        .then(function (result) {\n                            return ProgressDialog.waitForClose().then(function () {\n                                // Git writes status messages (including informational messages) to stderr,\n                                // even when the command succeeds. For example, during `git pull --rebase`,\n                                // the \"Successfully rebased and updated\" message is sent to stderr,\n                                // leaving the result as empty in stdout.\n                                // If we reach this point, the command has succeeded,\n                                // so we display a success message if `result` is \"\".\n                                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'pull', \"success\");\n                                return Utils.showOutput(result || Strings.GIT_PULL_SUCCESS,\n                                    Strings.GIT_PULL_RESPONSE);\n                            });\n                        })\n                        .catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'pull', \"fail\");\n                            ErrorHandler.showError(err, Strings.ERROR_PULLING_REMOTE, {errorMetric: \"pull\"});\n                        });\n                });\n                // restore original url if desired\n                if (pullConfig.remoteUrlRestore) {\n                    q = q.finally(function () {\n                        return Git.setRemoteUrl(pullConfig.remote, pullConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            })\n            .catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.ERROR_PULLING_OPERATION); }\n            });\n    }\n\n    function handleFetch() {\n\n        // Tell the rest of the plugin that the fetch has started\n        EventEmitter.emit(Events.FETCH_STARTED);\n\n        const tracker = ProgressDialog.newProgressTracker();\n        return ProgressDialog.show(Git.fetchAllRemotes(tracker), tracker)\n            .then(()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'fetch', \"success\");\n            })\n            .catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'fetch', \"fail\");\n                ErrorHandler.showError(err, undefined, {errorMetric: \"fetch\"});\n            })\n            .then(ProgressDialog.waitForClose)\n            .finally(function () {\n                EventEmitter.emit(Events.FETCH_COMPLETE);\n            });\n    }\n\n    // Event subscriptions\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        initVariables();\n        refreshRemotesPicker();\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_PICK, function (event) {\n        var $remote     = $(event.target).closest(\".remote-name\"),\n            remoteName  = $remote.data(\"remote-name\"),\n            type        = $remote.data(\"type\");\n        selectRemote(remoteName, type);\n        EventEmitter.emit(Events.REFRESH_COUNTERS);\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_CREATE, function () {\n        handleRemoteCreation();\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_DELETE, function (event) {\n        var remoteName = $(event.target).closest(\".remote-name\").data(\"remote-name\");\n        deleteRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_PULL, function () {\n        var remoteName = $selectedRemote.data(\"remote\");\n        pullFromRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_PUSH, function () {\n        var remoteName = $selectedRemote.data(\"remote\");\n        pushToRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_FETCH, function () {\n        handleFetch();\n    });\n\n});\n\ndefine(\"src/SettingsDialog\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache                = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Preferences             = require(\"./Preferences\"),\n        Strings             = brackets.getModule(\"strings\"),\n        Git                     = require(\"./git/Git\"),\n        Setup                   = require(\"src/utils/Setup\"),\n        settingsDialogTemplate  = `<div id=\"git-settings-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.GIT_SETTINGS_TITLE}}</h1>\n    </div>\n    <div class=\"modal-body\" style=\"max-height: fit-content;\">\n        <div>\n            <label for=\"git-settings-enableGit\">\n                <input id=\"git-settings-enableGit\" type=\"checkbox\" settingsProperty=\"enableGit\" />\n                {{Strings.ENABLE_GIT}}&nbsp;&nbsp;<i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n            </label>\n        </div>\n        <div class=\"git-settings-content {{#gitDisabled}}forced-inVisible{{/gitDisabled}}\">\n            <!-- #features -->\n            <div>\n                <div>\n                    <label for=\"git-settings-stripWhitespaceFromCommits\">\n                        <input id=\"git-settings-stripWhitespaceFromCommits\" type=\"checkbox\" settingsProperty=\"stripWhitespaceFromCommits\" />\n                        {{Strings.STRIP_WHITESPACE_FROM_COMMITS}}\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-addEndlineToTheEndOfFile\">\n                        <input id=\"git-settings-addEndlineToTheEndOfFile\" type=\"checkbox\" settingsProperty=\"addEndlineToTheEndOfFile\" />\n                        {{Strings.ADD_ENDLINE_TO_THE_END_OF_FILE}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-removeByteOrderMark\">\n                        <input id=\"git-settings-removeByteOrderMark\" type=\"checkbox\" settingsProperty=\"removeByteOrderMark\" />\n                        {{Strings.REMOVE_BOM}}\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-normalizeLineEndings\">\n                        <input id=\"git-settings-normalizeLineEndings\" type=\"checkbox\" settingsProperty=\"normalizeLineEndings\" />\n                        {{Strings.NORMALIZE_LINE_ENDINGS}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-useGitGutter\">\n                        <input id=\"git-settings-useGitGutter\" type=\"checkbox\" settingsProperty=\"useGitGutter\" />\n                        {{Strings.USE_GIT_GUTTER}}&nbsp;&nbsp;<i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-markModifiedInTree\">\n                        <input id=\"git-settings-markModifiedInTree\" type=\"checkbox\" settingsProperty=\"markModifiedInTree\" />\n                        {{Strings.MARK_MODIFIED_FILES_IN_TREE}}&nbsp;&nbsp;<i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-useVerboseDiff\">\n                        <input id=\"git-settings-useVerboseDiff\" type=\"checkbox\" settingsProperty=\"useVerboseDiff\" />\n                        {{Strings.USE_VERBOSE_DIFF}}\n                    </label>\n                </div>\n                <div>\n                    <label for=\"git-settings-useDifftool\">\n                        <input id=\"git-settings-useDifftool\" type=\"checkbox\" settingsProperty=\"useDifftool\" />\n                        {{Strings.USE_DIFFTOOL}}\n                    </label>\n                </div>\n            </div>\n            <div>\n                <div>\n                    <label for=\"git-settings-clearWhitespaceOnSave\">\n                        <input id=\"git-settings-clearWhitespaceOnSave\" type=\"checkbox\" settingsProperty=\"clearWhitespaceOnSave\" />\n                        {{Strings.CLEAR_WHITESPACE_ON_FILE_SAVE}}\n                    </label>\n                </div>\n            </div>\n            <!-- /features -->\n            <!-- #gitConfig -->\n            <h4>{{Strings.SYSTEM_CONFIGURATION}}</h4>\n            <div class=\"row-fluid\">\n                {{#gitNotFound}}\n                <div class=\"alert alert-warning\">\n                    {{Strings.GIT_NOT_FOUND_MESSAGE}}\n                </div>\n                {{/gitNotFound}}\n                <label for=\"git-settings-gitPath\">\n                    {{Strings.PATH_TO_GIT_EXECUTABLE}}:&nbsp;&nbsp;\n                    {{#gitNotFound}}\n                    <i title=\"{{Strings.REQUIRES_APP_RESTART_SETTING}}\" class=\"settings-info-i fa-solid fa-circle-info\"></i>\n                    {{/gitNotFound}}\n                </label>\n                <input id=\"git-settings-gitPath\" type=\"text\" settingsProperty=\"gitPath\" autocomplete=\"off\" spellcheck=\"false\"/>\n            </div>\n            <div class=\"row-fluid\">\n                <label for=\"git-settings-gitTimeout\">{{Strings.DEFAULT_GIT_TIMEOUT}}:</label>\n                <input id=\"git-settings-gitTimeout\" type=\"number\" settingsProperty=\"gitTimeout\" />\n            </div>\n            <!-- /gitConfig -->\n        </div>\n\n\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"defaults\"  class=\"dialog-button btn left\"          >{{Strings.BUTTON_DEFAULTS}}</button>\n        <button data-button-id=\"cancel\"    class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"        class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_SAVE}}</button>\n    </div>\n</div>\n`;\n\n    var dialog,\n        $dialog;\n\n    function setValues(values) {\n        $(\"*[settingsProperty]\", $dialog).each(function () {\n            var $this = $(this),\n                type = $this.attr(\"type\"),\n                tag = $this.prop(\"tagName\").toLowerCase(),\n                property = $this.attr(\"settingsProperty\");\n            if (type === \"checkbox\") {\n                $this.prop(\"checked\", values[property]);\n            } else if (tag === \"select\") {\n                $(\"option[value=\" + values[property] + \"]\", $this).prop(\"selected\", true);\n            } else {\n                $this.val(values[property]);\n            }\n        });\n    }\n\n    function collectDialogValues() {\n        $(\"*[settingsProperty]\", $dialog).each(function () {\n            var $this = $(this),\n                type = $this.attr(\"type\"),\n                property = $this.attr(\"settingsProperty\"),\n                prefType = Preferences.getType(property);\n            if (type === \"checkbox\") {\n                Preferences.set(property, $this.prop(\"checked\"));\n            } else if (prefType === \"number\") {\n                var newValue = parseInt($this.val().trim(), 10);\n                if (isNaN(newValue)) { newValue = Preferences.getDefaults()[property]; }\n                Preferences.set(property, newValue);\n            } else {\n                Preferences.set(property, $this.val().trim() || null);\n            }\n        });\n        Preferences.save();\n    }\n\n    function assignActions() {\n        var $useDifftoolCheckbox = $(\"#git-settings-useDifftool\", $dialog);\n\n        Git.getConfig(\"diff.tool\").then(function (diffToolConfiguration) {\n\n            if (!diffToolConfiguration) {\n                $useDifftoolCheckbox.prop({\n                    checked: false,\n                    disabled: true\n                });\n            } else {\n                $useDifftoolCheckbox.prop({\n                    disabled: false\n                });\n            }\n\n        }).catch(function () {\n\n            // an error with git\n            // we were not able to check whether diff tool is configured or not\n            // so we disable it just to be sure\n            $useDifftoolCheckbox.prop({\n                checked: false,\n                disabled: true\n            });\n\n        });\n\n        $(\"#git-settings-stripWhitespaceFromCommits\", $dialog).on(\"change\", function () {\n            var on = $(this).is(\":checked\");\n            $(\"#git-settings-addEndlineToTheEndOfFile,#git-settings-removeByteOrderMark,#git-settings-normalizeLineEndings\", $dialog)\n                .prop(\"checked\", on)\n                .prop(\"disabled\", !on);\n        });\n\n        $(\"button[data-button-id='defaults']\", $dialog).on(\"click\", function (e) {\n            e.stopPropagation();\n            setValues(Preferences.getDefaults());\n        });\n    }\n\n    function init() {\n        setValues(Preferences.getAll());\n        assignActions();\n    }\n\n    exports.show = function () {\n        const enableGitPreference = Preferences.get(\"enableGit\");\n        const compiledTemplate = Mustache.render(settingsDialogTemplate, {\n            Strings,\n            gitDisabled: !enableGitPreference,\n            gitNotFound: enableGitPreference ? !Setup.isExtensionActivated() : false\n        });\n\n        dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n        $dialog = dialog.getElement();\n\n        init();\n        $dialog.find(\"#git-settings-enableGit\").on(\"change\", function () {\n            const anyChecked = $dialog.find(\"#git-settings-enableGit:checked\").length > 0;\n            if (anyChecked) {\n                $dialog.find(\".git-settings-content\").removeClass(\"forced-inVisible\");\n            } else {\n                $dialog.find(\".git-settings-content\").addClass(\"forced-inVisible\");\n            }\n        });\n\n        dialog.done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                // Save everything to preferences\n                collectDialogValues();\n            }\n        });\n    };\n});\n\ndefine(\"src/TabBarIntegration\", function (require) {\n    const EventEmitter = require(\"src/EventEmitter\");\n    const Events = require(\"src/Events\");\n    const Git = require(\"src/git/Git\");\n    const Preferences = require(\"src/Preferences\");\n\n    // the cache of file statuses by path\n    let fileStatusCache = {};\n\n    /**\n     * this function is responsible to get the Git status for a file path\n     *\n     * @param {string} fullPath - the file path\n     * @returns {Array|null} - Array of status strings or null if no status\n     */\n    function getFileStatus(fullPath) {\n        return fileStatusCache[fullPath] || null;\n    }\n\n    /**\n     * whether the file is modified or not\n     *\n     * @param {string} fullPath - the file path\n     * @returns {boolean} - True if the file is modified otherwise false\n     */\n    function isModified(fullPath) {\n        const status = getFileStatus(fullPath);\n        if (!status) {\n            return false;\n        }\n        return status.some(\n            (statusType) =>\n                statusType === Git.FILE_STATUS.MODIFIED ||\n                statusType === Git.FILE_STATUS.RENAMED ||\n                statusType === Git.FILE_STATUS.COPIED\n        );\n    }\n\n    /**\n     * whether the file is untracked or not\n     *\n     * @param {string} fullPath - the file path\n     * @returns {boolean} - True if the file is untracked otherwise false\n     */\n    function isUntracked(fullPath) {\n        const status = getFileStatus(fullPath);\n        if (!status) {\n            return false;\n        }\n\n        // return true if it's untracked or if it's newly added (which means it was untracked before staging)\n        return (\n            status.includes(Git.FILE_STATUS.UNTRACKED) ||\n            (status.includes(Git.FILE_STATUS.ADDED) && status.includes(Git.FILE_STATUS.STAGED))\n        );\n    }\n\n\n    // Update file status cache when Git status results are received\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (files) {\n        // reset the cache\n        fileStatusCache = {};\n\n        const gitRoot = Preferences.get(\"currentGitRoot\");\n        if (!gitRoot) {\n            return;\n        }\n\n        // we need to update cache with new status results\n        files.forEach(function (entry) {\n            const fullPath = gitRoot + entry.file;\n            fileStatusCache[fullPath] = entry.status;\n        });\n\n        // notify that file statuses have been updated\n        EventEmitter.emit(\"GIT_FILE_STATUS_CHANGED\", fileStatusCache);\n    });\n\n    // clear cache when Git is disabled\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        fileStatusCache = {};\n        EventEmitter.emit(\"GIT_FILE_STATUS_CHANGED\", fileStatusCache);\n    });\n\n    return {\n        getFileStatus: getFileStatus,\n        isModified: isModified,\n        isUntracked: isUntracked\n    };\n});\n\n/*globals jsPromise, logger*/\ndefine(\"src/Utils\", function (require, exports, module) {\n\n    // Brackets modules\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager  = brackets.getModule(\"command/CommandManager\"),\n        Commands        = brackets.getModule(\"command/Commands\"),\n        Dialogs         = brackets.getModule(\"widgets/Dialogs\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileSystem      = brackets.getModule(\"filesystem/FileSystem\"),\n        FileUtils       = brackets.getModule(\"file/FileUtils\"),\n        LanguageManager = brackets.getModule(\"language/LanguageManager\"),\n        Mustache        = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        ProjectManager  = brackets.getModule(\"project/ProjectManager\");\n\n    // Local modules\n    const ErrorHandler    = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"src/Preferences\"),\n        Setup           = require(\"src/utils/Setup\"),\n        Constants       = require(\"src/Constants\"),\n        Strings         = brackets.getModule(\"strings\");\n\n    const FORMAT_DIFF_TOO_LARGE = \"<div>\" + Strings.DIFF_TOO_LONG + \"</div>\";\n\n    // Module variables\n    const formatDiffTemplate      = `<table>\n    <tbody>\n        {{#files}}\n            <tr class=\"meta-file\">\n                <th colspan=\"3\">{{name}}</th>\n            </tr>\n            {{#lines}}\n                <tr class=\"diff-row {{lineClass}}\">\n                    <td class=\"row-num\">{{numLineOld}}</td>\n                    <td class=\"row-num\">{{numLineNew}}</td>\n                    <td><pre>{{{line}}}</pre></td>\n                </tr>\n            {{/lines}}\n            <tr class=\"separator\"></tr>\n        {{/files}}\n    </tbody>\n</table>\n`,\n        questionDialogTemplate  = `<div id=\"git-question-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    <div class=\"modal-body table-striped tab-content\">\n        <p>{{{question}}}</p>\n        {{#stringInput}}\n        <input class=\"stringInput\" type=\"text\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/stringInput}}\n        {{#passwordInput}}\n        <input class=\"stringInput\" type=\"password\" value=\"{{defaultValue}}\" autocomplete=\"off\" spellcheck=\"false\" />\n        {{/passwordInput}}\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"cancel\" class=\"dialog-button btn cancel btn-80\" >{{Strings.BUTTON_CANCEL}}</button>\n        <button data-button-id=\"ok\"     class=\"dialog-button btn btn-80 {{#customOkBtnClass}}{{customOkBtnClass}}{{/customOkBtnClass}}{{^customOkBtnClass}}primary{{/customOkBtnClass}}\">\n            {{#customOkBtn}}{{customOkBtn}}{{/customOkBtn}}{{^customOkBtn}}{{Strings.BUTTON_OK}}{{/customOkBtn}}\n        </button>\n    </div>\n</div>\n`,\n        outputDialogTemplate    = `<div id=\"git-output-dialog\" class=\"modal\">\n    {{#title}}\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    {{/title}}\n    <div class=\"modal-body table-striped tab-content\">\n        <pre class=\"git-output\">{{{output}}}</pre>\n        {{#question}}\n        <h4>{{question}}</h4>\n        {{/question}}\n    </div>\n    <div class=\"modal-footer\">\n        <button data-button-id=\"close\" class=\"dialog-button btn btn-80\">{{Strings.BUTTON_CLOSE}}</button>\n        {{#question}}\n        <button data-button-id=\"ok\"    class=\"dialog-button btn primary btn-80\">{{Strings.BUTTON_OK}}</button>\n        {{/question}}\n    </div>\n</div>\n`,\n        writeTestResults        = {},\n        EXT_NAME                = \"[brackets-git] \";\n\n    // Implementation\n    function getProjectRoot() {\n        var projectRoot = ProjectManager.getProjectRoot();\n        return projectRoot ? projectRoot.fullPath : null;\n    }\n\n    // returns \"C:/Users/Zaggi/AppData/Roaming/Brackets/extensions/user/zaggino.brackets-git/\"\n    function getExtensionDirectory() {\n        throw new Error(\"api unsupported\");\n        // var modulePath = ExtensionUtils.getModulePath(module);\n        // return modulePath.slice(0, -1 * \"src/\".length);\n    }\n\n    function formatDiff(diff) {\n        var DIFF_MAX_LENGTH = 2000;\n\n        var tabReplace   = \"\",\n            verbose      = Preferences.get(\"useVerboseDiff\"),\n            numLineOld   = 0,\n            numLineNew   = 0,\n            lastStatus   = 0,\n            diffData     = [];\n\n        var i = Preferences.getGlobal(\"tabSize\");\n        while (i--) {\n            tabReplace += \"&nbsp;\";\n        }\n\n        var LINE_STATUS = {\n            HEADER: 0,\n            UNCHANGED: 1,\n            REMOVED: 2,\n            ADDED: 3,\n            EOF: 4\n        };\n\n        var diffSplit = diff.split(\"\\n\");\n\n        if (diffSplit.length > DIFF_MAX_LENGTH) {\n            return \"\" + FORMAT_DIFF_TOO_LARGE; // create new str to return\n        }\n\n        diffSplit.forEach(function (line) {\n            if (line === \" \") { line = \"\"; }\n\n            var lineClass   = \"\",\n                pushLine    = true;\n\n            if (line.indexOf(\"diff --git\") === 0) {\n                lineClass = \"diffCmd\";\n\n                diffData.push({\n                    name: line.split(\"b/\")[1],\n                    lines: []\n                });\n\n                if (!verbose) {\n                    pushLine = false;\n                }\n            } else if (line.match(/index\\s[A-z0-9]{7}\\.\\.[A-z0-9]{7}/)) {\n                if (!verbose) {\n                    pushLine = false;\n                }\n            } else if (line.substr(0, 3) === \"+++\" || line.substr(0, 3) === \"---\") {\n                if (!verbose) {\n                    pushLine = false;\n                }\n            } else if (line.indexOf(\"@@\") === 0) {\n                lineClass = \"position\";\n\n                // Define the type of the line: Header\n                lastStatus = LINE_STATUS.HEADER;\n\n                // This read the start line for the diff and substract 1 for this line\n                var m = line.match(/^@@ -([,0-9]+) \\+([,0-9]+) @@/);\n                var s1 = m[1].split(\",\");\n                var s2 = m[2].split(\",\");\n\n                numLineOld = s1[0] - 1;\n                numLineNew = s2[0] - 1;\n            } else if (line[0] === \"+\") {\n                lineClass = \"added\";\n                line = line.substring(1);\n\n                // Define the type of the line: Added\n                lastStatus = LINE_STATUS.ADDED;\n\n                // Add 1 to the num line for new document\n                numLineNew++;\n            } else if (line[0] === \"-\") {\n                lineClass = \"removed\";\n                line = line.substring(1);\n\n                // Define the type of the line: Removed\n                lastStatus = LINE_STATUS.REMOVED;\n\n                // Add 1 to the num line for old document\n                numLineOld++;\n            } else if (line[0] === \" \" || line === \"\") {\n                lineClass = \"unchanged\";\n                line = line.substring(1);\n\n                // Define the type of the line: Unchanged\n                lastStatus = LINE_STATUS.UNCHANGED;\n\n                // Add 1 to old a new num lines\n                numLineOld++;\n                numLineNew++;\n            } else if (line === \"\\\\ No newline at end of file\") {\n                lastStatus = LINE_STATUS.EOF;\n                lineClass = \"end-of-file\";\n            } else {\n                console.log(\"Unexpected line in diff: \" + line);\n            }\n\n            if (pushLine) {\n                var _numLineOld = \"\",\n                    _numLineNew = \"\";\n\n                switch (lastStatus) {\n                    case LINE_STATUS.HEADER:\n                    case LINE_STATUS.EOF:\n                        // _numLineOld = \"\";\n                        // _numLineNew = \"\";\n                        break;\n                    case LINE_STATUS.UNCHANGED:\n                        _numLineOld = numLineOld;\n                        _numLineNew = numLineNew;\n                        break;\n                    case LINE_STATUS.REMOVED:\n                        _numLineOld = numLineOld;\n                        // _numLineNew = \"\";\n                        break;\n                    // case LINE_STATUS.ADDED:\n                    default:\n                        // _numLineOld = \"\";\n                        _numLineNew = numLineNew;\n                }\n\n                // removes ZERO WIDTH NO-BREAK SPACE character (BOM)\n                line = line.replace(/\\uFEFF/g, \"\");\n\n                // exposes other potentially harmful characters\n                line = line.replace(/[\\u2000-\\uFFFF]/g, function (x) {\n                    return \"<U+\" + x.charCodeAt(0).toString(16).toUpperCase() + \">\";\n                });\n\n                line = _.escape(line)\n                    .replace(/\\t/g, tabReplace)\n                    .replace(/\\s/g, \"&nbsp;\");\n\n                line = line.replace(/(&nbsp;)+$/g, function (trailingWhitespace) {\n                    return \"<span class='trailingWhitespace'>\" + trailingWhitespace + \"</span>\";\n                });\n\n                if (diffData.length > 0) {\n                    _.last(diffData).lines.push({\n                        \"numLineOld\": _numLineOld,\n                        \"numLineNew\": _numLineNew,\n                        \"line\": line,\n                        \"lineClass\": lineClass\n                    });\n                }\n            }\n        });\n\n        return Mustache.render(formatDiffTemplate, { files: diffData });\n    }\n\n    function askQuestion(title, question, options) {\n        return new Promise(function (resolve, reject) {\n            options = options || {};\n\n            if (!options.noescape) {\n                question = _.escape(question);\n            }\n\n            var compiledTemplate = Mustache.render(questionDialogTemplate, {\n                title: title,\n                question: question,\n                stringInput: !options.booleanResponse && !options.password,\n                passwordInput: options.password,\n                defaultValue: options.defaultValue,\n                customOkBtn: options.customOkBtn,\n                customOkBtnClass: options.customOkBtnClass,\n                Strings: Strings\n            });\n\n            var dialog  = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n                $dialog = dialog.getElement();\n\n            _.defer(function () {\n                var $input = $dialog.find(\"input:visible\");\n                if ($input.length > 0) {\n                    $input.focus();\n                } else {\n                    $dialog.find(\".primary\").focus();\n                }\n            });\n\n            dialog.done(function (buttonId) {\n                if (options.booleanResponse) {\n                    return resolve(buttonId === \"ok\");\n                }\n                if (buttonId === \"ok\") {\n                    resolve(dialog.getElement().find(\"input\").val().trim());\n                } else {\n                    reject(Strings.USER_ABORTED);\n                }\n            });\n        });\n    }\n\n    function showOutput(output, title, options) {\n        return new Promise(function (resolve) {\n            options = options || {};\n            var compiledTemplate = Mustache.render(outputDialogTemplate, {\n                title: title,\n                output: output,\n                Strings: Strings,\n                question: options.question\n            });\n            var dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n            dialog.getElement().find(\"button\").focus();\n            dialog.done(function (buttonId) {\n                resolve(buttonId === \"ok\");\n            });\n        });\n    }\n\n    function isProjectRootWritable() {\n        return new Promise(function (resolve) {\n\n            var folder = getProjectRoot();\n\n            // if we previously tried, assume nothing has changed\n            if (writeTestResults[folder]) {\n                return resolve(writeTestResults[folder]);\n            }\n\n            // create entry for temporary file\n            var fileEntry = FileSystem.getFileForPath(folder + \".phoenixGitTemp\");\n\n            function finish(bool) {\n                // delete the temp file and resolve\n                fileEntry.unlink(function () {\n                    writeTestResults[folder] = bool;\n                    resolve(bool);\n                });\n            }\n\n            // try writing some text into the temp file\n            jsPromise(FileUtils.writeText(fileEntry, \"\"))\n                .then(function () {\n                    finish(true);\n                })\n                .catch(function () {\n                    finish(false);\n                });\n        });\n    }\n\n    function pathExists(path) {\n        return new Promise(function (resolve) {\n            FileSystem.resolve(path, function (err, entry) {\n                resolve(!err && entry ? true : false);\n            });\n        });\n    }\n\n    function loadPathContent(path) {\n        return new Promise(function (resolve) {\n            FileSystem.resolve(path, function (err, entry) {\n                if (err) {\n                    return resolve(null);\n                }\n                if (entry._clearCachedData) {\n                    entry._clearCachedData();\n                }\n                if (entry.isFile) {\n                    entry.read(function (err, content) {\n                        if (err) {\n                            return resolve(null);\n                        }\n                        resolve(content);\n                    });\n                } else {\n                    entry.getContents(function (err, contents) {\n                        if (err) {\n                            return resolve(null);\n                        }\n                        resolve(contents);\n                    });\n                }\n            });\n        });\n    }\n\n    function isLoading($btn) {\n        return $btn.hasClass(\"btn-loading\");\n    }\n\n    function setLoading($btn) {\n        $btn.prop(\"disabled\", true).addClass(\"btn-loading\");\n    }\n\n    function unsetLoading($btn) {\n        $btn.prop(\"disabled\", false).removeClass(\"btn-loading\");\n    }\n\n    function encodeSensitiveInformation(str) {\n        // should match passwords in http/https urls\n        str = str.replace(/(https?:\\/\\/)([^:@\\s]*):([^:@]*)?@/g, function (a, protocol, user/*, pass*/) {\n            return protocol + user + \":***@\";\n        });\n        // should match user name in windows user folders\n        str = str.replace(/(users)(\\\\|\\/)([^\\\\\\/]+)(\\\\|\\/)/i, function (a, users, slash1, username, slash2) {\n            return users + slash1 + \"***\" + slash2;\n        });\n        return str;\n    }\n\n    function consoleWarn(msg) {\n        console.warn(encodeSensitiveInformation(msg));\n    }\n\n    function consoleError(msg) {\n        console.error(encodeSensitiveInformation(msg));\n    }\n\n    function consoleDebug(msg) {\n        if (logger.loggingOptions.logGit) {\n            console.log(EXT_NAME + encodeSensitiveInformation(msg));\n        }\n    }\n\n    /**\n     * Reloads the Document's contents from disk, discarding any unsaved changes in the editor.\n     *\n     * @param {!Document} doc\n     * @return {Promise} Resolved after editor has been refreshed; rejected if unable to load the\n     *      file's new content. Errors are logged but no UI is shown.\n     */\n    function reloadDoc(doc) {\n        return jsPromise(FileUtils.readAsText(doc.file))\n            .then(function (text) {\n                doc.refreshText(text, new Date());\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(\"Error reloading contents of \" + doc.file.fullPath);\n                ErrorHandler.logError(err);\n            });\n    }\n\n    /**\n     *  strips trailing whitespace from all the diffs and adds \\n to the end\n     */\n    function stripWhitespaceFromFile(filename, clearWholeFile) {\n        return new Promise(function (resolve, reject) {\n\n            var fullPath                  = Preferences.get(\"currentGitRoot\") + filename,\n                addEndlineToTheEndOfFile  = Preferences.get(\"addEndlineToTheEndOfFile\"),\n                removeBom                 = Preferences.get(\"removeByteOrderMark\"),\n                normalizeLineEndings      = Preferences.get(\"normalizeLineEndings\");\n\n            var _cleanLines = function (lineNumbers) {\n                // do not clean if there's nothing to clean\n                if (lineNumbers && lineNumbers.length === 0) {\n                    return resolve();\n                }\n                // clean the file\n                var fileEntry = FileSystem.getFileForPath(fullPath);\n                return jsPromise(FileUtils.readAsText(fileEntry))\n                    .catch(function (err) {\n                        ErrorHandler.logError(err + \" on FileUtils.readAsText for \" + fileEntry.fullPath);\n                        return null;\n                    })\n                    .then(function (text) {\n                        if (text === null) {\n                            return resolve();\n                        }\n\n                        if (removeBom) {\n                            // remove BOM - \\uFEFF\n                            text = text.replace(/\\uFEFF/g, \"\");\n                        }\n                        if (normalizeLineEndings) {\n                            // normalizes line endings\n                            text = text.replace(/\\r\\n/g, \"\\n\");\n                        }\n                        // process lines\n                        var lines = text.split(\"\\n\");\n\n                        if (lineNumbers) {\n                            lineNumbers.forEach(function (lineNumber) {\n                                if (typeof lines[lineNumber] === \"string\") {\n                                    lines[lineNumber] = lines[lineNumber].replace(/\\s+$/, \"\");\n                                }\n                            });\n                        } else {\n                            lines.forEach(function (ln, lineNumber) {\n                                if (typeof lines[lineNumber] === \"string\") {\n                                    lines[lineNumber] = lines[lineNumber].replace(/\\s+$/, \"\");\n                                }\n                            });\n                        }\n\n                        // add empty line to the end, i've heard that git likes that for some reason\n                        if (addEndlineToTheEndOfFile) {\n                            var lastLineNumber = lines.length - 1;\n                            if (lines[lastLineNumber].length > 0) {\n                                lines[lastLineNumber] = lines[lastLineNumber].replace(/\\s+$/, \"\");\n                            }\n                            if (lines[lastLineNumber].length > 0) {\n                                lines.push(\"\");\n                            }\n                        }\n\n                        text = lines.join(\"\\n\");\n                        return jsPromise(FileUtils.writeText(fileEntry, text))\n                            .catch(function (err) {\n                                ErrorHandler.logError(\"Wasn't able to clean whitespace from file: \" + fullPath);\n                                resolve();\n                                throw err;\n                            })\n                            .then(function () {\n                                // refresh the file if it's open in the background\n                                DocumentManager.getAllOpenDocuments().forEach(function (doc) {\n                                    if (doc.file.fullPath === fullPath) {\n                                        reloadDoc(doc);\n                                    }\n                                });\n                                // diffs were cleaned in this file\n                                resolve();\n                            });\n                    });\n            };\n\n            if (clearWholeFile) {\n                _cleanLines(null);\n            } else {\n                Git.diffFile(filename).then(function (diff) {\n                    // if git returned an empty diff\n                    if (!diff) { return resolve(); }\n\n                    // if git detected that the file is binary\n                    if (diff.match(/^binary files.*differ$/img)) { return resolve(); }\n\n                    var modified = [],\n                        changesets = diff.split(\"\\n\").filter(function (l) { return l.match(/^@@/) !== null; });\n                    // collect line numbers to clean\n                    changesets.forEach(function (line) {\n                        var i,\n                            m = line.match(/^@@ -([,0-9]+) \\+([,0-9]+) @@/),\n                            s = m[2].split(\",\"),\n                            from = parseInt(s[0], 10),\n                            to = from - 1 + (parseInt(s[1], 10) || 1);\n                        for (i = from; i <= to; i++) { modified.push(i > 0 ? i - 1 : 0); }\n                    });\n                    _cleanLines(modified);\n                }).catch(function (ex) {\n                    // This error will bubble up to preparing commit dialog so just log here\n                    ErrorHandler.logError(ex);\n                    reject(ex);\n                });\n            }\n        });\n    }\n\n    function stripWhitespaceFromFiles(gitStatusResults, stageChanges, progressTracker) {\n        return new Promise((resolve, reject)=>{\n            const startTime = (new Date()).getTime();\n            let queue = Promise.resolve();\n\n            gitStatusResults.forEach(function (fileObj) {\n                var isDeleted = fileObj.status.indexOf(Git.FILE_STATUS.DELETED) !== -1;\n\n                // strip whitespace if the file was not deleted\n                if (!isDeleted) {\n                    // strip whitespace only for recognized languages so binary files won't get corrupted\n                    var langId = LanguageManager.getLanguageForPath(fileObj.file).getId();\n                    if ([\"unknown\", \"binary\", \"image\", \"markdown\", \"audio\"].indexOf(langId) === -1) {\n\n                        queue = queue.then(function () {\n                            var clearWholeFile = fileObj.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1 ||\n                                fileObj.status.indexOf(Git.FILE_STATUS.RENAMED) !== -1;\n\n                            var t = (new Date()).getTime() - startTime;\n                            progressTracker.trigger(Events.GIT_PROGRESS_EVENT,\n                                t + \"ms - \" + Strings.CLEAN_FILE_START + \": \" + fileObj.file);\n\n                            return stripWhitespaceFromFile(fileObj.file, clearWholeFile).then(function () {\n                                // stage the files again to include stripWhitespace changes\n                                var notifyProgress = function () {\n                                    var t = (new Date()).getTime() - startTime;\n                                    progressTracker.trigger(Events.GIT_PROGRESS_EVENT,\n                                        t + \"ms - \" + Strings.CLEAN_FILE_END + \": \" + fileObj.file);\n                                };\n                                if (stageChanges) {\n                                    return Git.stage(fileObj.file).then(notifyProgress);\n                                } else {\n                                    notifyProgress();\n                                }\n                            });\n                        });\n\n                    }\n                }\n            });\n\n            queue\n                .then(function () {\n                    resolve();\n                })\n                .catch(function () {\n                    reject();\n                });\n        });\n    }\n\n    function openEditorForFile(file, relative) {\n        if (relative) {\n            file = getProjectRoot() + file;\n        }\n        CommandManager.execute(Commands.FILE_OPEN, {\n            fullPath: file\n        });\n    }\n\n    let clearWhitespace = Preferences.get(\"clearWhitespaceOnSave\");\n    Preferences.getExtensionPref().on(\"change\", \"clearWhitespaceOnSave\", ()=>{\n        clearWhitespace = Preferences.get(\"clearWhitespaceOnSave\");\n    });\n\n    EventEmitter.on(Events.BRACKETS_DOCUMENT_SAVED, function (doc) {\n        if(!clearWhitespace){\n            return;\n        }\n        var fullPath       = doc.file.fullPath,\n            currentGitRoot = Preferences.get(\"currentGitRoot\"),\n            path           = fullPath.substring(currentGitRoot.length);\n        stripWhitespaceFromFile(path);\n    });\n\n    function enableCommand(commandID, enabled) {\n        const command = CommandManager.get(commandID);\n        if(!command){\n            return;\n        }\n        enabled = commandID === Constants.CMD_GIT_SETTINGS_COMMAND_ID ?\n            true : enabled && Setup.isExtensionActivated();\n        command.setEnabled(enabled);\n    }\n\n    // Public API\n    exports.FORMAT_DIFF_TOO_LARGE       = FORMAT_DIFF_TOO_LARGE;\n    exports.formatDiff                  = formatDiff;\n    exports.getProjectRoot              = getProjectRoot;\n    exports.getExtensionDirectory       = getExtensionDirectory;\n    exports.askQuestion                 = askQuestion;\n    exports.showOutput                  = showOutput;\n    exports.isProjectRootWritable       = isProjectRootWritable;\n    exports.pathExists                  = pathExists;\n    exports.loadPathContent             = loadPathContent;\n    exports.setLoading                  = setLoading;\n    exports.unsetLoading                = unsetLoading;\n    exports.isLoading                   = isLoading;\n    exports.consoleWarn                 = consoleWarn;\n    exports.consoleError                = consoleError;\n    exports.consoleDebug                = consoleDebug;\n    exports.encodeSensitiveInformation  = encodeSensitiveInformation;\n    exports.reloadDoc                   = reloadDoc;\n    exports.stripWhitespaceFromFiles    = stripWhitespaceFromFiles;\n    exports.openEditorForFile           = openEditorForFile;\n    exports.enableCommand               = enableCommand;\n\n});\n\ndefine(\"src/dialogs/Clone\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const RemoteCommon    = require(\"src/dialogs/RemoteCommon\"),\n        Strings           = brackets.getModule(\"strings\");\n\n    // Templates\n    const template            = `<div id=\"git-clone-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.CLONE_REPOSITORY}}</h1>\n    </div>\n    <div class=\"modal-body\">\n\n        <label for=\"git-clone-url\">{{Strings.ENTER_REMOTE_GIT_URL}}</label>\n        <input type=\"text\" class=\"stringInput\" id=\"git-clone-url\" autocomplete=\"off\" spellcheck=\"false\" />\n\n        <hr>\n\n        <div class=\"accordion\">\n            <!-- Hidden checkbox to toggle the accordion -->\n            <input type=\"checkbox\" id=\"advancedAccordionToggle\" class=\"accordion-toggle\" />\n\n            <!-- Accordion Header -->\n            <label for=\"advancedAccordionToggle\" class=\"accordion-header\">\n                {{Strings.MORE_OPTIONS}}\n                <i class=\"fas fa-chevron-down\"></i>\n            </label>\n\n            <!-- Accordion Content -->\n            <div class=\"accordion-content\">\n                <label class=\"text-bold\">\n                    {{Strings.CREDENTIALS}}\n                </label>\n                <div>\n                    <label class=\"text-quiet\">\n                        {{Strings.SAVE_CREDENTIALS_HELP}}\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.USERNAME}}:\n                    </label>\n                    <label>\n                        <input type=\"text\" name=\"username\" value=\"{{config.remoteUsername}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.PASSWORD}}:\n                    </label>\n                    <label>\n                        <input type=\"password\" name=\"password\" value=\"{{config.remotePassword}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"saveToUrl\" />\n                        {{Strings.SAVE_CREDENTIALS_IN_URL}}\n                    </label>\n                </div>\n            </div>\n        </div>\n\n\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n</div>\n`;\n\n    // Module variables\n    let $cloneInput;\n\n    // Implementation\n    function _attachEvents($dialog) {\n        // Detect changes to URL, disable auth if not http\n        $cloneInput.on(\"keyup change\", function () {\n            var $authInputs = $dialog.find(\"input[name='username'],input[name='password'],input[name='saveToUrl']\");\n            if ($(this).val().length > 0) {\n                if (/^https?:/.test($(this).val())) {\n                    $authInputs.prop(\"disabled\", false);\n\n                    // Update the auth fields if the URL contains auth\n                    var auth = /:\\/\\/([^:]+):?([^@]*)@/.exec($(this).val());\n                    if (auth) {\n                        $(\"input[name=username]\", $dialog).val(auth[1]);\n                        $(\"input[name=password]\", $dialog).val(auth[2]);\n                    }\n                } else {\n                    $authInputs.prop(\"disabled\", true);\n                }\n            } else {\n                $authInputs.prop(\"disabled\", false);\n            }\n        });\n        $cloneInput.focus();\n    }\n\n    function show() {\n        return new Promise((resolve, reject)=>{\n            const templateArgs = {\n                modeLabel: Strings.CLONE_REPOSITORY,\n                Strings: Strings\n            };\n\n            var compiledTemplate = Mustache.render(template, templateArgs),\n                dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n                $dialog = dialog.getElement();\n\n            $cloneInput = $dialog.find(\"#git-clone-url\");\n\n            _attachEvents($dialog);\n\n            dialog.done(function (buttonId) {\n                if (buttonId === \"ok\") {\n                    var cloneConfig = {};\n                    cloneConfig.remote = \"origin\";\n                    cloneConfig.remoteUrl = $cloneInput.val();\n                    RemoteCommon.collectValues(cloneConfig, $dialog);\n                    resolve(cloneConfig);\n                } else {\n                    reject();\n                }\n            });\n\n        });\n    }\n\n    exports.show = show;\n});\n\ndefine(\"src/dialogs/Progress\", function (require, exports) {\n    const EventDispatcher = brackets.getModule(\"utils/EventDispatcher\");\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Strings             = brackets.getModule(\"strings\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const Events        = require(\"src/Events\");\n\n    // Templates\n    var template = `<div id=\"git-progress-dialog\" class=\"modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{title}}</h1>\n    </div>\n    <div class=\"modal-body\">\n        <textarea readonly=\"readonly\"></textarea>\n    </div>\n    <!--\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n    -->\n</div>\n`;\n\n    // Module variables\n    var lines,\n        $textarea;\n\n    const maxLines = 5000;\n    // some git commit may have pre commit/push hooks which\n    // may run tests suits that print large amount of data on the console, so we need to\n    // debounce and truncate the git output we get in progress window.\n    function addLine(str) {\n        if (lines.length >= maxLines) {\n            lines.shift(); // Remove the oldest line\n        }\n        lines.push(str);\n    }\n    let updateTimeout = null;\n    function updateTextarea() {\n        if(updateTimeout){\n            // an update is scheduled, debounce, we dont need to print now\n            return;\n        }\n        updateTimeout = setTimeout(() => {\n            updateTimeout = null;\n            if(!$textarea || !lines.length){\n                return;\n            }\n            $textarea.val(lines.join(\"\\n\"));\n            $textarea.scrollTop($textarea[0].scrollHeight - $textarea.height());\n        }, 100);\n    }\n\n    function onProgress(str) {\n        if (typeof str === \"string\") {\n            addLine(str);\n        }\n        updateTextarea();\n    }\n\n    function show(promise, progressTracker, showOpts = {}) {\n        if (!promise || !promise.finally) {\n            throw new Error(\"Invalid promise argument for progress dialog!\");\n        }\n        if(!progressTracker) {\n            throw new Error(\"Invalid progressTracker argument for progress dialog!\");\n        }\n\n        const title = showOpts.title;\n        const options = showOpts.options || {};\n\n        return new Promise(function (resolve, reject) {\n\n            lines = showOpts.initialMessage ? [showOpts.initialMessage] : [];\n            $textarea = null;\n\n            var dialog,\n                finished = false;\n\n            function showDialog() {\n                if (finished) {\n                    return;\n                }\n\n                var templateArgs = {\n                    title: title || Strings.OPERATION_IN_PROGRESS_TITLE,\n                    Strings: Strings\n                };\n\n                var compiledTemplate = Mustache.render(template, templateArgs);\n                dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n\n                $textarea = dialog.getElement().find(\"textarea\");\n                $textarea.val(Strings.PLEASE_WAIT);\n                onProgress();\n            }\n\n            let finalValue, finalError;\n            function finish() {\n                finished = true;\n                if (dialog) {\n                    dialog.close();\n                }\n                if(finalError){\n                    reject(finalError);\n                } else {\n                    resolve(finalValue);\n                }\n            }\n\n            if (!options.preDelay) {\n                showDialog();\n            } else {\n                setTimeout(function () {\n                    showDialog();\n                }, options.preDelay * 1000);\n            }\n\n            progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.progressDlg`);\n            progressTracker.on(`${Events.GIT_PROGRESS_EVENT}.progressDlg`, (_evt, data)=>{\n                onProgress(data);\n            });\n            promise\n                .then(val => {\n                    finalValue = val;\n                })\n                .catch(err => {\n                    finalError = err;\n                })\n                .finally(function () {\n                    progressTracker.off(`${Events.GIT_PROGRESS_EVENT}.progressDlg`);\n                    onProgress(\"Finished!\");\n                    if (!options.postDelay || !dialog) {\n                        finish();\n                    } else {\n                        setTimeout(function () {\n                            finish();\n                        }, options.postDelay * 1000);\n                    }\n                });\n\n        });\n    }\n\n    function waitForClose() {\n        return new Promise(function (resolve) {\n            function check() {\n                var visible = $(\"#git-progress-dialog\").is(\":visible\");\n                if (!visible) {\n                    resolve();\n                } else {\n                    setTimeout(check, 20);\n                }\n            }\n            setTimeout(check, 20);\n        });\n    }\n\n    function newProgressTracker() {\n        const tracker = {};\n        EventDispatcher.makeEventDispatcher(tracker);\n        return tracker;\n    }\n\n    exports.show = show;\n    exports.newProgressTracker = newProgressTracker;\n    exports.waitForClose = waitForClose;\n\n});\n\ndefine(\"src/dialogs/Pull\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const Preferences     = require(\"src/Preferences\"),\n        RemoteCommon    = require(\"src/dialogs/RemoteCommon\"),\n        Strings         = brackets.getModule(\"strings\");\n\n    // Templates\n    const template            = `<div id=\"git-pull-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.DIALOG_PULL_TITLE}} &mdash; {{config.remote}}</h1>\n    </div>\n    <div class=\"modal-body\">\n\n        {{> remotes}}\n\n        <hr>\n        <label class=\"text-bold\">\n            {{Strings.PULL_BEHAVIOR}}\n        </label>\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"DEFAULT\"> {{Strings.PULL_DEFAULT}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"AVOID_MERGING\"> {{Strings.PULL_AVOID_MERGING}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"MERGE_NOCOMMIT\"> {{Strings.PULL_MERGE_NOCOMMIT}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"REBASE\"> {{Strings.PULL_REBASE}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"RESET\"> {{Strings.PULL_RESET}}\n            </label>\n        </div>\n\n        <hr>\n\n        <div class=\"accordion\">\n            <!-- Hidden checkbox to toggle the accordion -->\n            <input type=\"checkbox\" id=\"advancedAccordionToggle\" class=\"accordion-toggle\" />\n\n            <!-- Accordion Header -->\n            <label for=\"advancedAccordionToggle\" class=\"accordion-header\">\n                {{Strings.MORE_OPTIONS}}\n                <i class=\"fas fa-chevron-down\"></i>\n            </label>\n\n            <!-- Accordion Content -->\n            <div class=\"accordion-content\">\n                <label class=\"text-bold\">\n                    {{Strings.CREDENTIALS}}\n                </label>\n                <div>\n                    <label class=\"text-quiet\">\n                        {{Strings.SAVE_CREDENTIALS_HELP}}\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.USERNAME}}:\n                    </label>\n                    <label>\n                        <input type=\"text\" name=\"username\" value=\"{{config.remoteUsername}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.PASSWORD}}:\n                    </label>\n                    <label>\n                        <input type=\"password\" name=\"password\" value=\"{{config.remotePassword}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"saveToUrl\" />\n                        {{Strings.SAVE_CREDENTIALS_IN_URL}}\n                    </label>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n</div>\n`,\n        remotesTemplate     = `<div class=\"current-tracking-branch\">\n    <label>\n        {{Strings.CURRENT_TRACKING_BRANCH}}:\n    </label>\n    <label class=\"text-bold\">\n        {{config.currentTrackingBranch}}\n        {{^config.currentTrackingBranch}}\n        none - \"{{config.currentBranchName}}\" branch will be created on remote\n        {{/config.currentTrackingBranch}}\n    </label>\n</div>\n\n<div>\n    <label class=\"text-bold\">\n        {{Strings.TARGET_BRANCH}}\n    </label>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_CURRENT\" checked> {{modeLabel}} {{Strings._CURRENT_TRACKING_BRANCH}}\n    </label>\n</div>\n\n<div>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_SELECTED\"> {{modeLabel}} {{Strings._ANOTHER_BRANCH}}\n    </label>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <div class=\"input-append\">\n        <select class=\"branchSelect\" name=\"selectedBranch\"></select>\n        <button class=\"btn fetchBranches\" type=\"button\"><i class=\"octicon octicon-sync\"></i></button>\n    </div>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <label>\n        <input type=\"checkbox\" name=\"setBranchAsTracking\"> {{Strings.SET_THIS_BRANCH_AS_TRACKING}}\n    </label>\n</div>\n`;\n\n    // Implementation\n    function _attachEvents($dialog, pullConfig) {\n        RemoteCommon.attachCommonEvents(pullConfig, $dialog);\n\n        // load last used\n        $dialog\n            .find(\"input[name='strategy']\")\n            .filter(\"[value='\" + (Preferences.get(\"pull.strategy\") || \"DEFAULT\") + \"']\")\n            .prop(\"checked\", true);\n    }\n\n    function _show(pullConfig, resolve, reject) {\n        const templateArgs = {\n            config: pullConfig,\n            mode: \"PULL_FROM\",\n            modeLabel: Strings.PULL_FROM,\n            Strings: Strings\n        };\n\n        const compiledTemplate = Mustache.render(template, templateArgs, {\n                remotes: remotesTemplate\n            }),\n            dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog = dialog.getElement();\n\n        _attachEvents($dialog, pullConfig);\n\n        dialog.done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                RemoteCommon.collectValues(pullConfig, $dialog);\n                Preferences.set(\"pull.strategy\", pullConfig.strategy);\n                resolve(pullConfig);\n            } else {\n                reject();\n            }\n        });\n    }\n\n    function show(pullConfig) {\n        return new Promise((resolve, reject) => {\n            pullConfig.pull = true;\n            // collectInfo never rejects\n            RemoteCommon.collectInfo(pullConfig).then(()=>{\n                _show(pullConfig, resolve, reject);\n            });\n        });\n    }\n\n    exports.show = show;\n\n});\n\ndefine(\"src/dialogs/Push\", function (require, exports) {\n\n    // Brackets modules\n    const Dialogs = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const RemoteCommon    = require(\"src/dialogs/RemoteCommon\"),\n        Strings           = brackets.getModule(\"strings\");\n\n    // Templates\n    const template            = `<div id=\"git-push-dialog\" class=\"git modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.DIALOG_PUSH_TITLE}} &mdash; {{config.remote}}</h1>\n    </div>\n    <div class=\"modal-body\">\n\n        {{> remotes}}\n\n        <hr>\n        <label class=\"text-bold\">\n            {{Strings.PUSH_BEHAVIOR}}\n        </label>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"DEFAULT\"> {{Strings.PUSH_DEFAULT}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"FORCED\"> {{Strings.PUSH_FORCED}}\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type=\"radio\" name=\"strategy\" value=\"DELETE_BRANCH\"> {{Strings.PUSH_DELETE_BRANCH}}\n            </label>\n        </div>\n\n        <hr>\n\n        <div class=\"accordion\">\n            <!-- Hidden checkbox to toggle the accordion -->\n            <input type=\"checkbox\" id=\"advancedAccordionToggle\" class=\"accordion-toggle\" />\n\n            <!-- Accordion Header -->\n            <label for=\"advancedAccordionToggle\" class=\"accordion-header\">\n                {{Strings.MORE_OPTIONS}}\n                <i class=\"fas fa-chevron-down\"></i>\n            </label>\n\n            <!-- Accordion Content -->\n            <div class=\"accordion-content\">\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"send_tags\" value=\"true\"> {{Strings.PUSH_SEND_TAGS}}\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"push-no-verify\" value=\"true\"> {{Strings.SKIP_PRE_PUSH_CHECKS}}\n                    </label>\n                </div>\n                <br>\n                <label class=\"text-bold\">\n                    {{Strings.CREDENTIALS}}\n                </label>\n                <div>\n                    <label class=\"text-quiet\">\n                        {{Strings.SAVE_CREDENTIALS_HELP}}\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.USERNAME}}:\n                    </label>\n                    <label>\n                        <input type=\"text\" name=\"username\" value=\"{{config.remoteUsername}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        {{Strings.PASSWORD}}:\n                    </label>\n                    <label>\n                        <input type=\"password\" name=\"password\" value=\"{{config.remotePassword}}\" autocomplete=\"off\" spellcheck=\"false\"/>\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        <input type=\"checkbox\" name=\"saveToUrl\" />\n                        {{Strings.SAVE_CREDENTIALS_IN_URL}}\n                    </label>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"ok\">{{Strings.OK}}</button>\n    </div>\n</div>\n`,\n        remotesTemplate     = `<div class=\"current-tracking-branch\">\n    <label>\n        {{Strings.CURRENT_TRACKING_BRANCH}}:\n    </label>\n    <label class=\"text-bold\">\n        {{config.currentTrackingBranch}}\n        {{^config.currentTrackingBranch}}\n        none - \"{{config.currentBranchName}}\" branch will be created on remote\n        {{/config.currentTrackingBranch}}\n    </label>\n</div>\n\n<div>\n    <label class=\"text-bold\">\n        {{Strings.TARGET_BRANCH}}\n    </label>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_CURRENT\" checked> {{modeLabel}} {{Strings._CURRENT_TRACKING_BRANCH}}\n    </label>\n</div>\n\n<div>\n    <label>\n        <input type=\"radio\" name=\"action\" value=\"{{mode}}_SELECTED\"> {{modeLabel}} {{Strings._ANOTHER_BRANCH}}\n    </label>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <div class=\"input-append\">\n        <select class=\"branchSelect\" name=\"selectedBranch\"></select>\n        <button class=\"btn fetchBranches\" type=\"button\"><i class=\"octicon octicon-sync\"></i></button>\n    </div>\n</div>\n\n<div class=\"only-from-selected\" style=\"margin-left: 15px;\">\n    <label>\n        <input type=\"checkbox\" name=\"setBranchAsTracking\"> {{Strings.SET_THIS_BRANCH_AS_TRACKING}}\n    </label>\n</div>\n`;\n\n    // Implementation\n    function _attachEvents($dialog, pushConfig) {\n        RemoteCommon.attachCommonEvents(pushConfig, $dialog);\n\n        // select default - we don't want to remember forced or delete branch as default\n        $dialog\n            .find(\"input[name='strategy']\")\n            .filter(\"[value='DEFAULT']\")\n            .prop(\"checked\", true);\n    }\n\n    function _show(pushConfig, resolve, reject) {\n        const templateArgs = {\n            config: pushConfig,\n            mode: \"PUSH_TO\",\n            modeLabel: Strings.PUSH_TO,\n            Strings: Strings\n        };\n\n        const compiledTemplate = Mustache.render(template, templateArgs, {\n                remotes: remotesTemplate\n            }),\n            dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog = dialog.getElement();\n\n        _attachEvents($dialog, pushConfig);\n\n        dialog.done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                RemoteCommon.collectValues(pushConfig, $dialog);\n                resolve(pushConfig);\n            } else {\n                reject();\n            }\n        });\n    }\n\n    function show(pushConfig) {\n        return new Promise((resolve, reject) => {\n            pushConfig.push = true;\n            // collectInfo never rejects\n            RemoteCommon.collectInfo(pushConfig).then(()=>{\n                _show(pushConfig, resolve, reject);\n            });\n        });\n    }\n\n    exports.show = show;\n\n});\n\ndefine(\"src/dialogs/RemoteCommon\", function (require, exports) {\n\n    // Brackets modules\n    const _ = brackets.getModule(\"thirdparty/lodash\"),\n        Strings = brackets.getModule(\"strings\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const ErrorHandler    = require(\"src/ErrorHandler\"),\n        Git             = require(\"src/git/Git\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\");\n\n    // Implementation\n\n    function fillBranches(config, $dialog) {\n        Git.getAllBranches().then(function (branches) {\n            // filter only branches for this remote\n            branches = _.filter(branches, function (branch) {\n                return branch.remote === config.remote;\n            });\n\n            const template = \"{{#branches}}<option value='{{name}}' remote='{{remote}}' \" +\n                \"{{#currentBranch}}selected{{/currentBranch}}>{{name}}</option>{{/branches}}\";\n            const html = Mustache.render(template, { branches: branches });\n            $dialog.find(\".branchSelect\").html(html);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_BRANCH_LIST);\n        });\n    }\n\n    // this should never reject for now, just show error message and bail out\n    exports.collectInfo = function (config) {\n        return Git.getCurrentUpstreamBranch().then(function (upstreamBranch) {\n            config.currentTrackingBranch = upstreamBranch;\n\n            return Git.getRemoteUrl(config.remote).then(function (remoteUrl) {\n                config.remoteUrl = remoteUrl;\n\n                if (remoteUrl.match(/^https?:/)) {\n                    const url = new URL(remoteUrl);\n                    config.remoteUsername = url.username;\n                    config.remotePassword = url.password;\n                } else {\n                    // disable the inputs\n                    config._usernamePasswordDisabled = true;\n                }\n\n                if (!upstreamBranch) {\n                    return Git.getCurrentBranchName().then(function (currentBranchName) {\n                        config.currentBranchName = currentBranchName;\n                    });\n                }\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE);\n        });\n    };\n\n    exports.attachCommonEvents = function (config, $dialog) {\n        const handleRadioChange = function () {\n            const val = $dialog.find(\"input[name='action']:checked\").val();\n            $dialog.find(\".only-from-selected\").toggle(val === \"PULL_FROM_SELECTED\" || val === \"PUSH_TO_SELECTED\");\n        };\n        $dialog.on(\"change\", \"input[name='action']\", handleRadioChange);\n        handleRadioChange();\n\n        let trackingBranchRemote = null;\n        if (config.currentTrackingBranch) {\n            trackingBranchRemote = config.currentTrackingBranch.substring(0, config.currentTrackingBranch.indexOf(\"/\"));\n        }\n\n        // if we're pulling from another remote than current tracking remote\n        if (config.currentTrackingBranch && trackingBranchRemote !== config.remote) {\n            if (config.pull) {\n                $dialog.find(\"input[value='PULL_FROM_CURRENT']\").prop(\"disabled\", true);\n                $dialog.find(\"input[value='PULL_FROM_SELECTED']\").prop(\"checked\", true).trigger(\"change\");\n            } else {\n                $dialog.find(\"input[value='PUSH_TO_CURRENT']\").prop(\"disabled\", true);\n                $dialog.find(\"input[value='PUSH_TO_SELECTED']\").prop(\"checked\", true).trigger(\"change\");\n            }\n        }\n\n        $dialog.on(\"click\", \".fetchBranches\", function () {\n            const tracker = ProgressDialog.newProgressTracker();\n            ProgressDialog.show(Git.fetchRemote(config.remote, tracker), tracker)\n                .then(function () {\n                    fillBranches(config, $dialog);\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE);\n                });\n        });\n        fillBranches(config, $dialog);\n\n        if (config._usernamePasswordDisabled) {\n            $dialog.find(\"input[name='username'],input[name='password'],input[name='saveToUrl']\").prop(\"disabled\", true);\n        }\n    };\n\n    exports.collectValues = function (config, $dialog) {\n        const action = $dialog.find(\"input[name='action']:checked\").val();\n        if (action === \"PULL_FROM_CURRENT\" || action === \"PUSH_TO_CURRENT\") {\n\n            if (config.currentTrackingBranch) {\n                config.branch = config.currentTrackingBranch.substring(config.remote.length + 1);\n            } else {\n                config.branch = config.currentBranchName;\n                config.pushToNew = true;\n            }\n\n        } else if (action === \"PULL_FROM_SELECTED\" || action === \"PUSH_TO_SELECTED\") {\n            config.branch = $dialog.find(\".branchSelect\").val().substring(config.remote.length + 1);\n            config.setBranchAsTracking = $dialog.find(\"input[name='setBranchAsTracking']\").is(\":checked\");\n        }\n\n        config.strategy = $dialog.find(\"input[name='strategy']:checked\").val();\n        config.tags = $dialog.find(\"input[name='send_tags']:checked\").val();\n        config.noVerify = $dialog.find(\"input[name='push-no-verify']:checked\").val();\n\n        config.remoteUsername = $dialog.find(\"input[name='username']\").val();\n        config.remotePassword = $dialog.find(\"input[name='password']\").val();\n\n        // new url that has to be set for merging\n        let remoteUrlNew;\n        if (config.remoteUrl.match(/^https?:/)) {\n            const url = new URL(config.remoteUrl);\n            url.username = config.remoteUsername;\n            url.password = config.remotePassword;\n            remoteUrlNew = url.toString();\n        }\n\n        // assign remoteUrlNew only if it's different from the original url\n        if (remoteUrlNew && config.remoteUrl !== remoteUrlNew) {\n            config.remoteUrlNew = remoteUrlNew;\n        }\n\n        // old url that has to be put back after merging\n        const saveToUrl = $dialog.find(\"input[name='saveToUrl']\").is(\":checked\");\n        // assign restore branch only if remoteUrlNew has some value\n        if (config.remoteUrlNew && !saveToUrl) {\n            config.remoteUrlRestore = config.remoteUrl;\n        }\n    };\n\n});\n\n/*\n    This file acts as an entry point to GitCli.js and other possible\n    implementations of Git communication besides Cli. Application\n    should not access GitCli directly.\n*/\ndefine(\"src/git/Git\", function (require, exports) {\n\n    // Local modules\n    const Preferences = require(\"src/Preferences\"),\n        GitCli      = require(\"src/git/GitCli\"),\n        Utils       = require(\"src/Utils\");\n\n    // Implementation\n    function pushToNewUpstream(remoteName, remoteBranch, options = {}) {\n        const args = [\"--set-upstream\"];\n\n        if (options.noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        return GitCli.push(remoteName, remoteBranch, args, options.progressTracker);\n    }\n\n    function getRemoteUrl(remote) {\n        return GitCli.getConfig(\"remote.\" + remote + \".url\");\n    }\n\n    function setRemoteUrl(remote, url) {\n        return GitCli.setConfig(\"remote.\" + remote + \".url\", url);\n    }\n\n    function sortBranches(branches) {\n        return branches.sort(function (a, b) {\n            var ar = a.remote || \"\",\n                br = b.remote || \"\";\n            // origin remote first\n            if (br && ar === \"origin\" && br !== \"origin\") {\n                return -1;\n            } else if (ar && ar !== \"origin\" && br === \"origin\") {\n                return 1;\n            }\n            // sort by remotes\n            if (ar < br) {\n                return -1;\n            } else if (ar > br) {\n                return 1;\n            }\n            // sort by sortPrefix (# character)\n            if (a.sortPrefix < b.sortPrefix) {\n                return -1;\n            } else if (a.sortPrefix > b.sortPrefix) {\n                return 1;\n            }\n            // master branch first\n            if (a.sortName === \"master\" && b.sortName !== \"master\") {\n                return -1;\n            } else if (a.sortName !== \"master\" && b.sortName === \"master\") {\n                return 1;\n            }\n            // sort by sortName (lowercased branch name)\n            return a.sortName < b.sortName ? -1 : a.sortName > b.sortName ? 1 : 0;\n        });\n    }\n\n    function getBranches() {\n        return GitCli.getBranches().then(function (branches) {\n            return sortBranches(branches);\n        });\n    }\n\n    function getAllBranches() {\n        return GitCli.getAllBranches().then(function (branches) {\n            return sortBranches(branches);\n        });\n    }\n\n    function getHistory(branch, skip) {\n        return GitCli.getHistory(branch, skip);\n    }\n\n    function getFileHistory(file, branch, skip) {\n        return GitCli.getHistory(branch, skip, file);\n    }\n\n    function resetIndex() {\n        return GitCli.reset();\n    }\n\n    function discardAllChanges() {\n        return GitCli.reset(\"--hard\").then(function () {\n            return GitCli.clean();\n        });\n    }\n\n    function getMergeInfo() {\n        var baseCheck  = [\"MERGE_MODE\", \"rebase-apply\"],\n            mergeCheck = [\"MERGE_HEAD\", \"MERGE_MSG\"],\n            rebaseCheck = [\"rebase-apply/next\", \"rebase-apply/last\", \"rebase-apply/head-name\"],\n            gitFolder  = Preferences.get(\"currentGitRoot\") + \".git/\";\n\n        return Promise.all(baseCheck.map(function (fileName) {\n            return Utils.loadPathContent(gitFolder + fileName);\n        })).then(function ([mergeMode, rebaseMode]) {\n            var obj = {\n                mergeMode: mergeMode !== null,\n                rebaseMode: rebaseMode !== null\n            };\n            if (obj.mergeMode) {\n\n                return Promise.all(mergeCheck.map(function (fileName) {\n                    return Utils.loadPathContent(gitFolder + fileName);\n                })).then(function ([head, msg]) {\n\n                    if (head) {\n                        obj.mergeHead = head.trim();\n                    }\n                    var msgSplit = msg ? msg.trim().split(/conflicts:/i) : [];\n                    if (msgSplit[0]) {\n                        obj.mergeMessage = msgSplit[0].trim();\n                    }\n                    if (msgSplit[1]) {\n                        obj.mergeConflicts = msgSplit[1].trim().split(\"\\n\").map(function (line) { return line.trim(); });\n                    }\n                    return obj;\n\n                });\n\n            }\n            if (obj.rebaseMode) {\n\n                return Promise.all(rebaseCheck.map(function (fileName) {\n                    return Utils.loadPathContent(gitFolder + fileName);\n                })).then(function ([next, last, head]) {\n\n                    if (next) { obj.rebaseNext = next.trim(); }\n                    if (last) { obj.rebaseLast = last.trim(); }\n                    if (head) { obj.rebaseHead = head.trim().substring(\"refs/heads/\".length); }\n                    return obj;\n\n                });\n\n            }\n            return obj;\n        });\n    }\n\n    function discardFileChanges(file) {\n        return GitCli.unstage(file).then(function () {\n            return GitCli.checkout(file);\n        });\n    }\n\n    function pushForced(remote, branch, options = {}) {\n        const args = [\"--force\"];\n\n        if (options.noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        return GitCli.push(remote, branch, args, options.progressTracker);\n    }\n\n    function deleteRemoteBranch(remote, branch, options = {}) {\n        const args = [\"--delete\"];\n\n        if (options.noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        return GitCli.push(remote, branch, args, options.progressTracker);\n    }\n\n    function undoLastLocalCommit() {\n        return GitCli.reset(\"--soft\", \"HEAD~1\");\n    }\n\n    // Public API\n    exports.pushToNewUpstream       = pushToNewUpstream;\n    exports.getBranches             = getBranches;\n    exports.getAllBranches          = getAllBranches;\n    exports.getHistory              = getHistory;\n    exports.getFileHistory          = getFileHistory;\n    exports.resetIndex              = resetIndex;\n    exports.discardAllChanges       = discardAllChanges;\n    exports.getMergeInfo            = getMergeInfo;\n    exports.discardFileChanges      = discardFileChanges;\n    exports.getRemoteUrl            = getRemoteUrl;\n    exports.setRemoteUrl            = setRemoteUrl;\n    exports.pushForced              = pushForced;\n    exports.deleteRemoteBranch      = deleteRemoteBranch;\n    exports.undoLastLocalCommit     = undoLastLocalCommit;\n\n    Object.keys(GitCli).forEach(function (method) {\n        if (!exports[method]) {\n            exports[method] = GitCli[method];\n        }\n    });\n});\n\n/*globals jsPromise, fs*/\n\n/*\n    This module is used to communicate with Git through Cli\n    Output string from Git should always be parsed here\n    to provide more sensible outputs than just plain strings.\n    Format of the output should be specified in Git.js\n*/\ndefine(\"src/git/GitCli\", function (require, exports) {\n\n    // Brackets modules\n    const _           = brackets.getModule(\"thirdparty/lodash\"),\n        FileSystem  = brackets.getModule(\"filesystem/FileSystem\"),\n        Strings     = brackets.getModule(\"strings\"),\n        FileUtils   = brackets.getModule(\"file/FileUtils\");\n\n    // Local modules\n    const Cli           = require(\"src/Cli\"),\n        ErrorHandler  = require(\"src/ErrorHandler\"),\n        Events        = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        ExpectedError = require(\"src/ExpectedError\"),\n        Preferences   = require(\"src/Preferences\"),\n        Utils         = require(\"src/Utils\");\n\n    // Module variables\n    let _gitPath = null,\n        _gitQueue = [],\n        _gitQueueBusy = false,\n        lastGitStatusResults;\n\n    var FILE_STATUS = {\n        STAGED: \"STAGED\",\n        UNMODIFIED: \"UNMODIFIED\",\n        IGNORED: \"IGNORED\",\n        UNTRACKED: \"UNTRACKED\",\n        MODIFIED: \"MODIFIED\",\n        ADDED: \"ADDED\",\n        DELETED: \"DELETED\",\n        RENAMED: \"RENAMED\",\n        COPIED: \"COPIED\",\n        UNMERGED: \"UNMERGED\"\n    };\n\n    // This SHA1 represents the empty tree. You get it using `git mktree < /dev/null`\n    var EMPTY_TREE = \"4b825dc642cb6eb9a060e54bf8d69288fbee4904\";\n\n    // Implementation\n    function getGitPath() {\n        if (_gitPath) { return _gitPath; }\n        _gitPath = Preferences.get(\"gitPath\");\n        return _gitPath;\n    }\n\n    Preferences.getExtensionPref().on(\"change\", \"gitPath\", ()=>{\n        _gitPath = Preferences.get(\"gitPath\");\n    });\n\n    function setGitPath(path) {\n        if (path === true) { path = \"git\"; }\n        Preferences.set(\"gitPath\", path);\n        _gitPath = path;\n    }\n\n    function strEndsWith(subjectString, searchString, position) {\n        if (position === undefined || position > subjectString.length) {\n            position = subjectString.length;\n        }\n        position -= searchString.length;\n        var lastIndex = subjectString.indexOf(searchString, position);\n        return lastIndex !== -1 && lastIndex === position;\n    }\n\n    /*\n    function fixCygwinPath(path) {\n        if (typeof path === \"string\" && brackets.platform === \"win\" && path.indexOf(\"/cygdrive/\") === 0) {\n            path = path.substring(\"/cygdrive/\".length)\n                       .replace(/^([a-z]+)\\//, function (a, b) {\n                           return b.toUpperCase() + \":/\";\n                       });\n        }\n        return path;\n    }\n    */\n\n    function _processQueue() {\n        // do nothing if the queue is busy\n        if (_gitQueueBusy) {\n            return;\n        }\n        // do nothing if the queue is empty\n        if (_gitQueue.length === 0) {\n            _gitQueueBusy = false;\n            return;\n        }\n        // get item from queue\n        const item  = _gitQueue.shift(),\n            resolve = item[0],\n            reject = item[1],\n            args  = item[2],\n            opts  = item[3];\n        // execute git command in a queue so no two commands are running at the same time\n        if (opts.nonblocking !== true) { _gitQueueBusy = true; }\n        Cli.spawnCommand(getGitPath(), args, opts)\n            .then(function (r) {\n                resolve(r);\n            })\n            .catch(function (e) {\n                const call = \"call: git \" + args.join(\" \");\n                e.stack = [call, e.stack].join(\"\\n\");\n                reject(e);\n            })\n            .finally(function () {\n                if (opts.nonblocking !== true) { _gitQueueBusy = false; }\n                _processQueue();\n            });\n    }\n\n    function git(args, opts) {\n        return new Promise((resolve, reject) => {\n            _gitQueue.push([resolve, reject, args || [], opts || {}]);\n            setTimeout(_processQueue);\n        });\n    }\n\n    /*\n        git branch\n        -d --delete Delete a branch.\n        -D Delete a branch irrespective of its merged status.\n        --no-color Turn off branch colors\n        -r --remotes List or delete (if used with -d) the remote-tracking branches.\n        -a --all List both remote-tracking branches and local branches.\n        --track When creating a new branch, set up branch.<name>.remote and branch.<name>.merge\n        --set-upstream If specified branch does not exist yet or if --force has been given, acts exactly like --track\n    */\n\n    function setUpstreamBranch(remoteName, remoteBranch, progressTracker) {\n        if (!remoteName) { throw new TypeError(\"remoteName argument is missing!\"); }\n        if (!remoteBranch) { throw new TypeError(\"remoteBranch argument is missing!\"); }\n        return git([\"branch\", \"--no-color\", \"-u\", remoteName + \"/\" + remoteBranch],\n            {progressTracker});\n    }\n\n    function branchDelete(branchName, progressTracker) {\n        return git([\"branch\", \"--no-color\", \"-d\", branchName], {progressTracker});\n    }\n\n    function forceBranchDelete(branchName, progressTracker) {\n        return git([\"branch\", \"--no-color\", \"-D\", branchName], {progressTracker});\n    }\n\n    function getBranches(moreArgs, progressTracker) {\n        var args = [\"branch\", \"--no-color\"];\n        if (moreArgs) { args = args.concat(moreArgs); }\n\n        return git(args, {progressTracker}).then(function (stdout) {\n            if (!stdout) { return []; }\n            return stdout.split(\"\\n\").reduce(function (arr, l) {\n                var name = l.trim(),\n                    currentBranch = false,\n                    remote = null,\n                    sortPrefix = \"\";\n\n                if (name.indexOf(\"->\") !== -1) {\n                    return arr;\n                }\n\n                if (name.indexOf(\"* \") === 0) {\n                    name = name.substring(2);\n                    currentBranch = true;\n                }\n\n                if (name.indexOf(\"remotes/\") === 0) {\n                    name = name.substring(\"remotes/\".length);\n                    remote = name.substring(0, name.indexOf(\"/\"));\n                }\n\n                var sortName = name.toLowerCase();\n                if (remote) {\n                    sortName = sortName.substring(remote.length + 1);\n                }\n                if (sortName.indexOf(\"#\") !== -1) {\n                    sortPrefix = sortName.slice(0, sortName.indexOf(\"#\"));\n                }\n\n                arr.push({\n                    name: name,\n                    sortPrefix: sortPrefix,\n                    sortName: sortName,\n                    currentBranch: currentBranch,\n                    remote: remote\n                });\n                return arr;\n            }, []);\n        });\n    }\n\n    function getAllBranches(progressTracker) {\n        return getBranches([\"-a\"], progressTracker);\n    }\n\n    /*\n        git fetch\n        --all Fetch all remotes.\n        --dry-run Show what would be done, without making any changes.\n        --multiple Allow several <repository> and <group> arguments to be specified. No <refspec>s may be specified.\n        --prune After fetching, remove any remote-tracking references that no longer exist on the remote.\n        --progress This flag forces progress status even if the standard error stream is not directed to a terminal.\n    */\n\n    function repositoryNotFoundHandler(err) {\n        var m = ErrorHandler.matches(err, /Repository (.*) not found$/gim);\n        if (m) {\n            throw new ExpectedError(m[0]);\n        }\n        throw err;\n    }\n\n    function fetchRemote(remote, progressTracker) {\n        return git([\"fetch\", \"--progress\", remote], {\n            progressTracker,\n            timeout: false // never timeout this\n        }).catch(repositoryNotFoundHandler);\n    }\n\n    function fetchAllRemotes(progressTracker) {\n        return git([\"fetch\", \"--progress\", \"--all\"], {\n            progressTracker,\n            timeout: false // never timeout this\n        }).catch(repositoryNotFoundHandler);\n    }\n\n    /*\n        git remote\n        add Adds a remote named <name> for the repository at <url>.\n        rename Rename the remote named <old> to <new>.\n        remove Remove the remote named <name>.\n        show Gives some information about the remote <name>.\n        prune Deletes all stale remote-tracking branches under <name>.\n\n    */\n\n    function getRemotes() {\n        return git([\"remote\", \"-v\"])\n            .then(function (stdout) {\n                return !stdout ? [] : _.uniq(stdout.replace(/\\((push|fetch)\\)/g, \"\").split(\"\\n\")).map(function (l) {\n                    var s = l.trim().split(\"\\t\");\n                    return {\n                        name: s[0],\n                        url: s[1]\n                    };\n                });\n            });\n    }\n\n    function createRemote(name, url) {\n        return git([\"remote\", \"add\", name, url])\n            .then(function () {\n                // stdout is empty so just return success\n                return true;\n            });\n    }\n\n    function deleteRemote(name) {\n        return git([\"remote\", \"rm\", name])\n            .then(function () {\n                // stdout is empty so just return success\n                return true;\n            });\n    }\n\n    /*\n        git pull\n        --no-commit Do not commit result after merge\n        --ff-only Refuse to merge and exit with a non-zero status\n                  unless the current HEAD is already up-to-date\n                  or the merge can be resolved as a fast-forward.\n    */\n\n    /**\n     *\n     * @param remote\n     * @param branch\n     * @param {boolean} [ffOnly]\n     * @param {boolean} [noCommit]\n     * @param {object} [options]\n     * @param [options.progressTracker]\n     * @returns {Promise<unknown>}\n     */\n    function mergeRemote(remote, branch, ffOnly, noCommit, options = {}) {\n        var args = [\"merge\"];\n\n        if (ffOnly) { args.push(\"--ff-only\"); }\n        if (noCommit) { args.push(\"--no-commit\", \"--no-ff\"); }\n\n        args.push(remote + \"/\" + branch);\n\n        var readMergeMessage = function () {\n            return Utils.loadPathContent(Preferences.get(\"currentGitRoot\") + \"/.git/MERGE_MSG\").then(function (msg) {\n                return msg;\n            });\n        };\n\n        return git(args, {progressTracker: options.progressTracker})\n            .then(function (stdout) {\n                // return stdout if available - usually not\n                if (stdout) { return stdout; }\n\n                return readMergeMessage().then(function (msg) {\n                    if (msg) { return msg; }\n                    return \"Remote branch \" + branch + \" from \" + remote + \" was merged to current branch\";\n                });\n            })\n            .catch(function (error) {\n                return readMergeMessage().then(function (msg) {\n                    if (msg) { return msg; }\n                    throw error;\n                });\n            });\n    }\n\n    function rebaseRemote(remote, branch, progressTracker) {\n        return git([\"rebase\", remote + \"/\" + branch], {progressTracker});\n    }\n\n    function resetRemote(remote, branch, progressTracker) {\n        return git([\"reset\", \"--soft\", remote + \"/\" + branch], {progressTracker}).then(function (stdout) {\n            return stdout || \"Current branch was resetted to branch \" + branch + \" from \" + remote;\n        });\n    }\n\n    function mergeBranch(branchName, mergeMessage, useNoff) {\n        var args = [\"merge\"];\n        if (useNoff) { args.push(\"--no-ff\"); }\n        if (mergeMessage && mergeMessage.trim()) { args.push(\"-m\", mergeMessage); }\n        args.push(branchName);\n        return git(args);\n    }\n\n    /*\n        git push\n        --porcelain Produce machine-readable output.\n        --delete All listed refs are deleted from the remote repository. This is the same as prefixing all refs with a colon.\n        --force Usually, the command refuses to update a remote ref that is not an ancestor of the local ref used to overwrite it.\n        --set-upstream For every branch that is up to date or successfully pushed, add upstream (tracking) reference\n        --progress This flag forces progress status even if the standard error stream is not directed to a terminal.\n    */\n\n    /*\n        returns parsed push response in this format:\n        {\n            flag: \"=\"\n            flagDescription: \"Ref was up to date and did not need pushing\"\n            from: \"refs/heads/rewrite-remotes\"\n            remoteUrl: \"http://github.com/zaggino/brackets-git.git\"\n            status: \"Done\"\n            summary: \"[up to date]\"\n            to: \"refs/heads/rewrite-remotes\"\n        }\n    */\n    function push(remoteName, remoteBranch, additionalArgs, progressTracker) {\n        if (!remoteName) { throw new TypeError(\"remoteName argument is missing!\"); }\n\n        var args = [\"push\", \"--porcelain\", \"--progress\"];\n        if (Array.isArray(additionalArgs)) {\n            args = args.concat(additionalArgs);\n        }\n        args.push(remoteName);\n\n        if (remoteBranch && Preferences.get(\"gerritPushref\")) {\n            return getConfig(\"gerrit.pushref\").then(function (strGerritEnabled) {\n                if (strGerritEnabled === \"true\") {\n                    args.push(\"HEAD:refs/for/\" + remoteBranch);\n                } else {\n                    args.push(remoteBranch);\n                }\n                return doPushWithArgs(args, progressTracker);\n            });\n        }\n\n        if (remoteBranch) {\n            args.push(remoteBranch);\n        }\n\n        return doPushWithArgs(args, progressTracker);\n    }\n\n    function doPushWithArgs(args, progressTracker) {\n        return git(args, {progressTracker})\n            .catch(repositoryNotFoundHandler)\n            .then(function (stdout) {\n                // this should clear lines from push hooks\n                var lines = stdout.split(\"\\n\");\n                while (lines.length > 0 && lines[0].match(/^To/) === null) {\n                    lines.shift();\n                }\n\n                var retObj = {},\n                    lineTwo = lines[1].split(\"\\t\");\n\n                retObj.remoteUrl = lines[0].trim().split(\" \")[1];\n                retObj.flag = lineTwo[0];\n                retObj.from = lineTwo[1].split(\":\")[0];\n                retObj.to = lineTwo[1].split(\":\")[1];\n                retObj.summary = lineTwo[2];\n                retObj.status = lines[2];\n\n                switch (retObj.flag) {\n                    case \" \":\n                        retObj.flagDescription = Strings.GIT_PUSH_SUCCESS_MSG;\n                        break;\n                    case \"+\":\n                        retObj.flagDescription = Strings.GIT_PUSH_FORCE_UPDATED_MSG;\n                        break;\n                    case \"-\":\n                        retObj.flagDescription = Strings.GIT_PUSH_DELETED_MSG;\n                        break;\n                    case \"*\":\n                        retObj.flagDescription = Strings.GIT_PUSH_NEW_REF_MSG;\n                        break;\n                    case \"!\":\n                        retObj.flagDescription = Strings.GIT_PUSH_REJECTED_MSG;\n                        break;\n                    case \"=\":\n                        retObj.flagDescription = Strings.GIT_PUSH_UP_TO_DATE_MSG;\n                        break;\n                    default:\n                        retObj.flagDescription = \"Unknown push flag received: \" + retObj.flag; // internal error not translated\n                }\n\n                return retObj;\n            });\n    }\n\n    function getCurrentBranchName() {\n        return git([\"branch\", \"--no-color\"]).then(function (stdout) {\n            var branchName = _.find(stdout.split(\"\\n\"), function (l) { return l[0] === \"*\"; });\n            if (branchName) {\n                branchName = branchName.substring(1).trim();\n\n                var m = branchName.match(/^\\(.*\\s(\\S+)\\)$/); // like (detached from f74acd4)\n                if (m) { return m[1]; }\n\n                return branchName;\n            }\n\n            // no branch situation so we need to create one by doing a commit\n            if (stdout.match(/^\\s*$/)) {\n                EventEmitter.emit(Events.GIT_NO_BRANCH_EXISTS);\n                // master is the default name of the branch after git init\n                return \"master\";\n            }\n\n            // alternative\n            return git([\"log\", \"--pretty=format:%H %d\", \"-1\"]).then(function (stdout) {\n                var m = stdout.trim().match(/^(\\S+)\\s+\\((.*)\\)$/);\n                var hash = m[1].substring(0, 20);\n                m[2].split(\",\").forEach(function (info) {\n                    info = info.trim();\n\n                    if (info === \"HEAD\") { return; }\n\n                    var m = info.match(/^tag:(.+)$/);\n                    if (m) {\n                        hash = m[1].trim();\n                        return;\n                    }\n\n                    hash = info;\n                });\n                return hash;\n            });\n        });\n    }\n\n    function getCurrentUpstreamBranch() {\n        return git([\"rev-parse\", \"--abbrev-ref\", \"--symbolic-full-name\", \"@{u}\"])\n            .catch(function () {\n                return null;\n            });\n    }\n\n    // Get list of deleted files between two branches\n    function getDeletedFiles(oldBranch, newBranch) {\n        return git([\"diff\", \"--no-ext-diff\", \"--name-status\", oldBranch + \"..\" + newBranch])\n            .then(function (stdout) {\n                var regex = /^D/;\n                return stdout.split(\"\\n\").reduce(function (arr, row) {\n                    if (regex.test(row)) {\n                        arr.push(row.substring(1).trim());\n                    }\n                    return arr;\n                }, []);\n            });\n    }\n\n    function getConfig(key) {\n        return git([\"config\", key.replace(/\\s/g, \"\")]);\n    }\n\n    function setConfig(key, value, allowGlobal) {\n        key = key.replace(/\\s/g, \"\");\n        return git([\"config\", key, value]).catch(function (err) {\n\n            if (allowGlobal && ErrorHandler.contains(err, \"No such file or directory\")) {\n                return git([\"config\", \"--global\", key, value]);\n            }\n\n            throw err;\n\n        });\n    }\n\n    function getHistory(branch, skipCommits, file) {\n        var separator = \"_._\",\n            newline   = \"_.nw._\",\n            format = [\n                \"%h\",  // abbreviated commit hash\n                \"%H\",  // commit hash\n                \"%an\", // author name\n                \"%aI\", // author date, ISO 8601 format\n                \"%ae\", // author email\n                \"%s\",  // subject\n                \"%b\",  // body\n                \"%d\"   // tags\n            ].join(separator) + newline;\n\n        var args = [\"log\", \"-100\", \"--date=iso\"];\n        if (skipCommits) { args.push(\"--skip=\" + skipCommits); }\n        args.push(\"--format=\" + format, branch, \"--\");\n\n        // follow is too buggy - do not use\n        // if (file) { args.push(\"--follow\"); }\n        if (file) { args.push(file); }\n\n        return git(args).then(function (stdout) {\n            stdout = stdout.substring(0, stdout.length - newline.length);\n            return !stdout ? [] : stdout.split(newline).map(function (line) {\n\n                var data = line.trim().split(separator),\n                    commit = {};\n\n                commit.hashShort  = data[0];\n                commit.hash       = data[1];\n                commit.author     = data[2];\n                commit.date       = data[3];\n                commit.email      = data[4];\n                commit.subject    = data[5];\n                commit.body       = data[6];\n\n                if (data[7]) {\n                    var tags = data[7];\n                    var regex = new RegExp(\"tag: ([^,|\\)]+)\", \"g\");\n                    tags = tags.match(regex);\n\n                    for (var key in tags) {\n                        if (tags[key] && tags[key].replace) {\n                            tags[key] = tags[key].replace(\"tag:\", \"\");\n                        }\n                    }\n                    commit.tags = tags;\n                }\n\n                return commit;\n\n            });\n        });\n    }\n\n    function init() {\n        return git([\"init\"]);\n    }\n\n    function clone(remoteGitUrl, destinationFolder, progressTracker) {\n        return git([\"clone\", remoteGitUrl, destinationFolder, \"--progress\"], {\n            progressTracker,\n            timeout: false // never timeout this\n        });\n    }\n\n    function stage(fileOrFiles, updateIndex) {\n        var args = [\"add\"];\n        if (updateIndex) { args.push(\"-u\"); }\n        return git(args.concat(\"--\", fileOrFiles));\n    }\n\n    function stageAll() {\n        return git([\"add\", \"--all\"]);\n    }\n\n    function commit(message, amend, noVerify, progressTracker) {\n        var lines = message.split(\"\\n\"),\n            args = [\"commit\"];\n\n        if (amend) {\n            args.push(\"--amend\", \"--reset-author\");\n        }\n\n        if (noVerify) {\n            args.push(\"--no-verify\");\n        }\n\n        if (lines.length === 1) {\n            args.push(\"-m\", message);\n            return git(args, {progressTracker});\n        } else {\n            return new Promise(function (resolve, reject) {\n                // FUTURE: maybe use git commit --file=-\n                var fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + \".phoenixGitTemp\");\n                jsPromise(FileUtils.writeText(fileEntry, message))\n                    .then(function () {\n                        args.push(\"-F\", \".phoenixGitTemp\");\n                        return git(args, {progressTracker});\n                    })\n                    .then(function (res) {\n                        fileEntry.unlink(function () {\n                            resolve(res);\n                        });\n                    })\n                    .catch(function (err) {\n                        fileEntry.unlink(function () {\n                            reject(err);\n                        });\n                    });\n            });\n        }\n    }\n\n    function reset(type, hash) {\n        var args = [\"reset\", type || \"--mixed\"]; // mixed is the default action\n        if (hash) { args.push(hash, \"--\"); }\n        return git(args);\n    }\n\n    function unstage(file) {\n        return git([\"reset\", \"--\", file]);\n    }\n\n    function checkout(hash) {\n        return git([\"checkout\", hash], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function createBranch(branchName, originBranch, trackOrigin) {\n        var args = [\"checkout\", \"-b\", branchName];\n\n        if (originBranch) {\n            if (trackOrigin) {\n                args.push(\"--track\");\n            }\n            args.push(originBranch);\n        }\n\n        return git(args);\n    }\n\n    function _isquoted(str) {\n        return str[0] === \"\\\"\" && str[str.length - 1] === \"\\\"\";\n    }\n\n    function _unquote(str) {\n        return str.substring(1, str.length - 1);\n    }\n\n    function _isescaped(str) {\n        return /\\\\[0-9]{3}/.test(str);\n    }\n\n    function status(type) {\n        return git([\"status\", \"-u\", \"--porcelain\"]).then(function (stdout) {\n            if (!stdout) { return []; }\n\n            var currentSubFolder = Preferences.get(\"currentGitSubfolder\");\n\n            // files that are modified both in index and working tree should be resetted\n            var isEscaped = false,\n                needReset = [],\n                results = [],\n                lines = stdout.split(\"\\n\");\n\n            lines.forEach(function (line) {\n                var statusStaged = line.substring(0, 1),\n                    statusUnstaged = line.substring(1, 2),\n                    status = [],\n                    file = line.substring(3);\n\n                // check if the file is quoted\n                if (_isquoted(file)) {\n                    file = _unquote(file);\n                    if (_isescaped(file)) {\n                        isEscaped = true;\n                    }\n                }\n\n                if (statusStaged !== \" \" && statusUnstaged !== \" \" &&\n                    statusStaged !== \"?\" && statusUnstaged !== \"?\") {\n                    needReset.push(file);\n                    return;\n                }\n\n                var statusChar;\n                if (statusStaged !== \" \" && statusStaged !== \"?\") {\n                    status.push(FILE_STATUS.STAGED);\n                    statusChar = statusStaged;\n                } else {\n                    statusChar = statusUnstaged;\n                }\n\n                switch (statusChar) {\n                    case \" \":\n                        status.push(FILE_STATUS.UNMODIFIED);\n                        break;\n                    case \"!\":\n                        status.push(FILE_STATUS.IGNORED);\n                        break;\n                    case \"?\":\n                        status.push(FILE_STATUS.UNTRACKED);\n                        break;\n                    case \"M\":\n                        status.push(FILE_STATUS.MODIFIED);\n                        break;\n                    case \"A\":\n                        status.push(FILE_STATUS.ADDED);\n                        break;\n                    case \"D\":\n                        status.push(FILE_STATUS.DELETED);\n                        break;\n                    case \"R\":\n                        status.push(FILE_STATUS.RENAMED);\n                        break;\n                    case \"C\":\n                        status.push(FILE_STATUS.COPIED);\n                        break;\n                    case \"U\":\n                        status.push(FILE_STATUS.UNMERGED);\n                        break;\n                    default:\n                        throw new Error(\"Unexpected status: \" + statusChar);\n                }\n\n                var display = file,\n                    io = file.indexOf(\"->\");\n                if (io !== -1) {\n                    file = file.substring(io + 2).trim();\n                }\n\n                // we don't want to display paths that lead to this file outside the project\n                if (currentSubFolder && display.indexOf(currentSubFolder) === 0) {\n                    display = display.substring(currentSubFolder.length);\n                }\n\n                results.push({\n                    status: status,\n                    display: display,\n                    file: file,\n                    name: file.substring(file.lastIndexOf(\"/\") + 1)\n                });\n            });\n\n            if (isEscaped) {\n                return setConfig(\"core.quotepath\", \"false\").then(function () {\n                    if (type === \"SET_QUOTEPATH\") {\n                        throw new Error(\"git status is calling itself in a recursive loop!\");\n                    }\n                    return status(\"SET_QUOTEPATH\");\n                });\n            }\n\n            if (needReset.length > 0) {\n                return Promise.all(needReset.map(function (fileName) {\n                    if (fileName.indexOf(\"->\") !== -1) {\n                        fileName = fileName.split(\"->\")[1].trim();\n                    }\n                    return unstage(fileName);\n                })).then(function () {\n                    if (type === \"RECURSIVE_CALL\") {\n                        throw new Error(\"git status is calling itself in a recursive loop!\");\n                    }\n                    return status(\"RECURSIVE_CALL\");\n                });\n            }\n\n            return results.sort(function (a, b) {\n                if (a.file < b.file) {\n                    return -1;\n                }\n                if (a.file > b.file) {\n                    return 1;\n                }\n                return 0;\n            });\n        }).then(function (results) {\n            lastGitStatusResults = results;\n            EventEmitter.emit(Events.GIT_STATUS_RESULTS, results);\n            return results;\n        });\n    }\n\n    // this function right now is not being used anywhere,\n    // but leaving it here (we might need it in the future)\n    function hasStatusChanged() {\n        const prevStatus = lastGitStatusResults;\n        return status().then(function (currentStatus) {\n            // the results are already sorted by file name\n            // Compare the current statuses with the previous ones\n            if (!prevStatus || prevStatus.length !== currentStatus.length) {\n                return true;\n            }\n            for (let i = 0; i < prevStatus.length; i++) {\n                if (prevStatus[i].file !== currentStatus[i].file ||\n                    prevStatus[i].status.join(\", \") !== currentStatus[i].status.join(\", \")) {\n                    return true;\n                }\n            }\n\n            return false;\n        }).catch(function (error) {\n            console.error(\"Error fetching Git status in hasStatusChanged:\", error);\n            return false;\n        });\n    }\n\n    function _isFileStaged(file) {\n        return git([\"status\", \"-u\", \"--porcelain\", \"--\", file]).then(function (stdout) {\n            if (!stdout) { return false; }\n            return _.any(stdout.split(\"\\n\"), function (line) {\n                return line[0] !== \" \" && line[0] !== \"?\" && // first character marks staged status\n                    line.lastIndexOf(\" \" + file) === line.length - file.length - 1; // in case another file appeared here?\n            });\n        });\n    }\n\n    function getDiffOfStagedFiles() {\n        return git([\"diff\", \"--no-ext-diff\", \"--no-color\", \"--staged\"], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function getDiffOfAllIndexFiles(files) {\n        var args = [\"diff\", \"--no-ext-diff\", \"--no-color\", \"--full-index\"];\n        if (files) {\n            args = args.concat(\"--\", files);\n        }\n        return git(args, {\n            timeout: false // never timeout this\n        });\n    }\n\n    function getListOfStagedFiles() {\n        return git([\"diff\", \"--no-ext-diff\", \"--no-color\", \"--staged\", \"--name-only\"], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function diffFile(file) {\n        return _isFileStaged(file).then(function (staged) {\n            var args = [\"diff\", \"--no-ext-diff\", \"--no-color\"];\n            if (staged) { args.push(\"--staged\"); }\n            args.push(\"-U0\", \"--\", file);\n            return git(args, {\n                timeout: false // never timeout this\n            });\n        });\n    }\n\n    function diffFileNice(file) {\n        return _isFileStaged(file).then(function (staged) {\n            var args = [\"diff\", \"--no-ext-diff\", \"--no-color\"];\n            if (staged) { args.push(\"--staged\"); }\n            args.push(\"--\", file);\n            return git(args, {\n                timeout: false // never timeout this\n            });\n        });\n    }\n\n    function difftool(file) {\n        return _isFileStaged(file).then(function (staged) {\n            var args = [\"difftool\"];\n            if (staged) {\n                args.push(\"--staged\");\n            }\n            args.push(\"--\", file);\n            return git(args, {\n                timeout: false, // never timeout this\n                nonblocking: true // allow running other commands before this command finishes its work\n            });\n        });\n    }\n\n    function clean() {\n        return git([\"clean\", \"-f\", \"-d\"]);\n    }\n\n    function getFilesFromCommit(hash, isInitial) {\n        var args = [\"diff\", \"--no-ext-diff\", \"--name-only\"];\n        args = args.concat((isInitial ? EMPTY_TREE : hash + \"^\") + \"..\" + hash);\n        args = args.concat(\"--\");\n        return git(args).then(function (stdout) {\n            return !stdout ? [] : stdout.split(\"\\n\");\n        });\n    }\n\n    function getDiffOfFileFromCommit(hash, file, isInitial) {\n        var args = [\"diff\", \"--no-ext-diff\", \"--no-color\"];\n        args = args.concat((isInitial ? EMPTY_TREE : hash + \"^\") + \"..\" + hash);\n        args = args.concat(\"--\", file);\n        return git(args);\n    }\n\n    function difftoolFromHash(hash, file, isInitial) {\n        return git([\"difftool\", (isInitial ? EMPTY_TREE : hash + \"^\") + \"..\" + hash, \"--\", file], {\n            timeout: false // never timeout this\n        });\n    }\n\n    function rebaseInit(branchName) {\n        return git([\"rebase\", \"--ignore-date\", branchName]);\n    }\n\n    function rebase(whatToDo) {\n        return git([\"rebase\", \"--\" + whatToDo]);\n    }\n\n    function getVersion() {\n        return git([\"--version\"]).then(function (stdout) {\n            var m = stdout.match(/[0-9].*/);\n            return m ? m[0] : stdout.trim();\n        });\n    }\n\n    function getCommitCountsFallback() {\n        return git([\"rev-list\", \"HEAD\", \"--not\", \"--remotes\"])\n            .then(function (stdout) {\n                var ahead = stdout ? stdout.split(\"\\n\").length : 0;\n                return \"-1 \" + ahead;\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n                return \"-1 -1\";\n            });\n    }\n\n    function getCommitCounts() {\n        var remotes = Preferences.get(\"defaultRemotes\") || {};\n        var remote = remotes[Preferences.get(\"currentGitRoot\")];\n        return getCurrentBranchName()\n            .then(function (branch) {\n                if (!branch || !remote) {\n                    return getCommitCountsFallback();\n                }\n                return git([\"rev-list\", \"--left-right\", \"--count\", remote + \"/\" + branch + \"...@{0}\", \"--\"])\n                    .catch(function (err) {\n                        ErrorHandler.logError(err);\n                        return getCommitCountsFallback();\n                    })\n                    .then(function (stdout) {\n                        var matches = /(-?\\d+)\\s+(-?\\d+)/.exec(stdout);\n                        return matches ? {\n                            behind: parseInt(matches[1], 10),\n                            ahead: parseInt(matches[2], 10)\n                        } : {\n                            behind: -1,\n                            ahead: -1\n                        };\n                    });\n            });\n    }\n\n    function getLastCommitMessage() {\n        return git([\"log\", \"-1\", \"--pretty=%B\"]).then(function (stdout) {\n            return stdout.trim();\n        });\n    }\n\n    function getBlame(file, from, to) {\n        var args = [\"blame\", \"-w\", \"--line-porcelain\"];\n        if (from || to) { args.push(\"-L\" + from + \",\" + to); }\n        args.push(file);\n\n        return git(args).then(function (stdout) {\n            if (!stdout) { return []; }\n\n            var sep  = \"-@-BREAK-HERE-@-\",\n                sep2 = \"$$#-#$BREAK$$-$#\";\n            stdout = stdout.replace(sep, sep2)\n                .replace(/^\\t(.*)$/gm, function (a, b) { return b + sep; });\n\n            return stdout.split(sep).reduce(function (arr, lineInfo) {\n                lineInfo = lineInfo.replace(sep2, sep).trimLeft();\n                if (!lineInfo) { return arr; }\n\n                var obj = {},\n                    lines = lineInfo.split(\"\\n\"),\n                    firstLine = _.first(lines).split(\" \");\n\n                obj.hash = firstLine[0];\n                obj.num = firstLine[2];\n                obj.content = _.last(lines);\n\n                // process all but first and last lines\n                for (var i = 1, l = lines.length - 1; i < l; i++) {\n                    var line = lines[i],\n                        io = line.indexOf(\" \"),\n                        key = line.substring(0, io),\n                        val = line.substring(io + 1);\n                    obj[key] = val;\n                }\n\n                arr.push(obj);\n                return arr;\n            }, []);\n        }).catch(function (stderr) {\n            var m = stderr.match(/no such path (\\S+)/);\n            if (m) {\n                throw new Error(\"File is not tracked by Git: \" + m[1]);\n            }\n            throw stderr;\n        });\n    }\n\n    function getGitRoot() {\n        var projectRoot = Utils.getProjectRoot();\n        return git([\"rev-parse\", \"--show-toplevel\"], {\n            cwd: fs.getTauriPlatformPath(projectRoot)\n        })\n            .catch(function (e) {\n                if (ErrorHandler.contains(e, \"Not a git repository\")) {\n                    return null;\n                }\n                throw e;\n            })\n            .then(function (root) {\n                if (root === null) {\n                    return root;\n                }\n\n                // paths on cygwin look a bit different\n                // root = fixCygwinPath(root);\n\n                // we know projectRoot is in a Git repo now\n                // because --show-toplevel didn't return Not a git repository\n                // we need to find closest .git\n\n                function checkPathRecursive(path) {\n\n                    if (strEndsWith(path, \"/\")) {\n                        path = path.slice(0, -1);\n                    }\n\n                    Utils.consoleDebug(\"Checking path for .git: \" + path);\n\n                    return new Promise(function (resolve) {\n\n                        // keep .git away from file tree for now\n                        // this branch of code will not run for intel xdk\n                        if (typeof brackets !== \"undefined\" && brackets.fs && brackets.fs.stat) {\n                            brackets.fs.stat(path + \"/.git\", function (err, result) {\n                                var exists = err ? false : (result.isFile() || result.isDirectory());\n                                if (exists) {\n                                    Utils.consoleDebug(\"Found .git in path: \" + path);\n                                    resolve(path);\n                                } else {\n                                    Utils.consoleDebug(\"Failed to find .git in path: \" + path);\n                                    path = path.split(\"/\");\n                                    path.pop();\n                                    path = path.join(\"/\");\n                                    resolve(checkPathRecursive(path));\n                                }\n                            });\n                            return;\n                        }\n\n                        FileSystem.resolve(path + \"/.git\", function (err, item, stat) {\n                            var exists = err ? false : (stat.isFile || stat.isDirectory);\n                            if (exists) {\n                                Utils.consoleDebug(\"Found .git in path: \" + path);\n                                resolve(path);\n                            } else {\n                                Utils.consoleDebug(\"Failed to find .git in path: \" + path);\n                                path = path.split(\"/\");\n                                path.pop();\n                                path = path.join(\"/\");\n                                resolve(checkPathRecursive(path));\n                            }\n                        });\n\n                    });\n\n                }\n\n                return checkPathRecursive(projectRoot).then(function (path) {\n                    return path + \"/\";\n                });\n\n            });\n    }\n\n    function setTagName(tagname, commitHash) {\n        const args = [\"tag\", tagname];\n        if (commitHash) {\n            args.push(commitHash); // Add the commit hash to the arguments if provided\n        }\n        return git(args).then(function (stdout) {\n            return stdout.trim();\n        });\n    }\n\n    // Public API\n    exports._git                      = git;\n    exports.setGitPath                = setGitPath;\n    exports.FILE_STATUS               = FILE_STATUS;\n    exports.fetchRemote               = fetchRemote;\n    exports.fetchAllRemotes           = fetchAllRemotes;\n    exports.getRemotes                = getRemotes;\n    exports.createRemote              = createRemote;\n    exports.deleteRemote              = deleteRemote;\n    exports.push                      = push;\n    exports.setUpstreamBranch         = setUpstreamBranch;\n    exports.getCurrentBranchName      = getCurrentBranchName;\n    exports.getCurrentUpstreamBranch  = getCurrentUpstreamBranch;\n    exports.getConfig                 = getConfig;\n    exports.setConfig                 = setConfig;\n    exports.getBranches               = getBranches;\n    exports.getAllBranches            = getAllBranches;\n    exports.branchDelete              = branchDelete;\n    exports.forceBranchDelete         = forceBranchDelete;\n    exports.getDeletedFiles           = getDeletedFiles;\n    exports.getHistory                = getHistory;\n    exports.init                      = init;\n    exports.clone                     = clone;\n    exports.stage                     = stage;\n    exports.unstage                   = unstage;\n    exports.stageAll                  = stageAll;\n    exports.commit                    = commit;\n    exports.reset                     = reset;\n    exports.checkout                  = checkout;\n    exports.createBranch              = createBranch;\n    exports.status                    = status;\n    exports.hasStatusChanged          = hasStatusChanged;\n    exports.diffFile                  = diffFile;\n    exports.diffFileNice              = diffFileNice;\n    exports.difftool                  = difftool;\n    exports.clean                     = clean;\n    exports.getFilesFromCommit        = getFilesFromCommit;\n    exports.getDiffOfFileFromCommit   = getDiffOfFileFromCommit;\n    exports.difftoolFromHash          = difftoolFromHash;\n    exports.rebase                    = rebase;\n    exports.rebaseInit                = rebaseInit;\n    exports.mergeRemote               = mergeRemote;\n    exports.rebaseRemote              = rebaseRemote;\n    exports.resetRemote               = resetRemote;\n    exports.getVersion                = getVersion;\n    exports.getCommitCounts           = getCommitCounts;\n    exports.getLastCommitMessage      = getLastCommitMessage;\n    exports.mergeBranch               = mergeBranch;\n    exports.getDiffOfAllIndexFiles    = getDiffOfAllIndexFiles;\n    exports.getDiffOfStagedFiles      = getDiffOfStagedFiles;\n    exports.getListOfStagedFiles      = getListOfStagedFiles;\n    exports.getBlame                  = getBlame;\n    exports.getGitRoot                = getGitRoot;\n    exports.setTagName                = setTagName;\n});\n\ndefine(\"src/utils/Setup\", function (require, exports) {\n\n    // Brackets modules\n    const _ = brackets.getModule(\"thirdparty/lodash\"),\n        Metrics = brackets.getModule(\"utils/Metrics\");\n\n    // Local modules\n    const Cli         = require(\"src/Cli\"),\n        Git         = require(\"src/git/Git\"),\n        Preferences = require(\"src/Preferences\");\n\n    // Module variables\n    let standardGitPathsWin = [\n        \"C:\\\\Program Files (x86)\\\\Git\\\\cmd\\\\git.exe\",\n        \"C:\\\\Program Files\\\\Git\\\\cmd\\\\git.exe\"\n    ];\n\n    let standardGitPathsNonWin = [\n        \"/usr/local/git/bin/git\",\n        \"/usr/local/bin/git\",\n        \"/usr/bin/git\"\n    ];\n\n    let extensionActivated = false;\n\n    // Implementation\n    function getGitVersion() {\n        return new Promise(function (resolve, reject) {\n\n            // TODO: do this in two steps - first check user config and then check all\n            var pathsToLook = [Preferences.get(\"gitPath\"), \"git\"].concat(brackets.platform === \"win\" ? standardGitPathsWin : standardGitPathsNonWin);\n            pathsToLook = _.unique(_.compact(pathsToLook));\n\n            var results = [],\n                errors = [];\n            var finish = _.after(pathsToLook.length, function () {\n\n                var searchedPaths = \"\\n\\nSearched paths:\\n\" + pathsToLook.join(\"\\n\");\n\n                if (results.length === 0) {\n                    // no git found\n                    reject(\"No Git has been found on this computer\" + searchedPaths);\n                } else {\n                    // at least one git is found\n                    var gits = _.sortBy(results, \"version\").reverse(),\n                        latestGit = gits[0],\n                        m = latestGit.version.match(/([0-9]+)\\.([0-9]+)/),\n                        major = parseInt(m[1], 10),\n                        minor = parseInt(m[2], 10);\n\n                    if (major === 1 && minor < 8) {\n                        return reject(\"Brackets Git requires Git 1.8 or later - latest version found was \" + latestGit.version + searchedPaths);\n                    }\n\n                    // prefer the first defined so it doesn't change all the time and confuse people\n                    latestGit = _.sortBy(_.filter(gits, function (git) { return git.version === latestGit.version; }), \"index\")[0];\n\n                    // this will save the settings also\n                    Git.setGitPath(latestGit.path);\n                    resolve(latestGit.version);\n                }\n\n            });\n\n            pathsToLook.forEach(function (path, index) {\n                Cli.spawnCommand(path, [\"--version\"], {\n                    cwd: \"./\"\n                }).then(function (stdout) {\n                    var m = stdout.match(/^git version\\s+(.*)$/);\n                    if (m) {\n                        results.push({\n                            path: path,\n                            version: m[1],\n                            index: index\n                        });\n                    }\n                }).catch(function (err) {\n                    errors.push({\n                        path: path,\n                        err: err\n                    });\n                }).finally(function () {\n                    finish();\n                });\n            });\n\n        });\n    }\n\n    function isExtensionActivated() {\n        return extensionActivated && Preferences.get(\"enableGit\");\n    }\n\n    /**\n     * Initializes the Git extension by checking for the Git executable and returns true if active.\n     *\n     * @async\n     * @function init\n     * @returns {Promise<boolean>}\n     *   A promise that resolves to a boolean indicating whether the extension was activated (`true`)\n     *   or deactivated (`false`) due to a missing or inaccessible Git executable.\n     * });\n     */\n    function init() {\n        return new Promise((resolve) =>{\n            if(!Preferences.get(\"enableGit\")){\n                resolve(false);\n                console.log(\"Git is disabled in preferences.\");\n                return;\n            }\n            getGitVersion().then(function (_version) {\n                extensionActivated = true;\n                resolve(extensionActivated);\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'installed', \"yes\");\n            }).catch(function (err) {\n                extensionActivated = false;\n                console.warn(\"Failed to launch Git executable. Deactivating Git extension. Is git installed?\", err);\n                resolve(extensionActivated);\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'installed', \"no\");\n            });\n        });\n    }\n\n    // Public API\n    exports.init = init;\n    exports.isExtensionActivated = isExtensionActivated;\n    exports.getGitVersion = getGitVersion;\n\n});\n"],"file":"extension-min.js"}