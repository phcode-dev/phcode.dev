{"version":3,"sources":["extensions/default/Git/src/Main.js"],"names":["define","require","exports","_","brackets","getModule","CommandManager","Commands","Menus","FileSystem","Mustache","Metrics","ProjectManager","Constants","Events","EventEmitter","Strings","StringUtils","ErrorHandler","Panel","Branch","SettingsDialog","Dialogs","CloseNotModified","Setup","Preferences","Utils","Git","gitTagDialogTemplate","CMD_ADD_TO_IGNORE","CMD_REMOVE_FROM_IGNORE","$icon","$","STATUSBAR_SHOW_GIT","addClass","prependTo","gitEnabled","initUi","init","on","toggle","_addRemoveItemInGitignore","selectedEntry","method","gitRoot","get","entryPath","fullPath","substring","length","gitignoreEntry","getFileForPath","read","err","content","consoleWarn","lines","split","map","l","trim","shift","pop","indexOf","push","without","write","join","showError","ERROR_MODIFY_GITIGNORE","refresh","addItemToGitingore","getSelectedItem","removeItemFromGitingore","addItemToGitingoreFromPanel","filePath","getPanel","find","attr","fileEntry","removeItemFromGitingoreFromPanel","_refreshCallback","emit","REFRESH_ALL","checkoutCommit","commitHash","commitDetail","getSelectedHistoryCommit","hash","commitDetailStr","subject","console","error","displayStr","format","CHECKOUT_COMMIT_DETAIL","askQuestion","TITLE_CHECKOUT","DIALOG_CHECKOUT","booleanResponse","noescape","customOkBtn","CHECKOUT_COMMIT","then","response","checkout","tagCommit","compiledTemplate","render","dialog","showModalDialogUsingTemplate","$dialog","getElement","focus","tagname","val","setTagName","REFRESH_HISTORY","catch","ERROR_CREATE_TAG","_resetOperation","operation","title","message","gitCmdUsed","RESET_DETAIL","RESET","customOkBtnClass","reset","resetHard","RESET_HARD_TITLE","RESET_HARD_MESSAGE","resetMixed","RESET_MIXED_TITLE","RESET_MIXED_MESSAGE","resetSoft","RESET_SOFT_TITLE","RESET_SOFT_MESSAGE","disableAllMenus","commandsToDisable","CMD_GIT_INIT","CMD_GIT_CLONE","CMD_GIT_TOGGLE_PANEL","CMD_GIT_REFRESH","CMD_GIT_GOTO_NEXT_CHANGE","CMD_GIT_GOTO_PREVIOUS_CHANGE","CMD_GIT_CLOSE_UNMODIFIED","CMD_GIT_AUTHORS_OF_SELECTION","CMD_GIT_AUTHORS_OF_FILE","CMD_GIT_COMMIT_CURRENT","CMD_GIT_COMMIT_ALL","CMD_GIT_FETCH","CMD_GIT_PULL","CMD_GIT_PUSH","CMD_GIT_GERRIT_PUSH_REF","CMD_GIT_CHANGE_USERNAME","CMD_GIT_CHANGE_EMAIL","CMD_GIT_SETTINGS_COMMAND_ID","CMD_GIT_CHECKOUT","CMD_GIT_TAG","CMD_GIT_RESET_HARD","CMD_GIT_RESET_MIXED","CMD_GIT_RESET_SOFT","CMD_GIT_DISCARD_ALL_CHANGES","CMD_GIT_UNDO_LAST_COMMIT","CMD_GIT_TOGGLE_UNTRACKED","CMD_GIT_HISTORY_GLOBAL","CMD_GIT_HISTORY_FILE","forEach","cmdId","enableCommand","initGitMenu","fileMenu","getMenu","AppMenuBar","FILE_MENU","gitSubMenu","addSubMenu","GIT_STRING_UNIVERSAL","GIT_SUB_MENU","AFTER","FILE_EXTENSION_MANAGER","addMenuDivider","addMenuItem","undefined","hideWhenCommandDisabled","register","ADD_TO_GITIGNORE","REMOVE_FROM_GITIGNORE","panelCmenu","registerContextMenu","GIT_PANEL_CHANGES_CMENU","historyCmenu","GIT_PANEL_HISTORY_CMENU","MENU_RESET_HARD","MENU_RESET_MIXED","MENU_RESET_SOFT","MENU_TAG_COMMIT","optionsCmenu","GIT_PANEL_OPTIONS_CMENU","ContextMenu","assignContextMenuToSelector","isExtensionActivated","GIT_SETTINGS","show","enabled","GIT_DISABLED","removeClass","GIT_STATUS_RESULTS","sortedResults","toggleClass","_toggleMenuEntriesState","_divider1","_divider2","toggleMenuEntries","bool","projectCmenu","getContextMenu","ContextMenuIds","PROJECT_MENU","workingCmenu","WORKING_SET_CONTEXT_MENU","removeMenuDivider","id","removeMenuItem","_enableAllCommands","is","isCommandExecuting","scheduledRefresh","REFRESH_DEDUPE_TIME","refreshOnFocusChange","isGitPanelVisible","setTimeout","execute","fail","always","clearTimeout","window","projectSwitched","BRACKETS_PROJECT_CHANGE","GIT_ENABLED","countEvent","EVENT_TYPE","GIT"],"mappings":"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","sourcesContent":["define(function (require, exports) {\n\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager    = brackets.getModule(\"command/CommandManager\"),\n        Commands          = brackets.getModule(\"command/Commands\"),\n        Menus             = brackets.getModule(\"command/Menus\"),\n        FileSystem        = brackets.getModule(\"filesystem/FileSystem\"),\n        Mustache          = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics           = brackets.getModule(\"utils/Metrics\"),\n        ProjectManager    = brackets.getModule(\"project/ProjectManager\");\n\n    const Constants       = require(\"src/Constants\"),\n        Events            = require(\"src/Events\"),\n        EventEmitter      = require(\"src/EventEmitter\"),\n        Strings             = brackets.getModule(\"strings\"),\n        StringUtils             = brackets.getModule(\"utils/StringUtils\"),\n        ErrorHandler      = require(\"src/ErrorHandler\"),\n        Panel             = require(\"src/Panel\"),\n        Branch            = require(\"src/Branch\"),\n        SettingsDialog    = require(\"src/SettingsDialog\"),\n        Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        CloseNotModified  = require(\"src/CloseNotModified\"),\n        Setup             = require(\"src/utils/Setup\"),\n        Preferences       = require(\"src/Preferences\"),\n        Utils             = require(\"src/Utils\"),\n        Git               = require(\"src/git/Git\"),\n        gitTagDialogTemplate    = require(\"text!templates/git-tag-dialog.html\");\n\n    const CMD_ADD_TO_IGNORE      = \"git.addToIgnore\",\n        CMD_REMOVE_FROM_IGNORE = \"git.removeFromIgnore\",\n        $icon                  = $(`<a id='git-toolbar-icon' title=\"${Strings.STATUSBAR_SHOW_GIT}\" href='#'></a>`)\n            .addClass(\"forced-hidden\")\n            .prependTo($(\".bottom-buttons\"));\n\n    let gitEnabled = false;\n\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        $icon.removeClass(\"dirty\");\n    });\n\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (sortedResults) {\n        $icon.toggleClass(\"dirty\", sortedResults.length !== 0);\n    });\n\n    // This only launches when Git is available\n    function initUi() {\n        // FUTURE: do we really need to launch init from here?\n        Panel.init();\n        Branch.init();\n        CloseNotModified.init();\n        // Attach events\n        $icon.on(\"click\", Panel.toggle);\n    }\n\n    function _addRemoveItemInGitignore(selectedEntry, method) {\n        var gitRoot = Preferences.get(\"currentGitRoot\"),\n            entryPath = \"/\" + selectedEntry.fullPath.substring(gitRoot.length),\n            gitignoreEntry = FileSystem.getFileForPath(gitRoot + \".gitignore\");\n\n        gitignoreEntry.read(function (err, content) {\n            if (err) {\n                Utils.consoleWarn(err);\n                content = \"\";\n            }\n\n            // use trimmed lines only\n            var lines = content.split(\"\\n\").map(function (l) { return l.trim(); });\n            // clean start and end empty lines\n            while (lines.length > 0 && !lines[0]) { lines.shift(); }\n            while (lines.length > 0 && !lines[lines.length - 1]) { lines.pop(); }\n\n            if (method === \"add\") {\n                // add only when not already present\n                if (lines.indexOf(entryPath) === -1) { lines.push(entryPath); }\n            } else if (method === \"remove\") {\n                lines = _.without(lines, entryPath);\n            }\n\n            // always have an empty line at the end of the file\n            if (lines[lines.length - 1]) { lines.push(\"\"); }\n\n            gitignoreEntry.write(lines.join(\"\\n\"), function (err) {\n                if (err) {\n                    return ErrorHandler.showError(err, Strings.ERROR_MODIFY_GITIGNORE);\n                }\n                Panel.refresh();\n            });\n        });\n    }\n\n    function addItemToGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"add\");\n    }\n\n    function removeItemFromGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"remove\");\n    }\n\n    function addItemToGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"add\");\n    }\n\n    function removeItemFromGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"remove\");\n    }\n\n    function _refreshCallback() {\n        EventEmitter.emit(Events.REFRESH_ALL);\n    }\n\n    function checkoutCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git checkout as commit hash is ${commitHash}`);\n            return;\n        }\n        const displayStr = StringUtils.format(Strings.CHECKOUT_COMMIT_DETAIL, commitDetailStr, commitHash);\n        Utils.askQuestion(Strings.TITLE_CHECKOUT,\n            displayStr + \"<br><br>\" + Strings.DIALOG_CHECKOUT,\n            { booleanResponse: true, noescape: true, customOkBtn: Strings.CHECKOUT_COMMIT })\n            .then(function (response) {\n                if (response === true) {\n                    return Git.checkout(commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function tagCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash || \"\";\n        const compiledTemplate = Mustache.render(gitTagDialogTemplate, { Strings }),\n            dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog          = dialog.getElement();\n        $dialog.find(\"input\").focus();\n        $dialog.find(\"button.primary\").on(\"click\", function () {\n            const tagname = $dialog.find(\"input.commit-message\").val();\n            Git.setTagName(tagname, commitHash).then(function () {\n                EventEmitter.emit(Events.REFRESH_HISTORY);\n            }).catch(function (err) {\n                ErrorHandler.showError(err, Strings.ERROR_CREATE_TAG);\n            });\n        });\n    }\n\n    function _resetOperation(operation, commitHash, title, message) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git Reset ${operation} as commit hash is ${commitHash}`);\n            return;\n        }\n        const gitCmdUsed = `git reset ${operation} ${commitHash}`;\n        const displayStr = StringUtils.format(Strings.RESET_DETAIL, commitDetailStr, gitCmdUsed);\n        Utils.askQuestion(title,\n            message + \"<br><br>\" + displayStr,\n            { booleanResponse: true, noescape: true,\n                customOkBtn: Strings.RESET, customOkBtnClass: \"danger\"})\n            .then(function (response) {\n                if (response === true) {\n                    return Git.reset(operation, commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function resetHard(commitHash) {\n        return _resetOperation(\"--hard\", commitHash,\n            Strings.RESET_HARD_TITLE, Strings.RESET_HARD_MESSAGE);\n    }\n\n    function resetMixed(commitHash) {\n        return _resetOperation(\"--mixed\", commitHash,\n            Strings.RESET_MIXED_TITLE, Strings.RESET_MIXED_MESSAGE);\n    }\n\n    function resetSoft(commitHash) {\n        return _resetOperation(\"--soft\", commitHash,\n            Strings.RESET_SOFT_TITLE, Strings.RESET_SOFT_MESSAGE);\n    }\n\n    /**\n     * Disables all Git-related commands that were registered in `initGitMenu`.\n     * After calling this function, none of these menu items will be clickable.\n     */\n    function disableAllMenus() {\n        // Collect all command IDs that were registered in initGitMenu\n        const commandsToDisable = [\n            // File menu items\n            Constants.CMD_GIT_INIT,\n            Constants.CMD_GIT_CLONE,\n            Constants.CMD_GIT_TOGGLE_PANEL,\n            Constants.CMD_GIT_REFRESH,\n            Constants.CMD_GIT_GOTO_NEXT_CHANGE,\n            Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE,\n            Constants.CMD_GIT_CLOSE_UNMODIFIED,\n            Constants.CMD_GIT_AUTHORS_OF_SELECTION,\n            Constants.CMD_GIT_AUTHORS_OF_FILE,\n            Constants.CMD_GIT_COMMIT_CURRENT,\n            Constants.CMD_GIT_COMMIT_ALL,\n            Constants.CMD_GIT_FETCH,\n            Constants.CMD_GIT_PULL,\n            Constants.CMD_GIT_PUSH,\n            Constants.CMD_GIT_GERRIT_PUSH_REF,\n            Constants.CMD_GIT_CHANGE_USERNAME,\n            Constants.CMD_GIT_CHANGE_EMAIL,\n            Constants.CMD_GIT_SETTINGS_COMMAND_ID,\n\n            // Project tree/working files commands\n            CMD_ADD_TO_IGNORE,\n            CMD_REMOVE_FROM_IGNORE,\n            // Panel context menu commands (with \"2\" suffix)\n            CMD_ADD_TO_IGNORE + \"2\",\n            CMD_REMOVE_FROM_IGNORE + \"2\",\n\n            // History context menu commands\n            Constants.CMD_GIT_CHECKOUT,\n            Constants.CMD_GIT_TAG,\n            Constants.CMD_GIT_RESET_HARD,\n            Constants.CMD_GIT_RESET_MIXED,\n            Constants.CMD_GIT_RESET_SOFT,\n\n            // \"More options\" context menu commands\n            Constants.CMD_GIT_DISCARD_ALL_CHANGES,\n            Constants.CMD_GIT_UNDO_LAST_COMMIT,\n            Constants.CMD_GIT_TOGGLE_UNTRACKED,\n\n            Constants.CMD_GIT_HISTORY_GLOBAL,\n            Constants.CMD_GIT_HISTORY_FILE\n        ];\n\n        // Disable each command\n        commandsToDisable.forEach((cmdId) => {\n            Utils.enableCommand(cmdId, false);\n        });\n    }\n\n\n    function initGitMenu() {\n        // Register command and add it to the menu.\n        const fileMenu = Menus.getMenu(Menus.AppMenuBar.FILE_MENU);\n        let gitSubMenu = fileMenu.addSubMenu(Constants.GIT_STRING_UNIVERSAL,\n            Constants.GIT_SUB_MENU, Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        fileMenu.addMenuDivider(Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_INIT, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLONE, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_TOGGLE_PANEL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_REFRESH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_NEXT_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLOSE_UNMODIFIED);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_HISTORY_GLOBAL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_HISTORY_FILE);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_CURRENT);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_ALL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PULL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        // register commands for project tree / working files\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE, addItemToGitingore);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE, removeItemFromGitingore);\n\n        // create context menu for git panel\n        const panelCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_CHANGES_CMENU);\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE + \"2\", addItemToGitingoreFromPanel);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE + \"2\", removeItemFromGitingoreFromPanel);\n        panelCmenu.addMenuItem(CMD_ADD_TO_IGNORE + \"2\");\n        panelCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE + \"2\");\n\n        // create context menu for git history\n        const historyCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_HISTORY_CMENU);\n        CommandManager.register(Strings.CHECKOUT_COMMIT, Constants.CMD_GIT_CHECKOUT, checkoutCommit);\n        CommandManager.register(Strings.MENU_RESET_HARD, Constants.CMD_GIT_RESET_HARD, resetHard);\n        CommandManager.register(Strings.MENU_RESET_MIXED, Constants.CMD_GIT_RESET_MIXED, resetMixed);\n        CommandManager.register(Strings.MENU_RESET_SOFT, Constants.CMD_GIT_RESET_SOFT, resetSoft);\n        CommandManager.register(Strings.MENU_TAG_COMMIT, Constants.CMD_GIT_TAG, tagCommit);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_CHECKOUT);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_TAG);\n        historyCmenu.addMenuDivider();\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_HARD);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_MIXED);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_SOFT);\n\n        // create context menu for git more options\n        const optionsCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_OPTIONS_CMENU);\n        Menus.ContextMenu.assignContextMenuToSelector(\".git-more-options-btn\", optionsCmenu);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_DISCARD_ALL_CHANGES);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_UNDO_LAST_COMMIT);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_HISTORY_GLOBAL);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_HISTORY_FILE);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PULL);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_TOGGLE_UNTRACKED);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        if(!Setup.isExtensionActivated()){\n            disableAllMenus();\n        }\n    }\n\n    function init() {\n        CommandManager.register(Strings.GIT_SETTINGS, Constants.CMD_GIT_SETTINGS_COMMAND_ID, SettingsDialog.show);\n        // Try to get Git version, if succeeds then Git works\n        return Setup.init().then(function (enabled) {\n            initUi();\n            initGitMenu();\n            return enabled;\n        });\n    }\n\n    var _toggleMenuEntriesState = false,\n        _divider1 = null,\n        _divider2 = null;\n    function toggleMenuEntries(bool) {\n        if (bool === _toggleMenuEntriesState) {\n            return;\n        }\n        var projectCmenu = Menus.getContextMenu(Menus.ContextMenuIds.PROJECT_MENU);\n        var workingCmenu = Menus.getContextMenu(Menus.ContextMenuIds.WORKING_SET_CONTEXT_MENU);\n        if (bool) {\n            _divider1 = projectCmenu.addMenuDivider();\n            _divider2 = workingCmenu.addMenuDivider();\n            projectCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n        } else {\n            projectCmenu.removeMenuDivider(_divider1.id);\n            workingCmenu.removeMenuDivider(_divider2.id);\n            projectCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n        }\n        _toggleMenuEntriesState = bool;\n    }\n\n    function _enableAllCommands(enabled) {\n        Utils.enableCommand(Constants.CMD_GIT_REFRESH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_NEXT_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_SELECTION, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_FILE, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_HISTORY_GLOBAL, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_HISTORY_FILE, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_CURRENT, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_ALL, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_FETCH, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PULL, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PUSH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_DISCARD_ALL_CHANGES, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_UNDO_LAST_COMMIT, enabled);\n        toggleMenuEntries(enabled);\n        if(enabled){\n            $icon.removeClass(\"forced-hidden\");\n        } else if(!$(\"#git-panel\").is(\":visible\")){\n            $icon.addClass(\"forced-hidden\");\n        }\n    }\n\n    let isCommandExecuting = false;\n    let scheduledRefresh = null;\n    const REFRESH_DEDUPE_TIME = 3000;\n\n    function refreshOnFocusChange() {\n        // to sync external git changes after switching to app.\n        if (gitEnabled) {\n            const isGitPanelVisible = Panel.getPanel().is(\":visible\");\n\n            if (isCommandExecuting) {\n                // if we haven't already scheduled a refresh, queue one\n                if (!scheduledRefresh) {\n                    scheduledRefresh = setTimeout(() => {\n                        scheduledRefresh = null;\n                        refreshOnFocusChange();\n                    }, REFRESH_DEDUPE_TIME);\n                }\n                return;\n            }\n            isCommandExecuting = true;\n\n            // if the git panel is visible, its very likely user is working with git (maybe external)\n            // so when Phoenix gains focus, we do a complete git refresh to show latest status\n            if(isGitPanelVisible) {\n                CommandManager.execute(Constants.CMD_GIT_REFRESH).fail((err) => {\n                    console.error(\"error refreshing on focus switch\", err);\n                }).always(() => {\n                    isCommandExecuting = false;\n                    // if a refresh got queued while we were executing, run it immediately now\n                    if (scheduledRefresh) {\n                        clearTimeout(scheduledRefresh);\n                        scheduledRefresh = null;\n                        refreshOnFocusChange();\n                    }\n                });\n            } else {\n                // if panel not visible, we just refresh the git branch (shown in sidebar)\n                Branch.refresh();\n                isCommandExecuting = false;\n\n                // run if something got queued\n                if (scheduledRefresh) {\n                    clearTimeout(scheduledRefresh);\n                    scheduledRefresh = null;\n                    refreshOnFocusChange();\n                }\n            }\n        }\n    }\n    $(window).focus(refreshOnFocusChange);\n\n    // Event handlers\n    let projectSwitched = true;\n    EventEmitter.on(Events.BRACKETS_PROJECT_CHANGE, function () {\n        // pressing refresh button will raise GIT_ENABLED event and we only want one enabled metric\n        // per project open.\n        projectSwitched = true;\n    });\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        _enableAllCommands(true);\n        gitEnabled = true;\n        projectSwitched && Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'enabled', \"project\");\n        projectSwitched = false;\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        _enableAllCommands(false);\n        gitEnabled = false;\n    });\n\n    // API\n    exports.$icon = $icon;\n    exports.init = init;\n\n});\n"],"file":"Main.js"}