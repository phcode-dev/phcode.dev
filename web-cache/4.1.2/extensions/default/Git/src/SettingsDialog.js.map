{"version":3,"sources":["extensions/default/Git/src/SettingsDialog.js"],"names":["define","require","exports","Dialogs","brackets","getModule","Mustache","Preferences","Strings","Git","Setup","settingsDialogTemplate","dialog","$dialog","setValues","values","$","each","$this","this","type","attr","tag","prop","toLowerCase","property","val","collectDialogValues","prefType","getType","set","newValue","parseInt","trim","isNaN","getDefaults","save","assignActions","$useDifftoolCheckbox","getConfig","then","diffToolConfiguration","disabled","checked","catch","on","is","e","stopPropagation","init","getAll","show","enableGitPreference","get","compiledTemplate","render","gitDisabled","gitNotFound","isExtensionActivated","showModalDialogUsingTemplate","getElement","find","anyChecked","length","removeClass","addClass","done","buttonId"],"mappings":"AAAAA,OAAO,SAAUC,QAASC,SAGtB,MAAMC,QAA0BC,SAASC,UAAU,mBAC/CC,SAA0BF,SAASC,UAAU,gCAC7CE,YAA0BN,QAAQ,iBAClCO,QAAsBJ,SAASC,UAAU,WACzCI,IAA0BR,QAAQ,aAClCS,MAA0BT,QAAQ,mBAClCU,uBAA0BV,QAAQ,2CAEtC,IAAIW,OACAC,QAEJ,SAASC,UAAUC,QACfC,EAAE,sBAAuBH,SAASI,KAAK,WACnC,IAAIC,MAAQF,EAAEG,MACVC,KAAOF,MAAMG,KAAK,QAClBC,IAAMJ,MAAMK,KAAK,WAAWC,cAC5BC,SAAWP,MAAMG,KAAK,oBACb,aAATD,KACAF,MAAMK,KAAK,UAAWR,OAAOU,WACd,WAARH,IACPN,EAAE,gBAAkBD,OAAOU,UAAY,IAAKP,OAAOK,KAAK,YAAY,GAEpEL,MAAMQ,IAAIX,OAAOU,aAK7B,SAASE,sBACLX,EAAE,sBAAuBH,SAASI,KAAK,WACnC,IAAIC,MAAQF,EAAEG,MACVC,KAAOF,MAAMG,KAAK,QAClBI,SAAWP,MAAMG,KAAK,oBACtBO,SAAWrB,YAAYsB,QAAQJ,UACnC,GAAa,aAATL,KACAb,YAAYuB,IAAIL,SAAUP,MAAMK,KAAK,iBAClC,GAAiB,WAAbK,SAAuB,CAC9B,IAAIG,SAAWC,SAASd,MAAMQ,MAAMO,OAAQ,IACxCC,MAAMH,YAAaA,SAAWxB,YAAY4B,cAAcV,WAC5DlB,YAAYuB,IAAIL,SAAUM,eAE1BxB,YAAYuB,IAAIL,SAAUP,MAAMQ,MAAMO,QAAU,QAGxD1B,YAAY6B,OAGhB,SAASC,gBACL,IAAIC,qBAAuBtB,EAAE,4BAA6BH,SAE1DJ,IAAI8B,UAAU,aAAaC,KAAK,SAAUC,uBAEjCA,sBAMDH,qBAAqBf,KAAK,CACtBmB,UAAU,IANdJ,qBAAqBf,KAAK,CACtBoB,SAAS,EACTD,UAAU,MAQnBE,MAAM,WAKLN,qBAAqBf,KAAK,CACtBoB,SAAS,EACTD,UAAU,MAKlB1B,EAAE,2CAA4CH,SAASgC,GAAG,SAAU,WAChE,IAAIA,GAAK7B,EAAEG,MAAM2B,GAAG,YACpB9B,EAAE,8GAA+GH,SAC5GU,KAAK,UAAWsB,IAChBtB,KAAK,YAAasB,MAG3B7B,EAAE,oCAAqCH,SAASgC,GAAG,QAAS,SAAUE,GAClEA,EAAEC,kBACFlC,UAAUP,YAAY4B,iBAI9B,SAASc,OACLnC,UAAUP,YAAY2C,UACtBb,gBAGJnC,QAAQiD,KAAO,WACX,MAAMC,oBAAsB7C,YAAY8C,IAAI,aACtCC,iBAAmBhD,SAASiD,OAAO5C,uBAAwB,CAC7DH,QAAAA,QACAgD,aAAcJ,oBACdK,cAAaL,sBAAuB1C,MAAMgD,yBAG9C9C,OAAST,QAAQwD,6BAA6BL,kBAC9CzC,QAAUD,OAAOgD,aAEjBX,OACApC,QAAQgD,KAAK,2BAA2BhB,GAAG,SAAU,WACjD,MAAMiB,WAAajD,QAAQgD,KAAK,mCAAmCE,OAAS,EACxED,WACAjD,QAAQgD,KAAK,yBAAyBG,YAAY,oBAElDnD,QAAQgD,KAAK,yBAAyBI,SAAS,sBAIvDrD,OAAOsD,KAAK,SAAUC,UACD,OAAbA,UAEAxC","sourcesContent":["define(function (require, exports) {\n\n    // Brackets modules\n    const Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache                = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Preferences             = require(\"./Preferences\"),\n        Strings             = brackets.getModule(\"strings\"),\n        Git                     = require(\"./git/Git\"),\n        Setup                   = require(\"src/utils/Setup\"),\n        settingsDialogTemplate  = require(\"text!templates/git-settings-dialog.html\");\n\n    var dialog,\n        $dialog;\n\n    function setValues(values) {\n        $(\"*[settingsProperty]\", $dialog).each(function () {\n            var $this = $(this),\n                type = $this.attr(\"type\"),\n                tag = $this.prop(\"tagName\").toLowerCase(),\n                property = $this.attr(\"settingsProperty\");\n            if (type === \"checkbox\") {\n                $this.prop(\"checked\", values[property]);\n            } else if (tag === \"select\") {\n                $(\"option[value=\" + values[property] + \"]\", $this).prop(\"selected\", true);\n            } else {\n                $this.val(values[property]);\n            }\n        });\n    }\n\n    function collectDialogValues() {\n        $(\"*[settingsProperty]\", $dialog).each(function () {\n            var $this = $(this),\n                type = $this.attr(\"type\"),\n                property = $this.attr(\"settingsProperty\"),\n                prefType = Preferences.getType(property);\n            if (type === \"checkbox\") {\n                Preferences.set(property, $this.prop(\"checked\"));\n            } else if (prefType === \"number\") {\n                var newValue = parseInt($this.val().trim(), 10);\n                if (isNaN(newValue)) { newValue = Preferences.getDefaults()[property]; }\n                Preferences.set(property, newValue);\n            } else {\n                Preferences.set(property, $this.val().trim() || null);\n            }\n        });\n        Preferences.save();\n    }\n\n    function assignActions() {\n        var $useDifftoolCheckbox = $(\"#git-settings-useDifftool\", $dialog);\n\n        Git.getConfig(\"diff.tool\").then(function (diffToolConfiguration) {\n\n            if (!diffToolConfiguration) {\n                $useDifftoolCheckbox.prop({\n                    checked: false,\n                    disabled: true\n                });\n            } else {\n                $useDifftoolCheckbox.prop({\n                    disabled: false\n                });\n            }\n\n        }).catch(function () {\n\n            // an error with git\n            // we were not able to check whether diff tool is configured or not\n            // so we disable it just to be sure\n            $useDifftoolCheckbox.prop({\n                checked: false,\n                disabled: true\n            });\n\n        });\n\n        $(\"#git-settings-stripWhitespaceFromCommits\", $dialog).on(\"change\", function () {\n            var on = $(this).is(\":checked\");\n            $(\"#git-settings-addEndlineToTheEndOfFile,#git-settings-removeByteOrderMark,#git-settings-normalizeLineEndings\", $dialog)\n                .prop(\"checked\", on)\n                .prop(\"disabled\", !on);\n        });\n\n        $(\"button[data-button-id='defaults']\", $dialog).on(\"click\", function (e) {\n            e.stopPropagation();\n            setValues(Preferences.getDefaults());\n        });\n    }\n\n    function init() {\n        setValues(Preferences.getAll());\n        assignActions();\n    }\n\n    exports.show = function () {\n        const enableGitPreference = Preferences.get(\"enableGit\");\n        const compiledTemplate = Mustache.render(settingsDialogTemplate, {\n            Strings,\n            gitDisabled: !enableGitPreference,\n            gitNotFound: enableGitPreference ? !Setup.isExtensionActivated() : false\n        });\n\n        dialog = Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n        $dialog = dialog.getElement();\n\n        init();\n        $dialog.find(\"#git-settings-enableGit\").on(\"change\", function () {\n            const anyChecked = $dialog.find(\"#git-settings-enableGit:checked\").length > 0;\n            if (anyChecked) {\n                $dialog.find(\".git-settings-content\").removeClass(\"forced-inVisible\");\n            } else {\n                $dialog.find(\".git-settings-content\").addClass(\"forced-inVisible\");\n            }\n        });\n\n        dialog.done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                // Save everything to preferences\n                collectDialogValues();\n            }\n        });\n    };\n});\n"],"file":"SettingsDialog.js"}