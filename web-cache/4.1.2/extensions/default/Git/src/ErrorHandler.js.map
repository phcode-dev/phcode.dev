{"version":3,"sources":["extensions/default/Git/src/ErrorHandler.js"],"names":["define","require","exports","Dialogs","brackets","getModule","Mustache","Metrics","Strings","NotificationUI","Utils","errorDialogTemplate","errorToString","err","encodeSensitiveInformation","toString","isTimeout","Error","message","indexOf","equals","what","toLowerCase","contains","matches","regExp","match","logError","msg","stack","consoleError","showError","title","options","dontStripError","errorMetric","__shown","errorBody","errorStack","JSON","stringify","e","window","debugMode","useNotification","countEvent","EVENT_TYPE","GIT","createToastFromTemplate","toastStyle","NOTIFICATION_STYLES_CSS_CLASS","ERROR","dismissOnClick","instantOpen","compiledTemplate","render","body","showModalDialogUsingTemplate","toError","arg","apply","arguments"],"mappings":"AAAAA,OAAO,SAAUC,QAASC,SAEtB,MAAMC,QAA6BC,SAASC,UAAU,mBAClDC,SAA6BF,SAASC,UAAU,gCAChDE,QAA6BH,SAASC,UAAU,iBAChDG,QAA6BJ,SAASC,UAAU,WAChDI,eAA6BL,SAASC,UAAU,0BAChDK,MAA6BT,QAAQ,aACrCU,oBAA6BV,QAAQ,wCAEzC,SAASW,cAAcC,KACnB,OAAOH,MAAMI,2BAA2BD,IAAIE,YAGhDb,QAAQc,UAAY,SAAUH,KAC1B,OAAOA,eAAeI,QAC6B,IAA/CJ,IAAIK,QAAQC,QAAQ,wBACyB,IAA7CN,IAAIK,QAAQC,QAAQ,uBAI5BjB,QAAQkB,OAAS,SAAUP,IAAKQ,MAC5B,OAAOR,IAAIE,WAAWO,gBAAkBD,KAAKC,eAGjDpB,QAAQqB,SAAW,SAAUV,IAAKQ,MAC9B,OAAqE,IAA9DR,IAAIE,WAAWO,cAAcH,QAAQE,KAAKC,gBAGrDpB,QAAQsB,QAAU,SAAUX,IAAKY,QAC7B,OAAOZ,IAAIE,WAAWW,MAAMD,SAGhCvB,QAAQyB,SAAW,SAAUd,KACzB,MAAMe,IAAMf,KAAOA,IAAIgB,MAAQhB,IAAIgB,MAAQhB,IAE3C,OADAH,MAAMoB,aAAa,kBAAoBF,KAChCf,KASXX,QAAQ6B,UAAY,SAAUlB,IAAKmB,MAAOC,QAAU,IAChD,MAAMC,eAAiBD,QAAQC,eACzBC,YAAcF,QAAQE,YAC5B,GAAItB,IAAIuB,QAAW,OAAOvB,IAI1B,IAAIwB,UACAC,WASJ,GAZApC,QAAQyB,SAASd,KAKE,iBAARA,IACPwB,UAAYxB,IACLA,eAAeI,QACtBoB,UAAYH,eAAiBrB,IAAIE,WAAaH,cAAcC,KAC5DyB,WAAazB,IAAIgB,OAAS,KAGzBQ,WAA2B,oBAAdA,UACd,IACIA,UAAYE,KAAKC,UAAU3B,IAAK,KAAM,GACxC,MAAO4B,GACLJ,UAAY,+CAKpB,GAFAA,UAAYK,OAAOC,aAAeN,cAAcC,aAAeD,UAE5DJ,QAAQW,gBACPrC,QAAQsC,WAAWtC,QAAQuC,WAAWC,IAAK,YAAaZ,aAAe,QACvE1B,eAAeuC,wBAAwBhB,6FACoDK,uBAAwB,CAC3GY,WAAYxC,eAAeyC,8BAA8BC,MACzDC,gBAAgB,EAChBC,aAAa,QAElB,CACH9C,QAAQsC,WAAWtC,QAAQuC,WAAWC,IAAK,YAAaZ,aAAe,QACvE,MAAMmB,iBAAmBhD,SAASiD,OAAO5C,oBAAqB,CAC1DqB,MAAOA,MACPwB,KAAMnB,UACN7B,QAASA,UAGbL,QAAQsD,6BAA6BH,kBAKzC,MAFmB,iBAARzC,MAAoBA,IAAM,IAAII,MAAMJ,MAC/CA,IAAIuB,SAAU,EACPvB,KAGXX,QAAQwD,QAAU,SAAUC,KAExB,GAAIA,eAAe1C,MAAS,OAAO0C,IACnC,IAAI9C,IAAM,IAAII,MAAM0C,KAKpB,OAHA9C,IAAIa,MAAQ,WACR,OAAOiC,IAAIjC,MAAMkC,MAAMD,IAAKE,YAEzBhD","sourcesContent":["define(function (require, exports) {\n\n    const Dialogs                    = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache                   = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics                    = brackets.getModule(\"utils/Metrics\"),\n        Strings                    = brackets.getModule(\"strings\"),\n        NotificationUI             = brackets.getModule(\"widgets/NotificationUI\"),\n        Utils                      = require(\"src/Utils\"),\n        errorDialogTemplate        = require(\"text!templates/git-error-dialog.html\");\n\n    function errorToString(err) {\n        return Utils.encodeSensitiveInformation(err.toString());\n    }\n\n    exports.isTimeout = function (err) {\n        return err instanceof Error && (\n            err.message.indexOf(\"cmd-execute-timeout\") === 0 ||\n            err.message.indexOf(\"cmd-spawn-timeout\") === 0\n        );\n    };\n\n    exports.equals = function (err, what) {\n        return err.toString().toLowerCase() === what.toLowerCase();\n    };\n\n    exports.contains = function (err, what) {\n        return err.toString().toLowerCase().indexOf(what.toLowerCase()) !== -1;\n    };\n\n    exports.matches = function (err, regExp) {\n        return err.toString().match(regExp);\n    };\n\n    exports.logError = function (err) {\n        const msg = err && err.stack ? err.stack : err;\n        Utils.consoleError(\"[brackets-git] \" + msg);\n        return err;\n    };\n\n    /**\n     *\n     * @param err\n     * @param title\n     * @param {dontStripError: boolean, errorMetric: string, useNotification: boolean} options\n     */\n    exports.showError = function (err, title, options = {}) {\n        const dontStripError = options.dontStripError;\n        const errorMetric = options.errorMetric;\n        if (err.__shown) { return err; }\n\n        exports.logError(err);\n\n        let errorBody,\n            errorStack;\n\n        if (typeof err === \"string\") {\n            errorBody = err;\n        } else if (err instanceof Error) {\n            errorBody = dontStripError ? err.toString() : errorToString(err);\n            errorStack = err.stack || \"\";\n        }\n\n        if (!errorBody || errorBody === \"[object Object]\") {\n            try {\n                errorBody = JSON.stringify(err, null, 4);\n            } catch (e) {\n                errorBody = \"Error can't be stringified by JSON.stringify\";\n            }\n        }\n        errorBody = window.debugMode ? `${errorBody}\\n${errorStack}` : errorBody;\n\n        if(options.useNotification){\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'notifyErr', errorMetric || \"Show\");\n            NotificationUI.createToastFromTemplate(title,\n                `<textarea readonly style=\"width: 200px; height: 200px; cursor: text; resize: none;\">${errorBody}</textarea>`, {\n                    toastStyle: NotificationUI.NOTIFICATION_STYLES_CSS_CLASS.ERROR,\n                    dismissOnClick: false,\n                    instantOpen: true\n                });\n        } else {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'dialogErr', errorMetric || \"Show\");\n            const compiledTemplate = Mustache.render(errorDialogTemplate, {\n                title: title,\n                body: errorBody,\n                Strings: Strings\n            });\n\n            Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n        }\n\n        if (typeof err === \"string\") { err = new Error(err); }\n        err.__shown = true;\n        return err;\n    };\n\n    exports.toError = function (arg) {\n        // FUTURE: use this everywhere and have a custom error class for this extension\n        if (arg instanceof Error) { return arg; }\n        var err = new Error(arg);\n        // TODO: new class for this?\n        err.match = function () {\n            return arg.match.apply(arg, arguments);\n        };\n        return err;\n    };\n\n});\n"],"file":"ErrorHandler.js"}