define(function(require,exports){const Preferences=require("src/Preferences"),GitCli=require("src/git/GitCli"),Utils=require("src/Utils");function pushToNewUpstream(remoteName,remoteBranch,options={}){const args=["--set-upstream"];return options.noVerify&&args.push("--no-verify"),GitCli.push(remoteName,remoteBranch,args,options.progressTracker)}function getRemoteUrl(remote){return GitCli.getConfig("remote."+remote+".url")}function setRemoteUrl(remote,url){return GitCli.setConfig("remote."+remote+".url",url)}function sortBranches(branches){return branches.sort(function(a,b){var ar=a.remote||"",br=b.remote||"";return br&&"origin"===ar&&"origin"!==br?-1:ar&&"origin"!==ar&&"origin"===br?1:ar<br?-1:ar>br?1:a.sortPrefix<b.sortPrefix?-1:a.sortPrefix>b.sortPrefix?1:"master"===a.sortName&&"master"!==b.sortName?-1:"master"!==a.sortName&&"master"===b.sortName?1:a.sortName<b.sortName?-1:a.sortName>b.sortName?1:0})}function getBranches(){return GitCli.getBranches().then(function(branches){return sortBranches(branches)})}function getAllBranches(){return GitCli.getAllBranches().then(function(branches){return sortBranches(branches)})}function getHistory(branch,skip){return GitCli.getHistory(branch,skip)}function getFileHistory(file,branch,skip){return GitCli.getHistory(branch,skip,file)}function resetIndex(){return GitCli.reset()}function discardAllChanges(){return GitCli.reset("--hard").then(function(){return GitCli.clean()})}function getMergeInfo(){var baseCheck=["MERGE_MODE","rebase-apply"],mergeCheck=["MERGE_HEAD","MERGE_MSG"],rebaseCheck=["rebase-apply/next","rebase-apply/last","rebase-apply/head-name"],gitFolder=Preferences.get("currentGitRoot")+".git/";return Promise.all(baseCheck.map(function(fileName){return Utils.loadPathContent(gitFolder+fileName)})).then(function([mergeMode,rebaseMode]){var obj={mergeMode:null!==mergeMode,rebaseMode:null!==rebaseMode};return obj.mergeMode?Promise.all(mergeCheck.map(function(fileName){return Utils.loadPathContent(gitFolder+fileName)})).then(function([head,msg]){head&&(obj.mergeHead=head.trim());var msgSplit=msg?msg.trim().split(/conflicts:/i):[];return msgSplit[0]&&(obj.mergeMessage=msgSplit[0].trim()),msgSplit[1]&&(obj.mergeConflicts=msgSplit[1].trim().split("\n").map(function(line){return line.trim()})),obj}):obj.rebaseMode?Promise.all(rebaseCheck.map(function(fileName){return Utils.loadPathContent(gitFolder+fileName)})).then(function([next,last,head]){return next&&(obj.rebaseNext=next.trim()),last&&(obj.rebaseLast=last.trim()),head&&(obj.rebaseHead=head.trim().substring("refs/heads/".length)),obj}):obj})}function discardFileChanges(file){return GitCli.unstage(file).then(function(){return GitCli.checkout(file)})}function pushForced(remote,branch,options={}){const args=["--force"];return options.noVerify&&args.push("--no-verify"),GitCli.push(remote,branch,args,options.progressTracker)}function deleteRemoteBranch(remote,branch,options={}){const args=["--delete"];return options.noVerify&&args.push("--no-verify"),GitCli.push(remote,branch,args,options.progressTracker)}function undoLastLocalCommit(){return GitCli.reset("--soft","HEAD~1")}exports.pushToNewUpstream=pushToNewUpstream,exports.getBranches=getBranches,exports.getAllBranches=getAllBranches,exports.getHistory=getHistory,exports.getFileHistory=getFileHistory,exports.resetIndex=resetIndex,exports.discardAllChanges=discardAllChanges,exports.getMergeInfo=getMergeInfo,exports.discardFileChanges=discardFileChanges,exports.getRemoteUrl=getRemoteUrl,exports.setRemoteUrl=setRemoteUrl,exports.pushForced=pushForced,exports.deleteRemoteBranch=deleteRemoteBranch,exports.undoLastLocalCommit=undoLastLocalCommit,Object.keys(GitCli).forEach(function(method){exports[method]||(exports[method]=GitCli[method])})});
//# sourceMappingURL=Git.js.map
