{"version":3,"sources":["extensions/default/Git/src/Panel.js"],"names":["define","require","exports","_","brackets","getModule","StateManager","CodeInspection","CommandManager","Commands","Dialogs","DocumentManager","EditorManager","FileViewController","FileSystem","Menus","Mustache","FindInFiles","WorkspaceManager","ProjectManager","StringUtils","Strings","Metrics","NotificationUI","Constants","Git","Events","EventEmitter","Preferences","Setup","ErrorHandler","ExpectedError","Main","GutterManager","Utils","ProgressDialog","gitPanelTemplate","gitPanelResultsTemplate","gitAuthorsDialogTemplate","gitCommitDialogTemplate","gitCommitLintResultTemplate","gitDiffDialogTemplate","questionDialogTemplate","showFileWhiteList","GIT_PANEL_SHOWN_ON_FIRST_BOOT","COMMIT_MODE","CURRENT","ALL","DEFAULT","gitPanel","$gitPanel","$","$mainToolbar","gitPanelDisabled","gitPanelMode","showingUntracked","$tableContainer","lastCommitMessage","lintFile","filename","fullPath","get","codeInspectionPromise","inspectFile","getFileForPath","e","logError","Promise","reject","jsPromise","_makeDialogBig","$dialog","$wrapper","parents","first","length","width","children","css","end","_showCommitDialog","stagedDiff","prefilledMessage","commitMode","files","compiledTemplate","render","dialog","showModalDialogUsingTemplate","getElement","countEvent","EVENT_TYPE","GIT","totalLintErrors","inspectFiles","then","lintResults","forEach","lintResult","errors","lintingFilePath","path","join","getProjectRoot","Array","isArray","result","resultSet","providerName","provider","name","push","errorLineMessage","pos","line","message","ch","file","JSON","stringify","hasErrors","getRangeName","filter","compiledResultHTML","is","find","html","CODE_INSPECTION_PROBLEMS","CODE_INSPECTION_PROBLEMS_NONE","addClass","click","preventDefault","$el","target","fileToOpen","data","execute","FILE_OPEN","done","getCurrentFullEditor","setCursorPos","close","diff","formatDiff","FORMAT_DIFF_TOO_LARGE","append","toggleAmendCheckbox","bool","prop","parent","attr","AMEND_COMMIT_FORBIDDEN","getCommitMessageElement","r","i","getCommitCounts","commits","hasRemote","hasCommitsAhead","ahead","catch","err","$commitMessageCount","recalculateMessageLength","val","trim","indexOf","Math","max","apply","split","map","l","toggleClass","usingTextArea","switchCommitMessageElement","findStr","currentValue","toggle","focus","prefillMessage","msg","on","$commitMessage","stopPropagation","removeClass","set","this","getLastCommitMessage","buttonId","commitMessageElement","filePaths","next","stage","_getStagedDiff","_doGitCommit","showError","ERROR_CANT_GET_STAGED_DIFF","status","commitMessage","amendCommit","noVerify","s","splice","tracker","newProgressTracker","show","commit","title","GIT_COMMIT_IN_PROGRESS","options","preDelay","postDelay","ERROR_MODIFIED_DIALOG_FILES","contains","resolve","emit","GIT_CHANGE_USERNAME","GIT_CHANGE_EMAIL","ERROR_GIT_COMMIT_FAILED","errorMetric","finally","GIT_COMMITED","refresh","_showAuthors","blame","fromLine","toLine","linesTotal","blameStats","reduce","stats","lineInfo","author","arr","key","authorName","lines","percentage","round","sortBy","reverse","LINES","_getCurrentFilePath","editor","gitRoot","document","filePath","getCurrentDocument","substring","handleAuthorsSelection","getActiveEditor","currentSelection","getSelection","start","isSomethingSelected","isDirty","ERROR_SAVE_FIRST","getBlame","ERROR_GIT_BLAME_FAILED","ERROR_NOTHING_SELECTED","handleAuthorsFile","handleGitDiff","difftool","diffFileNice","diffVal","ERROR_GIT_DIFF_FAILED","handleGitUndo","UNDO_CHANGES","question","format","Q_UNDO_CHANGES","escape","discardFileChanges","getAllOpenDocuments","doc","reloadDoc","ERROR_DISCARD_CHANGES_FAILED","handleGitDelete","fileEntry","ERROR_COULD_NOT_RESOLVE_FILE","FILE_DELETE","fileNamesString","_getStagedDiffForCommitMode","GETTING_STAGED_DIFF_PROGRESS","initialMessage","PLEASE_WAIT","getListOfStagedFiles","filesList","DIFF_FAILED_SEE_FILES","_getStaggedDiffForAllFiles","FILE_STATUS","UNTRACKED","_getDiffForUntrackedFiles","getDiffOfAllIndexFiles","getDiffOfStagedFiles","isUntracked","statusFiles","untrackedFiles","fileArray","fileObject","concat","_diff","resetIndex","handleRebase","whatToDo","rebase","REFRESH_ALL","abortMerge","discardAllChanges","ERROR_MERGE_ABORT_FAILED","findConflicts","doSearch","commitMerge","loadPathContent","handleGitCommit","once","gitStatusResults","totalFiles","totalFilesLinted","filesDone","showProgress","$progressBar","style","progressString","CODE_INSPECTION_DONE_FILES","codeInspectionPromises","fileObj","isDeleted","DELETED","setTimeout","all","compact","isMerge","isLoading","stripWhitespace","p","setLoading","STAGED","handleGitCommitInternal","Error","currentDoc","relativePath","currentFile","ERROR_PREPARING_COMMIT_DIALOG","unsetLoading","queue","stripWhitespaceFromFiles","CLEANING_WHITESPACE_PROGRESS","refreshCurrentFile","each","currentFullPath","thisFile","shouldShow","test","_refreshTableContainer","isVisible","allStaged","$editedList","visibleBefore","remove","text","NOTHING_TO_COMMIT","staged","statusText","allowDiff","RENAMED","allowDelete","ADDED","allowUndo","_setName","commandID","newName","command","setName","refreshCommitCounts","$pullBtn","$pushBtn","clearCounts","CMD_GIT_PULL","PULL_SHORTCUT","CMD_GIT_PUSH","PUSH_SHORTCUT","remotes","defaultRemote","behind","PULL_SHORTCUT_BEHIND","PUSH_SHORTCUT_AHEAD","TOOLTIP_SHOW_HISTORY","TOOLTIP_SHOW_FILE_HISTORY","empty","p1","p2","$icon","setVisible","CMD_GIT_TOGGLE_PANEL","setChecked","handleToggleUntracked","CMD_GIT_TOGGLE_UNTRACKED","commitCurrentFile","console","error","commitAllFiles","_toggleCommitButton","anyStaged","any","undoLastLocalCommit","askQuestion","UNDO_COMMIT","UNDO_LOCAL_COMMIT_CONFIRM","booleanResponse","response","ERROR_UNDO_LAST_COMMIT_FAILED","GIT_STATUS_RESULTS","results","lastCheckOneClicked","attachDefaultTableHandlers","off","$tr","closest","isChecked","shiftKey","lc","localeCompare","lcClickedSelector","sequence","prevUntil","andSelf","nextUntil","promises","add","$this","method","toArray","ERROR_MODIFY_FILE_STATUS_FAILED","stagePromise","unstage","ERROR_STAGE_FAILED","dontStripError","useNotification","currentTarget","openFileAndAddToWorkingSet","setGerritCheckState","enabled","CMD_GIT_GERRIT_PUSH_REF","RESET_LOCAL_REPO","RESET_LOCAL_REPO_CONFIRM","customOkBtn","DISCARD_CHANGES","customOkBtnClass","ERROR_RESET_LOCAL_REPO_FAILED","getSelectedHistoryCommit","$historyRow","hash","subject","_panelResized","_entries","mainToolbarWidth","overFlowWidth","breakpoints","className","bp","init","panelHtml","S","$panelHtml","hide","createBottomPanel","$panel","resizeObserver","ResizeObserver","observe","stageAll","getEmitter","HANDLE_GIT_COMMIT","goToPrev","goToNext","HISTORY_SHOW_FILE","HISTORY_SHOW_GLOBAL","HANDLE_FETCH","typeOfRemote","HANDLE_PUSH","HANDLE_PULL","HANDLE_GIT_INIT","HANDLE_GIT_CLONE","HANDLE_REMOTE_PICK","HANDLE_REMOTE_DELETE","HANDLE_REMOTE_CREATE","hasClass","getContextMenu","GIT_PANEL_HISTORY_CMENU","open","GIT_PANEL_CHANGES_CMENU","register","PANEL_COMMAND","COMMIT_CURRENT_SHORTCUT","CMD_GIT_COMMIT_CURRENT","COMMIT_ALL_SHORTCUT","CMD_GIT_COMMIT_ALL","FETCH_SHORTCUT","CMD_GIT_FETCH","GOTO_PREVIOUS_GIT_CHANGE","CMD_GIT_GOTO_PREVIOUS_CHANGE","GOTO_NEXT_GIT_CHANGE","CMD_GIT_GOTO_NEXT_CHANGE","REFRESH_GIT","CMD_GIT_REFRESH","CMD_GIT_DISCARD_ALL_CHANGES","UNDO_LAST_LOCAL_COMMIT","CMD_GIT_UNDO_LAST_COMMIT","CHANGE_USER_NAME","CMD_GIT_CHANGE_USERNAME","CHANGE_USER_EMAIL","CMD_GIT_CHANGE_EMAIL","ENABLE_GERRIT_PUSH_REF","GERRIT_TOGGLE_PUSH_REF","VIEW_AUTHORS_SELECTION","CMD_GIT_AUTHORS_OF_SELECTION","VIEW_AUTHORS_FILE","CMD_GIT_AUTHORS_OF_FILE","HIDE_UNTRACKED","GIT_INIT","CMD_GIT_INIT","GIT_CLONE","CMD_GIT_CLONE","GIT_SHOW_HISTORY","CMD_GIT_HISTORY_GLOBAL","GIT_SHOW_FILE_HISTORY","CMD_GIT_HISTORY_FILE","isExtensionActivated","enable","GIT_ENABLED","enableCommand","disable","cause","GIT_DISABLED","callback","getConfig","currentUserName","CHANGE_USER_NAME_TITLE","ENTER_NEW_USER_NAME","defaultValue","userName","setConfig","ERROR_CHANGE_USERNAME_FAILED","GIT_USERNAME_CHANGED","currentUserEmail","CHANGE_USER_EMAIL_TITLE","ENTER_NEW_USER_EMAIL","userEmail","ERROR_CHANGE_EMAIL_FAILED","GIT_EMAIL_CHANGED","strEnabled","toggledValue","GERRIT_PUSH_REF_TOGGLED","ERROR_TOGGLE_GERRIT_PUSH_REF_FAILED","CHANGE_USER_NAME_MENU","email","CHANGE_USER_EMAIL_MENU","GIT_REMOTE_AVAILABLE","GIT_REMOTE_NOT_AVAILABLE","createFromTemplate","GIT_TOAST_TITLE","GIT_TOAST_MESSAGE","allowedPlacements","dismissOnClick","toastStyle","currentEmail","BRACKETS_CURRENT_DOCUMENT_CHANGE","BRACKETS_DOCUMENT_SAVED","BRACKETS_FILE_CHANGED","fileSystemEntry","isDirectory","REBASE_MERGE_MODE","rebaseEnabled","mergeEnabled","FETCH_STARTED","FETCH_COMPLETE","REFRESH_COUNTERS","getPanel"],"mappings":"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","sourcesContent":["/*globals jsPromise, path*/\n\ndefine(function (require, exports) {\n\n    const _                = brackets.getModule(\"thirdparty/lodash\"),\n        StateManager       = brackets.getModule(\"preferences/StateManager\"),\n        CodeInspection     = brackets.getModule(\"language/CodeInspection\"),\n        CommandManager     = brackets.getModule(\"command/CommandManager\"),\n        Commands           = brackets.getModule(\"command/Commands\"),\n        Dialogs            = brackets.getModule(\"widgets/Dialogs\"),\n        DocumentManager    = brackets.getModule(\"document/DocumentManager\"),\n        EditorManager      = brackets.getModule(\"editor/EditorManager\"),\n        FileViewController = brackets.getModule(\"project/FileViewController\"),\n        FileSystem         = brackets.getModule(\"filesystem/FileSystem\"),\n        Menus              = brackets.getModule(\"command/Menus\"),\n        Mustache           = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        FindInFiles        = brackets.getModule(\"search/FindInFiles\"),\n        WorkspaceManager   = brackets.getModule(\"view/WorkspaceManager\"),\n        ProjectManager     = brackets.getModule(\"project/ProjectManager\"),\n        StringUtils        = brackets.getModule(\"utils/StringUtils\"),\n        Strings            = brackets.getModule(\"strings\"),\n        Metrics            = brackets.getModule(\"utils/Metrics\"),\n        NotificationUI = brackets.getModule(\"widgets/NotificationUI\"),\n        Constants          = require(\"src/Constants\"),\n        Git                = require(\"src/git/Git\"),\n        Events             = require(\"./Events\"),\n        EventEmitter       = require(\"./EventEmitter\"),\n        Preferences        = require(\"./Preferences\"),\n        Setup                    = require(\"src/utils/Setup\"),\n        ErrorHandler       = require(\"./ErrorHandler\"),\n        ExpectedError      = require(\"./ExpectedError\"),\n        Main               = require(\"./Main\"),\n        GutterManager      = require(\"./GutterManager\"),\n        Utils              = require(\"src/Utils\"),\n        ProgressDialog     = require(\"src/dialogs/Progress\");\n\n    const gitPanelTemplate            = require(\"text!templates/git-panel.html\"),\n        gitPanelResultsTemplate     = require(\"text!templates/git-panel-results.html\"),\n        gitAuthorsDialogTemplate    = require(\"text!templates/authors-dialog.html\"),\n        gitCommitDialogTemplate     = require(\"text!templates/git-commit-dialog.html\"),\n        gitCommitLintResultTemplate = require(\"text!templates/git-commit-dialog-lint-results.html\"),\n        gitDiffDialogTemplate       = require(\"text!templates/git-diff-dialog.html\"),\n        questionDialogTemplate      = require(\"text!templates/git-question-dialog.html\");\n\n    const showFileWhiteList = /^\\.gitignore$/,\n        GIT_PANEL_SHOWN_ON_FIRST_BOOT = \"GIT_PANEL_SHOWN_ON_FIRST_BOOT\";\n\n    const COMMIT_MODE = {\n        CURRENT: \"CURRENT\",\n        ALL: \"ALL\",\n        DEFAULT: \"DEFAULT\"\n    };\n\n    var gitPanel = null,\n        $gitPanel = $(null),\n        $mainToolbar,\n        gitPanelDisabled = null,\n        gitPanelMode = null,\n        showingUntracked = true,\n        $tableContainer = $(null),\n        lastCommitMessage = {};\n\n    function lintFile(filename) {\n        var fullPath = Preferences.get(\"currentGitRoot\") + filename,\n            codeInspectionPromise;\n\n        try {\n            codeInspectionPromise = CodeInspection.inspectFile(FileSystem.getFileForPath(fullPath));\n        } catch (e) {\n            ErrorHandler.logError(\"CodeInspection.inspectFile failed to execute for file \" + fullPath);\n            ErrorHandler.logError(e);\n            codeInspectionPromise = Promise.reject(e);\n        }\n\n        return jsPromise(codeInspectionPromise);\n    }\n\n    function _makeDialogBig($dialog) {\n        var $wrapper = $dialog.parents(\".modal-wrapper\").first();\n        if ($wrapper.length === 0) { return; }\n\n        $dialog\n            .width(\"80%\")\n            .children(\".modal-body\")\n                .css(\"max-height\", \"72vh\")\n            .end();\n    }\n\n    function _showCommitDialog(stagedDiff, prefilledMessage, commitMode, files) {\n        // Open the dialog\n        const compiledTemplate = Mustache.render(gitCommitDialogTemplate, {Strings: Strings}),\n            dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog          = dialog.getElement();\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"showDialog\");\n        let totalLintErrors = 0;\n        inspectFiles(files, $dialog).then(function (lintResults) {\n            // Flatten the error structure from various providers\n            lintResults = lintResults || [];\n            lintResults.forEach(function (lintResult) {\n                lintResult.errors = [];\n                const lintingFilePath = path.join(ProjectManager.getProjectRoot().fullPath, lintResult.filename);\n                if (Array.isArray(lintResult.result)) {\n                    lintResult.result.forEach(function (resultSet) {\n                        if (!resultSet.result || !resultSet.result.errors) { return; }\n\n                        var providerName = resultSet.provider.name;\n                        resultSet.result.errors.forEach(function (e) {\n                            lintResult.errors.push({\n                                errorLineMessage: (e.pos.line + 1) + \": \" + e.message + \" (\" + providerName + \")\",\n                                line: e.pos.line,\n                                ch: e.pos.ch,\n                                file: lintingFilePath\n                            });\n                        });\n                    });\n                } else {\n                    ErrorHandler.logError(\"[brackets-git] lintResults contain object in unexpected format: \" + JSON.stringify(lintResult));\n                }\n                lintResult.hasErrors = lintResult.errors.length > 0;\n                totalLintErrors += lintResult.errors.length;\n            });\n\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"lintErr\" + Metrics.getRangeName(totalLintErrors));\n\n            // Filter out only results with errors to show\n            lintResults = _.filter(lintResults, function (lintResult) {\n                return lintResult.hasErrors;\n            });\n            const compiledResultHTML = Mustache.render(gitCommitLintResultTemplate, {\n                    Strings: Strings,\n                    lintResults: lintResults\n                });\n            if(!$dialog || !$dialog.is(\":visible\")) {\n                return;\n            }\n            $dialog.find(\".accordion-title\").html(Strings.CODE_INSPECTION_PROBLEMS);\n            if(!lintResults.length){\n                $dialog.find(\".lint-errors\").html(Strings.CODE_INSPECTION_PROBLEMS_NONE);\n                $dialog.find(\".accordion\").addClass(\"forced-hidden\");\n                return;\n            }\n            $dialog.find(\".lint-errors\").html(compiledResultHTML);\n            if(!$dialog.find(\".lint-errors\").is(\":visible\")){\n                $dialog.find(\".accordion-toggle\").click();\n            }\n            $dialog.find(\".lint-error-commit-link\").click((e)=>{\n                e.preventDefault();\n                const $el = $(e.target);\n                const fileToOpen = $el.data(\"file\"),\n                    line = $el.data(\"line\"),\n                    ch = $el.data(\"ch\");\n                CommandManager.execute(Commands.FILE_OPEN, {fullPath: fileToOpen})\n                    .done(()=>{\n                        EditorManager.getCurrentFullEditor().setCursorPos(line, ch, true);\n                    });\n                dialog.close();\n            });\n        });\n\n        // We need bigger commit dialog\n        _makeDialogBig($dialog);\n\n        // Show nicely colored commit diff\n        const diff = Utils.formatDiff(stagedDiff);\n        if(diff === Utils.FORMAT_DIFF_TOO_LARGE) {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"diffTooLarge\");\n        }\n        $dialog.find(\".commit-diff\").append(diff);\n\n        // Enable / Disable amend checkbox\n        var toggleAmendCheckbox = function (bool) {\n            $dialog.find(\".amend-commit\")\n                .prop(\"disabled\", !bool)\n                .parent()\n                .attr(\"title\", !bool ? Strings.AMEND_COMMIT_FORBIDDEN : null);\n        };\n        toggleAmendCheckbox(false);\n\n        Git.getCommitCounts()\n            .then(function (commits) {\n                var hasRemote = $gitPanel.find(\".git-selected-remote\").data(\"remote\") != null;\n                var hasCommitsAhead = commits.ahead > 0;\n                toggleAmendCheckbox(!hasRemote || hasRemote && hasCommitsAhead);\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n            });\n\n        function getCommitMessageElement() {\n            var r = $dialog.find(\"[name='commit-message']:visible\");\n            if (r.length !== 1) {\n                r = $dialog.find(\"[name='commit-message']\");\n                for (var i = 0; i < r.length; i++) {\n                    if ($(r[i]).css(\"display\") !== \"none\") {\n                        return $(r[i]);\n                    }\n                }\n            }\n            return r;\n        }\n\n        var $commitMessageCount = $dialog.find(\"input[name='commit-message-count']\");\n\n        // Add event to count characters in commit message\n        var recalculateMessageLength = function () {\n            var val = getCommitMessageElement().val().trim(),\n                length = val.length;\n\n            if (val.indexOf(\"\\n\")) {\n                // longest line\n                length = Math.max.apply(null, val.split(\"\\n\").map(function (l) { return l.length; }));\n            }\n\n            $commitMessageCount\n                .val(length)\n                .toggleClass(\"over50\", length > 50 && length <= 100)\n                .toggleClass(\"over100\", length > 100);\n        };\n\n        var usingTextArea = false;\n\n        // commit message handling\n        function switchCommitMessageElement() {\n            usingTextArea = !usingTextArea;\n\n            var findStr = \"[name='commit-message']\",\n                currentValue = $dialog.find(findStr + \":visible\").val();\n            $dialog.find(findStr).toggle();\n            $dialog.find(findStr + \":visible\")\n                .val(currentValue)\n                .focus();\n            recalculateMessageLength();\n        }\n\n        $dialog.find(\"button.primary\").on(\"click\", function (e) {\n            var $commitMessage = getCommitMessageElement();\n            if ($commitMessage.val().trim().length === 0) {\n                e.stopPropagation();\n                $commitMessage.addClass(\"invalid\");\n            } else {\n                $commitMessage.removeClass(\"invalid\");\n            }\n        });\n\n        $dialog.find(\"button.extendedCommit\").on(\"click\", function () {\n            switchCommitMessageElement();\n            // this value will be set only when manually triggered\n            Preferences.set(\"useTextAreaForCommitByDefault\", usingTextArea);\n        });\n\n        function prefillMessage(msg) {\n            if (msg.indexOf(\"\\n\") !== -1 && !usingTextArea) {\n                switchCommitMessageElement();\n            }\n            $dialog.find(\"[name='commit-message']:visible\").val(msg);\n            recalculateMessageLength();\n        }\n\n        // Assign action to amend checkbox\n        $dialog.find(\".amend-commit\").on(\"click\", function () {\n            if ($(this).prop(\"checked\") === false) {\n                prefillMessage(\"\");\n            } else {\n                Git.getLastCommitMessage().then(function (msg) {\n                    prefillMessage(msg);\n                });\n            }\n        });\n\n        if (Preferences.get(\"useTextAreaForCommitByDefault\")) {\n            switchCommitMessageElement();\n        }\n\n        if (prefilledMessage) {\n            prefillMessage(prefilledMessage.trim());\n        }\n\n        // Add focus to commit message input\n        getCommitMessageElement().focus();\n\n        $dialog.find(\"[name='commit-message']\")\n            .on(\"keyup\", recalculateMessageLength)\n            .on(\"change\", recalculateMessageLength);\n        recalculateMessageLength();\n\n        dialog.done(function (buttonId) {\n            const commitMessageElement = getCommitMessageElement();\n            if(commitMessageElement){\n                lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = commitMessageElement.val();\n            }\n            if (buttonId === \"ok\") {\n                if (commitMode === COMMIT_MODE.ALL || commitMode === COMMIT_MODE.CURRENT) {\n                    var filePaths = _.map(files, function (next) {\n                        return next.file;\n                    });\n                    Git.stage(filePaths)\n                    .then(function () {\n                        return _getStagedDiff();\n                    })\n                    .then(function (diff) {\n                        _doGitCommit($dialog, getCommitMessageElement, diff);\n                    })\n                    .catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CANT_GET_STAGED_DIFF);\n                    });\n                } else {\n                    _doGitCommit($dialog, getCommitMessageElement, stagedDiff);\n                }\n            } else {\n                Git.status();\n            }\n        });\n    }\n\n    function _doGitCommit($dialog, getCommitMessageElement, stagedDiff) {\n        // this event won't launch when commit-message is empty so its safe to assume that it is not\n        var commitMessage = getCommitMessageElement().val(),\n            amendCommit = $dialog.find(\".amend-commit\").prop(\"checked\"),\n            noVerify = $dialog.find(\".commit-no-verify\").prop(\"checked\");\n\n        // if commit message is extended and has a newline, put an empty line after first line to separate subject and body\n        var s = commitMessage.split(\"\\n\");\n        if (s.length > 1 && s[1].trim() !== \"\") {\n            s.splice(1, 0, \"\");\n        }\n        commitMessage = s.join(\"\\n\");\n\n        // save lastCommitMessage in case the commit will fail\n        lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = commitMessage;\n\n        // now we are going to be paranoid and we will check if some mofo didn't change our diff\n        _getStagedDiff().then(function (diff) {\n            if (diff === stagedDiff) {\n                const tracker = ProgressDialog.newProgressTracker();\n                return ProgressDialog.show(Git.commit(commitMessage, amendCommit, noVerify, tracker),\n                    tracker, {\n                        title: Strings.GIT_COMMIT_IN_PROGRESS,\n                        options: { preDelay: 1, postDelay: 1 }\n                    })\n                    .then(function () {\n                        // clear lastCommitMessage because the commit was successful\n                        lastCommitMessage[ProjectManager.getProjectRoot().fullPath] = null;\n                    });\n            } else {\n                throw new ExpectedError(Strings.ERROR_MODIFIED_DIALOG_FILES);\n            }\n        }).then(()=>{\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"success\");\n        }).catch(function (err) {\n            if (ErrorHandler.contains(err, \"Please tell me who you are\")) {\n                return new Promise((resolve)=>{\n                    EventEmitter.emit(Events.GIT_CHANGE_USERNAME, function () {\n                        EventEmitter.emit(Events.GIT_CHANGE_EMAIL, function () {\n                            resolve();\n                        });\n                    });\n                });\n            }\n\n            ErrorHandler.showError(err, Strings.ERROR_GIT_COMMIT_FAILED, {errorMetric: \"commit\"});\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"fail\");\n\n        }).finally(function () {\n            EventEmitter.emit(Events.GIT_COMMITED);\n            refresh();\n        });\n    }\n\n    function _showAuthors(file, blame, fromLine, toLine) {\n        var linesTotal = blame.length;\n        var blameStats = blame.reduce(function (stats, lineInfo) {\n            var name = lineInfo.author + \" \" + lineInfo[\"author-mail\"];\n            if (stats[name]) {\n                stats[name] += 1;\n            } else {\n                stats[name] = 1;\n            }\n            return stats;\n        }, {});\n        blameStats = _.reduce(blameStats, function (arr, val, key) {\n            arr.push({\n                authorName: key,\n                lines: val,\n                percentage: Math.round(val / (linesTotal / 100))\n            });\n            return arr;\n        }, []);\n        blameStats = _.sortBy(blameStats, \"lines\").reverse();\n\n        if (fromLine || toLine) {\n            file += \" (\" + Strings.LINES + \" \" + fromLine + \"-\" + toLine + \")\";\n        }\n\n        var compiledTemplate = Mustache.render(gitAuthorsDialogTemplate, {\n                file: file,\n                blameStats: blameStats,\n                Strings: Strings\n            });\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n    }\n\n    function _getCurrentFilePath(editor) {\n        var gitRoot = Preferences.get(\"currentGitRoot\"),\n            document = editor ? editor.document : DocumentManager.getCurrentDocument(),\n            filePath = document.file.fullPath;\n        if (filePath.indexOf(gitRoot) === 0) {\n            filePath = filePath.substring(gitRoot.length);\n        }\n        return filePath;\n    }\n\n    function handleAuthorsSelection() {\n        var editor = EditorManager.getActiveEditor(),\n            filePath = _getCurrentFilePath(editor),\n            currentSelection = editor.getSelection(),\n            fromLine = currentSelection.start.line + 1,\n            toLine = currentSelection.end.line + 1;\n\n        // fix when nothing is selected on that line\n        if (currentSelection.end.ch === 0) { toLine = toLine - 1; }\n\n        var isSomethingSelected = currentSelection.start.line !== currentSelection.end.line ||\n                                  currentSelection.start.ch !== currentSelection.end.ch;\n        if (!isSomethingSelected) {\n            ErrorHandler.showError(new ExpectedError(Strings.ERROR_NOTHING_SELECTED));\n            return;\n        }\n\n        if (editor.document.isDirty) {\n            ErrorHandler.showError(new ExpectedError(Strings.ERROR_SAVE_FIRST));\n            return;\n        }\n\n        Git.getBlame(filePath, fromLine, toLine).then(function (blame) {\n            return _showAuthors(filePath, blame, fromLine, toLine);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GIT_BLAME_FAILED);\n        });\n    }\n\n    function handleAuthorsFile() {\n        var filePath = _getCurrentFilePath();\n        Git.getBlame(filePath).then(function (blame) {\n            return _showAuthors(filePath, blame);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GIT_BLAME_FAILED);\n        });\n    }\n\n    function handleGitDiff(file) {\n        if (Preferences.get(\"useDifftool\")) {\n            Git.difftool(file);\n        } else {\n            Git.diffFileNice(file).then(function (diff) {\n                // show the dialog with the diff\n                var compiledTemplate = Mustache.render(gitDiffDialogTemplate, { file: file, Strings: Strings }),\n                    dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n                    $dialog          = dialog.getElement();\n                _makeDialogBig($dialog);\n                const diffVal = Utils.formatDiff(diff);\n                if(diffVal === Utils.FORMAT_DIFF_TOO_LARGE) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"diffTooLarge\");\n                } else {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"success\");\n                }\n                $dialog.find(\".commit-diff\").append(diffVal);\n            }).catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'diffBtn', \"error\");\n                ErrorHandler.showError(err, Strings.ERROR_GIT_DIFF_FAILED);\n            });\n        }\n    }\n\n    function handleGitUndo(file) {\n        var compiledTemplate = Mustache.render(questionDialogTemplate, {\n            title: Strings.UNDO_CHANGES,\n            question: StringUtils.format(Strings.Q_UNDO_CHANGES, _.escape(file)),\n            Strings: Strings\n        });\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate).done(function (buttonId) {\n            if (buttonId === \"ok\") {\n                Git.discardFileChanges(file).then(function () {\n                    var gitRoot = Preferences.get(\"currentGitRoot\");\n                    DocumentManager.getAllOpenDocuments().forEach(function (doc) {\n                        if (doc.file.fullPath === gitRoot + file) {\n                            Utils.reloadDoc(doc);\n                        }\n                    });\n                    refresh();\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_DISCARD_CHANGES_FAILED);\n                });\n            }\n        });\n    }\n\n    function handleGitDelete(file) {\n        FileSystem.resolve(Preferences.get(\"currentGitRoot\") + file, function (err, fileEntry) {\n            if (err) {\n                ErrorHandler.showError(err, Strings.ERROR_COULD_NOT_RESOLVE_FILE);\n                return;\n            }\n            CommandManager.execute(Commands.FILE_DELETE, {file: fileEntry});\n        });\n    }\n\n    function _getStagedDiff(commitMode, files = []) {\n        const tracker = ProgressDialog.newProgressTracker();\n        const fileNamesString = files.map(file => file.file).join(\", \");\n        return ProgressDialog.show(_getStagedDiffForCommitMode(commitMode, files), tracker, {\n            title: Strings.GETTING_STAGED_DIFF_PROGRESS,\n            initialMessage: `${fileNamesString}\\n${Strings.PLEASE_WAIT}`,\n            options: { preDelay: 3, postDelay: 1 }\n        })\n        .catch(function (err) {\n            if (ErrorHandler.contains(err, \"cleanup\")) {\n                return false; // will display list of staged files instead\n            }\n            throw err;\n        })\n        .then(function (diff) {\n            if (!diff) {\n                return Git.getListOfStagedFiles().then(function (filesList) {\n                    return Strings.DIFF_FAILED_SEE_FILES + \"\\n\\n\" + filesList;\n                });\n            }\n            return diff;\n        });\n    }\n\n    function _getStagedDiffForCommitMode(commitMode, files) {\n\n        if (commitMode === COMMIT_MODE.ALL) {\n            return _getStaggedDiffForAllFiles();\n        }\n\n        if (commitMode === COMMIT_MODE.CURRENT && _.isArray(files)) {\n            if (files.length > 1) {\n                return Promise.reject(\"_getStagedDiffForCommitMode() got files.length > 1\");\n            }\n\n            var isUntracked = files[0].status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1;\n            if (isUntracked) {\n                return _getDiffForUntrackedFiles(files[0].file);\n            } else {\n                return Git.getDiffOfAllIndexFiles(files[0].file);\n            }\n        }\n\n        return Git.getDiffOfStagedFiles();\n    }\n\n    function _getStaggedDiffForAllFiles() {\n        return Git.status().then(function (statusFiles) {\n            var untrackedFiles = [];\n            var fileArray = [];\n\n            statusFiles.forEach(function (fileObject) {\n                var isUntracked = fileObject.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1;\n                if (isUntracked) {\n                    untrackedFiles.push(fileObject.file);\n                } else {\n                    fileArray.push(fileObject.file);\n                }\n            });\n\n            if (untrackedFiles.length > 0) {\n                return _getDiffForUntrackedFiles(fileArray.concat(untrackedFiles));\n            } else {\n                return Git.getDiffOfAllIndexFiles(fileArray);\n            }\n        });\n    }\n\n    function _getDiffForUntrackedFiles(files) {\n        var diff;\n        return Git.stage(files, false)\n            .then(function () {\n                return Git.getDiffOfStagedFiles();\n            })\n            .then(function (_diff) {\n                diff = _diff;\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return diff;\n            });\n    }\n\n    // whatToDo gets values \"continue\" \"skip\" \"abort\"\n    function handleRebase(whatToDo) {\n        Git.rebase(whatToDo).then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, \"Rebase \" + whatToDo + \" failed\");\n        });\n    }\n\n    function abortMerge() {\n        Git.discardAllChanges().then(function () {\n            EventEmitter.emit(Events.REFRESH_ALL);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_MERGE_ABORT_FAILED);\n        });\n    }\n\n    function findConflicts() {\n        FindInFiles.doSearch(/^<<<<<<<\\s|^=======\\s|^>>>>>>>\\s/gm);\n    }\n\n    function commitMerge() {\n        Utils.loadPathContent(Preferences.get(\"currentGitRoot\") + \"/.git/MERGE_MSG\").then(function (msg) {\n            handleGitCommit(msg, true, COMMIT_MODE.DEFAULT);\n            EventEmitter.once(Events.GIT_COMMITED, function () {\n                EventEmitter.emit(Events.REFRESH_ALL);\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, \"Merge commit failed\");\n        });\n    }\n\n    function inspectFiles(gitStatusResults, $dialog) {\n        const lintResults = [];\n        let totalFiles = gitStatusResults.length,\n            totalFilesLinted = 0,\n            filesDone = 0;\n        function showProgress() {\n            const $progressBar = $dialog.find('.accordion-progress-bar-inner');\n            if ($progressBar.length) {\n                $progressBar[0].style.width = `${filesDone/totalFiles*100}%`;\n            }\n            if(filesDone === totalFiles){\n                $dialog.find('.accordion-progress-bar').addClass(\"forced-inVisible\");\n            }\n            const progressString = StringUtils.format(Strings.CODE_INSPECTION_DONE_FILES, filesDone, totalFiles);\n            $dialog.find(\".lint-errors\").html(progressString);\n        }\n\n        const codeInspectionPromises = gitStatusResults.map(function (fileObj) {\n            const isDeleted = fileObj.status.indexOf(Git.FILE_STATUS.DELETED) !== -1;\n            if(isDeleted){\n                filesDone++;\n                showProgress();\n                return;\n            }\n\n            // Do a code inspection for the file, if it was not deleted\n            return new Promise((resolve) => {\n                // Delay lintFile execution to give the event loop some breathing room\n                setTimeout(() => {\n                    lintFile(fileObj.file)\n                        .catch(function () {\n                            return [\n                                {\n                                    provider: { name: \"See console [F12] for details\" },\n                                    result: {\n                                        errors: [\n                                            {\n                                                pos: { line: 0, ch: 0 },\n                                                message: \"CodeInspection failed to execute for this file.\"\n                                            }\n                                        ]\n                                    }\n                                }\n                            ];\n                        })\n                        .then(function (result) {\n                            if (result) {\n                                lintResults.push({\n                                    filename: fileObj.file,\n                                    result: result\n                                });\n                            }\n                            resolve();\n                        }).finally(()=>{\n                            filesDone++;\n                            totalFilesLinted++;\n                            showProgress();\n                        });\n                }, 0); // Delay of 0ms to defer to the next tick of the event loop\n            });\n        });\n\n        return Promise.all(_.compact(codeInspectionPromises)).then(function () {\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"files\" + Metrics.getRangeName(totalFiles));\n            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'commit', \"lint\" + Metrics.getRangeName(totalFilesLinted));\n            return lintResults;\n        });\n    }\n\n\n    function handleGitCommit(prefilledMessage, isMerge, commitMode) {\n        if(Utils.isLoading($gitPanel.find(\".git-commit\"))){\n            return;\n        }\n\n        var stripWhitespace = Preferences.get(\"stripWhitespaceFromCommits\");\n\n        // Disable button (it will be enabled when selecting files after reset)\n        Utils.setLoading($gitPanel.find(\".git-commit\"));\n\n        var p;\n\n        // First reset staged files, then add selected files to the index.\n        if (commitMode === COMMIT_MODE.DEFAULT) {\n            p = Git.status().then(function (files) {\n                files = _.filter(files, function (file) {\n                    return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1;\n                });\n\n                if (files.length === 0 && !isMerge) {\n                    return ErrorHandler.showError(\n                        new Error(\"Commit button should have been disabled\"),\n                        \"Nothing staged to commit\"\n                    );\n                }\n\n                return handleGitCommitInternal(stripWhitespace,\n                                               files,\n                                               commitMode,\n                                               prefilledMessage);\n            });\n        } else if (commitMode === COMMIT_MODE.ALL) {\n            p = Git.status().then(function (files) {\n                return handleGitCommitInternal(stripWhitespace,\n                                               files,\n                                               commitMode,\n                                               prefilledMessage);\n            });\n        } else if (commitMode === COMMIT_MODE.CURRENT) {\n            p = Git.status().then(function (files) {\n                var gitRoot = Preferences.get(\"currentGitRoot\");\n                var currentDoc = DocumentManager.getCurrentDocument();\n                if (currentDoc) {\n                    var relativePath = currentDoc.file.fullPath.substring(gitRoot.length);\n                    var currentFile = _.filter(files, function (next) {\n                        return relativePath === next.file;\n                    });\n                    return handleGitCommitInternal(stripWhitespace, currentFile, commitMode, prefilledMessage);\n                }\n            });\n        }\n\n        p.catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_PREPARING_COMMIT_DIALOG);\n        }).finally(function () {\n            Utils.unsetLoading($gitPanel.find(\".git-commit\"));\n        });\n\n    }\n\n    function handleGitCommitInternal(stripWhitespace, files, commitMode, prefilledMessage) {\n        let queue = Promise.resolve();\n\n        if (stripWhitespace) {\n            queue = queue.then(function () {\n                const tracker = ProgressDialog.newProgressTracker();\n                return ProgressDialog.show(\n                    Utils.stripWhitespaceFromFiles(files, commitMode === COMMIT_MODE.DEFAULT, tracker),\n                    tracker, {\n                        title: Strings.CLEANING_WHITESPACE_PROGRESS,\n                        options: { preDelay: 3, postDelay: 1 }\n                    }\n                );\n            });\n        }\n\n        return queue.then(function () {\n            // All files are in the index now, get the diff and show dialog.\n            return _getStagedDiff(commitMode, files).then(function (diff) {\n                return _showCommitDialog(diff, prefilledMessage, commitMode, files);\n            });\n        });\n    }\n\n    function refreshCurrentFile() {\n        var gitRoot = Preferences.get(\"currentGitRoot\");\n        var currentDoc = DocumentManager.getCurrentDocument();\n        if (currentDoc) {\n            $gitPanel.find(\"tr\").each(function () {\n                var currentFullPath = currentDoc.file.fullPath,\n                    thisFile = $(this).attr(\"x-file\");\n                $(this).toggleClass(\"selected\", gitRoot + thisFile === currentFullPath);\n            });\n        } else {\n            $gitPanel.find(\"tr\").removeClass(\"selected\");\n        }\n    }\n\n    function shouldShow(fileObj) {\n        if (showFileWhiteList.test(fileObj.name)) {\n            return true;\n        }\n        return ProjectManager.shouldShow(fileObj);\n    }\n\n    function _refreshTableContainer(files) {\n        if (!gitPanel.isVisible()) {\n            return;\n        }\n\n        // remove files that we should not show\n        files = _.filter(files, function (file) {\n            return shouldShow(file);\n        });\n\n        var allStaged = files.length > 0 && _.all(files, function (file) { return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1; });\n        $gitPanel.find(\".check-all\").prop(\"checked\", allStaged).prop(\"disabled\", files.length === 0);\n\n        var $editedList = $tableContainer.find(\".git-edited-list\");\n        var visibleBefore = $editedList.length ? $editedList.is(\":visible\") : true;\n        $editedList.remove();\n\n        if (files.length === 0) {\n            $tableContainer.append($(\"<p class='git-edited-list nothing-to-commit' />\").text(Strings.NOTHING_TO_COMMIT));\n        } else {\n            // if desired, remove untracked files from the results\n            if (showingUntracked === false) {\n                files = _.filter(files, function (file) {\n                    return file.status.indexOf(Git.FILE_STATUS.UNTRACKED) === -1;\n                });\n            }\n            // -\n            files.forEach(function (file) {\n                file.staged = file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1;\n                file.statusText = file.status.map(function (status) {\n                    return Strings[\"FILE_\" + status];\n                }).join(\", \");\n                file.allowDiff = file.status.indexOf(Git.FILE_STATUS.UNTRACKED) === -1 &&\n                                 file.status.indexOf(Git.FILE_STATUS.RENAMED) === -1 &&\n                                 file.status.indexOf(Git.FILE_STATUS.DELETED) === -1;\n                file.allowDelete = file.status.indexOf(Git.FILE_STATUS.UNTRACKED) !== -1 ||\n                                   file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1 &&\n                                   file.status.indexOf(Git.FILE_STATUS.ADDED) !== -1;\n                file.allowUndo = !file.allowDelete;\n            });\n            $tableContainer.append(Mustache.render(gitPanelResultsTemplate, {\n                files: files,\n                Strings: Strings\n            }));\n\n            refreshCurrentFile();\n        }\n        $tableContainer.find(\".git-edited-list\").toggle(visibleBefore);\n    }\n\n    function _setName(commandID, newName) {\n        const command = CommandManager.get(commandID);\n        if (command) {\n            command.setName(newName);\n        }\n    }\n\n    function refreshCommitCounts() {\n        // Find Push and Pull buttons\n        var $pullBtn = $gitPanel.find(\".git-pull\");\n        var $pushBtn = $gitPanel.find(\".git-push\");\n        var clearCounts = function () {\n            $pullBtn.children(\"span\").remove();\n            $pushBtn.children(\"span\").remove();\n            _setName(Constants.CMD_GIT_PULL, Strings.PULL_SHORTCUT);\n            _setName(Constants.CMD_GIT_PUSH, Strings.PUSH_SHORTCUT);\n        };\n\n        // Check if there's a remote, resolve if there's not\n        var remotes = Preferences.get(\"defaultRemotes\") || {};\n        var defaultRemote = remotes[Preferences.get(\"currentGitRoot\")];\n        if (!defaultRemote) {\n            clearCounts();\n            return Promise.resolve();\n        }\n\n        // Get the commit counts and append them to the buttons\n        return Git.getCommitCounts().then(function (commits) {\n            clearCounts();\n            if (commits.behind > 0) {\n                $pullBtn.append($(\"<span/>\").text(\" (\" + commits.behind + \")\"));\n                _setName(Constants.CMD_GIT_PULL,\n                    StringUtils.format(Strings.PULL_SHORTCUT_BEHIND, commits.behind));\n            }\n            if (commits.ahead > 0) {\n                $pushBtn.append($(\"<span/>\").text(\" (\" + commits.ahead + \")\"));\n                _setName(Constants.CMD_GIT_PUSH,\n                    StringUtils.format(Strings.PUSH_SHORTCUT_AHEAD, commits.ahead));\n            }\n        }).catch(function (err) {\n            clearCounts();\n            ErrorHandler.logError(err);\n        });\n    }\n\n    function refresh() {\n        // set the history panel to false and remove the class that show the button history active when refresh\n        $gitPanel.find(\".git-history-toggle\").removeClass(\"active\").attr(\"title\", Strings.TOOLTIP_SHOW_HISTORY);\n        $gitPanel.find(\".git-file-history\").removeClass(\"active\").attr(\"title\", Strings.TOOLTIP_SHOW_FILE_HISTORY);\n\n        if (gitPanelMode === \"not-repo\") {\n            $tableContainer.empty();\n            return Promise.resolve();\n        }\n\n        $tableContainer.find(\"#git-history-list\").remove();\n        $tableContainer.find(\".git-edited-list\").show();\n\n        var p1 = Git.status().catch(function (err) {\n            // this is an expected \"error\"\n            if (ErrorHandler.contains(err, \"Not a git repository\")) {\n                return;\n            }\n        });\n\n        var p2 = refreshCommitCounts();\n\n        // Clone button\n        $gitPanel.find(\".git-clone\").prop(\"disabled\", false);\n\n        // FUTURE: who listens for this?\n        return Promise.all([p1, p2]);\n    }\n\n    function toggle(bool) {\n        if (gitPanelDisabled === true) {\n            return;\n        }\n        if (typeof bool !== \"boolean\") {\n            bool = !gitPanel.isVisible();\n        }\n        Preferences.set(\"panelEnabled\", bool);\n        Main.$icon.toggleClass(\"on\", bool);\n        Main.$icon.toggleClass(\"selected-button\", bool);\n        gitPanel.setVisible(bool);\n\n        // Mark menu item as enabled/disabled.\n        CommandManager.get(Constants.CMD_GIT_TOGGLE_PANEL).setChecked(bool);\n\n        if (bool) {\n            $(\"#git-toolbar-icon\").removeClass(\"forced-hidden\");\n            refresh();\n        }\n    }\n\n    function handleToggleUntracked() {\n        showingUntracked = !showingUntracked;\n        const command = CommandManager.get(Constants.CMD_GIT_TOGGLE_UNTRACKED);\n        if (command) {\n            command.setChecked(!showingUntracked);\n        }\n\n        refresh();\n    }\n\n    function commitCurrentFile() {\n        // do not return anything here, core expects jquery promise\n        jsPromise(CommandManager.execute(\"file.save\"))\n            .then(function () {\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath],\n                    false, COMMIT_MODE.CURRENT);\n            }).catch((err)=>{\n                console.error(err);\n                // rethrowing with stripped git error details as it may have sensitive info\n                throw new Error(\"Error commitCurrentFile in git panel.js. this should not have happened here.\");\n            });\n    }\n\n    function commitAllFiles() {\n        // do not return anything here, core expects jquery promise\n        jsPromise(CommandManager.execute(\"file.saveAll\"))\n            .then(function () {\n                return Git.resetIndex();\n            })\n            .then(function () {\n                return handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath],\n                    false, COMMIT_MODE.ALL);\n            }).catch((err)=>{\n                console.error(err);\n                // rethrowing with stripped git error details as it may have sensitive info\n                throw new Error(\"Error commitAllFiles in git panel.js. this should not have happened here.\");\n            });\n    }\n\n    // Disable \"commit\" button if there aren't staged files to commit\n    function _toggleCommitButton(files) {\n        var anyStaged = _.any(files, function (file) { return file.status.indexOf(Git.FILE_STATUS.STAGED) !== -1; });\n        $gitPanel.find(\".git-commit\").prop(\"disabled\", !anyStaged);\n    }\n\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (results) {\n        _refreshTableContainer(results);\n        _toggleCommitButton(results);\n    });\n\n    function undoLastLocalCommit() {\n        return Utils.askQuestion(Strings.UNDO_COMMIT, Strings.UNDO_LOCAL_COMMIT_CONFIRM, {booleanResponse: true})\n            .then(function (response) {\n                if (response) {\n                    Git.undoLastLocalCommit()\n                        .catch(function (err) {\n                            ErrorHandler.showError(err, Strings.ERROR_UNDO_LAST_COMMIT_FAILED);\n                        })\n                        .finally(function () {\n                            refresh();\n                        });\n                }\n            });\n    }\n\n    var lastCheckOneClicked = null;\n\n    function attachDefaultTableHandlers() {\n        $tableContainer = $gitPanel.find(\".table-container\")\n            .off()\n            .on(\"click\", \".check-one\", function (e) {\n                e.stopPropagation();\n                var $tr = $(this).closest(\"tr\"),\n                    file = $tr.attr(\"x-file\"),\n                    status = $tr.attr(\"x-status\"),\n                    isChecked = $(this).is(\":checked\");\n\n                if (e.shiftKey) {\n                    // stage/unstage all file between\n                    var lc = lastCheckOneClicked.localeCompare(file),\n                        lcClickedSelector = \"[x-file='\" + lastCheckOneClicked + \"']\",\n                        sequence;\n\n                    if (lc < 0) {\n                        sequence = $tr.prevUntil(lcClickedSelector).andSelf();\n                    } else if (lc > 0) {\n                        sequence = $tr.nextUntil(lcClickedSelector).andSelf();\n                    }\n\n                    if (sequence) {\n                        sequence = sequence.add($tr.parent().children(lcClickedSelector));\n                        var promises = sequence.map(function () {\n                            var $this = $(this),\n                                method = isChecked ? \"stage\" : \"unstage\",\n                                file = $this.attr(\"x-file\"),\n                                status = $this.attr(\"x-status\");\n                            return Git[method](file, status === Git.FILE_STATUS.DELETED);\n                        }).toArray();\n                        return Promise.all(promises).then(function () {\n                            return Git.status();\n                        }).catch(function (err) {\n                            ErrorHandler.showError(err, Strings.ERROR_MODIFY_FILE_STATUS_FAILED);\n                        });\n                    }\n                }\n\n                lastCheckOneClicked = file;\n\n                let stagePromise;\n                if (isChecked) {\n                    stagePromise = Git.stage(file, status === Git.FILE_STATUS.DELETED).then(function () {\n                        return Git.status();\n                    });\n                } else {\n                    stagePromise = Git.unstage(file).then(function () {\n                        return Git.status();\n                    });\n                }\n                stagePromise.catch((err)=>{\n                    ErrorHandler.showError(err, Strings.ERROR_STAGE_FAILED, {\n                        dontStripError: true,\n                        errorMetric: \"stageOne\",\n                        useNotification: true\n                    });\n                });\n            })\n            .on(\"dblclick\", \".check-one\", function (e) {\n                e.stopPropagation();\n            })\n            .on(\"click\", \".btn-git-diff\", function (e) {\n                e.stopPropagation();\n                handleGitDiff($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"click\", \".btn-git-undo\", function (e) {\n                e.stopPropagation();\n                handleGitUndo($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"click\", \".btn-git-delete\", function (e) {\n                e.stopPropagation();\n                handleGitDelete($(e.target).closest(\"tr\").attr(\"x-file\"));\n            })\n            .on(\"mousedown\", \".modified-file\", function (e) {\n                var $this = $(e.currentTarget);\n                // we listen on mousedown event for faster file switch perception. but this results in\n                // this handler getting triggered before the above click handlers for table buttons and\n                // Check boxes. So we do a check to see if the clicked element is NOT a button,\n                // input, or tag inside a button.\n                if ($(e.target).is(\"button, input\") || $(e.target).closest(\"button\").length) {\n                    return;\n                }\n                if ($this.attr(\"x-status\") === Git.FILE_STATUS.DELETED) {\n                    return;\n                }\n                CommandManager.execute(Commands.FILE_OPEN, {\n                    fullPath: Preferences.get(\"currentGitRoot\") + $this.attr(\"x-file\")\n                });\n            })\n            .on(\"dblclick\", \".modified-file\", function (e) {\n                var $this = $(e.currentTarget);\n                if ($this.attr(\"x-status\") === Git.FILE_STATUS.DELETED) {\n                    return;\n                }\n                FileViewController.openFileAndAddToWorkingSet(Preferences.get(\"currentGitRoot\") + $this.attr(\"x-file\"));\n            });\n\n    }\n\n    EventEmitter.on(Events.GIT_CHANGE_USERNAME, function (callback) {\n        return Git.getConfig(\"user.name\").then(function (currentUserName) {\n            return Utils.askQuestion(Strings.CHANGE_USER_NAME_TITLE, Strings.ENTER_NEW_USER_NAME, { defaultValue: currentUserName })\n                .then(function (userName) {\n                    if (!userName.length) { userName = currentUserName; }\n                    return Git.setConfig(\"user.name\", userName, true).catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CHANGE_USERNAME_FAILED);\n                    }).then(function () {\n                        EventEmitter.emit(Events.GIT_USERNAME_CHANGED, userName);\n                    }).finally(function () {\n                        if (callback) {\n                            callback(userName);\n                        }\n                    });\n                });\n        });\n    });\n\n    EventEmitter.on(Events.GIT_CHANGE_EMAIL, function (callback) {\n        return Git.getConfig(\"user.email\").then(function (currentUserEmail) {\n            return Utils.askQuestion(Strings.CHANGE_USER_EMAIL_TITLE, Strings.ENTER_NEW_USER_EMAIL, { defaultValue: currentUserEmail })\n                .then(function (userEmail) {\n                    if (!userEmail.length) { userEmail = currentUserEmail; }\n                    return Git.setConfig(\"user.email\", userEmail, true).catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_CHANGE_EMAIL_FAILED);\n                    }).then(function () {\n                        EventEmitter.emit(Events.GIT_EMAIL_CHANGED, userEmail);\n                    }).finally(function () {\n                        if (callback) {\n                            callback(userEmail);\n                        }\n                    });\n                });\n        });\n    });\n\n    EventEmitter.on(Events.GERRIT_TOGGLE_PUSH_REF, function () {\n        // update preference and emit so the menu item updates\n        return Git.getConfig(\"gerrit.pushref\").then(function (strEnabled) {\n            var toggledValue = strEnabled !== \"true\";\n\n            // Set the global preference\n            // Saving a preference to tell the GitCli.push() method to check for gerrit push ref enablement\n            // so we don't slow down people who aren't using gerrit.\n            Preferences.set(\"gerritPushref\", toggledValue);\n\n            return Git.setConfig(\"gerrit.pushref\", toggledValue, true)\n                .then(function () {\n                    EventEmitter.emit(Events.GERRIT_PUSH_REF_TOGGLED, toggledValue);\n                });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_TOGGLE_GERRIT_PUSH_REF_FAILED);\n        });\n    });\n\n    EventEmitter.on(Events.GERRIT_PUSH_REF_TOGGLED, function (enabled) {\n        setGerritCheckState(enabled);\n    });\n\n    function setGerritCheckState(enabled) {\n        const command = CommandManager.get(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        if (command) {\n            command.setChecked(enabled);\n        }\n    }\n\n    function discardAllChanges() {\n        return Utils.askQuestion(Strings.RESET_LOCAL_REPO, Strings.RESET_LOCAL_REPO_CONFIRM, {\n            booleanResponse: true, customOkBtn: Strings.DISCARD_CHANGES, customOkBtnClass: \"danger\"})\n            .then(function (response) {\n                if (response) {\n                    return Git.discardAllChanges().catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_RESET_LOCAL_REPO_FAILED);\n                    }).then(function () {\n                        refresh();\n                    });\n                }\n            });\n    }\n\n    /**\n     * Retrieves the hash of the selected history commit in the panel. if panel not visible\n     * or if there is no selection, returns null.\n     *\n     * @returns {{hash: string, subject: string}|{}} The `hash` value and commit string\n     *              of the selected history commit if visible, otherwise {}.\n     */\n    function getSelectedHistoryCommit() {\n        const $historyRow = $(\".history-commit.selected\");\n        if($historyRow.is(\":visible\")){\n            return {\n                hash: $historyRow.attr(\"x-hash\"),\n                subject: $historyRow.find(\".commit-subject\").text()\n            };\n        }\n        return {};\n    }\n\n    function _panelResized(_entries) {\n        if(!$mainToolbar || !$mainToolbar.is(\":visible\")){\n            return;\n        }\n        const mainToolbarWidth = $mainToolbar.width();\n        let overFlowWidth = 565;\n        const breakpoints = [\n            { width: overFlowWidth, className: \"hide-when-small\" },\n            { width: 400, className: \"hide-when-x-small\" }\n        ];\n\n        if(mainToolbarWidth < overFlowWidth) {\n            $gitPanel.find(\".mainToolbar\").addClass(\"hide-overflow\");\n        } else {\n            $gitPanel.find(\".mainToolbar\").removeClass(\"hide-overflow\");\n        }\n        breakpoints.forEach(bp => {\n            if (mainToolbarWidth < bp.width) {\n                $gitPanel.find(`.${bp.className}`).addClass(\"forced-hidden\");\n            } else {\n                $gitPanel.find(`.${bp.className}`).removeClass(\"forced-hidden\");\n            }\n        });\n    }\n\n    function init() {\n        // Add panel\n        var panelHtml = Mustache.render(gitPanelTemplate, {\n            S: Strings\n        });\n        var $panelHtml = $(panelHtml);\n        $panelHtml.find(\".git-available, .git-not-available\").hide();\n\n        gitPanel = WorkspaceManager.createBottomPanel(\"main-git.panel\", $panelHtml, 100);\n        $gitPanel = gitPanel.$panel;\n        const resizeObserver = new ResizeObserver(_panelResized);\n        resizeObserver.observe($gitPanel[0]);\n        $mainToolbar = $gitPanel.find(\".mainToolbar\");\n        $gitPanel\n            .on(\"click\", \".close\", toggle)\n            .on(\"click\", \".check-all\", function () {\n                if ($(this).is(\":checked\")) {\n                    return Git.stageAll().then(function () {\n                        return Git.status();\n                    }).catch((err)=>{\n                        // this usually happens hwen a git index is locked Eg. error.\n                        //  Error: Error: fatal: Unable to create 'E:/.../test-git/.git/index.lock': File exists.\n                        //\n                        // Another git process seems to be running in this repository, e.g.\n                        // an editor opened by 'git commit'. Please make sure all processes\n                        // are terminated then try again. If it still fails, a git process\n                        // may have crashed in this repository earlier:\n                        // remove the file manually to continue.\n                        ErrorHandler.showError(err, Strings.ERROR_STAGE_FAILED, {\n                            dontStripError: true,\n                            errorMetric: \"stageAll\",\n                            useNotification: true\n                        });\n                    });\n                }\n                return Git.resetIndex().then(function () {\n                    return Git.status();\n                }).catch((err)=>{\n                    console.error(err);\n                    // rethrowing with stripped git error details as it may have sensitive info\n                    throw new Error(\"Error unstage all by checkbox in git panel.js. this should not have happened\");\n                });\n            })\n            .on(\"click\", \".git-refresh\", EventEmitter.getEmitter(Events.REFRESH_ALL, [\"panel\", \"refreshBtn\"]))\n            .on(\"click\", \".git-commit\", EventEmitter.getEmitter(Events.HANDLE_GIT_COMMIT))\n            .on(\"click\", \".git-rebase-continue\", function (e) { handleRebase(\"continue\", e); })\n            .on(\"click\", \".git-rebase-skip\", function (e) { handleRebase(\"skip\", e); })\n            .on(\"click\", \".git-rebase-abort\", function (e) { handleRebase(\"abort\", e); })\n            .on(\"click\", \".git-commit-merge\", commitMerge)\n            .on(\"click\", \".git-merge-abort\", abortMerge)\n            .on(\"click\", \".git-find-conflicts\", findConflicts)\n            .on(\"click\", \".git-prev-gutter\", ()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"prevBtn\");\n                GutterManager.goToPrev();\n            })\n            .on(\"click\", \".git-next-gutter\", ()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"nextBtn\");\n                GutterManager.goToNext();\n            })\n            .on(\"click\", \".git-file-history\", EventEmitter.getEmitter(Events.HISTORY_SHOW_FILE))\n            .on(\"click\", \".git-history-toggle\", EventEmitter.getEmitter(Events.HISTORY_SHOW_GLOBAL))\n            .on(\"click\", \".git-fetch\", EventEmitter.getEmitter(Events.HANDLE_FETCH, [\"panel\", \"fetchBtn\"]))\n            .on(\"click\", \".git-push\", function () {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"pushBtn\");\n                var typeOfRemote = $(this).attr(\"x-selected-remote-type\");\n                if (typeOfRemote === \"git\") {\n                    EventEmitter.emit(Events.HANDLE_PUSH);\n                }\n            })\n            .on(\"click\", \".git-pull\", EventEmitter.getEmitter(Events.HANDLE_PULL, [\"panel\", \"pullBtn\"]))\n            .on(\"click\", \".git-init\", EventEmitter.getEmitter(Events.HANDLE_GIT_INIT))\n            .on(\"click\", \".git-clone\", EventEmitter.getEmitter(Events.HANDLE_GIT_CLONE))\n            .on(\"click\", \".change-remote\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_PICK, [\"panel\", \"changeRemote\"]))\n            .on(\"click\", \".remove-remote\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_DELETE, [\"panel\", \"removeRemote\"]))\n            .on(\"click\", \".git-remote-new\", EventEmitter.getEmitter(Events.HANDLE_REMOTE_CREATE, [\"panel\", \"newRemote\"]))\n            .on(\"contextmenu\", \"tr\", function (e) {\n                const $this = $(this);\n                if ($this.hasClass(\"history-commit\")) {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'cmenu', \"history\");\n                    if(!$this.hasClass(\"selected\")){\n                        $this.click();\n                    }\n                    Menus.getContextMenu(Constants.GIT_PANEL_HISTORY_CMENU).open(e);\n                    return;\n                }\n\n                $this.click();\n                setTimeout(function () {\n                    Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'cmenu', \"filechanges\");\n                    Menus.getContextMenu(Constants.GIT_PANEL_CHANGES_CMENU).open(e);\n                }, 1);\n            });\n\n        // Attaching table handlers\n        attachDefaultTableHandlers();\n\n        // Add command to menu.\n        CommandManager.register(Strings.PANEL_COMMAND, Constants.CMD_GIT_TOGGLE_PANEL, toggle);\n        CommandManager.register(Strings.COMMIT_CURRENT_SHORTCUT, Constants.CMD_GIT_COMMIT_CURRENT, commitCurrentFile);\n        CommandManager.register(Strings.COMMIT_ALL_SHORTCUT, Constants.CMD_GIT_COMMIT_ALL, commitAllFiles);\n        CommandManager.register(Strings.PUSH_SHORTCUT, Constants.CMD_GIT_PUSH, EventEmitter.getEmitter(Events.HANDLE_PUSH));\n        CommandManager.register(Strings.PULL_SHORTCUT, Constants.CMD_GIT_PULL, EventEmitter.getEmitter(Events.HANDLE_PULL));\n        CommandManager.register(Strings.FETCH_SHORTCUT, Constants.CMD_GIT_FETCH, EventEmitter.getEmitter(Events.HANDLE_FETCH));\n        CommandManager.register(Strings.GOTO_PREVIOUS_GIT_CHANGE, Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE, GutterManager.goToPrev);\n        CommandManager.register(Strings.GOTO_NEXT_GIT_CHANGE, Constants.CMD_GIT_GOTO_NEXT_CHANGE, GutterManager.goToNext);\n        CommandManager.register(Strings.REFRESH_GIT, Constants.CMD_GIT_REFRESH, EventEmitter.getEmitter(Events.REFRESH_ALL));\n        CommandManager.register(Strings.RESET_LOCAL_REPO, Constants.CMD_GIT_DISCARD_ALL_CHANGES, discardAllChanges);\n        CommandManager.register(Strings.UNDO_LAST_LOCAL_COMMIT, Constants.CMD_GIT_UNDO_LAST_COMMIT, undoLastLocalCommit);\n        CommandManager.register(Strings.CHANGE_USER_NAME, Constants.CMD_GIT_CHANGE_USERNAME, EventEmitter.getEmitter(Events.GIT_CHANGE_USERNAME));\n        CommandManager.register(Strings.CHANGE_USER_EMAIL, Constants.CMD_GIT_CHANGE_EMAIL, EventEmitter.getEmitter(Events.GIT_CHANGE_EMAIL));\n        CommandManager.register(Strings.ENABLE_GERRIT_PUSH_REF, Constants.CMD_GIT_GERRIT_PUSH_REF, EventEmitter.getEmitter(Events.GERRIT_TOGGLE_PUSH_REF));\n        CommandManager.register(Strings.VIEW_AUTHORS_SELECTION, Constants.CMD_GIT_AUTHORS_OF_SELECTION, handleAuthorsSelection);\n        CommandManager.register(Strings.VIEW_AUTHORS_FILE, Constants.CMD_GIT_AUTHORS_OF_FILE, handleAuthorsFile);\n        CommandManager.register(Strings.HIDE_UNTRACKED, Constants.CMD_GIT_TOGGLE_UNTRACKED, handleToggleUntracked);\n        CommandManager.register(Strings.GIT_INIT, Constants.CMD_GIT_INIT, EventEmitter.getEmitter(Events.HANDLE_GIT_INIT));\n        CommandManager.register(Strings.GIT_CLONE, Constants.CMD_GIT_CLONE, EventEmitter.getEmitter(Events.HANDLE_GIT_CLONE));\n        CommandManager.register(Strings.GIT_SHOW_HISTORY, Constants.CMD_GIT_HISTORY_GLOBAL, ()=>{\n            toggle(true);\n            EventEmitter.emit(Events.HISTORY_SHOW_GLOBAL);\n        });\n        CommandManager.register(Strings.GIT_SHOW_FILE_HISTORY, Constants.CMD_GIT_HISTORY_FILE, ()=>{\n            toggle(true);\n            EventEmitter.emit(Events.HISTORY_SHOW_FILE);\n        });\n\n        // Show gitPanel when appropriate\n        if (Preferences.get(\"panelEnabled\") && Setup.isExtensionActivated()) {\n            toggle(true);\n        }\n        _panelResized();\n        GutterManager.init();\n    } // function init() {\n\n    function enable() {\n        EventEmitter.emit(Events.GIT_ENABLED);\n        // this function is called after every Branch.refresh\n        gitPanelMode = null;\n        //\n        $gitPanel.find(\".git-available\").show();\n        $gitPanel.find(\".git-not-available\").hide();\n        Utils.enableCommand(Constants.CMD_GIT_INIT, false);\n        Utils.enableCommand(Constants.CMD_GIT_CLONE, false);\n        //\n        Main.$icon.removeClass(\"warning\");\n        gitPanelDisabled = false;\n        // after all is enabled\n        refresh();\n    }\n\n    function disable(cause) {\n        EventEmitter.emit(Events.GIT_DISABLED, cause);\n        gitPanelMode = cause;\n        // causes: not-repo\n        if (gitPanelMode === \"not-repo\") {\n            $gitPanel.find(\".git-available\").hide();\n            $gitPanel.find(\".git-not-available\").show();\n            Utils.enableCommand(Constants.CMD_GIT_INIT, true);\n            Utils.enableCommand(Constants.CMD_GIT_CLONE, true);\n        } else {\n            Main.$icon.addClass(\"warning\");\n            toggle(false);\n            gitPanelDisabled = true;\n        }\n        refresh();\n    }\n\n    // Event listeners\n    EventEmitter.on(Events.GIT_USERNAME_CHANGED, function (userName) {\n        if(userName){\n            _setName(Constants.CMD_GIT_CHANGE_USERNAME,\n                StringUtils.format(Strings.CHANGE_USER_NAME_MENU, userName));\n        } else {\n            _setName(Constants.CMD_GIT_CHANGE_USERNAME, Strings.CHANGE_USER_NAME);\n        }\n    });\n\n    EventEmitter.on(Events.GIT_EMAIL_CHANGED, function (email) {\n        $gitPanel.find(\".git-user-email\").text(email);\n        if(email){\n            _setName(Constants.CMD_GIT_CHANGE_EMAIL,\n                StringUtils.format(Strings.CHANGE_USER_EMAIL_MENU, email));\n        } else {\n            _setName(Constants.CMD_GIT_CHANGE_EMAIL, Strings.CHANGE_USER_EMAIL);\n        }\n    });\n\n    EventEmitter.on(Events.GIT_REMOTE_AVAILABLE, function () {\n        $gitPanel.find(\".git-pull, .git-push, .git-fetch\").prop(\"disabled\", false);\n    });\n\n    EventEmitter.on(Events.GIT_REMOTE_NOT_AVAILABLE, function () {\n        $gitPanel.find(\".git-pull, .git-push, .git-fetch\").prop(\"disabled\", true);\n    });\n\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        if(!StateManager.get(GIT_PANEL_SHOWN_ON_FIRST_BOOT)){\n            StateManager.set(GIT_PANEL_SHOWN_ON_FIRST_BOOT, true);\n            toggle(true);\n            NotificationUI.createFromTemplate(\n                Strings.GIT_TOAST_TITLE,\n                Strings.GIT_TOAST_MESSAGE,\n                \"git-toolbar-icon\", {\n                    allowedPlacements: ['left'],\n                    dismissOnClick: true,\n                    toastStyle: \"width-250\"\n                }\n            );\n        }\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'project', \"enabled\");\n        // Add info from Git to panel\n        Git.getConfig(\"user.name\").then(function (currentUserName) {\n            EventEmitter.emit(Events.GIT_USERNAME_CHANGED, currentUserName);\n        });\n        Git.getConfig(\"user.email\").then(function (currentEmail) {\n            EventEmitter.emit(Events.GIT_EMAIL_CHANGED, currentEmail);\n        });\n        Git.getConfig(\"gerrit.pushref\").then(function (strEnabled) {\n            var enabled = strEnabled === \"true\";\n            // Handle the case where we switched to a repo that is using gerrit\n            if (enabled && !Preferences.get(\"gerritPushref\")) {\n                Preferences.set(\"gerritPushref\", true);\n            }\n            EventEmitter.emit(Events.GERRIT_PUSH_REF_TOGGLED, enabled);\n        });\n    });\n\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function () {\n        if (!gitPanel) { return; }\n        refreshCurrentFile();\n    });\n\n    EventEmitter.on(Events.BRACKETS_DOCUMENT_SAVED, function () {\n        if (!gitPanel) { return; }\n        refresh();\n    });\n\n    EventEmitter.on(Events.BRACKETS_FILE_CHANGED, function (fileSystemEntry) {\n        // files are added or deleted from the directory\n        if (fileSystemEntry.isDirectory) {\n            refresh();\n        }\n    });\n\n    EventEmitter.on(Events.REBASE_MERGE_MODE, function (rebaseEnabled, mergeEnabled) {\n        $gitPanel.find(\".git-rebase\").toggle(rebaseEnabled);\n        $gitPanel.find(\".git-merge\").toggle(mergeEnabled);\n        $gitPanel.find(\"button.git-commit\").toggle(!rebaseEnabled && !mergeEnabled);\n    });\n\n    EventEmitter.on(Events.FETCH_STARTED, function () {\n        $gitPanel.find(\".git-fetch\")\n            .addClass(\"btn-loading\")\n            .prop(\"disabled\", true);\n    });\n\n    EventEmitter.on(Events.FETCH_COMPLETE, function () {\n        $gitPanel.find(\".git-fetch\")\n            .removeClass(\"btn-loading\")\n            .prop(\"disabled\", false);\n        refreshCommitCounts();\n    });\n\n    EventEmitter.on(Events.REFRESH_COUNTERS, function () {\n        refreshCommitCounts();\n    });\n\n    EventEmitter.on(Events.HANDLE_GIT_COMMIT, function () {\n        handleGitCommit(lastCommitMessage[ProjectManager.getProjectRoot().fullPath], false, COMMIT_MODE.DEFAULT);\n    });\n\n    exports.init = init;\n    exports.refresh = refresh;\n    exports.toggle = toggle;\n    exports.enable = enable;\n    exports.disable = disable;\n    exports.getSelectedHistoryCommit = getSelectedHistoryCommit;\n    exports.getPanel = function () { return $gitPanel; };\n\n});\n"],"file":"Panel.js"}