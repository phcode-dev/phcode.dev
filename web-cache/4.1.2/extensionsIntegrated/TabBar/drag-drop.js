define(function(require,exports,module){const MainViewManager=require("view/MainViewManager"),CommandManager=require("command/CommandManager"),Commands=require("command/Commands");let draggedTab=null,dragIndicator=null,dragSourcePane=null;function cleanupDragState(){$(".tab").removeClass("dragging drag-target"),$(".empty-pane-drop-target").removeClass("empty-pane-drop-target"),dragIndicator&&dragIndicator.hide().css({top:"",left:"",height:""}),draggedTab=null,dragSourcePane=null,$("#tab-drag-helper").remove()}function ensureDragIndicator(){dragIndicator&&dragIndicator.length||(dragIndicator=$('<div class="tab-drag-indicator"></div>'),$("body").append(dragIndicator))}function updateDragIndicator(targetTab,insertBefore){if(!targetTab)return void dragIndicator.hide();const rect=targetTab.getBoundingClientRect(),x=insertBefore?rect.left:rect.right;dragIndicator.css({position:"fixed",left:x+"px",top:rect.top+"px",height:rect.height+"px",width:"2px",zIndex:10001}).show()}function getDropPosition(targetTab,mouseX){const rect=targetTab.getBoundingClientRect(),midpoint=rect.left+rect.width/2;return mouseX<midpoint}function findClosestTab(container,mouseX){const tabs=container.find(".tab").get();let closestTab=null,closestDistance=1/0;for(let tab of tabs){if(tab===draggedTab)continue;const rect=tab.getBoundingClientRect(),tabCenter=rect.left+rect.width/2,distance=Math.abs(mouseX-tabCenter);distance<closestDistance&&(closestDistance=distance,closestTab=tab)}return closestTab}function handleDragStart(event){draggedTab=this,dragSourcePane=$(this).closest("#phoenix-tab-bar-2").length>0?"second-pane":"first-pane",event.originalEvent.dataTransfer.effectAllowed="move",event.originalEvent.dataTransfer.setData("application/x-phoenix-tab","tab-drag"),$(this).addClass("dragging"),ensureDragIndicator(),setTimeout(()=>{dragIndicator.hide()},10)}function handleDragOver(event){if(!draggedTab)return;event.preventDefault(),event.originalEvent.dataTransfer.dropEffect="move";const targetTab=event.currentTarget;if(targetTab===draggedTab)return;const insertBefore=getDropPosition(targetTab,event.originalEvent.clientX);updateDragIndicator(targetTab,insertBefore),$(".tab").removeClass("drag-target"),$(targetTab).addClass("drag-target")}function handleContainerDragOver(event){if(!draggedTab)return;event.preventDefault();const container=$(this),mouseX=event.originalEvent.clientX,closestTab=findClosestTab(container,mouseX);if(closestTab){const insertBefore=getDropPosition(closestTab,mouseX);updateDragIndicator(closestTab,insertBefore),$(".tab").removeClass("drag-target"),$(closestTab).addClass("drag-target")}else dragIndicator.hide()}function handleDrop(event){if(event.preventDefault(),event.stopPropagation(),!draggedTab||this===draggedTab)return void cleanupDragState();const targetTab=this,targetPaneId=$(this).closest("#phoenix-tab-bar-2").length>0?"second-pane":"first-pane",insertBefore=getDropPosition(this,event.originalEvent.clientX);performTabMove(this,targetPaneId,insertBefore),cleanupDragState()}function handleContainerDrop(event){if(event.preventDefault(),!draggedTab)return void cleanupDragState();const container=$(this),mouseX=event.originalEvent.clientX,closestTab=findClosestTab(container,mouseX);if(closestTab){const targetPaneId="phoenix-tab-bar-2"===container.attr("id")?"second-pane":"first-pane",insertBefore=getDropPosition(closestTab,mouseX);performTabMove(closestTab,targetPaneId,insertBefore)}cleanupDragState()}function performTabMove(targetTab,targetPaneId,insertBefore){const draggedPath=$(draggedTab).attr("data-path"),targetPath=$(targetTab).attr("data-path");dragSourcePane===targetPaneId?moveWorkingSetItem(targetPaneId,draggedPath,targetPath,insertBefore):moveTabBetweenPanes(dragSourcePane,targetPaneId,draggedPath,targetPath,insertBefore)}function moveWorkingSetItem(paneId,draggedPath,targetPath,beforeTarget){const workingSet=MainViewManager.getWorkingSet(paneId);let draggedIndex=-1,targetIndex=-1;for(let i=0;i<workingSet.length;i++)workingSet[i].fullPath===draggedPath&&(draggedIndex=i),workingSet[i].fullPath===targetPath&&(targetIndex=i);if(-1!==draggedIndex&&-1!==targetIndex){let newPosition=beforeTarget?targetIndex:targetIndex+1;draggedIndex<newPosition&&newPosition--,MainViewManager._moveWorkingSetItem(paneId,draggedIndex,newPosition)}}function moveTabBetweenPanes(sourcePaneId,targetPaneId,draggedPath,targetPath,beforeTarget){try{const sourceWorkingSet=MainViewManager.getWorkingSet(sourcePaneId),targetWorkingSet=MainViewManager.getWorkingSet(targetPaneId);let draggedFile=null,targetIndex=-1;for(let i=0;i<sourceWorkingSet.length;i++)if(sourceWorkingSet[i].fullPath===draggedPath){draggedFile=sourceWorkingSet[i];break}for(let i=0;i<targetWorkingSet.length;i++)if(targetWorkingSet[i].fullPath===targetPath){targetIndex=i;break}if(draggedFile){CommandManager.execute(Commands.FILE_CLOSE,{file:draggedFile,paneId:sourcePaneId});const insertIndex=-1!==targetIndex?beforeTarget?targetIndex:targetIndex+1:targetWorkingSet.length;MainViewManager.addToWorkingSet(targetPaneId,draggedFile,insertIndex),CommandManager.execute(Commands.FILE_OPEN,{fullPath:draggedPath,paneId:targetPaneId})}}catch(error){console.error("Error during cross-pane tab move:",error)}}function handleDragEnd(event){setTimeout(()=>{cleanupDragState()},50)}function handleDragLeave(event){const relatedTarget=event.originalEvent.relatedTarget;$(this).is(relatedTarget)||$(this).has(relatedTarget).length||$(this).removeClass("drag-target")}function setupTabBarDragHandlers(tabBarSelector){const $tabBar=$(tabBarSelector);$tabBar.off("dragstart dragover dragenter dragleave drop dragend"),$tabBar.on("dragstart",".tab",handleDragStart),$tabBar.on("dragover",".tab",handleDragOver),$tabBar.on("dragleave",".tab",handleDragLeave),$tabBar.on("drop",".tab",handleDrop),$tabBar.on("dragend",".tab",handleDragEnd),$tabBar.on("dragover",handleContainerDragOver),$tabBar.on("drop",handleContainerDrop),$tabBar.find(".tab").attr("draggable",!0)}function setupPaneDropTargets(){const panes=["#first-pane .pane-content","#second-pane .pane-content"];panes.forEach((paneSelector,index)=>{const paneId=0===index?"first-pane":"second-pane",$pane=$(paneSelector);$pane.off("dragover dragenter dragleave drop"),$pane.on("dragover dragenter",function(event){if(draggedTab&&dragSourcePane!==paneId){event.preventDefault();const tabBarId="first-pane"===paneId?"#phoenix-tab-bar":"#phoenix-tab-bar-2",$tabBar=$(tabBarId),isEmptyPane=!$tabBar.length||$tabBar.is(":hidden")||0===$tabBar.children(".tab").length;isEmptyPane?$(this).addClass("empty-pane-drop-target"):$(this).addClass("pane-drop-target")}}),$pane.on("dragleave",function(event){$(this).removeClass("empty-pane-drop-target pane-drop-target")}),$pane.on("drop",function(event){if(draggedTab&&dragSourcePane!==paneId){event.preventDefault(),$(this).removeClass("empty-pane-drop-target pane-drop-target");const draggedPath=$(draggedTab).attr("data-path"),sourceWorkingSet=MainViewManager.getWorkingSet(dragSourcePane),targetWorkingSet=MainViewManager.getWorkingSet(paneId);let draggedFile=null;for(let file of sourceWorkingSet)if(file.fullPath===draggedPath){draggedFile=file;break}if(draggedFile){CommandManager.execute(Commands.FILE_CLOSE,{file:draggedFile,paneId:dragSourcePane});const tabBarId="first-pane"===paneId?"#phoenix-tab-bar":"#phoenix-tab-bar-2",$tabBar=$(tabBarId),isEmptyPane=!$tabBar.length||$tabBar.is(":hidden")||0===$tabBar.children(".tab").length;if(isEmptyPane)MainViewManager.addToWorkingSet(paneId,draggedFile);else{const currentActiveFile=MainViewManager.getCurrentlyViewedFile(paneId);if(currentActiveFile){let targetIndex=-1;for(let i=0;i<targetWorkingSet.length;i++)if(targetWorkingSet[i].fullPath===currentActiveFile.fullPath){targetIndex=i;break}MainViewManager.addToWorkingSet(paneId,draggedFile,targetIndex+1)}else MainViewManager.addToWorkingSet(paneId,draggedFile)}CommandManager.execute(Commands.FILE_OPEN,{fullPath:draggedPath,paneId:paneId})}cleanupDragState()}})})}function setupGlobalCleanup(){$(document).on("dragend mouseup",function(){draggedTab&&setTimeout(()=>cleanupDragState(),100)}),$(document).on("keydown",function(event){"Escape"===event.key&&draggedTab&&cleanupDragState()})}function init(firstPaneSelector,secondPaneSelector){firstPaneSelector&&setupTabBarDragHandlers(firstPaneSelector),secondPaneSelector&&setupTabBarDragHandlers(secondPaneSelector),setupPaneDropTargets(),setupGlobalCleanup(),ensureDragIndicator()}module.exports={init:init}});
//# sourceMappingURL=drag-drop.js.map
