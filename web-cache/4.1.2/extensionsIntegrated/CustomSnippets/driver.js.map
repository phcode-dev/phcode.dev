{"version":3,"sources":["extensionsIntegrated/CustomSnippets/driver.js"],"names":["define","require","exports","module","EditorManager","Metrics","Global","Helper","UIHelper","SnippetsState","SnippetsList","handleSaveBtnClick","snippetData","getSnippetData","abbreviation","trim","templateText","shouldAddSnippetToList","SnippetHintsList","push","rebuildOptimizedStructures","clearAllInputFields","toggleSaveButtonDisability","fileCategory","categorizeFileExtensionForMetrics","fileExtension","countEvent","EVENT_TYPE","EDITOR","saveSnippetsToState","catch","error","logger","reportError","showSnippetListMenu","showSnippetsList","showDuplicateAbbreviationError","handleEditSaveBtnClick","editedData","getEditSnippetData","$editView","$","originalSnippet","data","snippetIndex","existingSnippet","find","snippet","removeData","handleCancelEditBtnClick","populateEditForm","matchedItem","getWordBeforeCursor","editor","getActiveEditor","pos","getCursorPos","word","i","ch","breakWordAt","char","getCharacterAtPosition","line","includes"],"mappings":"AAqBAA,OAAO,SAAUC,QAASC,QAASC,QAC/B,MAAMC,cAAgBH,QAAQ,wBACxBI,QAAUJ,QAAQ,iBAElBK,OAASL,QAAQ,YACjBM,OAASN,QAAQ,YACjBO,SAAWP,QAAQ,cACnBQ,cAAgBR,QAAQ,mBACxBS,aAAeT,QAAQ,kBAM7B,SAASU,qBACL,MAAMC,YAAcL,OAAOM,iBAE3B,GAAKD,YAAYE,cAAiBF,YAAYE,aAAaC,QAGtDH,YAAYI,cAAiBJ,YAAYI,aAAaD,OAI3D,GAAIE,uBAAuBL,aAAc,CACrCN,OAAOY,iBAAiBC,KAAKP,aAC7BL,OAAOa,6BACPb,OAAOc,sBACPd,OAAOe,6BAGP,MAAMC,aAAehB,OAAOiB,kCAAkCZ,YAAYa,eAC1EpB,QAAQqB,WAAWrB,QAAQsB,WAAWC,OAAQ,eAAgBL,gBAG9Dd,cAAcoB,sBACTC,MAAM,SAAUC,OACbC,OAAOC,YAAYF,MAAO,iEAIlCvB,SAAS0B,sBACTxB,aAAayB,wBAGb3B,SAAS4B,+BAA+BxB,YAAYE,cAAc,GAO1E,SAASuB,yBACL,MAAMC,WAAa/B,OAAOgC,qBACpBC,UAAYC,EAAE,yBACdC,gBAAkBF,UAAUG,KAAK,mBACjCC,aAAeJ,UAAUG,KAAK,gBAEpC,GAAKL,WAAWxB,cAAiBwB,WAAWxB,aAAaC,QAGpDuB,WAAWtB,cAAiBsB,WAAWtB,aAAaD,OAAzD,CAKA,GAAIuB,WAAWxB,eAAiB4B,gBAAgB5B,aAAc,CAC1D,MAAM+B,gBAAkBvC,OAAOY,iBAAiB4B,KAC3CC,SAAYA,QAAQjC,eAAiBwB,WAAWxB,cAErD,GAAI+B,gBAGA,YADArC,SAAS4B,+BAA+BE,WAAWxB,cAAc,IAMnD,IAAlB8B,eACAtC,OAAOY,iBAAiB0B,cAAgBN,WACxC/B,OAAOa,6BAGPX,cAAcoB,sBACTC,MAAM,SAAUC,OACbC,OAAOC,YAAYF,MAAO,oEAIlCS,UAAUQ,WAAW,mBACrBR,UAAUQ,WAAW,gBAGrBxC,SAAS0B,sBACTxB,aAAayB,qBAQrB,SAASc,2BACL,MAAMT,UAAYC,EAAE,yBACdC,gBAAkBF,UAAUG,KAAK,mBAEnCD,iBAEAnC,OAAO2C,iBAAiBR,iBAG5BF,UAAUQ,WAAW,mBACrBR,UAAUQ,WAAW,gBAGrBxC,SAAS0B,sBACTxB,aAAayB,mBASjB,SAASlB,uBAAuBL,aAC5B,MAAMuC,YAAc7C,OAAOY,iBAAiB4B,KACvCC,SAAYA,QAAQjC,eAAiBF,YAAYE,cAGtD,OAAIqC,YAWR,SAASC,sBACL,MAAMC,OAASjD,cAAckD,kBAC7B,IAAKD,OACD,OAGJ,MAAME,IAAMF,OAAOG,eACnB,IAAIC,KAAO,GACPC,EAAIH,IAAII,GAAK,EACjB,MAAMC,YAAc,CAAC,GAAI,IAAK,MAE9B,KAAOF,GAAK,GAAG,CACX,MAAMG,KAAOR,OAAOS,uBAAuB,CAAEC,KAAMR,IAAIQ,KAAMJ,GAAID,IACjE,GAAIE,YAAYI,SAASH,MACrB,MAEJJ,KAAOI,KAAOJ,KACdC,IAGJ,MAAO,CACHD,KAAMA,KACNM,KAAMR,IAAIQ,KACVJ,GAAID,GAIZxD,QAAQkD,oBAAsBA,oBAC9BlD,QAAQS,mBAAqBA,mBAC7BT,QAAQmC,uBAAyBA,uBACjCnC,QAAQ+C,yBAA2BA","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/* global logger */\ndefine(function (require, exports, module) {\n    const EditorManager = require(\"editor/EditorManager\");\n    const Metrics = require(\"utils/Metrics\");\n\n    const Global = require(\"./global\");\n    const Helper = require(\"./helper\");\n    const UIHelper = require(\"./UIHelper\");\n    const SnippetsState = require(\"./snippetsState\");\n    const SnippetsList = require(\"./snippetsList\");\n\n    /**\n     * This function handles the save button click handler\n     * it does all the chores like fetching the data from the required fields, adding it to snippet list and all that\n     */\n    function handleSaveBtnClick() {\n        const snippetData = Helper.getSnippetData();\n\n        if (!snippetData.abbreviation || !snippetData.abbreviation.trim()) {\n            return;\n        }\n        if (!snippetData.templateText || !snippetData.templateText.trim()) {\n            return;\n        }\n\n        if (shouldAddSnippetToList(snippetData)) {\n            Global.SnippetHintsList.push(snippetData);\n            Helper.rebuildOptimizedStructures();\n            Helper.clearAllInputFields();\n            Helper.toggleSaveButtonDisability();\n\n            // snippet creating metrics\n            const fileCategory = Helper.categorizeFileExtensionForMetrics(snippetData.fileExtension);\n            Metrics.countEvent(Metrics.EVENT_TYPE.EDITOR, \"snipt\", `add.${fileCategory}`);\n\n            // save to file storage\n            SnippetsState.saveSnippetsToState()\n                .catch(function (error) {\n                    logger.reportError(error, \"Custom Snippets: failed to save new snippet to file storage\");\n                });\n\n            // we need to move back to snippets list view after a snippet is saved\n            UIHelper.showSnippetListMenu();\n            SnippetsList.showSnippetsList();\n        } else {\n            // false since this is from addSnippet and not from editSnippet\n            UIHelper.showDuplicateAbbreviationError(snippetData.abbreviation, false);\n        }\n    }\n\n    /**\n     * This function handles the save button click for editing a snippet\n     */\n    function handleEditSaveBtnClick() {\n        const editedData = Helper.getEditSnippetData();\n        const $editView = $(\"#custom-snippets-edit\");\n        const originalSnippet = $editView.data(\"originalSnippet\");\n        const snippetIndex = $editView.data(\"snippetIndex\");\n\n        if (!editedData.abbreviation || !editedData.abbreviation.trim()) {\n            return;\n        }\n        if (!editedData.templateText || !editedData.templateText.trim()) {\n            return;\n        }\n\n        // check if abbreviation changed and if new abbreviation already exists\n        if (editedData.abbreviation !== originalSnippet.abbreviation) {\n            const existingSnippet = Global.SnippetHintsList.find(\n                (snippet) => snippet.abbreviation === editedData.abbreviation\n            );\n            if (existingSnippet) {\n                // true since this is from editSnippet and not from addSnippet\n                UIHelper.showDuplicateAbbreviationError(editedData.abbreviation, true);\n                return;\n            }\n        }\n\n        // update the snippet in the list\n        if (snippetIndex !== -1) {\n            Global.SnippetHintsList[snippetIndex] = editedData;\n            Helper.rebuildOptimizedStructures();\n\n            // save to file storage\n            SnippetsState.saveSnippetsToState()\n                .catch(function (error) {\n                    logger.reportError(error, \"Custom Snippets: failed to save edited snippet to file storage\");\n                });\n\n            // clear the stored data\n            $editView.removeData(\"originalSnippet\");\n            $editView.removeData(\"snippetIndex\");\n\n            // go back to snippets list\n            UIHelper.showSnippetListMenu();\n            SnippetsList.showSnippetsList();\n        }\n    }\n\n    /**\n     * This function is responsible to handle the cancel button click in the edit-snippet panel\n     * this resets the format to the last saved values and then moves back to the snippets-list panel\n     */\n    function handleCancelEditBtnClick() {\n        const $editView = $(\"#custom-snippets-edit\");\n        const originalSnippet = $editView.data(\"originalSnippet\");\n\n        if (originalSnippet) {\n            // restore original data in the form to reset any changes\n            Helper.populateEditForm(originalSnippet);\n        }\n\n        $editView.removeData(\"originalSnippet\");\n        $editView.removeData(\"snippetIndex\");\n\n        // navigate back to snippets list\n        UIHelper.showSnippetListMenu();\n        SnippetsList.showSnippetsList();\n    }\n\n    /**\n     * This function is to check whether we can add the new snippet to the snippets list\n     * because we don't want to add the new snippet if a snippet already exists with the same abbreviation\n     * @param   {object}  snippetData - the snippet data object\n     * @returns {boolean} - true if we can add the new snippet to the list otherwise false\n     */\n    function shouldAddSnippetToList(snippetData) {\n        const matchedItem = Global.SnippetHintsList.find(\n            (snippet) => snippet.abbreviation === snippetData.abbreviation\n        );\n\n        if (matchedItem) {\n            return false;\n        }\n        return true;\n    }\n\n    /**\n     * This function is responsible to get the word before the cursor\n     * this is required to check whether something matches the snippet list\n     * @returns {object} - an object in the format {word: 'pluto', line: 10, ch: 2}\n     */\n    function getWordBeforeCursor() {\n        const editor = EditorManager.getActiveEditor();\n        if (!editor) {\n            return;\n        }\n\n        const pos = editor.getCursorPos();\n        let word = \"\"; // this will store the actual word before the cursor\n        let i = pos.ch - 1; // index of the char right before the cursor\n        const breakWordAt = [\"\", \" \", \"\\t\"]; // we need to break the loop when we encounter this char's\n\n        while (i >= 0) {\n            const char = editor.getCharacterAtPosition({ line: pos.line, ch: i });\n            if (breakWordAt.includes(char)) {\n                break;\n            }\n            word = char + word;\n            i--;\n        }\n\n        return {\n            word: word,\n            line: pos.line,\n            ch: i\n        };\n    }\n\n    exports.getWordBeforeCursor = getWordBeforeCursor;\n    exports.handleSaveBtnClick = handleSaveBtnClick;\n    exports.handleEditSaveBtnClick = handleEditSaveBtnClick;\n    exports.handleCancelEditBtnClick = handleCancelEditBtnClick;\n});\n"],"file":"driver.js"}