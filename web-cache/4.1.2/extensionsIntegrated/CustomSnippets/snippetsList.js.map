{"version":3,"sources":["extensionsIntegrated/CustomSnippets/snippetsList.js"],"names":["define","require","exports","module","StringUtils","Metrics","Global","SnippetsState","UIHelper","FilterSnippets","Helper","Strings","_createSnippetItem","snippetItem","$snippetItem","$","attr","abbreviation","addClass","$snippetAbbr","text","format","CUSTOM_SNIPPETS_EDIT_ABBR_TOOLTIP","$snippetTemplate","templateText","CUSTOM_SNIPPETS_EDIT_TEMPLATE_TOOLTIP","$snippetDescription","description","trim","CUSTOM_SNIPPETS_NO_DESCRIPTION","CUSTOM_SNIPPETS_EDIT_DESC_TOOLTIP","CUSTOM_SNIPPETS_ADD_DESC_TOOLTIP","$snippetFiles","fileExtension","CUSTOM_SNIPPETS_EDIT_FILE_EXT_TOOLTIP","$deleteSnippet","html","append","data","_registerHandlers","_showEmptyState","showEmptySnippetMessage","hideSnippetsListHeader","$emptyMessage","$filterInput","filterText","val","CUSTOM_SNIPPETS_NO_MATCHES","CUSTOM_SNIPPETS_LEARN_MORE","_renderSnippetsList","filteredSnippets","showSnippetsList","showSnippetsListHeader","forEach","clearSnippetsList","snippetList","SnippetHintsList","length","filterSnippets","deleteSnippet","this","closest","index","findIndex","s","fileCategory","categorizeFileExtensionForMetrics","countEvent","EVENT_TYPE","EDITOR","splice","rebuildOptimizedStructures","saveSnippetsToState","catch","error","console","updateSnippetsCount","$snippetsListWrapper","off","on","e","stopPropagation","call","target","editSnippet","populateEditForm","showEditSnippetMenu","toggleEditSaveButtonDisability"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*\n * This file handles the display and management of the snippets list that is shown in the UI\n * Note: when there are no snippets present, a message like no snippets are added yet is shown. refer to the html file\n */\n\n/* eslint-disable no-invalid-this */\ndefine(function (require, exports, module) {\n    const StringUtils = require(\"utils/StringUtils\");\n    const Metrics = require(\"utils/Metrics\");\n\n    const Global = require(\"./global\");\n    const SnippetsState = require(\"./snippetsState\");\n    const UIHelper = require(\"./UIHelper\");\n    const FilterSnippets = require(\"./filterSnippets\");\n    const Helper = require(\"./helper\");\n    const Strings = require(\"strings\");\n\n    /**\n     * This function is responsible to create a snippet item\n     * refer to html file for the structure of the snippet item\n     * @private\n     * @param {object} snippetItem\n     */\n    function _createSnippetItem(snippetItem) {\n        // the main snippet item container,\n        // all the items like abbr, description and all that will be appended into this\n        const $snippetItem = $(\"<div>\").attr(\"data-abbr\", snippetItem.abbreviation).addClass(\"snippet-item\");\n\n        const $snippetAbbr = $(\"<div>\")\n            .text(snippetItem.abbreviation)\n            .attr(\"id\", \"snippet-abbr\")\n            .attr(\"title\", StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_ABBR_TOOLTIP, snippetItem.abbreviation));\n\n        const $snippetTemplate = $(\"<div>\")\n            .text(snippetItem.templateText)\n            .attr(\"id\", \"snippet-template\")\n            .attr(\"title\", StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_TEMPLATE_TOOLTIP, snippetItem.templateText));\n\n        const $snippetDescription = $(\"<div>\")\n            .text(\n                snippetItem.description && snippetItem.description.trim() !== \"\"\n                    ? snippetItem.description\n                    : Strings.CUSTOM_SNIPPETS_NO_DESCRIPTION\n            )\n            .attr(\"id\", \"snippet-description\")\n            .attr(\n                \"title\",\n                snippetItem.description && snippetItem.description.trim() !== \"\"\n                    ? StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_DESC_TOOLTIP, snippetItem.description)\n                    : Strings.CUSTOM_SNIPPETS_ADD_DESC_TOOLTIP\n            );\n\n        const $snippetFiles = $(\"<div>\")\n            .text(snippetItem.fileExtension || \"all\")\n            .attr(\"id\", \"snippet-files\")\n            .attr(\"title\", StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_FILE_EXT_TOOLTIP, snippetItem.fileExtension || \"all\"));\n\n        const $deleteSnippet = $(\"<div>\")\n            .html(`<i class=\"fas fa-trash\"></i>`)\n            .attr(\"id\", \"delete-snippet-btn\")\n            .addClass(\"delete-snippet-btn\");\n\n        $snippetItem.append($snippetAbbr, $snippetTemplate, $snippetDescription, $snippetFiles, $deleteSnippet);\n        $snippetItem.data(\"snippet\", snippetItem); // store full object. this is needed for deletion purposes\n\n        // finally when the snippet item is ready, we append it to the snippets-list-wrapper\n        $(\"#snippets-list-wrapper\").append($snippetItem);\n\n        // here we register the delete button click handler\n        _registerHandlers();\n    }\n\n    /**\n     * Shows the appropriate empty state message based on context\n     * the context might be either one of the two cases:\n     * when no snippets are added\n     * or\n     * when no snippets match the filtered text\n     * @private\n     */\n    function _showEmptyState() {\n        UIHelper.showEmptySnippetMessage();\n        UIHelper.hideSnippetsListHeader();\n        const $emptyMessage = $(\"#no-snippets-message\");\n        const $filterInput = $(\"#filter-snippets-input\");\n        const filterText = $filterInput.val().trim();\n\n        if (filterText) {\n            $emptyMessage.text(StringUtils.format(Strings.CUSTOM_SNIPPETS_NO_MATCHES, filterText));\n        } else {\n            $emptyMessage.html(Strings.CUSTOM_SNIPPETS_LEARN_MORE);\n        }\n    }\n\n    /**\n     * this function is responsible to render the filtered snippets list\n     * @private\n     * @param {Array} filteredSnippets - array of filtered snippet objects\n     */\n    function _renderSnippetsList(filteredSnippets) {\n        UIHelper.showSnippetsList(); // show the snippets list wrapper\n        UIHelper.showSnippetsListHeader(); // show header when there are snippets to display\n\n        // add each filtered snippet to the list\n        filteredSnippets.forEach(function (snippetItem) {\n            _createSnippetItem(snippetItem);\n        });\n    }\n\n    /**\n     * This function is called when the user clicks on the custom snippets button from the file menu\n     * this also gets called when user clicks on the 'back' button to move back to the snippets list menu\n     * refer to '_registerHandlers' function inside the main.js file\n     */\n    function showSnippetsList() {\n        UIHelper.clearSnippetsList(); // clear existing snippets list, as we'll rebuild it\n        const snippetList = Global.SnippetHintsList; // get the list of snippets\n\n        // handle empty snippets case\n        if (snippetList.length === 0) {\n            _showEmptyState();\n            return;\n        }\n\n        // apply the filtering and get results\n        const filteredSnippets = FilterSnippets.filterSnippets(snippetList);\n\n        // if there are no matches after filtering\n        if (filteredSnippets.length === 0) {\n            _showEmptyState();\n            return;\n        }\n\n        // render the filtered snippets\n        _renderSnippetsList(filteredSnippets);\n    }\n\n    /**\n     * This function is responsible to delete the snippet for which delete button was clicked\n     */\n    function deleteSnippet() {\n        // get the element\n        const $snippetItem = $(this).closest(\".snippet-item\");\n        const snippetItem = $snippetItem.data(\"snippet\"); // this gives the actual object with all the keys and vals\n\n        const index = Global.SnippetHintsList.findIndex((s) => s.abbreviation === snippetItem.abbreviation);\n\n        if (index !== -1) {\n            // track the snippet deletion metrics before removing\n            const fileCategory = Helper.categorizeFileExtensionForMetrics(snippetItem.fileExtension);\n            Metrics.countEvent(Metrics.EVENT_TYPE.EDITOR, \"snipt\", `del.${fileCategory}`);\n\n            Global.SnippetHintsList.splice(index, 1); // removes it from the actual array\n            Helper.rebuildOptimizedStructures();\n\n            // save to file storage\n            SnippetsState.saveSnippetsToState()\n                .catch(function (error) {\n                    console.error(\"failed to delete custom snippet correctly:\", error);\n                });\n\n            // update the snippets count in toolbar\n            Helper.updateSnippetsCount();\n            // Refresh the entire list to properly handle filtering\n            showSnippetsList();\n        }\n    }\n\n    /**\n     * This function is responsible to register the delete snippet button handler\n     * @private\n     */\n    function _registerHandlers() {\n        const $snippetsListWrapper = $(\"#snippets-list-wrapper\");\n\n        $snippetsListWrapper.off(\"click.deleteSnippet\");\n        $snippetsListWrapper.on(\"click.deleteSnippet\", \".delete-snippet-btn\", function (e) {\n            e.stopPropagation(); // prevent triggering the edit handler\n            deleteSnippet.call(this);\n        });\n\n        // Use event delegation for snippet item clicks to enable editing\n        $snippetsListWrapper.off(\"click.editSnippet\");\n        $snippetsListWrapper.on(\"click.editSnippet\", \".snippet-item\", function (e) {\n            // don't trigger edit if clicking on delete button\n            if ($(e.target).closest(\".delete-snippet-btn\").length === 0) {\n                editSnippet.call(this);\n            }\n        });\n    }\n\n    /**\n     * This function handles editing a snippet when the snippet item is clicked\n     */\n    function editSnippet() {\n        // get the snippet data from the clicked item\n        const $snippetItem = $(this).closest(\".snippet-item\");\n        const snippetItem = $snippetItem.data(\"snippet\");\n\n        // populate the edit form with current snippet data\n        Helper.populateEditForm(snippetItem);\n\n        // store the original data for reset functionality\n        $(\"#custom-snippets-edit\").data(\"originalSnippet\", snippetItem);\n        $(\"#custom-snippets-edit\").data(\n            \"snippetIndex\",\n            Global.SnippetHintsList.findIndex((s) => s.abbreviation === snippetItem.abbreviation)\n        );\n\n        // show the edit form\n        UIHelper.showEditSnippetMenu();\n\n        // enable the save button based on current data\n        Helper.toggleEditSaveButtonDisability();\n    }\n\n    exports.showSnippetsList = showSnippetsList;\n    exports.deleteSnippet = deleteSnippet;\n    exports.editSnippet = editSnippet;\n});\n"],"file":"snippetsList.js"}