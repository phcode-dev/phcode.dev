{"version":3,"sources":["extensionsIntegrated/CustomSnippets/codeHintIntegration.js"],"names":["define","require","exports","module","CodeHintManager","EditorManager","Metrics","Global","Driver","Helper","SnippetCursorManager","CustomSnippetsHandler","hasHints","editor","implicitChar","needle","getWordBeforeCursor","word","hasMatch","hasExactMatchingSnippet","toLowerCase","e","getHints","matchingSnippets","getMatchingSnippets","length","customSnippetHints","map","snippet","createHintItem","abbreviation","description","hints","selectInitial","handleWideResults","console","log","insertHint","hint","jquery","attr","SnippetHintsList","matchedSnippet","find","getFocusedEditor","fileCategory","categorizeFileExtensionForMetrics","fileExtension","countEvent","EVENT_TYPE","EDITOR","wordInfo","start","line","ch","end","getCursorPos","insertSnippetWithTabStops","templateText","init","showHintsAtTop"],"mappings":"AAoBAA,OAAO,SAAUC,QAASC,QAASC,QAC/B,MAAMC,gBAAkBH,QAAQ,0BAC1BI,cAAgBJ,QAAQ,wBACxBK,QAAUL,QAAQ,iBAElBM,OAASN,QAAQ,YACjBO,OAASP,QAAQ,YACjBQ,OAASR,QAAQ,YACjBS,qBAAuBT,QAAQ,0BAM/BU,sBAAwB,CAO1BC,SAAU,SAAUC,OAAQC,cAExB,GAAqB,OAAjBA,aACA,OAAO,EAGX,IACI,MAAMC,OAASP,OAAOQ,sBACtB,IAAKD,SAAWA,OAAOE,KACnB,OAAO,EAIX,MAAMC,SAAWT,OAAOU,wBAAwBJ,OAAOE,KAAKG,cAAeP,QAC3E,OAAOK,SACT,MAAOG,GACL,OAAO,IAUfC,SAAU,SAAUT,OAAQC,cACxB,IACI,MAAMC,OAASP,OAAOQ,sBACtB,IAAKD,SAAWA,OAAOE,KACnB,OAAO,KAGX,MAAMA,KAAOF,OAAOE,KAAKG,cAGzB,IAAKX,OAAOU,wBAAwBF,KAAMJ,QACtC,OAAO,KAIX,MAAMU,iBAAmBd,OAAOe,oBAAoBP,KAAMJ,QAE1D,GAAIU,iBAAiBE,OAAS,EAAG,CAC7B,MAAMC,mBAAqBH,iBAAiBI,IAAKC,SACtCnB,OAAOoB,eAAeD,QAAQE,aAAcf,OAAOE,KAAMW,QAAQG,cAG5E,MAAO,CACHC,MAAON,mBACPO,eAAe,EACfC,mBAAmB,IAG7B,MAAOb,GACLc,QAAQC,IAAI,iCAAkCf,GAGlD,OAAO,MAQXgB,WAAY,SAAUC,MAElB,GAAIA,MAAQA,KAAKC,QAAUD,KAAKE,KAAK,wBAAyB,CAE1D,MAAMV,aAAeQ,KAAKE,KAAK,YAC/B,GAAIjC,OAAOkC,iBAAkB,CACzB,MAAMC,eAAiBnC,OAAOkC,iBAAiBE,KAC1Cf,SAAYA,QAAQE,eAAiBA,cAE1C,GAAIY,eAAgB,CAEhB,MAAM7B,OAASR,cAAcuC,mBAE7B,GAAI/B,OAAQ,CAER,MAAMgC,aAAepC,OAAOqC,kCAAkCJ,eAAeK,eAC7EzC,QAAQ0C,WAAW1C,QAAQ2C,WAAWC,OAAQ,eAAgBL,gBAG9D,MAAMM,SAAW3C,OAAOQ,sBAClBoC,MAAQ,CAAEC,KAAMF,SAASE,KAAMC,GAAIH,SAASG,GAAK,GACjDC,IAAM1C,OAAO2C,eAQnB,OANA9C,qBAAqB+C,0BACjB5C,OACA6B,eAAegB,aACfN,MACAG,MAEG,KAMvB,OAAO,IAQf,SAASI,OAELvD,gBAAgBwD,eAAejD,uBAGnCT,QAAQyD,KAAOA","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\ndefine(function (require, exports, module) {\n    const CodeHintManager = require(\"editor/CodeHintManager\");\n    const EditorManager = require(\"editor/EditorManager\");\n    const Metrics = require(\"utils/Metrics\");\n\n    const Global = require(\"./global\");\n    const Driver = require(\"./driver\");\n    const Helper = require(\"./helper\");\n    const SnippetCursorManager = require(\"./snippetCursorManager\");\n\n    /**\n     * Handler object for the CodeHintManager API\n     * This provides the interface for showing custom snippets at the top of hint lists\n     */\n    const CustomSnippetsHandler = {\n        /**\n         * Determines whether any custom snippets hints are available\n         * @param {Editor} editor - The current editor instance\n         * @param {string} implicitChar - The last character typed (null if explicit request)\n         * @return {boolean} - true if hints are available, false otherwise\n         */\n        hasHints: function (editor, implicitChar) {\n            // We only show hints for implicit requests (when user is typing)\n            if (implicitChar === null) {\n                return false;\n            }\n\n            try {\n                const needle = Driver.getWordBeforeCursor();\n                if (!needle || !needle.word) {\n                    return false;\n                }\n\n                // Check if there's at least one exact match using language context detection\n                const hasMatch = Helper.hasExactMatchingSnippet(needle.word.toLowerCase(), editor);\n                return hasMatch;\n            } catch (e) {\n                return false;\n            }\n        },\n\n        /**\n         * Get custom snippet hints to show at the top of the hint list\n         * @param {Editor} editor - The current editor instance\n         * @param {string} implicitChar - The last character typed (null if explicit request)\n         * @return {Object} - The hint response object with hints array\n         */\n        getHints: function (editor, implicitChar) {\n            try {\n                const needle = Driver.getWordBeforeCursor();\n                if (!needle || !needle.word) {\n                    return null;\n                }\n\n                const word = needle.word.toLowerCase();\n\n                // Check if there's at least one exact match using language context detection\n                if (!Helper.hasExactMatchingSnippet(word, editor)) {\n                    return null;\n                }\n\n                // Get all matching snippets using language context detection\n                const matchingSnippets = Helper.getMatchingSnippets(word, editor);\n\n                if (matchingSnippets.length > 0) {\n                    const customSnippetHints = matchingSnippets.map((snippet) => {\n                        return Helper.createHintItem(snippet.abbreviation, needle.word, snippet.description);\n                    });\n\n                    return {\n                        hints: customSnippetHints,\n                        selectInitial: true,\n                        handleWideResults: false\n                    };\n                }\n            } catch (e) {\n                console.log(\"Error getting custom snippets:\", e);\n            }\n\n            return null;\n        },\n\n        /**\n         * Handle insertion of custom snippet hints\n         * @param {jQuery} hint - The selected hint element\n         * @return {boolean} - true if handled, false otherwise\n         */\n        insertHint: function (hint) {\n            // check if the hint is a custom snippet\n            if (hint && hint.jquery && hint.attr(\"data-isCustomSnippet\")) {\n                // handle custom snippet insertion\n                const abbreviation = hint.attr(\"data-val\");\n                if (Global.SnippetHintsList) {\n                    const matchedSnippet = Global.SnippetHintsList.find(\n                        (snippet) => snippet.abbreviation === abbreviation\n                    );\n                    if (matchedSnippet) {\n                        // Get current editor from EditorManager since it's not passed\n                        const editor = EditorManager.getFocusedEditor();\n\n                        if (editor) {\n                            // to track the usage metrics\n                            const fileCategory = Helper.categorizeFileExtensionForMetrics(matchedSnippet.fileExtension);\n                            Metrics.countEvent(Metrics.EVENT_TYPE.EDITOR, \"snipt\", `use.${fileCategory}`);\n\n                            // replace the typed abbreviation with the template text using cursor manager\n                            const wordInfo = Driver.getWordBeforeCursor();\n                            const start = { line: wordInfo.line, ch: wordInfo.ch + 1 };\n                            const end = editor.getCursorPos();\n\n                            SnippetCursorManager.insertSnippetWithTabStops(\n                                editor,\n                                matchedSnippet.templateText,\n                                start,\n                                end\n                            );\n                            return true; // handled\n                        }\n                    }\n                }\n            }\n\n            return false; // not handled\n        }\n    };\n\n    /**\n     * Initialize the code hint integration\n     * This should be called during extension initialization\n     */\n    function init() {\n        // Register our handler with the CodeHintManager API\n        CodeHintManager.showHintsAtTop(CustomSnippetsHandler);\n    }\n\n    exports.init = init;\n});\n"],"file":"codeHintIntegration.js"}