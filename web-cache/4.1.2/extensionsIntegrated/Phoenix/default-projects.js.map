{"version":3,"sources":["extensionsIntegrated/Phoenix/default-projects.js"],"names":["define","require","exports","module","ProjectManager","Strings","FileSystem","ZipUtils","async","setupStartupProject","forceCreate","console","log","getWelcomeProjectPath","exists","Phoenix","VFS","existsAsync","unzipURLToLocation","indexHtmlPath","fs","readFile","err","text","includes","error","newText","replace","DEFAULT_PROJECT_HTML_CLICK_HERE","writeFile","writErr","removeOffendingFile","offendingFilePath","getExploreProjectPath","getFileForPath","unlink","setupExploreProject","exploreProjectPath","init","firstBoot","isNativeApp"],"mappings":"AAsBAA,OAAO,SAAUC,QAASC,QAASC,QAC/B,MAAMC,eAA0BH,QAAQ,0BACpCI,QAAcJ,QAAQ,WACtBK,WAAaL,QAAQ,yBACrBM,SAAWN,QAAQ,kBAEvBO,eAAeC,oBAAoBC,aAE/B,GADAC,QAAQC,IAAI,6BAA8BR,eAAeS,0BACrDH,YAAY,CACZ,IAAII,OACJ,SADmBC,QAAQC,IAAIC,YAAYb,eAAeS,yBAGtD,YADAF,QAAQC,IAAI,wCAAyCR,eAAeS,+BAItEN,SAASW,mBAAmB,gCAAiCd,eAAeS,yBAClF,MAAMM,iBAAmBf,eAAeS,oCACxCO,GAAGC,SAASF,cAAe,OAAQ,SAAUG,IAAKC,MAC9C,GAAGD,MAAQC,KACP,OAEJ,IAAIA,KAAKC,SAAS,cAEd,YADAb,QAAQc,MAAM,wDAGlB,MAAMC,QAAUH,KAAKI,QAAQ,aAActB,QAAQuB,iCACnDR,GAAGS,UAAUV,cAAeO,QAAS,OAASI,UACvCA,SACCnB,QAAQc,MAAM,+CAAgDK,aAY9EtB,eAAeuB,sBACX,IAAIC,kBAAoB5B,eAAe6B,wBAA0B,wBAC7DnB,aAAeC,QAAQC,IAAIC,YAAYe,oBAEvC1B,WAAW4B,eAAeF,mBAAmBG,SAIrD3B,eAAe4B,sBACX,IAAIC,mBAAqBjC,eAAe6B,wBACpCnB,aAAeC,QAAQC,IAAIC,YAAYoB,sBAEvC1B,QAAQC,IAAI,6BAA8ByB,0BACpC9B,SAASW,mBAAmB,qCAAsCmB,qBAIhFnC,QAAQkC,oBAAsBA,oBAC9BlC,QAAQO,oBAAsBA,oBAE9BP,QAAQoC,KAAO9B,iBACRO,QAAQwB,WACP9B,qBAAoB,GAEpBM,QAAQyB,aAKRJ,sBAEJL","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*globals Phoenix, JSZip, Filer, fs*/\n\ndefine(function (require, exports, module) {\n    const ProjectManager          = require(\"project/ProjectManager\"),\n        Strings     = require(\"strings\"),\n        FileSystem = require(\"filesystem/FileSystem\"),\n        ZipUtils = require(\"utils/ZipUtils\");\n\n    async function setupStartupProject(forceCreate) {\n        console.log(\"setting up startup project\", ProjectManager.getWelcomeProjectPath());\n        if(!forceCreate){\n            let exists = await Phoenix.VFS.existsAsync(ProjectManager.getWelcomeProjectPath());\n            if(exists){\n                console.log(\"Startup project already exists, using\", ProjectManager.getWelcomeProjectPath());\n                return;\n            }\n        }\n        await ZipUtils.unzipURLToLocation('assets/default-project/en.zip', ProjectManager.getWelcomeProjectPath());\n        const indexHtmlPath = `${ProjectManager.getWelcomeProjectPath()}index.html`;\n        fs.readFile(indexHtmlPath, 'utf8', function (err, text) {\n            if(err || !text){\n                return;\n            }\n            if(!text.includes(\"CLICK_HERE\")){\n                console.error(\"Default project index.html doesnt have CLICK_HERE!!!\");\n                return;\n            }\n            const newText = text.replace(\"CLICK_HERE\", Strings.DEFAULT_PROJECT_HTML_CLICK_HERE);\n            fs.writeFile(indexHtmlPath, newText, 'utf8', (writErr)=>{\n                if(writErr){\n                    console.error(\"Error translating default project index.html\", writErr);\n                }\n            });\n        });\n    }\n\n    /**\n     * https://github.com/orgs/phcode-dev/discussions/1930\n     * Strange_insults.html uses some words inappropriate for a school setting. so we delete the file as well\n     * as it was installed wrongly previously.\n     * This code can be removed after June 2025 to give 6 months for users to update.\n     */\n    async function removeOffendingFile() {\n        let offendingFilePath = ProjectManager.getExploreProjectPath() + \"/strange_insults.html\";\n        let exists = await Phoenix.VFS.existsAsync(offendingFilePath);\n        if(exists){\n            FileSystem.getFileForPath(offendingFilePath).unlink();\n        }\n    }\n\n    async function setupExploreProject() {\n        let exploreProjectPath = ProjectManager.getExploreProjectPath();\n        let exists = await Phoenix.VFS.existsAsync(exploreProjectPath);\n        if(!exists){\n            console.log(\"setting up explore project\", exploreProjectPath);\n            await ZipUtils.unzipURLToLocation('assets/sample-projects/explore.zip', exploreProjectPath);\n        }\n    }\n\n    exports.setupExploreProject = setupExploreProject;\n    exports.setupStartupProject = setupStartupProject;\n\n    exports.init = async function () {\n        if(Phoenix.firstBoot){\n            setupStartupProject(true);\n        }\n        if(!Phoenix.isNativeApp) {\n            // in browsers, we do this as the user wont see the explore project in documents folder anyway and will\n            // help in improved ux of fast project open. In desktop, we got complaint that users document dir is getting\n            // polluted with unwanted projects, so we dont do this on desktop and only create this when user explicitly\n            // clicks to open explore project.\n            setupExploreProject();\n        }\n        removeOffendingFile();\n    };\n});\n"],"file":"default-projects.js"}