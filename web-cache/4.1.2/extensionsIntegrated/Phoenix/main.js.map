{"version":3,"sources":["extensionsIntegrated/Phoenix/main.js"],"names":["define","require","exports","module","serverSync","newProject","defaultProjects","newFeature","AppInit","Strings","Dialogs","NotificationUI","DefaultDialogs","PERSIST_STORAGE_DIALOG_DELAY_SECS","_showUnSupportedBrowserDialogue","Phoenix","browser","isMobile","isTablet","showModalDialog","DIALOG_ID_ERROR","UNSUPPORTED_BROWSER_MOBILE_TITLE","UNSUPPORTED_BROWSER_MOBILE","UNSUPPORTED_BROWSER_TITLE","UNSUPPORTED_BROWSER_MESSAGE","navigator","Error","_detectUnSupportedBrowser","isTestWindow","isSupportedBrowser","desktop","isSafari","mobile","isIos","createToastFromTemplate","ATTENTION_SAFARI_USERS","ATTENTION_SAFARI_USERS_MESSAGE","dismissOnClick","toastStyle","NOTIFICATION_STYLES_CSS_CLASS","DANGER","async","_persistBrowserStorage","storage","persist","isPersisted","persisted","console","log","setTimeout","isNativeApp","error","appReady","isSpecRunnerWindow","init"],"mappings":"AAwBAA,OAAO,SAAUC,QAASC,QAASC,QAC/B,MAAMC,WAAeH,QAAQ,gBACzBI,WAAeJ,QAAQ,iBACvBK,gBAAoBL,QAAQ,sBAC5BM,WAAeN,QAAQ,0BACvBO,QAAeP,QAAQ,iBACvBQ,QAAeR,QAAQ,WACvBS,QAAeT,QAAQ,mBACvBU,eAAkBV,QAAQ,0BAC1BW,eAAiBX,QAAQ,0BAEvBY,kCAAoC,IAE1C,SAASC,kCACL,GAAGC,QAAQC,QAAQC,UAAYF,QAAQC,QAAQE,SAC3CR,QAAQS,gBACJP,eAAeQ,gBACfX,QAAQY,iCACRZ,QAAQa,iCAShB,GALAZ,QAAQS,gBACJP,eAAeQ,gBACfX,QAAQc,0BACRd,QAAQe,+BAEN,kBAAmBC,WAErB,MAAM,IAAIC,MAAM,2EAIxB,SAASC,4BACFZ,QAAQa,eAGPb,QAAQc,oBACRf,mCAEDC,QAAQC,QAAQc,QAAQC,UAAYhB,QAAQC,QAAQgB,OAAOC,QAC1DtB,eAAeuB,wBAAyBzB,QAAQ0B,uBAC5C1B,QAAQ2B,+BAAgC,CACpCC,gBAAgB,EAChBC,WAAY3B,eAAe4B,8BAA8BC,UAKzEC,eAAeC,yBACX,GAAGjB,UAAUkB,SAAWlB,UAAUkB,QAAQC,QAAQ,CAC9C,IAAIC,kBAAoBpB,UAAUkB,QAAQG,YAC1CC,QAAQC,2CAA2CH,eACnDI,WAAWR,UACHI,cACAE,QAAQC,IAAI,wCACZH,kBAAoBpB,UAAUkB,QAAQC,UACtCG,QAAQC,2CAA2CH,iBAExDhC,wCACIE,QAAQmC,cACfH,QAAQI,MAAM,qDACdrC,mCAIRN,QAAQ4C,SAAS,WACVrC,QAAQsC,qBAGXjD,WAAWkD,OACXhD,gBAAgBgD,OAChBjD,WAAWiD,OACX/C,WAAW+C,OACX3B,4BACAe","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*eslint no-console: 0*/\n/*eslint strict: [\"error\", \"global\"]*/\n/* jshint ignore:start */\n\ndefine(function (require, exports, module) {\n    const serverSync   = require(\"./serverSync\"),\n        newProject   = require(\"./new-project\"),\n        defaultProjects   = require(\"./default-projects\"),\n        newFeature   = require(\"./newly-added-features\"),\n        AppInit      = require(\"utils/AppInit\"),\n        Strings      = require(\"strings\"),\n        Dialogs      = require(\"widgets/Dialogs\"),\n        NotificationUI  = require(\"widgets/NotificationUI\"),\n        DefaultDialogs = require(\"widgets/DefaultDialogs\");\n\n    const PERSIST_STORAGE_DIALOG_DELAY_SECS = 60000;\n\n    function _showUnSupportedBrowserDialogue() {\n        if(Phoenix.browser.isMobile || Phoenix.browser.isTablet){\n            Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                Strings.UNSUPPORTED_BROWSER_MOBILE_TITLE,\n                Strings.UNSUPPORTED_BROWSER_MOBILE\n            );\n            return;\n        }\n        Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_ERROR,\n            Strings.UNSUPPORTED_BROWSER_TITLE,\n            Strings.UNSUPPORTED_BROWSER_MESSAGE\n        );\n        if (!(\"serviceWorker\" in navigator)) {\n            // service worker is required for phcode to work\n            throw new Error(\"Service worker is not supported by the browser. Phcode cannot continue.\");\n        }\n    }\n\n    function _detectUnSupportedBrowser() {\n        if(Phoenix.isTestWindow) {\n            return;\n        }\n        if(!Phoenix.isSupportedBrowser){\n            _showUnSupportedBrowserDialogue();\n        }\n        if(Phoenix.browser.desktop.isSafari || Phoenix.browser.mobile.isIos) {\n            NotificationUI.createToastFromTemplate( Strings.ATTENTION_SAFARI_USERS,\n                Strings.ATTENTION_SAFARI_USERS_MESSAGE, {\n                    dismissOnClick: false,\n                    toastStyle: NotificationUI.NOTIFICATION_STYLES_CSS_CLASS.DANGER\n                });\n        }\n    }\n\n    async function _persistBrowserStorage() {\n        if(navigator.storage && navigator.storage.persist){\n            let isPersisted = await navigator.storage.persisted();\n            console.log(`Browser Persisted storage granted?: ${isPersisted}`);\n            setTimeout(async ()=>{\n                if(!isPersisted){\n                    console.log(`Browser Persisted storage requesting`);\n                    isPersisted = await navigator.storage.persist();\n                    console.log(`Browser Persisted storage granted?: ${isPersisted}`);\n                }\n            }, PERSIST_STORAGE_DIALOG_DELAY_SECS);\n        } else if(!Phoenix.isNativeApp){\n            console.error(\"Browser does not support storage persistence APIs\");\n            _showUnSupportedBrowserDialogue();\n        }\n    }\n\n    AppInit.appReady(function () {\n        if(Phoenix.isSpecRunnerWindow){\n            return;\n        }\n        serverSync.init();\n        defaultProjects.init();\n        newProject.init();\n        newFeature.init();\n        _detectUnSupportedBrowser();\n        _persistBrowserStorage();\n    });\n});\n"],"file":"main.js"}