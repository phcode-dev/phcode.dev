{"version":3,"sources":["extensionsIntegrated/Phoenix/guided-tour.js"],"names":["define","require","exports","module","KernalModeTrust","window","Error","NotificationUI","Commands","Strings","Menus","StringUtils","KeyBindingManager","Metrics","Dialogs","Mustache","SurveyTemplate","NOTIFICATION_BACKOFF","GUIDED_TOUR_LOCAL_STORAGE_KEY","surveyLinksURL","GENERAL_SURVEY_TIME","SURVEY_PRELOAD_DELAY","POWER_USER_SURVEY_INTERVAL_DAYS","userAlreadyDidAction","PhStore","getItem","JSON","parse","version","newProjectShown","beautifyCodeShown","generalSurveyShownVersion","currentlyShowingNotification","_showBeautifyNotification","editorContextMenu","getContextMenu","ContextMenuIds","EDITOR_MENU","_showNotification","setTimeout","keyboardShortcut","getKeyBindingsDisplay","EDIT_BEAUTIFY_CODE","setItem","stringify","countEvent","EVENT_TYPE","UI","createFromTemplate","CMD_BEAUTIFY_CODE","format","BEAUTIFY_CODE_NOTIFICATION","allowedPlacements","autoCloseTimeS","dismissOnClick","done","off","EVENT_BEFORE_CONTEXT_MENU_OPEN","on","_showNewProjectNotification","START_PROJECT","NEW_PROJECT_NOTIFICATION","_showFirstUseSurvey","surveyURL","delayOverride","title","useDialog","surveyVersion","$surveyFrame","addSurveyIframe","USER","_showDialogSurvey","_showSurveyNotification","$","src","class","css","border","position","top","z-index","append","repositionIframe","$destContainer","container","offset","height","outerHeight","width","outerWidth","left","display","removeClass","observerPositionChanges","resizeObserver","ResizeObserver","observe","document","body","templateVars","positionObserver","showModalDialogUsingTemplate","render","disconnect","remove","$surveyFrameContainer","surveyUrl","createToastFromTemplate","SURVEY_TITLE_VOTE_FOR_FEATURES_YOU_WANT","toastStyle","NOTIFICATION_STYLES_CSS_CLASS","INFO","_showRepeatUserSurvey","intervalOverride","nextPowerSurveyShowDate","nextShowDate","Date","setUTCDate","getUTCDate","getTime","intervalDays","currentDate","async","_resolvePowerUserSurveyURL","surveyJson","isLoggedIn","EntitlementsManager","powerUser","paidSubscriber","isPaidSubscriber","powerUserPaid","powerUserLoggedIn","e","logger","reportError","_showSurveys","navigator","onLine","surveyJSON","fetch","json","Phoenix","isNativeApp","browser","newUser","newUserTitle","newUserShowDelayMS","newUserUseDialog","powerUserTitle","powerUserShowIntervalDays","powerUserUseDialog","powerUserSurveyURL","console","error","tourStarted","startTourIfNeeded"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global logger*/\n\ndefine(function (require, exports, module) {\n    const KernalModeTrust = window.KernalModeTrust;\n    if(!KernalModeTrust){\n        // integrated extensions will have access to kernal mode, but not external extensions\n        throw new Error(\"Guided Tour should have access to KernalModeTrust. Cannot boot without trust ring\");\n    }\n\n    const NotificationUI = require(\"widgets/NotificationUI\"),\n        Commands = require(\"command/Commands\"),\n        Strings = require(\"strings\"),\n        Menus = require(\"command/Menus\"),\n        StringUtils = require(\"utils/StringUtils\"),\n        KeyBindingManager = require(\"command/KeyBindingManager\"),\n        Metrics = require(\"utils/Metrics\"),\n        Dialogs = require(\"widgets/Dialogs\"),\n        Mustache = require(\"thirdparty/mustache/mustache\"),\n        SurveyTemplate = require(\"text!./html/survey-template.html\"),\n        NOTIFICATION_BACKOFF = 10000,\n        GUIDED_TOUR_LOCAL_STORAGE_KEY = \"guidedTourActions\";\n\n    const surveyLinksURL = \"https://updates.phcode.io/surveys.json\";\n\n    // All popup notifications will show immediately on boot, we don't want to interrupt user amidst his work\n    // by showing it at a later point in time.\n    const GENERAL_SURVEY_TIME = 1200000, // 20 min\n        SURVEY_PRELOAD_DELAY = 10000, // 10 seconds to allow the survey to preload, but not\n        // enough time to break user workflow\n        POWER_USER_SURVEY_INTERVAL_DAYS = 35;\n\n    const userAlreadyDidAction = PhStore.getItem(GUIDED_TOUR_LOCAL_STORAGE_KEY)\n        ? JSON.parse(PhStore.getItem(GUIDED_TOUR_LOCAL_STORAGE_KEY)) : {\n            version: 1,\n            newProjectShown: false,\n            beautifyCodeShown: false,\n            generalSurveyShownVersion: 0\n        };\n\n    // we should only show one notification at a time\n    let currentlyShowingNotification;\n\n    /* Order of things in first boot now:\n    *  1. First we show the popup in new project window to select default project - see the html in assets folder\n    *  2. Then after user opens default project, we show \"edit code for live preview popup\"\n    *  3. When user changes file by clicking on files panel, we show \"click here to open new project window\"\n    *     this will continue showing every session until user clicks on the new project icon\n    *  4. After about 3 minutes, the health popup will show up.\n    *  5. power user survey shows up if the user has used brackets for 3 days or 8 hours in the last two weeks after 3\n    *     minutes. This will not coincide with health popup due to the power user check.\n    *  6. After about 10 minutes, survey shows up.\n    *  // the rest are by user actions\n    *  a. When user clicks on live preview, we show \"click here to popout live preview\"\n    *  b. Beautification notification when user opened the editor context menu and have not done any beautification yet.\n    * */\n\n    // 3. Beautification notification when user opened the editor context menu for the first time\n    function _showBeautifyNotification() {\n        if(userAlreadyDidAction.beautifyCodeShown){\n            return;\n        }\n        let editorContextMenu = Menus.getContextMenu(Menus.ContextMenuIds.EDITOR_MENU);\n        function _showNotification() {\n            if(currentlyShowingNotification){\n                return;\n            }\n            setTimeout(()=>{\n                let keyboardShortcut = KeyBindingManager.getKeyBindingsDisplay(Commands.EDIT_BEAUTIFY_CODE);\n                keyboardShortcut = keyboardShortcut || \"\";\n                userAlreadyDidAction.beautifyCodeShown =  true;\n                PhStore.setItem(GUIDED_TOUR_LOCAL_STORAGE_KEY, JSON.stringify(userAlreadyDidAction));\n                Metrics.countEvent(Metrics.EVENT_TYPE.UI, \"guide\", \"beautify\");\n                currentlyShowingNotification = NotificationUI.createFromTemplate( Strings.CMD_BEAUTIFY_CODE,\n                    StringUtils.format(Strings.BEAUTIFY_CODE_NOTIFICATION, keyboardShortcut),\n                    \"editor-context-menu-edit.beautifyCode\", {\n                        allowedPlacements: ['left', 'right'],\n                        autoCloseTimeS: 15,\n                        dismissOnClick: true}\n                );\n                currentlyShowingNotification.done(()=>{\n                    currentlyShowingNotification = null;\n                });\n                editorContextMenu.off(Menus.EVENT_BEFORE_CONTEXT_MENU_OPEN, _showNotification);\n            }, 500);\n        }\n        editorContextMenu.on(Menus.EVENT_BEFORE_CONTEXT_MENU_OPEN, _showNotification);\n    }\n\n    // 3. When user changes file by clicking on files panel, we show \"click here to open new project window\"\n    // Only shown once.\n    function _showNewProjectNotification() {\n        if(userAlreadyDidAction.newProjectShown){\n            return;\n        }\n        if(currentlyShowingNotification){\n            setTimeout(_showNewProjectNotification, NOTIFICATION_BACKOFF);\n            return;\n        }\n        userAlreadyDidAction.newProjectShown =  true;\n        PhStore.setItem(GUIDED_TOUR_LOCAL_STORAGE_KEY, JSON.stringify(userAlreadyDidAction));\n        Metrics.countEvent(Metrics.EVENT_TYPE.UI, \"guide\", \"newProj\");\n        currentlyShowingNotification = NotificationUI.createFromTemplate(\n            Strings.START_PROJECT, Strings.NEW_PROJECT_NOTIFICATION,\n            \"newProject\", {\n                allowedPlacements: ['top', 'bottom'],\n                autoCloseTimeS: 15,\n                dismissOnClick: true}\n        );\n        currentlyShowingNotification.done(()=>{\n            currentlyShowingNotification = null;\n        });\n    }\n\n    function _showFirstUseSurvey(surveyURL, delayOverride, title,  useDialog) {\n        let surveyVersion = 6; // increment this if you want to show this again\n        if(userAlreadyDidAction.generalSurveyShownVersion === surveyVersion) {\n            return;\n        }\n        let $surveyFrame;\n        if(useDialog){\n            $surveyFrame = addSurveyIframe(surveyURL);\n        }\n        setTimeout(()=>{\n            if(useDialog){\n                Metrics.countEvent(Metrics.EVENT_TYPE.USER, \"survey\", \"firstDialog\", 1);\n                _showDialogSurvey($surveyFrame);\n            } else {\n                Metrics.countEvent(Metrics.EVENT_TYPE.USER, \"survey\", \"firstNotification\", 1);\n                _showSurveyNotification(surveyURL, title);\n            }\n            userAlreadyDidAction.generalSurveyShownVersion = surveyVersion;\n            PhStore.setItem(GUIDED_TOUR_LOCAL_STORAGE_KEY, JSON.stringify(userAlreadyDidAction));\n        }, delayOverride || GENERAL_SURVEY_TIME);\n    }\n\n    function addSurveyIframe(surveyURL) {\n        const $surveyFrame = $('<iframe>', {\n            src: surveyURL,\n            class: 'forced-hidden',\n            css: {\n                border: '0',\n                position: 'absolute',\n                top: 0,\n                \"z-index\": 10000\n            }\n        });\n        $('#alwaysHiddenElements').append($surveyFrame); // preload the survey to increase user responses.\n        return $surveyFrame;\n    }\n\n    function repositionIframe($surveyFrame, $destContainer) {\n        const container = $destContainer.offset();\n        const height = $destContainer.outerHeight();\n        const width = $destContainer.outerWidth();\n        $surveyFrame.css({\n            top: container.top + 'px',\n            left: container.left + 'px',\n            width: width + 'px',\n            height: height + 'px',\n            display: 'block'\n        });\n        $surveyFrame.removeClass(\"forced-hidden\");\n    }\n\n    function observerPositionChanges($surveyFrame, $destContainer) {\n        const resizeObserver = new ResizeObserver(function() {\n            repositionIframe($surveyFrame, $destContainer);\n        });\n        resizeObserver.observe(document.body);\n        return resizeObserver;\n    }\n\n    function _showDialogSurvey($surveyFrame) {\n        const templateVars = {\n            Strings: Strings\n        };\n        let positionObserver;\n        Dialogs.showModalDialogUsingTemplate(Mustache.render(SurveyTemplate, templateVars))\n            .done(()=>{\n                positionObserver && positionObserver.disconnect();\n                $surveyFrame.remove();\n            });\n        const $surveyFrameContainer = $('#surveyFrameContainer');\n        setTimeout(()=>{\n            repositionIframe($surveyFrame, $surveyFrameContainer);\n            positionObserver = observerPositionChanges($surveyFrame, $surveyFrameContainer);\n        }, 200);\n    }\n\n    function _showSurveyNotification(surveyUrl, title) {\n        NotificationUI.createToastFromTemplate(\n            title || Strings.SURVEY_TITLE_VOTE_FOR_FEATURES_YOU_WANT,\n            `<div class=\"survey-notification-popup\">\n                    <iframe src=\"${surveyUrl}\" style=\"width: 500px; height: 645px;\" frameborder=\"0\"></iframe></div>`, {\n                toastStyle: `${NotificationUI.NOTIFICATION_STYLES_CSS_CLASS.INFO} survey-notification-big forced-hidden`,\n                dismissOnClick: false\n            });\n        setTimeout(()=>{\n            $('.survey-notification-big').removeClass('forced-hidden');\n        }, SURVEY_PRELOAD_DELAY);\n    }\n\n    function _showRepeatUserSurvey(surveyURL, intervalOverride, title, useDialog) {\n        let nextPowerSurveyShowDate = userAlreadyDidAction.nextPowerSurveyShowDate;\n        if(!nextPowerSurveyShowDate){\n            // first boot, we schedule the power user survey to happen in two weeks\n            let nextShowDate = new Date();\n            nextShowDate.setUTCDate(nextShowDate.getUTCDate() + 14); // the first time repeat survey always shows up\n            // always after 2 weeks.\n            userAlreadyDidAction.nextPowerSurveyShowDate = nextShowDate.getTime();\n            PhStore.setItem(GUIDED_TOUR_LOCAL_STORAGE_KEY, JSON.stringify(userAlreadyDidAction));\n            return;\n        }\n        const intervalDays = intervalOverride || POWER_USER_SURVEY_INTERVAL_DAYS;\n        let nextShowDate = new Date(nextPowerSurveyShowDate);\n        let currentDate = new Date();\n        if(currentDate < nextShowDate){\n            return;\n        }\n        if(useDialog){\n            const $surveyFrame = addSurveyIframe(surveyURL);\n            setTimeout(()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.USER, \"survey\", \"powerDialog\", 1);\n                _showDialogSurvey($surveyFrame);\n            }, SURVEY_PRELOAD_DELAY);\n        } else {\n            Metrics.countEvent(Metrics.EVENT_TYPE.USER, \"survey\", \"powerNotification\", 1);\n            _showSurveyNotification(surveyURL, title);\n        }\n        nextShowDate.setUTCDate(nextShowDate.getUTCDate() + intervalDays);\n        userAlreadyDidAction.nextPowerSurveyShowDate = nextShowDate.getTime();\n        PhStore.setItem(GUIDED_TOUR_LOCAL_STORAGE_KEY, JSON.stringify(userAlreadyDidAction));\n    }\n\n    async function _resolvePowerUserSurveyURL(surveyJson) {\n        try {\n            const isLoggedIn = KernalModeTrust.EntitlementsManager.isLoggedIn();\n            if(!isLoggedIn) {\n                return surveyJson.powerUser;\n            }\n            const paidSubscriber = await KernalModeTrust.EntitlementsManager.isPaidSubscriber();\n            if(paidSubscriber && surveyJson.powerUserPaid) {\n                return surveyJson.powerUserPaid;\n            }\n            return surveyJson.powerUserLoggedIn || surveyJson.powerUser;\n        } catch (e) {\n            logger.reportError(e, \"Error resolving power user survey URL\");\n        }\n        return surveyJson.powerUser;\n    }\n\n    async function _showSurveys() {\n        try {\n            if(!navigator.onLine){\n                return;\n            }\n            let surveyJSON = await fetch(surveyLinksURL);\n            surveyJSON = await surveyJSON.json();\n            if(!Phoenix.isNativeApp && surveyJSON.browser) {\n                surveyJSON = {\n                    newUser: surveyJSON.browser.newUser || surveyJSON.newUser,\n                    newUserTitle: surveyJSON.browser.newUserTitle || surveyJSON.newUserTitle,\n                    newUserShowDelayMS: surveyJSON.browser.newUserShowDelayMS || surveyJSON.newUserShowDelayMS,\n                    newUserUseDialog: surveyJSON.browser.newUserUseDialog || surveyJSON.newUserUseDialog,\n                    powerUser: surveyJSON.browser.powerUser || surveyJSON.powerUser,\n                    powerUserPaid: surveyJSON.browser.powerUserPaid || surveyJSON.powerUserPaid,\n                    powerUserLoggedIn: surveyJSON.browser.powerUserLoggedIn || surveyJSON.powerUserLoggedIn,\n                    powerUserTitle: surveyJSON.browser.powerUserTitle || surveyJSON.powerUserTitle,\n                    powerUserShowIntervalDays: surveyJSON.browser.powerUserShowIntervalDays\n                        || surveyJSON.powerUserShowIntervalDays,\n                    powerUserUseDialog: surveyJSON.browser.powerUserUseDialog || surveyJSON.powerUserUseDialog\n                };\n            }\n            surveyJSON.newUser && _showFirstUseSurvey(surveyJSON.newUser, surveyJSON.newUserShowDelayMS,\n                surveyJSON.newUserTitle, surveyJSON.newUserUseDialog);\n            const powerUserSurveyURL = await _resolvePowerUserSurveyURL(surveyJSON);\n            surveyJSON.powerUser && _showRepeatUserSurvey(powerUserSurveyURL, surveyJSON.powerUserShowIntervalDays,\n                surveyJSON.powerUserTitle, surveyJSON.powerUserUseDialog);\n        } catch (e) {\n            console.error(\"Error fetching survey link\", surveyLinksURL, e);\n            Metrics.countEvent(Metrics.EVENT_TYPE.USER, \"survey\", \"fetchError\", 1);\n        }\n    }\n\n    let tourStarted = false;\n    exports.startTourIfNeeded = function () {\n        if(tourStarted) {\n            return;\n        }\n        tourStarted = true;\n        _showNewProjectNotification();\n        _showBeautifyNotification();\n        _showSurveys();\n    };\n});\n"],"file":"guided-tour.js"}