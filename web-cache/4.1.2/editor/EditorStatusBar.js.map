{"version":3,"sources":["editor/EditorStatusBar.js"],"names":["define","require","exports","module","_","AnimationUtils","AppInit","DropdownButton","EditorManager","MainViewManager","Editor","KeyEvent","LanguageManager","PreferencesManager","StatusBar","Strings","InMemoryFile","ProjectManager","Async","TaskManager","FileSystem","CommandManager","Commands","DocumentManager","StringUtils","Metrics","SupportedEncodings","fs","SUPPORTED_ENCODINGS","sort","languageSelect","encodingSelect","tasksSelect","$cursorInfo","$statusInfo","$fileInfo","$indentType","$indentAuto","$indentWidthLabel","$indentWidthInput","$statusOverwrite","LANGUAGE_SET_AS_DEFAULT","_formatCountable","number","singularStr","pluralStr","format","_updateLanguageInfo","editor","doc","lang","document","getLanguage","$button","text","getName","_updateEncodingInfo","file","_encoding","_getLineCountStr","lines","lineCount","STATUSBAR_LINE_COUNT_SINGULAR","STATUSBAR_LINE_COUNT_PLURAL","_updateFileInfo","_updateIndentType","fullPath","indentWithTabs","getUseTabChar","STATUSBAR_TAB_SIZE","STATUSBAR_SPACES","attr","STATUSBAR_INDENT_TOOLTIP_SPACES","STATUSBAR_INDENT_TOOLTIP_TABS","STATUSBAR_INDENT_SIZE_TOOLTIP_TABS","STATUSBAR_INDENT_SIZE_TOOLTIP_SPACES","_updateAutoIndent","autoIndent","getAutoTabSpaces","html","STATUSBAR_AUTO_INDENT","STATUSBAR_FIXED_INDENT","_getIndentSize","getTabSize","getSpaceUnits","_updateIndentSize","size","val","_toggleIndentType","current","getActiveEditor","setUseTabChar","_toggleAutoIndent","setAutoTabSpaces","_autoDetectTabSpaces","_updateCursorInfo","event","cursor","getCursorPos","cursorStr","STATUSBAR_CURSOR_POSITION","line","ch","cursorStrShort","STATUSBAR_CURSOR_POSITION_SHORT","sels","getSelections","selStr","shortSelStr","length","countEvent","EVENT_TYPE","EDITOR","STATUSBAR_SELECTION_MULTIPLE","STATUSBAR_SELECTION_MULTIPLE_SHORT_DO_NOT_TRANSLATE","hasSelection","sel","start","end","STATUSBAR_SELECTION_LINE_SINGULAR","STATUSBAR_SELECTION_LINE_PLURAL","STATUSBAR_SELECTION_SHORT_DO_NOT_TRANSLATE","cols","getColOffset","STATUSBAR_SELECTION_CH_SINGULAR","STATUSBAR_SELECTION_CH_PLURAL","STATUSBAR_CURSOR_GOTO","_changeIndentWidth","value","removeClass","addClass","off","focusActivePane","valInt","parseInt","setTabSize","setSpaceUnits","_updateOverwriteLabel","newstate","doNotAnimate","STATUSBAR_OVERWRITE","STATUSBAR_INSERT","animateUsingClass","_updateEditorOverwriteMode","_codeMirror","state","overwrite","toggleOverwrite","_initOverwriteMode","currentEditor","STATUSBAR_INSOVR_TOOLTIP","_onActiveEditorChange","previous","releaseRef","showAllPanes","on","window","setTimeout","addRef","hideAllPanes","_populateLanguageDropdown","languages","values","getLanguages","filter","language","isBinary","a","b","toLowerCase","localeCompare","items","unshift","_changeEncodingAndReloadDoc","promise","reload","done","readTimestamp","encoding","getViewState","STATE_PROJECT_CONTEXT","setViewState","fail","error","console","log","_populateEncodingDropdown","_init","$","click","preventDefault","stopPropagation","execute","NAVIGATE_GOTO_LINE","item","index","defaultLang","getLanguageForPath","label","escape","STATUSBAR_SET_DEFAULT_LANG","getCompoundFileExtension","enabled","STATUSBAR_DEFAULT_LANG","dropdownExtraClasses","append","STATUSBAR_LANG_TOOLTIP","STATUSBAR_ENCODING_TOOLTIP","hideSpinner","STATUSBAR_TASKS","STATUSBAR_TASKS_HIDE_SPINNER","_renderItem","_setTaskSelect","STATUSBAR_TASKS_TOOLTIP","e","selection","_onSelect","EVENT_DROPDOWN_SHOWN","evt","_onDropdownShown","focus","keyCode","DOM_VK_RETURN","blur","DOM_VK_ESCAPE","select","fileType","filelanguageName","_name","fileExtensionMap","get","getId","set","setLanguageOverrideForPath","originalPath","originalEncoding","isDirty","FILE_SAVE_AS","getCurrentDocument","_checkFileExistance","filePath","deferred","Deferred","fileEntry","getFileForPath","exists","err","resolve","reject","doSequentially","Object","keys","always","htmlReady","appReady","show"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global fs*/\n\n/**\n * Manages parts of the status bar related to the current editor's state.\n */\ndefine(function (require, exports, module) {\n\n\n    // Load dependent modules\n    const _                    = require(\"thirdparty/lodash\"),\n        AnimationUtils       = require(\"utils/AnimationUtils\"),\n        AppInit              = require(\"utils/AppInit\"),\n        DropdownButton       = require(\"widgets/DropdownButton\"),\n        EditorManager        = require(\"editor/EditorManager\"),\n        MainViewManager      = require(\"view/MainViewManager\"),\n        Editor               = require(\"editor/Editor\").Editor,\n        KeyEvent             = require(\"utils/KeyEvent\"),\n        LanguageManager      = require(\"language/LanguageManager\"),\n        PreferencesManager   = require(\"preferences/PreferencesManager\"),\n        StatusBar            = require(\"widgets/StatusBar\"),\n        Strings              = require(\"strings\"),\n        InMemoryFile         = require(\"document/InMemoryFile\"),\n        ProjectManager       = require(\"project/ProjectManager\"),\n        Async                = require(\"utils/Async\"),\n        TaskManager    = require(\"features/TaskManager\"),\n        FileSystem           = require(\"filesystem/FileSystem\"),\n        CommandManager       = require(\"command/CommandManager\"),\n        Commands             = require(\"command/Commands\"),\n        DocumentManager      = require(\"document/DocumentManager\"),\n        StringUtils          = require(\"utils/StringUtils\"),\n        Metrics              = require(\"utils/Metrics\");\n\n    const SupportedEncodings = fs.SUPPORTED_ENCODINGS.sort();\n\n    /* StatusBar indicators */\n    var languageSelect, // this is a DropdownButton instance\n        encodingSelect, // this is a DropdownButton instance\n        tasksSelect, // this is a DropdownButton instance\n        $cursorInfo,\n        $statusInfo,\n        $fileInfo,\n        $indentType,\n        $indentAuto,\n        $indentWidthLabel,\n        $indentWidthInput,\n        $statusOverwrite;\n\n    /** Special list item for the 'set as default' gesture in language switcher dropdown */\n    var LANGUAGE_SET_AS_DEFAULT = {};\n\n\n    /**\n     * Determine string based on count\n     * @param {number} number Count\n     * @param {string} singularStr Singular string\n     * @param {string} pluralStr Plural string\n     * @return {string} Proper string to use for count\n     */\n    function _formatCountable(number, singularStr, pluralStr) {\n        return StringUtils.format(number > 1 ? pluralStr : singularStr, number);\n    }\n\n    /**\n     * Update file mode\n     * @param {Editor} editor Current editor\n     */\n    function _updateLanguageInfo(editor) {\n        var doc = editor.document,\n            lang = doc.getLanguage();\n\n        // Show the current language as button title\n        languageSelect.$button.text(lang.getName());\n    }\n\n    /**\n     * Update encoding\n     * @param {Editor} editor Current editor\n     */\n    function _updateEncodingInfo(editor) {\n        var doc = editor.document;\n\n        // Show the current encoding as button title\n        if (!doc.file._encoding) {\n            doc.file._encoding = \"utf8\";\n        }\n        encodingSelect.$button.text(doc.file._encoding);\n    }\n\n    function _getLineCountStr(editor) {\n        const lines = editor.lineCount();\n        return _formatCountable(lines, Strings.STATUSBAR_LINE_COUNT_SINGULAR, Strings.STATUSBAR_LINE_COUNT_PLURAL);\n    }\n\n    /**\n     * Update file information\n     * @param {Editor} editor Current editor\n     */\n    function _updateFileInfo(editor) {\n        $fileInfo.text(_getLineCountStr(editor));\n    }\n\n    /**\n     * Update indent type and size\n     * @param {string} fullPath Path to file in current editor\n     */\n    function _updateIndentType(fullPath) {\n        var indentWithTabs = Editor.getUseTabChar(fullPath);\n        $indentType.text(indentWithTabs ? Strings.STATUSBAR_TAB_SIZE : Strings.STATUSBAR_SPACES);\n        $indentType.attr(\"title\", indentWithTabs ? Strings.STATUSBAR_INDENT_TOOLTIP_SPACES : Strings.STATUSBAR_INDENT_TOOLTIP_TABS);\n        $indentWidthLabel.attr(\"title\", indentWithTabs ? Strings.STATUSBAR_INDENT_SIZE_TOOLTIP_TABS : Strings.STATUSBAR_INDENT_SIZE_TOOLTIP_SPACES);\n    }\n\n    function _updateAutoIndent(fullPath) {\n        const autoIndent = Editor.getAutoTabSpaces(fullPath);\n        $indentAuto.html(autoIndent ? Strings.STATUSBAR_AUTO_INDENT : Strings.STATUSBAR_FIXED_INDENT);\n    }\n\n    /**\n     * Get indent size based on type\n     * @param {string} fullPath Path to file in current editor\n     * @return {number} Indent size\n     */\n    function _getIndentSize(fullPath) {\n        return Editor.getUseTabChar(fullPath) ? Editor.getTabSize(fullPath) : Editor.getSpaceUnits(fullPath);\n    }\n\n    /**\n     * Update indent size\n     * @param {string} fullPath Path to file in current editor\n     */\n    function _updateIndentSize(fullPath) {\n        var size = _getIndentSize(fullPath);\n        $indentWidthLabel.text(size);\n        $indentWidthInput.val(size);\n    }\n\n    /**\n     * Toggle indent type\n     */\n    function _toggleIndentType() {\n        var current = EditorManager.getActiveEditor(),\n            fullPath = current && current.document.file.fullPath;\n\n        Editor.setUseTabChar(!Editor.getUseTabChar(fullPath), fullPath);\n        _updateIndentType(fullPath);\n        _updateAutoIndent(fullPath);\n        _updateIndentSize(fullPath);\n    }\n\n    function _toggleAutoIndent() {\n        const current = EditorManager.getActiveEditor(),\n            fullPath = current && current.document.file.fullPath;\n        Editor.setAutoTabSpaces(!Editor.getAutoTabSpaces(fullPath), fullPath);\n        if(Editor.getAutoTabSpaces(fullPath)){\n            // if the user explicitly clicked on the auto indent status bar icon, he might mean to recompute it\n            Editor._autoDetectTabSpaces(current, true, true);\n        }\n        _updateIndentType(fullPath);\n        _updateAutoIndent(fullPath);\n        _updateIndentSize(fullPath);\n    }\n\n    /**\n     * Update cursor(s)/selection(s) information\n     * @param {Event} event (unused)\n     * @param {Editor} editor Current editor\n     */\n    function _updateCursorInfo(event, editor) {\n        editor = editor || EditorManager.getActiveEditor();\n\n        // compute columns, account for tab size\n        const cursor = editor.getCursorPos(true);\n\n        let cursorStr = StringUtils.format(Strings.STATUSBAR_CURSOR_POSITION, cursor.line + 1, cursor.ch + 1);\n        let cursorStrShort = StringUtils.format(\n            Strings.STATUSBAR_CURSOR_POSITION_SHORT, cursor.line + 1, cursor.ch + 1);\n\n        let sels = editor.getSelections(),\n            selStr = \"\",\n            shortSelStr = \"\";\n\n        if (sels.length > 1) {\n            //Send analytics data for multicursor use\n            Metrics.countEvent(\n                Metrics.EVENT_TYPE.EDITOR,\n                \"multiCursor\",\n                \"usage\"\n            );\n            selStr = StringUtils.format(Strings.STATUSBAR_SELECTION_MULTIPLE, sels.length);\n            shortSelStr = StringUtils.format(Strings.STATUSBAR_SELECTION_MULTIPLE_SHORT_DO_NOT_TRANSLATE, sels.length);\n        } else if (editor.hasSelection()) {\n            const sel = sels[0];\n            if (sel.start.line !== sel.end.line) {\n                let lines = sel.end.line - sel.start.line + 1;\n                if (sel.end.ch === 0) {\n                    lines--;  // end line is exclusive if ch is 0, inclusive otherwise\n                }\n                selStr = _formatCountable(lines, Strings.STATUSBAR_SELECTION_LINE_SINGULAR,\n                    Strings.STATUSBAR_SELECTION_LINE_PLURAL);\n                shortSelStr = StringUtils.format(Strings.STATUSBAR_SELECTION_SHORT_DO_NOT_TRANSLATE, lines);\n            } else {\n                // end ch is exclusive always\n                const cols = editor.getColOffset(sel.end) - editor.getColOffset(sel.start);\n                selStr = _formatCountable(cols, Strings.STATUSBAR_SELECTION_CH_SINGULAR,\n                    Strings.STATUSBAR_SELECTION_CH_PLURAL);\n                shortSelStr = StringUtils.format(Strings.STATUSBAR_SELECTION_SHORT_DO_NOT_TRANSLATE, cols);\n            }\n        }\n        $cursorInfo.text(cursorStrShort + shortSelStr);\n        $statusInfo.attr(\"title\", cursorStr + selStr + \" \" + _getLineCountStr(editor)+ \"\\n\" +\n            Strings.STATUSBAR_CURSOR_GOTO);\n    }\n\n    /**\n     * Change indent size\n     * @param {string} fullPath Path to file in current editor\n     * @param {string} value Size entered into status bar\n     */\n    function _changeIndentWidth(fullPath, value) {\n        $indentWidthLabel.removeClass(\"hidden\");\n        $indentWidthInput.addClass(\"hidden\");\n\n        // remove all event handlers from the input field\n        $indentWidthInput.off(\"blur keyup\");\n\n        // restore focus to the editor\n        MainViewManager.focusActivePane();\n\n        var valInt = parseInt(value, 10);\n        if (Editor.getUseTabChar(fullPath)) {\n            if (!Editor.setTabSize(valInt, fullPath)) {\n                return;     // validation failed\n            }\n        } else {\n            if (!Editor.setSpaceUnits(valInt, fullPath)) {\n                return;     // validation failed\n            }\n        }\n\n        // update indicator\n        _updateIndentSize(fullPath);\n\n        // column position may change when tab size changes\n        _updateCursorInfo();\n    }\n\n    /**\n     * Update insert/overwrite label\n     * @param {Event} event (unused)\n     * @param {Editor} editor Current editor\n     * @param {string} newstate New overwrite state\n     * @param {boolean=} doNotAnimate True if state should not be animated\n     */\n    function _updateOverwriteLabel(event, editor, newstate, doNotAnimate) {\n        if ($statusOverwrite.text() === (newstate ? Strings.STATUSBAR_OVERWRITE : Strings.STATUSBAR_INSERT)) {\n            // label already up-to-date\n            return;\n        }\n\n        $statusOverwrite.text(newstate ? Strings.STATUSBAR_OVERWRITE : Strings.STATUSBAR_INSERT);\n\n        if (!doNotAnimate) {\n            AnimationUtils.animateUsingClass($statusOverwrite[0], \"flash\", 1500);\n        }\n    }\n\n    /**\n     * Update insert/overwrite indicator\n     * @param {Event} event (unused)\n     */\n    function _updateEditorOverwriteMode(event) {\n        var editor = EditorManager.getActiveEditor(),\n            newstate = !editor._codeMirror.state.overwrite;\n\n        // update label with no transition\n        _updateOverwriteLabel(event, editor, newstate, true);\n        editor.toggleOverwrite(newstate);\n    }\n\n    /**\n     * Initialize insert/overwrite indicator\n     * @param {Editor} currentEditor Current editor\n     */\n    function _initOverwriteMode(currentEditor) {\n        currentEditor.toggleOverwrite($statusOverwrite.text() === Strings.STATUSBAR_OVERWRITE);\n        $statusOverwrite.attr(\"title\", Strings.STATUSBAR_INSOVR_TOOLTIP);\n    }\n\n    /**\n     * Handle active editor change event\n     * @param {Event} event (unused)\n     * @param {Editor} current Current editor\n     * @param {Editor} previous Previous editor\n     */\n    function _onActiveEditorChange(event, current, previous) {\n        if (previous) {\n            previous.off(\".statusbar\");\n            previous.document.off(\".statusbar\");\n            previous.document.releaseRef();\n        }\n\n        if (!current) {\n            StatusBar.hideAllPanes();\n        } else {\n            Editor._autoDetectTabSpaces(current);\n            const fullPath = current.document.file.fullPath;\n            StatusBar.showAllPanes();\n\n            current.on(\"cursorActivity.statusbar\", _updateCursorInfo);\n            current.on(\"optionChange.statusbar\", function () {\n                _updateIndentType(fullPath);\n                _updateAutoIndent(fullPath);\n                _updateIndentSize(fullPath);\n            });\n            current.on(\"change.statusbar\", function () {\n                // async update to keep typing speed smooth\n                window.setTimeout(function () { _updateFileInfo(current); }, 0);\n            });\n            current.on(\"overwriteToggle.statusbar\", _updateOverwriteLabel);\n\n            current.document.addRef();\n            current.document.on(\"languageChanged.statusbar\", function () {\n                _updateLanguageInfo(current);\n            });\n\n            _updateCursorInfo(null, current);\n            _updateLanguageInfo(current);\n            _updateEncodingInfo(current);\n            _updateFileInfo(current);\n            _initOverwriteMode(current);\n            _updateIndentType(fullPath);\n            _updateAutoIndent(fullPath);\n            _updateIndentSize(fullPath);\n        }\n    }\n\n    /**\n     * Populate the languageSelect DropdownButton's menu with all registered Languages\n     */\n    function _populateLanguageDropdown() {\n        // Get all non-binary languages\n        var languages = _.values(LanguageManager.getLanguages()).filter(function (language) {\n            return !language.isBinary();\n        });\n\n        // sort dropdown alphabetically\n        languages.sort(function (a, b) {\n            return a.getName().toLowerCase().localeCompare(b.getName().toLowerCase());\n        });\n\n        languageSelect.items = languages;\n\n        // Add option to top of menu for persisting the override\n        languageSelect.items.unshift(\"---\");\n        languageSelect.items.unshift(LANGUAGE_SET_AS_DEFAULT);\n    }\n\n    /**\n     * Change the encoding and reload the current document.\n     * If passed then save the preferred encoding in state.\n     */\n    function _changeEncodingAndReloadDoc(document) {\n        var promise = document.reload();\n        promise.done(function (text, readTimestamp) {\n            encodingSelect.$button.text(document.file._encoding);\n            // Store the preferred encoding in the state\n            const encoding = PreferencesManager.getViewState(\"encoding\", PreferencesManager.STATE_PROJECT_CONTEXT);\n            encoding[document.file.fullPath] = document.file._encoding;\n            PreferencesManager.setViewState(\"encoding\", encoding, PreferencesManager.STATE_PROJECT_CONTEXT);\n        });\n        promise.fail(function (error) {\n            console.log(\"Error reloading contents of \" + document.file.fullPath, error);\n        });\n    }\n\n\n    /**\n     * Populate the encodingSelect DropdownButton's menu with all registered encodings\n     */\n    function _populateEncodingDropdown() {\n        encodingSelect.items = SupportedEncodings;\n    }\n\n    /**\n     * Initialize\n     */\n    function _init() {\n\n        $cursorInfo         = $(\"#status-cursor\");\n        $statusInfo         = $(\"#status-info\");\n        $fileInfo           = $(\"#status-file\");\n        $indentType         = $(\"#indent-type\");\n        $indentAuto         = $(\"#indent-auto\");\n        $indentWidthLabel   = $(\"#indent-width-label\");\n        $indentWidthInput   = $(\"#indent-width-input\");\n        $statusOverwrite    = $(\"#status-overwrite\");\n\n        $statusInfo.click((event)=>{\n            event.preventDefault();\n            event.stopPropagation();\n            CommandManager.execute(Commands.NAVIGATE_GOTO_LINE);\n        });\n\n        languageSelect      = new DropdownButton.DropdownButton(\"\", [], function (item, index) {\n            var document = EditorManager.getActiveEditor().document,\n                defaultLang = LanguageManager.getLanguageForPath(document.file.fullPath, true);\n\n            if (item === LANGUAGE_SET_AS_DEFAULT) {\n                var label = _.escape(StringUtils.format(Strings.STATUSBAR_SET_DEFAULT_LANG, LanguageManager.getCompoundFileExtension(document.file.fullPath)));\n                return { html: label, enabled: document.getLanguage() !== defaultLang };\n            }\n\n            var html = _.escape(item.getName());\n\n            // Show indicators for currently selected & default languages for the current file\n            if (item === defaultLang) {\n                html += \" <span class='default-language'>\" + Strings.STATUSBAR_DEFAULT_LANG + \"</span>\";\n            }\n            if (item === document.getLanguage()) {\n                html = \"<span class='checked-language'></span>\" + html;\n            }\n            return html;\n        });\n\n        languageSelect.dropdownExtraClasses = \"dropdown-status-bar\";\n        languageSelect.$button.addClass(\"btn-status-bar\");\n        $(\"#status-language\").append(languageSelect.$button);\n        languageSelect.$button.attr(\"title\", Strings.STATUSBAR_LANG_TOOLTIP);\n\n\n        encodingSelect = new DropdownButton.DropdownButton(\"\", [], function (item, index) {\n            var document = EditorManager.getActiveEditor().document;\n            var html = _.escape(item);\n\n            // Show indicators for currently selected & default languages for the current file\n            if (item === \"utf8\") {\n                html += \" <span class='default-language'>\" + Strings.STATUSBAR_DEFAULT_LANG + \"</span>\";\n            }\n            if (item === document.file._encoding) {\n                html = \"<span class='checked-language'></span>\" + html;\n            }\n            return html;\n        });\n\n        encodingSelect.dropdownExtraClasses = \"dropdown-status-bar\";\n        encodingSelect.$button.addClass(\"btn-status-bar\");\n        $(\"#status-encoding\").append(encodingSelect.$button);\n        encodingSelect.$button.attr(\"title\", Strings.STATUSBAR_ENCODING_TOOLTIP);\n        let hideSpinner = PreferencesManager.getViewState(\"StatusBar.HideSpinner\");\n        if(hideSpinner){\n            $(\"#status-tasks .spinner\").addClass(\"hide-spinner\");\n        }\n\n        tasksSelect = new DropdownButton.DropdownButton(Strings.STATUSBAR_TASKS, [Strings.STATUSBAR_TASKS_HIDE_SPINNER], function (item, index) {\n            if (item === Strings.STATUSBAR_TASKS_HIDE_SPINNER) {\n                hideSpinner = PreferencesManager.getViewState(\"StatusBar.HideSpinner\");\n                if(hideSpinner){\n                    return  \"<span class='checked-spinner'></span>\" + item;\n                }\n                return item;\n            }\n            return TaskManager._renderItem(item, index);\n        });\n        TaskManager._setTaskSelect(tasksSelect);\n\n        tasksSelect.dropdownExtraClasses = \"dropdown-status-bar\";\n        tasksSelect.$button.addClass(\"btn-status-bar\");\n        $(\"#status-tasks\").append(tasksSelect.$button);\n        tasksSelect.$button.attr(\"title\", Strings.STATUSBAR_TASKS_TOOLTIP);\n        tasksSelect.on(\"select\", function (e, selection) {\n            if(selection === Strings.STATUSBAR_TASKS_HIDE_SPINNER){\n                hideSpinner = !PreferencesManager.getViewState(\"StatusBar.HideSpinner\");\n                PreferencesManager.setViewState(\"StatusBar.HideSpinner\", hideSpinner);\n                if(hideSpinner){\n                    $(\"#status-tasks .spinner\").addClass(\"hide-spinner\");\n                } else {\n                    $(\"#status-tasks .spinner\").removeClass(\"hide-spinner\");\n                }\n                return;\n            }\n            return TaskManager._onSelect(e, selection);\n        });\n        tasksSelect.on(DropdownButton.EVENT_DROPDOWN_SHOWN, (evt)=>{\n            return TaskManager._onDropdownShown(evt);\n        });\n\n        // indentation event handlers\n        $indentType.on(\"click\", _toggleIndentType);\n        $indentAuto.on(\"click\", _toggleAutoIndent);\n        $indentWidthLabel\n            .on(\"click\", function () {\n                // update the input value before displaying\n                var fullPath = EditorManager.getActiveEditor().document.file.fullPath;\n                $indentWidthInput.val(_getIndentSize(fullPath));\n\n                $indentWidthLabel.addClass(\"hidden\");\n                $indentWidthInput.removeClass(\"hidden\");\n                $indentWidthInput.focus();\n\n                $indentWidthInput\n                    .on(\"blur\", function () {\n                        _changeIndentWidth(fullPath, $indentWidthInput.val());\n                    })\n                    .on(\"keyup\", function (event) {\n                        if (event.keyCode === KeyEvent.DOM_VK_RETURN) {\n                            $indentWidthInput.blur();\n                        } else if (event.keyCode === KeyEvent.DOM_VK_ESCAPE) {\n                            _changeIndentWidth(fullPath, false);\n                        }\n                    });\n            });\n\n        $indentWidthInput.focus(function () { $indentWidthInput.select(); });\n\n        // Language select change handler\n        languageSelect.on(\"select\", function (e, lang) {\n            var document = EditorManager.getActiveEditor().document,\n                fullPath = document.file.fullPath;\n\n            var fileType = (document.file instanceof InMemoryFile) ? \"newFile\" : \"existingFile\",\n                filelanguageName = lang ? lang._name||\"\" : \"\";\n\n            Metrics.countEvent(\n                Metrics.EVENT_TYPE.EDITOR,\n                \"languageChange\",\n                `${filelanguageName.toLowerCase()}-${fileType}`\n            );\n\n            if (lang === LANGUAGE_SET_AS_DEFAULT) {\n                // Set file's current language in preferences as a file extension override (only enabled if not default already)\n                var fileExtensionMap = PreferencesManager.get(\"language.fileExtensions\");\n                fileExtensionMap[LanguageManager.getCompoundFileExtension(fullPath)] = document.getLanguage().getId();\n                PreferencesManager.set(\"language.fileExtensions\", fileExtensionMap);\n\n            } else {\n                // Set selected language as a path override for just this one file (not persisted)\n                var defaultLang = LanguageManager.getLanguageForPath(fullPath, true);\n                // if default language selected, pass null to clear the override\n                LanguageManager.setLanguageOverrideForPath(fullPath, lang === defaultLang ? null : lang);\n            }\n        });\n\n        // Encoding select change handler\n        encodingSelect.on(\"select\", function (e, encoding) {\n            var document = EditorManager.getActiveEditor().document,\n                originalPath = document.file.fullPath,\n                originalEncoding = document.file._encoding;\n\n            document.file._encoding = encoding;\n            if (!(document.file instanceof InMemoryFile) && document.isDirty) {\n                CommandManager.execute(Commands.FILE_SAVE_AS, {doc: document}).done(function () {\n                    var doc = DocumentManager.getCurrentDocument();\n                    if (originalPath === doc.file.fullPath) {\n                        _changeEncodingAndReloadDoc(doc);\n                    } else {\n                        document.file._encoding = originalEncoding;\n                    }\n                }).fail(function () {\n                    document.file._encoding = originalEncoding;\n                });\n            } else if (document.file instanceof InMemoryFile) {\n                encodingSelect.$button.text(encoding);\n            } else if (!document.isDirty) {\n                _changeEncodingAndReloadDoc(document);\n            }\n        });\n\n        $statusOverwrite.on(\"click\", _updateEditorOverwriteMode);\n    }\n\n    // Initialize: status bar focused listener\n    EditorManager.on(\"activeEditorChange\", _onActiveEditorChange);\n\n    function _checkFileExistance(filePath, index, encoding) {\n        var deferred = new $.Deferred(),\n            fileEntry = FileSystem.getFileForPath(filePath);\n\n        fileEntry.exists(function (err, exists) {\n            if (!err && exists) {\n                deferred.resolve();\n            } else {\n                delete encoding[filePath];\n                deferred.reject();\n            }\n        });\n\n        return deferred.promise();\n    }\n\n    ProjectManager.on(\"projectOpen\", function () {\n        let encoding = PreferencesManager.getViewState(\"encoding\", PreferencesManager.STATE_PROJECT_CONTEXT);\n        if (!encoding) {\n            encoding = {};\n            PreferencesManager.setViewState(\"encoding\", encoding, PreferencesManager.STATE_PROJECT_CONTEXT);\n        }\n        Async.doSequentially(Object.keys(encoding), function (filePath, index) {\n            return _checkFileExistance(filePath, index, encoding);\n        }, false)\n            .always(function () {\n                PreferencesManager.setViewState(\"encoding\", encoding, PreferencesManager.STATE_PROJECT_CONTEXT);\n            });\n    });\n\n    AppInit.htmlReady(_init);\n    AppInit.appReady(function () {\n        // Populate language switcher with all languages after startup; update it later if this set changes\n        _populateLanguageDropdown();\n        _populateEncodingDropdown();\n        LanguageManager.on(\"languageAdded languageModified\", _populateLanguageDropdown);\n        _onActiveEditorChange(null, EditorManager.getActiveEditor(), null);\n        StatusBar.show();\n    });\n});\n"],"file":"EditorStatusBar.js"}