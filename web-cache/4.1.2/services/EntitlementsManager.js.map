{"version":3,"sources":["services/EntitlementsManager.js"],"names":["define","require","exports","module","KernalModeTrust","window","Error","EventDispatcher","AIControl","UserNotifications","Strings","StringUtils","MS_IN_DAY","FREE_PLAN_VALIDITY_DAYS","LoginService","EntitlementsManager","makeEventDispatcher","EVENT_ENTITLEMENTS_CHANGED","isLoggedIn","loginToAccount","loginService","signInToAccount","catch","err","console","error","effectiveEntitlementsCached","undefined","async","_getEffectiveEntitlements","entitlements","getEffectiveEntitlements","getPlanDetails","plan","currentDate","Date","now","isSubscriber","paidSubscriber","name","USER_FREE_PLAN_NAME_DO_NOT_TRANSLATE","validTill","isPaidSubscriber","planDetails","isInProTrial","getTrialRemainingDays","trialDaysRemaining","getRawEntitlements","getEntitlements","getNotifications","notifications","getLiveEditEntitlement","liveEdit","activated","subscribeURL","brackets","config","purchase_url","upgradeToPlan","main_pro_plan","getAIEntitlement","needsLogin","upsellDialog","title","AI_LOGIN_DIALOG_TITLE","message","AI_LOGIN_DIALOG_MESSAGE","aiControlStatus","getAIControlStatus","aiEnabled","AI_DISABLED_DIALOG_TITLE","AI_CONTROL_ADMIN_DISABLED","defaultAIBrandName","ai_brand_name","defaultPurchaseURL","defaultUpsellTitle","format","AI_UPSELL_DIALOG_TITLE","defaultUpsellMessage","AI_UPSELL_DIALOG_MESSAGE","aiAgent","aiBrandName","buyURL","aiEntitlement","upsellTitle","upsellMessage","inited","init","on","trigger","Phoenix","isTestWindow","_test_entitlements_exports","EntitlementsService"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, either version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/**\n * Entitlements Service\n *\n * This module provides a dedicated API for managing user entitlements,\n * including plan details, trial status, and feature entitlements.\n */\n\ndefine(function (require, exports, module) {\n    const KernalModeTrust = window.KernalModeTrust;\n    if(!KernalModeTrust){\n        // integrated extensions will have access to kernal mode, but not external extensions\n        throw new Error(\"Login service should have access to KernalModeTrust. Cannot boot without trust ring\");\n    }\n\n    const EventDispatcher = require(\"utils/EventDispatcher\"),\n        AIControl = require(\"./ai-control\"),\n        UserNotifications = require(\"./UserNotifications\"),\n        Strings = require(\"strings\"),\n        StringUtils = require(\"utils/StringUtils\");\n\n    const MS_IN_DAY = 24 * 60 * 60 * 1000;\n    const FREE_PLAN_VALIDITY_DAYS = 10000;\n\n    let LoginService;\n\n    // Create secure exports and set up event dispatcher\n    const EntitlementsManager = {};\n    EventDispatcher.makeEventDispatcher(EntitlementsManager);\n    // Set up KernalModeTrust.Entitlements\n    KernalModeTrust.EntitlementsManager = EntitlementsManager;\n\n    // Event constants\n    const EVENT_ENTITLEMENTS_CHANGED = \"entitlements_changed\";\n\n    /**\n     * Check if user is logged in. Best to check after `EVENT_ENTITLEMENTS_CHANGED`.\n     * @returns {*}\n     */\n    function isLoggedIn() {\n        return LoginService.isLoggedIn();\n    }\n\n    /**\n     * Attempts to sign in to the user's account if the user is not already logged in.\n     * You should listen to `EVENT_ENTITLEMENTS_CHANGED` to know when the login status changes. This function\n     * returns immediately and does not wait for the login process to complete.\n     *\n     * @return {void} Does not return a value.\n     */\n    function loginToAccount() {\n        if(isLoggedIn()){\n            return;\n        }\n        KernalModeTrust.loginService.signInToAccount()\n            .catch(function(err){\n                console.error(\"Error signing in to account\", err);\n            });\n    }\n\n    let effectiveEntitlementsCached = undefined; // entitlements can be null and its valid if no login/trial\n    async function _getEffectiveEntitlements() {\n        if(effectiveEntitlementsCached !== undefined){\n            return effectiveEntitlementsCached;\n        }\n        const entitlements = await LoginService.getEffectiveEntitlements();\n        effectiveEntitlementsCached = entitlements;\n        return entitlements;\n    }\n\n    /**\n     * Get the plan details from entitlements with fallback to free plan defaults. If the user is\n     * in pro trial(isInProTrial API), then isSubscriber will always be true as we need to treat\n     * user as subcriber. you should use isInProTrial API to check if user is in pro trial if some\n     * trial-related logic needs to be done.\n     * @returns {Promise<Object>} Plan details object\n     */\n    async function getPlanDetails() {\n        const entitlements = await _getEffectiveEntitlements();\n\n        if (entitlements && entitlements.plan) {\n            return entitlements.plan;\n        }\n\n        // Fallback to free plan defaults\n        const currentDate = Date.now();\n        return {\n            isSubscriber: false,\n            paidSubscriber: false,\n            name: Strings.USER_FREE_PLAN_NAME_DO_NOT_TRANSLATE,\n            validTill: currentDate + (FREE_PLAN_VALIDITY_DAYS * MS_IN_DAY)\n        };\n    }\n\n    /**\n     * Determines if the current user is a paid subscriber. A paid subscriber is a user who has paid $ for any pro-plan.\n     *\n     * @return {Promise<boolean>} A promise that resolves to a boolean indicating whether the user is a paid subscriber.\n     */\n    async function isPaidSubscriber() {\n        if(!LoginService.isLoggedIn()){\n            return false;\n        }\n        const planDetails = await getPlanDetails();\n        return !!planDetails.paidSubscriber;\n    }\n\n    /**\n     * Check if user is in a pro trial. IF the user is in pro trail, then `plan.isSubscriber` will always be true.\n     * @returns {Promise<boolean>} True if user is in pro trial, false otherwise\n     */\n    async function isInProTrial() {\n        const entitlements = await _getEffectiveEntitlements();\n        return !!(entitlements && entitlements.isInProTrial);\n    }\n\n    /**\n     * Get remaining trial days\n     * @returns {Promise<number>} Number of remaining trial days\n     */\n    async function getTrialRemainingDays() {\n        const entitlements = await _getEffectiveEntitlements();\n        return entitlements && entitlements.trialDaysRemaining ? entitlements.trialDaysRemaining : 0;\n    }\n\n    /**\n     * Get current raw entitlements. Should not be used directly, use individual feature entitlement instead\n     * like getLiveEditEntitlement. Raw entitlements are server set and will not contain trial info.\n     * @returns {Promise<Object|null>} Raw entitlements object or null\n     */\n    async function getRawEntitlements() {\n        return await LoginService.getEntitlements();\n    }\n\n    /**\n     * Get notifications array from entitlements. Uses cached entitlements when available.\n     * Notifications are used to display in-app promotional messages, alerts, or announcements to users.\n     *\n     * @returns {Promise<Array>} Array of notification objects, empty array if no notifications available\n     *\n     * @description Each notification object has the following structure:\n     * ```javascript\n     * {\n     *   notificationID: string,      // Unique UUID to track if notification was shown\n     *   title: string,               // Notification title\n     *   htmlContent: string,         // HTML content of the notification message\n     *   validTill: number,           // Timestamp when notification expires\n     *   options: {\n     *     autoCloseTimeS: number,    // Optional: Time in seconds for auto-close. Default: never\n     *     dismissOnClick: boolean,   // Optional: Close on click. Default: true\n     *     toastStyle: string         // Optional: Style class (NOTIFICATION_STYLES_CSS_CLASS.INFO, etc.)\n     *   }\n     * }\n     * ```\n     */\n    async function getNotifications() {\n        const entitlements = await _getEffectiveEntitlements();\n\n        if (entitlements && entitlements.notifications) {\n            return entitlements.notifications;\n        }\n        return [];\n    }\n\n    /**\n     * Get live edit is enabled for user, based on his logged in pro-user/trial status.\n     *\n     * @returns {Promise<Object>} Live edit entitlement object with the following shape:\n     * @returns {Promise<Object>} entitlement\n     * @returns {Promise<boolean>} entitlement.activated - If true, enable live edit feature.\n     *                                                   If false, use promotions.showProUpsellDialog\n     *                                                   with UPSELL_TYPE_LIVE_EDIT to show an upgrade dialog if needed.\n     * @returns {Promise<string>} entitlement.subscribeURL - URL to subscribe/purchase if not activated\n     * @returns {Promise<string>} entitlement.upgradeToPlan - Plan name that includes live edit entitlement\n     * @returns {Promise<number>} [entitlement.validTill] - Timestamp when entitlement expires (if from server)\n     *\n     * @example\n     * const liveEditEntitlement = await EntitlementsManager.getLiveEditEntitlement();\n     * if (liveEditEntitlement.activated) {\n     *     // Enable live edit feature\n     *     enableLiveEditFeature();\n     * } else {\n     *     // Show upgrade dialog when user tries to use live edit\n     *     promotions.showProUpsellDialog(promotions.UPSELL_TYPE_LIVE_EDIT);\n     * }\n     */\n    async function getLiveEditEntitlement() {\n        const entitlements = await _getEffectiveEntitlements();\n\n        if (entitlements && entitlements.entitlements && entitlements.entitlements.liveEdit) {\n            return entitlements.entitlements.liveEdit;\n        }\n\n        // Fallback defaults when live edit entitlement is not available from API\n        return {\n            activated: false,\n            subscribeURL: brackets.config.purchase_url,\n            upgradeToPlan: brackets.config.main_pro_plan\n        };\n    }\n\n    /**\n     * Get AI is enabled for user, based on his logged in pro-user/trial status.\n     *\n     * @returns {Promise<Object>} AI entitlement object with the following shape:\n     * @returns {Promise<boolean>} entitlement.activated - If true, enable AI features. If false, check upsellDialog.\n     * @returns {Promise<boolean>} [entitlement.needsLogin] - If true, user needs to login first.\n     * @returns {Promise<string>} [entitlement.aiBrandName] - The brand name used for AI. Eg: `Phoenix AI`\n     * @returns {Promise<string>} [entitlement.buyURL] - URL to subscribe/purchase if not activated. Can be null if AI\n     *                                            is not purchasable.\n     * @returns {Promise<string>} [entitlement.upgradeToPlan] - Plan name that includes AI entitlement\n     * @returns {Promise<number>} [entitlement.validTill] - Timestamp when entitlement expires (if from server)\n     * @returns {Promise<Object>} [entitlement.upsellDialog] - Dialog configuration if user needs to be shown an upsell.\n     *                                            Only present when activated is false.\n     * @returns {Promise<string>} [entitlement.upsellDialog.title] - Dialog title\n     * @returns {Promise<string>} [entitlement.upsellDialog.message] - Dialog message\n     * @returns {Promise<string>} [entitlement.upsellDialog.buyURL] - Purchase URL. If present, dialog shows\n     *                                            \"Get AI Access\" button. If absent, shows only OK button.\n     *\n     * @example\n     * const aiEntitlement = await EntitlementsManager.getAIEntitlement();\n     * if (aiEntitlement.activated) {\n     *     // Enable AI features\n     *     enableAIFeature();\n     * } else if (aiEntitlement.upsellDialog) {\n     *     // Show upsell dialog when user tries to use AI\n     *     promotions.showAIUpsellDialog(aiEntitlement);\n     * }\n     */\n    async function getAIEntitlement() {\n        if(!isLoggedIn()) {\n            return {\n                needsLogin: true,\n                activated: false,\n                upsellDialog: {\n                    title: Strings.AI_LOGIN_DIALOG_TITLE,\n                    message: Strings.AI_LOGIN_DIALOG_MESSAGE\n                    // no buy url as it is a sign in hint. only ok button will be there in this dialog.\n                }\n            };\n        }\n        const aiControlStatus = await EntitlementsManager.getAIControlStatus();\n        if(!aiControlStatus.aiEnabled) {\n            return {\n                activated: false,\n                upsellDialog: {\n                    title: Strings.AI_DISABLED_DIALOG_TITLE,\n                    // Eg. AI is disabled by school admin/root user.\n                    // no buyURL as ai is disabled explicitly. only ok button will be there in this dialog.\n                    message: aiControlStatus.message || Strings.AI_CONTROL_ADMIN_DISABLED\n                }\n            };\n        }\n        const defaultAIBrandName = brackets.config.ai_brand_name,\n            defaultPurchaseURL = brackets.config.purchase_url,\n            defaultUpsellTitle = StringUtils.format(Strings.AI_UPSELL_DIALOG_TITLE, defaultAIBrandName),\n            defaultUpsellMessage = StringUtils.format(Strings.AI_UPSELL_DIALOG_MESSAGE, defaultAIBrandName);\n        const entitlements = await _getEffectiveEntitlements();\n        if(!entitlements || !entitlements.entitlements || !entitlements.entitlements.aiAgent) {\n            return {\n                activated: false,\n                aiBrandName: defaultAIBrandName,\n                buyURL: defaultPurchaseURL,\n                upgradeToPlan: defaultAIBrandName,\n                upsellDialog: {\n                    title: defaultUpsellTitle,\n                    message: defaultUpsellMessage,\n                    buyURL: defaultPurchaseURL\n                }\n            };\n        }\n        const aiEntitlement = entitlements.entitlements.aiAgent;\n        // entitlements.entitlements.aiAgent: {\n        //       activated: boolean,\n        //       aiBrandName: string,\n        //       subscribeURL: string,\n        //       upgradeToPlan: string,\n        //       validTill: number,\n        //       upsellDialog: {\n        //          title: \"if activated is false, server can send a custom upsell dialog to show\",\n        //          message: \"this is the message to show\",\n        //          buyURL: \"if this url is present from server, this will be shown to as buy link\"\n        //      }\n        //     }\n\n        if(aiEntitlement.activated) {\n            return {\n                activated: true,\n                aiBrandName: aiEntitlement.aiBrandName,\n                buyURL: aiEntitlement.subscribeURL,\n                upgradeToPlan: aiEntitlement.upgradeToPlan,\n                validTill: aiEntitlement.validTill\n                // no upsellDialog, as it need not be shown.\n            };\n        }\n\n        const upsellTitle = StringUtils.format(Strings.AI_UPSELL_DIALOG_TITLE,\n            aiEntitlement.aiBrandName || defaultAIBrandName);\n        const upsellMessage = StringUtils.format(Strings.AI_UPSELL_DIALOG_MESSAGE,\n            aiEntitlement.aiBrandName || defaultAIBrandName);\n        const upsellDialog = aiEntitlement.upsellDialog || {};\n        return {\n            activated: false,\n            aiBrandName: aiEntitlement.aiBrandName,\n            buyURL: aiEntitlement.subscribeURL || defaultPurchaseURL,\n            upgradeToPlan: aiEntitlement.upgradeToPlan,\n            validTill: aiEntitlement.validTill,\n            upsellDialog: {\n                title: upsellDialog.title || upsellTitle,\n                message: upsellDialog.message || upsellMessage,\n                buyURL: upsellDialog.buyURL || aiEntitlement.subscribeURL || defaultPurchaseURL\n            }\n        };\n    }\n\n    let inited = false;\n    function init() {\n        if(inited){\n            return;\n        }\n        inited = true;\n        LoginService = KernalModeTrust.loginService;\n        // Set up event forwarding from LoginService\n        LoginService.on(LoginService.EVENT_ENTITLEMENTS_CHANGED, function() {\n            effectiveEntitlementsCached = undefined;\n            EntitlementsManager.trigger(EVENT_ENTITLEMENTS_CHANGED);\n        });\n        AIControl.init();\n        UserNotifications.init();\n    }\n\n    // Test-only exports for integration testing\n    if (Phoenix.isTestWindow) {\n        window._test_entitlements_exports = {\n            EntitlementsService: EntitlementsManager,\n            isLoggedIn,\n            getPlanDetails,\n            isPaidSubscriber,\n            isInProTrial,\n            getTrialRemainingDays,\n            getRawEntitlements,\n            getNotifications,\n            getLiveEditEntitlement,\n            loginToAccount\n        };\n    }\n\n    exports.init = init;\n    // no public exports to prevent extension tampering\n\n    // Add functions to secure exports. These can be accessed via `KernalModeTrust.Entitlements.*`\n    EntitlementsManager.isLoggedIn = isLoggedIn;\n    EntitlementsManager.loginToAccount = loginToAccount;\n    EntitlementsManager.getPlanDetails = getPlanDetails;\n    EntitlementsManager.isPaidSubscriber = isPaidSubscriber;\n    EntitlementsManager.isInProTrial = isInProTrial;\n    EntitlementsManager.getTrialRemainingDays = getTrialRemainingDays;\n    EntitlementsManager.getRawEntitlements = getRawEntitlements;\n    EntitlementsManager.getNotifications = getNotifications;\n    EntitlementsManager.getLiveEditEntitlement = getLiveEditEntitlement;\n    EntitlementsManager.getAIEntitlement = getAIEntitlement;\n    EntitlementsManager.EVENT_ENTITLEMENTS_CHANGED = EVENT_ENTITLEMENTS_CHANGED;\n});\n"],"file":"EntitlementsManager.js"}