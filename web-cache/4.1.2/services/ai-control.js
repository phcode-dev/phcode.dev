define(function(require,exports,module){const KernalModeTrust=window.KernalModeTrust;if(!KernalModeTrust)throw new Error("ai-control.js should have access to KernalModeTrust. Cannot boot without trust ring");const NodeUtils=require("utils/NodeUtils"),Strings=require("strings"),StringUtils=require("utils/StringUtils");let EntitlementsManager;function _getAIConfigFilePath(){let aiConfigPath;if(!Phoenix.isNativeApp)return"";if("win"===Phoenix.platform)aiConfigPath="C:\\Program Files\\Phoenix AI Control\\config.json";else if("mac"===Phoenix.platform)aiConfigPath="/Library/Application Support/Phoenix AI Control/config.json";else{if("linux"!==Phoenix.platform)throw new Error(`Unsupported platform: ${Phoenix.platform}`);aiConfigPath="/etc/phoenix-ai-control/config.json"}return Phoenix.VFS.getTauriVirtualPath(aiConfigPath)}const AI_CONFIG_FILE_PATH=_getAIConfigFilePath();function _isCurrentUserAllowed(allowedUsers,currentUser){return!(!allowedUsers||!Array.isArray(allowedUsers)||0===allowedUsers.length)&&allowedUsers.includes(currentUser)}async function getAIControlStatus(){try{if(!Phoenix.isNativeApp)return{aiEnabled:!0};const fileData=await Phoenix.VFS.readFileResolves(AI_CONFIG_FILE_PATH,"utf8");if(fileData.error||!fileData.data)return{aiEnabled:!0,message:Strings.AI_CONTROL_ALL_ALLOWED_NO_CONFIG};const aiConfig=JSON.parse(fileData.data),currentUser=await NodeUtils.getOSUserName();return!0===aiConfig.disableAI?aiConfig.allowedUsers&&_isCurrentUserAllowed(aiConfig.allowedUsers,currentUser)?{aiEnabled:!0,message:StringUtils.format(Strings.AI_CONTROL_USER_ALLOWED,currentUser)}:aiConfig.managedByEmail?{aiEnabled:!1,message:StringUtils.format(Strings.AI_CONTROL_ADMIN_DISABLED_CONTACT,aiConfig.managedByEmail)}:{aiEnabled:!1,message:Strings.AI_CONTROL_ADMIN_DISABLED}:{aiEnabled:!0,message:Strings.AI_CONTROL_ALL_ALLOWED}}catch(error){return console.error("Error checking AI control:",error),{aiEnabled:!0,message:error.message}}}Phoenix.isNativeApp&&console.log("AI system Config File is: ",AI_CONFIG_FILE_PATH);let inited=!1;function init(){inited||(inited=!0,(EntitlementsManager=KernalModeTrust.EntitlementsManager).getAIControlStatus=getAIControlStatus)}exports.init=init});
//# sourceMappingURL=ai-control.js.map
