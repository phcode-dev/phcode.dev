let prettierInit=!1;async function initPrettier(){if(prettierInit)return;prettierInit=!0;const prettierURL=`${Phoenix.baseURL}thirdparty/prettier/standalone.js`;await import(prettierURL);const pluginURLS=[`${Phoenix.baseURL}thirdparty/prettier/plugins/babel.js`,`${Phoenix.baseURL}thirdparty/prettier/plugins/estree.js`,`${Phoenix.baseURL}thirdparty/prettier/plugins/html.js`,`${Phoenix.baseURL}thirdparty/prettier/plugins/postcss.js`];for(let pluginURL of pluginURLS)await import(pluginURL)}let pluginURLS={php:`${Phoenix.baseURL}thirdparty/prettier/php/standalone.js`,yaml:`${Phoenix.baseURL}thirdparty/prettier/plugins/yaml.js`,markdown:`${Phoenix.baseURL}thirdparty/prettier/plugins/markdown.js`,typescript:`${Phoenix.baseURL}thirdparty/prettier/plugins/typescript.js`},builtinPlugins=["babel","json-stringify","html","css","less","scss"];async function _loadPlugin(pluginName){pluginURLS[pluginName]?await import(pluginURLS[pluginName]):builtinPlugins.includes(pluginName)||console.error("no prettier plugin loaded for",pluginName)}function _identifyChangedRange(oldText,newText,start,end){let charsToEndIndex=oldText.length-end,newRangeStart=start,newRangeEnd=newText.length-charsToEndIndex,rangeEndInOldText=oldText.length-charsToEndIndex;return{text:newText,changedText:newText.substring(newRangeStart,newRangeEnd),rangeStart:newRangeStart,rangeEnd:newRangeEnd,rangeEndInOldText:rangeEndInOldText}}async function prettify(params){prettierInit||await initPrettier();let options=params.options||{};options.plugins=prettierPlugins;let isFullFileBeautify=!options.rangeStart||!options.rangeEnd;options.rangeStart=options.rangeStart||0,options.rangeEnd=options.rangeEnd||params.text.length,await _loadPlugin(options._usePlugin);const pluginName=options._usePlugin;let formatted,cursorOffset;if(delete options._usePlugin,"json-stringify"===pluginName)formatted=await prettier.format(params.text,options);else{let prettyResult=await prettier.formatWithCursor(params.text,options);formatted=prettyResult.formatted,cursorOffset=prettyResult.cursorOffset}return isFullFileBeautify?{text:formatted,cursorOffset:cursorOffset}:_identifyChangedRange(params.text,formatted,options.rangeStart,options.rangeEnd)}WorkerComm.setExecHandler("prettify",prettify),initPrettier().catch(err=>{console.error("Failed to load prettier in worker: ",err)});
//# sourceMappingURL=prettier-helper.js.map
