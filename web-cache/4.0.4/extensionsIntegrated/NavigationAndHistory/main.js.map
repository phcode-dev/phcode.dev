{"version":3,"sources":["extensionsIntegrated/NavigationAndHistory/main.js"],"names":["define","require","exports","module","_","AppInit","Async","Strings","MainViewManager","DocumentManager","EditorManager","ProjectManager","CommandManager","Commands","Menus","FileSystem","FileUtils","ViewUtils","KeyEvent","WorkingSetView","PreferencesManager","KeyBindingManager","Mustache","NavigationProvider","FileRecovery","KeyboardPrefs","JSON","parse","PREFS_RECENT_FILES","SHOW_RECENT_FILES","NEXT_IN_RECENT_FILES","PREV_IN_RECENT_FILES","OPEN_FILES_VIEW_STATE","htmlTemplate","dirtyDotTemplate","MAX_ENTRY_COUNT","isRecentFilesNavEnabled","_mrofList","$mrofContainer","$currentContext","activeEditor","_hideMROFList","_openEditorForContext","contextData","activePaneId","getActivePaneId","targetPaneId","paneId","getPaneCount","hideOnOpenFile","execute","FILE_OPEN","fullPath","path","done","cursor","getActiveEditor","setCursorPos","centerOnCursor","_makeMROFListEntry","pane","cursorPos","file","_isOpenAndDirty","docIfOpen","getOpenDocumentForPath","isDirty","_checkExt","entry","index","deferred","$","Deferred","fileEntry","getFileForPath","indxInWS","inMem","findInWorkingSet","reject","resolve","exists","err","promise","_syncWithFileSystem","filter","e","doSequentially","_getFileListForEntries","entries","map","value","_addDirectoriesForDuplicateBaseNames","checked","baseName","getBaseName","push","forEach","length","dirs","getDirNamesForDuplicateFiles","find","each","$li","this","data","dirSplit","split","$dir","html","children","remove","append","_createFileEntries","$mrofList","$link","$newItem","$removeBtn","isPaneLabelReqd","addClass","text","getPaneTitle","entryIndex","findIndex","record","name","isFile","getFileEntryDisplay","on","preventDefault","stopPropagation","filePath","parent","setViewState","STATE_PROJECT_CONTEXT","useIconProviders","displayPath","Phoenix","app","getDisplayPath","attr","css","useClassProviders","prependTo","_createMROFList","paneList","getPaneIdList","mrofList","fileList","mrofEntry","paneCount","fileCount","getWorkingSet","findInGlobalMRUList","_handleArrowKeys","event","UP","DOWN","$context","$nextContext","which","prev","next","trigger","last","stopImmediatePropagation","_hideMROFListOnEscape","keyCode","DOM_VK_ESCAPE","_createMROFDisplayList","refresh","$def","_purgeAllExceptWorkingSet","empty","_onFocus","$scope","target","removeClass","_onClick","delegateTarget","render","appendTo","one","window","always","$fileLinks","first","_openFile","_hideMROFListOnNavigationEnd","DOM_VK_CONTROL","_moveNext","$next","_cmdMoveNext","$displayPromise","_movePrev","$prev","_cmdMovePrev","_updateCursorPosition","_addToMROFList","constructor","splice","unshift","_handleWorkingSetMove","sourcePaneId","destinationPaneId","tIndex","_handleAppClose","_initRecentFilesList","getViewState","getWorkingSetSize","ALL_PANES","_handleProjectOpen","_showRecentFileList","_handlePaneMerge","FIRST_PANE","itrIndex","_initRecentFileMenusAndCommands","menu","get","register","CMD_RECENT_FILES_OPEN","addBinding","isNativeApp","CMD_NEXT_DOC","CMD_PREV_DOC","getMenu","AppMenuBar","FILE_MENU","addMenuItem","AFTER","FILE_REOPEN_CLOSED","_initDefaultNavigationCommands","NAVIGATE_NEXT_DOC","NAVIGATE_PREV_DOC","_removeKeys","keys","config","removeBinding","key","_removeNavigationKeys","_deregisterSortcutsAndMenus","removeMenuItem","handleCurrentFileChange","newFile","newPaneId","oldFile","_handleActiveEditorChange","current","previous","document","_paneId","getCursorPos","_attachListners","_detachListners","off","definePreference","description","DESCRIPTION_RECENT_FILES_NAV","focus","appReady","init"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2016 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\ndefine(function (require, exports, module) {\n\n\n    var _                       = require(\"thirdparty/lodash\"),\n        AppInit                 = require(\"utils/AppInit\"),\n        Async                   = require(\"utils/Async\"),\n        Strings                 = require(\"strings\"),\n        MainViewManager         = require(\"view/MainViewManager\"),\n        DocumentManager         = require(\"document/DocumentManager\"),\n        EditorManager           = require(\"editor/EditorManager\"),\n        ProjectManager          = require(\"project/ProjectManager\"),\n        CommandManager          = require(\"command/CommandManager\"),\n        Commands                = require(\"command/Commands\"),\n        Menus                   = require(\"command/Menus\"),\n        FileSystem              = require(\"filesystem/FileSystem\"),\n        FileUtils               = require(\"file/FileUtils\"),\n        ViewUtils               = require(\"utils/ViewUtils\"),\n        KeyEvent                = require(\"utils/KeyEvent\"),\n        WorkingSetView          = require(\"project/WorkingSetView\"),\n        PreferencesManager      = require(\"preferences/PreferencesManager\"),\n        KeyBindingManager       = require(\"command/KeyBindingManager\"),\n        Mustache                = require(\"thirdparty/mustache/mustache\"),\n        NavigationProvider      = require(\"./NavigationProvider\"),\n        FileRecovery      = require(\"./FileRecovery\");\n\n    var KeyboardPrefs = JSON.parse(require(\"text!./keyboard.json\"));\n\n    // Command constants for recent files\n    var PREFS_RECENT_FILES      = \"recent-files.navigation\",\n        SHOW_RECENT_FILES       = \"recent-files.show\",\n        NEXT_IN_RECENT_FILES    = \"recent-files.next\",\n        PREV_IN_RECENT_FILES    = \"recent-files.prev\",\n        OPEN_FILES_VIEW_STATE   = \"openFiles\";\n\n    var htmlTemplate = require(\"text!./html/recentfiles-template.html\"),\n        dirtyDotTemplate = \"<div class='file-status-icon dirty' style='position: absolute;margin-left: -2px;'></div>\";\n\n    var MAX_ENTRY_COUNT    = 50;\n\n    var isRecentFilesNavEnabled = true;\n\n    /*\n    * Contains list of most recently opened files and their last known cursor position\n    * @private\n    * @type {Array.<Object>}\n    */\n    var _mrofList = [],\n        $mrofContainer = null;\n\n\n    var $currentContext,\n        activeEditor;\n\n    var _hideMROFList;\n\n    PreferencesManager.definePreference(PREFS_RECENT_FILES, \"boolean\", true, {\n        description: Strings.DESCRIPTION_RECENT_FILES_NAV\n    });\n\n    /**\n     * Opens a full editor for the given context\n     * @private\n     * @param {Object.<path, paneId, cursor>} contextData - wrapper to provide the information required to open a full editor\n     * @return {$.Promise} - from the commandmanager\n     */\n    function _openEditorForContext(contextData) {\n        // Open the file in the current active pane to prevent unwanted scenarios if we are not in split view, fallback\n        // to the persisted paneId when specified and we are in split view or unable to determine the paneid\n        var activePaneId = MainViewManager.getActivePaneId(),\n            targetPaneId = contextData.paneId; // Assume we are going to use the last associated paneID\n\n        // Detect if we are not in split mode\n        if (MainViewManager.getPaneCount() === 1) {\n            // Override the targetPaneId with activePaneId as we are not yet in split mode\n            targetPaneId = activePaneId;\n        }\n\n        // If hide of MROF list is a context parameter, hide the MROF list on successful file open\n        if (contextData.hideOnOpenFile) {\n            _hideMROFList();\n        }\n\n        return CommandManager\n            .execute(Commands.FILE_OPEN,\n            {   fullPath: contextData.path,\n                paneId: targetPaneId\n            }\n                )\n            .done(function () {\n                if (contextData.cursor) {\n                    activeEditor = EditorManager.getActiveEditor();\n                    activeEditor.setCursorPos(contextData.cursor);\n                    activeEditor.centerOnCursor();\n                }\n            });\n    }\n\n    /**\n     * Creates an entry for MROF list\n     * @private\n     * @param {String} path - full path of a doc\n     * @param {String} pane - the pane holding the editor for the doc\n     * @param {Object} cursorPos - current cursor position\n     * @return {Object} a frame containing file path, pane and last known cursor\n     */\n    function _makeMROFListEntry(path, pane, cursorPos) {\n        return {\n            file: path,\n            paneId: pane,\n            cursor: cursorPos\n        };\n    }\n\n    /**\n     * Determines if a file is dirty\n     * @private\n     * @param {!File} file - file to test\n     * @return {boolean} true if the file is dirty, false otherwise\n     */\n    function _isOpenAndDirty(file) {\n        // working set item might never have been opened; if so, then it's definitely not dirty\n        var docIfOpen = DocumentManager.getOpenDocumentForPath(file.fullPath);\n        return (docIfOpen && docIfOpen.isDirty);\n    }\n\n    function _checkExt(entry, index) {\n        var deferred = new $.Deferred(),\n            fileEntry = FileSystem.getFileForPath(entry.file);\n\n        if (entry.inMem) {\n            var indxInWS = MainViewManager.findInWorkingSet(entry.paneId, entry.file);\n            // Remove entry if InMemoryFile is not found in Working set\n            if (indxInWS === -1) {\n                _mrofList[index] = null;\n                deferred.reject();\n            } else {\n                deferred.resolve();\n            }\n        } else {\n            fileEntry.exists(function (err, exists) {\n                if (!err && exists) {\n                    deferred.resolve();\n                } else {\n                    _mrofList[index] = null;\n                    deferred.reject();\n                }\n\t\t    });\n\t    }\n\n        return deferred.promise();\n    }\n\n    /**\n     * Checks whether entries in MROF list actually exists in fileSystem to prevent access to deleted files\n     * @private\n     */\n    function _syncWithFileSystem() {\n        _mrofList = _mrofList.filter(function (e) { return e; });\n        return Async.doSequentially(_mrofList, _checkExt, false);\n    }\n\n    function _getFileListForEntries(entries) {\n        return $.map(entries, function (value, index) {\n            return FileSystem.getFileForPath(value.file);\n        });\n    }\n\n    function _addDirectoriesForDuplicateBaseNames() {\n        var checked = {}, baseName;\n        // Find duplicates first\n        $.map(_mrofList, function (value, index) {\n            baseName = FileUtils.getBaseName(value.file);\n            if (!checked[baseName]) {\n                checked[baseName] = [];\n            }\n            checked[baseName].push(value);\n        });\n\n        // Go through the map and solve the arrays with length over 1. Ignore the rest.\n        _.forEach(checked, function (value) {\n            if (value.length > 1) {\n                var dirs = ViewUtils.getDirNamesForDuplicateFiles(_getFileListForEntries(value));\n                $.map(value, function (value, index) {\n                    // Go through recent files and add directories to appropriate entries\n                    $mrofContainer.find(\"#mrof-list > li\").each(function () {\n                        var $li = $(this);\n                        if ($li.data(\"path\") === value.file) {\n                            var dirSplit = dirs[index].split(\"/\");\n                            if (dirSplit.length > 3) {\n                                dirs[index] = dirSplit[0] + \"/\\u2026/\" + dirSplit[dirSplit.length - 1];\n                            }\n                            var $dir = $(\"<span class='directory'/>\").html(\" &mdash; \" + dirs[index]);\n                            $li.children(\"a.mroitem\").find(\"span.directory\").remove();\n                            $li.children(\"a.mroitem\").append($dir);\n                        }\n                    });\n                });\n            }\n        });\n    }\n\n    function _createFileEntries($mrofList) {\n        var data, fileEntry, $link, $newItem, $removeBtn;\n        // Iterate over the MROF list and create the pop over UI items\n\n        // If we are in split view we might want to show the panes corresponding to the entries\n        var isPaneLabelReqd = MainViewManager.getPaneCount() > 1;\n\n        if (isPaneLabelReqd) {\n            $mrofContainer.addClass(\"split-mode\");\n            $(\".first.pane-label\", $mrofContainer).text(MainViewManager.getPaneTitle(\"first-pane\"));\n            $(\".second.pane-label\", $mrofContainer).text(MainViewManager.getPaneTitle(\"second-pane\"));\n        }\n\n        $.each(_mrofList, function (index, value) {\n\n            if (!isPaneLabelReqd && value.paneId !== MainViewManager.getActivePaneId()) {\n                // Try to see if we have same doc split\n                // Check existing list for this doc path and active pane entry\n                var entryIndex = _.findIndex(_mrofList, function (record) {\n                    return (\n                        record &&\n                        record.file === value.file &&\n                        record.paneId === MainViewManager.getActivePaneId()\n                    );\n                });\n\n                // If found don't process this entry, as the document is already present in active pane\n                if (entryIndex >= 0) {\n                    return true;\n                }\n                // Process this for active pane id\n                value.paneId = MainViewManager.getActivePaneId();\n\n            }\n\n            var indxInWS = MainViewManager.findInWorkingSet(value.paneId, value.file);\n\n            data = {\n                fullPath: value.file,\n                name: FileUtils.getBaseName(value.file),\n                isFile: true\n            };\n\n            fileEntry = FileSystem.getFileForPath(value.file);\n\n            // Create new list item with a link\n            $link = $(\"<a href='#' class='mroitem'></a>\").html(\n                ViewUtils.getFileEntryDisplay({name: FileUtils.getBaseName(value.file)})\n            );\n\n            // Create remove button only for files not in working set\n            $removeBtn = null;\n            if (indxInWS === -1) {\n                $removeBtn = $(\"<span class='remove-file'>&times;</span>\").on(\"click\", function(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    // Find and remove the entry from _mrofList\n                    var filePath = $(this).parent().data(\"path\");\n                    var paneId = $(this).parent().data(\"paneId\");\n\n                    _mrofList = _mrofList.filter(function(entry) {\n                        return !(entry && entry.file === filePath && entry.paneId === paneId);\n                    });\n\n                    // Remove the list item from UI\n                    $(this).parent().remove();\n\n                    // Update preferences\n                    PreferencesManager.setViewState(\n                        OPEN_FILES_VIEW_STATE,\n                        _mrofList,\n                        PreferencesManager.STATE_PROJECT_CONTEXT\n                    );\n                });\n            }\n\n            // Use the file icon providers\n            WorkingSetView.useIconProviders(data, $link);\n\n            // Create list item with link and conditionally add remove button\n            $newItem = $(\"<li></li>\").append($link);\n            if ($removeBtn) {\n                $newItem.append($removeBtn);\n            }\n\n            if (indxInWS !== -1) { // in working set show differently\n                $newItem.addClass(\"working-set\");\n            }\n\n            $newItem.data(\"path\", value.file);\n\n            // convert the virtual path to display path\n            var displayPath = Phoenix.app.getDisplayPath(value.file);\n\n            $newItem.data(\"paneId\", value.paneId);\n            $newItem.data(\"cursor\", value.cursor);\n            $newItem.data(\"file\", fileEntry);\n            $newItem.attr(\"title\", displayPath); // this is for the tooltip\n\n            if (isPaneLabelReqd && value.paneId) {\n                $newItem.addClass(value.paneId);\n                $newItem.css('top', ($('.' + value.paneId, $mrofList).length * 22) + 'px');\n            }\n\n            // Use the class providers(git e.t.c)\n            WorkingSetView.useClassProviders(data, $newItem);\n\n            // If a file is dirty, mark it in the list\n            if (_isOpenAndDirty(fileEntry)) {\n                $(dirtyDotTemplate).prependTo($newItem);\n            }\n\n            $mrofList.append($newItem);\n\n            if (index === MAX_ENTRY_COUNT - 1) {\n                // We have reached the max number of entries we can display, break out\n                return false;\n            }\n        });\n        _addDirectoriesForDuplicateBaseNames();\n    }\n\n    /**\n     * This function is used to create mrof when a project is opened for the firt time with the recent files feature\n     * This routine acts as a logic to migrate existing viewlist to mrof structure\n     * @private\n     */\n    function _createMROFList() {\n\n        var paneList = MainViewManager.getPaneIdList(),\n            mrofList = [],\n            fileList,\n            index;\n\n        var pane, file, mrofEntry, paneCount, fileCount;\n        // Iterate over the pane ID list\n        for (paneCount = 0; paneCount < paneList.length; paneCount++) {\n            pane = paneList[paneCount];\n            fileList = MainViewManager.getWorkingSet(pane);\n            // Iterate over the file list for this pane\n            for (fileCount = 0; fileCount < fileList.length; fileCount++) {\n                file = fileList[fileCount];\n                mrofEntry = _makeMROFListEntry(file.fullPath, pane, null);\n                // Add it in the MRU list order\n                index = MainViewManager.findInGlobalMRUList(pane, file);\n                mrofList[index] = mrofEntry;\n            }\n        }\n\n        return mrofList;\n    }\n\n    function _handleArrowKeys(event) {\n        var UP = 38,\n            DOWN = 40;\n\n        var $context, $nextContext;\n        if ($mrofContainer && (event.which === UP || event.which === DOWN)) {\n            $context = $currentContext || $(\"#mrof-container #mrof-list > li.highlight\");\n            if ($context.length > 0) {\n                $nextContext = event.which === UP ? $context.prev() : $context.next();\n                if ($nextContext.length > 0) {\n                    $currentContext = $nextContext;\n                    //_resetOpenFileTimer();\n                    $nextContext.find(\"a.mroitem\").trigger(\"focus\");\n                }\n            } else {\n                //WTF! (Worse than failure). We should not get here.\n                $(\"#mrof-container #mrof-list > li > a.mroitem:visited\").last().trigger(\"focus\");\n            }\n            // If we don't prevent this then scrolling happens by the browser(user agent behaviour)\n            // as well as a result of moving focus in the ul\n            event.preventDefault();\n            event.stopImmediatePropagation();\n        }\n    }\n\n    function _hideMROFListOnEscape(event) {\n        if ($mrofContainer && event.keyCode === KeyEvent.DOM_VK_ESCAPE) {\n            _hideMROFList();\n        }\n    }\n\n    /**\n     * Shows the current MROF list\n     * @private\n     */\n    function _createMROFDisplayList(refresh) {\n        var $def = $.Deferred();\n\n        var $mrofList, $link, $newItem;\n\n        /**\n         * Clears the MROF list in memory and pop over but retains the working set entries\n         * @private\n         */\n        function _purgeAllExceptWorkingSet() {\n            _mrofList = _createMROFList();\n            $mrofList.empty();\n            _createMROFDisplayList(true);\n            $currentContext = null;\n            PreferencesManager.setViewState(OPEN_FILES_VIEW_STATE, _mrofList, PreferencesManager.STATE_PROJECT_CONTEXT);\n        }\n\n        if (!refresh) {\n            // Call hide first to make sure we are not creating duplicate lists\n            _hideMROFList();\n            $mrofContainer = $(Mustache.render(htmlTemplate, {Strings: Strings})).appendTo('body');\n            $(\"#mrof-list-close\").one(\"click\", _hideMROFList);\n            // Attach clear list handler to the 'Clear All' button\n            $(\"#mrof-container .footer > div#clear-mrof-list\").on(\"click\", _purgeAllExceptWorkingSet);\n            $(window).on(\"keydown\", _handleArrowKeys);\n            $(window).on(\"keyup\", _hideMROFListOnEscape);\n        }\n\n        $mrofList = $mrofContainer.find(\"#mrof-list\");\n\n        /**\n         * Focus handler for the link in list item\n         * @private\n         */\n        function _onFocus(event) {\n            var $scope = $(event.target).parent();\n            $(\"#mrof-container #mrof-list > li.highlight\").removeClass(\"highlight\");\n            $(event.target).parent().addClass(\"highlight\");\n\n            // convert the virtual path to display path\n            var displayPath = Phoenix.app.getDisplayPath($scope.data(\"path\"));\n            $mrofContainer.find(\"#recent-file-path\").text(displayPath);\n            $mrofContainer.find(\"#recent-file-path\").attr('title', displayPath);\n\n            $currentContext = $scope;\n        }\n\n        /**\n         * Click handler for the link in list item\n         * @private\n         */\n        function _onClick(event) {\n            var $scope = $(event.delegateTarget).parent();\n            _openEditorForContext({\n                path: $scope.data(\"path\"),\n                paneId: $scope.data(\"paneId\"),\n                cursor: $scope.data(\"cursor\"),\n                hideOnOpenFile: true\n            });\n        }\n\n        var data, fileEntry;\n\n        _syncWithFileSystem().always(function () {\n            _mrofList = _mrofList.filter(function (e) { return e; });\n            _createFileEntries($mrofList);\n            var $fileLinks = $(\"#mrof-container #mrof-list > li > a.mroitem\");\n            // Handlers for mouse events on the list items\n            $fileLinks.on(\"focus\", _onFocus);\n            $fileLinks.on(\"click\", _onClick);\n            $fileLinks.on(\"select\", _onClick);\n\n            // Put focus on the Most recent file link in the list\n            $fileLinks.first().trigger(\"focus\");\n\n            $def.resolve();\n        });\n\n        return $def.promise();\n    }\n\n    function _openFile() {\n        if ($currentContext) {\n            _openEditorForContext({\n                path: $currentContext.data(\"path\"),\n                paneId: $currentContext.data(\"paneId\"),\n                cursor: $currentContext.data(\"cursor\")\n            });\n        }\n    }\n\n    function _hideMROFListOnNavigationEnd(event) {\n        if ($mrofContainer && event.keyCode === KeyEvent.DOM_VK_CONTROL) {\n            _openFile();\n            _hideMROFList();\n        }\n    }\n\n\n    /**\n     * Opens the next item in MROF list if pop over is visible else displays the pop over\n     * @private\n     */\n    function _moveNext() {\n        var $context, $next;\n\n        $context = $currentContext || $(\"#mrof-container #mrof-list > li.highlight\");\n        if ($context.length > 0) {\n            $next = $context.next();\n            if ($next.length === 0) {\n                $next = $(\"#mrof-container #mrof-list > li\").first();\n            }\n            if ($next.length > 0) {\n                $currentContext = $next;\n                $next.find(\"a.mroitem\").trigger(\"focus\");\n            }\n        } else {\n            //WTF! (Worse than failure). We should not get here.\n            $(\"#mrof-container #mrof-list > li > a.mroitem:visited\").last().trigger(\"focus\");\n        }\n    }\n\n    function _cmdMoveNext() {\n        var $displayPromise;\n        if (!$mrofContainer) {\n            $displayPromise = _createMROFDisplayList();\n            $mrofContainer.addClass(\"confirmation-mode\");\n            $(window).on(\"keyup\", _hideMROFListOnNavigationEnd);\n        }\n\n        if ($displayPromise) {\n            $displayPromise.always(function () {\n                _moveNext();\n            });\n        } else {\n            _moveNext();\n        }\n    }\n\n    /**\n     * Opens the previous item in MROF list if pop over is visible else displays the pop over\n     * @private\n     */\n    function _movePrev() {\n        var $context, $prev;\n\n        $context = $currentContext || $(\"#mrof-container #mrof-list > li.highlight\");\n        if ($context.length > 0) {\n            $prev = $context.prev();\n            if ($prev.length === 0) {\n                $prev = $(\"#mrof-container #mrof-list > li\").last();\n            }\n            if ($prev.length > 0) {\n                $currentContext = $prev;\n                $prev.find(\"a.mroitem\").trigger(\"focus\");\n            }\n        } else {\n            //WTF! (Worse than failure). We should not get here.\n            $(\"#mrof-container #mrof-list > li > a.mroitem:visited\").last().trigger(\"focus\");\n        }\n    }\n\n    function _cmdMovePrev() {\n        var $displayPromise;\n        if (!$mrofContainer) {\n            $displayPromise = _createMROFDisplayList();\n            $mrofContainer.addClass(\"confirmation-mode\");\n            $(window).on(\"keyup\", _hideMROFListOnNavigationEnd);\n        }\n\n        if ($displayPromise) {\n            $displayPromise.always(function () {\n                _movePrev();\n            });\n        } else {\n            _movePrev();\n        }\n    }\n\n    function _updateCursorPosition(filePath, paneId, cursorPos) {\n        if (!paneId) { // Don't handle this if not a full view/editor\n            return;\n        }\n\n        // Check existing list for this doc path and pane entry\n        var index = _.findIndex(_mrofList, function (record) {\n            return (record && record.file === filePath && record.paneId === paneId);\n        });\n\n        var entry;\n\n        if (index !== -1) {\n            _mrofList[index].cursor = cursorPos;\n        }\n\n        PreferencesManager.setViewState(OPEN_FILES_VIEW_STATE, _mrofList, PreferencesManager.STATE_PROJECT_CONTEXT);\n    }\n\n    /**\n     * Adds an entry to MROF list\n     * @private\n     * @param {Editor} editor - editor to extract file information\n     */\n    function _addToMROFList(file, paneId, cursorPos) {\n\n        var filePath = file.fullPath;\n\n        if (!paneId) { // Don't handle this if not a full view/editor\n            return;\n        }\n\n\n        // Check existing list for this doc path and pane entry\n        var index = _.findIndex(_mrofList, function (record) {\n            return (record && record.file === filePath && record.paneId === paneId);\n        });\n\n        var entry;\n        if (index !== -1) {\n            entry = _mrofList[index];\n            if (entry.cursor && !cursorPos) {\n                cursorPos = entry.cursor;\n            }\n        }\n\n        entry = _makeMROFListEntry(filePath, paneId, cursorPos);\n\n        // Check if the file is an InMemoryFile\n        if (file.constructor.name === \"InMemoryFile\") {\n            // Mark the entry as inMem, so that we can knock it off from the list when removed from working set\n            entry.inMem = true;\n        }\n\n\n        if (index !== -1) {\n            _mrofList.splice(index, 1);\n        }\n\n        // add it to the front of the list\n        _mrofList.unshift(entry);\n\n        PreferencesManager.setViewState(OPEN_FILES_VIEW_STATE, _mrofList, PreferencesManager.STATE_PROJECT_CONTEXT);\n    }\n\n    // To update existing entry if a move has happened\n    function _handleWorkingSetMove(event, file, sourcePaneId, destinationPaneId) {\n        // Check existing list for this doc path and source pane entry\n        var index = _.findIndex(_mrofList, function (record) {\n                return (record && record.file === file.fullPath && record.paneId === sourcePaneId);\n            }), tIndex;\n        // If an entry is found update the pane info\n        if (index >= 0) {\n            // But an entry with the target pane Id should not exist\n            tIndex = _.findIndex(_mrofList, function (record) {\n                return (record && record.file === file.fullPath && record.paneId === destinationPaneId);\n            });\n            if (tIndex === -1) {\n                _mrofList[index].paneId = destinationPaneId;\n            } else {\n                // Remove this entry as it has been moved.\n                _mrofList.splice(index, 1);\n            }\n        }\n    }\n\n    // Handle project close or app close to set view state\n    function _handleAppClose() {\n        PreferencesManager.setViewState(OPEN_FILES_VIEW_STATE, _mrofList, PreferencesManager.STATE_PROJECT_CONTEXT);\n        _mrofList = [];\n    }\n\n    function _initRecentFilesList() {\n        _mrofList = PreferencesManager.getViewState(OPEN_FILES_VIEW_STATE, PreferencesManager.STATE_PROJECT_CONTEXT) || [];\n\n        _mrofList = _mrofList.filter(function (entry) {\n            return entry;\n        });\n        // Have a check on the number of entries to fallback to working set if we detect corruption\n        if (_mrofList.length < MainViewManager.getWorkingSetSize(MainViewManager.ALL_PANES)) {\n            _mrofList = _createMROFList();\n        }\n    }\n\n    function _handleProjectOpen() {\n        _mrofList = [];\n        // We will do a late initialization once we get the first editor change or file open notification\n    }\n\n    ProjectManager.on(\"projectOpen\", _handleProjectOpen);\n\n\n    function _showRecentFileList() {\n        if (isRecentFilesNavEnabled) {\n            _createMROFDisplayList();\n        }\n    }\n\n    /**\n     * Hides the current MROF list if visible\n     * @private\n     */\n    _hideMROFList = function () {\n\n        if ($mrofContainer) {\n            $mrofContainer.remove();\n            $mrofContainer = null;\n            $currentContext = null;\n            activeEditor = EditorManager.getActiveEditor();\n            if (activeEditor) {\n                activeEditor.focus();\n            }\n        }\n\n        $(window).off(\"keydown\", _handleArrowKeys);\n        $(window).off(\"keyup\", _hideMROFListOnNavigationEnd);\n        $(window).off(\"keyup\", _hideMROFListOnEscape);\n    };\n\n    // To take care of hiding the popover during app navigation in os using key board shortcuts\n    $(window).on(\"blur focus\", function () {\n        _hideMROFList();\n    });\n\n    // Merges the entries to a single pane if split view have been merged\n    // Then purges duplicate entries in mrof list\n    function _handlePaneMerge(e, paneId) {\n        var index;\n        var targetPaneId = MainViewManager.FIRST_PANE;\n\n        $.each(_mrofList, function (itrIndex, value) {\n            if (value && value.paneId === paneId) { // We have got an entry which needs merge\n                // Before modifying the actual pane info check if an entry exists with same target pane\n                index = _.findIndex(_mrofList, function (record) {\n                    return (record && record.file === value.file && record.paneId === targetPaneId);\n                });\n                if (index !== -1) { // A duplicate entry found, remove the current one instead of updating\n                    _mrofList[index] = null;\n                } else { // Update with merged pane info\n                    _mrofList[itrIndex].paneId = targetPaneId;\n                }\n            }\n        });\n\n        // Clean the null/undefined entries\n        _mrofList = _mrofList.filter(function (e) { return e; });\n\n        PreferencesManager.setViewState(OPEN_FILES_VIEW_STATE, _mrofList, PreferencesManager.STATE_PROJECT_CONTEXT);\n    }\n\n    function _initRecentFileMenusAndCommands() {\n        // Command to show recent files list\n\n        if (!CommandManager.get(SHOW_RECENT_FILES)) {\n            CommandManager.register(Strings.CMD_RECENT_FILES_OPEN, SHOW_RECENT_FILES, _showRecentFileList);\n            KeyBindingManager.addBinding(SHOW_RECENT_FILES,\n                Phoenix.isNativeApp ? \"Ctrl-R\" : \"Ctrl-Alt-Shift-O\");\n        }\n\n        // Keyboard only - Navigate to the next doc in MROF list\n        if (!CommandManager.get(NEXT_IN_RECENT_FILES)) {\n            CommandManager.register(Strings.CMD_NEXT_DOC, NEXT_IN_RECENT_FILES, _cmdMoveNext);\n        }\n        KeyBindingManager.addBinding(NEXT_IN_RECENT_FILES, KeyboardPrefs[NEXT_IN_RECENT_FILES]);\n\n        // Keyboard only - Navigate to the prev doc in MROF list\n        if (!CommandManager.get(PREV_IN_RECENT_FILES)) {\n            CommandManager.register(Strings.CMD_PREV_DOC, PREV_IN_RECENT_FILES, _cmdMovePrev);\n        }\n        KeyBindingManager.addBinding(PREV_IN_RECENT_FILES, KeyboardPrefs[PREV_IN_RECENT_FILES]);\n\n        var menu = Menus.getMenu(Menus.AppMenuBar.FILE_MENU);\n        menu.addMenuItem(SHOW_RECENT_FILES, \"\", Menus.AFTER, Commands.FILE_REOPEN_CLOSED);\n    }\n\n    function _initDefaultNavigationCommands() {\n        KeyBindingManager.addBinding(Commands.NAVIGATE_NEXT_DOC, KeyboardPrefs[NEXT_IN_RECENT_FILES]);\n        KeyBindingManager.addBinding(Commands.NAVIGATE_PREV_DOC, KeyboardPrefs[PREV_IN_RECENT_FILES]);\n    }\n\n    function _removeKeys(keys) {\n        _.forEach(keys, function (config) {\n            KeyBindingManager.removeBinding(config.key);\n        });\n    }\n\n    function _removeNavigationKeys() {\n        _removeKeys(KeyboardPrefs[NEXT_IN_RECENT_FILES]);\n        _removeKeys(KeyboardPrefs[PREV_IN_RECENT_FILES]);\n    }\n\n    function _deregisterSortcutsAndMenus() {\n        _removeNavigationKeys();\n        Menus.getMenu(Menus.AppMenuBar.FILE_MENU).removeMenuItem(SHOW_RECENT_FILES);\n    }\n\n    // Handle current file change\n    function handleCurrentFileChange(e, newFile, newPaneId, oldFile) {\n        if (newFile) {\n            if (_mrofList.length === 0) {\n                _initRecentFilesList();\n            }\n\n\t        _addToMROFList(newFile, newPaneId);\n        }\n    }\n\n    // Handle Active Editor change to update mrof information\n    function _handleActiveEditorChange(event, current, previous) {\n        if (current) { // Handle only full editors\n            if (_mrofList.length === 0) {\n                _initRecentFilesList();\n            }\n\n            var file = current.document.file;\n            var paneId = current._paneId;\n            _addToMROFList(file, paneId, current.getCursorPos(true, \"first\"));\n        }\n\n        if (previous) { // Capture the last know cursor position\n            _updateCursorPosition(previous.document.file.fullPath, previous._paneId, previous.getCursorPos(true, \"first\"));\n        }\n    }\n\n    function _attachListners() {\n        MainViewManager.on(\"workingSetMove.pane-first-pane\", _handleWorkingSetMove);\n        MainViewManager.on(\"currentFileChange\", handleCurrentFileChange);\n        MainViewManager.on(\"paneDestroy\", _handlePaneMerge);\n        EditorManager.on(\"activeEditorChange\", _handleActiveEditorChange);\n        ProjectManager.on(\"beforeProjectClose beforeAppClose\", _handleAppClose);\n    }\n\n    function _detachListners() {\n        MainViewManager.off(\"workingSetMove.pane-first-pane\", _handleWorkingSetMove);\n        MainViewManager.off(\"currentFileChange\", handleCurrentFileChange);\n        MainViewManager.off(\"paneDestroy\", _handlePaneMerge);\n        EditorManager.off(\"activeEditorChange\", _handleActiveEditorChange);\n        ProjectManager.off(\"beforeProjectClose beforeAppClose\", _handleAppClose);\n    }\n\n    PreferencesManager.on(\"change\", PREFS_RECENT_FILES, function () {\n        if (PreferencesManager.get(PREFS_RECENT_FILES)) {\n            _removeNavigationKeys();\n            _initRecentFileMenusAndCommands();\n            _mrofList = [];\n            _initRecentFilesList();\n            PreferencesManager.setViewState(OPEN_FILES_VIEW_STATE, _mrofList, PreferencesManager.STATE_PROJECT_CONTEXT);\n            _detachListners();\n            _attachListners();\n            isRecentFilesNavEnabled = true;\n        } else {\n            // Reset the view state to empty\n            _mrofList = [];\n            PreferencesManager.setViewState(OPEN_FILES_VIEW_STATE, _mrofList, PreferencesManager.STATE_PROJECT_CONTEXT);\n            _deregisterSortcutsAndMenus();\n            _initDefaultNavigationCommands();\n            _detachListners();\n            isRecentFilesNavEnabled = false;\n        }\n    });\n\n    AppInit.appReady(function () {\n        FileRecovery.init();\n        NavigationProvider.init();\n    });\n});\n"],"file":"main.js"}