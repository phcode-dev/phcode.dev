{"version":3,"sources":["assets/new-project/assets/js/new-github-project.js"],"names":["browserInit","createProjectBtn","websiteURLInput","locationInput","FLATTEN_ZIP_FIRST_LEVEL_DIR","_isValidGitHubURL","url","githubPrefix","components","replace","split","startsWith","length","_fixGitHubBrokenURL","gitSuffix","githubURL","value","queryParamTrimIndex","indexOf","substring","endsWith","RegExp","_validateGitHubURL","$messageDisplay","$","removeClass","html","addClass","Strings","ERROR_ONLY_GITHUB","_validateProjectLocation","window","showDirectoryPicker","location","PLEASE_SELECT_A_FOLDER","_validate","_selectFolder","newProjectExtension","showFolderSelect","then","file","fullPath","getMountDir","_createProjectClicked","zipURL","suggestedProjectName","downloadAndOpenProject","Metrics","countEvent","EVENT_TYPE","NEW_PROJECT","closeDialogue","showErrorDialogue","MISSING_FIELDS","PLEASE_FILL_ALL_REQUIRED","initGitProject","document","getElementById","text","GIT_REPO_URL","onclick","keyup","top","Phoenix","isNativeApp"],"mappings":"AAyBA,SAASA,cACL,IAAIC,iBAAkBC,gBAAiBC,cACvC,MAAMC,6BAA8B,EAEpC,SAASC,kBAAkBC,KAGvB,IAAIC,aAAe,sBACfC,YAFJF,IAAMA,IAAIG,QAAQ,MAAO,KAEJA,QAAQ,sBAAuB,IAAIC,MAAM,KAC9D,SAAIJ,IAAIK,WAAWJ,eAAuC,IAAtBC,WAAWI,QAMnD,SAASC,sBACL,IAAIN,aAAe,sBACfO,UAAY,OACZC,UAAYb,gBAAgBc,MAIhC,GAHGD,UAAUJ,WAAW,WACpBI,UAAYA,UAAUN,QAAQ,QAAS,YAEvCM,UAAUJ,WAAWJ,cACrB,OAGJ,IAAIU,oBAAuBF,UAAUG,QAAQ,MAAQ,EAAIH,UAAUG,QAAQ,KAAOH,UAAUH,OAGxFJ,YAFJO,UAAYA,UAAUI,UAAU,EAAGF,sBAERR,QAAQ,sBAAuB,IAAIC,MAAM,KAEjEK,UAAUK,SAdG,UAeZL,UAAYA,UAAUN,QAAQ,IAAIY,OAAOP,SAAkB,KAE5DN,WAAWI,OAAS,IACnBG,gCAAkCP,WAAW,MAAMA,WAAW,MAElEN,gBAAgBc,MAAQD,UAG5B,SAASO,qBACLT,sBACA,IAAIE,UAAYb,gBAAgBc,MAChC,MAAMO,gBAAkBC,EAAE,mBAC1B,OAAGnB,kBAAkBU,YACjBS,EAAEtB,iBAAiBuB,YAAY,gBAC/BF,gBAAgBG,KAAK,KACd,IAEXF,EAAEtB,iBAAiByB,SAAS,gBAC5BJ,gBAAgBG,4FAA4FE,QAAQC,6BAC7G,GAGX,SAASC,2BACL,IAAIC,OAAOC,oBAEP,OAAO,EAEX,IAAIC,SACJ,OADe9B,cAAca,QACZY,QAAQM,wBACrBV,EAAErB,eAAewB,SAAS,iBACnB,IAEXH,EAAErB,eAAesB,YAAY,iBACtB,GAGX,SAASU,YACL,OAAOb,sBACAQ,2BAGX,SAASM,gBACLC,oBAAoBC,mBACfC,KAAKC,OACFrC,cAAcsC,SAAWD,KACzBrC,cAAca,MAAQwB,KAAK/B,QAAQ4B,oBAAoBK,cAAe,IACtEZ,6BAIZ,SAASa,wBACL,GAAGR,YAAY,CACX,IAAIpB,UACAP,WADYN,gBAAgBc,MACLP,QAAQ,sBAAuB,IAAIC,MAAM,KAChEkC,+CAAiDpC,WAAW,WAAWA,WAAW,KAClFqC,wBAA0BrC,WAAW,MAAMA,WAAW,KAC1D6B,oBAAoBS,uBAChBF,OACAzC,cAAcsC,SAAUI,qBAAsBzC,6BAC7CmC,KAAK,KACFQ,QAAQC,WAAWD,QAAQE,WAAWC,YAAa,eAAgB,kBACnEb,oBAAoBc,uBAG5Bd,oBAAoBe,kBAChBxB,QAAQyB,eACRzB,QAAQ0B,0BAEhBP,QAAQC,WAAWD,QAAQE,WAAWC,YAAa,eAAgB,UAGvE,SAASK,iBACDxB,OAAOC,qBACPR,EAAEgC,SAASC,eAAe,oBAAoB9B,SAAS,iBAE3DH,EAAE,gBAAgBkC,KAAK9B,QAAQ+B,cAC/B1D,iBAAmBuD,SAASC,eAAe,oBAC3CvD,gBAAkBsD,SAASC,eAAe,mBAC1CtD,cAAgBqD,SAASC,eAAe,iBACxCxD,iBAAiB2D,QAAUjB,sBAC3BnB,EAAEtB,iBAAiB2D,MAAM1B,WACzBhC,cAAca,MAAQY,QAAQM,uBAC9B/B,cAAcyD,QAAUxB,cACxBlC,gBAAgBc,MAAQ,uDACxBmB,YAEJJ,OAAOwB,eAAiBA,eAGxBxB,OAAO+B,IAAIC,QAAQC,aACnBhE","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global newProjectExtension, Strings, Metrics*/\n/*eslint no-console: 0*/\n/*eslint strict: [\"error\", \"global\"]*/\n/* jshint ignore:start */\n\nfunction browserInit() {\n    let createProjectBtn, websiteURLInput, locationInput;\n    const FLATTEN_ZIP_FIRST_LEVEL_DIR = true;\n\n    function _isValidGitHubURL(url) {\n        // strip trailing slash\n        url = url.replace(/\\/$/, \"\");\n        let githubPrefix = \"https://github.com/\";\n        let components = url.replace(\"https://github.com/\", '').split('/');\n        if(!url.startsWith(githubPrefix) || components.length !== 2){\n            return false;\n        }\n        return true;\n    }\n\n    function _fixGitHubBrokenURL() {\n        let githubPrefix = \"https://github.com/\",\n            gitSuffix = '.git';\n        let githubURL = websiteURLInput.value;\n        if(githubURL.startsWith(\"http:\")){\n            githubURL = githubURL.replace(\"http:\", \"https:\");\n        }\n        if(!githubURL.startsWith(githubPrefix)){\n            return;\n        }\n        // strip any query string params if present\n        let queryParamTrimIndex  = githubURL.indexOf('?') >= 0 ? githubURL.indexOf('?') : githubURL.length;\n        githubURL = githubURL.substring(0, queryParamTrimIndex);\n        // trim everything after https://github.com/orgname/repo/... to https://github.com/orgname/repo\n        let components = githubURL.replace(\"https://github.com/\", '').split('/');\n        // trim .git at the end of the name\n        if(githubURL.endsWith(gitSuffix)){\n            githubURL = githubURL.replace(new RegExp(gitSuffix + '$'), '');\n        }\n        if(components.length > 2){\n            githubURL = `https://github.com/${components[0]}/${components[1]}`;\n        }\n        websiteURLInput.value = githubURL;\n    }\n\n    function _validateGitHubURL() {\n        _fixGitHubBrokenURL();\n        let githubURL = websiteURLInput.value;\n        const $messageDisplay = $(\"#messageDisplay\");\n        if(_isValidGitHubURL(githubURL)){\n            $(websiteURLInput).removeClass(\"error-border\");\n            $messageDisplay.html(\"\");\n            return true;\n        }\n        $(websiteURLInput).addClass(\"error-border\");\n        $messageDisplay.html(`<span><i class=\"fas fa-exclamation-triangle\" style=\"color: #f89406\"></i>&nbsp;&nbsp;${Strings.ERROR_ONLY_GITHUB}</span>`);\n        return false;\n    }\n\n    function _validateProjectLocation() {\n        if(!window.showDirectoryPicker){\n            // fs access apis not present, so we will give phoenix empty location to figure out a suitable location\n            return true;\n        }\n        let location = locationInput.value;\n        if( location === Strings.PLEASE_SELECT_A_FOLDER){\n            $(locationInput).addClass(\"error-border\");\n            return false;\n        }\n        $(locationInput).removeClass(\"error-border\");\n        return true;\n    }\n\n    function _validate() {\n        return _validateGitHubURL()\n            && _validateProjectLocation();\n    }\n\n    function _selectFolder() {\n        newProjectExtension.showFolderSelect()\n            .then(file =>{\n                locationInput.fullPath = file;\n                locationInput.value = file.replace(newProjectExtension.getMountDir(), \"\");\n                _validateProjectLocation();\n            });\n    }\n\n    function _createProjectClicked() {\n        if(_validate()){\n            let githubURL = websiteURLInput.value;\n            let components = githubURL.replace(\"https://github.com/\", '').split('/');\n            let zipURL = `https://phcode.site/getGitHubZip?org=${components[0]}&repo=${components[1]}`;\n            let suggestedProjectName = `${components[0]}-${components[1]}`;\n            newProjectExtension.downloadAndOpenProject(\n                zipURL,\n                locationInput.fullPath, suggestedProjectName, FLATTEN_ZIP_FIRST_LEVEL_DIR)\n                .then(()=>{\n                    Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT, \"github.Click\", \"create.success\");\n                    newProjectExtension.closeDialogue();\n                });\n        } else {\n            newProjectExtension.showErrorDialogue(\n                Strings.MISSING_FIELDS,\n                Strings.PLEASE_FILL_ALL_REQUIRED);\n        }\n        Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT, \"github.Click\", \"create\");\n    }\n\n    function initGitProject() {\n        if(!window.showDirectoryPicker){ // fs access apis not present\n            $(document.getElementById(\"projectLocation\")).addClass(\"forced-hidden\");\n        }\n        $(\".label-clone\").text(Strings.GIT_REPO_URL);\n        createProjectBtn = document.getElementById(\"createProjectBtn\");\n        websiteURLInput = document.getElementById(\"websiteURLInput\");\n        locationInput = document.getElementById(\"locationInput\");\n        createProjectBtn.onclick = _createProjectClicked;\n        $(websiteURLInput).keyup(_validate);\n        locationInput.value = Strings.PLEASE_SELECT_A_FOLDER;\n        locationInput.onclick = _selectFolder;\n        websiteURLInput.value = \"https://github.com/phcode-dev/HTML-Starter-Templates\";\n        _validate();\n    }\n    window.initGitProject = initGitProject;\n}\n\nif(!window.top.Phoenix.isNativeApp){\n    browserInit();\n}\n"],"file":"new-github-project.js"}