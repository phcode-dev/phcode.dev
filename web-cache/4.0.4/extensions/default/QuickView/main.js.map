{"version":3,"sources":["extensions/default/QuickView/extension-min.js"],"names":["define","require","exports","module","ExtensionUtils","brackets","getModule","loadStyleSheet","FileUtils","FileSystem","PreferencesManager","LanguageManager","Strings","PathUtils","AppInit","QuickView","Metrics","FileViewController","enabled","prefs","extensionlessImagePreview","validProtocols","_transformToIframePath","url","startsWith","utube","URL","vidLink","searchParams","get","getQuickView","editor","pos","token","line","Promise","resolve","reject","urlRegEx","tokenString","urlMatch","sPos","ePos","type","string","exec","ch","index","length","replace","docPath","document","file","fullPath","imgPath","parsed","parseUrl","hasProtocol","protocol","indexOf","trim","toLowerCase","ext","filenameExtension","language","getLanguageForExtension","id","getId","isImage","loadFromDisk","window","path","normalize","getDirectoryPath","start","end","$imgPreview","$","_tryLoadingURLInIframe","$iframe","find","append","showHandlerWithImageURL","imageURL","img","src","on","this","naturalWidth","naturalHeight","UNIT_PIXELS","e","remove","preventDefault","_imageToDataURI","cb","contentType","doNotCache","name","endsWith","read","encoding","fs","BYTE_ARRAY_ENCODING","err","content","base64","btoa","Uint8Array","reduce","data","byte","String","fromCharCode","dataURL","attr","previewPopup","imageFile","getFileForPath","click","openAndSelectDocument","PROJECT_MANAGER","countEvent","EVENT_TYPE","QUICK_VIEW","setExtensionlessImagePreview","_extensionlessImagePreview","doNotSave","set","save","getExtensionPrefs","definePreference","description","DESCRIPTION_EXTENSION_LESS_IMAGE_PREVIEW","appReady","registerQuickViewProvider","QUICK_VIEW_NAME","ColorUtils","CSSUtils","TokenUtils","EditorManager","CommandManager","MainViewManager","Commands","styleLanguages","gradientRegEx","colorRegEx","RegExp","COLOR_REGEX","mode","getModeAt","_codeMirror","isStyleSheet","areParensBalanced","str","i","nestLevel","len","reduceStyleSheetForRegExParsing","execGradientMatch","parensBalanced","gradientMatch","prefix","colorValue","match","execColorMatch","colorMatch","ignoreNamedColors","hyphenOnMatchBoundary","beforeIndex","afterIndex","isNamedColor","test","undefined","splitStyleProperty","property","recurse","array","result","join","push","isGradientColorStop","args","hasLengthInPixels","ensureHexFormat","normalizeGradientExpressionForQuickview","expression","paramStart","paramEnd","lastIndexOf","parameters","params","substring","lowerBound","upperBound","width","thisSize","split","parseFloat","Math","max","min","abs","previewCSS","startPos","endPos","found","tooltip","TOOLTIP_CLICK_TO_EDIT_COLOR","preview","EDIT","fullEditor","getCurrentFullEditor","foundResult","findInAllWorkingSets","paneToOpen","pane","WORKING_SET_VIEW","done","setCursorPos","execute","TOGGLE_QUICK_EDIT","colorGradientProvider","PREF_ENABLED_KEY","DESCRIPTION_NUMBER_QUICK_VIEW","lastOriginId","_splitNumber","numStr","number","decimalPlaces","roundTo","units","_getWordAfterPos","wordRange","getWordAt","text","slice","wordFull","getTextBetween","startChInWord","effectiveStartPos","effectiveEndPos","trimmedWord","_isCSSUnit","regexPattern","startCh","endCh","numberStr","getNumberAt","nextPos","nextWord","editOrigin","$content","changedMetricSent","knob","stopper","step","height","fgColor","fontSize","format","value","round","getValue","userInput","changedSplit","change","batchOperation","setSelection","replaceStr","replaceRange","changeStart","lockQuickView","changeEnd","unlockQuickView","exclusive","editsDoc","filterQuickView","popovers","hasColorQuickView","popover","providerInfo","provider","filter"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*jslint regexp: true */\n\ndefine(function (require, exports, module) {\n    const ExtensionUtils      = brackets.getModule(\"utils/ExtensionUtils\");\n    require(\"./colorGradientProvider\");\n    require(\"./ImagePreviewProvider\");\n    require(\"./numberPreviewProvider\");\n\n    // Load our stylesheet\n    ExtensionUtils.loadStyleSheet(module, \"QuickView.less\");\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*jslint regexp: true */\n\ndefine(\"ImagePreviewProvider\", function (require, exports, module) {\n\n\n    // Brackets modules\n    let FileUtils           = brackets.getModule(\"file/FileUtils\"),\n        FileSystem          = brackets.getModule(\"filesystem/FileSystem\"),\n        PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        LanguageManager     = brackets.getModule(\"language/LanguageManager\"),\n        Strings             = brackets.getModule(\"strings\"),\n        PathUtils           = brackets.getModule(\"thirdparty/path-utils/path-utils\"),\n        AppInit             = brackets.getModule(\"utils/AppInit\"),\n        QuickView           = brackets.getModule(\"features/QuickViewManager\"),\n        Metrics             = brackets.getModule(\"utils/Metrics\"),\n        FileViewController  = brackets.getModule(\"project/FileViewController\");\n\n    let enabled,                             // Only show preview if true\n        prefs                      = null,   // Preferences\n        extensionlessImagePreview;           // Whether to try and preview extensionless URLs\n\n    // List of protocols which we will support for image preview urls\n    let validProtocols = [\"data:\", \"http:\", \"https:\", \"phtauri:\", \"asset:\", \"ftp:\", \"file:\"];\n\n    prefs = PreferencesManager.getExtensionPrefs(\"quickview\");\n\n    // Whether or not to try and show image previews for URLs missing extensions\n    // (e.g., https://avatars2.githubusercontent.com/u/476009?v=3&s=200)\n    prefs.definePreference(\"extensionlessImagePreview\", \"boolean\", true, {\n        description: Strings.DESCRIPTION_EXTENSION_LESS_IMAGE_PREVIEW\n    });\n\n\n    function _transformToIframePath(url) {\n        if(url && url.startsWith(\"https://www.youtube.com/watch?\")){\n            // YouTube special handling- try to play the embedded link for YouTube videos.\n            const utube = new URL(url);\n            const vidLink = utube.searchParams.get(\"v\");\n            if(vidLink) {\n                return `https://www.youtube.com/embed/${vidLink}`;\n            }\n        }\n        return url;\n    }\n\n    // Image preview provider -------------------------------------------------\n\n    function getQuickView(editor, pos, token, line) {\n\n        return new Promise((resolve, reject)=>{\n            // Check for image name\n            let urlRegEx = /url\\(([^\\)]*)\\)/gi,\n                tokenString,\n                urlMatch;\n\n            if (token.type === \"string\") {\n                tokenString = token.string;\n            } else {\n                urlMatch = urlRegEx.exec(line);\n                while (urlMatch) {\n                    if (pos.ch < urlMatch.index) {\n                        // match is past cursor, so stop looping\n                        break;\n                    } else if (pos.ch <= urlMatch.index + urlMatch[0].length) {\n                        tokenString = urlMatch[1];\n                        break;\n                    }\n                    urlMatch = urlRegEx.exec(line);\n                }\n            }\n\n            if (!tokenString) {\n                reject();\n                return;\n            }\n\n            // Strip leading/trailing quotes, if present\n            tokenString = tokenString.replace(/(^['\"])|(['\"]$)/g, \"\");\n\n            let sPos, ePos;\n            let docPath = editor.document.file.fullPath;\n            let imgPath;\n\n            // Determine whether or not this URL/path is likely to be an image.\n            let parsed = PathUtils.parseUrl(tokenString);\n            // If the URL has a protocol, check if it's one of the supported protocols\n            let hasProtocol = parsed.protocol !== \"\" && validProtocols.indexOf(parsed.protocol.trim().toLowerCase()) !== -1;\n            let ext = parsed.filenameExtension.replace(/^\\./, '');\n            let language = LanguageManager.getLanguageForExtension(ext);\n            let id = language && language.getId();\n            let isImage = id === \"image\" || id === \"svg\";\n            let loadFromDisk = null;\n\n            // Use this URL if this is an absolute URL and either points to a\n            // filename with a known image extension, or lacks an extension (e.g.,\n            // a web service that returns an image). Honour the extensionlessImagePreview\n            // preference as well in the latter case.\n            if (hasProtocol && (isImage || (!ext && extensionlessImagePreview))) {\n                imgPath = tokenString;\n            }\n            // Use this filename if this is a path with a known image extension.\n            else if (!hasProtocol && isImage) {\n                imgPath = '';\n                loadFromDisk = window.path.normalize(FileUtils.getDirectoryPath(docPath) + tokenString);\n            }\n\n            if (!loadFromDisk && !imgPath) {\n                reject();\n                return;\n            }\n\n            if (urlMatch) {\n                sPos = {line: pos.line, ch: urlMatch.index};\n                ePos = {line: pos.line, ch: urlMatch.index + urlMatch[0].length};\n            } else {\n                sPos = {line: pos.line, ch: token.start};\n                ePos = {line: pos.line, ch: token.end};\n            }\n\n            let $imgPreview = $(\"<div id='quick-view-image-preview'><div class='image-preview'>\"          +\n                \"    <img src=\\\"\" + imgPath + \"\\\">\"    +\n                \"</div></div>\");\n\n            function _tryLoadingURLInIframe() {\n                let $iframe = $(`<iframe class='image-preview' src=\"${_transformToIframePath(imgPath)}\">`);\n                $imgPreview.find(\".image-preview\").append($iframe);\n            }\n\n            function showHandlerWithImageURL(imageURL) {\n                // Hide the preview container until the image is loaded.\n                let img = $imgPreview.find(\"img\");\n                if(imageURL){\n                    img[0].src = imageURL;\n                }\n\n                img.on(\"load\", function () {\n                    $imgPreview\n                        .append(\"<div class='img-size'>\" +\n                            this.naturalWidth + \" &times; \" + this.naturalHeight + \" \" + Strings.UNIT_PIXELS +\n                            \"</div>\"\n                        );\n                }).on(\"error\", function (e) {\n                    img.remove();\n                    _tryLoadingURLInIframe();\n                    e.preventDefault();\n                });\n            }\n\n            function _imageToDataURI(file, cb) {\n                let contentType = \"data:image;base64,\";\n                let doNotCache = false;\n                if(file.name.endsWith('.svg')){\n                    contentType = \"data:image/svg+xml;base64,\";\n                    doNotCache = true;\n                }\n                file.read({encoding: window.fs.BYTE_ARRAY_ENCODING, doNotCache}, function (err, content) {\n                    if(err){\n                        cb(err);\n                        return;\n                    }\n                    let base64 = window.btoa(\n                        new Uint8Array(content)\n                            .reduce((data, byte) => data + String.fromCharCode(byte), '')\n                    );\n                    let dataURL= contentType + base64;\n                    cb(null, dataURL);\n                });\n            }\n\n            $imgPreview.attr(\"data-for-test\", imgPath || loadFromDisk);\n\n            let previewPopup = {\n                start: sPos,\n                end: ePos,\n                content: $imgPreview\n            };\n\n            if(loadFromDisk){\n                let imageFile = FileSystem.getFileForPath(loadFromDisk);\n                _imageToDataURI(imageFile, function (err, dataURL){\n                    if(!err){\n                        $imgPreview.click(function () {\n                            FileViewController.openAndSelectDocument(imageFile.fullPath,\n                                FileViewController.PROJECT_MANAGER);\n                            Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW, \"image\", \"click\");\n                        });\n                        showHandlerWithImageURL(dataURL);\n                        Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW, \"image\", \"show\");\n                        resolve(previewPopup);\n                    } else {\n                        reject();\n                    }\n                });\n            } else {\n                showHandlerWithImageURL();\n                resolve(previewPopup);\n            }\n        });\n    }\n\n    function setExtensionlessImagePreview(_extensionlessImagePreview, doNotSave) {\n        if (extensionlessImagePreview !== _extensionlessImagePreview) {\n            extensionlessImagePreview = _extensionlessImagePreview;\n            if (!doNotSave) {\n                prefs.set(\"extensionlessImagePreview\", enabled);\n                prefs.save();\n            }\n        }\n    }\n\n    setExtensionlessImagePreview(prefs.get(\"extensionlessImagePreview\"), true);\n\n    prefs.on(\"change\", \"extensionlessImagePreview\", function () {\n        setExtensionlessImagePreview(prefs.get(\"extensionlessImagePreview\"));\n    });\n\n    AppInit.appReady(function () {\n        QuickView.registerQuickViewProvider(exports, [\"all\"]);\n    });\n\n    exports.getQuickView = getQuickView;\n    exports.QUICK_VIEW_NAME = \"ImagePreviewProvider\";\n\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*jslint regexp: true */\n\ndefine(\"colorGradientProvider\", function (require, exports, module) {\n\n\n    // Brackets modules\n    const ColorUtils        = brackets.getModule(\"utils/ColorUtils\"),\n        CSSUtils            = brackets.getModule(\"language/CSSUtils\"),\n        TokenUtils          = brackets.getModule(\"utils/TokenUtils\"),\n        AppInit             = brackets.getModule(\"utils/AppInit\"),\n        EditorManager       = brackets.getModule(\"editor/EditorManager\"),\n        QuickView           = brackets.getModule(\"features/QuickViewManager\"),\n        Strings             = brackets.getModule(\"strings\"),\n        Metrics             = brackets.getModule(\"utils/Metrics\"),\n        CommandManager      = brackets.getModule(\"command/CommandManager\"),\n        MainViewManager     = brackets.getModule(\"view/MainViewManager\"),\n        FileViewController  = brackets.getModule(\"project/FileViewController\"),\n        Commands            = brackets.getModule(\"command/Commands\");\n\n    let styleLanguages = [\"css\", \"text/x-less\", \"sass\", \"text/x-scss\", \"stylus\"];\n\n    function getQuickView(editor, pos, token, line) {\n        return new Promise((resolve, reject)=>{\n            // Check for gradient. -webkit-gradient() can have parens in parameters\n            // nested 2 levels. Other gradients can only nest 1 level.\n            let gradientRegEx = /-webkit-gradient\\((?:[^\\(]*?(?:\\((?:[^\\(]*?(?:\\([^\\)]*?\\))*?)*?\\))*?)*?\\)|(?:(?:-moz-|-ms-|-o-|-webkit-|:|\\s)((repeating-)?linear-gradient)|(?:-moz-|-ms-|-o-|-webkit-|:|\\s)((repeating-)?radial-gradient))(\\((?:[^\\)]*?(?:\\([^\\)]*?\\))*?)*?\\))/gi,\n                colorRegEx    = new RegExp(ColorUtils.COLOR_REGEX),\n                mode          = TokenUtils.getModeAt(editor._codeMirror, pos, false),\n                isStyleSheet  = (styleLanguages.indexOf(mode) !== -1);\n\n            function areParensBalanced(str) {\n                let i,\n                    nestLevel = 0,\n                    len;\n\n                if (isStyleSheet) {\n                    // Remove comments & strings from style sheets\n                    str = CSSUtils.reduceStyleSheetForRegExParsing(str);\n                }\n                len = str.length;\n\n                for (i = 0; i < len; i++) {\n                    switch (str[i]) {\n                    case \"(\":\n                        nestLevel++;\n                        break;\n                    case \")\":\n                        nestLevel--;\n                        break;\n                    case \"\\\\\":\n                        i++;    // next char is escaped, so skip it\n                        break;\n                    }\n                }\n\n                // if parens are balanced, nest level will be 0\n                return (nestLevel === 0);\n            }\n\n            function execGradientMatch(line, parensBalanced) {\n                // Unbalanced parens cause infinite loop (see issue #4650)\n                let gradientMatch = (parensBalanced ? gradientRegEx.exec(line) : null),\n                    prefix = \"\",\n                    colorValue;\n\n                if (gradientMatch) {\n                    if (gradientMatch[0].indexOf(\"@\") !== -1) {\n                        // If the gradient match has \"@\" in it, it is most likely a less or\n                        // sass letiable. Ignore it since it won't be displayed correctly.\n                        gradientMatch = null;\n\n                    } else {\n                        // If it was a linear-gradient or radial-gradient letiant with a vendor prefix\n                        // add \"-webkit-\" so it shows up correctly in Brackets.\n                        if (gradientMatch[0].match(/-o-|-moz-|-ms-|-webkit-/i)) {\n                            prefix = \"-webkit-\";\n                        }\n\n                        // For prefixed gradients, use the non-prefixed value as the color value.\n                        // \"-webkit-\" will be added before this value later\n                        if (gradientMatch[1]) {\n                            colorValue = gradientMatch[1] + gradientMatch[5];    // linear gradiant\n                        } else if (gradientMatch[3]) {\n                            colorValue = gradientMatch[3] + gradientMatch[5];    // radial gradiant\n                        } else if (gradientMatch[0]) {\n                            colorValue = gradientMatch[0];                       // -webkit-gradient\n                            prefix = \"\";                                         // do not prefix\n                        }\n                    }\n                }\n\n                return {\n                    match: gradientMatch,\n                    prefix: prefix,\n                    colorValue: colorValue\n                };\n            }\n\n            function execColorMatch(editor, line, pos) {\n                let colorMatch,\n                    ignoreNamedColors;\n\n                function hyphenOnMatchBoundary(match, line) {\n                    let beforeIndex, afterIndex;\n                    if (match) {\n                        beforeIndex = match.index - 1;\n                        if (beforeIndex >= 0 && line[beforeIndex] === \"-\") {\n                            return true;\n                        }\n                        afterIndex = match.index + match[0].length;\n                        if (afterIndex < line.length && line[afterIndex] === \"-\") {\n                            return true;\n                        }\n\n                    }\n\n                    return false;\n                }\n                function isNamedColor(match) {\n                    if (match && match[0] && /^[a-z]+$/i.test(match[0])) { // only for color names, not for hex-/rgb-values\n                        return true;\n                    }\n                }\n\n                // Hyphens do not count as a regex word boundary (\\b), so check for those here\n                do {\n                    colorMatch = colorRegEx.exec(line);\n                    if (!colorMatch) {\n                        break;\n                    }\n                    if (ignoreNamedColors === undefined) {\n                        let mode = TokenUtils.getModeAt(editor._codeMirror, pos, false).name;\n                        ignoreNamedColors = styleLanguages.indexOf(mode) === -1;\n                    }\n                } while (hyphenOnMatchBoundary(colorMatch, line) ||\n                (ignoreNamedColors && isNamedColor(colorMatch)));\n\n                return colorMatch;\n            }\n\n            // simple css property splitter (used to find color stop arguments in gradients)\n            function splitStyleProperty(property) {\n                let token = /((?:[^\"']|\".*?\"|'.*?')*?)([(,)]|$)/g;\n                let recurse = function () {\n                    let array = [];\n                    for (;;) {\n                        let result = token.exec(property);\n                        if (result[2] === \"(\") {\n                            let str = result[1].trim() + \"(\" + recurse().join(\",\") + \")\";\n                            result = token.exec(property);\n                            str += result[1];\n                            array.push(str);\n                        } else {\n                            array.push(result[1].trim());\n                        }\n                        if (result[2] !== \",\") {\n                            return array;\n                        }\n                    }\n                };\n                return (recurse());\n            }\n\n            // color stop helpers\n            function isGradientColorStop(args) {\n                return (args.length > 0 && args[0].match(colorRegEx) !== null);\n            }\n\n            function hasLengthInPixels(args) {\n                return (args.length > 1 && args[1].indexOf(\"px\") > 0);\n            }\n\n            // Ensures that input is in usable hex format\n            function ensureHexFormat(str) {\n                return (/^0x/).test(str) ? str.replace(\"0x\", \"#\") : str;\n            }\n\n            // Normalizes px color stops to %\n            function normalizeGradientExpressionForQuickview(expression) {\n                if (expression.indexOf(\"px\") > 0) {\n                    let paramStart = expression.indexOf(\"(\") + 1,\n                        paramEnd = expression.lastIndexOf(\")\"),\n                        parameters = expression.substring(paramStart, paramEnd),\n                        params = splitStyleProperty(parameters),\n                        lowerBound = 0,\n                        upperBound = $(\"#quick-view-color-swatch\").width(),\n                        args,\n                        thisSize,\n                        i;\n\n                    // find lower bound\n                    for (i = 0; i < params.length; i++) {\n                        args = params[i].split(\" \");\n\n                        if (hasLengthInPixels(args)) {\n                            thisSize = parseFloat(args[1]);\n\n                            upperBound = Math.max(upperBound, thisSize);\n                            // we really only care about converting negative\n                            //  pixel values -- so take the smallest negative pixel\n                            //  value and use that as baseline for display purposes\n                            if (thisSize < 0) {\n                                lowerBound = Math.min(lowerBound, thisSize);\n                            }\n                        }\n                    }\n\n                    // convert negative lower bound to positive and adjust all pixel values\n                    //  so that -20px is now 0px and 100px is now 120px\n                    lowerBound = Math.abs(lowerBound);\n\n                    // Offset the upperbound by the lowerBound to give us a corrected context\n                    upperBound += lowerBound;\n\n                    // convert to %\n                    for (i = 0; i < params.length; i++) {\n                        args = params[i].split(\" \");\n                        if (isGradientColorStop(args) && hasLengthInPixels(args)) {\n                            if (upperBound === 0) {\n                                thisSize = 0;\n                            } else {\n                                thisSize = ((parseFloat(args[1]) + lowerBound) / upperBound) * 100;\n                            }\n                            args[1] = thisSize + \"%\";\n                        }\n                        params[i] = args.join(\" \");\n                    }\n\n                    // put it back together.\n                    expression = expression.substring(0, paramStart) + params.join(\", \") + expression.substring(paramEnd);\n                }\n                return expression;\n            }\n\n            let parensBalanced = areParensBalanced(line),\n                gradientMatch = execGradientMatch(line, parensBalanced),\n                match = gradientMatch.match || execColorMatch(editor, line, pos);\n\n            let previewCSS, startPos, endPos, found = false;\n\n            while (match) {\n                if (pos.ch < match.index) {\n                    // Gradients are matched first, then colors, so...\n                    if (gradientMatch.match) {\n                        // ... gradient match is past cursor -- stop looking for gradients, start searching for colors\n                        gradientMatch = { match: null, prefix: \"\", colorValue: null };\n                    } else {\n                        // ... color match is past cursor -- stop looping\n                        break;\n                    }\n                } else if (pos.ch <= match.index + match[0].length) {\n                    // build the css for previewing the gradient from the regex result\n                    previewCSS = gradientMatch.prefix + (gradientMatch.colorValue || match[0]);\n                    startPos = {line: pos.line, ch: match.index};\n                    endPos = {line: pos.line, ch: match.index + match[0].length};\n                    found = true;\n                    break;\n                }\n\n                // Get next match\n                if (gradientMatch.match) {\n                    gradientMatch = execGradientMatch(line, parensBalanced);\n                }\n                match = gradientMatch.match || execColorMatch(editor, line, pos);\n            }\n\n            if(found){\n                // normalize the arguments to something that we can display to the user\n                // NOTE: we need both the div and the popover's _previewCSS member\n                //          (used by unit tests) to match so normalize the css for both\n                let tooltip = gradientMatch.match ? \"\" : Strings.TOOLTIP_CLICK_TO_EDIT_COLOR;\n                previewCSS = normalizeGradientExpressionForQuickview(ensureHexFormat(previewCSS));\n                let preview = $(`<div title=\"${tooltip}\">\n                    <div id='quick-view-color-swatch' data-for-test='${previewCSS}' class='color-swatch'\n                        style='background: ${previewCSS}'>\n                    </div>\n                    <span style=\"${gradientMatch.match? \"display: none;\": \"\"}\">\n                        <i class=\"fa fa-edit\" style=\"color: ${previewCSS}; margin-top:5px;\"></i>\n                        <span style=\"color: ${previewCSS}; margin-top:5px;\">${Strings.EDIT}</span>\n                    </span>\n                </div>`);\n                preview.click(function () {\n                    if(gradientMatch.match) {\n                        return;\n                    }\n                    let fullEditor = EditorManager.getCurrentFullEditor();\n                    if(fullEditor && fullEditor.document.file.fullPath !== editor.document.file.fullPath) {\n                        const foundResult = MainViewManager.findInAllWorkingSets(editor.document.file.fullPath);\n                        let paneToOpen;\n                        if(fullEditor.length) {\n                            paneToOpen = foundResult[0].pane;\n                        }\n                        FileViewController.openAndSelectDocument(editor.document.file.fullPath,\n                            FileViewController.WORKING_SET_VIEW, paneToOpen)\n                            .done(function () {\n                                fullEditor = EditorManager.getCurrentFullEditor();\n                                fullEditor.setCursorPos(startPos.line, startPos.ch, true);\n                                CommandManager.execute(Commands.TOGGLE_QUICK_EDIT);\n                            });\n                    } else {\n                        editor.setCursorPos(startPos.line, startPos.ch);\n                        CommandManager.execute(Commands.TOGGLE_QUICK_EDIT);\n                    }\n                    Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW, \"color\", \"click\");\n                });\n\n                Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW, \"color\", \"show\");\n                resolve({\n                    start: startPos,\n                    end: endPos,\n                    content: preview\n                });\n                return;\n            }\n\n            reject();\n        });\n    }\n\n    AppInit.appReady(function () {\n        QuickView.registerQuickViewProvider(exports, [\"all\"]);\n    });\n\n    exports.getQuickView = getQuickView;\n    exports.QUICK_VIEW_NAME = \"colorGradientProvider\";\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*jslint regexp: true */\n\ndefine(\"numberPreviewProvider\", function (require, exports, module) {\n\n    // Brackets modules\n    let PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        Strings             = brackets.getModule(\"strings\"),\n        AppInit             = brackets.getModule(\"utils/AppInit\"),\n        QuickView           = brackets.getModule(\"features/QuickViewManager\"),\n        Metrics             = brackets.getModule(\"utils/Metrics\"),\n        colorGradientProvider = require(\"./colorGradientProvider\");\n\n    const PREF_ENABLED_KEY = \"numberEditor\";\n\n    let prefs = PreferencesManager.getExtensionPrefs(\"quickview\");\n    prefs.definePreference(PREF_ENABLED_KEY, \"boolean\", true, {\n        description: Strings.DESCRIPTION_NUMBER_QUICK_VIEW\n    });\n\n    let enabled;                             // Only show preview if true\n    let lastOriginId = 0;\n\n    function _splitNumber(numStr) {\n        // https://stackoverflow.com/questions/2868947/split1px-into-1px-1-px-in-javascript\n        try{\n            if(numStr.length > 15){\n                // empirically, anything larger than 15 chars is not a number we can process\n                return null;\n            }\n            let split = numStr.match(/(^-?)(\\d*\\.?\\d*)(.*)/); // \"1px\" -> [\"1px\", \"1\", \"px\"]\n            let number = split[1] + split[2] || \"\";\n            let decimalPlaces = number.split(\".\")[1];\n            decimalPlaces = decimalPlaces && decimalPlaces.length || 0;\n            let roundTo;\n            switch (decimalPlaces) {\n            case 0: roundTo = 1; break;\n            case 1: roundTo = 10; break;\n            case 2: roundTo = 100; break;\n            default: roundTo = 100; break;\n            }\n            return {\n                number,\n                units: split[3] || \"\",\n                decimalPlaces,\n                roundTo\n            };\n        } catch (e) {\n            return null;\n        }\n    }\n\n    function _getWordAfterPos(editor, pos) {\n        // Find the word at the specified position\n        const wordRange = editor.getWordAt(pos);\n        if(wordRange.text.startsWith('%')) {\n            wordRange.text = wordRange.text.slice(0, 1);\n            wordRange.endPos.ch = wordRange.startPos.ch + 1;\n        }\n        const wordFull = editor.getTextBetween(wordRange.startPos, wordRange.endPos);\n\n        // Calculate effective start position within the word, if startPos is within the word\n        let startChInWord = 0;\n        if (wordRange.startPos.line === pos.line && wordRange.startPos.ch < pos.ch) {\n            startChInWord = pos.ch - wordRange.startPos.ch;\n        }\n\n        // Calculate the effective start and end positions of the trimmed word within the editor\n        const effectiveStartPos = {\n            line: wordRange.startPos.line,\n            ch: wordRange.startPos.ch + startChInWord\n        };\n\n        const effectiveEndPos = wordRange.endPos; // The end position remains the same as the original word's end\n\n        // Trim the word based on the effective start position\n        const trimmedWord = wordFull.substring(startChInWord);\n\n        // Return the trimmed word along with its start and end positions\n        return {\n            text: trimmedWord,\n            startPos: effectiveStartPos,\n            endPos: effectiveEndPos\n        };\n    }\n\n    function _isCSSUnit(str) {\n        // Regular expression pattern that matches common CSS units\n        const regexPattern = /^(px|cm|mm|Q|in|pc|pt|em|ex|ch|rem|vw|vh|vmin|vmax|lh|%)$/;\n\n        return regexPattern.test(str);\n    }\n\n    function getQuickView(editor, pos, token, line) {\n        return new Promise((resolve, reject)=>{\n            let startCh = token.start,\n                endCh = token.end,\n                numberStr = token.string;\n            if(token.type === \"string\" && enabled) {\n                // this is for inline html attributes like style=\"width:10px;\"\n                // if the user hover over the 10 or px part, we should show the preview.\n                const number = editor.getNumberAt(pos);\n                if(number) {\n                    // user hovered over the numeric (Eg.10) part\n                    numberStr = number.text;\n                    startCh = number.startPos.ch;\n                    endCh = number.endPos.ch;\n                    // check if we can extract units\n                    const nextPos = {line: number.endPos.line, ch: number.endPos.ch};\n                    const nextWord = _getWordAfterPos(editor, nextPos);\n                    if(_isCSSUnit(nextWord.text.trim())){\n                        numberStr = editor.getTextBetween(number.startPos, nextWord.endPos);\n                        endCh = nextWord.endPos.ch;\n                    }\n                } else {\n                    // the user hovers on the unit field or this is not a numeric string.\n                    // for the unit field, we could add logic to detect the numeric field, but not doing that\n                    // rn due to resource crunch.\n                    reject();\n                    return;\n                }\n            } else if(token.type !== \"number\" || !enabled){\n                reject();\n                return;\n            }\n            let sPos = {line: pos.line, ch: startCh},\n                ePos = {line: pos.line, ch: endCh};\n            let editOrigin = \"+NumberQuickView_\" + (lastOriginId++);\n            let $content = $(`<div><input type=\"text\" value=\"${numberStr}\" class=\"dial\"><div>`);\n            let split = _splitNumber(numberStr);\n            if(!split){\n                reject();\n                return;\n            }\n            let changedMetricSent = false;\n            $content.find(\".dial\").knob({\n                stopper: false,\n                step: 1/split.roundTo,\n                max: 100/split.roundTo,\n                width: 100,\n                height: 100,\n                fgColor: \"#2893ef\",\n                fontSize: \"1em\",\n                format: function(value){\n                    return Math.round(value*split.roundTo)/split.roundTo + split.units;\n                },\n                getValue: function(userInput){\n                    let changedSplit = _splitNumber(userInput);\n                    split.units = changedSplit && changedSplit.units;\n                    return changedSplit && changedSplit.number;\n                },\n                change: function (value) {\n                    editor.document.batchOperation(function () {\n                        // Replace old color in code with the picker's color, and select it\n                        editor.setSelection(sPos, ePos); // workaround for #2805\n                        let replaceStr = Math.round(value*split.roundTo)/split.roundTo + split.units;\n                        editor.replaceRange(replaceStr, sPos, ePos, editOrigin);\n                        ePos = {line: sPos.line, ch: sPos.ch + replaceStr.length};\n                        editor.setSelection(sPos, ePos);\n                    });\n                    if(!changedMetricSent){\n                        Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW, \"num\", \"changed\");\n                        changedMetricSent = true;\n                    }\n                },\n                changeStart: function () {\n                    QuickView.lockQuickView();\n                },\n                changeEnd: function () {\n                    QuickView.unlockQuickView();\n                }\n            });\n            resolve({\n                start: sPos,\n                end: ePos,\n                content: $content,\n                exclusive: true,\n                editsDoc: true\n            });\n            Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW, \"num\", \"show\");\n        });\n    }\n\n    function filterQuickView(popovers){\n        // rgb(10 , 100, 20), hover over these kind of numbers should open color quick view if present over number view\n        let hasColorQuickView = false;\n        for(let popover of popovers){\n            if(popover.providerInfo.provider.QUICK_VIEW_NAME === colorGradientProvider.QUICK_VIEW_NAME){\n                hasColorQuickView = true;\n                break;\n            }\n        }\n        if(hasColorQuickView){\n            popovers = popovers.filter((popover) => {\n                return popover.providerInfo.provider.QUICK_VIEW_NAME !== exports.QUICK_VIEW_NAME;\n            });\n        }\n\n        return popovers;\n    }\n\n    prefs.on(\"change\", PREF_ENABLED_KEY, function () {\n        enabled = prefs.get(PREF_ENABLED_KEY);\n    });\n\n    AppInit.appReady(function () {\n        enabled = prefs.get(PREF_ENABLED_KEY);\n        QuickView.registerQuickViewProvider(exports, [\"html\", \"xhtml\", \"xml\", // xml takes care of html inside tsx/jsx\n            \"css\", \"less\", \"scss\", \"sass\"]);\n    });\n\n    exports.getQuickView = getQuickView;\n    exports.filterQuickView = filterQuickView;\n    exports.QUICK_VIEW_NAME = \"numberPreviewProvider\";\n\n});\n"],"file":"extension-min.js"}