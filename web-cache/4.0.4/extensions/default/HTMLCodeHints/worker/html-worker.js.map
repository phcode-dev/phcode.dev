{"version":3,"sources":["extensions/default/HTMLCodeHints/worker/html-worker.js"],"names":["htmlValidator","HTMLLanguageService","createHTMLValidator","extends","WorkerComm","triggerPeer","isUsingCustomConfig","currentConfigID","setupValidator","config","configID","e","message","async","htmlLint","params","errorMessage","start","end","severity","ruleId","validatorResult","validateString","text","filePath","results","length","errors","result","messages","push","startPos","line","ch","column","highlightOffset","size","offset","ruleUrl","updateHTMLLintConfig","console","error","setExecHandler"],"mappings":"CAsBC,WACG,IAAIA,cAAgBC,oBAAoBC,oBAAoB,CACxDC,QAAS,CAAC,4BAEdC,WAAWC,YAAY,6BAA8B,IAErD,IAAIC,qBAAsB,EAAOC,gBAEjC,SAASC,eAAeC,OAAQC,UAC5B,IAaI,OAZID,QAAUH,qBAEVN,cAAgBC,oBAAoBC,oBAAoB,CACpDC,QAAS,CAAC,4BAEdG,qBAAsB,EACtBC,gBAAkB,MACZE,QAAUF,kBAAoBG,WACpCV,cAAgBC,oBAAoBC,oBAAoBO,QACxDH,qBAAsB,EACtBC,gBAAkBG,UAEf,KACT,MAAOC,GACL,OAAOA,EAAEC,SAIjBC,eAAeC,SAASC,QACpB,IAAIC,aAAeR,eAAeO,OAAON,OAAQM,OAAOL,UACxD,GAAGM,aACC,MAAO,CAAC,CACJC,MAAO,EACPC,IAAK,EACLC,SAAU,EACVP,QAAS,2CAA4CI,aACrDI,OAAQ,mBAGhB,MAAMC,sBAAwBrB,cAAcsB,eAAeP,OAAOQ,KAAMR,OAAOS,UAC/E,IAAIH,kBAAoBA,gBAAgBI,UAAYJ,gBAAgBI,QAAQC,OACxE,MAAO,GAEX,MAAMC,OAAS,GACf,IAAI,IAAIC,UAAUP,gBAAgBI,QAC9B,GAAGG,OAAOC,UAAYD,OAAOC,SAASH,OAClC,IAAI,IAAId,WAAWgB,OAAOC,SACtBF,OAAOG,KAAK,CAERC,SAAU,CAACC,MAAOpB,QAAQoB,MAAQ,GAAK,EAAGC,IAAKrB,QAAQsB,QAAU,GAAK,GAGtEC,gBAAkBvB,QAAQwB,MAAQ,EAClCnB,MAAOL,QAAQyB,OACfnB,IAAKN,QAAQyB,QAAUzB,QAAQwB,MAAQ,GAAK,EAC5CjB,SAAUP,QAAQO,SAClBP,QAASA,QAAQA,QACjBQ,OAAQR,QAAQQ,OAChBkB,QAAS1B,QAAQ0B,UAMjC,OAAOX,OAGXd,eAAe0B,qBAAqBxB,QAC7BA,OAAON,OACN+B,QAAQC,MAAM,6DAA8D1B,QAGhFf,cAAgBC,oBAAoBC,oBAAoBa,OAAON,QAGnEL,WAAWsC,eAAe,WAAY5B,UACtCV,WAAWsC,eAAe,uBAAwBH,sBA5EtD","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global WorkerComm, HTMLLanguageService*/\n\n(function () {\n    let htmlValidator = HTMLLanguageService.createHTMLValidator({\n        extends: [\"html-validate:standard\"]\n    });\n    WorkerComm.triggerPeer(\"html_lint_extension_Loaded\", {});\n\n    let isUsingCustomConfig = false, currentConfigID;\n\n    function setupValidator(config, configID) {\n        try{\n            if(!config && isUsingCustomConfig) {\n                // reset the config\n                htmlValidator = HTMLLanguageService.createHTMLValidator({\n                    extends: [\"html-validate:standard\"]\n                });\n                isUsingCustomConfig = false;\n                currentConfigID = null;\n            } else if(config && currentConfigID !== configID) {\n                htmlValidator = HTMLLanguageService.createHTMLValidator(config);\n                isUsingCustomConfig = true;\n                currentConfigID = configID;\n            }\n            return null;\n        } catch (e) {\n            return e.message;\n        }\n    }\n\n    async function htmlLint(params) {\n        let errorMessage = setupValidator(params.config, params.configID);\n        if(errorMessage) {\n            return [{\n                start: 0,\n                end: 0,\n                severity: 2, // 1 warning and 2 is error\n                message: \"Invalid config file `.htmlvalidate.json`\"+ errorMessage,\n                ruleId: \"INVALID_CONFIG\"\n            }];\n        }\n        const validatorResult = await htmlValidator.validateString(params.text, params.filePath);\n        if(!validatorResult || !validatorResult.results || !validatorResult.results.length){\n            return [];\n        }\n        const errors = [];\n        for(let result of validatorResult.results){\n            if(result.messages && result.messages.length) {\n                for(let message of result.messages){\n                    errors.push({\n                        // The starting position of the error (0-based line and column index)\n                        startPos: {line: (message.line || 1) - 1, ch: (message.column || 1) - 1},\n                        // The length (in characters) of the error from the starting position. this is an offset\n                        // than can span multiple lines.\n                        highlightOffset: (message.size || 1),\n                        start: message.offset,\n                        end: message.offset + (message.size || 1) - 1,\n                        severity: message.severity,\n                        message: message.message,\n                        ruleId: message.ruleId,\n                        ruleUrl: message.ruleUrl // this is a doc link for the ruleId config, not good to show\n                        // to a user who doesnt know about html validator config is.\n                    });\n                }\n            }\n        }\n        return errors;\n    }\n\n    async function updateHTMLLintConfig(params) {\n        if(params.config){\n            console.error(\"HTML Lint worker updateHTMLLintConfig received null config\", params);\n            return;\n        }\n        htmlValidator = HTMLLanguageService.createHTMLValidator(params.config);\n    }\n\n    WorkerComm.setExecHandler(\"htmlLint\", htmlLint);\n    WorkerComm.setExecHandler(\"updateHTMLLintConfig\", updateHTMLLintConfig);\n}());\n"],"file":"html-worker.js"}