{"version":3,"sources":["extensions/default/HealthData/extension-min.js"],"names":["define","require","exports","module","AppInit","brackets","getModule","Menus","CommandManager","Strings","Commands","HealthDataNotification","HealthDataManager","HealthDataPopup","menu","getMenu","AppMenuBar","HELP_MENU","healthDataCmdId","handleHealthDataStatistics","addCommand","register","CMD_HEALTH_DATA_STATISTICS","addMenuItem","AFTER","HELP_GET_INVOLVED","addMenuDivider","initTest","test","HealthDataPreview","appReady","PreferencesManager","Metrics","SendToAnalytics","prefs","getExtensionPrefs","ONE_SECOND","TEN_SECOND","ONE_MINUTE","MAX_DAYS_TO_KEEP_COUNTS","USAGE_COUNTS_KEY","isPowerUser","usageData","getViewState","dateKeys","Object","keys","dateBefore14Days","Date","totalUsageMinutes","totalUsageDays","setUTCDate","getUTCDate","dateKey","date","healthDataDisabled","_pruneUsageData","dateBefore60Days","setDate","getDate","length","setViewState","_trackUsageInfo","setInterval","dateNow","today","toISOString","split","definePreference","description","DESCRIPTION_HEALTH_DATA_TRACKING","on","get","setDisabled","logger","loggingOptions","init","isPowerUserFn","sendPlatformMetrics","sendThemesMetrics","setTimeout","sendStartupPerformanceMetrics","ExtensionInterface","NEW_PROJECT_EXTENSION_INTERFACE","POPUP_FIRST_LAUNCH_SHOW_DELAY","newProjectExtension","previewHealthData","waitAndGetExtensionInterface","then","interfaceObj","EVENT_NEW_PROJECT_DIALOGUE_CLOSED","_showFirstLaunchPopup","popupShownInThisSession","off","window","testEnvironment","alreadyShown","showFirstLaunchTooltip","done","NotificationUI","deferred","$","Deferred","createToastFromTemplate","HEALTH_FIRST_POPUP_TITLE","HEALTH_DATA_NOTIFICATION_MESSAGE","resolve","promise","_","Mustache","Dialogs","ExtensionUtils","HealthDataPreviewDialog","_buildPreviewData","content","auditData","getLoggedDataForAudit","sortedData","Map","entries","sort","displayData","key","value","valueString","count","eventType","AUDIT_TYPE_COUNT","push","sum","AUDIT_TYPE_VALUE","JSON","stringify","escape","replace","hdPref","template","render","$template","addLinkTooltips","showModalDialogUsingTemplate","id","newHDPref","find","is","set","clearAuditData","loadStyleSheet","PerfUtils","NodeUtils","themesPref","PLATFORM","EVENT_TYPE","PERFORMANCE","STORAGE","_emitDeviceTypeMetrics","browser","isDeskTop","countEvent","isMobile","isTablet","_emitMobileMetricsIfPresent","platform","mobile","isIos","isWindows","isAndroid","_emitBrowserMetrics","desktop","isChrome","isChromeBased","isEdgeChromium","isFirefox","isOpera","isOperaChromium","async","_sendStorageMetrics","navigator","storage","estimate","quota","percentageUsed","Math","round","usage","usedMB","console","log","valueEvent","_getPlatformInfo","OS","userAgent","appVersion","app","language","getLocale","metadata","version","Phoenix","isNativeApp","getLinuxOSFlavorName","flavor","_bugsnagPerformance","valueMs","isDisabled","BugsnagPerformance","isTestWindow","activityStartTime","activityEndTime","getTime","startSpan","startTime","end","healthReport","getHealthReport","labelAppStart","firstBoot","Number","PhStore","_storageBootstrapTime","_tauriBootVars","bootstrapTime","nodeSetupDonePromise","PhNodeEngine","_nodeLoadTime","catch","_err","_getCurrentTheme","THEMES"],"mappings":"AAwBAA,OAAO,SAAUC,QAASC,QAASC,QAE/B,IAAIC,QAA0BC,SAASC,UAAU,iBAC7CC,MAA0BF,SAASC,UAAU,iBAC7CE,eAA0BH,SAASC,UAAU,0BAC7CG,QAA0BJ,SAASC,UAAU,WAC7CI,SAA0BL,SAASC,UAAU,oBAC7CK,uBAA0BV,QAAQ,0BAClCW,kBAA0BX,QAAQ,qBAClCY,gBAA0BZ,QAAQ,mBAElCa,KAAkBP,MAAMQ,QAAQR,MAAMS,WAAWC,WACjDC,gBAAkB,kCAGtB,SAASC,6BACLR,uBAAuBQ,6BAI3B,SAASC,aACLZ,eAAea,SAASZ,QAAQa,2BAA4BJ,gBAAiBC,4BAE7EL,KAAKS,YAAYL,gBAAiB,GAAIX,MAAMiB,MAAOd,SAASe,mBAC5DX,KAAKY,eAAenB,MAAMiB,MAAOd,SAASe,mBAG9C,SAASE,WACLtB,SAASuB,KAAKC,kBAAyB5B,QAAQ,qBAC/CI,SAASuB,KAAKhB,kBAAyBA,kBACvCP,SAASuB,KAAKjB,uBAAyBA,uBACvCN,SAASuB,KAAKf,gBAAyBA,gBAG3CT,QAAQ0B,SAAS,WACbH,aAGJP,eA+BJpB,OAAO,oBAAqB,SAAUC,QAASC,QAASC,QACpD,IAAIC,QAAsBC,SAASC,UAAU,iBACzCyB,mBAAsB1B,SAASC,UAAU,kCACzCG,QAAsBJ,SAASC,UAAU,WACzC0B,QAAsB3B,SAASC,UAAU,iBACzC2B,gBAAsBhC,QAAQ,mBAC9BiC,MAAsBH,mBAAmBI,kBAAkB,cAC3DC,WAAsB,IACtBC,WAAsB,IACtBC,WAAsB,IACtBC,wBAA0B,GAC1BC,iBAAsB,kBAM1B,SAASC,cACL,IAAIC,UAAYX,mBAAmBY,aAAaH,mBAAqB,GACjEI,SAAWC,OAAOC,KAAKJ,WACvBK,iBAAmB,IAAIC,KACvBC,kBAAoB,EACpBC,eAAiB,EACrBH,iBAAiBI,WAAWJ,iBAAiBK,aAAa,IAC1D,IAAI,IAAIC,WAAWT,SAAS,CACxB,IAAIU,KAAO,IAAIN,KAAKK,UACTN,mBACPG,iBACAD,mBAAwCP,UAAUW,UAG1D,OAAOH,gBAAkB,GAAMD,kBAAkB,IAAO,EAG5D,IAAIM,mBAaJ,SAASC,kBACL,IAAId,UAAYX,mBAAmBY,aAAaH,mBAAqB,GACjEI,SAAWC,OAAOC,KAAKJ,WACvBe,iBAAmB,IAAIT,KAE3B,GADAS,iBAAiBC,QAAQD,iBAAiBE,UAAYpB,yBACnDK,SAASgB,OAASrB,wBACjB,IAAI,IAAIc,WAAWT,SAAS,CACxB,IAAIU,KAAO,IAAIN,KAAKK,SACVI,yBACCf,UAAUW,SAK7BtB,mBAAmB8B,aAAarB,iBAAkBE,WAGtD,SAASoB,kBACLN,kBACAO,YAAY,KACR,GAAGR,mBACC,OAEJ,IAAIb,UAAYX,mBAAmBY,aAAaH,mBAAqB,GACjEwB,QACAC,OADU,IAAIjB,MACEkB,cAAcC,MAAM,KAAK,GAC7CzB,UAAUuB,QAAUvB,UAAUuB,QAAU,GAAK,EAE7ClC,mBAAmB8B,aAAarB,iBAAkBE,YACnDJ,YAxCPJ,MAAMkC,iBAAiB,qBAAsB,WAAW,EAAM,CAC1DC,YAAa5D,QAAQ6D,mCAGzBpC,MAAMqC,GAAG,SAAU,qBAAsB,WACrChB,oBAAsBrB,MAAMsC,IAAI,sBAChCxC,QAAQyC,YAAYlB,oBACpBmB,OAAOC,eAAepB,mBAAqBA,qBAoC/CnD,QAAQ0B,SAAS,WACbE,QAAQ4C,KAAK,CACTC,cAAepC,cAEnBc,oBAAsBrB,MAAMsC,IAAI,sBAChCxC,QAAQyC,YAAYlB,oBACpBtB,gBAAgB6C,sBAChB7C,gBAAgB8C,oBAChBjB,kBACAkB,WAAW/C,gBAAgBgD,8BAhFL,SA8G9BjF,OAAO,yBAA0B,SAAUC,QAASC,QAASC,QAEzD,IAAI4B,mBAA+B1B,SAASC,UAAU,kCAClD4E,mBAA+B7E,SAASC,UAAU,4BAClDuB,kBAA+B5B,QAAQ,qBACvCY,gBAA+BZ,QAAQ,mBAE3C,MAAMkF,gCAAkC,0BAKpCC,8BAAgC,IAEpC,IAAIC,oBASJ,SAASlE,6BACLU,kBAAkByD,oBATtBJ,mBAAmBK,6BARqB,2BASnCC,KAAKC,eACFJ,oBAAsBI,aACtBA,aAAalB,GAAGkB,aAAaC,kCAAmC,KAC5DV,WAAWW,sBAPa,SAepC,IAAIC,yBAA0B,EAC9B,SAASD,wBAGL,IAAGC,0BAGHA,yBAA0B,EAC1BP,oBAAoBQ,IAAIR,oBAAoBK,kCAAmCC,wBAC3EG,OAAOC,iBAAgB,CACvB,MAAMC,aAAejE,mBAAmBY,aAAa,+BAC/CT,MAAQH,mBAAmBI,kBAAkB,eAC9C6D,cAAgB9D,MAAMsC,IAAI,uBAC3B3D,gBAAgBoF,yBACXC,KAAK,WACFnE,mBAAmB8B,aAAa,+BAA+B,MAMnF3D,QAAQiB,2BAAmCA,6BA2B/CnB,OAAO,kBAAmB,SAAUC,QAASC,QAASC,QAGlD,MAAMgG,eAAiB9F,SAASC,UAAU,0BACtCG,QAAUJ,SAASC,UAAU,WAEjC,SAAS2F,yBACL,MAAMG,SAAW,IAAIC,EAAEC,SAGvB,OAFAH,eAAeI,wBAAwB9F,QAAQ+F,mEACD/F,QAAQgG,0CAA0CP,KAAKE,SAASM,SACvGN,SAASO,UAGpBzG,QAAQ+F,uBAAkCA,yBA2B9CjG,OAAO,oBAAqB,SAAUC,QAASC,QAASC,QAEpD,IAAIyG,EAA0BvG,SAASC,UAAU,qBAC7CuG,SAA0BxG,SAASC,UAAU,gCAC7CyB,mBAA0B1B,SAASC,UAAU,kCAC7CG,QAA0BJ,SAASC,UAAU,WAC7CwG,QAA0BzG,SAASC,UAAU,mBAC7CyG,eAA0B1G,SAASC,UAAU,wBAC7C0B,QAA0B3B,SAASC,UAAU,iBAC7C0G,wBAA0B,s+BAwB1B9E,MAAQH,mBAAmBI,kBAAkB,cAIjD,SAAS8E,oBACL,IAAIC,QACAC,UAAYnF,QAAQoF,wBACpBC,WAAa,IAAIC,IAAI,IAAIH,UAAUI,WAAWC,QAC9CC,YAAc,GAClB,IAAK,MAAOC,IAAKC,SAAUN,WAAWE,UAAW,CAC7C,IAAIK,YAAc,GACfD,MAAME,MAAQ,IACbD,gBAAkBD,MAAME,UAEzBF,MAAMG,YAAc9F,QAAQ+F,iBAC3BN,YAAYO,QAAQN,eAAeC,MAAMM,OAAOL,eAC1CD,MAAMG,YAAc9F,QAAQkG,kBAAoC,IAAhBP,MAAME,OAC5DJ,YAAYO,QAAQN,aAAaC,MAAMM,IAAIN,MAAME,SAASD,eAOlE,OAJAV,QAAUiB,KAAKC,UAAUX,YAAa,KAAM,GAG5CP,SADAA,SADAA,QAAUN,EAAEyB,OAAOnB,UACDoB,QAAQ,KAAM,WACdA,QAAQ,kBAAmB,UAOjD,SAAShD,oBACL,IAAIiD,OAAWrG,MAAMsC,IAAI,sBACrBgE,SAAW3B,SAAS4B,OAAOzB,wBACvB,CAACvG,QAASA,QAASyG,QAASD,oBAAqBsB,OAAQA,SAC7DG,UAAYrC,EAAEmC,UAElB1B,QAAQ6B,gBAAgBD,WACxB5B,QAAQ8B,6BAA6BF,WAAWxC,KAAK,SAAU2C,IAE3D,GAAW,SAAPA,GAAe,CACf,IAAIC,UAAYJ,UAAUK,KAAK,0BAA0BC,GAAG,YACxDT,SAAWO,WACX5G,MAAM+G,IAAI,qBAAsBH,eAEtB,UAAPD,IACP7G,QAAQkH,mBA3CpBnC,eAAeoC,eAAehJ,OAAQ,cAgDtCD,QAAQoF,kBAAoBA,oBA2BhCtF,OAAO,kBAAmB,SAAUC,QAASC,QAASC,QAClD,MAAM6B,QAAU3B,SAASC,UAAU,iBAC/ByB,mBAAsB1B,SAASC,UAAU,kCACzC8I,UAAsB/I,SAASC,UAAU,mBACzC+I,UAAsBhJ,SAASC,UAAU,mBACzCgJ,WAAsBvH,mBAAmBI,kBAAkB,UAEzDoH,SAAWvH,QAAQwH,WAAWD,SAChCE,YAAczH,QAAQwH,WAAWC,YACjCC,QAAU1H,QAAQwH,WAAWE,QAGjC,SAASC,yBACFtJ,SAASuJ,QAAQC,WAChB7H,QAAQ8H,WAAWP,SAAU,SAAU,WAExClJ,SAASuJ,QAAQG,UAChB/H,QAAQ8H,WAAWP,SAAU,SAAU,UAExClJ,SAASuJ,QAAQI,UAChBhI,QAAQ8H,WAAWP,SAAU,SAAU,UAG/C,SAASU,8BACL,IAAIC,SAAW,OACf,GAAG7J,SAASuJ,QAAQO,OAAOC,MACvBF,SAAW,WACR,GAAG7J,SAASuJ,QAAQO,OAAOE,UAC9BH,SAAW,cACR,CAAA,IAAG7J,SAASuJ,QAAQO,OAAOG,UAG9B,OAFAJ,SAAW,UAIflI,QAAQ8H,WAAWP,SAAU,SAAUW,UAE3C,SAASK,sBACFlK,SAASuJ,QAAQY,QAAQC,UACxBzI,QAAQ8H,WAAWP,SAAU,UAAW,UAEzClJ,SAASuJ,QAAQY,QAAQE,eACxB1I,QAAQ8H,WAAWP,SAAU,UAAW,eAEzClJ,SAASuJ,QAAQY,QAAQG,gBACxB3I,QAAQ8H,WAAWP,SAAU,UAAW,gBAEzClJ,SAASuJ,QAAQY,QAAQI,WACxB5I,QAAQ8H,WAAWP,SAAU,UAAW,WAEzClJ,SAASuJ,QAAQY,QAAQK,SACxB7I,QAAQ8H,WAAWP,SAAU,UAAW,SAEzClJ,SAASuJ,QAAQY,QAAQM,iBACxB9I,QAAQ8H,WAAWP,SAAU,UAAW,iBAKhDwB,eAAeC,sBACX,GAAIC,UAAUC,SAAWD,UAAUC,QAAQC,SAAU,CACjD,MAAMC,YAAcH,UAAUC,QAAQC,WAGhCE,eAAiBC,KAAKC,MAAOH,MAAMI,MAAQJ,MAAMA,MAAS,KAC1DK,OAASH,KAAKC,MAAMH,MAAMI,MAAQ,KAAO,MAC/CE,QAAQC,+BAA+BN,oBAAoBI,YAC3DzJ,QAAQ4J,WAAWlC,QAAS,eAAgB,cAAe2B,gBAC3DrJ,QAAQ4J,WAAWlC,QAAS,eAAgB,SAAU+B,SAI9D,SAASI,mBACL,IAAIC,GAAK,GAYT,MAXI,4BAA4BlK,KAAKkE,OAAOmF,UAAUc,WAClDD,GAAK,MACE,MAAMlK,KAAKkE,OAAOmF,UAAUc,WACnCD,GAAK,MACE,YAAYlK,KAAKkE,OAAOmF,UAAUc,aACzCD,GAAK,UACD,SAASlK,KAAKkE,OAAOmF,UAAUe,WAAalG,OAAOmF,UAAUc,aAC7DD,GAAK,YAINA,GAGX,SAAShH,sBACL9C,QAAQ8H,WAAWP,SAAU,KAAMlJ,SAAS6J,UAC5ClI,QAAQ8H,WAAWP,SAAU,YAAazD,OAAOmF,UAAUc,WAC3D/J,QAAQ8H,WAAWP,SAAU,aAAclJ,SAAS4L,IAAIC,UACxDlK,QAAQ8H,WAAWP,SAAU,mBAAoBlJ,SAAS8L,aAC1DnK,QAAQ8H,WAAWP,SAAU,kBAAmBlJ,SAAS+L,SAASC,SAC1C,UAArBC,QAAQpC,UAAwBoC,QAAQC,YACvClD,UAAUmD,uBACLhH,KAAKiH,SACCA,OACCzK,QAAQ8H,WAAWP,SAAU,YAAakD,QAE1CzK,QAAQ8H,WAAWP,SAAU,YAAasC,sBAItD7J,QAAQ8H,WAAWP,SAAU,YAAasC,oBAE9ClC,yBACAY,sBACAN,8BACAe,sBAGJ,SAAS0B,oBAAoBhF,IAAKiF,SAC9B,GAAG3K,QAAQ4K,eAAiB9G,OAAO+G,oBAAsBP,QAAQQ,aAC7D,OAEJ,IAAIC,kBAAoB,IAAI/J,KACxBgK,gBAAkB,IAAIhK,KAAK+J,kBAAkBE,UAAYN,SAC7D7G,OAAO+G,mBACFK,UAAUxF,IAAK,CAAEyF,UAAWJ,oBAC5BK,IAAIJ,iBAIb,SAAS/H,gCACL,MAAMoI,aAAejE,UAAUkE,kBAC/B,IAAIC,cAAgB,iBACjBjB,QAAQkB,YACPD,cAAgB,iBAEpBvL,QAAQ4J,WAAWnC,YAAa,UAAW8D,cACvCE,OAAOJ,aAA6B,iBACxCX,oBAAoBa,cAAeE,OAAOJ,aAA6B,iBACvErL,QAAQ4J,WAAWnC,YAAa,UAAW,qBACvCgE,OAAOJ,aAAiC,qBAC5CX,oBAAoB,qBAAsBe,OAAOJ,aAAiC,qBAClFrL,QAAQ4J,WAAWnC,YAAa,UAAW,UAAWiE,QAAQC,uBAC9DjB,oBAAoB,UAChBgB,QAAQC,uBACTrB,QAAQC,cACPvK,QAAQ4J,WAAWnC,YAAa,UAAW,YAAa3D,OAAO8H,eAAeC,eAC9EnB,oBAAoB,gBAChB5G,OAAO8H,eAAeC,gBAE3B/H,OAAOgI,sBACNhI,OAAOgI,qBACFtI,KAAK,KACCM,OAAOiI,cAAgBjI,OAAOiI,aAAaC,gBAC1ChM,QAAQ4J,WAAWnC,YAAa,UAAW,WAAY3D,OAAOiI,aAAaC,eAC3EtB,oBAAoB,WAChB5G,OAAOiI,aAAaC,gBAE5BhM,QAAQ8H,WAAWL,YAAa,WAAY,UAAW,KAE1DwE,MAAMC,OACHlM,QAAQ8H,WAAWL,YAAa,WAAY,OAAQ,KAMpE,SAAS0E,mBAGL,OAAO7E,WAAW9E,IAAI,UAAY,UAEtC,SAASO,oBACL/C,QAAQ8H,WAAW9H,QAAQwH,WAAW4E,OAAQ,eAAgBD,oBAGlEjO,QAAQ4E,oBAAsBA,oBAC9B5E,QAAQ+E,8BAAgCA,8BACxC/E,QAAQ6E,kBAAoBA","sourcesContent":["/*\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2015 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\ndefine(function (require, exports, module) {\n\n    var AppInit                 = brackets.getModule(\"utils/AppInit\"),\n        Menus                   = brackets.getModule(\"command/Menus\"),\n        CommandManager          = brackets.getModule(\"command/CommandManager\"),\n        Strings                 = brackets.getModule(\"strings\"),\n        Commands                = brackets.getModule(\"command/Commands\"),\n        HealthDataNotification  = require(\"HealthDataNotification\"),  // self-initializes to show first-launch notification\n        HealthDataManager       = require(\"HealthDataManager\"),  // self-initializes timer to send data\n        HealthDataPopup         = require(\"HealthDataPopup\");\n\n    var menu            = Menus.getMenu(Menus.AppMenuBar.HELP_MENU),\n        healthDataCmdId = \"healthData.healthDataStatistics\";\n\n    // Handles the command execution for Health Data menu item\n    function handleHealthDataStatistics() {\n        HealthDataNotification.handleHealthDataStatistics();\n    }\n\n    // Register the command and add the menu item for the Health Data Statistics\n    function addCommand() {\n        CommandManager.register(Strings.CMD_HEALTH_DATA_STATISTICS, healthDataCmdId, handleHealthDataStatistics);\n\n        menu.addMenuItem(healthDataCmdId, \"\", Menus.AFTER, Commands.HELP_GET_INVOLVED);\n        menu.addMenuDivider(Menus.AFTER, Commands.HELP_GET_INVOLVED);\n    }\n\n    function initTest() {\n        brackets.test.HealthDataPreview      = require(\"HealthDataPreview\");\n        brackets.test.HealthDataManager      = HealthDataManager;\n        brackets.test.HealthDataNotification = HealthDataNotification;\n        brackets.test.HealthDataPopup        = HealthDataPopup;\n    }\n\n    AppInit.appReady(function () {\n        initTest();\n    });\n\n    addCommand();\n\n});\n\n/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2015 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\n/*global logger*/\ndefine(\"HealthDataManager\", function (require, exports, module) {\n    var AppInit             = brackets.getModule(\"utils/AppInit\"),\n        PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        Strings             = brackets.getModule(\"strings\"),\n        Metrics             = brackets.getModule(\"utils/Metrics\"),\n        SendToAnalytics     = require(\"SendToAnalytics\"),\n        prefs               = PreferencesManager.getExtensionPrefs(\"healthData\"),\n        ONE_SECOND          = 1000,\n        TEN_SECOND          = 10 * ONE_SECOND,\n        ONE_MINUTE          = 60000,\n        MAX_DAYS_TO_KEEP_COUNTS = 60,\n        USAGE_COUNTS_KEY    = \"healthDataUsage\";\n\n    /**\n     * A power user is someone who has used Phoenix at least 3 days or 8 hours in the last two weeks\n     * @returns {boolean}\n     */\n    function isPowerUser() {\n        let usageData = PreferencesManager.getViewState(USAGE_COUNTS_KEY) || {},\n            dateKeys = Object.keys(usageData),\n            dateBefore14Days = new Date(),\n            totalUsageMinutes = 0,\n            totalUsageDays = 0;\n        dateBefore14Days.setUTCDate(dateBefore14Days.getUTCDate()-14);\n        for(let dateKey of dateKeys){\n            let date = new Date(dateKey);\n            if(date >= dateBefore14Days) {\n                totalUsageDays ++;\n                totalUsageMinutes = totalUsageMinutes + usageData[dateKey];\n            }\n        }\n        return totalUsageDays >= 3 || (totalUsageMinutes/60) >= 8;\n    }\n\n    let healthDataDisabled;\n\n    prefs.definePreference(\"healthDataTracking\", \"boolean\", true, {\n        description: Strings.DESCRIPTION_HEALTH_DATA_TRACKING\n    });\n\n    prefs.on(\"change\", \"healthDataTracking\", function () {\n        healthDataDisabled = !prefs.get(\"healthDataTracking\");\n        Metrics.setDisabled(healthDataDisabled);\n        logger.loggingOptions.healthDataDisabled = healthDataDisabled;\n    });\n\n    // we delete all usage counts greater than MAX_DAYS_TO_KEEP_COUNTS days\n    function _pruneUsageData() {\n        let usageData = PreferencesManager.getViewState(USAGE_COUNTS_KEY) || {},\n            dateKeys = Object.keys(usageData),\n            dateBefore60Days = new Date();\n        dateBefore60Days.setDate(dateBefore60Days.getDate() - MAX_DAYS_TO_KEEP_COUNTS);\n        if(dateKeys.length > MAX_DAYS_TO_KEEP_COUNTS) {\n            for(let dateKey of dateKeys){\n                let date = new Date(dateKey);\n                if(date < dateBefore60Days) {\n                    delete usageData[dateKey];\n                }\n            }\n        }\n        // low priority, we do not want to save this right now\n        PreferencesManager.setViewState(USAGE_COUNTS_KEY, usageData);\n    }\n\n    function _trackUsageInfo() {\n        _pruneUsageData();\n        setInterval(()=>{\n            if(healthDataDisabled){\n                return;\n            }\n            let usageData = PreferencesManager.getViewState(USAGE_COUNTS_KEY) || {};\n            let dateNow = new Date();\n            let today = dateNow.toISOString().split('T')[0]; // yyyy-mm-dd format\n            usageData[today] = (usageData[today] || 0) + 1;\n            // low priority, we do not want to save this right now\n            PreferencesManager.setViewState(USAGE_COUNTS_KEY, usageData);\n        }, ONE_MINUTE);\n    }\n\n    AppInit.appReady(function () {\n        Metrics.init({\n            isPowerUserFn: isPowerUser\n        });\n        healthDataDisabled = !prefs.get(\"healthDataTracking\");\n        Metrics.setDisabled(healthDataDisabled);\n        SendToAnalytics.sendPlatformMetrics();\n        SendToAnalytics.sendThemesMetrics();\n        _trackUsageInfo();\n        setTimeout(SendToAnalytics.sendStartupPerformanceMetrics, TEN_SECOND);\n    });\n});\n\n/*\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2015 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\n/*global Phoenix*/\n\ndefine(\"HealthDataNotification\", function (require, exports, module) {\n\n    var PreferencesManager           = brackets.getModule(\"preferences/PreferencesManager\"),\n        ExtensionInterface           = brackets.getModule(\"utils/ExtensionInterface\"),\n        HealthDataPreview            = require(\"HealthDataPreview\"),\n        HealthDataPopup              = require(\"HealthDataPopup\");\n\n    const NEW_PROJECT_EXTENSION_INTERFACE = \"Extn.Phoenix.newProject\",\n        // Since we don't have any user accounts or trackable ID to uniquely identify a user on first launch,\n        // we should be ok GDPR wise to delay showing the health data popup. But it was found later to be annoying\n        // and a workflow distraction. So we show the health data popup almost immediately so that the user can\n        // close all the popups in on go.\n        POPUP_FIRST_LAUNCH_SHOW_DELAY = 5000;\n\n    let newProjectExtension;\n    ExtensionInterface.waitAndGetExtensionInterface(NEW_PROJECT_EXTENSION_INTERFACE)\n        .then(interfaceObj => {\n            newProjectExtension = interfaceObj;\n            interfaceObj.on(interfaceObj.EVENT_NEW_PROJECT_DIALOGUE_CLOSED, ()=>{\n                setTimeout(_showFirstLaunchPopup, POPUP_FIRST_LAUNCH_SHOW_DELAY);\n            });\n        });\n\n    function handleHealthDataStatistics() {\n        HealthDataPreview.previewHealthData();\n    }\n\n    let popupShownInThisSession = false;\n    function _showFirstLaunchPopup() {\n        // call this only after newProjectExtn interface is available\n        // Check whether the notification dialog should be shown. It will be shown only one time.\n        if(popupShownInThisSession){\n            return;\n        }\n        popupShownInThisSession = true;\n        newProjectExtension.off(newProjectExtension.EVENT_NEW_PROJECT_DIALOGUE_CLOSED, _showFirstLaunchPopup);\n        if(!window.testEnvironment){\n            const alreadyShown = PreferencesManager.getViewState(\"healthDataNotificationShown\");\n            const prefs = PreferencesManager.getExtensionPrefs(\"healthData\");\n            if (!alreadyShown && prefs.get(\"healthDataTracking\")) {\n                HealthDataPopup.showFirstLaunchTooltip()\n                    .done(function () {\n                        PreferencesManager.setViewState(\"healthDataNotificationShown\", true);\n                    });\n            }\n        }\n    }\n\n    exports.handleHealthDataStatistics       = handleHealthDataStatistics;\n});\n\n/*\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2015 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\ndefine(\"HealthDataPopup\", function (require, exports, module) {\n\n    // Load dependent modules\n    const NotificationUI = brackets.getModule(\"widgets/NotificationUI\"),\n        Strings = brackets.getModule(\"strings\");\n\n    function showFirstLaunchTooltip() {\n        const deferred = new $.Deferred();\n        NotificationUI.createToastFromTemplate(Strings.HEALTH_FIRST_POPUP_TITLE,\n            `<div id=\"healthdata-firstlaunch-popup\">${Strings.HEALTH_DATA_NOTIFICATION_MESSAGE}</div>`).done(deferred.resolve);\n        return deferred.promise();\n    }\n\n    exports.showFirstLaunchTooltip          = showFirstLaunchTooltip;\n});\n\n/*\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2015 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\ndefine(\"HealthDataPreview\", function (require, exports, module) {\n\n    var _                       = brackets.getModule(\"thirdparty/lodash\"),\n        Mustache                = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        PreferencesManager      = brackets.getModule(\"preferences/PreferencesManager\"),\n        Strings                 = brackets.getModule(\"strings\"),\n        Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        ExtensionUtils          = brackets.getModule(\"utils/ExtensionUtils\"),\n        Metrics                 = brackets.getModule(\"utils/Metrics\"),\n        HealthDataPreviewDialog = `<div class=\"health-data-preview modal\">\n    <div class=\"modal-header\">\n        <h1 class=\"dialog-title\">{{Strings.HEALTH_DATA_PREVIEW}}</h1>\n    </div>\n    <div class=\"modal-body\">\n        <div class=\"dialog-message\">{{{Strings.HEALTH_DATA_PREVIEW_INTRO}}}</div>\n\t\t<div class=\"dialog-message\">\n\t\t\t<label>\n\t            <input type=\"checkbox\" data-target=\"hdPref\" {{#hdPref}}checked{{/hdPref}} />\n\t            {{Strings.HEALTH_DATA_DO_TRACK}}\n\t        </label>\n    \t</div>\n\t    <div class=\"dialog-message preview-content-container\">\n\t        <p class=\"preview-content\">{{{content}}}</p>\n\t    </div>\n\t</div>\n    <div class=\"modal-footer\">\n\t\t<button class=\"dialog-button btn\" data-button-id=\"clear\">{{Strings.RECENT_FILES_DLG_CLEAR_BUTTON_LABEL}}</button>\n\t\t<button class=\"dialog-button btn\" data-button-id=\"cancel\">{{Strings.CANCEL}}</button>\n        <button class=\"dialog-button btn primary\" data-button-id=\"save\">{{Strings.DONE}}</button>\n    </div>\n</div>\n`;\n\n    var prefs = PreferencesManager.getExtensionPrefs(\"healthData\");\n\n    ExtensionUtils.loadStyleSheet(module, \"styles.css\");\n\n    function _buildPreviewData() {\n        let content;\n        let auditData = Metrics.getLoggedDataForAudit();\n        let sortedData = new Map([...auditData.entries()].sort());\n        let displayData = [];\n        for (const [key, value] of sortedData.entries()) {\n            let valueString = \"\";\n            if(value.count > 1) {\n                valueString = `(${value.count})`;\n            }\n            if(value.eventType === Metrics.AUDIT_TYPE_COUNT){\n                displayData.push(`${key}  total: ${value.sum} ${valueString}`);\n            } else if(value.eventType === Metrics.AUDIT_TYPE_VALUE && value.count !== 0){\n                displayData.push(`${key}  avg: ${value.sum/value.count} ${valueString}`);\n            }\n        }\n        content = JSON.stringify(displayData, null, 2);\n        content = _.escape(content);\n        content = content.replace(/ /g, \"&nbsp;\");\n        content = content.replace(/(?:\\r\\n|\\r|\\n)/g, \"<br />\");\n        return content;\n    }\n\n    /**\n     * Show the dialog for previewing the Health Data that will be sent.\n     */\n    function previewHealthData() {\n        let hdPref   = prefs.get(\"healthDataTracking\"),\n            template = Mustache.render(HealthDataPreviewDialog,\n                {Strings: Strings, content: _buildPreviewData(), hdPref: hdPref}),\n            $template = $(template);\n\n        Dialogs.addLinkTooltips($template);\n        Dialogs.showModalDialogUsingTemplate($template).done(function (id) {\n\n            if (id === \"save\") {\n                var newHDPref = $template.find(\"[data-target]:checkbox\").is(\":checked\");\n                if (hdPref !== newHDPref) {\n                    prefs.set(\"healthDataTracking\", newHDPref);\n                }\n            } else if (id === 'clear'){\n                Metrics.clearAuditData();\n            }\n        });\n    }\n\n    exports.previewHealthData = previewHealthData;\n});\n\n/*\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\n/*global Phoenix*/\ndefine(\"SendToAnalytics\", function (require, exports, module) {\n    const Metrics = brackets.getModule(\"utils/Metrics\"),\n        PreferencesManager  = brackets.getModule(\"preferences/PreferencesManager\"),\n        PerfUtils           = brackets.getModule(\"utils/PerfUtils\"),\n        NodeUtils           = brackets.getModule(\"utils/NodeUtils\"),\n        themesPref          = PreferencesManager.getExtensionPrefs(\"themes\");\n\n    const PLATFORM = Metrics.EVENT_TYPE.PLATFORM,\n        PERFORMANCE = Metrics.EVENT_TYPE.PERFORMANCE,\n        STORAGE = Metrics.EVENT_TYPE.STORAGE;\n\n    // Platform metrics to be sent at startup\n    function _emitDeviceTypeMetrics() {\n        if(brackets.browser.isDeskTop) {\n            Metrics.countEvent(PLATFORM, \"device\", \"desktop\");\n        }\n        if(brackets.browser.isMobile) {\n            Metrics.countEvent(PLATFORM, \"device\", \"mobile\");\n        }\n        if(brackets.browser.isTablet) {\n            Metrics.countEvent(PLATFORM, \"device\", \"tablet\");\n        }\n    }\n    function _emitMobileMetricsIfPresent() {\n        let platform = \"none\";\n        if(brackets.browser.mobile.isIos) {\n            platform = \"ios\";\n        } else if(brackets.browser.mobile.isWindows) {\n            platform = \"windows\";\n        } else if(brackets.browser.mobile.isAndroid) {\n            platform = \"android\";\n        } else {\n            return;\n        }\n        Metrics.countEvent(PLATFORM, \"mobile\", platform);\n    }\n    function _emitBrowserMetrics() {\n        if(brackets.browser.desktop.isChrome) {\n            Metrics.countEvent(PLATFORM, \"browser\", \"chrome\");\n        }\n        if(brackets.browser.desktop.isChromeBased) {\n            Metrics.countEvent(PLATFORM, \"browser\", \"chromeBased\");\n        }\n        if(brackets.browser.desktop.isEdgeChromium) {\n            Metrics.countEvent(PLATFORM, \"browser\", \"EdgeChromium\");\n        }\n        if(brackets.browser.desktop.isFirefox) {\n            Metrics.countEvent(PLATFORM, \"browser\", \"firefox\");\n        }\n        if(brackets.browser.desktop.isOpera) {\n            Metrics.countEvent(PLATFORM, \"browser\", \"opera\");\n        }\n        if(brackets.browser.desktop.isOperaChromium) {\n            Metrics.countEvent(PLATFORM, \"browser\", \"operaChromium\");\n        }\n    }\n\n    // web storage\n    async function _sendStorageMetrics() {\n        if (navigator.storage && navigator.storage.estimate) {\n            const quota = await navigator.storage.estimate();\n            // quota.usage -> Number of bytes used.\n            // quota.quota -> Maximum number of bytes available.\n            const percentageUsed = Math.round((quota.usage / quota.quota) * 100);\n            const usedMB = Math.round(quota.usage / 1024 / 1024);\n            console.log(`Web Storage quota used: ${percentageUsed}%, ${usedMB}MB`);\n            Metrics.valueEvent(STORAGE, \"browserQuota\", \"percentUsed\", percentageUsed);\n            Metrics.valueEvent(STORAGE, \"browserQuota\", \"usedMB\", usedMB);\n        }\n    }\n\n    function _getPlatformInfo() {\n        let OS = \"\";\n        if (/Windows|Win32|WOW64|Win64/.test(window.navigator.userAgent)) {\n            OS = \"WIN\";\n        } else if (/Mac/.test(window.navigator.userAgent)) {\n            OS = \"OSX\";\n        } else if (/Linux|X11/.test(window.navigator.userAgent)) {\n            OS = \"LINUX32\";\n            if (/x86_64/.test(window.navigator.appVersion + window.navigator.userAgent)) {\n                OS = \"LINUX64\";\n            }\n        }\n\n        return OS;\n    }\n\n    function sendPlatformMetrics() {\n        Metrics.countEvent(PLATFORM, \"os\", brackets.platform);\n        Metrics.countEvent(PLATFORM, \"userAgent\", window.navigator.userAgent);\n        Metrics.countEvent(PLATFORM, \"languageOS\", brackets.app.language);\n        Metrics.countEvent(PLATFORM, \"languageBrackets\", brackets.getLocale());\n        Metrics.countEvent(PLATFORM, \"bracketsVersion\", brackets.metadata.version);\n        if(Phoenix.platform === \"linux\" && Phoenix.isNativeApp) {\n            NodeUtils.getLinuxOSFlavorName()\n                .then(flavor=>{\n                    if(flavor){\n                        Metrics.countEvent(PLATFORM, \"os.flavor\", flavor);\n                    } else {\n                        Metrics.countEvent(PLATFORM, \"os.flavor\", _getPlatformInfo());\n                    }\n                });\n        } else {\n            Metrics.countEvent(PLATFORM, \"os.flavor\", _getPlatformInfo());\n        }\n        _emitDeviceTypeMetrics();\n        _emitBrowserMetrics();\n        _emitMobileMetricsIfPresent();\n        _sendStorageMetrics();\n    }\n\n    function _bugsnagPerformance(key, valueMs) {\n        if(Metrics.isDisabled() || !window.BugsnagPerformance || Phoenix.isTestWindow){\n            return;\n        }\n        let activityStartTime = new Date();\n        let activityEndTime = new Date(activityStartTime.getTime() + valueMs);\n        window.BugsnagPerformance\n            .startSpan(key, { startTime: activityStartTime })\n            .end(activityEndTime);\n    }\n    \n    // Performance\n    function sendStartupPerformanceMetrics() {\n        const healthReport = PerfUtils.getHealthReport();\n        let labelAppStart = \"AppStartupTime\";\n        if(Phoenix.firstBoot){\n            labelAppStart = \"FirstBootTime\";\n        }\n        Metrics.valueEvent(PERFORMANCE, \"startup\", labelAppStart,\n            Number(healthReport[\"AppStartupTime\"]));\n        _bugsnagPerformance(labelAppStart, Number(healthReport[\"AppStartupTime\"])); // expensive api, use sparsely\n        Metrics.valueEvent(PERFORMANCE, \"startup\", \"ModuleDepsResolved\",\n            Number(healthReport[\"ModuleDepsResolved\"]));\n        _bugsnagPerformance(\"ModuleDepsResolved\", Number(healthReport[\"ModuleDepsResolved\"])); // expensive api, use sparsely\n        Metrics.valueEvent(PERFORMANCE, \"startup\", \"PhStore\", PhStore._storageBootstrapTime);\n        _bugsnagPerformance(\"PhStore\",\n            PhStore._storageBootstrapTime); // expensive api, use sparsely\n        if(Phoenix.isNativeApp) {\n            Metrics.valueEvent(PERFORMANCE, \"startup\", \"tauriBoot\", window._tauriBootVars.bootstrapTime);\n            _bugsnagPerformance(\"tauriBootVars\",\n                window._tauriBootVars.bootstrapTime); // expensive api, use sparsely\n        }\n        if(window.nodeSetupDonePromise) {\n            window.nodeSetupDonePromise\n                .then(()=>{\n                    if(window.PhNodeEngine && window.PhNodeEngine._nodeLoadTime){\n                        Metrics.valueEvent(PERFORMANCE, \"startup\", \"nodeBoot\", window.PhNodeEngine._nodeLoadTime);\n                        _bugsnagPerformance(\"nodeBoot\",\n                            window.PhNodeEngine._nodeLoadTime); // expensive api, use sparsely\n                    }\n                    Metrics.countEvent(PERFORMANCE, \"nodeBoot\", \"success\", 1);\n                })\n                .catch(_err=>{\n                    Metrics.countEvent(PERFORMANCE, \"nodeBoot\", \"fail\", 1);\n                });\n        }\n    }\n\n    // Themes\n    function _getCurrentTheme() {\n        // TODO: currently phoenix only have default themes, but in future, we should ensure that only themes in the\n        //  registry and user installed are logged for privacy.\n        return themesPref.get(\"theme\") || \"default\";\n    }\n    function sendThemesMetrics() {\n        Metrics.countEvent(Metrics.EVENT_TYPE.THEMES, \"currentTheme\", _getCurrentTheme());\n    }\n\n    exports.sendPlatformMetrics = sendPlatformMetrics;\n    exports.sendStartupPerformanceMetrics = sendStartupPerformanceMetrics;\n    exports.sendThemesMetrics = sendThemesMetrics;\n    // TODO: send extension metrics\n});\n"],"file":"extension-min.js"}