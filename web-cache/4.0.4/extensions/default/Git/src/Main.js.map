{"version":3,"sources":["extensions/default/Git/src/Main.js"],"names":["define","require","exports","_","brackets","getModule","CommandManager","Commands","Menus","FileSystem","Mustache","Metrics","ProjectManager","Constants","Events","EventEmitter","Strings","StringUtils","ErrorHandler","Panel","Branch","SettingsDialog","Dialogs","CloseNotModified","Setup","Preferences","Utils","Git","gitTagDialogTemplate","CMD_ADD_TO_IGNORE","CMD_REMOVE_FROM_IGNORE","$icon","$","STATUSBAR_SHOW_GIT","addClass","prependTo","gitEnabled","initUi","init","on","toggle","_addRemoveItemInGitignore","selectedEntry","method","gitRoot","get","entryPath","fullPath","substring","length","gitignoreEntry","getFileForPath","read","err","content","consoleWarn","lines","split","map","l","trim","shift","pop","indexOf","push","without","write","join","showError","ERROR_MODIFY_GITIGNORE","refresh","addItemToGitingore","getSelectedItem","removeItemFromGitingore","addItemToGitingoreFromPanel","filePath","getPanel","find","attr","fileEntry","removeItemFromGitingoreFromPanel","_refreshCallback","emit","REFRESH_ALL","checkoutCommit","commitHash","commitDetail","getSelectedHistoryCommit","hash","commitDetailStr","subject","console","error","displayStr","format","CHECKOUT_COMMIT_DETAIL","askQuestion","TITLE_CHECKOUT","DIALOG_CHECKOUT","booleanResponse","noescape","customOkBtn","CHECKOUT_COMMIT","then","response","checkout","tagCommit","compiledTemplate","render","dialog","showModalDialogUsingTemplate","$dialog","getElement","focus","tagname","val","setTagName","REFRESH_HISTORY","catch","ERROR_CREATE_TAG","_resetOperation","operation","title","message","gitCmdUsed","RESET_DETAIL","RESET","customOkBtnClass","reset","resetHard","RESET_HARD_TITLE","RESET_HARD_MESSAGE","resetMixed","RESET_MIXED_TITLE","RESET_MIXED_MESSAGE","resetSoft","RESET_SOFT_TITLE","RESET_SOFT_MESSAGE","disableAllMenus","commandsToDisable","CMD_GIT_INIT","CMD_GIT_CLONE","CMD_GIT_TOGGLE_PANEL","CMD_GIT_REFRESH","CMD_GIT_GOTO_NEXT_CHANGE","CMD_GIT_GOTO_PREVIOUS_CHANGE","CMD_GIT_CLOSE_UNMODIFIED","CMD_GIT_AUTHORS_OF_SELECTION","CMD_GIT_AUTHORS_OF_FILE","CMD_GIT_COMMIT_CURRENT","CMD_GIT_COMMIT_ALL","CMD_GIT_FETCH","CMD_GIT_PULL","CMD_GIT_PUSH","CMD_GIT_GERRIT_PUSH_REF","CMD_GIT_CHANGE_USERNAME","CMD_GIT_CHANGE_EMAIL","CMD_GIT_SETTINGS_COMMAND_ID","CMD_GIT_CHECKOUT","CMD_GIT_TAG","CMD_GIT_RESET_HARD","CMD_GIT_RESET_MIXED","CMD_GIT_RESET_SOFT","CMD_GIT_DISCARD_ALL_CHANGES","CMD_GIT_UNDO_LAST_COMMIT","CMD_GIT_TOGGLE_UNTRACKED","forEach","cmdId","enableCommand","initGitMenu","fileMenu","getMenu","AppMenuBar","FILE_MENU","gitSubMenu","addSubMenu","GIT_STRING_UNIVERSAL","GIT_SUB_MENU","AFTER","FILE_EXTENSION_MANAGER","addMenuDivider","addMenuItem","undefined","hideWhenCommandDisabled","register","ADD_TO_GITIGNORE","REMOVE_FROM_GITIGNORE","panelCmenu","registerContextMenu","GIT_PANEL_CHANGES_CMENU","historyCmenu","GIT_PANEL_HISTORY_CMENU","MENU_RESET_HARD","MENU_RESET_MIXED","MENU_RESET_SOFT","MENU_TAG_COMMIT","optionsCmenu","GIT_PANEL_OPTIONS_CMENU","ContextMenu","assignContextMenuToSelector","isExtensionActivated","GIT_SETTINGS","show","enabled","GIT_DISABLED","removeClass","GIT_STATUS_RESULTS","sortedResults","toggleClass","_toggleMenuEntriesState","_divider1","_divider2","toggleMenuEntries","bool","projectCmenu","getContextMenu","ContextMenuIds","PROJECT_MENU","workingCmenu","WORKING_SET_CONTEXT_MENU","removeMenuDivider","id","removeMenuItem","_enableAllCommands","is","lastExecutionTime","isCommandExecuting","FOCUS_SWITCH_DEDUPE_TIME","refreshOnFocusChange","now","Date","hasStatusChanged","hasChanged","execute","fail","finally","window","projectSwitched","BRACKETS_PROJECT_CHANGE","GIT_ENABLED","countEvent","EVENT_TYPE","GIT"],"mappings":"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","sourcesContent":["define(function (require, exports) {\n\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        CommandManager    = brackets.getModule(\"command/CommandManager\"),\n        Commands          = brackets.getModule(\"command/Commands\"),\n        Menus             = brackets.getModule(\"command/Menus\"),\n        FileSystem        = brackets.getModule(\"filesystem/FileSystem\"),\n        Mustache          = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics           = brackets.getModule(\"utils/Metrics\"),\n        ProjectManager    = brackets.getModule(\"project/ProjectManager\");\n\n    const Constants       = require(\"src/Constants\"),\n        Events            = require(\"src/Events\"),\n        EventEmitter      = require(\"src/EventEmitter\"),\n        Strings             = brackets.getModule(\"strings\"),\n        StringUtils             = brackets.getModule(\"utils/StringUtils\"),\n        ErrorHandler      = require(\"src/ErrorHandler\"),\n        Panel             = require(\"src/Panel\"),\n        Branch            = require(\"src/Branch\"),\n        SettingsDialog    = require(\"src/SettingsDialog\"),\n        Dialogs                 = brackets.getModule(\"widgets/Dialogs\"),\n        CloseNotModified  = require(\"src/CloseNotModified\"),\n        Setup             = require(\"src/utils/Setup\"),\n        Preferences       = require(\"src/Preferences\"),\n        Utils             = require(\"src/Utils\"),\n        Git               = require(\"src/git/Git\"),\n        gitTagDialogTemplate    = require(\"text!templates/git-tag-dialog.html\");\n\n    const CMD_ADD_TO_IGNORE      = \"git.addToIgnore\",\n        CMD_REMOVE_FROM_IGNORE = \"git.removeFromIgnore\",\n        $icon                  = $(`<a id='git-toolbar-icon' title=\"${Strings.STATUSBAR_SHOW_GIT}\" href='#'></a>`)\n                                    .addClass(\"forced-hidden\")\n                                    .prependTo($(\".bottom-buttons\"));\n\n    let gitEnabled = false;\n\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        $icon.removeClass(\"dirty\");\n    });\n\n    EventEmitter.on(Events.GIT_STATUS_RESULTS, function (sortedResults) {\n        $icon.toggleClass(\"dirty\", sortedResults.length !== 0);\n    });\n\n    // This only launches when Git is available\n    function initUi() {\n        // FUTURE: do we really need to launch init from here?\n        Panel.init();\n        Branch.init();\n        CloseNotModified.init();\n        // Attach events\n        $icon.on(\"click\", Panel.toggle);\n    }\n\n    function _addRemoveItemInGitignore(selectedEntry, method) {\n        var gitRoot = Preferences.get(\"currentGitRoot\"),\n            entryPath = \"/\" + selectedEntry.fullPath.substring(gitRoot.length),\n            gitignoreEntry = FileSystem.getFileForPath(gitRoot + \".gitignore\");\n\n        gitignoreEntry.read(function (err, content) {\n            if (err) {\n                Utils.consoleWarn(err);\n                content = \"\";\n            }\n\n            // use trimmed lines only\n            var lines = content.split(\"\\n\").map(function (l) { return l.trim(); });\n            // clean start and end empty lines\n            while (lines.length > 0 && !lines[0]) { lines.shift(); }\n            while (lines.length > 0 && !lines[lines.length - 1]) { lines.pop(); }\n\n            if (method === \"add\") {\n                // add only when not already present\n                if (lines.indexOf(entryPath) === -1) { lines.push(entryPath); }\n            } else if (method === \"remove\") {\n                lines = _.without(lines, entryPath);\n            }\n\n            // always have an empty line at the end of the file\n            if (lines[lines.length - 1]) { lines.push(\"\"); }\n\n            gitignoreEntry.write(lines.join(\"\\n\"), function (err) {\n                if (err) {\n                    return ErrorHandler.showError(err, Strings.ERROR_MODIFY_GITIGNORE);\n                }\n                Panel.refresh();\n            });\n        });\n    }\n\n    function addItemToGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"add\");\n    }\n\n    function removeItemFromGitingore() {\n        return _addRemoveItemInGitignore(ProjectManager.getSelectedItem(), \"remove\");\n    }\n\n    function addItemToGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"add\");\n    }\n\n    function removeItemFromGitingoreFromPanel() {\n        var filePath = Panel.getPanel().find(\"tr.selected\").attr(\"x-file\"),\n            fileEntry = FileSystem.getFileForPath(Preferences.get(\"currentGitRoot\") + filePath);\n        return _addRemoveItemInGitignore(fileEntry, \"remove\");\n    }\n\n    function _refreshCallback() {\n        EventEmitter.emit(Events.REFRESH_ALL);\n    }\n\n    function checkoutCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git checkout as commit hash is ${commitHash}`);\n            return;\n        }\n        const displayStr = StringUtils.format(Strings.CHECKOUT_COMMIT_DETAIL, commitDetailStr, commitHash);\n        Utils.askQuestion(Strings.TITLE_CHECKOUT,\n            displayStr + \"<br><br>\" + Strings.DIALOG_CHECKOUT,\n            { booleanResponse: true, noescape: true, customOkBtn: Strings.CHECKOUT_COMMIT })\n            .then(function (response) {\n                if (response === true) {\n                    return Git.checkout(commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function tagCommit(commitHash) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash || \"\";\n        const compiledTemplate = Mustache.render(gitTagDialogTemplate, { Strings }),\n            dialog           = Dialogs.showModalDialogUsingTemplate(compiledTemplate),\n            $dialog          = dialog.getElement();\n        $dialog.find(\"input\").focus();\n        $dialog.find(\"button.primary\").on(\"click\", function () {\n            const tagname = $dialog.find(\"input.commit-message\").val();\n            Git.setTagName(tagname, commitHash).then(function () {\n                EventEmitter.emit(Events.REFRESH_HISTORY);\n            }).catch(function (err) {\n                ErrorHandler.showError(err, Strings.ERROR_CREATE_TAG);\n            });\n        });\n    }\n\n    function _resetOperation(operation, commitHash, title, message) {\n        const commitDetail = Panel.getSelectedHistoryCommit() || {};\n        commitHash = commitHash || commitDetail.hash;\n        const commitDetailStr = commitDetail.subject || \"\";\n        if(!commitHash){\n            console.error(`Cannot do Git Reset ${operation} as commit hash is ${commitHash}`);\n            return;\n        }\n        const gitCmdUsed = `git reset ${operation} ${commitHash}`;\n        const displayStr = StringUtils.format(Strings.RESET_DETAIL, commitDetailStr, gitCmdUsed);\n        Utils.askQuestion(title,\n            message + \"<br><br>\" + displayStr,\n            { booleanResponse: true, noescape: true ,\n                customOkBtn: Strings.RESET, customOkBtnClass: \"danger\"})\n            .then(function (response) {\n                if (response === true) {\n                    return Git.reset(operation, commitHash).then(_refreshCallback);\n                }\n            });\n    }\n\n    function resetHard(commitHash) {\n        return _resetOperation(\"--hard\", commitHash,\n            Strings.RESET_HARD_TITLE, Strings.RESET_HARD_MESSAGE);\n    }\n\n    function resetMixed(commitHash) {\n        return _resetOperation(\"--mixed\", commitHash,\n            Strings.RESET_MIXED_TITLE, Strings.RESET_MIXED_MESSAGE);\n    }\n\n    function resetSoft(commitHash) {\n        return _resetOperation(\"--soft\", commitHash,\n            Strings.RESET_SOFT_TITLE, Strings.RESET_SOFT_MESSAGE);\n    }\n\n    /**\n     * Disables all Git-related commands that were registered in `initGitMenu`.\n     * After calling this function, none of these menu items will be clickable.\n     */\n    function disableAllMenus() {\n        // Collect all command IDs that were registered in initGitMenu\n        const commandsToDisable = [\n            // File menu items\n            Constants.CMD_GIT_INIT,\n            Constants.CMD_GIT_CLONE,\n            Constants.CMD_GIT_TOGGLE_PANEL,\n            Constants.CMD_GIT_REFRESH,\n            Constants.CMD_GIT_GOTO_NEXT_CHANGE,\n            Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE,\n            Constants.CMD_GIT_CLOSE_UNMODIFIED,\n            Constants.CMD_GIT_AUTHORS_OF_SELECTION,\n            Constants.CMD_GIT_AUTHORS_OF_FILE,\n            Constants.CMD_GIT_COMMIT_CURRENT,\n            Constants.CMD_GIT_COMMIT_ALL,\n            Constants.CMD_GIT_FETCH,\n            Constants.CMD_GIT_PULL,\n            Constants.CMD_GIT_PUSH,\n            Constants.CMD_GIT_GERRIT_PUSH_REF,\n            Constants.CMD_GIT_CHANGE_USERNAME,\n            Constants.CMD_GIT_CHANGE_EMAIL,\n            Constants.CMD_GIT_SETTINGS_COMMAND_ID,\n\n            // Project tree/working files commands\n            CMD_ADD_TO_IGNORE,\n            CMD_REMOVE_FROM_IGNORE,\n            // Panel context menu commands (with \"2\" suffix)\n            CMD_ADD_TO_IGNORE + \"2\",\n            CMD_REMOVE_FROM_IGNORE + \"2\",\n\n            // History context menu commands\n            Constants.CMD_GIT_CHECKOUT,\n            Constants.CMD_GIT_TAG,\n            Constants.CMD_GIT_RESET_HARD,\n            Constants.CMD_GIT_RESET_MIXED,\n            Constants.CMD_GIT_RESET_SOFT,\n\n            // \"More options\" context menu commands\n            Constants.CMD_GIT_DISCARD_ALL_CHANGES,\n            Constants.CMD_GIT_UNDO_LAST_COMMIT,\n            Constants.CMD_GIT_TOGGLE_UNTRACKED\n        ];\n\n        // Disable each command\n        commandsToDisable.forEach((cmdId) => {\n            Utils.enableCommand(cmdId, false);\n        });\n    }\n\n\n    function initGitMenu() {\n        // Register command and add it to the menu.\n        const fileMenu = Menus.getMenu(Menus.AppMenuBar.FILE_MENU);\n        let gitSubMenu = fileMenu.addSubMenu(Constants.GIT_STRING_UNIVERSAL,\n            Constants.GIT_SUB_MENU, Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        fileMenu.addMenuDivider(Menus.AFTER, Commands.FILE_EXTENSION_MANAGER);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_INIT, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLONE, undefined, undefined, undefined, {\n            hideWhenCommandDisabled: true\n        });\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_TOGGLE_PANEL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_REFRESH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_NEXT_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CLOSE_UNMODIFIED);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_CURRENT);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_COMMIT_ALL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PULL);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        gitSubMenu.addMenuDivider();\n        gitSubMenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        // register commands for project tree / working files\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE, addItemToGitingore);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE, removeItemFromGitingore);\n\n        // create context menu for git panel\n        const panelCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_CHANGES_CMENU);\n        CommandManager.register(Strings.ADD_TO_GITIGNORE, CMD_ADD_TO_IGNORE + \"2\", addItemToGitingoreFromPanel);\n        CommandManager.register(Strings.REMOVE_FROM_GITIGNORE, CMD_REMOVE_FROM_IGNORE + \"2\", removeItemFromGitingoreFromPanel);\n        panelCmenu.addMenuItem(CMD_ADD_TO_IGNORE + \"2\");\n        panelCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE + \"2\");\n\n        // create context menu for git history\n        const historyCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_HISTORY_CMENU);\n        CommandManager.register(Strings.CHECKOUT_COMMIT, Constants.CMD_GIT_CHECKOUT, checkoutCommit);\n        CommandManager.register(Strings.MENU_RESET_HARD, Constants.CMD_GIT_RESET_HARD, resetHard);\n        CommandManager.register(Strings.MENU_RESET_MIXED, Constants.CMD_GIT_RESET_MIXED, resetMixed);\n        CommandManager.register(Strings.MENU_RESET_SOFT, Constants.CMD_GIT_RESET_SOFT, resetSoft);\n        CommandManager.register(Strings.MENU_TAG_COMMIT, Constants.CMD_GIT_TAG, tagCommit);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_CHECKOUT);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_TAG);\n        historyCmenu.addMenuDivider();\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_HARD);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_MIXED);\n        historyCmenu.addMenuItem(Constants.CMD_GIT_RESET_SOFT);\n\n        // create context menu for git more options\n        const optionsCmenu = Menus.registerContextMenu(Constants.GIT_PANEL_OPTIONS_CMENU);\n        Menus.ContextMenu.assignContextMenuToSelector(\".git-more-options-btn\", optionsCmenu);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_DISCARD_ALL_CHANGES);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_UNDO_LAST_COMMIT);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_SELECTION);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_AUTHORS_OF_FILE);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_FETCH);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PULL);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_PUSH);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_TOGGLE_UNTRACKED);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_GERRIT_PUSH_REF);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_USERNAME);\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_CHANGE_EMAIL);\n        optionsCmenu.addMenuDivider();\n        optionsCmenu.addMenuItem(Constants.CMD_GIT_SETTINGS_COMMAND_ID);\n\n        if(!Setup.isExtensionActivated()){\n            disableAllMenus();\n        }\n    }\n\n    function init() {\n        CommandManager.register(Strings.GIT_SETTINGS, Constants.CMD_GIT_SETTINGS_COMMAND_ID, SettingsDialog.show);\n        // Try to get Git version, if succeeds then Git works\n        return Setup.init().then(function (enabled) {\n            initUi();\n            initGitMenu();\n            return enabled;\n        });\n    }\n\n    var _toggleMenuEntriesState = false,\n        _divider1 = null,\n        _divider2 = null;\n    function toggleMenuEntries(bool) {\n        if (bool === _toggleMenuEntriesState) {\n            return;\n        }\n        var projectCmenu = Menus.getContextMenu(Menus.ContextMenuIds.PROJECT_MENU);\n        var workingCmenu = Menus.getContextMenu(Menus.ContextMenuIds.WORKING_SET_CONTEXT_MENU);\n        if (bool) {\n            _divider1 = projectCmenu.addMenuDivider();\n            _divider2 = workingCmenu.addMenuDivider();\n            projectCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.addMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.addMenuItem(CMD_REMOVE_FROM_IGNORE);\n        } else {\n            projectCmenu.removeMenuDivider(_divider1.id);\n            workingCmenu.removeMenuDivider(_divider2.id);\n            projectCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            workingCmenu.removeMenuItem(CMD_ADD_TO_IGNORE);\n            projectCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n            workingCmenu.removeMenuItem(CMD_REMOVE_FROM_IGNORE);\n        }\n        _toggleMenuEntriesState = bool;\n    }\n\n    function _enableAllCommands(enabled) {\n        Utils.enableCommand(Constants.CMD_GIT_REFRESH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_NEXT_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_GOTO_PREVIOUS_CHANGE, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_CLOSE_UNMODIFIED, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_SELECTION, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_AUTHORS_OF_FILE, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_CURRENT, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_COMMIT_ALL, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_FETCH, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PULL, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_PUSH, enabled);\n\n        Utils.enableCommand(Constants.CMD_GIT_DISCARD_ALL_CHANGES, enabled);\n        Utils.enableCommand(Constants.CMD_GIT_UNDO_LAST_COMMIT, enabled);\n        toggleMenuEntries(enabled);\n        if(enabled){\n            $icon.removeClass(\"forced-hidden\");\n        } else if(!$(\"#git-panel\").is(\":visible\")){\n            $icon.addClass(\"forced-hidden\");\n        }\n    }\n\n    let lastExecutionTime = 0;\n    let isCommandExecuting = false;\n    const FOCUS_SWITCH_DEDUPE_TIME = 5000;\n    function refreshOnFocusChange() {\n        // to sync external git changes after switching to app.\n        if (gitEnabled) {\n            const now = Date.now();\n\n            if (isCommandExecuting) {\n                return;\n            }\n\n            if (now - lastExecutionTime > FOCUS_SWITCH_DEDUPE_TIME) {\n                isCommandExecuting = true;\n                lastExecutionTime = Date.now();\n                Git.hasStatusChanged().then((hasChanged) => {\n                    if(!hasChanged){\n                        return;\n                    }\n\n                    CommandManager.execute(Constants.CMD_GIT_REFRESH).fail((err) => {\n                        console.error(\"error refreshing on focus switch\", err);\n                    });\n                }).finally(()=>{\n                    isCommandExecuting = false;\n                });\n            }\n        }\n    }\n    $(window).focus(refreshOnFocusChange);\n\n    // Event handlers\n    let projectSwitched = true;\n    EventEmitter.on(Events.BRACKETS_PROJECT_CHANGE, function () {\n        // pressing refresh button will raise GIT_ENABLED event and we only want one enabled metric\n        // per project open.\n        projectSwitched = true;\n    });\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        _enableAllCommands(true);\n        gitEnabled = true;\n        projectSwitched && Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'enabled', \"project\");\n        projectSwitched = false;\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        _enableAllCommands(false);\n        gitEnabled = false;\n    });\n\n    // API\n    exports.$icon = $icon;\n    exports.init = init;\n\n});\n"],"file":"Main.js"}