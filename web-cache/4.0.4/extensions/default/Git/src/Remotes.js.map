{"version":3,"sources":["extensions/default/Git/src/Remotes.js"],"names":["define","require","_","brackets","getModule","DefaultDialogs","Dialogs","Mustache","Metrics","Strings","StringUtils","ErrorHandler","Events","EventEmitter","Git","Preferences","ProgressDialog","PullDialog","PushDialog","Utils","gitRemotesPickerTemplate","$selectedRemote","$remotesDropdown","$gitPanel","$gitPush","initVariables","$","find","getDefaultRemote","allRemotes","defaultRemotes","candidate","get","exists","remote","name","length","first","setDefaultRemote","remoteName","set","clearRemotePicker","html","data","selectRemote","type","prop","attr","text","refreshRemotesPicker","getRemotes","then","remotes","defaultRemoteName","forEach","deletable","compiledTemplate","render","emit","REMOTES_REFRESH_PICKER","catch","err","showError","ERROR_GETTING_REMOTES","handleRemoteCreation","askQuestion","CREATE_NEW_REMOTE","ENTER_REMOTE_NAME","ENTER_REMOTE_URL","url","createRemote","equals","USER_ABORTED","ERROR_REMOTE_CREATION","deleteRemote","DELETE_REMOTE","format","DELETE_REMOTE_NAME","booleanResponse","response","logError","showPushResult","result","remoteUrl","encodeSensitiveInformation","template","join","showModalDialog","DIALOG_ID_INFO","GIT_PUSH_RESPONSE","pushToRemote","ERROR_NO_REMOTE_SELECTED","pushConfig","show","q","Promise","resolve","additionalArgs","tags","push","noVerify","branch","setBranchAsTracking","setUpstreamBranch","remoteUrlNew","setRemoteUrl","op","progressTracker","newProgressTracker","pushToNew","pushToNewUpstream","strategy","pushForced","deleteRemoteBranch","waitForClose","countEvent","EVENT_TYPE","GIT","ERROR_PUSHING_REMOTE","errorMetric","remoteUrlRestore","finally","REFRESH_ALL","ERROR_PUSHING_OPERATION","pullFromRemote","pullConfig","fetchRemote","mergeRemote","rebaseRemote","resetRemote","showOutput","GIT_PULL_SUCCESS","GIT_PULL_RESPONSE","ERROR_PULLING_REMOTE","ERROR_PULLING_OPERATION","handleFetch","FETCH_STARTED","tracker","fetchAllRemotes","undefined","FETCH_COMPLETE","on","GIT_ENABLED","HANDLE_REMOTE_PICK","event","$remote","target","closest","REFRESH_COUNTERS","HANDLE_REMOTE_CREATE","HANDLE_REMOTE_DELETE","HANDLE_PULL","HANDLE_PUSH","HANDLE_FETCH"],"mappings":"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","sourcesContent":["define(function (require) {\n\n    // Brackets modules\n    var _               = brackets.getModule(\"thirdparty/lodash\"),\n        DefaultDialogs  = brackets.getModule(\"widgets/DefaultDialogs\"),\n        Dialogs         = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache        = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics         = brackets.getModule(\"utils/Metrics\"),\n        Strings         = brackets.getModule(\"strings\"),\n        StringUtils     = brackets.getModule(\"utils/StringUtils\");\n\n    // Local modules\n    var ErrorHandler    = require(\"src/ErrorHandler\"),\n        Events          = require(\"src/Events\"),\n        EventEmitter    = require(\"src/EventEmitter\"),\n        Git             = require(\"src/git/Git\"),\n        Preferences     = require(\"src/Preferences\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\"),\n        PullDialog      = require(\"src/dialogs/Pull\"),\n        PushDialog      = require(\"src/dialogs/Push\"),\n        Utils           = require(\"src/Utils\");\n\n    // Templates\n    var gitRemotesPickerTemplate = require(\"text!templates/git-remotes-picker.html\");\n\n    // Module variables\n    var $selectedRemote  = null,\n        $remotesDropdown = null,\n        $gitPanel = null,\n        $gitPush = null;\n\n    function initVariables() {\n        $gitPanel = $(\"#git-panel\");\n        $selectedRemote = $gitPanel.find(\".git-selected-remote\");\n        $remotesDropdown = $gitPanel.find(\".git-remotes-dropdown\");\n        $gitPush = $gitPanel.find(\".git-push\");\n    }\n\n    // Implementation\n\n    function getDefaultRemote(allRemotes) {\n        var defaultRemotes = Preferences.get(\"defaultRemotes\") || {},\n            candidate = defaultRemotes[Preferences.get(\"currentGitRoot\")];\n\n        var exists = _.find(allRemotes, function (remote) {\n            return remote.name === candidate;\n        });\n        if (!exists) {\n            candidate = null;\n            if (allRemotes.length > 0) {\n                candidate = _.first(allRemotes).name;\n            }\n        }\n\n        return candidate;\n    }\n\n    function setDefaultRemote(remoteName) {\n        var defaultRemotes = Preferences.get(\"defaultRemotes\") || {};\n        defaultRemotes[Preferences.get(\"currentGitRoot\")] = remoteName;\n        Preferences.set(\"defaultRemotes\", defaultRemotes);\n    }\n\n    function clearRemotePicker() {\n        $selectedRemote\n            .html(\"&mdash;\")\n            .data(\"remote\", null);\n    }\n\n    function selectRemote(remoteName, type) {\n        if (!remoteName) {\n            return clearRemotePicker();\n        }\n\n        // Set as default remote only if is a normal git remote\n        if (type === \"git\") { setDefaultRemote(remoteName); }\n\n        // Disable pull if it is not a normal git remote\n        $gitPanel.find(\".git-pull\").prop(\"disabled\", type !== \"git\");\n\n        // Enable push and set selected-remote-type to Git push button by type of remote\n        $gitPush\n            .prop(\"disabled\", false)\n            .attr(\"x-selected-remote-type\", type);\n\n        // Update remote name of $selectedRemote\n        $selectedRemote\n            .text(remoteName)\n            .attr(\"data-type\", type) // use attr to apply CSS styles\n            .data(\"remote\", remoteName);\n    }\n\n    function refreshRemotesPicker() {\n        Git.getRemotes().then(function (remotes) {\n            // Set default remote name and cache the remotes dropdown menu\n            var defaultRemoteName = getDefaultRemote(remotes);\n\n            // Disable Git-push and Git-pull if there are not remotes defined\n            $gitPanel\n                .find(\".git-pull, .git-push, .git-fetch\")\n                .prop(\"disabled\", remotes.length === 0);\n\n            // Add options to change remote\n            remotes.forEach(function (remote) {\n                remote.deletable = remote.name !== \"origin\";\n            });\n\n            // Pass to Mustache the needed data\n            var compiledTemplate = Mustache.render(gitRemotesPickerTemplate, {\n                Strings: Strings,\n                remotes: remotes\n            });\n\n            // Inject the rendered template inside the $remotesDropdown\n            $remotesDropdown.html(compiledTemplate);\n\n            // Notify others that they may add more stuff to this dropdown\n            EventEmitter.emit(Events.REMOTES_REFRESH_PICKER);\n            // TODO: is it possible to wait for listeners to finish?\n\n            // TODO: if there're no remotes but there are some ftp remotes\n            // we need to adjust that something other may be put as default\n            // low priority\n            if (remotes.length > 0) {\n                selectRemote(defaultRemoteName, \"git\");\n            } else {\n                clearRemotePicker();\n            }\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GETTING_REMOTES);\n        });\n    }\n\n    function handleRemoteCreation() {\n        return Utils.askQuestion(Strings.CREATE_NEW_REMOTE, Strings.ENTER_REMOTE_NAME)\n            .then(function (name) {\n                return Utils.askQuestion(Strings.CREATE_NEW_REMOTE, Strings.ENTER_REMOTE_URL).then(function (url) {\n                    return [name, url];\n                });\n            })\n            .then(function ([name, url]) {\n                return Git.createRemote(name, url).then(function () {\n                    return refreshRemotesPicker();\n                });\n            })\n            .catch(function (err) {\n                if (!ErrorHandler.equals(err, Strings.USER_ABORTED)) {\n                    ErrorHandler.showError(err, Strings.ERROR_REMOTE_CREATION);\n                }\n            });\n    }\n\n    function deleteRemote(remoteName) {\n        return Utils.askQuestion(Strings.DELETE_REMOTE, StringUtils.format(Strings.DELETE_REMOTE_NAME, remoteName), { booleanResponse: true })\n            .then(function (response) {\n                if (response === true) {\n                    return Git.deleteRemote(remoteName).then(function () {\n                        return refreshRemotesPicker();\n                    });\n                }\n            })\n            .catch(function (err) {\n                ErrorHandler.logError(err);\n            });\n    }\n\n    function showPushResult(result) {\n        if (typeof result.remoteUrl === \"string\") {\n            result.remoteUrl = Utils.encodeSensitiveInformation(result.remoteUrl);\n        }\n\n        var template = [\n            \"<h3>{{flagDescription}}</h3>\",\n            \"Info:\",\n            \"Remote url - {{remoteUrl}}\",\n            \"Local branch - {{from}}\",\n            \"Remote branch - {{to}}\",\n            \"Summary - {{summary}}\",\n            \"<h4>Status - {{status}}</h4>\"\n        ].join(\"<br>\");\n\n        Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_INFO,\n            Strings.GIT_PUSH_RESPONSE, // title\n            Mustache.render(template, result) // message\n        );\n    }\n\n    function pushToRemote(remote) {\n        if (!remote) {\n            return ErrorHandler.showError(StringUtils.format(Strings.ERROR_NO_REMOTE_SELECTED, \"push\"));\n        }\n\n        var pushConfig = {\n            remote: remote\n        };\n\n        PushDialog.show(pushConfig)\n            .then(function (pushConfig) {\n                var q = Promise.resolve(),\n                    additionalArgs = [];\n\n                if (pushConfig.tags) {\n                    additionalArgs.push(\"--tags\");\n                }\n                if (pushConfig.noVerify) {\n                    additionalArgs.push(\"--no-verify\");\n                }\n\n                // set a new tracking branch if desired\n                if (pushConfig.branch && pushConfig.setBranchAsTracking) {\n                    q = q.then(function () {\n                        return Git.setUpstreamBranch(pushConfig.remote, pushConfig.branch);\n                    });\n                }\n                // put username and password into remote url\n                if (pushConfig.remoteUrlNew) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(pushConfig.remote, pushConfig.remoteUrlNew);\n                    });\n                }\n                // do the pull itself (we are not using pull command)\n                q = q.then(function () {\n                    let op;\n                    const progressTracker = ProgressDialog.newProgressTracker();\n                    if (pushConfig.pushToNew) {\n                        op = Git.pushToNewUpstream(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    } else if (pushConfig.strategy === \"DEFAULT\") {\n                        op = Git.push(pushConfig.remote, pushConfig.branch, additionalArgs, progressTracker);\n                    } else if (pushConfig.strategy === \"FORCED\") {\n                        op = Git.pushForced(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    } else if (pushConfig.strategy === \"DELETE_BRANCH\") {\n                        op = Git.deleteRemoteBranch(pushConfig.remote, pushConfig.branch, {\n                            noVerify: true, progressTracker});\n                    }\n                    return ProgressDialog.show(op, progressTracker)\n                        .then(function (result) {\n                            return ProgressDialog.waitForClose().then(function () {\n                                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'push', \"success\");\n                                showPushResult(result);\n                            });\n                        })\n                        .catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'push', \"fail\");\n                            ErrorHandler.showError(err, Strings.ERROR_PUSHING_REMOTE, {errorMetric: \"push\"});\n                        });\n                });\n                // restore original url if desired\n                if (pushConfig.remoteUrlRestore) {\n                    q = q.finally(function () {\n                        return Git.setRemoteUrl(pushConfig.remote, pushConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            })\n            .catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.ERROR_PUSHING_OPERATION); }\n            });\n    }\n\n    function pullFromRemote(remote) {\n        if (!remote) {\n            return ErrorHandler.showError(StringUtils.format(Strings.ERROR_NO_REMOTE_SELECTED, \"pull\"));\n        }\n\n        var pullConfig = {\n            remote: remote\n        };\n\n        PullDialog.show(pullConfig)\n            .then(function (pullConfig) {\n                var q = Promise.resolve();\n\n                // set a new tracking branch if desired\n                if (pullConfig.branch && pullConfig.setBranchAsTracking) {\n                    q = q.then(function () {\n                        return Git.setUpstreamBranch(pullConfig.remote, pullConfig.branch);\n                    });\n                }\n                // put username and password into remote url\n                if (pullConfig.remoteUrlNew) {\n                    q = q.then(function () {\n                        return Git.setRemoteUrl(pullConfig.remote, pullConfig.remoteUrlNew);\n                    });\n                }\n                // do the pull itself (we are not using pull command)\n                q = q.then(function () {\n                    // fetch the remote first\n                    const progressTracker = ProgressDialog.newProgressTracker();\n                    return ProgressDialog.show(Git.fetchRemote(pullConfig.remote, progressTracker), progressTracker)\n                        .then(function () {\n                            if (pullConfig.strategy === \"DEFAULT\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    false, false, {progressTracker});\n                            } else if (pullConfig.strategy === \"AVOID_MERGING\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    true, false, {progressTracker});\n                            } else if (pullConfig.strategy === \"MERGE_NOCOMMIT\") {\n                                return Git.mergeRemote(pullConfig.remote, pullConfig.branch,\n                                    false, true, {progressTracker});\n                            } else if (pullConfig.strategy === \"REBASE\") {\n                                return Git.rebaseRemote(pullConfig.remote, pullConfig.branch, progressTracker);\n                            } else if (pullConfig.strategy === \"RESET\") {\n                                return Git.resetRemote(pullConfig.remote, pullConfig.branch, progressTracker);\n                            }\n                        })\n                        .then(function (result) {\n                            return ProgressDialog.waitForClose().then(function () {\n                                // Git writes status messages (including informational messages) to stderr,\n                                // even when the command succeeds. For example, during `git pull --rebase`,\n                                // the \"Successfully rebased and updated\" message is sent to stderr,\n                                // leaving the result as empty in stdout.\n                                // If we reach this point, the command has succeeded,\n                                // so we display a success message if `result` is \"\".\n                                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'pull', \"success\");\n                                return Utils.showOutput(result || Strings.GIT_PULL_SUCCESS,\n                                    Strings.GIT_PULL_RESPONSE);\n                            });\n                        })\n                        .catch(function (err) {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'pull', \"fail\");\n                            ErrorHandler.showError(err, Strings.ERROR_PULLING_REMOTE, {errorMetric: \"pull\"});\n                        });\n                });\n                // restore original url if desired\n                if (pullConfig.remoteUrlRestore) {\n                    q = q.finally(function () {\n                        return Git.setRemoteUrl(pullConfig.remote, pullConfig.remoteUrlRestore);\n                    });\n                }\n\n                return q.finally(function () {\n                    EventEmitter.emit(Events.REFRESH_ALL);\n                });\n            })\n            .catch(function (err) {\n                // when dialog is cancelled, there's no error\n                if (err) { ErrorHandler.showError(err, Strings.ERROR_PULLING_OPERATION); }\n            });\n    }\n\n    function handleFetch() {\n\n        // Tell the rest of the plugin that the fetch has started\n        EventEmitter.emit(Events.FETCH_STARTED);\n\n        const tracker = ProgressDialog.newProgressTracker();\n        return ProgressDialog.show(Git.fetchAllRemotes(tracker), tracker)\n            .then(()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'fetch', \"success\");\n            })\n            .catch(function (err) {\n                Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'fetch', \"fail\");\n                ErrorHandler.showError(err, undefined, {errorMetric: \"fetch\"});\n            })\n            .then(ProgressDialog.waitForClose)\n            .finally(function () {\n                EventEmitter.emit(Events.FETCH_COMPLETE);\n            });\n    }\n\n    // Event subscriptions\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        initVariables();\n        refreshRemotesPicker();\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_PICK, function (event) {\n        var $remote     = $(event.target).closest(\".remote-name\"),\n            remoteName  = $remote.data(\"remote-name\"),\n            type        = $remote.data(\"type\");\n        selectRemote(remoteName, type);\n        EventEmitter.emit(Events.REFRESH_COUNTERS);\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_CREATE, function () {\n        handleRemoteCreation();\n    });\n    EventEmitter.on(Events.HANDLE_REMOTE_DELETE, function (event) {\n        var remoteName = $(event.target).closest(\".remote-name\").data(\"remote-name\");\n        deleteRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_PULL, function () {\n        var remoteName = $selectedRemote.data(\"remote\");\n        pullFromRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_PUSH, function () {\n        var remoteName = $selectedRemote.data(\"remote\");\n        pushToRemote(remoteName);\n    });\n    EventEmitter.on(Events.HANDLE_FETCH, function () {\n        handleFetch();\n    });\n\n});\n"],"file":"Remotes.js"}