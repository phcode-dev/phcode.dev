{"version":3,"sources":["extensions/default/Git/src/ErrorHandler.js"],"names":["define","require","exports","Dialogs","brackets","getModule","Mustache","Metrics","Strings","Utils","errorDialogTemplate","errorToString","err","encodeSensitiveInformation","toString","isTimeout","Error","message","indexOf","equals","what","toLowerCase","contains","matches","regExp","match","logError","msg","stack","consoleError","showError","title","options","dontStripError","errorMetric","countEvent","EVENT_TYPE","GIT","__shown","errorBody","errorStack","JSON","stringify","e","compiledTemplate","render","body","window","debugMode","showModalDialogUsingTemplate","toError","arg","apply","arguments"],"mappings":"AAAAA,OAAO,SAAUC,QAASC,SAEtB,MAAMC,QAA6BC,SAASC,UAAU,mBAClDC,SAA6BF,SAASC,UAAU,gCAChDE,QAA6BH,SAASC,UAAU,iBAChDG,QAA6BJ,SAASC,UAAU,WAChDI,MAA6BR,QAAQ,aACrCS,oBAA6BT,QAAQ,wCAEzC,SAASU,cAAcC,KACnB,OAAOH,MAAMI,2BAA2BD,IAAIE,YAGhDZ,QAAQa,UAAY,SAAUH,KAC1B,OAAOA,eAAeI,QAC6B,IAA/CJ,IAAIK,QAAQC,QAAQ,wBACyB,IAA7CN,IAAIK,QAAQC,QAAQ,uBAI5BhB,QAAQiB,OAAS,SAAUP,IAAKQ,MAC5B,OAAOR,IAAIE,WAAWO,gBAAkBD,KAAKC,eAGjDnB,QAAQoB,SAAW,SAAUV,IAAKQ,MAC9B,OAAqE,IAA9DR,IAAIE,WAAWO,cAAcH,QAAQE,KAAKC,gBAGrDnB,QAAQqB,QAAU,SAAUX,IAAKY,QAC7B,OAAOZ,IAAIE,WAAWW,MAAMD,SAGhCtB,QAAQwB,SAAW,SAAUd,KACzB,MAAMe,IAAMf,KAAOA,IAAIgB,MAAQhB,IAAIgB,MAAQhB,IAE3C,OADAH,MAAMoB,aAAa,kBAAoBF,KAChCf,KASXV,QAAQ4B,UAAY,SAAUlB,IAAKmB,MAAOC,QAAU,IAChD,MAAMC,eAAiBD,QAAQC,eACzBC,YAAcF,QAAQE,YAE5B,GADA3B,QAAQ4B,WAAW5B,QAAQ6B,WAAWC,IAAK,YAAaH,aAAe,QACnEtB,IAAI0B,QAAW,OAAO1B,IAI1B,IAAI2B,UACAC,WASJ,GAZAtC,QAAQwB,SAASd,KAKE,iBAARA,IACP2B,UAAY3B,IACLA,eAAeI,QACtBuB,UAAYN,eAAiBrB,IAAIE,WAAaH,cAAcC,KAC5D4B,WAAa5B,IAAIgB,OAAS,KAGzBW,WAA2B,oBAAdA,UACd,IACIA,UAAYE,KAAKC,UAAU9B,IAAK,KAAM,GACxC,MAAO+B,GACLJ,UAAY,+CAIpB,IAAIK,iBAAmBtC,SAASuC,OAAOnC,oBAAqB,CACxDqB,MAAOA,MACPe,KAAMC,OAAOC,aAAeT,cAAcC,aAAeD,UACzD/B,QAASA,UAMb,OAHAL,QAAQ8C,6BAA6BL,kBAClB,iBAARhC,MAAoBA,IAAM,IAAII,MAAMJ,MAC/CA,IAAI0B,SAAU,EACP1B,KAGXV,QAAQgD,QAAU,SAAUC,KAExB,GAAIA,eAAenC,MAAS,OAAOmC,IACnC,IAAIvC,IAAM,IAAII,MAAMmC,KAKpB,OAHAvC,IAAIa,MAAQ,WACR,OAAO0B,IAAI1B,MAAM2B,MAAMD,IAAKE,YAEzBzC","sourcesContent":["define(function (require, exports) {\n\n    const Dialogs                    = brackets.getModule(\"widgets/Dialogs\"),\n        Mustache                   = brackets.getModule(\"thirdparty/mustache/mustache\"),\n        Metrics                    = brackets.getModule(\"utils/Metrics\"),\n        Strings                    = brackets.getModule(\"strings\"),\n        Utils                      = require(\"src/Utils\"),\n        errorDialogTemplate        = require(\"text!templates/git-error-dialog.html\");\n\n    function errorToString(err) {\n        return Utils.encodeSensitiveInformation(err.toString());\n    }\n\n    exports.isTimeout = function (err) {\n        return err instanceof Error && (\n            err.message.indexOf(\"cmd-execute-timeout\") === 0 ||\n            err.message.indexOf(\"cmd-spawn-timeout\") === 0\n        );\n    };\n\n    exports.equals = function (err, what) {\n        return err.toString().toLowerCase() === what.toLowerCase();\n    };\n\n    exports.contains = function (err, what) {\n        return err.toString().toLowerCase().indexOf(what.toLowerCase()) !== -1;\n    };\n\n    exports.matches = function (err, regExp) {\n        return err.toString().match(regExp);\n    };\n\n    exports.logError = function (err) {\n        const msg = err && err.stack ? err.stack : err;\n        Utils.consoleError(\"[brackets-git] \" + msg);\n        return err;\n    };\n\n    /**\n     *\n     * @param err\n     * @param title\n     * @param {dontStripError: boolean, errorMetric: string} options\n     */\n    exports.showError = function (err, title, options = {}) {\n        const dontStripError = options.dontStripError;\n        const errorMetric = options.errorMetric;\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'dialogErr', errorMetric || \"Show\");\n        if (err.__shown) { return err; }\n\n        exports.logError(err);\n\n        let errorBody,\n            errorStack;\n\n        if (typeof err === \"string\") {\n            errorBody = err;\n        } else if (err instanceof Error) {\n            errorBody = dontStripError ? err.toString() : errorToString(err);\n            errorStack = err.stack || \"\";\n        }\n\n        if (!errorBody || errorBody === \"[object Object]\") {\n            try {\n                errorBody = JSON.stringify(err, null, 4);\n            } catch (e) {\n                errorBody = \"Error can't be stringified by JSON.stringify\";\n            }\n        }\n\n        var compiledTemplate = Mustache.render(errorDialogTemplate, {\n            title: title,\n            body: window.debugMode ? `${errorBody}\\n${errorStack}` : errorBody,\n            Strings: Strings\n        });\n\n        Dialogs.showModalDialogUsingTemplate(compiledTemplate);\n        if (typeof err === \"string\") { err = new Error(err); }\n        err.__shown = true;\n        return err;\n    };\n\n    exports.toError = function (arg) {\n        // FUTURE: use this everywhere and have a custom error class for this extension\n        if (arg instanceof Error) { return arg; }\n        var err = new Error(arg);\n        // TODO: new class for this?\n        err.match = function () {\n            return arg.match.apply(arg, arguments);\n        };\n        return err;\n    };\n\n});\n"],"file":"ErrorHandler.js"}