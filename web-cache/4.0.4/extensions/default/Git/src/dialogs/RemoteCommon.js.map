{"version":3,"sources":["extensions/default/Git/src/dialogs/RemoteCommon.js"],"names":["define","require","exports","_","brackets","getModule","Strings","Mustache","ErrorHandler","Git","ProgressDialog","fillBranches","config","$dialog","getAllBranches","then","branches","filter","branch","remote","template","html","render","find","catch","err","showError","ERROR_BRANCH_LIST","collectInfo","getCurrentUpstreamBranch","upstreamBranch","currentTrackingBranch","getRemoteUrl","remoteUrl","match","url","URL","remoteUsername","username","remotePassword","password","_usernamePasswordDisabled","getCurrentBranchName","currentBranchName","ERROR_FETCH_REMOTE","attachCommonEvents","handleRadioChange","val","toggle","on","trackingBranchRemote","substring","indexOf","pull","prop","trigger","tracker","newProgressTracker","show","fetchRemote","collectValues","action","remoteUrlNew","length","pushToNew","setBranchAsTracking","is","strategy","tags","noVerify","toString","saveToUrl","remoteUrlRestore"],"mappings":"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","sourcesContent":["define(function (require, exports) {\n\n    // Brackets modules\n    const _ = brackets.getModule(\"thirdparty/lodash\"),\n        Strings = brackets.getModule(\"strings\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const ErrorHandler    = require(\"src/ErrorHandler\"),\n        Git             = require(\"src/git/Git\"),\n        ProgressDialog  = require(\"src/dialogs/Progress\");\n\n    // Implementation\n\n    function fillBranches(config, $dialog) {\n        Git.getAllBranches().then(function (branches) {\n            // filter only branches for this remote\n            branches = _.filter(branches, function (branch) {\n                return branch.remote === config.remote;\n            });\n\n            const template = \"{{#branches}}<option value='{{name}}' remote='{{remote}}' \" +\n                \"{{#currentBranch}}selected{{/currentBranch}}>{{name}}</option>{{/branches}}\";\n            const html = Mustache.render(template, { branches: branches });\n            $dialog.find(\".branchSelect\").html(html);\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_BRANCH_LIST);\n        });\n    }\n\n    // this should never reject for now, just show error message and bail out\n    exports.collectInfo = function (config) {\n        return Git.getCurrentUpstreamBranch().then(function (upstreamBranch) {\n            config.currentTrackingBranch = upstreamBranch;\n\n            return Git.getRemoteUrl(config.remote).then(function (remoteUrl) {\n                config.remoteUrl = remoteUrl;\n\n                if (remoteUrl.match(/^https?:/)) {\n                    const url = new URL(remoteUrl);\n                    config.remoteUsername = url.username;\n                    config.remotePassword = url.password;\n                } else {\n                    // disable the inputs\n                    config._usernamePasswordDisabled = true;\n                }\n\n                if (!upstreamBranch) {\n                    return Git.getCurrentBranchName().then(function (currentBranchName) {\n                        config.currentBranchName = currentBranchName;\n                    });\n                }\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE);\n        });\n    };\n\n    exports.attachCommonEvents = function (config, $dialog) {\n        const handleRadioChange = function () {\n            const val = $dialog.find(\"input[name='action']:checked\").val();\n            $dialog.find(\".only-from-selected\").toggle(val === \"PULL_FROM_SELECTED\" || val === \"PUSH_TO_SELECTED\");\n        };\n        $dialog.on(\"change\", \"input[name='action']\", handleRadioChange);\n        handleRadioChange();\n\n        let trackingBranchRemote = null;\n        if (config.currentTrackingBranch) {\n            trackingBranchRemote = config.currentTrackingBranch.substring(0, config.currentTrackingBranch.indexOf(\"/\"));\n        }\n\n        // if we're pulling from another remote than current tracking remote\n        if (config.currentTrackingBranch && trackingBranchRemote !== config.remote) {\n            if (config.pull) {\n                $dialog.find(\"input[value='PULL_FROM_CURRENT']\").prop(\"disabled\", true);\n                $dialog.find(\"input[value='PULL_FROM_SELECTED']\").prop(\"checked\", true).trigger(\"change\");\n            } else {\n                $dialog.find(\"input[value='PUSH_TO_CURRENT']\").prop(\"disabled\", true);\n                $dialog.find(\"input[value='PUSH_TO_SELECTED']\").prop(\"checked\", true).trigger(\"change\");\n            }\n        }\n\n        $dialog.on(\"click\", \".fetchBranches\", function () {\n            const tracker = ProgressDialog.newProgressTracker();\n            ProgressDialog.show(Git.fetchRemote(config.remote, tracker), tracker)\n                .then(function () {\n                    fillBranches(config, $dialog);\n                }).catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_FETCH_REMOTE);\n                });\n        });\n        fillBranches(config, $dialog);\n\n        if (config._usernamePasswordDisabled) {\n            $dialog.find(\"input[name='username'],input[name='password'],input[name='saveToUrl']\").prop(\"disabled\", true);\n        }\n    };\n\n    exports.collectValues = function (config, $dialog) {\n        const action = $dialog.find(\"input[name='action']:checked\").val();\n        if (action === \"PULL_FROM_CURRENT\" || action === \"PUSH_TO_CURRENT\") {\n\n            if (config.currentTrackingBranch) {\n                config.branch = config.currentTrackingBranch.substring(config.remote.length + 1);\n            } else {\n                config.branch = config.currentBranchName;\n                config.pushToNew = true;\n            }\n\n        } else if (action === \"PULL_FROM_SELECTED\" || action === \"PUSH_TO_SELECTED\") {\n            config.branch = $dialog.find(\".branchSelect\").val().substring(config.remote.length + 1);\n            config.setBranchAsTracking = $dialog.find(\"input[name='setBranchAsTracking']\").is(\":checked\");\n        }\n\n        config.strategy = $dialog.find(\"input[name='strategy']:checked\").val();\n        config.tags = $dialog.find(\"input[name='send_tags']:checked\").val();\n        config.noVerify = $dialog.find(\"input[name='push-no-verify']:checked\").val();\n\n        config.remoteUsername = $dialog.find(\"input[name='username']\").val();\n        config.remotePassword = $dialog.find(\"input[name='password']\").val();\n\n        // new url that has to be set for merging\n        let remoteUrlNew;\n        if (config.remoteUrl.match(/^https?:/)) {\n            const url = new URL(config.remoteUrl);\n            url.username = config.remoteUsername;\n            url.password = config.remotePassword;\n            remoteUrlNew = url.toString();\n        }\n\n        // assign remoteUrlNew only if it's different from the original url\n        if (remoteUrlNew && config.remoteUrl !== remoteUrlNew) {\n            config.remoteUrlNew = remoteUrlNew;\n        }\n\n        // old url that has to be put back after merging\n        const saveToUrl = $dialog.find(\"input[name='saveToUrl']\").is(\":checked\");\n        // assign restore branch only if remoteUrlNew has some value\n        if (config.remoteUrlNew && !saveToUrl) {\n            config.remoteUrlRestore = config.remoteUrl;\n        }\n    };\n\n});\n"],"file":"RemoteCommon.js"}