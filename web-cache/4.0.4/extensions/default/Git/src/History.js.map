{"version":3,"sources":["extensions/default/Git/src/History.js"],"names":["define","require","_","brackets","getModule","DocumentManager","FileUtils","LocalizationUtils","Strings","Metrics","Mustache","ErrorHandler","Events","EventEmitter","Git","HistoryViewer","Preferences","gitPanelHistoryTemplate","gitPanelHistoryCommitsTemplate","$gitPanel","$","$tableContainer","$historyList","commitCache","lastDocumentSeen","initVariables","find","attachHandlers","off","on","loadMoreHistory","$tr","this","hash","attr","commit","historyShown","toggle","getCurrentDocument","isInitial","parent","removeClass","addClass","generateCssAvatar","memoize","author","email","seededRandom","max","min","seed","rnd","seedBase","parseInt","charCodeAt","toString","length","substring","colors","texts","picked","Math","floor","renderHistory","file","getCurrentBranchName","then","branchName","p","getFileHistory","relative","getHistory","commits","addAdditionalCommitInfo","concat","templateData","append","render","data","absolute","catch","err","showError","ERROR_GET_HISTORY","is","prop","scrollTop","height","skipCount","commitsHtml","children","ERROR_GET_MORE_HISTORY","ERROR_GET_CURRENT_BRANCH","forEach","cssAvatar","avatarLetter","dateTime","Date","date","isNaN","getTime","title","shown","getFormattedDateTime","dateTimeFromNowFriendly","hasTag","tags","isVisible","doc","handleFileChange","currentDocument","handleToggleHistory","newHistoryMode","newDocument","historyEnabled","currentFile","currentHistoryMode","savedScrollTop","savedScrollLeft","selectedCommitHash","isRefresh","scrollLeft","fullPath","getRelativeFilename","get","isEmpty","fileChanged","remove","$spinner","appendTo","finally","$newHistoryList","status","hide","globalButtonActive","fileButtonActive","toggleClass","TOOLTIP_HIDE_HISTORY","TOOLTIP_SHOW_HISTORY","TOOLTIP_HIDE_FILE_HISTORY","TOOLTIP_SHOW_FILE_HISTORY","GIT_ENABLED","GIT_DISABLED","HISTORY_SHOW_FILE","countEvent","EVENT_TYPE","GIT","HISTORY_SHOW_GLOBAL","REFRESH_HISTORY","BRACKETS_CURRENT_DOCUMENT_CHANGE"],"mappings":"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","sourcesContent":["define(function (require) {\n\n    // Brackets modules\n    var _ = brackets.getModule(\"thirdparty/lodash\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileUtils = brackets.getModule(\"file/FileUtils\"),\n        LocalizationUtils = brackets.getModule(\"utils/LocalizationUtils\"),\n        Strings = brackets.getModule(\"strings\"),\n        Metrics = brackets.getModule(\"utils/Metrics\"),\n        Mustache = brackets.getModule(\"thirdparty/mustache/mustache\");\n\n    // Local modules\n    const ErrorHandler = require(\"src/ErrorHandler\"),\n        Events = require(\"src/Events\"),\n        EventEmitter = require(\"src/EventEmitter\"),\n        Git = require(\"src/git/Git\"),\n        HistoryViewer = require(\"src/HistoryViewer\"),\n        Preferences = require(\"src/Preferences\");\n\n    // Templates\n    var gitPanelHistoryTemplate = require(\"text!templates/git-panel-history.html\"),\n        gitPanelHistoryCommitsTemplate = require(\"text!templates/git-panel-history-commits.html\");\n\n    // Module variables\n    let $gitPanel         = $(null),\n        $tableContainer   = $(null),\n        $historyList      = $(null),\n        commitCache       = [],\n        lastDocumentSeen  = null;\n\n    // Implementation\n\n    function initVariables() {\n        $gitPanel = $(\"#git-panel\");\n        $tableContainer = $gitPanel.find(\".table-container\");\n        attachHandlers();\n    }\n\n    function attachHandlers() {\n        $tableContainer\n            .off(\".history\")\n            .on(\"scroll.history\", function () {\n                loadMoreHistory();\n            })\n            .on(\"click.history\", \".history-commit\", function () {\n                const $tr = $(this);\n                var hash = $tr.attr(\"x-hash\");\n                var commit = _.find(commitCache, function (commit) { return commit.hash === hash; });\n                const historyShown = HistoryViewer.toggle(commit, getCurrentDocument(), {\n                    isInitial: $(this).attr(\"x-initial-commit\") === \"true\"\n                });\n                $tr.parent().find(\"tr.selected\").removeClass(\"selected\");\n                if(historyShown){\n                    $tr.addClass(\"selected\");\n                }\n            });\n    }\n\n    var generateCssAvatar = _.memoize(function (author, email) {\n\n        // Original source: http://indiegamr.com/generate-repeatable-random-numbers-in-js/\n        var seededRandom = function (max, min, seed) {\n            max = max || 1;\n            min = min || 0;\n\n            seed = (seed * 9301 + 49297) % 233280;\n            var rnd = seed / 233280.0;\n\n            return min + rnd * (max - min);\n        };\n\n        // Use `seededRandom()` to generate a pseudo-random number [0-16] to pick a color from the list\n        var seedBase = parseInt(author.charCodeAt(3).toString(), email.length),\n            seed = parseInt(email.charCodeAt(seedBase.toString().substring(1, 2)).toString(), 16),\n            colors = [\n                \"#ffb13b\", \"#dd5f7a\", \"#8dd43a\", \"#2f7e2f\", \"#4141b9\", \"#3dafea\", \"#7e3e3e\", \"#f2f26b\",\n                \"#864ba3\", \"#ac8aef\", \"#f2f2ce\", \"#379d9d\", \"#ff6750\", \"#8691a2\", \"#d2fd8d\", \"#88eadf\"\n            ],\n            texts = [\n                \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#333333\",\n                \"#FEFEFE\", \"#FEFEFE\", \"#333333\", \"#FEFEFE\", \"#FEFEFE\", \"#FEFEFE\", \"#333333\", \"#333333\"\n            ],\n            picked = Math.floor(seededRandom(0, 16, seed));\n\n        return \"background-color: \" + colors[picked] + \"; color: \" + texts[picked];\n\n    }, function (author, email) {\n        // calculate hash for memoize - both are strings so we don't need to convert\n        return author + email;\n    });\n\n    // Render history list the first time\n    function renderHistory(file) {\n        // clear cache\n        commitCache = [];\n\n        return Git.getCurrentBranchName().then(function (branchName) {\n            // Get the history commits of the current branch\n            var p = file ? Git.getFileHistory(file.relative, branchName) : Git.getHistory(branchName);\n            return p.then(function (commits) {\n\n                // calculate some missing stuff like avatars\n                commits = addAdditionalCommitInfo(commits);\n                commitCache = commitCache.concat(commits);\n\n                var templateData = {\n                    commits: commits,\n                    Strings: Strings\n                };\n\n                $tableContainer.append(Mustache.render(gitPanelHistoryTemplate, templateData, {\n                    commits: gitPanelHistoryCommitsTemplate\n                }));\n\n                $historyList = $tableContainer.find(\"#git-history-list\")\n                    .data(\"file\", file ? file.absolute : null)\n                    .data(\"file-relative\", file ? file.relative : null);\n\n                $historyList\n                    .find(\"tr.history-commit:last-child\")\n                    .attr(\"x-initial-commit\", \"true\");\n            });\n        }).catch(function (err) {\n            ErrorHandler.showError(err, Strings.ERROR_GET_HISTORY);\n        });\n    }\n\n    // Load more rows in the history list on scroll\n    function loadMoreHistory() {\n        if ($historyList.is(\":visible\")) {\n            if (($tableContainer.prop(\"scrollHeight\") - $tableContainer.scrollTop()) === $tableContainer.height()) {\n                if ($historyList.attr(\"x-finished\") === \"true\") {\n                    return;\n                }\n                return Git.getCurrentBranchName().then(function (branchName) {\n                    var p,\n                        file = $historyList.data(\"file-relative\"),\n                        skipCount = $tableContainer.find(\"tr.history-commit\").length;\n                    if (file) {\n                        p = Git.getFileHistory(file, branchName, skipCount);\n                    } else {\n                        p = Git.getHistory(branchName, skipCount);\n                    }\n                    return p.then(function (commits) {\n                        if (commits.length === 0) {\n                            $historyList.attr(\"x-finished\", \"true\");\n                            // marks initial commit as first\n                            $historyList\n                                .find(\"tr.history-commit:last-child\")\n                                .attr(\"x-initial-commit\", \"true\");\n                            return;\n                        }\n\n                        commits = addAdditionalCommitInfo(commits);\n                        commitCache = commitCache.concat(commits);\n\n                        var templateData = {\n                            commits: commits,\n                            Strings: Strings\n                        };\n                        var commitsHtml = Mustache.render(gitPanelHistoryCommitsTemplate, templateData);\n                        $historyList.children(\"tbody\").append(commitsHtml);\n                    })\n                    .catch(function (err) {\n                        ErrorHandler.showError(err, Strings.ERROR_GET_MORE_HISTORY);\n                    });\n                })\n                .catch(function (err) {\n                    ErrorHandler.showError(err, Strings.ERROR_GET_CURRENT_BRANCH);\n                });\n            }\n        }\n    }\n\n    function addAdditionalCommitInfo(commits) {\n        _.forEach(commits, function (commit) {\n\n            commit.cssAvatar = generateCssAvatar(commit.author, commit.email);\n            commit.avatarLetter = commit.author.substring(0, 1);\n\n            const dateTime = new Date(commit.date);\n            if (isNaN(dateTime.getTime())) {\n                // we got invalid date, use the original date itself\n                commit.date = {\n                    title: commit.date,\n                    shown: commit.date\n                };\n            } else {\n                commit.date = {\n                    title: LocalizationUtils.getFormattedDateTime(dateTime),\n                    shown: LocalizationUtils.dateTimeFromNowFriendly(dateTime)\n                };\n            }\n            commit.hasTag = !!commit.tags;\n        });\n\n        return commits;\n    }\n\n    function getCurrentDocument() {\n        if (HistoryViewer.isVisible()) {\n            return lastDocumentSeen;\n        }\n        var doc = DocumentManager.getCurrentDocument();\n        if (doc) {\n            lastDocumentSeen = doc;\n        }\n        return doc || lastDocumentSeen;\n    }\n\n    function handleFileChange() {\n        var currentDocument = getCurrentDocument();\n\n        if ($historyList.is(\":visible\") && $historyList.data(\"file\")) {\n            handleToggleHistory(\"FILE\", currentDocument);\n        }\n        $gitPanel.find(\".git-file-history\").prop(\"disabled\", !currentDocument);\n    }\n\n    // Show or hide the history list on click of .history button\n    // newHistoryMode can be \"FILE\", \"GLOBAL\" or \"REFRESH\"\n    function handleToggleHistory(newHistoryMode, newDocument) {\n        // this is here to check that $historyList is still attached to the DOM\n        $historyList = $tableContainer.find(\"#git-history-list\");\n\n        let historyEnabled = $historyList.is(\":visible\"),\n            currentFile = $historyList.data(\"file\") || null,\n            currentHistoryMode = historyEnabled ? (currentFile ? \"FILE\" : \"GLOBAL\") : \"DISABLED\",\n            doc = newDocument ? newDocument : getCurrentDocument(),\n            file;\n\n        // Variables to store scroll positions (only used for REFRESH case)\n        let savedScrollTop, savedScrollLeft, selectedCommitHash;\n        let isRefresh = false;\n        if(newHistoryMode === \"REFRESH\"){\n            newHistoryMode = currentHistoryMode;\n            isRefresh = true;\n            historyEnabled = true;\n            // Save current scroll positions before removing the list\n            if ($historyList.length > 0) {\n                savedScrollTop = $historyList.parent().scrollTop();\n                savedScrollLeft = $historyList.parent().scrollLeft();\n                selectedCommitHash = $historyList.find(\".selected\").attr(\"x-hash\");\n            }\n        } else if (currentHistoryMode !== newHistoryMode) {\n            // we are switching the modes so enable\n            historyEnabled = true;\n        } else if (!newDocument) {\n            // we are not changing the mode and we are not switching to a new document\n            historyEnabled = !historyEnabled;\n        }\n\n        if (historyEnabled && newHistoryMode === \"FILE\") {\n            if (doc) {\n                file = {};\n                file.absolute = doc.file.fullPath;\n                file.relative = FileUtils.getRelativeFilename(Preferences.get(\"currentGitRoot\"), file.absolute);\n            } else {\n                // we want a file history but no file was found\n                historyEnabled = false;\n            }\n        }\n\n        // Render #git-history-list if is not already generated or if the viewed file for file history has changed\n        var isEmpty = $historyList.find(\"tr\").length === 0,\n            fileChanged = currentFile !== (file ? file.absolute : null);\n        if (historyEnabled && (isEmpty || fileChanged || isRefresh)) {\n            if ($historyList.length > 0) {\n                $historyList.remove();\n            }\n            var $spinner = $(\"<div class='spinner spin large'></div>\").appendTo($gitPanel);\n            renderHistory(file).finally(function () {\n                $spinner.remove();\n                if (isRefresh) {\n                    // After rendering, we need to fetch the newly created #git-history-list\n                    let $newHistoryList = $tableContainer.find(\"#git-history-list\");\n                    // Restore the scroll position\n                    $newHistoryList.parent().scrollTop(savedScrollTop || 0);\n                    $newHistoryList.parent().scrollLeft(savedScrollLeft || 0);\n                    $historyList.find(`[x-hash=\"${selectedCommitHash}\"]`).addClass(\"selected\");\n                }\n            });\n        }\n\n        // disable commit button when viewing history\n        // refresh status when history is closed and commit button will correct its disabled state if required\n        if (historyEnabled) {\n            $gitPanel.find(\".git-commit, .check-all\").prop(\"disabled\", true);\n        } else {\n            Git.status();\n        }\n\n        // Toggle visibility of .git-edited-list and #git-history-list\n        $tableContainer.find(\".git-edited-list\").toggle(!historyEnabled);\n        $historyList.toggle(historyEnabled);\n\n        if (!historyEnabled) { HistoryViewer.hide(); }\n\n        // Toggle history button\n        var globalButtonActive  = historyEnabled && newHistoryMode === \"GLOBAL\",\n            fileButtonActive    = historyEnabled && newHistoryMode === \"FILE\";\n        $gitPanel.find(\".git-history-toggle\").toggleClass(\"active\", globalButtonActive)\n            .attr(\"title\", globalButtonActive ? Strings.TOOLTIP_HIDE_HISTORY : Strings.TOOLTIP_SHOW_HISTORY);\n        $gitPanel.find(\".git-file-history\").toggleClass(\"active\", fileButtonActive)\n            .attr(\"title\", fileButtonActive ? Strings.TOOLTIP_HIDE_FILE_HISTORY : Strings.TOOLTIP_SHOW_FILE_HISTORY);\n    }\n\n    // Event listeners\n    EventEmitter.on(Events.GIT_ENABLED, function () {\n        initVariables();\n    });\n    EventEmitter.on(Events.GIT_DISABLED, function () {\n        lastDocumentSeen = null;\n        $historyList.remove();\n        $historyList = $();\n    });\n    EventEmitter.on(Events.HISTORY_SHOW_FILE, function () {\n        handleToggleHistory(\"FILE\");\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"fileHistory\");\n    });\n    EventEmitter.on(Events.HISTORY_SHOW_GLOBAL, function () {\n        handleToggleHistory(\"GLOBAL\");\n        Metrics.countEvent(Metrics.EVENT_TYPE.GIT, 'panel', \"history\");\n    });\n    EventEmitter.on(Events.REFRESH_HISTORY, function () {\n        handleToggleHistory(\"REFRESH\");\n    });\n    EventEmitter.on(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, function () {\n        handleFileChange();\n    });\n\n});\n"],"file":"History.js"}