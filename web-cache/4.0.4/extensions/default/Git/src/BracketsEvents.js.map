{"version":3,"sources":["extensions/default/Git/src/BracketsEvents.js"],"names":["define","require","exports","module","_","brackets","getModule","DocumentManager","FileSystem","ProjectManager","MainViewManager","Events","EventEmitter","HistoryViewer","Preferences","Utils","watchedInsideGit","GIT_EVENTS","disableAll","off","on","evt","file","currentGitRoot","get","fullPath","indexOf","whitelisted","any","entry","consoleDebug","emit","BRACKETS_FILE_CHANGED","doc","BRACKETS_DOCUMENT_SAVED","currentDocument","previousDocument","getCurrentDocument","isVisible","hide","BRACKETS_CURRENT_DOCUMENT_CHANGE","BRACKETS_PROJECT_CHANGE","BRACKETS_PROJECT_REFRESH","GIT_DISABLED"],"mappings":"AAAAA,OAAO,SAAUC,QAASC,QAASC,QAG/B,MAAMC,EAAkBC,SAASC,UAAU,qBACvCC,gBAAkBF,SAASC,UAAU,4BACrCE,WAAkBH,SAASC,UAAU,yBACrCG,eAAkBJ,SAASC,UAAU,0BACrCI,gBAAkBL,SAASC,UAAU,wBAGnCK,OAAgBV,QAAQ,cAC1BW,aAAgBX,QAAQ,oBACxBY,cAAgBZ,QAAQ,qBACxBa,YAAgBb,QAAQ,mBACxBc,MAAgBd,QAAQ,aAGtBe,iBAAmB,CAAC,QACpBC,WAAa,YAoDnB,SAASC,aACLV,WAAWW,cAAcF,cACzBV,gBAAgBY,qBAAqBF,cACrCP,gBAAgBS,yBAAyBF,cACzCR,eAAeU,mBAAmBF,cAClCR,eAAeU,sBAAsBF,cACrCR,eAAeU,0BAA0BF,cAxD7CT,WAAWY,aAAaH,aAAc,SAAUI,IAAKC,MAEjD,IAAIC,eAAiBT,YAAYU,IAAI,kBACrC,GAAIF,MAAkD,IAA1CA,KAAKG,SAASC,QAAQH,gBAAuB,CAIjD,IAAII,YAFR,GAAwD,IAApDL,KAAKG,SAASC,QAAQH,eAAiB,SAKvC,IAHkBnB,EAAEwB,IAAIZ,iBAAkB,SAAUa,OAChD,OAAOP,KAAKG,WAAaF,eAAiB,QAAUM,QAIpD,YADAd,MAAMe,aAAa,oCAAsCR,KAAKG,UAMtEb,aAAamB,KAAKpB,OAAOqB,sBAAuBV,SAIxDf,gBAAgBa,oBAAoBH,aAAc,SAAUI,IAAKY,KAEQ,IAAjEA,IAAIX,KAAKG,SAASC,QAAQZ,YAAYU,IAAI,oBAC1CZ,aAAamB,KAAKpB,OAAOuB,wBAAyBD,OAI1DvB,gBAAgBU,wBAAwBH,aAAc,SAAUI,IAAKc,gBAAiBC,kBAClFD,gBAAkBA,iBAAmB5B,gBAAgB8B,qBAChDxB,cAAcyB,YAGfzB,cAAc0B,OAFd3B,aAAamB,KAAKpB,OAAO6B,iCAAkCL,gBAAiBC,oBAMpF3B,eAAeW,kBAAkBH,aAAc,WAC3CL,aAAamB,KAAKpB,OAAO8B,2BAG7BhC,eAAeW,qBAAqBH,aAAc,WAC9CL,aAAamB,KAAKpB,OAAO+B,4BAG7BjC,eAAeW,yBAAyBH,aAAc,WAElDL,aAAamB,KAAKpB,OAAOgC,gBAY7BzC,QAAQgB,WAAaA","sourcesContent":["define(function (require, exports, module) {\n\n    // Brackets modules\n    const _               = brackets.getModule(\"thirdparty/lodash\"),\n        DocumentManager = brackets.getModule(\"document/DocumentManager\"),\n        FileSystem      = brackets.getModule(\"filesystem/FileSystem\"),\n        ProjectManager  = brackets.getModule(\"project/ProjectManager\"),\n        MainViewManager = brackets.getModule(\"view/MainViewManager\");\n\n    // Local modules\n    const Events        = require(\"src/Events\"),\n        EventEmitter  = require(\"src/EventEmitter\"),\n        HistoryViewer = require(\"src/HistoryViewer\"),\n        Preferences   = require(\"src/Preferences\"),\n        Utils         = require(\"src/Utils\");\n\n    // White-list for .git file watching\n    const watchedInsideGit = [\"HEAD\"];\n    const GIT_EVENTS = \"gitEvents\";\n\n    FileSystem.on(`change.${GIT_EVENTS}`, function (evt, file) {\n        // we care only for files in current project\n        var currentGitRoot = Preferences.get(\"currentGitRoot\");\n        if (file && file.fullPath.indexOf(currentGitRoot) === 0) {\n\n            if (file.fullPath.indexOf(currentGitRoot + \".git/\") === 0) {\n\n                var whitelisted = _.any(watchedInsideGit, function (entry) {\n                    return file.fullPath === currentGitRoot + \".git/\" + entry;\n                });\n                if (!whitelisted) {\n                    Utils.consoleDebug(\"Ignored FileSystem.change event: \" + file.fullPath);\n                    return;\n                }\n\n            }\n\n            EventEmitter.emit(Events.BRACKETS_FILE_CHANGED, file);\n        }\n    });\n\n    DocumentManager.on(`documentSaved.${GIT_EVENTS}`, function (evt, doc) {\n        // we care only for files in current project\n        if (doc.file.fullPath.indexOf(Preferences.get(\"currentGitRoot\")) === 0) {\n            EventEmitter.emit(Events.BRACKETS_DOCUMENT_SAVED, doc);\n        }\n    });\n\n    MainViewManager.on(`currentFileChange.${GIT_EVENTS}`, function (evt, currentDocument, previousDocument) {\n        currentDocument = currentDocument || DocumentManager.getCurrentDocument();\n        if (!HistoryViewer.isVisible()) {\n            EventEmitter.emit(Events.BRACKETS_CURRENT_DOCUMENT_CHANGE, currentDocument, previousDocument);\n        } else {\n            HistoryViewer.hide();\n        }\n    });\n\n    ProjectManager.on(`projectOpen.${GIT_EVENTS}`, function () {\n        EventEmitter.emit(Events.BRACKETS_PROJECT_CHANGE);\n    });\n\n    ProjectManager.on(`projectRefresh.${GIT_EVENTS}`, function () {\n        EventEmitter.emit(Events.BRACKETS_PROJECT_REFRESH);\n    });\n\n    ProjectManager.on(`beforeProjectClose.${GIT_EVENTS}`, function () {\n        // Disable Git when closing a project so listeners won't fire before new is opened\n        EventEmitter.emit(Events.GIT_DISABLED);\n    });\n\n    function disableAll() {\n        FileSystem.off(`change.${GIT_EVENTS}`);\n        DocumentManager.off(`documentSaved.${GIT_EVENTS}`);\n        MainViewManager.off(`currentFileChange.${GIT_EVENTS}`);\n        ProjectManager.off(`projectOpen.${GIT_EVENTS}`);\n        ProjectManager.off(`projectRefresh.${GIT_EVENTS}`);\n        ProjectManager.off(`beforeProjectClose.${GIT_EVENTS}`);\n    }\n\n    exports.disableAll = disableAll;\n});\n"],"file":"BracketsEvents.js"}