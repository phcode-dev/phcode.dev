{"version":3,"sources":["search/FindBar.js"],"names":["define","require","exports","module","_","Mustache","EventDispatcher","Commands","KeyBindingManager","KeyEvent","ModalBar","PreferencesManager","MainViewManager","Strings","ViewUtils","FindUtils","FileUtils","QuickSearchField","Metrics","_searchBarTemplate","intervalId","lastQueriedText","lastTypedText","lastTypedTextWasRegexp","lastClosedQuery","MAX_HISTORY_RESULTS","PREF_MAX_HISTORY","INSTANT_SEARCH_INTERVAL_MS","FindBar","options","defaults","multifile","replace","queryPlaceholder","initialQuery","initialReplaceText","scopeLabel","this","_options","extend","_closed","_enabled","_updateHistory","whichHistory","searchVal","searchHistory","getViewState","maxCount","get","searchQueryIndex","indexOf","splice","length","pop","unshift","setViewState","makeEventDispatcher","prototype","_addFindBar","findBar","_bars","push","_removeFindBar","pull","_closeFindBars","bars","forEach","bar","close","_modalBar","$","selector","getRoot","_updateSearchBarFromPrefs","toggleClass","_updatePrefsFromSearchBar","isRegexp","is","_addShortcutToTooltip","$elem","commandId","replaceShortcut","getKeyBindingsDisplay","oldTitle","attr","_addElementToSearchHistory","filterVal","open","self","metricType","countEvent","EVENT_TYPE","SEARCH","templateVars","clone","_handleKeydown","e","keyCode","DOM_VK_ESCAPE","stopPropagation","preventDefault","_keydownHookForCtrlSpace","event","ctrlSpaceEvent","ctrlKey","metaKey","DOM_VK_SPACE","showSearchHints","showFilterHints","replaceBatchLabel","BUTTON_REPLACE_ALL_IN_FILES","BUTTON_REPLACE_BATCH","replaceAllLabel","BUTTON_REPLACE_ALL","render","window","document","body","addEventListener","addGlobalKeydownHook","on","removeGlobalKeydownHook","removeEventListener","showError","clearInterval","focusActivePane","trigger","searchField","destroy","filterField","executeSearchIfNeeded","isInstantSearchDisabled","getQueryInfo","query","isWorkerSearchInProgress","setInterval","$root","historyIndex","queryInfo","currentTarget","focus","addClass","removeClass","setTimeout","DOM_VK_RETURN","shiftKey","val","target","focusReplace","DOM_VK_DOWN","DOM_VK_UP","DOM_VK_PAGE_DOWN","DOM_VK_PAGE_UP","CMD_FIND_NEXT","CMD_FIND_PREVIOUS","CMD_REPLACE","DOM_VK_TAB","altKey","id","isIndexingInProgress","showIndexingSpinner","focusQuery","_showHintsInternal","positionElement","inputElemId","stateVarName","fieldName","dontFilterHistory","_dontFilterHistory","inputField","verticalAdjust","offset","top","outerHeight","maxResults","firstHighlightIndex","$positionEl","resultProvider","asyncResult","Deferred","history","filter","historyItem","toLowerCase","includes","resolve","promise","formatter","item","$li","text","onCommit","selectedItem","itemIndex","setText","deletedItem","onDismiss","onDelete","deletedIndex","onHighlight","explicit","highlightZeroResults","focusLastActiveElementOnClose","suppressAnimation","replaceText","getReplaceText","isCaseSensitive","isClosed","getOptions","usePlatformLineEndings","$findWhat","findTextArea","lineEndings","sniffLineEndings","LINE_ENDINGS_LF","brackets","platform","isQueryTextSelected","selectionStart","selectionEnd","error","isHTML","isFilterError","$findError","$filterError","$error","hide","html","show","showFindCount","count","showNoResults","showIndicator","showMessage","$filterInput","$borderEl","noResultsMessage","FIND_NO_RESULTS","enable","prop","isEnabled","isReplaceEnabled","enableNavigation","enableReplace","_focus","select","setIndexingMessage","FIND_IN_FILES_INDEXING","message","hideIndexingSpinner","redoInstantSearch","_getInitialQueryFromSelection","editor","selectionText","getSelectedText","getInitialQuery","currentFindBar","selection","openedFindBar","find","currentQueryInfo","stateManager","definePreference","description","FIND_HISTORY_MAX_COUNT"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2014 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n// @INCLUDE_IN_API_DOCS\n\n/*\n * UI for the Find/Replace and Find in Files modal bar.\n */\ndefine(function (require, exports, module) {\n\n\n    const _ = require(\"thirdparty/lodash\"),\n        Mustache = require(\"thirdparty/mustache/mustache\"),\n        EventDispatcher = require(\"utils/EventDispatcher\"),\n        Commands = require(\"command/Commands\"),\n        KeyBindingManager = require(\"command/KeyBindingManager\"),\n        KeyEvent = require(\"utils/KeyEvent\"),\n        ModalBar = require(\"widgets/ModalBar\").ModalBar,\n        PreferencesManager = require(\"preferences/PreferencesManager\"),\n        MainViewManager = require(\"view/MainViewManager\"),\n        Strings = require(\"strings\"),\n        ViewUtils = require(\"utils/ViewUtils\"),\n        FindUtils = require(\"search/FindUtils\"),\n        FileUtils = require(\"file/FileUtils\"),\n        QuickSearchField = require(\"search/QuickSearchField\").QuickSearchField,\n        Metrics = require(\"utils/Metrics\");\n\n    /**\n     * @private\n     * The template we use for all Find bars.\n     * @type {string}\n     */\n    const _searchBarTemplate = require(\"text!htmlContent/findreplace-bar.html\");\n\n    let intervalId = 0,\n        lastQueriedText = \"\",\n        lastTypedText = \"\",\n        lastTypedTextWasRegexp = false,\n        lastClosedQuery = null;\n    const MAX_HISTORY_RESULTS = 25;\n    const PREF_MAX_HISTORY = \"maxSearchHistory\";\n\n    const INSTANT_SEARCH_INTERVAL_MS = 50;\n\n    /**\n     *\n     * Find Bar UI component, used for both single- and multi-file find/replace. This doesn't actually\n     * create and add the FindBar to the DOM - for that, call open().\n     *\n     * Dispatches these events:\n     *\n     * - queryChange - when the user types in the input field or sets a query option. Use getQueryInfo()\n     *      to get the current query state.\n     * - doFind - when the user chooses to do a Find Previous or Find Next.\n     *      Parameters are:\n     *          shiftKey - boolean, false for Find Next, true for Find Previous\n     * - doReplace - when the user chooses to do a single replace. Use getReplaceText() to get the current replacement text.\n     * - doReplaceBatch - when the user chooses to initiate a Replace All. Use getReplaceText() to get the current replacement text.\n     * - doReplaceAll - when the user chooses to perform a Replace All. Use getReplaceText() to get the current replacement text.\n     * - close - when the find bar is closed\n     *\n     * @constructor\n     *\n     * @param {boolean=} options.multifile - true if this is a Find/Replace in Files (changes the behavior of Enter in\n     *      the fields, hides the navigator controls, shows the scope/filter controls, and if in replace mode, hides the\n     *      Replace button (so there's only Replace All)\n     * @param {boolean=} options.replace - true to show the Replace controls - default false\n     * @param {string=}  options.queryPlaceholder - label to show in the Find field - default empty string\n     * @param {string=}  options.initialQuery - query to populate in the Find field on open - default empty string\n     * @param {string=}  scopeLabel - HTML label to show for the scope of the search, expected to be already escaped - default empty string\n     */\n    function FindBar(options) {\n        var defaults = {\n            multifile: false,\n            replace: false,\n            queryPlaceholder: \"\",\n            initialQuery: \"\",\n            initialReplaceText: \"\",\n            scopeLabel: \"\"\n        };\n        this._options = _.extend(defaults, options);\n        this._closed = false;\n        this._enabled = true;\n    }\n    EventDispatcher.makeEventDispatcher(FindBar.prototype);\n\n    /*\n     * Global FindBar functions for making sure only one is open at a time.\n     */\n\n    // TODO: this is temporary - we should do this at the ModalBar level, but can't do that until\n    // we land the simplified Quick Open UI (#7227) that eliminates some asynchronicity in closing\n    // its ModalBar.\n\n    /**\n     * @private\n     * Register a find bar so we can close it later if another one tries to open.\n     * Note that this is a global function, not an instance function.\n     * @param {!FindBar} findBar The find bar to register.\n     */\n    FindBar._addFindBar = function (findBar) {\n        FindBar._bars = FindBar._bars || [];\n        FindBar._bars.push(findBar);\n    };\n\n    /**\n     * @private\n     * Remove a find bar from the list.\n     * Note that this is a global function, not an instance function.\n     * @param {FindBar} findBar The bar to remove.\n     */\n    FindBar._removeFindBar = function (findBar) {\n        if (FindBar._bars) {\n            _.pull(FindBar._bars, findBar);\n        }\n    };\n\n    /**\n     * @private\n     * Close all existing find bars. In theory there should be only one, but since there can be\n     * timing issues due to animation we maintain a list.\n     * Note that this is a global function, not an instance function.\n     */\n    FindBar._closeFindBars = function () {\n        var bars = FindBar._bars;\n        if (bars) {\n            bars.forEach(function (bar) {\n                bar.close(true, false);\n            });\n            bars = [];\n        }\n    };\n\n    /*\n     * Instance properties/functions\n     */\n\n    /**\n     * @private\n     * Options passed into the FindBar.\n     * @type {!{multifile: boolean, replace: boolean, queryPlaceholder: string, initialQuery: string, scopeLabel: string}}\n     */\n    FindBar.prototype._options = null;\n\n    /**\n     * @private\n     * Whether the FindBar has been closed.\n     * @type {boolean}\n     */\n    FindBar.prototype._closed = false;\n\n    /**\n     * @private\n     * Whether the FindBar is currently enabled.\n     * @type {boolean}\n     */\n    FindBar.prototype._enabled = true;\n\n    /**\n     * @private\n     * @type {?ModalBar} Modal bar containing this find bar's UI\n     */\n    FindBar.prototype._modalBar = null;\n\n    /**\n     * @private\n     * Returns the jQuery object for an element in this Find bar.\n     * @param {string} selector The selector for the element.\n     * @return {jQueryObject} The jQuery object for the element, or an empty object if the Find bar isn't yet\n     *      in the DOM or the element doesn't exist.\n     */\n    FindBar.prototype.$ = function (selector) {\n        if (this._modalBar) {\n            return $(selector, this._modalBar.getRoot());\n        }\n        return $();\n\n    };\n\n    // TODO: change IDs to classes\n\n    /**\n     * @private\n     * Set the state of the toggles in the Find bar to the saved prefs state.\n     */\n    FindBar.prototype._updateSearchBarFromPrefs = function () {\n        // Have to make sure we explicitly cast the second parameter to a boolean, because\n        // toggleClass expects literal true/false.\n        this.$(\"#find-case-sensitive\").toggleClass(\"active\", !!PreferencesManager.getViewState(\"caseSensitive\"));\n        this.$(\"#find-regexp\").toggleClass(\"active\", !!PreferencesManager.getViewState(\"regexp\"));\n    };\n\n    /**\n     * @private\n     * Save the prefs state based on the state of the toggles.\n     */\n    FindBar.prototype._updatePrefsFromSearchBar = function () {\n        var isRegexp = this.$(\"#find-regexp\").is(\".active\");\n        PreferencesManager.setViewState(\"caseSensitive\", this.$(\"#find-case-sensitive\").is(\".active\"));\n        PreferencesManager.setViewState(\"regexp\", isRegexp);\n        lastTypedTextWasRegexp = isRegexp;\n    };\n\n    /**\n     * @private\n     * Shows the keyboard shortcut for the given command in the element's tooltip.\n     * @param {jQueryObject} $elem The element to add the shortcut to.\n     * @param {string} commandId The ID for the command whose keyboard shortcut to show.\n     */\n    FindBar.prototype._addShortcutToTooltip = function ($elem, commandId) {\n        const replaceShortcut = KeyBindingManager.getKeyBindingsDisplay(commandId);\n        if (replaceShortcut) {\n            var oldTitle = $elem.attr(\"title\");\n            oldTitle = (oldTitle ? oldTitle + \" \" : \"\");\n            $elem.attr(\"title\", oldTitle + \"(\" + replaceShortcut + \")\");\n        }\n    };\n\n    function _updateHistory(whichHistory, searchVal) {\n        if (searchVal) {\n            let searchHistory = PreferencesManager.getViewState(whichHistory);\n            const maxCount = PreferencesManager.get(PREF_MAX_HISTORY);\n            const searchQueryIndex = searchHistory.indexOf(searchVal);\n            if (searchQueryIndex !== -1) {\n                searchHistory.splice(searchQueryIndex, 1);\n            } else {\n                if (searchHistory.length === maxCount) {\n                    searchHistory.pop();\n                }\n            }\n            searchHistory.unshift(searchVal);\n            PreferencesManager.setViewState(whichHistory, searchHistory);\n        }\n    }\n\n    /**\n     * @private\n     * Adds element to the search history queue.\n     * @param {string} searchVal string that needs to be added to search history.\n     * @param {string} filterVal string that needs to be added to filter  history.\n     */\n    FindBar.prototype._addElementToSearchHistory = function (searchVal, filterVal) {\n        _updateHistory(\"searchHistory\", searchVal);\n        _updateHistory(\"filterHistory\", filterVal);\n    };\n\n    /**\n     * Opens the Find bar, closing any other existing Find bars.\n     */\n    FindBar.prototype.open = function () {\n        var self = this;\n\n        // Normally, creating a new Find bar will simply cause the old one to close\n        // automatically. This can cause timing issues because the focus change might\n        // cause the new one to think it should close, too. So we simply explicitly\n        // close the old Find bar (with no animation) before creating a new one.\n        // TODO: see note above - this will move to ModalBar eventually.\n        FindBar._closeFindBars();\n        let metricType = \"findBar\";\n        if (this._options.multifile) {\n            metricType = \"findInFiles.bar\";\n        }\n        Metrics.countEvent(Metrics.EVENT_TYPE.SEARCH, metricType, \"opened\");\n\n        var templateVars = _.clone(this._options);\n        templateVars.Strings = Strings;\n        templateVars.replaceBatchLabel = (templateVars.multifile ? Strings.BUTTON_REPLACE_ALL_IN_FILES : Strings.BUTTON_REPLACE_BATCH);\n        templateVars.replaceAllLabel = Strings.BUTTON_REPLACE_ALL;\n\n        self._addElementToSearchHistory(this._options.initialQuery);\n\n        this._modalBar = new ModalBar(\n            Mustache.render(_searchBarTemplate, templateVars),\n            !!PreferencesManager.get('autoHideSearch')\t\t// 2nd arg = auto-close on Esc/blur\n        );\n\n        // Done this way because ModalBar.js seems to react unreliably when\n        // modifying it to handle the escape key - the findbar wasn't getting\n        // closed as it should, instead persisting in the background\n        function _handleKeydown(e) {\n            if (e.keyCode === KeyEvent.DOM_VK_ESCAPE) {\n                e.stopPropagation();\n                e.preventDefault();\n                self.close();\n            }\n        }\n        window.document.body.addEventListener(\"keydown\", _handleKeydown, true);\n\n        function _keydownHookForCtrlSpace(event) {\n            const ctrlSpaceEvent = (event.ctrlKey === true || event.metaKey === true) &&\n                (event.keyCode === KeyEvent.DOM_VK_SPACE);\n            if (!ctrlSpaceEvent) {\n                return;\n            }\n            if ($(\"#find-what\").is(\":focus\")) {\n                self.showSearchHints();\n                event.stopPropagation();\n                event.preventDefault();\n                return true;\n            }\n            if ($(\"#fif-filter-input\").is(\":focus\")) {\n                self.showFilterHints();\n                event.stopPropagation();\n                event.preventDefault();\n                return true;\n            }\n            return false;\n        }\n\n        KeyBindingManager.addGlobalKeydownHook(_keydownHookForCtrlSpace);\n\n        // When the ModalBar closes, clean ourselves up.\n        this._modalBar.on(\"close\", function (event) {\n            KeyBindingManager.removeGlobalKeydownHook(_keydownHookForCtrlSpace);\n            window.document.body.removeEventListener(\"keydown\", _handleKeydown, true);\n\n            // Hide error popup, since it hangs down low enough to make the slide-out look awkward\n            self.showError(null);\n            self._modalBar = null;\n            self._closed = true;\n            window.clearInterval(intervalId);\n            intervalId = 0;\n            FindBar._removeFindBar(self);\n            MainViewManager.focusActivePane();\n            self.trigger(\"close\");\n            if (self.searchField) {\n                self.searchField.destroy();\n            }\n            if (self.filterField) {\n                self.filterField.destroy();\n            }\n        });\n\n        FindBar._addFindBar(this);\n\n        let executeSearchIfNeeded = function () {\n            // We only do instant search via worker.\n            if (FindUtils.isInstantSearchDisabled()) {\n                return;\n            }\n            if (self._closed) {\n                return;\n            }\n            if (self.getQueryInfo().query !== lastQueriedText && !FindUtils.isWorkerSearchInProgress()) {\n                // init Search\n                if (self._options.multifile) {\n                    self.trigger(\"doFind\");\n                    lastQueriedText = self.getQueryInfo().query;\n                }\n            }\n        };\n        if (intervalId === 0) {\n            // we do this so that is the search query changes by any means - by keypress, or programmatically\n            // we do an instant search if the search term changes.\n            intervalId = window.setInterval(executeSearchIfNeeded, INSTANT_SEARCH_INTERVAL_MS);\n        }\n\n        var $root = this._modalBar.getRoot();\n        var historyIndex = 0;\n        $root\n            .on(\"input\", \"#find-what\", function () {\n                self.trigger(\"queryChange\");\n                var queryInfo = self.getQueryInfo();\n                lastTypedText = queryInfo.query;\n                lastTypedTextWasRegexp = queryInfo.isRegexp;\n            })\n            .on(\"click\", \"#find-case-sensitive, #find-regexp\", function (e) {\n                $(e.currentTarget).toggleClass(\"active\");\n                self._updatePrefsFromSearchBar();\n                self.trigger(\"queryChange\");\n                if (self._options.multifile) {  //instant search\n                    self.trigger(\"doFind\");\n                }\n            })\n            .on(\"click\", \"#find-counter\", function (e) {\n                $(\"#find-what\").focus();\n            })\n            .on(\"focusin\", \"#find-what\", function (e) {\n                $(\".find-what-wrapper\").addClass(\"find-what-wrapper-focused\");\n            })\n            .on(\"focusout\", \"#find-what\", function (e) {\n                $(\".find-what-wrapper\").removeClass(\"find-what-wrapper-focused\");\n                setTimeout(() => {\n                    if (self.searchField && !$(\"#find-what\").is(\":focus\")) {\n                        self.searchField.destroy();\n                        self.searchField = null;\n                    }\n                }, 250); // on clicking the item in history popup, commit is called after focusout which\n                // means that if we destroy it here, the commit will never be called. so the delay timer.\n            })\n            .on(\"focusout\", \"#fif-filter-input\", function (e) {\n                setTimeout(() => {\n                    if (self.filterField && !$(\"#fif-filter-input\").is(\":focus\")) {\n                        self.filterField.destroy();\n                        self.filterField = null;\n                    }\n                }, 250); // on clicking the item in history popup, commit is called after focusout which\n                // means that if we destroy it here, the commit will never be called. so the delay timer.\n            })\n            .on(\"click\", \".search-input-container .dropdown-icon\", function (e) {\n                if (self.searchField) {\n                    self.searchField.destroy();\n                    self.searchField = null;\n                } else {\n                    self.showSearchHints(true);\n                }\n                self.$(\"#find-what\").focus();\n            })\n            .on(\"click\", \".filter-container .filter-dropdown-icon\", function (e) {\n                if (self.filterField) {\n                    self.filterField.destroy();\n                    self.filterField = null;\n                } else {\n                    self.showFilterHints(true);\n                }\n                self.$(\"#fif-filter-input\").focus();\n            })\n            .on(\"keydown\", \"#find-what, #replace-with, #fif-filter-input\", function (e) {\n                if (e.keyCode === KeyEvent.DOM_VK_RETURN) {\n                    if (self._options.multifile && e.shiftKey) {\n                        // In multi file search, if we press shift+return key, we enter the multi line ssearch mode and\n                        // the text input will receive the enter key to create a new line in text field.\n                        return;\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                    self._addElementToSearchHistory(\n                        self.$(\"#find-what\").val(), self.$(\"#fif-filter-input\").val());\n                    if (self._options.multifile) {\n                        if ($(e.target).is(\"#find-what\")) {\n                            if (self._options.replace) {\n                                // Just set focus to the Replace field.\n                                self.focusReplace();\n                            } else {\n                                Metrics.countEvent(Metrics.EVENT_TYPE.SEARCH, \"findInFiles.bar\",\n                                    \"returnKey\");\n                                // Trigger a Find (which really means \"Find All\" in this context).\n                                self.trigger(\"openSelectedFile\");\n                            }\n                        } else {\n                            Metrics.countEvent(Metrics.EVENT_TYPE.SEARCH, \"replaceBatchInFiles.bar\",\n                                \"returnKey\");\n                            self.trigger(\"doReplaceBatch\");\n                        }\n                    } else {\n                        // In the single file case, we just want to trigger a Find Next (or Find Previous\n                        // if Shift is held down).\n                        self.trigger(\"doFind\", e.shiftKey);\n                    }\n                    historyIndex = 0;\n                } else if (e.keyCode === KeyEvent.DOM_VK_DOWN) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    if (self._options.multifile) {\n                        self.trigger(\"selectNextResult\");\n                        return;\n                    }\n                    self.trigger(\"doFind\", false);\n                } else if (e.keyCode === KeyEvent.DOM_VK_UP) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    if (self._options.multifile) {\n                        self.trigger(\"selectPrevResult\");\n                        return;\n                    }\n                    self.trigger(\"doFind\", true);\n                } else if (e.keyCode === KeyEvent.DOM_VK_PAGE_DOWN) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    self.trigger(\"selectNextPage\");\n                } else if (e.keyCode === KeyEvent.DOM_VK_PAGE_UP) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    self.trigger(\"selectPrevPage\");\n                }\n            })\n            .on(\"click\", \".close\", function () {\n                self.close();\n            });\n\n        if (!this._options.multifile) {\n            this._addShortcutToTooltip($(\"#find-next\"), Commands.CMD_FIND_NEXT);\n            this._addShortcutToTooltip($(\"#find-prev\"), Commands.CMD_FIND_PREVIOUS);\n            $root\n                .on(\"click\", \"#find-next\", function (e) {\n                    self.trigger(\"doFind\", false);\n                })\n                .on(\"click\", \"#find-prev\", function (e) {\n                    self.trigger(\"doFind\", true);\n                });\n        }\n\n        if (this._options.replace) {\n            this._addShortcutToTooltip($(\"#replace-yes\"), Commands.CMD_REPLACE);\n            $root\n                .on(\"click\", \"#replace-yes\", function (e) {\n                    self.trigger(\"doReplace\");\n                })\n                .on(\"click\", \"#replace-batch\", function (e) {\n                    self.trigger(\"doReplaceBatch\");\n                })\n                .on(\"click\", \"#replace-all\", function (e) {\n                    self.trigger(\"doReplaceAll\");\n                })\n                // One-off hack to make Find/Replace fields a self-contained tab cycle\n                // TODO: remove once https://trello.com/c/lTSJgOS2 implemented\n                .on(\"keydown\", function (e) {\n                    if (e.keyCode === KeyEvent.DOM_VK_TAB && !e.ctrlKey && !e.metaKey && !e.altKey) {\n                        if (e.target.id === \"replace-with\" && !e.shiftKey) {\n                            self.$(\"#find-what\").focus();\n                            e.preventDefault();\n                        } else if (e.target.id === \"find-what\" && e.shiftKey) {\n                            self.$(\"#replace-with\").focus();\n                            e.preventDefault();\n                        }\n                    }\n                });\n        }\n\n        if (this._options.multifile && FindUtils.isIndexingInProgress()) {\n            this.showIndexingSpinner();\n        }\n\n        // Set up the initial UI state.\n        this._updateSearchBarFromPrefs();\n        this.focusQuery();\n    };\n\n    FindBar.prototype._showHintsInternal = function (positionElement, inputElemId, stateVarName, fieldName, dontFilterHistory) {\n        const self = this;\n        self._dontFilterHistory = dontFilterHistory;\n        let inputField = self.$(inputElemId);\n        const maxCount = PreferencesManager.get(PREF_MAX_HISTORY);\n        this[fieldName] = new QuickSearchField(inputField, {\n            verticalAdjust: inputField.offset().top > 0 ? 0 : this._modalBar.getRoot().outerHeight(),\n            maxResults: maxCount,\n            firstHighlightIndex: null,\n            $positionEl: positionElement ? self.$(positionElement) : null,\n            resultProvider: function (query) {\n                query = query || \"\";\n                const asyncResult = new $.Deferred();\n                let history = PreferencesManager.getViewState(stateVarName) || [];\n                if (!self._dontFilterHistory) {\n                    history = history.filter(historyItem => {\n                        return ((typeof historyItem === 'string') &&\n                            historyItem.toLowerCase().includes(query.toLowerCase()));\n                    });\n                }\n                self._dontFilterHistory = false;\n                asyncResult.resolve(history);\n                return asyncResult.promise();\n            },\n            formatter: function (item, query) {\n                const $li = $(\"<li></li>\");\n                $li.text(item);\n                return $li;\n            },\n            onCommit: function (selectedItem, query, itemIndex) {\n                if (selectedItem) {\n                    self.$(inputElemId).val(selectedItem);\n                    self.$(inputElemId).val(selectedItem).trigger('input');\n                } else if (query.length) {\n                    self[fieldName].setText(query);\n                }\n                self.$(inputElemId).focus();\n                self[fieldName].destroy();\n                self[fieldName] = null;\n                // now move the committed item to top of history as its most recent\n                if (itemIndex) {\n                    let history = PreferencesManager.getViewState(stateVarName) || [];\n                    let deletedItem = history.splice(itemIndex, 1);\n                    history.unshift(deletedItem[0]);\n                    PreferencesManager.setViewState(stateVarName, history);\n                }\n            },\n            onDismiss: function () {\n                if (self[fieldName]) {\n                    self[fieldName].destroy();\n                    self[fieldName] = null;\n                }\n            },\n            onDelete: function (deletedIndex) {\n                let history = PreferencesManager.getViewState(stateVarName) || [];\n                history.splice(deletedIndex, 1);\n                PreferencesManager.setViewState(stateVarName, history);\n            },\n            onHighlight: function (selectedItem, query, explicit) { },\n            highlightZeroResults: false,\n            focusLastActiveElementOnClose: true\n        });\n        this[fieldName].setText(inputField.val());\n    };\n\n    /**\n     * @private\n     * Shows the search History in dropdown.\n     */\n    FindBar.prototype.showSearchHints = function (dontFilterHistory) {\n        return this._showHintsInternal(\".find-what-wrapper\", \"#find-what\", \"searchHistory\", \"searchField\", dontFilterHistory);\n    };\n\n    /**\n     * @private\n     * Shows the filter History in dropdown.\n     */\n    FindBar.prototype.showFilterHints = function (dontFilterHistory) {\n        return this._showHintsInternal(null, \"#fif-filter-input\", \"filterHistory\", \"filterField\", dontFilterHistory);\n    };\n\n    /**\n     * Closes this Find bar. If already closed, does nothing.\n     * @param {boolean} suppressAnimation If true, don't do the standard closing animation. Default false.\n     */\n    FindBar.prototype.close = function (suppressAnimation) {\n        lastQueriedText = \"\";\n        if (this._modalBar) {\n            lastClosedQuery = {\n                query: this.$(\"#find-what\").val() || \"\",\n                replaceText: this.getReplaceText(),\n                isCaseSensitive: this.$(\"#find-case-sensitive\").is(\".active\"),\n                isRegexp: this.$(\"#find-regexp\").is(\".active\")\n            };\n            this._addElementToSearchHistory($(\"#find-what\").val(), $(\"#fif-filter-input\").val());\n            // 1st arg = restore scroll pos; 2nd arg = no animation, since getting replaced immediately\n            this._modalBar.close(true, !suppressAnimation);\n        }\n    };\n\n    /**\n     * @return {boolean} true if this FindBar has been closed.\n     */\n    FindBar.prototype.isClosed = function () {\n        return this._closed;\n    };\n\n    /**\n     * @return {Object} The options passed into the FindBar.\n     */\n    FindBar.prototype.getOptions = function () {\n        return this._options;\n    };\n\n    /**\n     * Returns the current query and parameters.\n     * @return {{query: string, caseSensitive: boolean, isRegexp: boolean}}\n     */\n    FindBar.prototype.getQueryInfo = function (usePlatformLineEndings = true) {\n        const $findWhat = this.$(\"#find-what\");\n        const findTextArea = $findWhat[0];\n        let query = $findWhat.val() || \"\";\n        const lineEndings = FileUtils.sniffLineEndings(query);\n        if (usePlatformLineEndings && lineEndings === FileUtils.LINE_ENDINGS_LF && brackets.platform === \"win\") {\n            query = query.replace(/\\n/g, \"\\r\\n\");\n        }\n        return {\n            query: query,\n            isCaseSensitive: this.$(\"#find-case-sensitive\").is(\".active\"),\n            isRegexp: this.$(\"#find-regexp\").is(\".active\"),\n            isQueryTextSelected: findTextArea.selectionStart !== findTextArea.selectionEnd\n        };\n    };\n\n    /**\n     * Show or clear an error message related to the query.\n     * @param {?string} error The error message to show, or null to hide the error display.\n     * @param {boolean=} isHTML Whether the error message is HTML that should remain unescaped.\n     * @param {boolean=} isFilterError Whether the error related to file filters\n     */\n    FindBar.prototype.showError = function (error, isHTML, isFilterError) {\n        const $findError = this.$(\".error\"),\n            $filterError = this.$(\".error-filter\");\n        const $error = isFilterError ? $filterError : $findError;\n        $findError.hide();\n        $filterError.hide();\n        if (error) {\n            if (isHTML) {\n                $error.html(error);\n            } else {\n                $error.text(error);\n            }\n            $error.show();\n        }\n    };\n\n    /**\n     * Set the find count.\n     * @param {string} count The find count message to show. Can be the empty string to hide it.\n     */\n    FindBar.prototype.showFindCount = function (count) {\n        this.$(\"#find-counter\")\n            .text(count)\n            .attr('title', count);\n    };\n\n    /**\n     * Show or hide the no-results indicator and optional message. This is also used to\n     * indicate regular expression errors.\n     * @param {boolean} showIndicator\n     * @param {boolean} showMessage\n     */\n    FindBar.prototype.showNoResults = function (showIndicator, showMessage) {\n        const $filterInput = this.$(\"#fif-filter-input\");\n        const $findWhat = this.$(\".find-what-wrapper\");\n        $filterInput.removeClass(\"no-results\");\n        $findWhat.removeClass(\"no-results\");\n        let $borderEl = $findWhat;\n        if ($filterInput.is(\":focus\")) {\n            $borderEl = $filterInput;\n        }\n        ViewUtils.toggleClass($borderEl, \"no-results\", showIndicator);\n\n        const noResultsMessage = showMessage ? Strings.FIND_NO_RESULTS : \"\";\n        this.showFindCount(noResultsMessage);\n    };\n\n    /**\n     * Returns the current replace text.\n     * @return {string}\n     */\n    FindBar.prototype.getReplaceText = function () {\n        return this.$(\"#replace-with\").val() || \"\";\n    };\n\n    /**\n     * Enables or disables the controls in the Find bar. Note that if enable is true, *all* controls will be\n     * re-enabled, even if some were previously disabled using enableNavigation() or enableReplace(), so you\n     * will need to refresh their enable state after calling this.\n     * @param {boolean} enable Whether to enable or disable the controls.\n     */\n    FindBar.prototype.enable = function (enable) {\n        this.$(\"#find-what, #replace-with, #find-prev, #find-next, #find-case-sensitive, #find-regexp\").prop(\"disabled\", !enable);\n        this._enabled = enable;\n    };\n\n    FindBar.prototype.focus = function (enable) {\n        if (!this.$(\"#fif-filter-input\").is(':focus')) {\n            // the filter find bar text input already has focus\n            this.$(\"#find-what\").focus();\n        }\n    };\n\n    /**\n     * @return {boolean} true if the FindBar is enabled.\n     */\n    FindBar.prototype.isEnabled = function () {\n        return this._enabled;\n    };\n\n    /**\n     * @return {boolean} true if the Replace button is enabled.\n     */\n    FindBar.prototype.isReplaceEnabled = function () {\n        return this.$(\"#replace-yes\").is(\":enabled\");\n    };\n\n    /**\n     * Enable or disable the navigation controls if present. Note that if the Find bar is currently disabled\n     * (i.e. isEnabled() returns false), this will have no effect.\n     * @param {boolean} enable Whether to enable the controls.\n     */\n    FindBar.prototype.enableNavigation = function (enable) {\n        if (this.isEnabled()) {\n            this.$(\"#find-prev, #find-next\").prop(\"disabled\", !enable);\n        }\n    };\n\n    /**\n     * Enable or disable the replace controls if present. Note that if the Find bar is currently disabled\n     * (i.e. isEnabled() returns false), this will have no effect.\n     * @param {boolean} enable Whether to enable the controls.\n     */\n    FindBar.prototype.enableReplace = function (enable) {\n        if (this.isEnabled) {\n            this.$(\"#replace-yes, #replace-batch, #replace-all\").prop(\"disabled\", !enable);\n        }\n    };\n\n    /**\n     * @private\n     * Focus and select the contents of the given field.\n     * @param {string} selector The selector for the field.\n     */\n    FindBar.prototype._focus = function (selector) {\n        this.$(selector)\n            .focus()\n            .get(0).select();\n    };\n\n    /**\n     * Sets focus to the query field and selects its text.\n     */\n    FindBar.prototype.focusQuery = function () {\n        this._focus(\"#find-what\");\n    };\n\n    /**\n     * Sets focus to the replace field and selects its text.\n     */\n    FindBar.prototype.focusReplace = function () {\n        this._focus(\"#replace-with\");\n    };\n\n    /**\n     * The indexing spinner is usually shown when node is indexing files\n     */\n    FindBar.prototype.showIndexingSpinner = function () {\n        this.$(\"#indexing-spinner\").removeClass(\"forced-hidden\");\n        this.setIndexingMessage(Strings.FIND_IN_FILES_INDEXING);\n    };\n\n    FindBar.prototype.setIndexingMessage = function (message) {\n        this.$(\"#indexing-spinner-message\").text(message);\n    };\n\n    FindBar.prototype.hideIndexingSpinner = function () {\n        this.$(\"#indexing-spinner\").addClass(\"forced-hidden\");\n    };\n\n    /**\n     * Force a search again\n     */\n    FindBar.prototype.redoInstantSearch = function () {\n        this.trigger(\"doFind\");\n    };\n\n    /**\n     * Returns the string used to prepopulate the find bar\n     * @private\n     * @param {!Editor} editor\n     * @return {string} first line of primary selection to populate the find bar\n     */\n    FindBar._getInitialQueryFromSelection = function (editor) {\n        const selectionText = editor.document.getSelectedText(true);\n        if (selectionText) {\n            return selectionText\n                .replace(/^\\n*/, \"\"); // Trim possible newlines at the very beginning of the selection\n        }\n        return \"\";\n    };\n\n    /**\n     * Retrieves the appropriate query and replacement text to prepopulate the Find Bar.\n     * @private\n     * @static\n     * @param {?FindBar} currentFindBar - The currently open Find Bar, if any.\n     * @param {?Editor} editor - The active editor, if any.\n     * @return {{query: string, replaceText: string}} An object containing the query and replacement text\n     *     to prepopulate the Find Bar.\n     */\n    FindBar.getInitialQuery = function (currentFindBar, editor) {\n        var query,\n            selection = editor ? FindBar._getInitialQueryFromSelection(editor) : \"\",\n            replaceText = \"\";\n\n        if (currentFindBar && !currentFindBar.isClosed()) {\n            // The modalBar was already up. When creating the new modalBar, copy the\n            // current query instead of using the passed-in selected text.\n            var queryInfo = currentFindBar.getQueryInfo();\n            query = (!queryInfo.isRegexp && selection) || queryInfo.query;\n            replaceText = currentFindBar.getReplaceText();\n        } else {\n            var openedFindBar = FindBar._bars && _.find(FindBar._bars,\n                function (bar) {\n                    return !bar.isClosed();\n                }\n            );\n            // this happens when the find in files bar is opened and we are trying to open single file search or\n            // vice versa. we need to detect the other findbar and determine what is the search term to use\n\n            //debugger\n            const currentQueryInfo = openedFindBar && openedFindBar.getQueryInfo();\n            if(!openedFindBar && selection){\n                // when no findbar is open, the selected text always takes precedence in both single and multi file\n                query = selection;\n            } else if(openedFindBar && selection && currentQueryInfo && !currentQueryInfo.isRegexp && currentQueryInfo.isQueryTextSelected) {\n                // we are switching between single<>multi file search without the user editing the search text in between\n                // while there is an active selection, the selection takes precedence.\n                query = selection;\n                replaceText = openedFindBar.getReplaceText();\n            } else if (openedFindBar) {\n                // there is no selection and we are switching between single<>multi file search, copy the\n                // current query from the open findbar as is\n                query = openedFindBar.getQueryInfo().query;\n                replaceText = openedFindBar.getReplaceText();\n            }  else if (lastClosedQuery) {\n                // these is no open find bar currently and there is no selection, but there is a last saved query, so\n                // load the last query. this happenes on all freash search cases apart from the very first time\n                query = lastClosedQuery.query;\n                replaceText = lastClosedQuery.replaceText;\n            } else if (editor) {\n                // the very first query after app start, nothing to restore.\n                query = (!lastTypedTextWasRegexp && selection) || lastQueriedText || lastTypedText;\n            }\n        }\n\n        return { query: query, replaceText: replaceText };\n    };\n\n    PreferencesManager.stateManager.definePreference(\"caseSensitive\", \"boolean\", false);\n    PreferencesManager.stateManager.definePreference(\"regexp\", \"boolean\", false);\n    PreferencesManager.stateManager.definePreference(\"searchHistory\", \"array\", []);\n    PreferencesManager.stateManager.definePreference(\"filterHistory\", \"array\", []);\n    PreferencesManager.definePreference(PREF_MAX_HISTORY, \"number\", MAX_HISTORY_RESULTS, {\n        description: Strings.FIND_HISTORY_MAX_COUNT\n    });\n\n    exports.FindBar = FindBar;\n});\n"],"file":"FindBar.js"}