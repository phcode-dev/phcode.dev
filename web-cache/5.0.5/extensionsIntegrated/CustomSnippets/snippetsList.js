define(function(require,exports,module){const StringUtils=require("utils/StringUtils"),Metrics=require("utils/Metrics"),Global=require("./global"),SnippetsState=require("./snippetsState"),UIHelper=require("./UIHelper"),FilterSnippets=require("./filterSnippets"),Helper=require("./helper"),Strings=require("strings");function _createSnippetItem(snippetItem){const $snippetItem=$("<div>").attr("data-abbr",snippetItem.abbreviation).addClass("snippet-item"),$snippetAbbr=$("<div>").text(snippetItem.abbreviation).attr("id","snippet-abbr").attr("title",StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_ABBR_TOOLTIP,snippetItem.abbreviation)),$snippetTemplate=$("<div>").text(snippetItem.templateText).attr("id","snippet-template").attr("title",StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_TEMPLATE_TOOLTIP,snippetItem.templateText)),$snippetDescription=$("<div>").text(snippetItem.description&&""!==snippetItem.description.trim()?snippetItem.description:Strings.CUSTOM_SNIPPETS_NO_DESCRIPTION).attr("id","snippet-description").attr("title",snippetItem.description&&""!==snippetItem.description.trim()?StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_DESC_TOOLTIP,snippetItem.description):Strings.CUSTOM_SNIPPETS_ADD_DESC_TOOLTIP),$snippetFiles=$("<div>").text(snippetItem.fileExtension||"all").attr("id","snippet-files").attr("title",StringUtils.format(Strings.CUSTOM_SNIPPETS_EDIT_FILE_EXT_TOOLTIP,snippetItem.fileExtension||"all")),$deleteSnippet=$("<div>").html('<i class="fas fa-trash"></i>').attr("id","delete-snippet-btn").attr("title",Strings.CUSTOM_SNIPPETS_DELETE_TOOLTIP).addClass("delete-snippet-btn");$snippetItem.append($snippetAbbr,$snippetTemplate,$snippetDescription,$snippetFiles,$deleteSnippet),$snippetItem.data("snippet",snippetItem),$("#snippets-list-wrapper").append($snippetItem),_registerHandlers()}function _showEmptyState(){UIHelper.showEmptySnippetMessage(),UIHelper.hideSnippetsListHeader();const $emptyMessage=$("#no-snippets-message"),$filterInput=$("#filter-snippets-input"),filterText=$filterInput.val().trim();filterText?$emptyMessage.text(StringUtils.format(Strings.CUSTOM_SNIPPETS_NO_MATCHES,filterText)):$emptyMessage.html(Strings.CUSTOM_SNIPPETS_LEARN_MORE)}function _renderSnippetsList(filteredSnippets){UIHelper.showSnippetsList(),UIHelper.showSnippetsListHeader(),filteredSnippets.forEach(function(snippetItem){_createSnippetItem(snippetItem)})}function showSnippetsList(){UIHelper.clearSnippetsList();const snippetList=Global.SnippetHintsList;if(0===snippetList.length)return void _showEmptyState();const filteredSnippets=FilterSnippets.filterSnippets(snippetList);0!==filteredSnippets.length?_renderSnippetsList(filteredSnippets):_showEmptyState()}function deleteSnippet(){const $snippetItem=$(this).closest(".snippet-item"),snippetItem=$snippetItem.data("snippet"),index=Global.SnippetHintsList.findIndex(s=>s.abbreviation===snippetItem.abbreviation);if(-1!==index){const fileCategory=Helper.categorizeFileExtensionForMetrics(snippetItem.fileExtension);Metrics.countEvent(Metrics.EVENT_TYPE.EDITOR,"snipt",`del.${fileCategory}`),Global.SnippetHintsList.splice(index,1),Helper.rebuildOptimizedStructures(),SnippetsState.saveSnippetsToState().catch(function(error){console.error("failed to delete custom snippet correctly:",error)}),Helper.updateSnippetsCount(),showSnippetsList()}}function _registerHandlers(){const $snippetsListWrapper=$("#snippets-list-wrapper");$snippetsListWrapper.off("click.deleteSnippet"),$snippetsListWrapper.on("click.deleteSnippet",".delete-snippet-btn",function(e){e.stopPropagation(),deleteSnippet.call(this)}),$snippetsListWrapper.off("click.editSnippet"),$snippetsListWrapper.on("click.editSnippet",".snippet-item",function(e){0===$(e.target).closest(".delete-snippet-btn").length&&editSnippet.call(this)})}function editSnippet(){const $snippetItem=$(this).closest(".snippet-item"),snippetItem=$snippetItem.data("snippet");Helper.populateEditForm(snippetItem),$("#custom-snippets-edit").data("originalSnippet",snippetItem),$("#custom-snippets-edit").data("snippetIndex",Global.SnippetHintsList.findIndex(s=>s.abbreviation===snippetItem.abbreviation)),UIHelper.showEditSnippetMenu(),Helper.toggleEditSaveButtonDisability()}exports.showSnippetsList=showSnippetsList,exports.deleteSnippet=deleteSnippet,exports.editSnippet=editSnippet});