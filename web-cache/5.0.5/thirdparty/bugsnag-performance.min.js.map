{"version":3,"file":"bugsnag-performance.min.js","sources":["../packages/core/dist/custom-attribute-limits.js","../packages/core/dist/validation.js","../packages/core/dist/attributes.js","../packages/core/dist/clock.js","../packages/core/dist/config.js","../packages/core/dist/events.js","../packages/core/dist/trace-id-to-sampling-rate.js","../packages/core/dist/span.js","../packages/core/dist/batch-processor.js","../packages/core/dist/delivery.js","../packages/core/dist/fixed-probability-manager.js","../packages/core/dist/prioritized-set.js","../packages/core/dist/plugin.js","../packages/core/dist/probability-fetcher.js","../packages/core/dist/probability-manager.js","../packages/core/dist/processor.js","../packages/core/dist/sampler.js","../packages/core/dist/span-context.js","../packages/core/dist/span-control-provider.js","../packages/core/dist/time.js","../packages/core/dist/span-factory.js","../packages/core/dist/app-state.js","../packages/core/dist/core.js","../node_modules/@bugsnag/cuid/lib/pad.js","../node_modules/@bugsnag/cuid/lib/fingerprint.browser.js","../node_modules/@bugsnag/cuid/index.js","../node_modules/@bugsnag/cuid/lib/is-cuid.js","../packages/core/dist/persistence.js","../packages/core/dist/retry-queue.js","../packages/core/dist/remote-parent-context.js","../packages/delivery-fetch/dist/delivery.js","../packages/request-tracker/dist/network-request-callback.js","../packages/request-tracker/dist/request-tracker.js","../packages/request-tracker/dist/url-helpers.js","../packages/request-tracker/dist/request-tracker-fetch.js","../packages/platforms/browser/lib/send-page-attributes.ts","../packages/platforms/browser/lib/auto-instrumentation/page-load-phase-spans.ts","../packages/platforms/browser/lib/default-routing-provider.ts","../packages/platforms/browser/lib/auto-instrumentation/full-page-load-plugin.ts","../packages/platforms/browser/lib/auto-instrumentation/network-request-plugin.ts","../packages/platforms/browser/lib/auto-instrumentation/resource-load-plugin.ts","../packages/platforms/browser/lib/auto-instrumentation/route-change-plugin.ts","../packages/platforms/browser/lib/clock.ts","../packages/platforms/browser/lib/routing-provider.ts","../packages/platforms/browser/lib/id-generator.ts","../packages/platforms/browser/lib/on-settle/settler.ts","../packages/platforms/browser/lib/on-settle/dom-mutation-settler.ts","../packages/platforms/browser/lib/on-settle/load-event-end-settler.ts","../packages/platforms/browser/lib/on-settle/request-settler.ts","../packages/platforms/browser/lib/on-settle/settler-aggregate.ts","../packages/platforms/browser/lib/persistence.ts","../packages/platforms/browser/lib/web-vitals.ts","../packages/platforms/browser/lib/browser.ts","../packages/platforms/browser/lib/on-settle/index.ts","../packages/platforms/browser/lib/backgrounding-listener.ts","../packages/platforms/browser/lib/span-attributes-source.ts","../packages/platforms/browser/lib/resource-attributes-source.ts","../packages/request-tracker/dist/request-tracker-xhr.js","../packages/platforms/browser/lib/config.ts"],"sourcesContent":["const ATTRIBUTE_KEY_LENGTH_LIMIT = 128;\nconst ATTRIBUTE_STRING_VALUE_LIMIT_DEFAULT = 1024;\nconst ATTRIBUTE_STRING_VALUE_LIMIT_MAX = 10000;\nconst ATTRIBUTE_ARRAY_LENGTH_LIMIT_DEFAULT = 1000;\nconst ATTRIBUTE_ARRAY_LENGTH_LIMIT_MAX = 10000;\nconst ATTRIBUTE_COUNT_LIMIT_DEFAULT = 128;\nconst ATTRIBUTE_COUNT_LIMIT_MAX = 1000;\nconst defaultSpanAttributeLimits = {\n    attributeStringValueLimit: ATTRIBUTE_STRING_VALUE_LIMIT_DEFAULT,\n    attributeArrayLengthLimit: ATTRIBUTE_ARRAY_LENGTH_LIMIT_DEFAULT,\n    attributeCountLimit: ATTRIBUTE_COUNT_LIMIT_DEFAULT\n};\nconst defaultResourceAttributeLimits = {\n    attributeStringValueLimit: Infinity,\n    attributeArrayLengthLimit: Infinity,\n    attributeCountLimit: Infinity\n};\n\nexport { ATTRIBUTE_ARRAY_LENGTH_LIMIT_DEFAULT, ATTRIBUTE_ARRAY_LENGTH_LIMIT_MAX, ATTRIBUTE_COUNT_LIMIT_DEFAULT, ATTRIBUTE_COUNT_LIMIT_MAX, ATTRIBUTE_KEY_LENGTH_LIMIT, ATTRIBUTE_STRING_VALUE_LIMIT_DEFAULT, ATTRIBUTE_STRING_VALUE_LIMIT_MAX, defaultResourceAttributeLimits, defaultSpanAttributeLimits };\n","const isBoolean = (value) => value === true || value === false;\nconst isObject = (value) => !!value && typeof value === 'object' && !Array.isArray(value);\nconst isNumber = (value) => typeof value === 'number' && Number.isFinite(value) && !Number.isNaN(value);\nconst isString = (value) => typeof value === 'string';\nconst isStringWithLength = (value) => isString(value) && value.length > 0;\nconst isLogger = (value) => isObject(value) &&\n    typeof value.debug === 'function' &&\n    typeof value.info === 'function' &&\n    typeof value.warn === 'function' &&\n    typeof value.error === 'function';\nconst isStringArray = (value) => Array.isArray(value) && value.every(isStringWithLength);\nconst isStringOrRegExpArray = (value) => Array.isArray(value) && value.every(item => isStringWithLength(item) || item instanceof RegExp);\nfunction isPersistedProbability(value) {\n    return isObject(value) &&\n        isNumber(value.value) &&\n        isNumber(value.time);\n}\nconst isSpanContext = (value) => isObject(value) &&\n    typeof value.id === 'string' &&\n    typeof value.traceId === 'string' &&\n    typeof value.isValid === 'function' &&\n    typeof value.samplingRate === 'number' &&\n    typeof value.samplingProbability === 'number';\nconst isParentContext = (value) => isObject(value) &&\n    typeof value.id === 'string' &&\n    typeof value.traceId === 'string';\nfunction isTime(value) {\n    return isNumber(value) || value instanceof Date;\n}\nfunction isPlugin(value) {\n    return isObject(value) && typeof value.install === 'function' && typeof value.start === 'function';\n}\nfunction isPluginArray(value) {\n    return Array.isArray(value) && value.every(plugin => isPlugin(plugin));\n}\nfunction isCallbackArray(value) {\n    return Array.isArray(value) && value.every(item => typeof item === 'function');\n}\n\nexport { isBoolean, isCallbackArray, isLogger, isNumber, isObject, isParentContext, isPersistedProbability, isPlugin, isPluginArray, isSpanContext, isString, isStringArray, isStringOrRegExpArray, isStringWithLength, isTime };\n","import { ATTRIBUTE_KEY_LENGTH_LIMIT, defaultResourceAttributeLimits } from './custom-attribute-limits.js';\nimport { isNumber } from './validation.js';\n\nfunction truncateString(value, limit) {\n    const originalLength = value.length;\n    const newString = value.slice(0, limit);\n    const truncatedLength = newString.length;\n    return `${newString} *** ${originalLength - truncatedLength} CHARS TRUNCATED`;\n}\nclass SpanAttributes {\n    get droppedAttributesCount() {\n        return this._droppedAttributesCount;\n    }\n    constructor(initialValues, spanAttributeLimits, spanName, logger) {\n        this._droppedAttributesCount = 0;\n        this.attributes = initialValues;\n        this.spanAttributeLimits = spanAttributeLimits;\n        this.spanName = spanName;\n        this.logger = logger;\n    }\n    truncateAttribute(name, value) {\n        if (typeof value === 'string' && value.length > this.spanAttributeLimits.attributeStringValueLimit) {\n            this.attributes.set(name, truncateString(value, this.spanAttributeLimits.attributeStringValueLimit));\n            this.logger.warn(`Span attribute ${name} in span ${this.spanName} was truncated as the string exceeds the ${this.spanAttributeLimits.attributeStringValueLimit} character limit set by attributeStringValueLimit.`);\n        }\n        if (Array.isArray(value) && value.length > this.spanAttributeLimits.attributeArrayLengthLimit) {\n            const truncatedValue = value.slice(0, this.spanAttributeLimits.attributeArrayLengthLimit);\n            this.attributes.set(name, truncatedValue);\n            this.logger.warn(`Span attribute ${name} in span ${this.spanName} was truncated as the array exceeds the ${this.spanAttributeLimits.attributeArrayLengthLimit} element limit set by attributeArrayLengthLimit.`);\n        }\n    }\n    isValidAttributeValue(value) {\n        return typeof value === 'string' || typeof value === 'boolean' || isNumber(value) || Array.isArray(value);\n    }\n    isValidAttributeName(name) {\n        return typeof name === 'string' && name.length > 0;\n    }\n    // Used to set internal attributes\n    set(name, value) {\n        if (!this.isValidAttributeName(name))\n            return;\n        if (value === null || value === undefined) {\n            this.remove(name);\n            return;\n        }\n        if (this.isValidAttributeValue(value)) {\n            this.attributes.set(name, value);\n        }\n    }\n    // Used by the public API to set custom attributes\n    setCustom(name, value) {\n        if (!this.isValidAttributeName(name))\n            return;\n        if (value === null || value === undefined) {\n            this.remove(name);\n            return;\n        }\n        if (this.isValidAttributeValue(value)) {\n            if (!this.attributes.has(name) && this.attributes.size >= this.spanAttributeLimits.attributeCountLimit) {\n                this._droppedAttributesCount++;\n                this.logger.warn(`Span attribute ${name} in span ${this.spanName} was dropped as the number of attributes exceeds the ${this.spanAttributeLimits.attributeCountLimit} attribute limit set by attributeCountLimit.`);\n                return;\n            }\n            if (name.length > ATTRIBUTE_KEY_LENGTH_LIMIT) {\n                this._droppedAttributesCount++;\n                this.logger.warn(`Span attribute ${name} in span ${this.spanName} was dropped as the key length exceeds the ${ATTRIBUTE_KEY_LENGTH_LIMIT} character fixed limit.`);\n                return;\n            }\n            this.attributes.set(name, value);\n        }\n    }\n    remove(name) {\n        this.attributes.delete(name);\n    }\n    toJson() {\n        Array.from(this.attributes).forEach(([key, value]) => { this.truncateAttribute(key, value); });\n        return Array.from(this.attributes)\n            .map(([key, value]) => attributeToJson(key, value))\n            .filter(attr => attr !== undefined);\n    }\n    toObject() {\n        return Object.fromEntries(this.attributes);\n    }\n}\nclass ResourceAttributes extends SpanAttributes {\n    constructor(releaseStage, appVersion, serviceName, sdkName, sdkVersion, logger) {\n        const initialValues = new Map([\n            ['deployment.environment', releaseStage],\n            ['telemetry.sdk.name', sdkName],\n            ['telemetry.sdk.version', sdkVersion],\n            ['service.name', serviceName]\n        ]);\n        if (appVersion.length > 0) {\n            initialValues.set('service.version', appVersion);\n        }\n        // TODO: this class should be refactored to use a common base class instead of SpanAttributes\n        // since we don't need a span name and logger for resource attributes - see PLAT-12820\n        super(initialValues, defaultResourceAttributeLimits, 'resource-attributes', logger);\n    }\n}\nfunction getJsonAttributeValue(value) {\n    switch (typeof value) {\n        case 'number':\n            if (Number.isNaN(value) || !Number.isFinite(value)) {\n                return undefined;\n            }\n            if (Number.isInteger(value)) {\n                return { intValue: `${value}` };\n            }\n            return { doubleValue: value };\n        case 'boolean':\n            return { boolValue: value };\n        case 'string':\n            return { stringValue: value };\n    }\n}\nfunction getJsonArrayAttributeValue(attributeArray) {\n    return attributeArray\n        .map((value) => getJsonAttributeValue(value))\n        .filter(value => typeof value !== 'undefined');\n}\n/**\n * Converts a span attribute into an OTEL compliant value i.e. { stringValue: 'value' }\n * @param key the name of the span attribute\n * @param attribute the value of the attribute. Can be of type string | number | boolean | string[] | number[] | boolean[]. Invalid types will be removed from array attributes.\n * @returns\n */\nfunction attributeToJson(key, attribute) {\n    switch (typeof attribute) {\n        case 'number':\n            if (Number.isNaN(attribute) || !Number.isFinite(attribute)) {\n                return undefined;\n            }\n            // 'bugsnag.sampling.p' must always be sent as a doubleValue\n            if (key !== 'bugsnag.sampling.p' && Number.isInteger(attribute)) {\n                return { key, value: { intValue: `${attribute}` } };\n            }\n            return { key, value: { doubleValue: attribute } };\n        case 'boolean':\n            return { key, value: { boolValue: attribute } };\n        case 'string':\n            return { key, value: { stringValue: attribute } };\n        case 'object':\n            if (Array.isArray(attribute)) {\n                const arrayValues = getJsonArrayAttributeValue(attribute);\n                return { key, value: { arrayValue: arrayValues.length > 0 ? { values: arrayValues } : {} } };\n            }\n            return undefined;\n        default:\n            return undefined;\n    }\n}\n\nexport { ResourceAttributes, SpanAttributes, attributeToJson };\n","const NANOSECONDS_IN_MILLISECONDS = 1000000;\nfunction millisecondsToNanoseconds(milliseconds) {\n    return Math.round(milliseconds * NANOSECONDS_IN_MILLISECONDS);\n}\n\nexport { millisecondsToNanoseconds };\n","import { ATTRIBUTE_STRING_VALUE_LIMIT_DEFAULT, ATTRIBUTE_STRING_VALUE_LIMIT_MAX, ATTRIBUTE_ARRAY_LENGTH_LIMIT_DEFAULT, ATTRIBUTE_ARRAY_LENGTH_LIMIT_MAX, ATTRIBUTE_COUNT_LIMIT_DEFAULT, ATTRIBUTE_COUNT_LIMIT_MAX } from './custom-attribute-limits.js';\nimport { isStringWithLength, isString, isLogger, isStringArray, isPluginArray, isObject, isNumber, isCallbackArray } from './validation.js';\n\nconst schema = {\n    appVersion: {\n        defaultValue: '',\n        message: 'should be a string',\n        validate: isStringWithLength\n    },\n    endpoint: {\n        defaultValue: 'https://otlp.bugsnag.com/v1/traces',\n        message: 'should be a string',\n        validate: isStringWithLength\n    },\n    apiKey: {\n        defaultValue: '',\n        message: 'should be a 32 character hexadecimal string',\n        validate: (value) => isString(value) && /^[a-f0-9]{32}$/.test(value)\n    },\n    logger: {\n        defaultValue: {\n            debug(message) { console.debug(message); },\n            info(message) { console.info(message); },\n            warn(message) { console.warn(message); },\n            error(message) { console.error(message); }\n        },\n        message: 'should be a Logger object',\n        validate: isLogger\n    },\n    releaseStage: {\n        defaultValue: 'production',\n        message: 'should be a string',\n        validate: isStringWithLength\n    },\n    enabledReleaseStages: {\n        defaultValue: null,\n        message: 'should be an array of strings',\n        validate: (value) => value === null || isStringArray(value)\n    },\n    plugins: {\n        defaultValue: [],\n        message: 'should be an array of plugin objects',\n        validate: isPluginArray\n    },\n    bugsnag: {\n        defaultValue: undefined,\n        message: 'should be an instance of Bugsnag',\n        validate: (value) => isObject(value) && typeof value.addOnError === 'function'\n    },\n    samplingProbability: {\n        defaultValue: undefined,\n        message: 'should be a number between 0 and 1',\n        validate: (value) => value === undefined || (isNumber(value) && value >= 0 && value <= 1)\n    },\n    onSpanStart: {\n        defaultValue: undefined,\n        message: 'should be an array of functions',\n        validate: isCallbackArray\n    },\n    onSpanEnd: {\n        defaultValue: undefined,\n        message: 'should be an array of functions',\n        validate: isCallbackArray\n    },\n    attributeStringValueLimit: {\n        defaultValue: ATTRIBUTE_STRING_VALUE_LIMIT_DEFAULT,\n        message: `should be a number between 1 and ${ATTRIBUTE_STRING_VALUE_LIMIT_MAX}`,\n        validate: (value) => isNumber(value) && value > 0 && value <= ATTRIBUTE_STRING_VALUE_LIMIT_MAX\n    },\n    attributeArrayLengthLimit: {\n        defaultValue: ATTRIBUTE_ARRAY_LENGTH_LIMIT_DEFAULT,\n        message: `should be a number between 1 and ${ATTRIBUTE_ARRAY_LENGTH_LIMIT_MAX}`,\n        validate: (value) => isNumber(value) && value > 0 && value <= ATTRIBUTE_ARRAY_LENGTH_LIMIT_MAX\n    },\n    attributeCountLimit: {\n        defaultValue: ATTRIBUTE_COUNT_LIMIT_DEFAULT,\n        message: `should be a number between 1 and ${ATTRIBUTE_COUNT_LIMIT_MAX}`,\n        validate: (value) => isNumber(value) && value > 0 && value <= ATTRIBUTE_COUNT_LIMIT_MAX\n    }\n};\nfunction validateConfig(config, schema, isDevelopment = false) {\n    if (typeof config === 'string') {\n        config = { apiKey: config };\n    }\n    if (!isObject(config) || !isString(config.apiKey) || config.apiKey.length === 0) {\n        throw new Error('No Bugsnag API Key set');\n    }\n    let warnings = '';\n    const cleanConfiguration = {};\n    for (const option of Object.keys(schema)) {\n        if (Object.prototype.hasOwnProperty.call(config, option)) {\n            if (schema[option].validate(config[option])) {\n                cleanConfiguration[option] = config[option];\n            }\n            else {\n                warnings += `\\n  - ${option} ${schema[option].message}, got ${typeof config[option]}`;\n                cleanConfiguration[option] = schema[option].defaultValue;\n            }\n        }\n        else {\n            cleanConfiguration[option] = schema[option].defaultValue;\n        }\n    }\n    // Set default batch time based on release stage\n    const defaultBatchTime = isDevelopment ? 5 * 1000 : 30 * 1000;\n    // If apiKey is set but not valid we should still use it, despite the validation warning.\n    cleanConfiguration.apiKey = config.apiKey;\n    cleanConfiguration.maximumBatchSize = config.maximumBatchSize || 100;\n    cleanConfiguration.batchInactivityTimeoutMs = config.batchInactivityTimeoutMs || defaultBatchTime;\n    if (warnings.length > 0) {\n        cleanConfiguration.logger.warn(`Invalid configuration${warnings}`);\n    }\n    return cleanConfiguration;\n}\n\nexport { schema, validateConfig };\n","class SpanEvents {\n    constructor() {\n        this.events = [];\n    }\n    add(name, time) {\n        this.events.push({ name, time });\n    }\n    toJson(clock) {\n        return this.events.map(({ name, time }) => ({ name, timeUnixNano: clock.toUnixTimestampNanoseconds(time) }));\n    }\n}\n\nexport { SpanEvents };\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// taken from OpenTelemetry's TraceIdRatioBasedSampler:\n// https://github.com/open-telemetry/opentelemetry-js/blob/ca700c4eef64c14bb5fef2be6f08ace7973a8881/packages/opentelemetry-sdk-trace-base/src/sampler/TraceIdRatioBasedSampler.ts#L47-L55\n// with some small modifications to match our naming conventions\nfunction traceIdToSamplingRate(traceId) {\n    let samplingRate = 0;\n    for (let i = 0; i < traceId.length / 8; i++) {\n        const position = i * 8;\n        const segment = Number.parseInt(traceId.slice(position, position + 8), 16);\n        samplingRate = (samplingRate ^ segment) >>> 0;\n    }\n    return samplingRate;\n}\n\nexport { traceIdToSamplingRate as default };\n","import { millisecondsToNanoseconds } from './clock.js';\nimport { SpanEvents } from './events.js';\nimport traceIdToSamplingRate from './trace-id-to-sampling-rate.js';\nimport { isTime, isParentContext, isBoolean } from './validation.js';\n\nconst HOUR_IN_MILLISECONDS = 60 * 60 * 1000;\nfunction spanToJson(span, clock) {\n    return {\n        name: span.name,\n        kind: span.kind,\n        spanId: span.id,\n        traceId: span.traceId,\n        parentSpanId: span.parentSpanId,\n        ...(span.attributes.droppedAttributesCount > 0 ? { droppedAttributesCount: span.attributes.droppedAttributesCount } : {}),\n        startTimeUnixNano: clock.toUnixTimestampNanoseconds(span.startTime),\n        endTimeUnixNano: clock.toUnixTimestampNanoseconds(span.endTime),\n        attributes: span.attributes.toJson(),\n        events: span.events.toJson(clock)\n    };\n}\nfunction spanEndedToSpan(span) {\n    return {\n        get id() {\n            return span.id;\n        },\n        get traceId() {\n            return span.traceId;\n        },\n        get samplingRate() {\n            return span.samplingRate;\n        },\n        get samplingProbability() {\n            return span.samplingProbability.raw;\n        },\n        get name() {\n            return span.name;\n        },\n        isValid: () => false,\n        end: () => { }, // no-op\n        setAttribute: (name, value) => { span.attributes.setCustom(name, value); }\n    };\n}\nasync function runSpanEndCallbacks(spanEnded, logger, callbacks) {\n    if (!callbacks || callbacks.length === 0)\n        return true;\n    const span = spanEndedToSpan(spanEnded);\n    const callbackStartTime = performance.now();\n    let shouldSample = true;\n    for (const callback of callbacks) {\n        try {\n            let result = callback(span);\n            // @ts-expect-error result may or may not be a promise\n            if (typeof result.then === 'function') {\n                result = await result;\n            }\n            if (result === false) {\n                shouldSample = false;\n                break;\n            }\n        }\n        catch (err) {\n            logger.error('Error in onSpanEnd callback: ' + err);\n        }\n    }\n    if (shouldSample) {\n        const duration = millisecondsToNanoseconds(performance.now() - callbackStartTime);\n        span.setAttribute('bugsnag.span.callbacks_duration', duration);\n    }\n    return shouldSample;\n}\nclass SpanInternal {\n    constructor(id, traceId, name, startTime, attributes, clock, samplingProbability, parentSpanId) {\n        this.kind = 3 /* Kind.Client */; // TODO: How do we define the initial Kind?\n        this.events = new SpanEvents();\n        this.id = id;\n        this.traceId = traceId;\n        this.parentSpanId = parentSpanId;\n        this.name = name;\n        this.startTime = startTime;\n        this.attributes = attributes;\n        this.samplingRate = traceIdToSamplingRate(this.traceId);\n        this.samplingProbability = samplingProbability;\n        this.clock = clock;\n    }\n    addEvent(name, time) {\n        this.events.add(name, time);\n    }\n    setAttribute(name, value) {\n        this.attributes.set(name, value);\n    }\n    setCustomAttribute(name, value) {\n        this.attributes.setCustom(name, value);\n    }\n    end(endTime, samplingProbability) {\n        this.endTime = endTime;\n        let _samplingProbability = samplingProbability;\n        this.attributes.set('bugsnag.sampling.p', _samplingProbability.raw);\n        return {\n            id: this.id,\n            name: this.name,\n            kind: this.kind,\n            traceId: this.traceId,\n            startTime: this.startTime,\n            attributes: this.attributes,\n            events: this.events,\n            samplingRate: this.samplingRate,\n            endTime,\n            get samplingProbability() {\n                return _samplingProbability;\n            },\n            set samplingProbability(samplingProbability) {\n                _samplingProbability = samplingProbability;\n                this.attributes.set('bugsnag.sampling.p', _samplingProbability.raw);\n            },\n            parentSpanId: this.parentSpanId\n        };\n    }\n    isValid() {\n        return this.endTime === undefined && this.startTime > (this.clock.now() - HOUR_IN_MILLISECONDS);\n    }\n}\nconst coreSpanOptionSchema = {\n    startTime: {\n        message: 'should be a number or Date',\n        getDefaultValue: () => undefined,\n        validate: isTime\n    },\n    parentContext: {\n        message: 'should be a ParentContext',\n        getDefaultValue: () => undefined,\n        validate: (value) => value === null || isParentContext(value)\n    },\n    makeCurrentContext: {\n        message: 'should be true|false',\n        getDefaultValue: () => undefined,\n        validate: isBoolean\n    },\n    isFirstClass: {\n        message: 'should be true|false',\n        getDefaultValue: () => undefined,\n        validate: isBoolean\n    }\n};\n\nexport { SpanInternal, coreSpanOptionSchema, runSpanEndCallbacks, spanEndedToSpan, spanToJson };\n","import { runSpanEndCallbacks } from './span.js';\n\nclass BatchProcessor {\n    constructor(delivery, configuration, retryQueue, sampler, probabilityManager, encoder) {\n        this.spans = [];\n        this.timeout = null;\n        this.flushQueue = Promise.resolve();\n        this.delivery = delivery;\n        this.configuration = configuration;\n        this.retryQueue = retryQueue;\n        this.sampler = sampler;\n        this.probabilityManager = probabilityManager;\n        this.encoder = encoder;\n        this.flush = this.flush.bind(this);\n    }\n    stop() {\n        if (this.timeout !== null) {\n            clearTimeout(this.timeout);\n            this.timeout = null;\n        }\n    }\n    start() {\n        this.stop();\n        this.timeout = setTimeout(this.flush, this.configuration.batchInactivityTimeoutMs);\n    }\n    add(span) {\n        if (this.configuration.enabledReleaseStages &&\n            !this.configuration.enabledReleaseStages.includes(this.configuration.releaseStage)) {\n            return;\n        }\n        this.spans.push(span);\n        if (this.spans.length >= this.configuration.maximumBatchSize) {\n            this.flush();\n        }\n        else {\n            this.start();\n        }\n    }\n    async flush() {\n        this.stop();\n        this.flushQueue = this.flushQueue.then(async () => {\n            const batch = await this.prepareBatch();\n            // we either had nothing in the batch originally or all spans were discarded\n            if (!batch) {\n                return;\n            }\n            const payload = await this.encoder.encode(batch);\n            const batchTime = Date.now();\n            try {\n                const response = await this.delivery.send(payload);\n                if (response.samplingProbability !== undefined) {\n                    this.probabilityManager.setProbability(response.samplingProbability);\n                }\n                switch (response.state) {\n                    case 'success':\n                        this.retryQueue.flush();\n                        break;\n                    case 'failure-discard':\n                        this.configuration.logger.warn('delivery failed');\n                        break;\n                    case 'failure-retryable':\n                        this.configuration.logger.info('delivery failed, adding to retry queue');\n                        this.retryQueue.add(payload, batchTime);\n                        break;\n                    default:\n                        response.state;\n                }\n            }\n            catch (err) {\n                this.configuration.logger.warn('delivery failed');\n            }\n        });\n        await this.flushQueue;\n    }\n    async prepareBatch() {\n        if (this.spans.length === 0) {\n            return;\n        }\n        // ensure we have a fresh probability value before building the batch\n        await this.probabilityManager.ensureFreshProbability();\n        // update sampling values if necessary and re-sample\n        const batch = [];\n        const probability = this.sampler.spanProbability;\n        for (const span of this.spans) {\n            if (span.samplingProbability.raw > probability.raw) {\n                span.samplingProbability = probability;\n            }\n            if (this.sampler.sample(span)) {\n                // Run any callbacks that have been registered before batching\n                // as callbacks could cause the span to be discarded\n                const shouldAddToBatch = await runSpanEndCallbacks(span, this.configuration.logger, this.configuration.onSpanEnd);\n                if (shouldAddToBatch)\n                    batch.push(span);\n            }\n        }\n        // clear out the current batch so we're ready to start a new one\n        this.spans = [];\n        // if every span was discarded there's nothing to send\n        if (batch.length === 0) {\n            return;\n        }\n        return batch;\n    }\n}\n\nexport { BatchProcessor };\n","import { spanToJson } from './span.js';\n\nclass TracePayloadEncoder {\n    constructor(clock, configuration, resourceAttributeSource) {\n        this.clock = clock;\n        this.configuration = configuration;\n        this.resourceAttributeSource = resourceAttributeSource;\n    }\n    async encode(spans) {\n        const resourceAttributes = await this.resourceAttributeSource(this.configuration);\n        const jsonSpans = Array(spans.length);\n        for (let i = 0; i < spans.length; ++i) {\n            jsonSpans[i] = spanToJson(spans[i], this.clock);\n        }\n        const deliveryPayload = {\n            resourceSpans: [\n                {\n                    resource: { attributes: resourceAttributes.toJson() },\n                    scopeSpans: [{ spans: jsonSpans }]\n                }\n            ]\n        };\n        return {\n            body: deliveryPayload,\n            headers: {\n                'Bugsnag-Api-Key': this.configuration.apiKey,\n                'Content-Type': 'application/json',\n                // Do not set 'Bugsnag-Span-Sampling' if the SDK is configured with samplingProbability\n                ...(this.configuration.samplingProbability !== undefined ? {} : { 'Bugsnag-Span-Sampling': this.generateSamplingHeader(spans) })\n            }\n        };\n    }\n    generateSamplingHeader(spans) {\n        if (spans.length === 0) {\n            return '1:0';\n        }\n        const spanCounts = Object.create(null);\n        for (const span of spans) {\n            const existingValue = spanCounts[span.samplingProbability.raw] || 0;\n            spanCounts[span.samplingProbability.raw] = existingValue + 1;\n        }\n        const rawProbabilities = Object.keys(spanCounts);\n        const pairs = Array(rawProbabilities.length);\n        for (let i = 0; i < rawProbabilities.length; ++i) {\n            const rawProbability = rawProbabilities[i];\n            pairs[i] = `${rawProbability}:${spanCounts[rawProbability]}`;\n        }\n        return pairs.join(';');\n    }\n}\nconst retryCodes = new Set([402, 407, 408, 429]);\nfunction responseStateFromStatusCode(statusCode) {\n    if (statusCode >= 200 && statusCode < 300) {\n        return 'success';\n    }\n    if (statusCode >= 400 && statusCode < 500 && !retryCodes.has(statusCode)) {\n        return 'failure-discard';\n    }\n    return 'failure-retryable';\n}\n\nexport { TracePayloadEncoder, responseStateFromStatusCode };\n","class FixedProbabilityManager {\n    static async create(sampler, samplingProbability) {\n        sampler.probability = samplingProbability;\n        return new FixedProbabilityManager(sampler, samplingProbability);\n    }\n    constructor(sampler, samplingProbability) {\n        this.sampler = sampler;\n        this.samplingProbability = samplingProbability;\n    }\n    setProbability(newProbability) {\n        return Promise.resolve();\n    }\n    ensureFreshProbability() {\n        return Promise.resolve();\n    }\n}\n\nexport { FixedProbabilityManager as default };\n","const Priority = {\n    LOW: 0,\n    NORMAL: 50000,\n    HIGH: 100000\n};\nclass PrioritizedSet {\n    constructor(initialItems) {\n        this.items = [];\n        if (initialItems) {\n            this.items = initialItems;\n            this.sort();\n        }\n    }\n    add(item, priority) {\n        if (this.items.some(i => i.item === item)) {\n            return false;\n        }\n        this.items.push({ item, priority });\n        this.sort();\n        return true;\n    }\n    addAll(items) {\n        let added = false;\n        for (const item of items) {\n            if (!this.items.some(i => i.item === item.item)) {\n                this.items.push(item);\n                added = true;\n            }\n        }\n        if (added) {\n            this.sort();\n        }\n        return added;\n    }\n    *[Symbol.iterator]() {\n        for (const item of this.items) {\n            yield item.item;\n        }\n    }\n    sort() {\n        this.items.sort((a, b) => b.priority - a.priority);\n    }\n}\n\nexport { Priority, PrioritizedSet as default };\n","import { Priority } from './prioritized-set.js';\n\nclass PluginContext {\n    constructor(configuration, clock) {\n        this.configuration = configuration;\n        this.clock = clock;\n        this.onSpanStartCallbacks = [];\n        this.onSpanEndCallbacks = [];\n        this.spanControlProviders = [];\n    }\n    addOnSpanStartCallback(callback, priority = Priority.NORMAL) {\n        this.onSpanStartCallbacks.push({ item: callback, priority });\n    }\n    addOnSpanEndCallback(callback, priority = Priority.NORMAL) {\n        this.onSpanEndCallbacks.push({ item: callback, priority });\n    }\n    addSpanControlProvider(provider, priority = Priority.NORMAL) {\n        this.spanControlProviders.push({ item: provider, priority });\n    }\n    mergeFrom(context) {\n        this.onSpanStartCallbacks.push(...context.onSpanStartCallbacks);\n        this.onSpanEndCallbacks.push(...context.onSpanEndCallbacks);\n        this.spanControlProviders.push(...context.spanControlProviders);\n    }\n}\nclass PluginManager {\n    constructor() {\n        this.plugins = [];\n        this.installedPlugins = new Set();\n    }\n    addPlugins(plugins) {\n        this.plugins.push(...plugins);\n    }\n    installPlugins(configuration, clock) {\n        this.logger = configuration.logger;\n        const mergedContext = new PluginContext(configuration, clock);\n        for (const plugin of this.plugins) {\n            if (this.installedPlugins.has(plugin)) {\n                continue;\n            }\n            try {\n                const context = new PluginContext(configuration, clock);\n                plugin.install(context);\n                mergedContext.mergeFrom(context);\n                this.installedPlugins.add(plugin);\n            }\n            catch (err) {\n                if (this.logger)\n                    this.logger.error(`Plugin ${plugin.constructor.name} failed to install: ${err}`);\n            }\n        }\n        return mergedContext;\n    }\n    startPlugins() {\n        for (const plugin of this.installedPlugins) {\n            try {\n                plugin.start();\n            }\n            catch (err) {\n                if (this.logger)\n                    this.logger.error(`Plugin ${plugin.constructor.name} failed to start: ${err}`);\n            }\n        }\n    }\n    getPlugin(Constructor) {\n        for (const plugin of this.installedPlugins) {\n            if (plugin instanceof Constructor) {\n                return plugin;\n            }\n        }\n    }\n}\n\nexport { PluginContext, PluginManager };\n","// the time to wait before retrying a failed request\nconst RETRY_MILLISECONDS = 30 * 1000;\nclass ProbabilityFetcher {\n    constructor(delivery, apiKey) {\n        this.delivery = delivery;\n        this.payload = {\n            body: { resourceSpans: [] },\n            headers: {\n                'Bugsnag-Api-Key': apiKey,\n                'Content-Type': 'application/json',\n                'Bugsnag-Span-Sampling': '1.0:0'\n            }\n        };\n    }\n    async getNewProbability() {\n        // keep making requests until we get a new probability value from the server\n        while (true) {\n            const response = await this.delivery.send(this.payload);\n            // in theory this should always be present, but it's possible the request\n            // fails or there's a bug on the server side causing it not to be returned\n            if (response.samplingProbability !== undefined) {\n                return response.samplingProbability;\n            }\n            await this.timeBetweenRetries();\n        }\n    }\n    timeBetweenRetries() {\n        return new Promise(resolve => {\n            setTimeout(resolve, RETRY_MILLISECONDS);\n        });\n    }\n}\n\nexport { ProbabilityFetcher as default };\n","// the time between requests to fetch a new probability value from the server\nconst PROBABILITY_REFRESH_MILLISECONDS = 24 * 60 * 60 * 1000; // 24 hours\nclass ProbabilityManager {\n    static async create(persistence, sampler, probabilityFetcher) {\n        const persistedProbability = await persistence.load('bugsnag-sampling-probability');\n        let initialProbabilityTime;\n        if (persistedProbability === undefined) {\n            // If there is no stored probability:\n            // - Set the initial probability value to the default\n            // - Immediately fetch a new probability value\n            sampler.probability = 1.0;\n            initialProbabilityTime = 0;\n        }\n        else if (persistedProbability.time < Date.now() - PROBABILITY_REFRESH_MILLISECONDS) {\n            // If it is >= 24 hours old:\n            // - Set the initial probability value to the stored value\n            // - Immediately fetch a new probability value\n            sampler.probability = persistedProbability.value;\n            initialProbabilityTime = persistedProbability.time;\n        }\n        else {\n            // If it is < 24 hours old:\n            // - Use the stored probability\n            // - Fetch a new probability when this value would be 24 hours old\n            sampler.probability = persistedProbability.value;\n            initialProbabilityTime = persistedProbability.time;\n        }\n        return new ProbabilityManager(persistence, sampler, probabilityFetcher, initialProbabilityTime);\n    }\n    constructor(persistence, sampler, probabilityFetcher, initialProbabilityTime) {\n        this.outstandingFreshnessCheck = undefined;\n        this.persistence = persistence;\n        this.sampler = sampler;\n        this.probabilityFetcher = probabilityFetcher;\n        this.lastProbabilityTime = initialProbabilityTime;\n        this.ensureFreshProbability();\n    }\n    setProbability(newProbability) {\n        this.lastProbabilityTime = Date.now();\n        this.sampler.probability = newProbability;\n        // return this promise for convience in unit tests as it allows us to wait\n        // for persistence to finish; in real code we won't ever wait for this but\n        // there's no harm in returning it anyway\n        return this.persistence.save('bugsnag-sampling-probability', {\n            value: newProbability,\n            time: this.lastProbabilityTime\n        });\n    }\n    /**\n     * Ensure that the current probability value is fresh, i.e. it is less than 24\n     * hours old\n     *\n     * If the probability value is stale then this method will fetch a fresh one\n     *\n     * This method is idempotent; calling it while there is already an outstanding\n     * probability request will not create a second request\n     */\n    ensureFreshProbability() {\n        // we're already fetching a new probability\n        if (this.outstandingFreshnessCheck) {\n            return this.outstandingFreshnessCheck;\n        }\n        // if the probability value is >= 24 hours old, fetch a new one\n        if (Date.now() - this.lastProbabilityTime >= PROBABILITY_REFRESH_MILLISECONDS) {\n            this.outstandingFreshnessCheck = this.probabilityFetcher.getNewProbability()\n                .then(probability => {\n                this.setProbability(probability);\n                this.outstandingFreshnessCheck = undefined;\n            });\n            return this.outstandingFreshnessCheck;\n        }\n        return Promise.resolve();\n    }\n}\n\nexport { ProbabilityManager as default };\n","// a processor that buffers spans in memory until the client has started\n// not sure if this would need to be platform specific â€” will we ever care about\n// persisting spans if 'start' is never called?\nclass BufferingProcessor {\n    constructor() {\n        this.spans = [];\n    }\n    add(span) {\n        this.spans.push(span);\n    }\n}\n\nexport { BufferingProcessor };\n","// sampling rates are stored as a number between 0 and 2^32 - 1 (i.e. they are\n// u32s) so we need to scale the probability value to match this range as they\n// are stored as values between 0 and 1\nfunction scaleProbabilityToMatchSamplingRate(probability) {\n    return Math.floor(probability * 0xffffffff);\n}\nclass Sampler {\n    constructor(initialProbability) {\n        // we could just do 'this.probability = initialProbability' but TypeScript\n        // doesn't like that as it doesn't directly initialise these properties in\n        // the constructor\n        this._probability = initialProbability;\n        this.scaledProbability = scaleProbabilityToMatchSamplingRate(initialProbability);\n    }\n    /**\n     * The global probability value: a number between 0 & 1\n     */\n    get probability() {\n        return this._probability;\n    }\n    set probability(probability) {\n        this._probability = probability;\n        this.scaledProbability = scaleProbabilityToMatchSamplingRate(probability);\n    }\n    /**\n     * The probability value for spans: a number between 0 & 2^32 - 1\n     *\n     * This is necessary because span sampling rates are generated as unsigned 32\n     * bit integers. We scale the global probability value to match that range, so\n     * that we can use a simple calculation in 'sample'\n     *\n     * @see scaleProbabilityToMatchSamplingRate\n     */\n    get spanProbability() {\n        return {\n            raw: this._probability,\n            scaled: this.scaledProbability\n        };\n    }\n    sample(span) {\n        return span.samplingRate <= span.samplingProbability.scaled;\n    }\n    shouldSample(samplingRate) {\n        return samplingRate <= this.spanProbability.scaled;\n    }\n}\n\nexport { Sampler as default, scaleProbabilityToMatchSamplingRate };\n","function spanContextEquals(span1, span2) {\n    if (span1 === span2)\n        return true;\n    if (span1 !== undefined && span2 !== undefined) {\n        return span1.id === span2.id && span1.traceId === span2.traceId;\n    }\n    return false;\n}\nclass DefaultSpanContextStorage {\n    constructor(backgroundingListener, contextStack = []) {\n        this.isInForeground = true;\n        this.onBackgroundStateChange = (state) => {\n            this.isInForeground = state === 'in-foreground';\n            // clear the context stack regardless of the new background state\n            // since spans are only valid if they start and end while the app is in the foreground\n            this.contextStack.length = 0;\n        };\n        this.contextStack = contextStack;\n        backgroundingListener.onStateChange(this.onBackgroundStateChange);\n    }\n    *[Symbol.iterator]() {\n        for (let i = this.contextStack.length - 1; i >= 0; --i) {\n            yield this.contextStack[i];\n        }\n    }\n    push(context) {\n        if (context.isValid() && this.isInForeground) {\n            this.contextStack.push(context);\n        }\n    }\n    pop(context) {\n        if (spanContextEquals(context, this.current)) {\n            this.contextStack.pop();\n        }\n        this.removeClosedContexts();\n    }\n    get first() {\n        this.removeClosedContexts();\n        return this.contextStack.length > 0\n            ? this.contextStack[0]\n            : undefined;\n    }\n    get current() {\n        this.removeClosedContexts();\n        return this.contextStack.length > 0\n            ? this.contextStack[this.contextStack.length - 1]\n            : undefined;\n    }\n    removeClosedContexts() {\n        while (this.contextStack.length > 0 &&\n            this.contextStack[this.contextStack.length - 1].isValid() === false) {\n            this.contextStack.pop();\n        }\n    }\n}\n\nexport { DefaultSpanContextStorage, spanContextEquals };\n","import PrioritizedSet from './prioritized-set.js';\n\n// base class for classes that can be used with SpanControlProvider, where S represents\n// the type of span control that the query will retrieve. Using an abstract class\n// allows providers to verify query types at runtime using instanceof checks.\nclass SpanQuery {\n}\nclass CompositeSpanControlProvider {\n    constructor() {\n        this.providers = new PrioritizedSet();\n    }\n    addProvider(provider, priority) {\n        this.providers.add(provider, priority);\n    }\n    addProviders(providers) {\n        this.providers.addAll(providers);\n    }\n    getSpanControls(query) {\n        for (const provider of this.providers) {\n            const spanControl = provider.getSpanControls(query);\n            if (spanControl) {\n                return spanControl;\n            }\n        }\n        return null;\n    }\n}\n\nexport { CompositeSpanControlProvider, SpanQuery };\n","import { isNumber } from './validation.js';\n\nfunction timeToNumber(clock, time) {\n    if (isNumber(time)) {\n        // no need to change anything - we want to store numbers anyway\n        // we assume this is nanosecond precision\n        return time;\n    }\n    if (time instanceof Date) {\n        return clock.convert(time);\n    }\n    return clock.now();\n}\n\nexport { timeToNumber };\n","import { SpanAttributes } from './attributes.js';\nimport { defaultSpanAttributeLimits } from './custom-attribute-limits.js';\nimport { SpanInternal, coreSpanOptionSchema } from './span.js';\nimport { timeToNumber } from './time.js';\nimport { isParentContext, isObject } from './validation.js';\n\nconst DISCARD_END_TIME = -1;\nclass SpanFactory {\n    constructor(processor, sampler, idGenerator, spanAttributesSource, clock, backgroundingListener, logger, spanContextStorage) {\n        this.spanAttributeLimits = defaultSpanAttributeLimits;\n        this.openSpans = new WeakSet();\n        this.isInForeground = true;\n        this.onBackgroundStateChange = (state) => {\n            this.isInForeground = state === 'in-foreground';\n            // clear all open spans regardless of the new background state\n            // since spans are only valid if they start and end while the app is in the foreground\n            this.openSpans = new WeakSet();\n        };\n        this.processor = processor;\n        this.sampler = sampler;\n        this.idGenerator = idGenerator;\n        this.spanAttributesSource = spanAttributesSource;\n        this.clock = clock;\n        this.logger = logger;\n        this.spanContextStorage = spanContextStorage;\n        // this will fire immediately if the app is already backgrounded\n        backgroundingListener.onStateChange(this.onBackgroundStateChange);\n    }\n    startSpan(name, options) {\n        // if the parentContext option is not set use the current context\n        // if parentContext is explicitly null, or there is no current context,\n        // we are starting a new root span\n        options.parentContext = isParentContext(options.parentContext) || options.parentContext === null\n            ? options.parentContext\n            : this.spanContextStorage.current;\n        const attributes = new SpanAttributes(new Map(), this.spanAttributeLimits, name, this.logger);\n        if (typeof options.isFirstClass === 'boolean') {\n            attributes.set('bugsnag.span.first_class', options.isFirstClass);\n        }\n        const span = this.createSpanInternal(name, options, attributes);\n        // don't track spans that are started while the app is backgrounded\n        if (this.isInForeground) {\n            this.openSpans.add(span);\n            if (options.makeCurrentContext !== false) {\n                this.spanContextStorage.push(span);\n            }\n        }\n        this.onSpanStart(span);\n        return span;\n    }\n    onSpanStart(spanInternal) {\n        if (this.onSpanStartCallbacks) {\n            const span = this.toPublicApi(spanInternal);\n            for (const onSpanStart of this.onSpanStartCallbacks) {\n                try {\n                    onSpanStart(span);\n                }\n                catch (err) {\n                    this.logger.error('Error in onSpanStart callback: ' + err);\n                }\n            }\n        }\n    }\n    createSpanInternal(name, options, attributes) {\n        const safeStartTime = timeToNumber(this.clock, options.startTime);\n        const spanId = this.idGenerator.generate(64);\n        const parentSpanId = options.parentContext ? options.parentContext.id : undefined;\n        const traceId = options.parentContext ? options.parentContext.traceId : this.idGenerator.generate(128);\n        return new SpanInternal(spanId, traceId, name, safeStartTime, attributes, this.clock, this.sampler.probability, parentSpanId);\n    }\n    startNetworkSpan(options) {\n        const spanName = `[HTTP/${options.method.toUpperCase()}]`;\n        const cleanOptions = this.validateSpanOptions(spanName, options);\n        const spanInternal = this.startSpan(cleanOptions.name, { ...cleanOptions.options, makeCurrentContext: false });\n        spanInternal.setAttribute('bugsnag.span.category', 'network');\n        spanInternal.setAttribute('http.method', options.method);\n        spanInternal.setAttribute('http.url', options.url);\n        return spanInternal;\n    }\n    configure(configuration) {\n        this.logger = configuration.logger;\n        this.spanAttributesSource.configure(configuration);\n        this.spanAttributeLimits = {\n            attributeArrayLengthLimit: configuration.attributeArrayLengthLimit,\n            attributeCountLimit: configuration.attributeCountLimit,\n            attributeStringValueLimit: configuration.attributeStringValueLimit\n        };\n        this.onSpanStartCallbacks = configuration.onSpanStart;\n        this.onSpanEndCallbacks = configuration.onSpanEnd;\n    }\n    reprocessEarlySpans(batchProcessor) {\n        // ensure all spans in the buffering processor are added to the batch\n        for (const span of this.processor.spans) {\n            batchProcessor.add(span);\n        }\n        this.processor = batchProcessor;\n    }\n    endSpan(span, endTime, additionalAttributes) {\n        // remove the span from the context stack (this will also remove any invalid spans)\n        this.spanContextStorage.pop(span);\n        const untracked = !this.openSpans.delete(span);\n        const isValidSpan = span.isValid();\n        // log a warning if the span is already invalid and is not being tracked\n        if (untracked && !isValidSpan) {\n            this.logger.warn('Attempted to end a Span which is no longer valid.');\n        }\n        // spans should be discarded if:\n        // - they are not tracked (i.e. discarded due to backgrounding)\n        // - they are already invalid\n        // - they have an explicit discard end time\n        if (untracked || !isValidSpan || endTime === DISCARD_END_TIME) {\n            this.discardSpan(span);\n            return;\n        }\n        // Set any additional attributes\n        for (const [key, value] of Object.entries(additionalAttributes || {})) {\n            span.setAttribute(key, value);\n        }\n        this.spanAttributesSource.requestAttributes(span);\n        this.sendForProcessing(span, endTime);\n    }\n    discardSpan(span) {\n        // we still call end on the span so that it is no longer considered valid\n        span.end(DISCARD_END_TIME, this.sampler.spanProbability);\n    }\n    sendForProcessing(span, endTime) {\n        const spanEnded = span.end(endTime, this.sampler.spanProbability);\n        if (this.sampler.sample(spanEnded)) {\n            this.processor.add(spanEnded);\n        }\n    }\n    toPublicApi(span) {\n        return {\n            get id() {\n                return span.id;\n            },\n            get traceId() {\n                return span.traceId;\n            },\n            get samplingRate() {\n                return span.samplingRate;\n            },\n            get samplingProbability() {\n                return span.samplingProbability;\n            },\n            get name() {\n                return span.name;\n            },\n            isValid: () => span.isValid(),\n            setAttribute: (name, value) => {\n                span.setCustomAttribute(name, value);\n            },\n            end: (endTime) => {\n                const safeEndTime = timeToNumber(this.clock, endTime);\n                this.endSpan(span, safeEndTime);\n            }\n        };\n    }\n    validateSpanOptions(name, options, schema = coreSpanOptionSchema) {\n        let warnings = '';\n        const cleanOptions = {};\n        if (typeof name !== 'string') {\n            warnings += `\\n  - name should be a string, got ${typeof name}`;\n            name = String(name);\n        }\n        if (options !== undefined && !isObject(options)) {\n            warnings += '\\n  - options is not an object';\n        }\n        else {\n            const spanOptions = options || {};\n            for (const option of Object.keys(schema)) {\n                if (Object.prototype.hasOwnProperty.call(spanOptions, option) && spanOptions[option] !== undefined) {\n                    if (schema[option].validate(spanOptions[option])) {\n                        cleanOptions[option] = spanOptions[option];\n                    }\n                    else {\n                        warnings += `\\n  - ${option} ${schema[option].message}, got ${typeof spanOptions[option]}`;\n                        cleanOptions[option] = schema[option].getDefaultValue(spanOptions[option]);\n                    }\n                }\n                else {\n                    cleanOptions[option] = schema[option].getDefaultValue(spanOptions[option]);\n                }\n            }\n        }\n        if (warnings.length > 0) {\n            this.logger.warn(`Invalid span options${warnings}`);\n        }\n        return { name, options: cleanOptions };\n    }\n}\n\nexport { DISCARD_END_TIME, SpanFactory };\n","let appState = 'starting';\nfunction getAppState() {\n    return appState;\n}\nfunction setAppState(newState) {\n    appState = newState;\n}\n\nexport { getAppState, setAppState };\n","import { BatchProcessor } from './batch-processor.js';\nimport { validateConfig, schema } from './config.js';\nimport { TracePayloadEncoder } from './delivery.js';\nimport FixedProbabilityManager from './fixed-probability-manager.js';\nimport { PluginManager } from './plugin.js';\nimport ProbabilityFetcher from './probability-fetcher.js';\nimport ProbabilityManager from './probability-manager.js';\nimport { BufferingProcessor } from './processor.js';\nimport Sampler from './sampler.js';\nimport { DefaultSpanContextStorage } from './span-context.js';\nimport { CompositeSpanControlProvider } from './span-control-provider.js';\nimport { SpanFactory } from './span-factory.js';\nimport { timeToNumber } from './time.js';\nimport { setAppState, getAppState } from './app-state.js';\nimport PrioritizedSet, { Priority } from './prioritized-set.js';\n\nfunction createClient(options) {\n    const HUB_PREFIX = '00000';\n    const HUB_ENDPOINT = 'https://otlp.insighthub.smartbear.com/v1/traces';\n    const bufferingProcessor = new BufferingProcessor();\n    const spanContextStorage = options.spanContextStorage || new DefaultSpanContextStorage(options.backgroundingListener);\n    let logger = options.schema.logger.defaultValue;\n    setAppState('starting');\n    const sampler = new Sampler(1.0);\n    const SpanFactoryClass = options.spanFactory || SpanFactory;\n    const spanFactory = new SpanFactoryClass(bufferingProcessor, sampler, options.idGenerator, options.spanAttributesSource, options.clock, options.backgroundingListener, logger, spanContextStorage);\n    const spanControlProvider = new CompositeSpanControlProvider();\n    const pluginManager = new PluginManager();\n    pluginManager.addPlugins(options.plugins(spanFactory, spanContextStorage));\n    return {\n        start: (config) => {\n            const configuration = validateConfig(config, options.schema, options.isDevelopment);\n            // if using the default endpoint add the API key as a subdomain\n            // e.g. convert URL https://otlp.bugsnag.com/v1/traces to URL https://<project_api_key>.otlp.bugsnag.com/v1/traces\n            if (configuration.endpoint === schema.endpoint.defaultValue) {\n                //     â€¦switch to InsightHub when the apiKey starts with 00000\n                if (configuration.apiKey.startsWith(HUB_PREFIX)) {\n                    configuration.endpoint = HUB_ENDPOINT;\n                }\n                else {\n                    // otherwise keep the default Bugsnag domain, but prefix with the apiKey\n                    configuration.endpoint = configuration.endpoint\n                        .replace('https://', `https://${configuration.apiKey}.`);\n                }\n            }\n            // Correlate errors with span by monkey patching _notify on the error client\n            // and utilizing the setTraceCorrelation method on the event\n            if (configuration.bugsnag && typeof configuration.bugsnag.Event.prototype.setTraceCorrelation === 'function' && configuration.bugsnag.Client) {\n                const originalNotify = configuration.bugsnag.Client.prototype._notify;\n                configuration.bugsnag.Client.prototype._notify = function (...args) {\n                    const currentSpanContext = spanContextStorage.current;\n                    if (currentSpanContext && typeof args[0].setTraceCorrelation === 'function') {\n                        args[0].setTraceCorrelation(currentSpanContext.traceId, currentSpanContext.id);\n                    }\n                    originalNotify.apply(this, args);\n                };\n            }\n            // add any external plugins and install\n            pluginManager.addPlugins(configuration.plugins);\n            const pluginContext = pluginManager.installPlugins(configuration, options.clock);\n            // add span control providers from plugins\n            spanControlProvider.addProviders(pluginContext.spanControlProviders);\n            // create a prioritized set of callbacks for onSpanStart and onSpanEnd\n            const spanStartCallbacks = new PrioritizedSet(pluginContext.onSpanStartCallbacks);\n            const spanEndCallbacks = new PrioritizedSet(pluginContext.onSpanEndCallbacks);\n            // user-defined callbacks have normal priority\n            if (configuration.onSpanStart) {\n                spanStartCallbacks.addAll(configuration.onSpanStart.map(callback => ({ item: callback, priority: Priority.NORMAL })));\n            }\n            if (configuration.onSpanEnd) {\n                spanEndCallbacks.addAll(configuration.onSpanEnd.map(callback => ({ item: callback, priority: Priority.NORMAL })));\n            }\n            configuration.onSpanStart = Array.from(spanStartCallbacks);\n            configuration.onSpanEnd = Array.from(spanEndCallbacks);\n            spanFactory.configure(configuration);\n            const delivery = options.deliveryFactory(configuration.endpoint);\n            const probabilityManagerPromise = configuration.samplingProbability === undefined\n                ? ProbabilityManager.create(options.persistence, sampler, new ProbabilityFetcher(delivery, configuration.apiKey))\n                : FixedProbabilityManager.create(sampler, configuration.samplingProbability);\n            probabilityManagerPromise.then((manager) => {\n                const batchProcessor = new BatchProcessor(delivery, configuration, options.retryQueueFactory(delivery, configuration.retryQueueMaxSize), sampler, manager, new TracePayloadEncoder(options.clock, configuration, options.resourceAttributesSource));\n                spanFactory.reprocessEarlySpans(batchProcessor);\n                // register with the backgrounding listener - we do this in 'start' as\n                // there's nothing to do if we're backgrounded before start is called\n                // e.g. we can't trigger delivery until we have the apiKey and endpoint\n                // from configuration\n                options.backgroundingListener.onStateChange(state => {\n                    batchProcessor.flush();\n                    // ensure we have a fresh probability value when returning to the\n                    // foreground\n                    if (state === 'in-foreground') {\n                        manager.ensureFreshProbability();\n                    }\n                });\n                logger = configuration.logger;\n            });\n            pluginManager.startPlugins();\n        },\n        startSpan: (name, spanOptions) => {\n            const cleanOptions = spanFactory.validateSpanOptions(name, spanOptions);\n            const span = spanFactory.startSpan(cleanOptions.name, cleanOptions.options);\n            span.setAttribute('bugsnag.span.category', 'custom');\n            return spanFactory.toPublicApi(span);\n        },\n        startNetworkSpan: (networkSpanOptions) => {\n            const spanInternal = spanFactory.startNetworkSpan(networkSpanOptions);\n            const span = spanFactory.toPublicApi(spanInternal);\n            // Overwrite end method to set status code attribute\n            // once we release the setAttribute API we can simply return the span\n            const networkSpan = {\n                ...span,\n                end: (endOptions) => {\n                    spanFactory.endSpan(spanInternal, timeToNumber(options.clock, endOptions.endTime), { 'http.status_code': endOptions.status });\n                }\n            };\n            return networkSpan;\n        },\n        getPlugin: (Constructor) => {\n            return pluginManager.getPlugin(Constructor);\n        },\n        getSpanControls: (query) => {\n            return spanControlProvider.getSpanControls(query);\n        },\n        get currentSpanContext() {\n            return spanContextStorage.current;\n        },\n        get appState() {\n            return getAppState();\n        },\n        ...(options.platformExtensions && options.platformExtensions(spanFactory, spanContextStorage))\n    };\n}\nfunction createNoopClient() {\n    const noop = () => { };\n    return {\n        start: noop,\n        startSpan: () => ({ id: '', traceId: '', end: noop, isValid: () => false }),\n        currentSpanContext: undefined\n    };\n}\n\nexport { createClient, createNoopClient };\n","module.exports = function pad (num, size) {\n  var s = '000000000' + num;\n  return s.substr(s.length - size);\n};\n","var pad = require('./pad.js');\n\nvar env = typeof window === 'object' ? window : self;\nvar globalCount = 0;\nfor (var prop in env) {\n  if (Object.hasOwnProperty.call(env, prop)) globalCount++;\n}\nvar mimeTypesLength = navigator.mimeTypes ? navigator.mimeTypes.length : 0;\nvar clientId = pad((mimeTypesLength +\n  navigator.userAgent.length).toString(36) +\n  globalCount.toString(36), 4);\n\nmodule.exports = function fingerprint () {\n  return clientId;\n};\n","/**\n * cuid.js\n * Collision-resistant UID generator for browsers and node.\n * Sequential for fast db lookups and recency sorting.\n * Safe for element IDs and server-side lookups.\n *\n * Extracted from CLCTR\n *\n * Copyright (c) Eric Elliott 2012\n * MIT License\n */\n\nvar fingerprint = require('./lib/fingerprint.js');\nvar isCuid = require('./lib/is-cuid.js');\nvar pad = require('./lib/pad.js');\n\nvar c = 0,\n  blockSize = 4,\n  base = 36,\n  discreteValues = Math.pow(base, blockSize);\n\nfunction randomBlock () {\n  return pad((Math.random() *\n    discreteValues << 0)\n    .toString(base), blockSize);\n}\n\nfunction safeCounter () {\n  c = c < discreteValues ? c : 0;\n  c++; // this is not subliminal\n  return c - 1;\n}\n\nfunction cuid () {\n  // Starting with a lowercase letter makes\n  // it HTML element ID friendly.\n  var letter = 'c', // hard-coded allows for sequential access\n\n    // timestamp\n    // warning: this exposes the exact date and time\n    // that the uid was created.\n    timestamp = new Date().getTime().toString(base),\n\n    // Prevent same-machine collisions.\n    counter = pad(safeCounter().toString(base), blockSize),\n\n    // A few chars to generate distinct ids for different\n    // clients (so different computers are far less\n    // likely to generate the same id)\n    print = fingerprint(),\n\n    // Grab some more chars from Math.random()\n    random = randomBlock() + randomBlock();\n\n  return letter + timestamp + counter + print + random;\n}\n\ncuid.fingerprint = fingerprint;\ncuid.isCuid = isCuid;\n\nmodule.exports = cuid;\n","/**\n * Check the provided value is a valid device id\n * @param {unknown} value\n * @returns\n */\nmodule.exports = function isCuid (value) {\n    return typeof value === 'string' && (/^c[a-z0-9]{20,32}$/).test(value);\n};\n","import cuid from '@bugsnag/cuid';\nimport { isPersistedProbability } from './validation.js';\n\nconst { isCuid } = cuid;\nclass InMemoryPersistence {\n    constructor() {\n        this.persistedItems = new Map();\n    }\n    async load(key) {\n        return this.persistedItems.get(key);\n    }\n    async save(key, value) {\n        this.persistedItems.set(key, value);\n    }\n}\nfunction toPersistedPayload(key, raw) {\n    switch (key) {\n        case 'bugsnag-sampling-probability': {\n            const json = JSON.parse(raw);\n            return isPersistedProbability(json)\n                ? json\n                : undefined;\n        }\n        case 'bugsnag-anonymous-id':\n            return isCuid(raw)\n                ? raw\n                : undefined;\n    }\n}\n\nexport { InMemoryPersistence, toPersistedPayload };\n","const msInDay = 24 * 60 * 60000;\nclass InMemoryQueue {\n    constructor(delivery, retryQueueMaxSize) {\n        this.delivery = delivery;\n        this.retryQueueMaxSize = retryQueueMaxSize;\n        this.requestQueue = Promise.resolve();\n        this.payloads = [];\n    }\n    add(payload, time) {\n        this.payloads.push({ payload, time });\n        let spanCount = this.payloads.reduce((count, { payload }) => count + countSpansInPayload(payload), 0);\n        while (spanCount > this.retryQueueMaxSize) {\n            const payload = this.payloads.shift();\n            if (!payload) {\n                break;\n            }\n            spanCount -= countSpansInPayload(payload.payload);\n        }\n    }\n    async flush() {\n        if (this.payloads.length === 0)\n            return;\n        const payloads = this.payloads;\n        this.payloads = [];\n        this.requestQueue = this.requestQueue.then(async () => {\n            for (const { payload, time } of payloads) {\n                // discard payloads at least 24 hours old\n                if (Date.now() >= time + msInDay)\n                    continue;\n                try {\n                    const { state } = await this.delivery.send(payload);\n                    switch (state) {\n                        case 'success':\n                        case 'failure-discard':\n                            break;\n                        case 'failure-retryable':\n                            this.add(payload, time);\n                            break;\n                        default:\n                            state;\n                    }\n                }\n                catch (err) { }\n            }\n        });\n        await this.requestQueue;\n    }\n}\nfunction countSpansInPayload(payload) {\n    let count = 0;\n    for (let i = 0; i < payload.body.resourceSpans.length; ++i) {\n        const scopeSpans = payload.body.resourceSpans[i].scopeSpans;\n        for (let j = 0; j < scopeSpans.length; ++j) {\n            count += scopeSpans[j].spans.length;\n        }\n    }\n    return count;\n}\n\nexport { InMemoryQueue };\n","import { scaleProbabilityToMatchSamplingRate } from './sampler.js';\nimport { isSpanContext } from './validation.js';\n\nconst TRACE_PERENT_REGEX = /^00-([0-9a-f]{32})-([0-9a-f]{16})-[0-9]{2}$/;\nclass RemoteParentContext {\n    constructor(parentContext) {\n        this.id = parentContext.id;\n        this.traceId = parentContext.traceId;\n    }\n    encodeAsTraceParent() {\n        return RemoteParentContext.toTraceParentString(this);\n    }\n    static parseTraceParent(encodedString) {\n        const result = TRACE_PERENT_REGEX.exec(encodedString);\n        if (!result) {\n            return undefined;\n        }\n        const [, traceId, id] = result;\n        return new RemoteParentContext({ id, traceId });\n    }\n    static toTraceParentString(context) {\n        let sampled = true;\n        if (isSpanContext(context)) {\n            const scaledProbability = scaleProbabilityToMatchSamplingRate(context.samplingProbability);\n            sampled = context.samplingRate <= scaledProbability;\n        }\n        return `00-${context.traceId}-${context.id}-${sampled ? '01' : '00'}`;\n    }\n}\n\nexport { RemoteParentContext as default };\n","import { responseStateFromStatusCode } from '@bugsnag/core-performance';\n\nfunction samplingProbabilityFromHeaders(headers) {\n    const value = headers.get('Bugsnag-Sampling-Probability');\n    if (typeof value !== 'string') {\n        return undefined;\n    }\n    const asNumber = Number.parseFloat(value);\n    if (Number.isNaN(asNumber) || asNumber < 0 || asNumber > 1) {\n        return undefined;\n    }\n    return asNumber;\n}\nfunction createFetchDeliveryFactory(fetch, clock, backgroundingListener) {\n    // if a backgrounding listener is supplied, set fetch's 'keepalive' flag\n    // when the app is backgrounded/terminated so that we can flush the last batch\n    // this may be required on platforms such as browser where without 'keepalive'\n    // the request may be cancelled (or never start sending) when backgrounded\n    // we don't _always_ set the flag because it imposes a 64k payload limit\n    let keepalive = false;\n    if (backgroundingListener) {\n        backgroundingListener.onStateChange(state => {\n            keepalive = state === 'in-background';\n        });\n    }\n    return function fetchDeliveryFactory(endpoint) {\n        return {\n            async send(payload) {\n                const body = JSON.stringify(payload.body);\n                payload.headers['Bugsnag-Sent-At'] = clock.date().toISOString();\n                try {\n                    const response = await fetch(endpoint, {\n                        method: 'POST',\n                        keepalive,\n                        body,\n                        headers: payload.headers\n                    });\n                    return {\n                        state: responseStateFromStatusCode(response.status),\n                        samplingProbability: samplingProbabilityFromHeaders(response.headers)\n                    };\n                }\n                catch (err) {\n                    if (body.length > 10e5) {\n                        return { state: 'failure-discard' };\n                    }\n                    return { state: 'failure-retryable' };\n                }\n            }\n        };\n    };\n}\n\nexport { createFetchDeliveryFactory as default };\n","function defaultNetworkRequestCallback(networkRequestInfo) {\n    return networkRequestInfo;\n}\nfunction isNetworkRequestCallback(value) {\n    return typeof value === 'function';\n}\n\nexport { defaultNetworkRequestCallback, isNetworkRequestCallback };\n","class RequestTracker {\n    constructor() {\n        this.callbacks = [];\n    }\n    onStart(startCallback) {\n        this.callbacks.push(startCallback);\n    }\n    start(context) {\n        const results = [];\n        for (const startCallback of this.callbacks) {\n            const result = startCallback(context);\n            if (result)\n                results.push(result);\n        }\n        return {\n            onRequestEnd: (endContext) => {\n                for (const result of results) {\n                    if (result && result.onRequestEnd) {\n                        result.onRequestEnd(endContext);\n                    }\n                }\n            },\n            extraRequestHeaders: results.map((result) => {\n                if (result && result.extraRequestHeaders) {\n                    return result.extraRequestHeaders;\n                }\n                return undefined;\n            }).filter(isDefined)\n        };\n    }\n}\nfunction isDefined(argument) {\n    return argument !== undefined;\n}\n\nexport { RequestTracker };\n","function getAbsoluteUrl(url, baseUrl) {\n    // if it looks like an absolute url do nothing\n    if (url.indexOf('https://') === 0 || url.indexOf('http://') === 0)\n        return url;\n    try {\n        const absoluteUrl = new URL(url, baseUrl).href;\n        // if a trailing slash has been added inadvertently remove it\n        if (!url.endsWith('/') && absoluteUrl.endsWith('/')) {\n            return absoluteUrl.slice(0, -1);\n        }\n        return absoluteUrl;\n    }\n    catch (_a) {\n        // not a valid URL for some reason - simply return it\n        return url;\n    }\n}\n\nexport { getAbsoluteUrl as default };\n","import { RequestTracker } from './request-tracker.js';\nimport getAbsoluteUrl from './url-helpers.js';\n\nfunction createStartContext(startTime, input, init, baseUrl) {\n    const inputIsRequest = isRequest(input);\n    const url = inputIsRequest ? input.url : String(input);\n    const method = (!!init && init.method) || (inputIsRequest && input.method) || 'GET';\n    return { url: getAbsoluteUrl(url, baseUrl), method, startTime, type: 'fetch' };\n}\nfunction isRequest(input) {\n    return !!input && typeof input === 'object' && !(input instanceof URL);\n}\nfunction isHeadersInstance(input) {\n    return !!input && typeof input === 'object' && input instanceof Headers;\n}\nfunction createFetchRequestTracker(global, clock) {\n    const requestTracker = new RequestTracker();\n    const originalFetch = global.fetch;\n    global.fetch = function fetch(input, init) {\n        const startContext = createStartContext(clock.now(), input, init, global.document && global.document.baseURI);\n        const { onRequestEnd, extraRequestHeaders } = requestTracker.start(startContext);\n        // Add the headers to the `init` received from the caller\n        const modifiedParams = mergeRequestHeaders(input, init, extraRequestHeaders);\n        return originalFetch.call(this, modifiedParams[0], modifiedParams[1]).then(response => {\n            onRequestEnd({ status: response.status, endTime: clock.now(), state: 'success' });\n            return response;\n        }).catch(error => {\n            onRequestEnd({ error, endTime: clock.now(), state: 'error' });\n            throw error;\n        });\n    };\n    return requestTracker;\n}\nfunction mergeRequestHeaders(input, init, extraRequestHeaders) {\n    if (!extraRequestHeaders)\n        return [input, init];\n    const extraHeaders = extraRequestHeaders.reduce((headers, current) => ({ ...headers, ...current }), {});\n    if (isRequest(input) && (!init || !init.headers)) {\n        mergeInputRequestHeaders(extraHeaders, input);\n    }\n    else {\n        init = mergeInitRequestHeaders(extraHeaders, init);\n    }\n    return [input, init];\n}\nfunction mergeInputRequestHeaders(extraRequestHeaders, input) {\n    for (const [name, value] of Object.entries(extraRequestHeaders)) {\n        if (!input.headers.has(name)) {\n            input.headers.set(name, value);\n        }\n    }\n}\nfunction mergeInitRequestHeaders(extraRequestHeaders, init) {\n    if (!init)\n        init = {};\n    if (isHeadersInstance(init.headers)) {\n        for (const [name, value] of Object.entries(extraRequestHeaders)) {\n            if (!init.headers.has(name)) {\n                init.headers.set(name, value);\n            }\n        }\n        return init;\n    }\n    else {\n        return { ...init, headers: { ...extraRequestHeaders, ...init.headers } };\n    }\n}\n\nexport { createFetchRequestTracker as default };\n","import { isObject } from '@bugsnag/core-performance'\n\nexport interface SendPageAttributes {\n  referrer?: boolean\n  title?: boolean\n  url?: boolean\n}\n\nexport const defaultSendPageAttributes = {\n  referrer: true,\n  title: true,\n  url: true\n}\n\nexport function getPermittedAttributes (sendPageAttributes: SendPageAttributes) {\n  return {\n    ...defaultSendPageAttributes,\n    ...sendPageAttributes\n  }\n}\n\nexport function isSendPageAttributes (obj: unknown): obj is SendPageAttributes {\n  const allowedTypes = ['undefined', 'boolean']\n  const keys = Object.keys(defaultSendPageAttributes)\n\n  return isObject(obj) && keys.every(key => allowedTypes.includes(typeof obj[key]))\n}\n","import type { SpanContext, SpanFactory } from '@bugsnag/core-performance'\nimport type { BrowserConfiguration } from '../config'\nimport type { PerformanceWithTiming } from '../on-settle/load-event-end-settler'\n\ntype PageLoadPhase = 'Unload'\n| 'Redirect'\n| 'LoadFromCache'\n| 'DNSLookup'\n| 'TCPHandshake'\n| 'TLS'\n| 'HTTPRequest'\n| 'HTTPResponse'\n| 'DomContentLoadedEvent'\n| 'LoadEvent'\n\nfunction shouldOmitSpan (startTime?: number, endTime?: number): boolean {\n  return (startTime === undefined || endTime === undefined) ||\n  (startTime === 0 && endTime === 0)\n}\n\nexport const instrumentPageLoadPhaseSpans = (\n  spanFactory: SpanFactory<BrowserConfiguration>,\n  performance: PerformanceWithTiming,\n  route: string,\n  parentContext: SpanContext\n) => {\n  function createPageLoadPhaseSpan (phase: PageLoadPhase, startTime: number, endTime: number) {\n    if (shouldOmitSpan(startTime, endTime)) return\n    const span = spanFactory.startSpan(`[PageLoadPhase/${phase}]${route}`, {\n      startTime,\n      parentContext,\n      makeCurrentContext: false\n    })\n\n    span.setAttribute('bugsnag.span.category', 'page_load_phase')\n    span.setAttribute('bugsnag.phase', phase)\n    spanFactory.endSpan(span, endTime)\n  }\n\n  const entries = performance.getEntriesByType('navigation') as PerformanceNavigationTiming[]\n  const entry = Array.isArray(entries) && entries[0]\n\n  if (entry) {\n    createPageLoadPhaseSpan('Unload', entry.unloadEventStart, entry.unloadEventEnd)\n    createPageLoadPhaseSpan('Redirect', entry.redirectStart, entry.redirectEnd)\n    createPageLoadPhaseSpan('LoadFromCache', entry.fetchStart, entry.domainLookupStart)\n    createPageLoadPhaseSpan('DNSLookup', entry.domainLookupStart, entry.domainLookupEnd)\n\n    // secureConectionStart will be 0 if no secure connection is used so use connectEnd in that case\n    const TCPHandshakeEnd = entry.secureConnectionStart || entry.connectEnd\n    createPageLoadPhaseSpan('TCPHandshake', entry.connectStart, TCPHandshakeEnd)\n\n    createPageLoadPhaseSpan('TLS', entry.secureConnectionStart, entry.connectEnd)\n    createPageLoadPhaseSpan('HTTPRequest', entry.requestStart, entry.responseStart)\n    createPageLoadPhaseSpan('HTTPResponse', entry.responseStart, entry.responseEnd)\n    createPageLoadPhaseSpan('DomContentLoadedEvent', entry.domContentLoadedEventStart, entry.domContentLoadedEventEnd)\n    createPageLoadPhaseSpan('LoadEvent', entry.loadEventStart, entry.loadEventEnd)\n  }\n}\n","import type { OnSettle } from './on-settle'\nimport { getAbsoluteUrl } from '@bugsnag/request-tracker-performance'\nimport type { RouteResolver, RoutingProvider, StartRouteChangeCallback } from './routing-provider'\n\nexport const defaultRouteResolver: RouteResolver = (url: URL) => url.pathname || '/'\n\nexport const createNoopRoutingProvider = () => {\n  return class NoopRoutingProvider implements RoutingProvider {\n    resolveRoute: RouteResolver\n\n    constructor (resolveRoute = defaultRouteResolver) {\n      this.resolveRoute = resolveRoute\n    }\n\n    listenForRouteChanges (startRouteChangeSpan: StartRouteChangeCallback) {}\n  }\n}\n\nexport const createDefaultRoutingProvider = (onSettle: OnSettle, location: Location) => {\n  return class DefaultRoutingProvider implements RoutingProvider {\n    resolveRoute: RouteResolver\n\n    constructor (resolveRoute = defaultRouteResolver) {\n      this.resolveRoute = resolveRoute\n    }\n\n    listenForRouteChanges (startRouteChangeSpan: StartRouteChangeCallback) {\n      addEventListener('popstate', (ev) => {\n        const url = new URL(location.href)\n        const span = startRouteChangeSpan(url, 'popstate')\n\n        onSettle((endTime) => {\n          span.end(endTime)\n        })\n      })\n\n      const originalPushState = history.pushState\n      history.pushState = function (...args) {\n        const url = args[2]\n\n        if (url) {\n          const absoluteURL = new URL(getAbsoluteUrl(url.toString(), document.baseURI))\n          const span = startRouteChangeSpan(absoluteURL, 'pushState')\n\n          onSettle((endTime) => {\n            span.end(endTime)\n          })\n        }\n\n        originalPushState.apply(this, args)\n      }\n    }\n  }\n}\n","import { getAppState, setAppState } from '@bugsnag/core-performance'\nimport type { ParentContext, BackgroundingListener, Plugin, SpanFactory, PluginContext } from '@bugsnag/core-performance'\nimport type { BrowserConfiguration } from '../config'\nimport type { OnSettle } from '../on-settle'\nimport type { PerformanceWithTiming } from '../on-settle/load-event-end-settler'\nimport { defaultSendPageAttributes, getPermittedAttributes } from '../send-page-attributes'\nimport type { SendPageAttributes } from '../send-page-attributes'\nimport type { WebVitals } from '../web-vitals'\nimport { instrumentPageLoadPhaseSpans } from './page-load-phase-spans'\nimport { defaultRouteResolver } from '../default-routing-provider'\nimport type { RouteResolver } from '../routing-provider'\n\nexport class FullPageLoadPlugin implements Plugin<BrowserConfiguration> {\n  private readonly spanFactory: SpanFactory<BrowserConfiguration>\n  private readonly document: Document\n  private readonly location: Location\n  private readonly onSettle: OnSettle\n  private readonly webVitals: WebVitals\n  private readonly performance: PerformanceWithTiming\n\n  // if the page was backgrounded at any point in the loading process a page\n  // load span is invalidated as the browser will deprioritise the page\n  private wasBackgrounded: boolean = false\n\n  private enabled: boolean = false\n  private routeResolver: RouteResolver = defaultRouteResolver\n  private sendPageAttributes: SendPageAttributes = defaultSendPageAttributes\n\n  constructor (\n    document: Document,\n    location: Location,\n    spanFactory: SpanFactory<BrowserConfiguration>,\n    webVitals: WebVitals,\n    onSettle: OnSettle,\n    backgroundingListener: BackgroundingListener,\n    performance: PerformanceWithTiming\n  ) {\n    this.document = document\n    this.location = location\n    this.spanFactory = spanFactory\n    this.webVitals = webVitals\n    this.onSettle = onSettle\n    this.performance = performance\n\n    backgroundingListener.onStateChange(state => {\n      if (!this.wasBackgrounded && state === 'in-background') {\n        this.wasBackgrounded = true\n      }\n    })\n  }\n\n  install (context: PluginContext<BrowserConfiguration>) {\n    // don't report a page load span if the option is turned off or the page was\n    // backgrounded at any point in the loading process\n    if (!context.configuration.autoInstrumentFullPageLoads || this.wasBackgrounded) {\n      return\n    }\n\n    const { routingProvider, sendPageAttributes } = context.configuration\n    if (routingProvider) this.routeResolver = routingProvider.resolveRoute\n    if (sendPageAttributes) this.sendPageAttributes = sendPageAttributes\n\n    this.enabled = true\n  }\n\n  start () {\n    if (!this.enabled) return\n\n    let parentContext: ParentContext | null = null\n\n    const traceparentMetaTag = document.querySelector('meta[name=\"traceparent\"]')\n    if (traceparentMetaTag !== null && traceparentMetaTag.getAttribute('content')) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const traceparent = traceparentMetaTag.getAttribute('content')!\n      const [, traceId, parentSpanId] = traceparent.split('-')\n\n      parentContext = {\n        traceId,\n        id: parentSpanId\n      }\n    }\n\n    const span = this.spanFactory.startSpan('[FullPageLoad]', { startTime: 0, parentContext })\n    const permittedAttributes = getPermittedAttributes(this.sendPageAttributes || defaultSendPageAttributes)\n    const url = new URL(this.location.href)\n\n    this.onSettle((endTime: number) => {\n      if (this.wasBackgrounded) return\n\n      // ensure there's always a route on this span by falling back to the\n      // default route resolver - the pipeline will ignore page load spans that\n      // don't have a route\n      const route = this.routeResolver(url) || defaultRouteResolver(url)\n      span.name += route\n\n      instrumentPageLoadPhaseSpans(this.spanFactory, this.performance, route, span)\n\n      // Browser attributes\n      span.setAttribute('bugsnag.span.category', 'full_page_load')\n      span.setAttribute('bugsnag.browser.page.route', route)\n      if (permittedAttributes.referrer) span.setAttribute('bugsnag.browser.page.referrer', this.document.referrer)\n      if (permittedAttributes.title) span.setAttribute('bugsnag.browser.page.title', this.document.title)\n      if (permittedAttributes.url) span.setAttribute('bugsnag.browser.page.url', url.toString())\n\n      this.webVitals.attachTo(span)\n      this.spanFactory.endSpan(span, endTime)\n      if (getAppState() === 'starting') {\n        setAppState('ready')\n      }\n    })\n  }\n}\n","import { RemoteParentContext, traceIdToSamplingRate } from '@bugsnag/core-performance'\nimport type { Logger, Plugin, PluginContext, SpanContextStorage, SpanFactory } from '@bugsnag/core-performance'\nimport {\n  defaultNetworkRequestCallback\n\n} from '@bugsnag/request-tracker-performance'\nimport type { NetworkRequestCallback, NetworkRequestInfo, RequestEndContext, RequestStartCallback, RequestStartContext, RequestTracker } from '@bugsnag/request-tracker-performance'\nimport type { BrowserConfiguration } from '../config'\n\nexport interface BrowserNetworkRequestInfo extends NetworkRequestInfo {\n  readonly type: PerformanceResourceTiming['initiatorType']\n\n  /**\n   * Experimental. Whether to propagate trace context by adding a `traceparent` header to the request.\n   */\n  propagateTraceContext?: boolean\n}\n\nconst permittedPrefixes = ['http://', 'https://', '/', './', '../']\n\nexport class NetworkRequestPlugin implements Plugin<BrowserConfiguration> {\n  private configEndpoint: string = ''\n  private networkRequestCallback: NetworkRequestCallback<BrowserNetworkRequestInfo> = defaultNetworkRequestCallback\n  private logger: Logger = { debug: console.debug, warn: console.warn, info: console.info, error: console.error }\n  private enabled: boolean = false\n\n  constructor (\n    private spanFactory: SpanFactory<BrowserConfiguration>,\n    private readonly spanContextStorage: SpanContextStorage,\n    private fetchTracker: RequestTracker,\n    private xhrTracker: RequestTracker\n  ) {}\n\n  install (context: PluginContext<BrowserConfiguration>) {\n    if (!context.configuration.autoInstrumentNetworkRequests) {\n      return\n    }\n\n    const { endpoint, logger, networkRequestCallback } = context.configuration\n\n    if (logger) this.logger = logger\n    if (endpoint) this.configEndpoint = endpoint\n    if (networkRequestCallback) this.networkRequestCallback = networkRequestCallback\n\n    this.enabled = true\n  }\n\n  start () {\n    if (this.enabled) {\n      this.xhrTracker.onStart(this.trackRequest)\n      this.fetchTracker.onStart(this.trackRequest)\n    }\n  }\n\n  private trackRequest: RequestStartCallback = (startContext) => {\n    if (!this.shouldTrackRequest(startContext)) return\n\n    const shouldPropagateTraceContextByDefault = false\n\n    const defaultRequestInfo: BrowserNetworkRequestInfo = {\n      url: startContext.url,\n      type: startContext.type,\n      propagateTraceContext: shouldPropagateTraceContextByDefault\n    }\n\n    const networkRequestInfo = this.networkRequestCallback(defaultRequestInfo)\n\n    // returning null neither creates a span nor propagates trace context\n    if (!networkRequestInfo) {\n      return {\n        onRequestEnd: undefined,\n        extraRequestHeaders: undefined\n      }\n    }\n\n    if (networkRequestInfo.propagateTraceContext === undefined) {\n      networkRequestInfo.propagateTraceContext = shouldPropagateTraceContextByDefault\n    }\n\n    // a span is not created if url is null\n    if (!networkRequestInfo.url) {\n      return {\n        onRequestEnd: undefined,\n        // propagate trace context if requested using span context\n        extraRequestHeaders: networkRequestInfo.propagateTraceContext ? this.getExtraRequestHeaders() : undefined\n      }\n    }\n\n    // otherwise, create a span and propagate trace context if requested\n    if (typeof networkRequestInfo.url !== 'string') {\n      this.logger.warn(`expected url to be a string following network request callback, got ${typeof networkRequestInfo.url}`)\n      return\n    }\n\n    const span = this.spanFactory.startNetworkSpan({\n      method: startContext.method,\n      startTime: startContext.startTime,\n      url: networkRequestInfo.url\n    })\n\n    return {\n      onRequestEnd: (endContext: RequestEndContext) => {\n        if (endContext.state === 'success') {\n          this.spanFactory.endSpan(span, endContext.endTime, { 'http.status_code': endContext.status })\n        }\n      },\n      // propagate trace context using network span\n      extraRequestHeaders: networkRequestInfo.propagateTraceContext\n        ? this.getExtraRequestHeaders(span)\n        : undefined\n    }\n  }\n\n  private shouldTrackRequest (startContext: RequestStartContext): boolean {\n    return startContext.url !== this.configEndpoint && permittedPrefixes.some((prefix) => startContext.url.startsWith(prefix))\n  }\n\n  private getExtraRequestHeaders (spanContext = this.spanContextStorage.current): Record<string, string> {\n    const extraRequestHeaders: Record<string, string> = {}\n\n    if (spanContext) {\n      extraRequestHeaders.traceparent = RemoteParentContext.toTraceParentString(spanContext)\n      extraRequestHeaders.tracestate = buildTracestateHeader(spanContext.traceId)\n    }\n\n    return extraRequestHeaders\n  }\n}\n\nfunction buildTracestateHeader (traceId: string): string {\n  return `sb=v:1;r32:${traceIdToSamplingRate(traceId)}`\n}\n","import type { SpanContextStorage, Plugin, SpanFactory, PluginContext, Logger } from '@bugsnag/core-performance'\nimport type { BrowserConfiguration } from '../config'\nimport { defaultNetworkRequestCallback } from '@bugsnag/request-tracker-performance'\nimport type { NetworkRequestCallback } from '@bugsnag/request-tracker-performance'\nimport type { BrowserNetworkRequestInfo } from './network-request-plugin'\n\ninterface ResourceTiming extends PerformanceResourceTiming {\n  responseStatus?: number // https://developer.mozilla.org/en-US/docs/Web/API/PerformanceResourceTiming/responseStatus\n}\n\nexport function getHttpVersion (protocol: string) {\n  switch (protocol) {\n    case '':\n      return undefined\n    case 'http/1.0':\n      return '1.0'\n    case 'http/1.1':\n      return '1.1'\n    case 'h2':\n    case 'h2c':\n      return '2.0'\n    case 'h3':\n      return '3.0'\n    case 'spdy/1':\n    case 'spdy/2':\n    case 'spdy/3':\n      return 'SPDY'\n    default:\n      return protocol\n  }\n}\n\nfunction resourceLoadSupported (PerformanceObserverClass: typeof PerformanceObserver) {\n  return PerformanceObserverClass &&\n    Array.isArray(PerformanceObserverClass.supportedEntryTypes) &&\n    PerformanceObserverClass.supportedEntryTypes.includes('resource')\n}\n\nexport class ResourceLoadPlugin implements Plugin<BrowserConfiguration> {\n  constructor (\n    private readonly spanFactory: SpanFactory<BrowserConfiguration>,\n    private readonly spanContextStorage: SpanContextStorage,\n    private readonly PerformanceObserverClass: typeof PerformanceObserver\n  ) {}\n\n  private enabled: boolean = false\n  private logger: Logger = { debug: console.debug, warn: console.warn, info: console.info, error: console.error }\n  private networkRequestCallback: NetworkRequestCallback<BrowserNetworkRequestInfo> = defaultNetworkRequestCallback\n\n  install (context: PluginContext<BrowserConfiguration>) {\n    if (!resourceLoadSupported(this.PerformanceObserverClass)) return\n\n    const { logger, networkRequestCallback } = context.configuration\n\n    if (logger) this.logger = logger\n    if (networkRequestCallback) this.networkRequestCallback = networkRequestCallback\n\n    this.enabled = true\n  }\n\n  start () {\n    if (!this.enabled) return\n\n    const observer = new this.PerformanceObserverClass((list) => {\n      const entries = list.getEntries() as ResourceTiming[]\n\n      for (const entry of entries) {\n        if (entry.initiatorType === 'fetch' || entry.initiatorType === 'xmlhttprequest') {\n          continue\n        }\n\n        const parentContext = this.spanContextStorage.first\n\n        if (parentContext) {\n          const networkRequestInfo = this.networkRequestCallback({ url: entry.name, type: entry.initiatorType })\n\n          if (!networkRequestInfo) return\n\n          if (typeof networkRequestInfo.url !== 'string') {\n            this.logger.warn(`expected url to be a string following network request callback, got ${typeof networkRequestInfo.url}`)\n            return\n          }\n\n          let name = ''\n          try {\n            const url = new URL(networkRequestInfo.url)\n            url.search = ''\n            name = url.href\n          } catch (err) {\n            this.logger.warn(`Unable to parse URL returned from networkRequestCallback: ${networkRequestInfo.url}`)\n            return\n          }\n\n          const span = this.spanFactory.startSpan(`[ResourceLoad]${name}`, {\n            parentContext,\n            startTime: entry.startTime,\n            makeCurrentContext: false\n          })\n\n          span.setAttribute('bugsnag.span.category', 'resource_load')\n          span.setAttribute('http.url', networkRequestInfo.url)\n\n          const httpFlavor = getHttpVersion(entry.nextHopProtocol)\n          if (httpFlavor) {\n            span.setAttribute('http.flavor', httpFlavor)\n          }\n\n          if (entry.encodedBodySize && entry.decodedBodySize) {\n            span.setAttribute('http.response_content_length', entry.encodedBodySize)\n            span.setAttribute('http.response_content_length_uncompressed', entry.decodedBodySize)\n          }\n\n          if (entry.responseStatus) {\n            span.setAttribute('http.status_code', entry.responseStatus)\n          }\n\n          this.spanFactory.endSpan(span, entry.responseEnd)\n        }\n      }\n    })\n\n    try {\n      observer.observe({ type: 'resource', buffered: true })\n    } catch (err) {\n      this.logger.warn('Unable to get previous resource loads as buffered observer not supported, only showing resource loads from this point on')\n      observer.observe({ entryTypes: ['resource'] })\n    }\n  }\n}\n","import type { Logger, Plugin, PluginContext, Span, SpanFactory, SpanOptionSchema, Time } from '@bugsnag/core-performance'\nimport { coreSpanOptionSchema, isObject, isString, setAppState } from '@bugsnag/core-performance'\nimport type { BrowserConfiguration } from '../config'\nimport { defaultRouteResolver } from '../default-routing-provider'\nimport type { RouteChangeSpanEndOptions, RouteChangeSpanOptions, RoutingProvider } from '../routing-provider'\nimport { defaultSendPageAttributes, getPermittedAttributes } from '../send-page-attributes'\nimport type { SendPageAttributes } from '../send-page-attributes'\n\n// exclude isFirstClass from the route change option schema\nconst { startTime, parentContext, makeCurrentContext } = coreSpanOptionSchema\nconst routeChangeSpanOptionSchema: SpanOptionSchema = {\n  startTime,\n  parentContext,\n  makeCurrentContext,\n  trigger: {\n    getDefaultValue: (value) => String(value),\n    message: 'should be a string',\n    validate: isString\n  }\n}\n\ninterface InternalRouteChangeSpanOptions extends RouteChangeSpanOptions {\n  url: URL\n  trigger: string\n}\n\nexport class RouteChangePlugin implements Plugin<BrowserConfiguration> {\n  constructor (\n    private readonly spanFactory: SpanFactory<BrowserConfiguration>,\n    private readonly location: Location,\n    private readonly document: Document\n  ) {}\n\n  private enabled: boolean = false\n  private routingProvider?: RoutingProvider\n  private sendPageAttributes: SendPageAttributes = defaultSendPageAttributes\n  private logger: Logger = { debug: console.debug, warn: console.warn, info: console.info, error: console.error }\n\n  install (context: PluginContext<BrowserConfiguration>) {\n    if (!context.configuration.autoInstrumentRouteChanges) return\n\n    const { logger, routingProvider, sendPageAttributes } = context.configuration\n    if (logger) this.logger = logger\n    if (routingProvider) this.routingProvider = routingProvider\n    if (sendPageAttributes) this.sendPageAttributes = sendPageAttributes\n\n    this.enabled = true\n  }\n\n  start () {\n    if (!this.enabled) return\n\n    const previousUrl = new URL(this.location.href)\n    let previousRoute = this.routingProvider?.resolveRoute(previousUrl) || defaultRouteResolver(previousUrl)\n\n    const permittedAttributes = getPermittedAttributes(this.sendPageAttributes)\n\n    this.routingProvider?.listenForRouteChanges((url, trigger, options) => {\n      let absoluteUrl\n\n      if (url instanceof URL) {\n        absoluteUrl = url\n      } else {\n        try {\n          const stringUrl = String(url)\n          absoluteUrl = new URL(stringUrl)\n        } catch (err) {\n          this.logger.warn('Invalid span options\\n  - url should be a URL')\n\n          return {\n            id: '',\n            name: '',\n            traceId: '',\n            samplingRate: 0,\n            samplingProbability: 0,\n            isValid: () => false,\n            setAttribute: () => {},\n            end: () => {}\n          } satisfies Span\n        }\n      }\n      setAppState('navigating')\n      // create internal options for validation\n      const routeChangeSpanOptions = {\n        ...options,\n        trigger\n      }\n\n      const cleanOptions = this.spanFactory.validateSpanOptions<InternalRouteChangeSpanOptions>(\n        '[RouteChange]',\n        routeChangeSpanOptions,\n        routeChangeSpanOptionSchema\n      )\n\n      const route = this.routingProvider?.resolveRoute(absoluteUrl) || defaultRouteResolver(absoluteUrl)\n\n      // update the span name using the validated route\n      cleanOptions.name += route\n      const span = this.spanFactory.startSpan(cleanOptions.name, cleanOptions.options)\n      span.setAttribute('bugsnag.span.category', 'route_change')\n      span.setAttribute('bugsnag.browser.page.route', route)\n      span.setAttribute('bugsnag.browser.page.previous_route', previousRoute)\n      span.setAttribute('bugsnag.browser.page.route_change.trigger', cleanOptions.options.trigger)\n      if (permittedAttributes.url) span.setAttribute('bugsnag.browser.page.url', url.toString())\n\n      previousRoute = route\n\n      return {\n        get id () {\n          return span.id\n        },\n        get traceId () {\n          return span.traceId\n        },\n        get samplingRate () {\n          return span.samplingRate\n        },\n        get samplingProbability () {\n          return span.samplingProbability\n        },\n        get name () {\n          return span.name\n        },\n        isValid: span.isValid,\n        setAttribute: span.setAttribute,\n        end: (endTimeOrOptions?: Time | RouteChangeSpanEndOptions): void => {\n          const options: RouteChangeSpanEndOptions = isObject(endTimeOrOptions) ? endTimeOrOptions : { endTime: endTimeOrOptions }\n\n          if (permittedAttributes.title) {\n            span.setAttribute('bugsnag.browser.page.title', this.document.title)\n          }\n\n          if (options.url) {\n            const urlObject = ensureUrl(options.url) // convert strings to URL if necessary\n            const route = this.routingProvider?.resolveRoute(urlObject) || defaultRouteResolver(urlObject)\n\n            span.name = `[RouteChange]${route}`\n            span.setAttribute('bugsnag.browser.page.route', route)\n            previousRoute = route\n\n            // update the URL attribute as well\n            if (permittedAttributes.url) {\n              span.setAttribute('bugsnag.browser.page.url', urlObject.toString())\n            }\n          }\n\n          this.spanFactory.toPublicApi(span).end(options.endTime)\n\n          setAppState('ready')\n        }\n\n      } satisfies Span\n    })\n  }\n}\n\nfunction ensureUrl (url: string | URL): URL {\n  if (typeof url === 'string') {\n    return new URL(url)\n  }\n  return url\n}\n","import { millisecondsToNanoseconds } from '@bugsnag/core-performance'\nimport type { BackgroundingListener, Clock } from '@bugsnag/core-performance'\n\n// a cut-down PerformanceTiming interface, since we don't care about most of\n// its properties\ninterface PerformanceTiming {\n  navigationStart: number\n}\n\n// the 'Performance' type says 'timeOrigin' is always available, but that's not\n// true on Safari <15 so we mark it as possibly 'undefined'\ninterface PerformanceWithOptionalTimeOrigin {\n  now: () => number\n  timeOrigin?: number\n  timing: PerformanceTiming\n}\n\n// maximum allowed clock divergence in milliseconds\nconst MAX_CLOCK_DRIFT_MS = 300000\n\nfunction recalculateTimeOrigin (timeOrigin: number, performance: PerformanceWithOptionalTimeOrigin): number {\n  // if the machine has been sleeping the monatomic clock used by performance.now() may have been paused,\n  // so we need to check if this has drifted significantly from Date.now()\n  // if the drift is > 5 minutes re-set the clock's origin to bring it back in line with Date.now()\n  if (Math.abs(Date.now() - (timeOrigin + performance.now())) > MAX_CLOCK_DRIFT_MS) {\n    return Date.now() - performance.now()\n  }\n\n  return timeOrigin\n}\n\nfunction createClock (performance: PerformanceWithOptionalTimeOrigin, backgroundingListener: BackgroundingListener): Clock {\n  const initialTimeOrigin = performance.timeOrigin === undefined\n    ? performance.timing.navigationStart\n    : performance.timeOrigin\n\n  // the performance clock could be shared between different tabs running in the same process\n  // so may already have diverged - for this reason we calculate a time origin when we first create the clock\n  // as well as when the app returns to the foreground\n  let calculatedTimeOrigin = recalculateTimeOrigin(initialTimeOrigin, performance)\n  backgroundingListener.onStateChange(state => {\n    if (state === 'in-foreground') {\n      calculatedTimeOrigin = recalculateTimeOrigin(calculatedTimeOrigin, performance)\n    }\n  })\n\n  const toUnixNanoseconds = (time: number) => millisecondsToNanoseconds(calculatedTimeOrigin + time)\n\n  return {\n    now: () => performance.now(),\n    date: () => new Date(calculatedTimeOrigin + performance.now()),\n    convert: (date) => date.getTime() - calculatedTimeOrigin,\n    // convert milliseconds since timeOrigin to unix time in nanoseconds\n    toUnixNanoseconds,\n    // convert milliseconds since timeOrigin to full timestamp\n    toUnixTimestampNanoseconds: (time: number) => toUnixNanoseconds(time).toString()\n  }\n}\n\nexport default createClock\n","import { isObject } from '@bugsnag/core-performance'\nimport type { Time, Span, SpanOptions } from '@bugsnag/core-performance'\n\nexport type RouteChangeSpanOptions = Omit<SpanOptions, 'isFirstClass'>\nexport type StartRouteChangeCallback = (url: URL | string, trigger: string, options?: RouteChangeSpanOptions) => RouteChangeSpan\n\nexport interface RouteChangeSpanEndOptions {\n  endTime?: number | Date\n  url?: URL | string\n}\n\nexport interface RouteChangeSpan extends Span {\n  end: ((endTime?: Time) => void) & ((routeChangeSpanEndOptions: RouteChangeSpanEndOptions) => void)\n}\n\nexport interface RoutingProvider {\n  resolveRoute: (url: URL) => string\n  listenForRouteChanges: (startRouteChangeSpan: StartRouteChangeCallback) => void\n}\n\nexport type RouteResolver = (url: URL) => string\n\nexport const isRoutingProvider = (value: unknown): value is RoutingProvider =>\n  isObject(value) &&\n    typeof value.resolveRoute === 'function' &&\n    typeof value.listenForRouteChanges === 'function'\n","import type { BitLength, IdGenerator } from '@bugsnag/core-performance'\n\nfunction toHex (value: number): string {\n  const hex = value.toString(16)\n\n  // pad hex with a leading 0 if it's not already 2 characters\n  if (hex.length === 1) {\n    return '0' + hex\n  }\n\n  return hex\n}\n\nconst idGenerator: IdGenerator = {\n  generate (bits: BitLength): string {\n    const bytes = new Uint8Array(bits / 8)\n\n    // TODO: do we just read window here?\n    //       how can we pass this in given it needs to be valid before 'start' is called?\n    const randomValues = window.crypto.getRandomValues(bytes)\n\n    return Array.from(randomValues).map(toHex).join('')\n  }\n}\n\nexport default idGenerator\n","import type { Clock } from '@bugsnag/core-performance'\nimport type { OnSettleCallback } from '.'\n\nexport abstract class Settler {\n  protected clock: Clock\n  protected settled: boolean = false\n\n  private readonly callbacks: Set<OnSettleCallback> = new Set<OnSettleCallback>()\n\n  constructor (clock: Clock) {\n    this.clock = clock\n  }\n\n  subscribe (callback: OnSettleCallback): void {\n    this.callbacks.add(callback)\n\n    // if we're already settled, call the callback immediately\n    if (this.isSettled()) {\n      callback(this.clock.now())\n    }\n  }\n\n  unsubscribe (callback: OnSettleCallback): void {\n    this.callbacks.delete(callback)\n  }\n\n  isSettled (): boolean {\n    return this.settled\n  }\n\n  protected settle (settledTime: number): void {\n    this.settled = true\n\n    for (const callback of this.callbacks) {\n      callback(settledTime)\n    }\n  }\n}\n","import type { Clock } from '@bugsnag/core-performance'\nimport { Settler } from './settler'\n\nclass DomMutationSettler extends Settler {\n  private timeout: ReturnType<typeof setTimeout> | undefined = undefined\n\n  constructor (clock: Clock, target: Node) {\n    super(clock)\n\n    const observer = new MutationObserver(() => { this.restart() })\n\n    observer.observe(target, {\n      subtree: true,\n      childList: true,\n      characterData: true\n      // we don't track attribute changes as they may or may not be user visible\n      // so we assume they won't affect the page appearing settled to the user\n    })\n\n    this.restart()\n  }\n\n  private restart (): void {\n    clearTimeout(this.timeout)\n    this.settled = false\n\n    // we wait 100ms to ensure that DOM mutations have actually stopped but\n    // don't want the settled time to reflect that wait, so we record the time\n    // here and use that when settling\n    const settledTime = this.clock.now()\n\n    this.timeout = setTimeout(() => { this.settle(settledTime) }, 100)\n  }\n}\n\nexport default DomMutationSettler\n","import type { Clock } from '@bugsnag/core-performance'\nimport { Settler } from './settler'\n\ntype AddEventListener = (event: string, callback: () => void) => void\n\nexport interface PerformanceWithTiming {\n  getEntriesByType: typeof performance.getEntriesByType\n  timing: {\n    loadEventEnd: number\n    navigationStart: number\n  }\n}\n\ninterface DocumentWithReadyState {\n  readyState: DocumentReadyState\n}\n\n// check if a PerformanceEntry is a PerformanceNavigationTiming\nfunction isPerformanceNavigationTiming (entry?: PerformanceEntry): entry is PerformanceNavigationTiming {\n  return !!entry && entry.entryType === 'navigation'\n}\n\nclass LoadEventEndSettler extends Settler {\n  constructor (\n    clock: Clock,\n    addEventListener: AddEventListener,\n    performance: PerformanceWithTiming,\n    document: DocumentWithReadyState\n  ) {\n    super(clock)\n\n    // we delay settling by a macrotask so that the load event has ended\n    // see: https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context/25933985#25933985\n    //      https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/\n    if (document.readyState === 'complete') {\n      setTimeout(() => { this.settleUsingPerformance(performance) }, 0)\n    } else {\n      addEventListener('load', () => {\n        setTimeout(() => { this.settleUsingPerformance(performance) }, 0)\n      })\n    }\n  }\n\n  private settleUsingPerformance (performance: PerformanceWithTiming) {\n    const now = this.clock.now()\n\n    // there's only ever one navigation entry\n    // PLAT-10204 Prevent snags occuring due to DOM scanning bots like BuiltWith https://builtwith.com/biup\n    const entry = typeof performance.getEntriesByType === 'function' ? performance.getEntriesByType('navigation')[0] : undefined\n\n    let settledTime = 0\n\n    if (isPerformanceNavigationTiming(entry)) {\n      settledTime = entry.loadEventEnd\n    } else if (performance.timing) {\n      settledTime = performance.timing.loadEventEnd - performance.timing.navigationStart\n    }\n\n    // if the settled time is obviously wrong then use the current time instead\n    // this won't be a perfectly accurate value, but it should be close enough\n    // for this purpose\n    if (settledTime <= 0 || settledTime > now) {\n      settledTime = now\n    }\n\n    this.settle(settledTime)\n  }\n}\n\nexport default LoadEventEndSettler\n","import type { Clock } from '@bugsnag/core-performance'\nimport { Settler } from './settler'\nimport type { RequestStartContext, RequestEndContext, RequestTracker } from '@bugsnag/request-tracker-performance'\n\nclass RequestSettler extends Settler {\n  private timeout: ReturnType<typeof setTimeout> | undefined = undefined\n  private urlsToIgnore: RegExp[] = []\n  private outstandingRequests = 0\n\n  constructor (clock: Clock, requestTracker: RequestTracker) {\n    super(clock)\n\n    // unlike most other settlers we start settled as it's possible to not make\n    // any requests at all\n    // TODO: we actually should only be settled if there are no outstanding\n    //       requests when constructed\n    this.settled = true\n\n    requestTracker.onStart(this.onRequestStart.bind(this))\n  }\n\n  setUrlsToIgnore (urlsToIgnore: RegExp[]): void {\n    this.urlsToIgnore = urlsToIgnore\n  }\n\n  private onRequestStart (startContext: RequestStartContext) {\n    // if this is an excluded URL, ignore this request\n    if (this.shouldIgnoreUrl(startContext.url)) return\n\n    clearTimeout(this.timeout)\n    this.settled = false\n    ++this.outstandingRequests\n\n    return {\n      onRequestEnd: (endContext: RequestEndContext): void => {\n        if (--this.outstandingRequests === 0) {\n          // we wait 100ms to ensure that requests have actually stopped but don't\n          // want the settled time to reflect that wait, so we record the time\n          // here and use that when settling\n          const settledTime = this.clock.now()\n\n          this.timeout = setTimeout(() => { this.settle(settledTime) }, 100)\n        }\n      }\n    }\n  }\n\n  private shouldIgnoreUrl (url: string): boolean {\n    return this.urlsToIgnore.some(regexp => regexp.test(url))\n  }\n}\n\nexport default RequestSettler\n","import type { Clock } from '@bugsnag/core-performance'\nimport { Settler } from './settler'\n\n/**\n * SettlerAggregate is a Settler that is settled when ALL Settlers it is\n * constructed with are settled themselves\n */\nclass SettlerAggregate extends Settler {\n  private readonly settlers: Settler[]\n\n  constructor (clock: Clock, settlers: Settler[]) {\n    super(clock)\n    this.settlers = settlers\n\n    for (const settler of settlers) {\n      settler.subscribe((settledTime: number) => {\n        // we need to check if all of the settlers are settled here as a\n        // previously settled settler could have unsettled in the meantime\n        if (this.settlersAreSettled()) {\n          this.settle(settledTime)\n        } else {\n          this.settled = false\n        }\n      })\n    }\n  }\n\n  isSettled () {\n    // ensure all child settlers are settled as well; it's possible for all of\n    // them to have settled previously only for one to unsettle\n    return super.isSettled() && this.settlersAreSettled()\n  }\n\n  private settlersAreSettled (): boolean {\n    for (const settler of this.settlers) {\n      if (!settler.isSettled()) {\n        return false\n      }\n    }\n\n    return true\n  }\n}\n\nexport default SettlerAggregate\n","import {\n  InMemoryPersistence,\n  toPersistedPayload\n\n} from '@bugsnag/core-performance'\nimport type { Persistence, PersistenceKey, PersistencePayloadMap } from '@bugsnag/core-performance'\n\ninterface LocalStorage {\n  setItem: (key: string, value: string) => void\n  getItem: (key: string) => string | null\n}\n\ninterface WindowWithLocalStorage {\n  localStorage?: LocalStorage\n}\n\nfunction makeBrowserPersistence (window: WindowWithLocalStorage): Persistence {\n  // accessing localStorage can throw on some browsers, so we have to catch\n  // these errors and provide a fallback\n  try {\n    if (window.localStorage) {\n      return new BrowserPersistence(window.localStorage)\n    }\n  } catch {}\n\n  // store items in memory if localStorage isn't available\n  return new InMemoryPersistence()\n}\n\nfunction toString<K extends PersistenceKey> (key: K, value: PersistencePayloadMap[K]): string {\n  switch (key) {\n    case 'bugsnag-sampling-probability':\n      return JSON.stringify(value)\n\n    case 'bugsnag-anonymous-id':\n      return value as string\n\n    default:\n      key satisfies never\n      return key\n  }\n}\n\nclass BrowserPersistence implements Persistence {\n  private readonly storage: LocalStorage\n\n  constructor (localStorage: LocalStorage) {\n    this.storage = localStorage\n  }\n\n  async load<K extends PersistenceKey> (key: K): Promise<PersistencePayloadMap[K] | undefined> {\n    try {\n      const raw = this.storage.getItem(key)\n\n      if (raw) {\n        return toPersistedPayload(key, raw)\n      }\n    } catch {}\n  }\n\n  async save<K extends PersistenceKey> (key: K, value: PersistencePayloadMap[K]): Promise<void> {\n    try {\n      this.storage.setItem(key, toString(key, value))\n    } catch {}\n  }\n}\n\nexport default makeBrowserPersistence\n","import type { Clock, SpanInternal } from '@bugsnag/core-performance'\n\ninterface PerformanceWithNavigationTiming {\n  getEntriesByName: typeof performance.getEntriesByName\n  getEntriesByType: typeof performance.getEntriesByType\n  timing: {\n    responseStart: number\n    navigationStart: number\n  }\n}\n\n// layout shifts are grouped into \"session windows\", which is defined as a set\n// of layout shifts that occur with less than 1 second between each shift and a\n// maximum of 5 seconds total duration\n// see the web vitals definition:\n// https://web.dev/evolving-cls/#why-a-session-window\ninterface LayoutShiftSession {\n  value: number\n  readonly firstStartTime: number\n  previousStartTime: number\n}\n\n// https://wicg.github.io/layout-instability/#sec-layout-shift\ninterface LayoutShift extends PerformanceEntry {\n  entryType: 'layout-shift'\n  value: number\n  hadRecentInput: boolean\n  lastInputTime: number\n}\n\nexport class WebVitals {\n  private readonly performance: PerformanceWithNavigationTiming\n  private readonly clock: Clock\n  private readonly observers: PerformanceObserver[]\n\n  private largestContentfulPaint: number | undefined\n  private cumulativeLayoutShift: number | undefined\n\n  constructor (\n    performance: PerformanceWithNavigationTiming,\n    clock: Clock,\n    PerformanceObserverClass?: typeof PerformanceObserver\n  ) {\n    this.performance = performance\n    this.clock = clock\n    this.observers = []\n\n    if (PerformanceObserverClass && Array.isArray(PerformanceObserverClass.supportedEntryTypes)) {\n      const supportedEntryTypes = PerformanceObserverClass.supportedEntryTypes\n\n      if (supportedEntryTypes.includes('largest-contentful-paint')) {\n        this.observeLargestContentfulPaint(PerformanceObserverClass)\n      }\n\n      if (supportedEntryTypes.includes('layout-shift')) {\n        this.observeLayoutShift(PerformanceObserverClass)\n      }\n    }\n  }\n\n  attachTo (span: SpanInternal) {\n    const firstContentfulPaint = this.firstContentfulPaint()\n\n    if (firstContentfulPaint) {\n      span.addEvent('fcp', firstContentfulPaint)\n    }\n\n    const timeToFirstByte = this.timeToFirstByte()\n\n    if (timeToFirstByte) {\n      span.addEvent('ttfb', timeToFirstByte)\n    }\n\n    const firstInputDelay = this.firstInputDelay()\n\n    if (firstInputDelay) {\n      span.addEvent('fid_start', firstInputDelay.start)\n      span.addEvent('fid_end', firstInputDelay.end)\n    }\n\n    if (this.cumulativeLayoutShift) {\n      span.setAttribute('bugsnag.metrics.cls', this.cumulativeLayoutShift)\n    }\n\n    if (this.largestContentfulPaint) {\n      span.addEvent('lcp', this.largestContentfulPaint)\n    }\n\n    // as there is only 1 page load span, we don't need to keep observing\n    // performance events, so can disconnect from any observers we've registered\n    for (const observer of this.observers) {\n      observer.disconnect()\n    }\n  }\n\n  private firstContentfulPaint () {\n    const entries = this.performance.getEntriesByName('first-contentful-paint', 'paint')\n    const entry = Array.isArray(entries) && entries[0]\n\n    if (entry) {\n      return entry.startTime\n    }\n  }\n\n  private timeToFirstByte () {\n    const entries = this.performance.getEntriesByType('navigation') as PerformanceNavigationTiming[]\n    const entry = Array.isArray(entries) && entries[0]\n\n    let responseStart: number\n\n    if (entry) {\n      responseStart = entry.responseStart\n    } else {\n      responseStart = this.performance.timing.responseStart - this.performance.timing.navigationStart\n    }\n\n    // only use responseStart if it's valid (between 0 and the current time)\n    // any other value cannot be valid because it would mean the response\n    // started immediately or hasn't happened yet!\n    if (responseStart > 0 && responseStart <= this.clock.now()) {\n      return responseStart\n    }\n  }\n\n  private firstInputDelay () {\n    const entries = this.performance.getEntriesByType('first-input') as PerformanceEventTiming[]\n    const entry = Array.isArray(entries) && entries[0]\n\n    if (entry) {\n      return {\n        start: entry.startTime,\n        end: entry.processingStart\n      }\n    }\n  }\n\n  private observeLargestContentfulPaint (\n    PerformanceObserverClass: typeof PerformanceObserver\n  ): void {\n    const observer = new PerformanceObserverClass((list) => {\n      const entries = list.getEntries()\n\n      if (entries.length > 0) {\n        // Use the latest LCP candidate\n        this.largestContentfulPaint = entries[entries.length - 1].startTime\n      }\n    })\n\n    observer.observe({ type: 'largest-contentful-paint', buffered: true })\n\n    this.observers.push(observer)\n  }\n\n  private observeLayoutShift (\n    PerformanceObserverClass: typeof PerformanceObserver\n  ): void {\n    let session: LayoutShiftSession | undefined\n\n    const observer = new PerformanceObserverClass((list) => {\n      for (const entry of list.getEntries() as LayoutShift[]) {\n        // ignore entries with recent input as it's likely the layout shifted due\n        // to user input and this metric only cares about unexpected layout\n        // shifts\n        if (entry.hadRecentInput) {\n          continue\n        }\n\n        // include this entry in the current session if we have a current session\n        // and this entry fits into the session window (it occurred less than 1\n        // second after the previous entry and the session duration is less than\n        // 5 seconds), otherwise start a new session\n        if (\n          session &&\n          entry.startTime - session.previousStartTime < 1000 &&\n          entry.startTime - session.firstStartTime < 5000\n        ) {\n          session.value += entry.value\n          session.previousStartTime = entry.startTime\n        } else {\n          session = {\n            value: entry.value,\n            firstStartTime: entry.startTime,\n            previousStartTime: entry.startTime\n          }\n        }\n      }\n\n      if (session &&\n        (this.cumulativeLayoutShift === undefined || session.value > this.cumulativeLayoutShift)\n      ) {\n        this.cumulativeLayoutShift = session.value\n      }\n    })\n\n    observer.observe({ type: 'layout-shift', buffered: true })\n\n    this.observers.push(observer)\n  }\n}\n","import { createClient, createNoopClient, InMemoryQueue } from '@bugsnag/core-performance'\nimport type { Client } from '@bugsnag/core-performance'\nimport createFetchDeliveryFactory from '@bugsnag/delivery-fetch-performance'\nimport { createFetchRequestTracker, createXmlHttpRequestTracker } from '@bugsnag/request-tracker-performance'\nimport { FullPageLoadPlugin, NetworkRequestPlugin, ResourceLoadPlugin, RouteChangePlugin } from './auto-instrumentation'\nimport createBrowserBackgroundingListener from './backgrounding-listener'\nimport createClock from './clock'\nimport { createSchema } from './config'\nimport type { BrowserConfiguration } from './config'\nimport { createDefaultRoutingProvider, createNoopRoutingProvider } from './default-routing-provider'\nimport idGenerator from './id-generator'\nimport createOnSettle, { createNoopOnSettle } from './on-settle'\nimport type { OnSettlePlugin } from './on-settle'\nimport makeBrowserPersistence from './persistence'\nimport createResourceAttributesSource from './resource-attributes-source'\nimport createSpanAttributesSource from './span-attributes-source'\nimport { WebVitals } from './web-vitals'\n\nexport let onSettle: OnSettlePlugin\nexport let DefaultRoutingProvider: ReturnType<typeof createDefaultRoutingProvider>\nlet BugsnagPerformance: Client<BrowserConfiguration>\n\nif (typeof window === 'undefined' || typeof document === 'undefined') {\n  onSettle = createNoopOnSettle()\n  DefaultRoutingProvider = createNoopRoutingProvider()\n  BugsnagPerformance = createNoopClient()\n} else {\n  const isDevelopment = window.location.hostname === 'localhost'\n  const backgroundingListener = createBrowserBackgroundingListener(window)\n  const spanAttributesSource = createSpanAttributesSource(document)\n  const clock = createClock(performance, backgroundingListener)\n  const persistence = makeBrowserPersistence(window)\n  const resourceAttributesSource = createResourceAttributesSource(navigator, persistence)\n  const fetchRequestTracker = createFetchRequestTracker(window, clock)\n  const xhrRequestTracker = createXmlHttpRequestTracker(XMLHttpRequest, clock, document)\n  const webVitals = new WebVitals(performance, clock, window.PerformanceObserver)\n  onSettle = createOnSettle(\n    clock,\n    window,\n    fetchRequestTracker,\n    xhrRequestTracker,\n    performance\n  )\n  DefaultRoutingProvider = createDefaultRoutingProvider(onSettle, window.location)\n\n  BugsnagPerformance = createClient({\n    isDevelopment,\n    backgroundingListener,\n    clock,\n    resourceAttributesSource,\n    spanAttributesSource,\n    deliveryFactory: createFetchDeliveryFactory(window.fetch, clock, backgroundingListener),\n    idGenerator,\n    schema: createSchema(new DefaultRoutingProvider(), isDevelopment),\n    plugins: (spanFactory, spanContextStorage) => [\n      onSettle,\n      new FullPageLoadPlugin(\n        document,\n        window.location,\n        spanFactory,\n        webVitals,\n        onSettle,\n        backgroundingListener,\n        performance\n      ),\n      // ResourceLoadPlugin should always come after FullPageLoad plugin, as it should use that\n      // span context as the parent of it's spans\n      new ResourceLoadPlugin(spanFactory, spanContextStorage, window.PerformanceObserver),\n      new NetworkRequestPlugin(spanFactory, spanContextStorage, fetchRequestTracker, xhrRequestTracker),\n      new RouteChangePlugin(spanFactory, window.location, document)\n    ],\n    persistence,\n    retryQueueFactory: (delivery, retryQueueMaxSize) => new InMemoryQueue(delivery, retryQueueMaxSize)\n  })\n}\n\nexport default BugsnagPerformance\n","import DomMutationSettler from './dom-mutation-settler'\nimport LoadEventEndSettler from './load-event-end-settler'\nimport type { PerformanceWithTiming } from './load-event-end-settler'\nimport RequestSettler from './request-settler'\nimport SettlerAggregate from './settler-aggregate'\nimport type { BrowserConfiguration } from '../config'\nimport type { RequestTracker } from '@bugsnag/request-tracker-performance'\nimport type { Clock, Plugin, PluginContext } from '@bugsnag/core-performance'\n\nexport type OnSettle = (callback: OnSettleCallback) => void\nexport type OnSettleCallback = (settledTime: number) => void\nexport type OnSettlePlugin = Plugin<BrowserConfiguration> & OnSettle\n\nconst TIMEOUT_MILLISECONDS = 60 * 1000\n\nexport function createNoopOnSettle (): OnSettlePlugin {\n  const noop = () => {}\n  noop.install = () => {}\n  noop.start = () => {}\n  return noop as OnSettlePlugin\n}\n\nexport default function createOnSettle (\n  clock: Clock,\n  window: Window,\n  fetchRequestTracker: RequestTracker,\n  xhrRequestTracker: RequestTracker,\n  performance: PerformanceWithTiming\n): OnSettlePlugin {\n  const domMutationSettler = new DomMutationSettler(clock, window.document)\n  const fetchRequestSettler = new RequestSettler(clock, fetchRequestTracker)\n  const xhrRequestSettler = new RequestSettler(clock, xhrRequestTracker)\n  const loadEventEndSettler = new LoadEventEndSettler(\n    clock,\n    window.addEventListener,\n    performance,\n    window.document\n  )\n\n  const settler = new SettlerAggregate(clock, [\n    domMutationSettler,\n    loadEventEndSettler,\n    fetchRequestSettler,\n    xhrRequestSettler\n  ])\n\n  function onSettlePlugin (callback: OnSettleCallback): void {\n    const onSettle: OnSettleCallback = (settledTime: number) => {\n      clearTimeout(timeout)\n\n      // unsubscribe from the settler so we don't call the callback more than\n      // once\n      settler.unsubscribe(onSettle)\n\n      callback(settledTime)\n    }\n\n    const timeout = setTimeout(() => {\n      const settledTime = clock.now()\n\n      settler.unsubscribe(onSettle)\n\n      callback(settledTime)\n    }, TIMEOUT_MILLISECONDS)\n\n    // if we're already settled apply a 100ms \"cooldown\" period in case we\n    // unsettle immediately after this call\n    // if we're not settled then this cooldown is irrelevant - we can just\n    // subscribe to the settler to be notified of when the page settles\n    const cooldown = settler.isSettled() ? 100 : 0\n    const settledTime = clock.now()\n\n    setTimeout(() => {\n      if (settler.isSettled()) {\n        // if we're still settled call the callback via \"onSettle\"\n        onSettle(settledTime)\n      } else {\n        // otherwise wait for the page to settle\n        settler.subscribe(onSettle)\n      }\n    }, cooldown)\n  }\n\n  onSettlePlugin.install = function (context: PluginContext<BrowserConfiguration>): void {\n    const settleIgnoreUrls = []\n\n    if (context.configuration.endpoint) {\n      settleIgnoreUrls.push(RegExp(context.configuration.endpoint))\n    }\n\n    if (context.configuration.settleIgnoreUrls) {\n      settleIgnoreUrls.push(...context.configuration.settleIgnoreUrls.map(\n        (url: string | RegExp): RegExp => typeof url === 'string' ? RegExp(url) : url\n      ))\n    }\n\n    fetchRequestSettler.setUrlsToIgnore(settleIgnoreUrls)\n    xhrRequestSettler.setUrlsToIgnore(settleIgnoreUrls)\n  }\n\n  onSettlePlugin.start = function (): void {}\n\n  return onSettlePlugin\n}\n","import type { BackgroundingListener, BackgroundingListenerCallback, BackgroundingListenerState } from '@bugsnag/core-performance'\n\ninterface DocumentForVisibilityState {\n  addEventListener: (event: string, callback: () => void) => void\n  visibilityState: string\n}\n\ninterface WindowWithDocumentForVisibilityState {\n  document: DocumentForVisibilityState\n  addEventListener: (event: string, callback: () => void) => void\n}\n\nexport default function createBrowserBackgroundingListener (window: WindowWithDocumentForVisibilityState) {\n  const callbacks: BackgroundingListenerCallback[] = []\n  let state: BackgroundingListenerState = window.document.visibilityState === 'hidden'\n    ? 'in-background'\n    : 'in-foreground'\n\n  const backgroundingListener: BackgroundingListener = {\n    onStateChange (backgroundingListenerCallback: BackgroundingListenerCallback): void {\n      callbacks.push(backgroundingListenerCallback)\n\n      // trigger the callback immediately if the document is already 'hidden'\n      if (state === 'in-background') {\n        backgroundingListenerCallback(state)\n      }\n    }\n  }\n\n  const backgroundStateChanged = (newState: BackgroundingListenerState) => {\n    if (state === newState) return\n\n    state = newState\n    for (const callback of callbacks) {\n      callback(state)\n    }\n  }\n\n  window.document.addEventListener('visibilitychange', function () {\n    const newState = window.document.visibilityState === 'hidden'\n      ? 'in-background'\n      : 'in-foreground'\n\n    backgroundStateChanged(newState)\n  })\n\n  // some browsers don't fire the visibilitychange event when the page is suspended,\n  // so we also listen for pagehide and pageshow events\n  window.addEventListener('pagehide', function () {\n    backgroundStateChanged('in-background')\n  })\n\n  window.addEventListener('pageshow', function () {\n    backgroundStateChanged('in-foreground')\n  })\n\n  return backgroundingListener\n}\n","import type { InternalConfiguration, SpanAttributesSource, SpanInternal } from '@bugsnag/core-performance'\nimport type { BrowserConfiguration } from './config'\n\nexport const createSpanAttributesSource = (document: Document): SpanAttributesSource<BrowserConfiguration> => {\n  const defaultAttributes = {\n    url: {\n      name: 'bugsnag.browser.page.url',\n      getValue: () => document.location.href,\n      permitted: false\n    },\n    title: {\n      name: 'bugsnag.browser.page.title',\n      getValue: () => document.title,\n      permitted: false\n    }\n  }\n\n  return {\n    configure (configuration: InternalConfiguration<BrowserConfiguration>) {\n      defaultAttributes.title.permitted = configuration.sendPageAttributes.title || false\n      defaultAttributes.url.permitted = configuration.sendPageAttributes.url || false\n    },\n    requestAttributes (span: SpanInternal) {\n      for (const attribute of Object.values(defaultAttributes)) {\n        if (attribute.permitted) {\n          span.setAttribute(attribute.name, attribute.getValue())\n        }\n      }\n    }\n  }\n}\n\nexport default createSpanAttributesSource\n","import cuid from '@bugsnag/cuid'\nimport { ResourceAttributes } from '@bugsnag/core-performance'\nimport type { Persistence, ResourceAttributeSource } from '@bugsnag/core-performance'\nimport type { BrowserConfiguration } from './config'\n\nfunction createResourceAttributesSource (\n  navigator: Navigator,\n  persistence: Persistence\n): ResourceAttributeSource<BrowserConfiguration> {\n  let getDeviceId: Promise<string> | undefined\n  let deviceId: string | undefined\n\n  return function resourceAttributesSource (config) {\n    const attributes = new ResourceAttributes(\n      config.releaseStage,\n      config.appVersion,\n      config.serviceName,\n      'bugsnag.performance.browser',\n      '__VERSION__',\n      config.logger\n    )\n\n    attributes.set('browser.user_agent', navigator.userAgent)\n\n    // chromium only\n    if (navigator.userAgentData) {\n      attributes.set('browser.platform', navigator.userAgentData.platform)\n      attributes.set('browser.mobile', navigator.userAgentData.mobile)\n    }\n\n    if (config.generateAnonymousId) {\n      // ensure we only load/generate the anonymous ID once no matter how many\n      // times we're called, otherwise we could generate different IDs on\n      // different calls as cuids are partly time based\n      if (!getDeviceId) {\n        getDeviceId = persistence.load('bugsnag-anonymous-id')\n          .then(maybeAnonymousId => {\n            // use the persisted value or generate a new ID\n            const anonymousId = maybeAnonymousId || cuid()\n\n            // if there was no persisted value, save the newly generated ID\n            if (!maybeAnonymousId) {\n              persistence.save('bugsnag-anonymous-id', anonymousId)\n            }\n\n            // store the device ID so we can set it synchronously in future\n            deviceId = anonymousId\n\n            return deviceId\n          })\n      }\n\n      if (deviceId) {\n        // set device ID synchronously if it's already available\n        attributes.set('device.id', deviceId)\n      } else {\n        // otherwise add it when the promise resolves\n        return getDeviceId\n          .then(deviceId => {\n            attributes.set('device.id', deviceId)\n\n            return attributes\n          })\n      }\n    }\n\n    return Promise.resolve(attributes)\n  }\n}\n\nexport default createResourceAttributesSource\n","import { RequestTracker } from './request-tracker.js';\nimport getAbsoluteUrl from './url-helpers.js';\n\nfunction createXmlHttpRequestTracker(xhr, clock, document) {\n    const requestTracker = new RequestTracker();\n    const trackedRequests = new WeakMap();\n    const requestHandlers = new WeakMap();\n    const originalOpen = xhr.prototype.open;\n    xhr.prototype.open = function open(method, url, ...rest) {\n        trackedRequests.set(this, { method, url: getAbsoluteUrl(String(url), document && document.baseURI) });\n        // @ts-expect-error rest\n        originalOpen.call(this, method, url, ...rest);\n    };\n    const originalSend = xhr.prototype.send;\n    xhr.prototype.send = function send(body) {\n        const requestData = trackedRequests.get(this);\n        if (requestData) {\n            // if there is an existing event listener this request instance is being reused,\n            // so we need to remove the listener from the previous send\n            const existingHandler = requestHandlers.get(this);\n            if (existingHandler)\n                this.removeEventListener('readystatechange', existingHandler);\n            const { onRequestEnd, extraRequestHeaders } = requestTracker.start({\n                type: 'xmlhttprequest',\n                method: requestData.method,\n                url: requestData.url,\n                startTime: clock.now()\n            });\n            if (extraRequestHeaders) {\n                for (const extraHeaders of extraRequestHeaders) {\n                    for (const [name, value] of Object.entries(extraHeaders)) {\n                        this.setRequestHeader(name, value);\n                    }\n                }\n            }\n            const onReadyStateChange = (evt) => {\n                if (this.readyState === xhr.DONE && onRequestEnd) {\n                    // If the status is 0 the request did not complete so report this as an error\n                    const endContext = this.status > 0\n                        ? { endTime: clock.now(), status: this.status, state: 'success' }\n                        : { endTime: clock.now(), state: 'error' };\n                    onRequestEnd(endContext);\n                }\n            };\n            this.addEventListener('readystatechange', onReadyStateChange);\n            requestHandlers.set(this, onReadyStateChange);\n        }\n        originalSend.call(this, body);\n    };\n    return requestTracker;\n}\n\nexport { createXmlHttpRequestTracker as default };\n","import {\n  isBoolean,\n  isStringWithLength,\n  isStringOrRegExpArray,\n  schema\n} from '@bugsnag/core-performance'\nimport type { ConfigOption, Configuration, CoreSchema } from '@bugsnag/core-performance'\nimport { defaultNetworkRequestCallback, isNetworkRequestCallback } from '@bugsnag/request-tracker-performance'\nimport type { NetworkRequestCallback } from '@bugsnag/request-tracker-performance'\nimport type { BrowserNetworkRequestInfo } from './auto-instrumentation'\nimport { isRoutingProvider } from './routing-provider'\nimport type { RoutingProvider } from './routing-provider'\nimport { defaultSendPageAttributes, isSendPageAttributes } from './send-page-attributes'\nimport type { SendPageAttributes } from './send-page-attributes'\n\nexport interface BrowserSchema extends CoreSchema {\n  autoInstrumentFullPageLoads: ConfigOption<boolean>\n  autoInstrumentNetworkRequests: ConfigOption<boolean>\n  autoInstrumentRouteChanges: ConfigOption<boolean>\n  generateAnonymousId: ConfigOption<boolean>\n  routingProvider: ConfigOption<RoutingProvider>\n  settleIgnoreUrls: ConfigOption<Array<string | RegExp>>\n  networkRequestCallback: ConfigOption<NetworkRequestCallback<BrowserNetworkRequestInfo>>\n  sendPageAttributes: ConfigOption<SendPageAttributes>\n  serviceName: ConfigOption<string>\n}\n\nexport interface BrowserConfiguration extends Configuration {\n  autoInstrumentFullPageLoads?: boolean\n  autoInstrumentNetworkRequests?: boolean\n  autoInstrumentRouteChanges?: boolean\n  generateAnonymousId?: boolean\n  routingProvider?: RoutingProvider\n  settleIgnoreUrls?: Array<string | RegExp>\n  networkRequestCallback?: NetworkRequestCallback<BrowserNetworkRequestInfo>\n  sendPageAttributes?: SendPageAttributes\n  serviceName?: string\n}\n\nexport function createSchema (defaultRoutingProvider: RoutingProvider, isDevelopment = false): BrowserSchema {\n  return {\n    ...schema,\n    releaseStage: {\n      ...schema.releaseStage,\n      defaultValue: isDevelopment ? 'development' : 'production'\n    },\n    autoInstrumentFullPageLoads: {\n      defaultValue: true,\n      message: 'should be true|false',\n      validate: isBoolean\n    },\n    autoInstrumentNetworkRequests: {\n      defaultValue: true,\n      message: 'should be true|false',\n      validate: isBoolean\n    },\n    autoInstrumentRouteChanges: {\n      defaultValue: true,\n      message: 'should be true|false',\n      validate: isBoolean\n    },\n    generateAnonymousId: {\n      defaultValue: true,\n      message: 'should be true|false',\n      validate: isBoolean\n    },\n    routingProvider: {\n      defaultValue: defaultRoutingProvider,\n      message: 'should be a routing provider',\n      validate: isRoutingProvider\n    },\n    settleIgnoreUrls: {\n      defaultValue: [],\n      message: 'should be an array of string|RegExp',\n      validate: isStringOrRegExpArray\n    },\n    networkRequestCallback: {\n      defaultValue: defaultNetworkRequestCallback,\n      message: 'should be a function',\n      validate: isNetworkRequestCallback\n    },\n    sendPageAttributes: {\n      defaultValue: defaultSendPageAttributes,\n      message: 'should be an object',\n      validate: isSendPageAttributes\n    },\n    serviceName: {\n      defaultValue: 'unknown_service',\n      message: 'should be a string',\n      validate: isStringWithLength\n    }\n  }\n}\n"],"names":["defaultSpanAttributeLimits","attributeStringValueLimit","attributeArrayLengthLimit","attributeCountLimit","defaultResourceAttributeLimits","Infinity","isBoolean","value","isObject","Array","isArray","isNumber","Number","isFinite","isNaN","isString","isStringWithLength","length","isStringOrRegExpArray","every","item","RegExp","isParentContext","id","traceId","isCallbackArray","SpanAttributes","droppedAttributesCount","this","_droppedAttributesCount","constructor","initialValues","spanAttributeLimits","spanName","logger","attributes","truncateAttribute","name","set","limit","originalLength","newString","slice","truncateString","warn","truncatedValue","isValidAttributeValue","isValidAttributeName","remove","setCustom","has","size","delete","toJson","from","forEach","key","map","attribute","isInteger","intValue","doubleValue","boolValue","stringValue","arrayValues","getJsonAttributeValue","filter","arrayValue","values","attributeToJson","attr","undefined","toObject","Object","fromEntries","ResourceAttributes","releaseStage","appVersion","serviceName","sdkName","sdkVersion","Map","super","NANOSECONDS_IN_MILLISECONDS","millisecondsToNanoseconds","milliseconds","Math","round","schema","defaultValue","message","validate","endpoint","apiKey","test","debug","console","info","error","enabledReleaseStages","isStringArray","plugins","plugin","install","start","isPlugin","bugsnag","addOnError","samplingProbability","onSpanStart","onSpanEnd","SpanEvents","events","add","time","push","clock","timeUnixNano","toUnixTimestampNanoseconds","traceIdToSamplingRate","samplingRate","i","position","parseInt","async","runSpanEndCallbacks","spanEnded","callbacks","span","raw","isValid","end","setAttribute","spanEndedToSpan","callbackStartTime","performance","now","shouldSample","callback","result","then","err","duration","SpanInternal","startTime","parentSpanId","kind","addEvent","setCustomAttribute","endTime","_samplingProbability","coreSpanOptionSchema","getDefaultValue","Date","parentContext","makeCurrentContext","isFirstClass","BatchProcessor","delivery","configuration","retryQueue","sampler","probabilityManager","encoder","spans","timeout","flushQueue","Promise","resolve","flush","bind","stop","clearTimeout","setTimeout","batchInactivityTimeoutMs","includes","maximumBatchSize","batch","prepareBatch","payload","encode","batchTime","response","send","setProbability","state","ensureFreshProbability","probability","spanProbability","sample","TracePayloadEncoder","resourceAttributeSource","resourceAttributes","jsonSpans","spanId","startTimeUnixNano","endTimeUnixNano","body","resourceSpans","resource","scopeSpans","headers","generateSamplingHeader","spanCounts","create","existingValue","rawProbabilities","keys","pairs","rawProbability","join","retryCodes","Set","FixedProbabilityManager","newProbability","Priority","PrioritizedSet","initialItems","items","sort","priority","some","addAll","added","Symbol","iterator","a","b","PluginContext","onSpanStartCallbacks","onSpanEndCallbacks","spanControlProviders","addOnSpanStartCallback","addOnSpanEndCallback","addSpanControlProvider","provider","mergeFrom","context","PluginManager","installedPlugins","addPlugins","installPlugins","mergedContext","startPlugins","getPlugin","Constructor","ProbabilityFetcher","getNewProbability","timeBetweenRetries","PROBABILITY_REFRESH_MILLISECONDS","ProbabilityManager","persistence","probabilityFetcher","persistedProbability","load","initialProbabilityTime","outstandingFreshnessCheck","lastProbabilityTime","save","BufferingProcessor","scaleProbabilityToMatchSamplingRate","floor","Sampler","initialProbability","_probability","scaledProbability","scaled","DefaultSpanContextStorage","backgroundingListener","contextStack","isInForeground","onBackgroundStateChange","onStateChange","pop","span1","span2","current","removeClosedContexts","first","CompositeSpanControlProvider","providers","addProvider","addProviders","getSpanControls","query","spanControl","timeToNumber","convert","SpanFactory","processor","idGenerator","spanAttributesSource","spanContextStorage","openSpans","WeakSet","startSpan","options","createSpanInternal","spanInternal","toPublicApi","safeStartTime","generate","startNetworkSpan","method","toUpperCase","cleanOptions","validateSpanOptions","url","configure","reprocessEarlySpans","batchProcessor","endSpan","additionalAttributes","untracked","isValidSpan","entries","requestAttributes","sendForProcessing","discardSpan","safeEndTime","warnings","String","spanOptions","option","prototype","hasOwnProperty","call","appState","getAppState","setAppState","newState","getDefaultExportFromCjs","x","pad","num","s","substr","require$$0","env","window","self","globalCount","prop","clientId","navigator","mimeTypes","userAgent","toString","fingerprint","isCuid","require$$2","c","blockSize","base","discreteValues","pow","randomBlock","random","cuid","getTime","InMemoryPersistence","persistedItems","get","toPersistedPayload","json","JSON","parse","InMemoryQueue","retryQueueMaxSize","requestQueue","payloads","spanCount","reduce","count","countSpansInPayload","shift","j","TRACE_PERENT_REGEX","RemoteParentContext","encodeAsTraceParent","toTraceParentString","parseTraceParent","encodedString","exec","sampled","samplingProbabilityFromHeaders","asNumber","parseFloat","defaultNetworkRequestCallback","networkRequestInfo","isNetworkRequestCallback","RequestTracker","onStart","startCallback","results","onRequestEnd","endContext","extraRequestHeaders","isDefined","argument","getAbsoluteUrl","baseUrl","indexOf","absoluteUrl","URL","href","endsWith","_a","isRequest","input","defaultSendPageAttributes","referrer","title","getPermittedAttributes","sendPageAttributes","isSendPageAttributes","obj","allowedTypes","defaultRouteResolver","pathname","createNoopRoutingProvider","resolveRoute","listenForRouteChanges","startRouteChangeSpan","createDefaultRoutingProvider","onSettle","location","addEventListener","ev","originalPushState","history","pushState","args","absoluteURL","document","baseURI","apply","FullPageLoadPlugin","spanFactory","webVitals","wasBackgrounded","enabled","routeResolver","autoInstrumentFullPageLoads","routingProvider","traceparentMetaTag","querySelector","getAttribute","traceparent","split","permittedAttributes","route","createPageLoadPhaseSpan","phase","shouldOmitSpan","getEntriesByType","entry","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","TCPHandshakeEnd","secureConnectionStart","connectEnd","connectStart","requestStart","responseStart","responseEnd","domContentLoadedEventStart","domContentLoadedEventEnd","loadEventStart","loadEventEnd","instrumentPageLoadPhaseSpans","attachTo","permittedPrefixes","NetworkRequestPlugin","fetchTracker","xhrTracker","configEndpoint","networkRequestCallback","trackRequest","startContext","shouldTrackRequest","shouldPropagateTraceContextByDefault","defaultRequestInfo","type","propagateTraceContext","getExtraRequestHeaders","status","autoInstrumentNetworkRequests","prefix","startsWith","spanContext","tracestate","getHttpVersion","protocol","ResourceLoadPlugin","PerformanceObserverClass","supportedEntryTypes","observer","list","getEntries","initiatorType","search","httpFlavor","nextHopProtocol","encodedBodySize","decodedBodySize","responseStatus","observe","buffered","entryTypes","routeChangeSpanOptionSchema","trigger","RouteChangePlugin","autoInstrumentRouteChanges","previousUrl","previousRoute","_b","stringUrl","routeChangeSpanOptions","endTimeOrOptions","urlObject","ensureUrl","MAX_CLOCK_DRIFT_MS","recalculateTimeOrigin","timeOrigin","abs","isRoutingProvider","toHex","hex","bits","bytes","Uint8Array","randomValues","crypto","getRandomValues","Settler","settled","subscribe","isSettled","unsubscribe","settle","settledTime","DomMutationSettler","target","MutationObserver","restart","subtree","childList","characterData","LoadEventEndSettler","readyState","settleUsingPerformance","entryType","isPerformanceNavigationTiming","timing","navigationStart","RequestSettler","requestTracker","urlsToIgnore","outstandingRequests","onRequestStart","setUrlsToIgnore","shouldIgnoreUrl","regexp","SettlerAggregate","settlers","settler","settlersAreSettled","BrowserPersistence","localStorage","storage","getItem","setItem","stringify","WebVitals","observers","observeLargestContentfulPaint","observeLayoutShift","firstContentfulPaint","timeToFirstByte","firstInputDelay","cumulativeLayoutShift","largestContentfulPaint","disconnect","getEntriesByName","processingStart","session","hadRecentInput","previousStartTime","firstStartTime","DefaultRoutingProvider","BugsnagPerformance","noop","createNoopOnSettle","currentSpanContext","createNoopClient","isDevelopment","hostname","visibilityState","backgroundingListenerCallback","backgroundStateChanged","createBrowserBackgroundingListener","defaultAttributes","getValue","permitted","createSpanAttributesSource","calculatedTimeOrigin","toUnixNanoseconds","date","createClock","makeBrowserPersistence","resourceAttributesSource","getDeviceId","deviceId","config","userAgentData","platform","mobile","generateAnonymousId","maybeAnonymousId","anonymousId","createResourceAttributesSource","fetchRequestTracker","global","originalFetch","fetch","init","inputIsRequest","createStartContext","modifiedParams","extraHeaders","Headers","isHeadersInstance","mergeInitRequestHeaders","mergeInputRequestHeaders","mergeRequestHeaders","catch","createFetchRequestTracker","xhrRequestTracker","xhr","trackedRequests","WeakMap","requestHandlers","originalOpen","open","rest","originalSend","requestData","existingHandler","removeEventListener","setRequestHeader","onReadyStateChange","evt","DONE","createXmlHttpRequestTracker","XMLHttpRequest","PerformanceObserver","domMutationSettler","fetchRequestSettler","xhrRequestSettler","loadEventEndSettler","onSettlePlugin","cooldown","settleIgnoreUrls","createOnSettle","bufferingProcessor","spanControlProvider","pluginManager","Error","cleanConfiguration","defaultBatchTime","validateConfig","replace","Event","setTraceCorrelation","Client","originalNotify","_notify","pluginContext","spanStartCallbacks","spanEndCallbacks","deliveryFactory","manager","retryQueueFactory","networkSpanOptions","endOptions","platformExtensions","createClient","keepalive","toISOString","statusCode","createFetchDeliveryFactory","defaultRoutingProvider","createSchema","BugsnagPerformance$1"],"mappings":"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","x_google_ignoreList":[23,24,25,26]}