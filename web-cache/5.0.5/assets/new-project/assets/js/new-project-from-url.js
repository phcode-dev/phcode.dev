let createProjectBtn,locationInput,projectNameInput,createProjectWithNameBtn;const urlSearchParams=new URLSearchParams(window.location.search),params=Object.fromEntries(urlSearchParams.entries()),PARAM_SUGGESTED_NAME=params.suggestedName||"project",PARAM_SUGGESTED_TITLE=params.title||Strings.CMD_PROJECT_NEW,PARAM_SUGGESTED_URL=params.url,FLATTEN_ZIP_FIRST_LEVEL_DIR="true"===params.flattenZipFirstLevel,LICENSE=params.license,LICENSE_URL=params.licenseURL,CREDITS=params.credits,CREDITS_URL=params.creditsURL,PREVIEW_URL=params.previewURL,BACK_URL=params.backURL;let projectLocation=null,projectName=null;function _computeProjectPath(){if($(projectNameInput).is(":visible")){let suggestedName=projectNameInput.value;return suggestedName&&projectLocation?projectLocation+suggestedName:null}return projectLocation}async function _validateProjectLocation(){if($(locationInput).is(":visible")){let isLocationValid;return projectLocation&&await newProjectExtension.alreadyExists(projectLocation)?($(locationInput).removeClass("error-border"),!0):($(locationInput).addClass("error-border"),!1)}return!0}async function _validateSuggestedName(){if($(projectNameInput).is(":visible")){let suggestedName=projectNameInput.value;if(!suggestedName||!projectLocation||await newProjectExtension.alreadyExists(projectLocation+suggestedName))return $(projectNameInput).addClass("error-border"),!1;$(projectNameInput).removeClass("error-border")}return!0}async function _validateAll(){const locIsValid=await _validateProjectLocation(),nameIsValid=await _validateSuggestedName();return document.getElementById("createProjectBtn").disabled=!(locIsValid&&nameIsValid),document.getElementById("createProjectWithNameBtn").disabled=!(locIsValid&&nameIsValid),locIsValid&&nameIsValid}function _selectFolder(){newProjectExtension.showFolderSelect().then(file=>{(projectLocation=file).endsWith("/")||(projectLocation+="/"),locationInput.value=window.parent.Phoenix.app.getDisplayPath(file),_validateAll()})}async function _createProjectClicked(){const projectPath=_computeProjectPath();projectPath?(await window.parent.Phoenix.VFS.ensureExistsDirAsync(projectPath),newProjectExtension.downloadAndOpenProject(PARAM_SUGGESTED_URL,projectPath,PARAM_SUGGESTED_NAME,FLATTEN_ZIP_FIRST_LEVEL_DIR).then(()=>{Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT,"createProject.Click","create.success"),newProjectExtension.closeDialogue()}),Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT,"createProject.Click","create")):newProjectExtension.showErrorDialogue(Strings.MISSING_FIELDS,Strings.PLEASE_FILL_ALL_REQUIRED)}function _showLicensingInfo(){if((LICENSE||LICENSE_URL||CREDITS||CREDITS_URL)&&$(document.getElementById("License")).removeClass("forced-hidden"),LICENSE||LICENSE_URL){let el=document.getElementById("licenseLink");el.textContent=LICENSE||LICENSE_URL,LICENSE_URL&&$(el).click(evt=>{window.parent.brackets.app.openURLInDefaultBrowser(LICENSE_URL),evt.preventDefault(),evt.stopPropagation()})}if(CREDITS||CREDITS_URL){let el=document.getElementById("creditsLink");el.textContent=CREDITS||CREDITS_URL,CREDITS_URL&&$(el).click(evt=>{window.parent.brackets.app.openURLInDefaultBrowser(CREDITS_URL),evt.preventDefault(),evt.stopPropagation()})}}function _showPreview(){PREVIEW_URL&&($(document.getElementById("previewBox")).removeClass("forced-hidden"),document.getElementById("bigFrame").src=PREVIEW_URL,document.getElementById("littleFrame").src=PREVIEW_URL)}function _setupNavigation(){BACK_URL&&(document.getElementById("backButton").href=BACK_URL)}function initNewProjectFromURL(){_setupNavigation(),window.parent.Phoenix.isNativeApp?(projectLocation=newProjectExtension.getLocalProjectsPath(),projectName=PARAM_SUGGESTED_NAME,$(document.getElementById("createProjectBtn")).addClass("forced-inVisible")):window.showDirectoryPicker?$(document.getElementById("projectName")).addClass("forced-hidden"):(projectName=PARAM_SUGGESTED_NAME,projectLocation=newProjectExtension.getLocalProjectsPath(),$(document.getElementById("projectLocation")).addClass("forced-hidden")),document.getElementById("titleNewProject").textContent=PARAM_SUGGESTED_TITLE,projectNameInput=document.getElementById("projectNameInput"),locationInput=document.getElementById("locationInput"),createProjectBtn=document.getElementById("createProjectBtn"),createProjectWithNameBtn=document.getElementById("createProjectWithNameBtn"),createProjectBtn.onclick=_createProjectClicked,createProjectWithNameBtn.onclick=_createProjectClicked,$(projectNameInput).keyup(_validateAll),locationInput.value=Strings.PLEASE_SELECT_A_FOLDER,projectNameInput.value=projectName,locationInput.onclick=_selectFolder,projectLocation&&(locationInput.value=window.parent.Phoenix.app.getDisplayPath(projectLocation)),_showLicensingInfo(),_showPreview(),_validateAll()}